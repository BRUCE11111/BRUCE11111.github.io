<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>linuxå®‰è£…è½¯ä»¶</title>
      <link href="2021/11/07/linux-an-zhuang-ruan-jian/"/>
      <url>2021/11/07/linux-an-zhuang-ruan-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h1><h2 id="1-Anaconda"><a href="#1-Anaconda" class="headerlink" title="1.Anaconda"></a>1.Anaconda</h2><ol><li>ä¸‹è½½è½¯ä»¶åŒ…</li></ol><p><code>curl -O https://repo.anaconda.com/archive/Anaconda3-2021.05-Linux-s390x.sh</code></p><p>æ³¨æ„è¿™ä¸ªæ˜¯2021ç‰ˆæœ¬çš„ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>èµ„äº§ç®¡ç†å¹³å°</title>
      <link href="2021/10/26/zi-chan-guan-li-ping-tai/"/>
      <url>2021/10/26/zi-chan-guan-li-ping-tai/</url>
      
        <content type="html"><![CDATA[<h2 id="1-ElastricSearch"><a href="#1-ElastricSearch" class="headerlink" title="1. ElastricSearch"></a>1. ElastricSearch</h2><h2 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1. å®‰è£…"></a>1. å®‰è£…</h2><h3 id="1-1-ä¸‹è½½å®‰è£…"><a href="#1-1-ä¸‹è½½å®‰è£…" class="headerlink" title="1.1 ä¸‹è½½å®‰è£…"></a>1.1 ä¸‹è½½å®‰è£…</h3><p><code>docker pull elasticsearch:7.4.2</code> å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚</p><p><code>docker pull kibana:7.4.2</code> å¯è§†åŒ–æ£€ç´¢æ•°æ®ï¼Œç›¸å½“äºSQLyogå¯¹mysqlã€‚</p><p><code>echo "http.host: 0.0.0.0" &gt;&gt; ./config/elasticsearch.yml</code></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --name elasticsearch -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 <span class="token punctuation">\</span>-e <span class="token string">"discovery.type=single-node"</span> <span class="token punctuation">\</span>-e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms64m -Xmx128m"</span> <span class="token punctuation">\</span>-v /home/tclab/env/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml <span class="token punctuation">\</span>-v /home/tclab/env/elasticsearch/data:/usr/share/elasticsearch/data <span class="token punctuation">\</span>-v /home/tclab/env/elasticsearch/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\</span>-d elasticsearch:7.4.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --name kibana -e <span class="token assign-left variable">ELASTICSEARCH_URL</span><span class="token operator">=</span>http://0.0.0.0:9200 -p <span class="token number">5601</span>:5601 -d kibana:7.4.2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="2-ä½¿ç”¨"><a href="#2-ä½¿ç”¨" class="headerlink" title="2. ä½¿ç”¨"></a>2. ä½¿ç”¨</h1><h2 id="2-1-put"><a href="#2-1-put" class="headerlink" title="2.1 put"></a>2.1 put</h2><h3 id="2-1-1-å¸¦id"><a href="#2-1-1-å¸¦id" class="headerlink" title="2.1.1 å¸¦id"></a>2.1.1 å¸¦id</h3><p><code>http://172.16.6.94:9200/customer/external/1</code></p><p><span class="github-emoji"><span>ğŸ˜ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f620.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ‡è®°putæ–¹å¼ä¸å…è®¸ä¸å¸¦idçš„ã€‚</p><h2 id="2-2-post"><a href="#2-2-post" class="headerlink" title="2.2 post"></a>2.2 post</h2><p><code>http://172.16.6.94:9200/customer/external/</code></p><p>:happy: postæ–¹å¼å¯ä»¥ä¸å¸¦idã€‚</p><h2 id="2-3-delete"><a href="#2-3-delete" class="headerlink" title="2.3 delete"></a>2.3 delete</h2><p><code>DELETE customer/external/1</code> </p><p><code>DELETE customer</code> // åªèƒ½ç›´æ¥åˆ é™¤ç´¢å¼•ï¼ˆæ•°æ®åº“ï¼‰</p><h2 id="2-4-bulkæ‰¹é‡API"><a href="#2-4-bulkæ‰¹é‡API" class="headerlink" title="2.4 bulkæ‰¹é‡API"></a>2.4 bulkæ‰¹é‡API</h2><p>:happy: å¿…é¡»å¾—å‘<code>post</code>è¯·æ±‚</p><p><span class="github-emoji"><span>ğŸ¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾‹å­ï¼š</p><p><img src="/2021/10/26/zi-chan-guan-li-ping-tai/image-20211114141715516.png" alt="image-20211114141715516"></p><h1 id="3-æ£€ç´¢"><a href="#3-æ£€ç´¢" class="headerlink" title="3.æ£€ç´¢"></a>3.æ£€ç´¢</h1><h2 id="3-1-SearchAPI"><a href="#3-1-SearchAPI" class="headerlink" title="3.1 SearchAPI"></a>3.1 SearchAPI</h2><p>ESæ”¯æŒä¸¤ç§åŸºæœ¬æ–¹å¼æ£€ç´¢ï¼š</p><ol><li>é€šè¿‡REST request URI  å‘é€æœç´¢å‚æ•°(uri + æ£€ç´¢å‚æ•°)</li><li>å¦ä¸€ä¸ªæ˜¯é€šè¿‡ REST request body æ¥å‘é€å®ƒä»¬ï¼ˆuri + è¯·æ±‚ä½“ï¼‰</li></ol><p><span class="github-emoji"><span>ğŸ§</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f367.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾‹å­ï¼š</p><p><img src="/2021/10/26/zi-chan-guan-li-ping-tai/image-20211114163024759.png" alt="image-20211114163024759"></p><h2 id="3-2-QueryDS"><a href="#3-2-QueryDS" class="headerlink" title="3.2 QueryDS"></a>3.2 QueryDS</h2>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python</title>
      <link href="2021/10/23/python/"/>
      <url>2021/10/23/python/</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">https<span class="token punctuation">:</span><span class="token operator">//</span>blog<span class="token punctuation">.</span>csdn<span class="token punctuation">.</span>net<span class="token operator">/</span>weixin_40844416<span class="token operator">/</span>article<span class="token operator">/</span>details<span class="token operator">/</span><span class="token number">80889165</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>python2 å’Œ python3 å…±å­˜çš„æ–¹æ³•ï¼š</p><p><a href="https://www.cnblogs.com/schut/p/10344597.html">Windows10ç³»ç»Ÿä¸‹å®‰è£…python2å’Œpython3åŒç‰ˆæœ¬ - æš®å…‰å¾®å‡‰ - åšå®¢å›­ (cnblogs.com)</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>go</title>
      <link href="2021/09/27/go/"/>
      <url>2021/09/27/go/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å®‰è£…é—®é¢˜"><a href="#1-å®‰è£…é—®é¢˜" class="headerlink" title="1. å®‰è£…é—®é¢˜"></a>1. å®‰è£…é—®é¢˜</h2><h3 id="1-1-è§£å†³VSCodeå®‰è£…Go-toolså¤±è´¥çš„é—®é¢˜"><a href="#1-1-è§£å†³VSCodeå®‰è£…Go-toolså¤±è´¥çš„é—®é¢˜" class="headerlink" title="1.1 è§£å†³VSCodeå®‰è£…Go toolså¤±è´¥çš„é—®é¢˜"></a>1.1 è§£å†³VSCodeå®‰è£…Go toolså¤±è´¥çš„é—®é¢˜</h3><p>May 26, 2020 | 1548 é˜…è¯»</p><p><strong>æµ‹è¯•ç¯å¢ƒ</strong></p><pre class="line-numbers language-none"><code class="language-none">$ go versiongo version go1.14.3 darwin/amd64$ sw_versProductName:Mac OS XProductVersion:10.14.6BuildVersion:18G4032<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®‰è£…Goåï¼Œæ‰“å¼€VS Codeï¼ŒæŒ‰ç…§æç¤ºå®‰è£…äº†å¾®è½¯å®˜æ–¹çš„GOæ’ä»¶ã€‚ä½†åœ¨å®‰è£…go toolsæ—¶ï¼Œå‡ºç°äº†ä¸‹é¢çš„ä¸€å¤§å †é”™è¯¯ã€‚</p><pre class="line-numbers language-none"><code class="language-none">go.toolsGopath setting is not set. Using GOPATH /Users/l2m2/goInstalling 17 tools at /Users/l2m2/go/bin in module mode.  gocode  gopkgs  go-outline  go-symbols  guru  gorename  gotests  gomodifytags  impl  fillstruct  goplay  godoctor  dlv  gocode-gomod  godef  goimports  golintInstalling github.com/mdempsky/gocode FAILEDInstalling github.com/uudashr/gopkgs/v2/cmd/gopkgs FAILEDInstalling github.com/ramya-rao-a/go-outline FAILEDInstalling github.com/acroca/go-symbols FAILEDInstalling golang.org/x/tools/cmd/guru FAILEDInstalling golang.org/x/tools/cmd/gorename FAILEDInstalling github.com/cweill/gotests/... FAILEDInstalling github.com/fatih/gomodifytags FAILEDInstalling github.com/josharian/impl FAILEDInstalling github.com/davidrjenni/reftools/cmd/fillstruct FAILEDInstalling github.com/haya14busa/goplay/cmd/goplay FAILEDInstalling github.com/godoctor/godoctor FAILEDInstalling github.com/go-delve/delve/cmd/dlv FAILEDInstalling github.com/stamblerre/gocode FAILEDInstalling github.com/rogpeppe/godef FAILEDInstalling golang.org/x/tools/cmd/goimports FAILEDInstalling golang.org/x/lint/golint FAILED17 tools failed to install.gocode:Error: Command failed: /usr/local/go/bin/go get -v github.com/mdempsky/gocodego get github.com/mdempsky/gocode: module github.com/mdempsky/gocode: Get "https://proxy.golang.org/github.com/mdempsky/gocode/@v/list": dial tcp 172.217.160.113:443: i/o timeoutgo get github.com/mdempsky/gocode: module github.com/mdempsky/gocode: Get "https://proxy.golang.org/github.com/mdempsky/gocode/@v/list": dial tcp 172.217.160.113:443: i/o timeout<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>è®¾ç½®ä»£ç†ï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ go env -w GO111MODULE=on$ go env -w GOPROXY=https://goproxy.io,direct<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è®¾ç½®å®Œæˆåé‡å¯VS Codeï¼ŒæŒ‰ç…§æç¤ºå®‰è£…å³å¯ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafka</title>
      <link href="2021/09/26/kafka/"/>
      <url>2021/09/26/kafka/</url>
      
        <content type="html"><![CDATA[<h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><h2 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h2><p>ä¸ºä»€ä¹ˆé€‰æ‹©kafkaï¼Ÿ</p><ol><li>å¤šç”Ÿäº§è€…å’Œå¤šæ¶ˆè´¹è€…ã€‚</li><li>åŸºäºç£ç›˜çš„æ•°æ®å­˜å‚¨ã€‚</li><li>é«˜ä¼¸ç¼©æ€§ã€‚</li><li>é«˜æ€§èƒ½ã€‚</li></ol><p>å¸¸è§åœºæ™¯ï¼š</p><h3 id="1-1-offsetåç§»é‡"><a href="#1-1-offsetåç§»é‡" class="headerlink" title="1.1 offsetåç§»é‡"></a>1.1 offsetåç§»é‡</h3><ul><li>å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯</li><li>åç§»é‡å†³å®šè¯»å–æ•°æ®çš„ä½ç½®ï¼Œä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ¶ˆè´¹è€…é€šè¿‡åç§»é‡æ¥å†³å®šä¸‹æ¬¡è¯»å–çš„æ¶ˆæ¯ã€‚</li><li>æ¶ˆæ¯è¢«æ¶ˆè´¹ä¹‹åï¼Œå¹¶ä¸è¢«é©¬ä¸Šåˆ é™¤ï¼Œè¿™æ ·å¤šä¸ªä¸šåŠ¡å°±å¯ä»¥é‡å¤ä½¿ç”¨kafkaçš„æ¶ˆæ¯ã€‚</li><li>æŸä¸€ä¸ªä¸šåŠ¡å¯ä»¥é€šè¿‡ä¿®æ”¹åç§»é‡æ¥è¾¾åˆ°é‡æ–°è¯»å–æ¶ˆæ¯çš„ç›®çš„ï¼Œåç§»é‡ç”±ç”¨æˆ·æ§åˆ¶ã€‚</li><li>æ¶ˆæ¯æœ€ç»ˆè¿˜æ˜¯ä¼šè¢«åˆ é™¤çš„ï¼Œé»˜è®¤ç”Ÿå‘½å‘¨æœŸæ˜¯1å‘¨ï¼ˆ7 * 24 = 168 å°æ—¶ï¼‰</li></ul><h3 id="1-2-Kafkaæ•°æ®æ£€ç´¢æœºåˆ¶"><a href="#1-2-Kafkaæ•°æ®æ£€ç´¢æœºåˆ¶" class="headerlink" title="1.2 Kafkaæ•°æ®æ£€ç´¢æœºåˆ¶"></a>1.2 Kafkaæ•°æ®æ£€ç´¢æœºåˆ¶</h3><ul><li><p>topicåœ¨ç‰©ç†å±‚ä»¥partitionä¸ºåˆ†ç»„ï¼Œä¸€ä¸ªtopicå¯ä»¥åˆ†æˆè‹¥å¹²ä¸ªpartitionã€‚</p></li><li><p>partitionè¿˜å¯ä»¥ç»†åˆ†ä¸ºSegmentï¼Œä¸€ä¸ªpartitionç‰©ç†ä¸Šç”±å¤šä¸ªSegmentç»„æˆã€‚</p><ul><li>segmentçš„å‚æ•°æœ‰ä¸¤ä¸ªï¼š<ul><li>log.segment.bytes: å•ä¸ªsegmentå¯å®¹çº³æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤ä¸º1GB</li><li>log.segment.ms: Kafkaåœ¨commitä¸€ä¸ªæœªå†™æ»¡çš„segmentå‰ï¼Œæ‰€ç­‰å¾…çš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º7å¤©ï¼‰</li></ul></li></ul></li><li><p>LogSegment æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«ä¸ºâ€œ.indexâ€å’Œâ€.logâ€æ–‡ä»¶ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸ºSegmentç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶ã€‚</p><ul><li><p>partitionå…¨å±€çš„ç¬¬ä¸€ä¸ªsegmentä»0å¼€å§‹ï¼Œåç»­æ¯ä¸ªsegmentæ–‡ä»¶åä¸ºä¸Šä¸€ä¸ªsegmentæ–‡ä»¶æœ€åä¸€æ¡æ¶ˆæ¯çš„offsetå€¼</p></li><li><p>æ•°å€¼å¤§å°ä¸º64ä½ï¼Œ20ä½æ•°å­—å­—ç¬¦é•¿åº¦ï¼Œæ²¡æœ‰æ•°å­—ç”¨0å¡«å……</p></li><li><p>```<br>ç¬¬ä¸€ä¸ªsegment<br>00000000000000000000.index<br>00000000000000000000.log<br>ç¬¬äºŒä¸ªsegmentï¼Œæ–‡ä»¶å‘½åä»¥ç¬¬ä¸€ä¸ªsegmentçš„æœ€åä¸€æ¡æ¶ˆæ¯çš„offsetç»„æˆ<br>00000000000000170410.index<br>00000000000000170410.log<br>ç¬¬ä¸‰ä¸ªsegmentï¼Œæ–‡ä»¶å‘½åä»¥ä¸Šä¸€ä¸ªsegmentçš„æœ€åä¸€æ¡æ¶ˆæ¯çš„offsetç»„æˆ<br>00000000000000239430.index<br>00000000000000239430.log</p><pre class="line-numbers language-none"><code class="language-none">    æ¶ˆæ¯éƒ½æœ‰å›ºå®šçš„ç‰©ç†ç»“æ„ï¼ŒåŒ…æ‹¬ï¼šoffset(8 Bytes)ã€æ¶ˆæ¯ä½“çš„å¤§å°ï¼ˆ4 Bytesï¼‰ã€magicï¼ˆ1Byteï¼‰ç­‰ç­‰ï¼Œç¡®å®šä¸€æ¡æ¶ˆæ¯çš„å¤§å°ï¼Œå³è¯»å–åˆ°å“ªé‡Œæˆªæ­¢ã€‚    ![image-20211008154829701](C:\Users\Shawn\AppData\Roaming\Typora\typora-user-images\image-20211008154829701.png)## 2. MQæµæ´¾### 2.1 æœ‰Brokerçš„MQè¿™ä¸ªæµæ´¾é€šå¸¸æœ‰ä¸€å°æœåŠ¡å™¨ä½œä¸ºBrokerï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½é€šè¿‡å®ƒä¸­è½¬ã€‚ç”Ÿäº§è€…æŠŠæ¶ˆæ¯å‘é€ç»™å®ƒå°±ç»“æŸè‡ªå·±çš„ä»»åŠ¡äº†ï¼ŒBrokeråˆ™æŠŠæ¶ˆæ¯ä¸»åŠ¨æ¨é€ç»™æ¶ˆè´¹è€…ï¼ˆæˆ–è€…æ¶ˆè´¹è€…ä¸»åŠ¨è½®è¯¢ï¼‰ã€‚#### 2.1.1 é‡topickafkaã€JMSï¼ˆActiveMQ)å°±å±äºè¿™ä¸ªæµæ´¾ï¼Œç”Ÿäº§è€…ä¼šå‘é€keyå’Œæ•°æ®åˆ°Brokerï¼Œç”±Brokeræ¯”è¾ƒkeyä¹‹åå†³å®šç»™å“ªä¸ªæ¶ˆè´¹è€…ã€‚è¿™ç§æ¨¡å¼æ˜¯æˆ‘ä»¬å¸¸è§çš„æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹topicæ˜¯ä¸€ç§æ¯”è¾ƒå¤§çš„æ¦‚å¿µï¼Œç”šè‡³ä¸€ä¸ªç³»ç»Ÿä¸­å°±å¯èƒ½åªæœ‰ä¸€ä¸ªtopicï¼ŒtopicæŸç§æ„ä¹‰ä¸Šè¯´å°±æ˜¯queueï¼Œç”Ÿäº§è€…å‘é€keyç›¸å½“äºè¯´ï¼šâ€œhiï¼ŒæŠŠæ•°æ®æ”¾åˆ°keyçš„é˜Ÿåˆ—ä¸­â€ã€‚![image-20211009144759734](D:\1\blog\source\_posts\kafka\image-20211009144759734.png)### 2.1.2 è½»topicRabbitMQï¼ˆæˆ–è€…AMQPï¼‰ã€‚ç”Ÿäº§è€…å‘é€keyå’Œæ•°æ®ï¼Œæ¶ˆè´¹è€…å®šä¹‰è®¢é˜…çš„é˜Ÿåˆ—ï¼ŒBrokeræ”¶åˆ°æ•°æ®åä¼šé€šè¿‡ä¸€å®šçš„é€»è¾‘è®¡ç®—å‡ºkeyå¯¹åº”çš„é˜Ÿåˆ—ï¼Œç„¶åæŠŠæ•°æ®äº¤ç»™é˜Ÿåˆ—ã€‚![image-20211009145036134](D:\1\blog\source\_posts\kafka\image-20211009145036134.png)topicåªæ˜¯ä¸€ç§ä¸­è½¬çš„æ¨¡å¼ã€‚## 3. æ¶ˆæ¯#### 3.1 å•æ’­æ¶ˆæ¯åœ¨ä¸€ä¸ªkafkaçš„topicä¸­ï¼Œå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªç”Ÿäº§è€…ã€‚è¿™æ¡æ¶ˆæ¯æ˜¯å¦ä¼šè¢«ä¸¤ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Ÿå¦‚æœå¤šä¸ªæ¶ˆè´¹è€…åœ¨åŒä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ”¶åˆ°è®¢é˜…çš„topicä¸­çš„æ¶ˆæ¯ã€‚æ¢è¨€ä¹‹ï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ”¶åˆ°ä¸€ä¸ªtopicçš„æ¶ˆæ¯ã€‚#### 3.2 å¤šæ’­æ¶ˆæ¯ä¸åŒçš„æ¶ˆè´¹ç»„è®¢é˜…åŒä¸€ä¸ªtopicï¼Œé‚£ä¹ˆä¸åŒçš„æ¶ˆè´¹ç»„ä¸­åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…èƒ½å¤Ÿæ”¶åˆ°æ¶ˆæ¯ã€‚é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ¶ˆè´¹ç»„çš„ä¿¡æ¯ï¼š<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>./kafka-consumer-groups.sh â€“bootstrap-server 172.16.253.38:9092 â€“describe â€“group testGroup</p><pre class="line-numbers language-none"><code class="language-none">## 4.åŸºæœ¬æ¦‚å¿µ ![image-20211009210848040](D:\1\blog\source\_posts\kafka\image-20211009210848040.png)ä¸€ä¸ªä¸»é¢˜ä¸­çš„æ¶ˆæ¯é‡æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤å¯ä»¥é€šè¿‡åˆ†åŒºçš„è®¾ç½®ï¼Œæ¥åˆ†å¸ƒå¼å­˜å‚¨è¿™äº›æ¶ˆæ¯ã€‚æ¯”å¦‚ä¸€ä¸ªtopicåˆ›å»ºäº†3ä¸ªåˆ†åŒºï¼Œé‚£ä¹ˆtopicä¸­çš„æ¶ˆæ¯å°±ä¼šè¢«åˆ†åˆ«å­˜æ”¾åœ¨3ä¸ªåˆ†åŒºä¸­ã€‚ä¸€ä¸ªä¸»é¢˜åˆ›å»ºå¤šä¸ªåˆ†åŒºï¼š<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>kafka-topics.sh â€“create â€“zookeeper localhost:2181 â€“replication-factor 1 â€“partition 2 â€“topic testGroups</p><pre class="line-numbers language-none"><code class="language-none">#### 4.1 kafkaä¸­æ¶ˆæ¯æ—¥å¿—æ–‡ä»¶ä¸­ä¿å­˜çš„å†…å®¹* 00000.logï¼šè¿™ä¸ªæ–‡ä»¶ä¸­ä¿å­˜çš„å°±æ˜¯æ¶ˆæ¯ã€‚* _consumer_offset-49: kafkaå†…éƒ¨åˆ›å»ºäº†_consumer_offsetä¸»é¢˜åŒ…å«äº†50ä¸ªåˆ†åŒºã€‚è¿™ä¸ªä¸»é¢˜ç”¨æ¥å­˜æ”¾æ¶ˆè´¹è€…æ¶ˆè´¹æŸä¸ªä¸»é¢˜çš„åç§»é‡ã€‚  * æ¶ˆè´¹è€…å®šæœŸå°†è‡ªå·±æ¶ˆè´¹çš„offsetæäº¤ç»™kafkaå†…éƒ¨topicï¼š_consumer_offsetsï¼Œæäº¤è¿‡å»çš„æ—¶å€™ï¼Œkeyæ˜¯consumerGroupId+topic + åˆ†åŒºå·ï¼Œvalueå°±æ˜¯å½“å‰offsetçš„å€¼ï¼Œkafkaä¼šå®šæœŸæ¸…ç†topicé‡Œçš„æ¶ˆæ¯ï¼Œç»„åä¿ç•™æœ€æ–°çš„é‚£æ¡æ•°æ®ã€‚  * å› ä¸º_consumer_offsetså¯èƒ½ä¼šæ¥æ”¶é«˜å¹¶å‘çš„è¯·æ±‚ï¼Œkafkaé»˜è®¤ç»™å…¶åˆ†é…50ä¸ªåˆ†åŒºï¼ˆå¯ä»¥é€šè¿‡offset.topic.num.partitionsè®¾ç½®ï¼‰ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡åŠ æœºå™¨çš„æ–¹å¼æŠ—ä½å¤§å¹¶å‘ã€‚  * é€šè¿‡å¦‚ä¸‹å…¬å¼é€‰å‡ºconsumeræ¶ˆè´¹çš„offsetè¦æäº¤åˆ°_consumer_offsetçš„å“ªä¸ªåˆ†åŒºï¼š    å…¬å¼ï¼šhash(consumerGoupId)%_consumer_offsetsä¸»é¢˜çš„åˆ†åŒºæ•°  #### 4.2 å‰¯æœ¬çš„æ¦‚å¿µ    å‰¯æœ¬æ˜¯å¯¹åˆ†åŒºçš„å¤‡ä»½ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œä¸åŒçš„å‰¯æœ¬ä¼šè¢«éƒ¨ç½²åœ¨ä¸åŒçš„brokerä¸Šã€‚ä¸‹é¢çš„ä¾‹å­ï¼šåˆ›å»º1ä¸ªä¸»é¢˜ï¼Œ2ä¸ªåˆ†åŒºï¼Œ3ä¸ªå‰¯æœ¬ã€‚    ```bash  ./kafka-topic.sh --create --zookeeper localhost:2181 --replication-factor 3 --partitions 2 --topic my-replicated-topic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><img src="/2021/09/26/kafka/1\blog\source_posts\kafka\image-20211010110637908.png" alt="image-20211010110637908"></p><ul><li><p>isrï¼š</p><p>å¯ä»¥åŒæ­¥çš„brokerèŠ‚ç‚¹å’Œå·²ç»åŒæ­¥çš„brokerèŠ‚ç‚¹ï¼Œæ”¾åœ¨isré›†åˆä¸­ã€‚</p></li></ul></li></ul><p>æ€»ç»“ï¼šé›†ç¾¤ä¸­æœ‰å¤šä¸ªbrokerï¼Œåˆ›å»ºä¸»é¢˜æ—¶å¯ä»¥æŒ‡æ˜ä¸»é¢˜æœ‰å¤šä¸ªåˆ†åŒºï¼ˆæŠŠæ¶ˆæ¯æ‹†åˆ†åˆ°ä¸åŒçš„åˆ†åŒºä¸­å­˜å‚¨ï¼‰ï¼Œå¯ä»¥ä¸ºåˆ†åŒºåˆ›å»ºå¤šä¸ªå‰¯æœ¬ï¼Œä¸åŒçš„å‰¯æœ¬å­˜æ”¾åœ¨ä¸åŒçš„brokeré‡Œã€‚</p><h2 id="5-Kafkaé›†ç¾¤æ¶ˆæ¯çš„æ¶ˆè´¹"><a href="#5-Kafkaé›†ç¾¤æ¶ˆæ¯çš„æ¶ˆè´¹" class="headerlink" title="5. Kafkaé›†ç¾¤æ¶ˆæ¯çš„æ¶ˆè´¹"></a>5. Kafkaé›†ç¾¤æ¶ˆæ¯çš„æ¶ˆè´¹</h2><p>ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./kafka-console-producer.sh --broker-list localhost:9092,localhost:9093,localhost:9094 --topic my-replicated-topic<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”Ÿäº§è€…æ¶ˆè´¹æ¶ˆæ¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./kafka-console-consumer.sh --bootstrap-server localhost:9092,localhost:9093,localhost:9094 --from-beginning --topic my-replicated-topic<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ†åŒºåˆ†æ¶ˆè´¹ç»„çš„é›†ç¾¤æ¶ˆæ¯ä¸­çš„ç»†èŠ‚ï¼š</p><p><img src="/2021/09/26/kafka/1\blog\source_posts\kafka\image-20211010113414524.png" alt="image-20211010113414524"></p><p>å¦‚æœæ¶ˆè´¹è€…æŒ‚äº†ï¼Œä¼šè§¦å‘rebalanceæœºåˆ¶ï¼Œè®©å…¶ä»–æ¶ˆè´¹è€…æ¥æ¶ˆè´¹è¯¥åˆ†åŒºã€‚</p><h4 id="5-1-åŒæ­¥å‘é€æ¶ˆæ¯"><a href="#5-1-åŒæ­¥å‘é€æ¶ˆæ¯" class="headerlink" title="5.1 åŒæ­¥å‘é€æ¶ˆæ¯"></a>5.1 åŒæ­¥å‘é€æ¶ˆæ¯</h4><p><img src="/2021/09/26/kafka/1\blog\source_posts\kafka\image-20211010202240336.png" alt="image-20211010202240336"></p><h4 id="5-2-å¼‚æ­¥å‘é€æ¶ˆæ¯"><a href="#5-2-å¼‚æ­¥å‘é€æ¶ˆæ¯" class="headerlink" title="5.2 å¼‚æ­¥å‘é€æ¶ˆæ¯"></a>5.2 å¼‚æ­¥å‘é€æ¶ˆæ¯</h4><p>å¼‚æ­¥å°±æ˜¯æœ‰äº†ä¸€ä¸ªå›è°ƒï¼Œä½†æ˜¯å¼‚æ­¥æ–¹å¼ä¼šä¸¢å¤±æ•°æ®ã€‚å¹³å¸¸ä¸€èˆ¬éƒ½æ˜¯ä¼šä½¿ç”¨åŒæ­¥æ–¹å¼è¿›è¡Œå‘é€ã€‚</p><p><img src="/2021/09/26/kafka/1\blog\source_posts\kafka\image-20211010203700110.png" alt="image-20211010203700110"></p><ul><li>kafkaé»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ç¼“å†²åŒºï¼Œç”¨æ¥å­˜æ”¾è¦å‘é€çš„æ•°æ®ï¼Œç¼“å†²åŒºæ˜¯32m</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java">props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span>BUFFER_MEMORY_CONFIG<span class="token punctuation">,</span> <span class="token number">33554432</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>kafkaæœ¬åœ°çº¿ç¨‹ä¼šå»ç¼“å†²åŒºä¸€æ¬¡æ‹‰16kçš„æ•°æ®ï¼Œå‘é€åˆ°broker</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java">props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span>BATCH_SIZE_CONFIG<span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="5-3-æäº¤offset"><a href="#5-3-æäº¤offset" class="headerlink" title="5.3 æäº¤offset"></a>5.3 æäº¤offset</h4><ul><li>è‡ªåŠ¨æäº¤</li></ul><p><img src="/2021/09/26/kafka/1\blog\source_posts\kafka\image-20211010211840464.png" alt="image-20211010211840464"></p><p>pullæ¶ˆæ¯ï¼Œpullæ¶ˆæ¯ä¸‹æ¥ä¹‹åï¼Œç«‹é©¬ç›´æ¥æäº¤offsetã€‚</p><ul><li>æ‰‹åŠ¨æäº¤</li></ul><p>ä½ æ¶ˆè´¹æ—¶æˆ–è€…æ¶ˆè´¹åå†æäº¤offset</p><p><img src="/2021/09/26/kafka/1\blog\source_posts\kafka\image-20211010212041257.png" alt="image-20211010212041257"></p><ul><li>æ‰‹åŠ¨æäº¤offsetæäº¤å‚æ•°</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java">props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>ENABLE_AUTO_COMMIT_CONFIG<span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>åœ¨æ¶ˆè´¹å®Œæ¶ˆæ¯åè¿›è¡Œæ‰‹åŠ¨æäº¤</p><ul><li><p>æ‰‹åŠ¨åŒæ­¥æäº¤</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>records<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// æ‰‹åŠ¨åŒæ­¥æäº¤offsetï¼Œå½“å‰çº¿ç¨‹ä¼šé˜»å¡ç›´åˆ°offsetæäº¤æˆåŠŸ</span>    <span class="token comment">// ä¸€èˆ¬ä½¿ç”¨åŒæ­¥æäº¤ï¼Œå› ä¸ºæäº¤åä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆé€»è¾‘ä»£ç äº†</span>    consuemr<span class="token punctuation">.</span><span class="token function">commitSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ‰‹åŠ¨å¼‚æ­¥æäº¤</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">    ```<span class="token operator">*</span> æäº¤çš„å†…å®¹æ¶ˆè´¹è€…æ— è®ºæ˜¯è‡ªåŠ¨æäº¤è¿˜æ˜¯æ‰‹åŠ¨æäº¤ï¼Œéƒ½éœ€è¦æŠŠæ‰€å±çš„æ¶ˆè´¹ç»„ <span class="token operator">+</span> æ¶ˆè´¹çš„æŸä¸ªä¸»é¢˜ <span class="token operator">+</span> æ¶ˆè´¹çš„æŸä¸ªåˆ†åŒºåŠæ¶ˆè´¹çš„åç§»é‡ï¼Œè¿™æ ·çš„ä¿¡æ¯æäº¤åˆ°é›†ç¾¤çš„ä¸»é¢˜é‡Œçš„_consumer_offsetsä¸»é¢˜é‡Œé¢ã€‚#### <span class="token number">5.4</span> æ¶ˆè´¹è€…pollæ¶ˆæ¯<span class="token operator">*</span> æ¶ˆè´¹è€…å»ºç«‹äº†ä¸brokerä¹‹é—´çš„é•¿è¿æ¥ï¼Œå¼€å§‹pollæ¶ˆæ¯ã€‚<span class="token operator">*</span> é»˜è®¤ä¸€æ¬¡poll500æ¡æ¶ˆæ¯```javaprops<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>MAX_POLL_RECORDS_CONFIG<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><p>å¯ä»¥æ ¹æ®æ¶ˆè´¹é€Ÿåº¦çš„å¿«æ…¢æ¥è®¾ç½®ï¼Œå› ä¸ºå¦‚æœä¸¤æ¬¡pollçš„æ—¶é—´è¶…å‡ºäº†30sçš„æ—¶é—´ä»·æ ¼ï¼Œkafkaä¼šè®¤ä¸ºå…¶æ¶ˆè´¹èƒ½åŠ›è¿‡å¼±ï¼Œå°†å…¶æå‡ºæ¶ˆè´¹ç»„ã€‚å°†åˆ†åŒºåˆ†é…ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚</p><p>å¯ä»¥é€šè¿‡è¿™ä¸ªå€¼è¿›è¡Œé…ç½®ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>MAX_POLL_INTERVAL_MS_CONFIG<span class="token punctuation">,</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å¦‚æœ1så†…æ¯éš”1så†…æ²¡æœ‰pollåˆ°ä»»ä½•æ¶ˆæ¯ï¼Œåˆ™ç»§ç»­å»pollæ¶ˆæ¯ï¼Œå¾ªç¯å¾€å¤ï¼Œç›´åˆ°pollåˆ°æ¶ˆæ¯ã€‚å¦‚æœè¶…å‡ºäº†1sï¼Œåˆ™æ­¤æ¬¡é•¿è½®è¯¢ç»“æŸã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ¶ˆè´¹è€…å‘é€å¿ƒè·³çš„é—´éš”</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java">props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>HEARTBEAT_INTERVAL_MS_CONFIG<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>kafkaå¦‚æœè¶…è¿‡10ç§’æ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„å¿ƒè·³ï¼Œåˆ™ä¼šæŠŠæ¶ˆè´¹æå‡ºæ¶ˆè´¹ç»„ï¼Œè¿›è¡Œrebalanceï¼ŒæŠŠåˆ†åŒºåˆ†é…ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java">props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span>SESSION_TIMEOUT_MS_CONFIG<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="5-5-æŒ‡å®šåˆ†åŒºå’Œåç§»é‡ã€æ—¶é—´æ¶ˆè´¹"><a href="#5-5-æŒ‡å®šåˆ†åŒºå’Œåç§»é‡ã€æ—¶é—´æ¶ˆè´¹" class="headerlink" title="5.5 æŒ‡å®šåˆ†åŒºå’Œåç§»é‡ã€æ—¶é—´æ¶ˆè´¹"></a>5.5 æŒ‡å®šåˆ†åŒºå’Œåç§»é‡ã€æ—¶é—´æ¶ˆè´¹</h4><ul><li>æŒ‡å®šåˆ†åŒºæ¶ˆè´¹</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java">consumer<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span>TOPIC_NAME<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ä»å¤´æ¶ˆè´¹</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java">consumer<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span>TOPIC_NAME<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>consumer<span class="token punctuation">.</span><span class="token function">seekToBeginning</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span>TOPIC_NAME<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æŒ‡å®šoffsetæ¶ˆè´¹</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java">consumer<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span>TOPIC_NAME<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>consumer<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span>TOPIC_NAME<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æŒ‡å®šæ—¶é—´æ¥æ¶ˆè´¹</li></ul><p>æ ¹æ®æ—¶é—´ï¼Œå»æ‰€æœ‰çš„partitionä¸­ç¡®å®šè¯¥äº‹ä»¶å¯¹åº”çš„offsetï¼Œç„¶åå»æ‰€æœ‰çš„partitionä¸­æ‰¾åˆ°è¯¥offsetçš„ä¹‹åçš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">```#### <span class="token number">5.6</span> æ–°æ¶ˆè´¹ç»„çš„åç§»é‡å¦‚æœè®¾ç½®äº†<span class="token string">"earlier"</span>ã€‚æ‰¾è¿™ä¸ªæ¶ˆè´¹ç»„æœ€è¿‘ä¸€æ¬¡æ¶ˆè´¹çš„offsetä½ç½®ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–°çš„æ¶ˆè´¹ç»„åªä¼šæ”¶åˆ°æ–°å‘çš„åŠ å…¥æ—¶é—´ä¹‹åå‘é€çš„æ¶ˆæ¯ã€‚## <span class="token number">6.</span> springboot ä¸­ä½¿ç”¨kafka#### <span class="token number">6.1</span> å¼•å…¥ä¾èµ–```xml<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>kafka<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>kafka<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-2-ç¼–å†™é…ç½®æ–‡ä»¶"><a href="#6-2-ç¼–å†™é…ç½®æ–‡ä»¶" class="headerlink" title="6.2 ç¼–å†™é…ç½®æ–‡ä»¶"></a>6.2 ç¼–å†™é…ç½®æ–‡ä»¶</h4><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>    <span class="token key atrule">bootstrap-servers</span><span class="token punctuation">:</span> 172.16.2.11<span class="token punctuation">:</span><span class="token number">9092</span>    <span class="token key atrule">producer</span><span class="token punctuation">:</span>      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment"># è®¾ç½®å¤§äº0çš„å€¼ï¼Œåˆ™å®¢æˆ·ç«¯ä¼šå°†å‘é€å¤±è´¥çš„è®°å½•é‡æ–°å‘é€</span>      <span class="token key atrule">batch-size</span><span class="token punctuation">:</span> <span class="token number">16384</span>      <span class="token key atrule">buffer-memory</span><span class="token punctuation">:</span> <span class="token number">33554432</span>      <span class="token key atrule">acks</span><span class="token punctuation">:</span> <span class="token number">1</span>      <span class="token comment"># æŒ‡å®šæ¶ˆæ¯keyå’Œæ¶ˆæ¯ä½“çš„ç¼–è§£ç æ–¹å¼</span>      <span class="token key atrule">key-serializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringSerializer      <span class="token key atrule">value-serializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringSerializer    <span class="token key atrule">consumer</span><span class="token punctuation">:</span>      <span class="token key atrule">group-id</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>group      <span class="token key atrule">enable-auto-commit</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token key atrule">auto-offset-reset</span><span class="token punctuation">:</span> earliest      <span class="token key atrule">key-deserializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringDeserializer      <span class="token key atrule">value-deserializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringDeserializer      <span class="token key atrule">max-poll-records</span><span class="token punctuation">:</span> <span class="token number">500</span>    <span class="token key atrule">listener</span><span class="token punctuation">:</span>      <span class="token key atrule">ack-mode</span><span class="token punctuation">:</span> MANUAL_IMMEDIATE    <span class="token comment"># æ¯å½“ä¸€æ¡è®°å½•è¢«æ¶ˆè´¹è€…ç›‘å¬å¤„ç†ä¹‹åæäº¤</span>      <span class="token comment"># RECORD</span>      <span class="token comment"># å½“æ¯ä¸€æ‰¹pollï¼ˆï¼‰çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumer)å¤„ç†ä¹‹åæäº¤</span>      <span class="token comment"># BATCH</span>      <span class="token comment"># æ¯å½“ä¸€æ‰¹pollï¼ˆï¼‰çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨(ListenerConsumer)å¤„ç†ä¹‹åï¼Œè¢«å¤„ç†çš„recordæ•°é‡å¤§äºCOUNTæ—¶æäº¤</span>      <span class="token comment"># COUNT</span>      <span class="token comment"># TIME | COUNT æœ‰ä¸€ä¸ªæ¡ä»¶æ»¡è¶³æ—¶æäº¤</span>      <span class="token comment"># æ‰‹åŠ¨è°ƒç”¨Acknowledge.acknowledge()åç«‹å³æäº¤ï¼Œä¸€èˆ¬ä½¿ç”¨è¿™ç§</span>      <span class="token comment"># MANUAL_IMMEDIATE</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-3-æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#6-3-æ¶ˆæ¯ç”Ÿäº§è€…" class="headerlink" title="6.3 æ¶ˆæ¯ç”Ÿäº§è€…"></a>6.3 æ¶ˆæ¯ç”Ÿäº§è€…</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/msg"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyKafkaController</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TOPIC_NAME <span class="token operator">=</span> <span class="token string">"my-replicated-topic"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">KafkaTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setKafkaTemplate</span><span class="token punctuation">(</span><span class="token class-name">KafkaTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>kafkaTemplate <span class="token operator">=</span> kafkaTemplate<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/send"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>TOPIC_NAME<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"key"</span><span class="token punctuation">,</span> <span class="token string">"This is a message!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"send success!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-4-ç¼–å†™æ¶ˆè´¹è€…"><a href="#6-4-ç¼–å†™æ¶ˆè´¹è€…" class="headerlink" title="6.4 ç¼–å†™æ¶ˆè´¹è€…"></a>6.4 ç¼–å†™æ¶ˆè´¹è€…</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConsumer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">"my-replicated-topic"</span><span class="token punctuation">,</span> groupId <span class="token operator">=</span> <span class="token string">"MyGroup1"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenGroup</span><span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">record</span><span class="token punctuation">,</span> <span class="token class-name">Acknowledgment</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰‹åŠ¨æäº¤offset</span>        ack<span class="token punctuation">.</span><span class="token function">acknowledge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-Kafkaé›†ç¾¤Controllerã€Rebalanceå’ŒHW"><a href="#7-Kafkaé›†ç¾¤Controllerã€Rebalanceå’ŒHW" class="headerlink" title="7. Kafkaé›†ç¾¤Controllerã€Rebalanceå’ŒHW"></a>7. Kafkaé›†ç¾¤Controllerã€Rebalanceå’ŒHW</h2><h3 id="7-1-Controller"><a href="#7-1-Controller" class="headerlink" title="7.1 Controller"></a>7.1 Controller</h3><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><p>ä¸€ä¸ªåˆ†åŒºæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œè¿™äº›å‰¯æœ¬é‡Œé¢æœ‰ä¸€ä¸ªleaderã€‚ä½†æ˜¯å½“leaderæŒ‚äº†ï¼Œè°æ¥é€‰ä¸¾å‘¢ï¼Ÿæ‰€ä»¥éœ€è¦controllerã€‚  </p><p>kafkaé›†ç¾¤ä¸­çš„brokeråœ¨zkä¸­åˆ›å»ºä¸´æ—¶åºå·èŠ‚ç‚¹ï¼Œåºå·æœ€å°çš„èŠ‚ç‚¹ï¼ˆæœ€å…ˆåˆ›å»ºçš„èŠ‚ç‚¹ï¼‰å°†ä½œä¸ºé›†ç¾¤çš„controllerï¼Œè´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰åˆ†åŒºå’Œå‰¯æœ¬çš„çŠ¶æ€ã€‚</p><ul><li>å½“æŸä¸ªåˆ†åŒºçš„leaderå‰¯æœ¬å‡ºç°æ•…éšœæ—¶ï¼Œç”±æ§åˆ¶å™¨è´Ÿè´£ä¸ºè¯¥åˆ†åŒºé€‰ä¸¾æ–°çš„leaderå‰¯æœ¬ã€‚é€‰ä¸¾çš„è§„åˆ™æ˜¯ä»isré›†åˆä¸­æœ€å·¦è¾¹è·å¾—ã€‚</li><li>å½“æ£€æµ‹åˆ°æŸä¸ªåˆ†åŒºçš„ISRé›†åˆå‘ç”Ÿå˜åŒ–æ—¶ï¼Œç”±æ§åˆ¶å™¨è´Ÿè´£é€šçŸ¥æ‰€æœ‰brokeræ›´æ–°å…¶å…ƒæ•°æ®ä¿¡æ¯ã€‚</li><li>å½“ä½¿ç”¨kafka-topic.shè„šæœ¬ä¸ºæŸä¸ªtopicå¢åŠ åˆ†åŒºæ•°é‡æ—¶ï¼ŒåŒæ ·è¿˜æ˜¯ç”±æ§åˆ¶å™¨è´Ÿè´£è®©æ–°åˆ†åŒºè¢«å…¶ä»–èŠ‚ç‚¹æ„ŸçŸ¥åˆ°ã€‚</li></ul><h3 id="7-2-rebalanceæœºåˆ¶"><a href="#7-2-rebalanceæœºåˆ¶" class="headerlink" title="7.2 rebalanceæœºåˆ¶"></a>7.2 rebalanceæœºåˆ¶</h3><p><img src="/2021/09/26/kafka/1\blog\source_posts\kafka\image-20211011165524387.png" alt="image-20211011165524387"></p><p>æ¶ˆè´¹è€…æŒ‚äº†æˆ–è€…æ¶ˆè´¹è€…æ–°åŠ å…¥ï¼Œéƒ½ä¼šå‡ºå‘rebalanceæœºåˆ¶ã€‚æœ¬è´¨ä¸Šæ˜¯ç”±äºæ¶ˆè´¹è€…æ²¡æœ‰æŒ‡æ˜åˆ†åŒºæ¶ˆè´¹æˆ–è€…åˆ†åŒºæ²¡æœ‰è¢«ä»»ä½•æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</p><p>è¿™ä¸ªæœºåˆ¶ä¼šé‡æ–°è°ƒæ•´æ¶ˆè´¹è€…æ¶ˆè´¹å“ªä¸ªåˆ†åŒºã€‚</p><p>å‡ºå‘rebalanceåˆ†åŒºç­–ç•¥ï¼š</p><ul><li>range é€šè¿‡å…¬å¼è®¡ç®—æŸä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹å“ªä¸ªåˆ†åŒºã€‚ï¼ˆåˆ†åŒºæ€»æ•°/n ï¼ˆnæ˜¯æ¶ˆè´¹è€…ä¸ªæ•°ï¼Œä½†æ¯”å¦‚10/3 = 3 ä½™ 1 ï¼Œé™¤ä¸å°½ï¼Œé‚£ä¹ˆ æ¶ˆè´¹è€… C1-0 ï¼ˆç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰ä¾¿ä¼šå¤šæ¶ˆè´¹ 1 ä¸ªåˆ†åŒºï¼šï¼‰)<ul><li>å¼Šç«¯ï¼šå¦‚ä¸Šï¼Œåªæ˜¯é’ˆå¯¹ 1 ä¸ª topic è€Œè¨€ï¼ŒC1-0æ¶ˆè´¹è€…å¤šæ¶ˆè´¹1ä¸ªåˆ†åŒºå½±å“ä¸æ˜¯å¾ˆå¤§ã€‚å¦‚æœæœ‰ N å¤šä¸ª topicï¼Œé‚£ä¹ˆé’ˆå¯¹æ¯ä¸ª topicï¼Œæ¶ˆè´¹è€… C1-0 éƒ½å°†å¤šæ¶ˆè´¹ 1 ä¸ªåˆ†åŒºï¼Œtopicè¶Šå¤šï¼ŒC1-0 æ¶ˆè´¹çš„åˆ†åŒºä¼šæ¯”å…¶ä»–æ¶ˆè´¹è€…æ˜æ˜¾å¤šæ¶ˆè´¹ N ä¸ªåˆ†åŒºã€‚è¿™å°±æ˜¯ Range èŒƒå›´åˆ†åŒºçš„ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å¼Šç«¯äº†ã€‚</li></ul></li><li>è½®è¯¢ï¼šå¤§å®¶è½®ç€æ¶ˆè´¹ã€‚ è§¦å‘ä¹‹åéœ€è¦é‡æ–°åˆ†é…ï¼Œè€—è´¹æ€§èƒ½ã€‚</li><li>stickyï¼šè§¦å‘äº†rebalanceåï¼Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹çš„åŸåˆ†åŒºä¸å˜çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚</li></ul><h3 id="7-3-HW"><a href="#7-3-HW" class="headerlink" title="7.3 HW"></a>7.3 HW</h3><p>HWä¿—ç§°é«˜æ°´ä½ï¼ŒHighWatermarkçš„ç¼©å†™ï¼Œå–ä¸€ä¸ªpartitionå¯¹åº”çš„ISRä¸­æœ€å°çš„LEOï¼ˆlog-end-offset)ä½œä¸ºHWï¼Œconsumeræœ€å¤šåªèƒ½æ¶ˆè´¹åˆ°HWæ‰€åœ¨çš„ä½ç½®ã€‚å¦å¤–æ¯ä¸ªreplicaéƒ½æœ‰HWï¼Œleaderå’Œfollwerå„è‡ªè´Ÿè´£æ›´æ–°è‡ªå·±çš„HWçš„çŠ¶æ€ã€‚å¯¹äºleaderæ–°å†™å…¥çš„æ¶ˆæ¯ï¼Œconsumerä¸èƒ½ç«‹åˆ»æ¶ˆè´¹ï¼Œleaderä¼šç­‰å¾…è¯¥æ¶ˆæ¯è¢«æ‰€æœ‰ISRä¸­çš„replicasåŒæ­¥åæ›´æ–°HWï¼Œæ­¤æ—¶æ¶ˆæ¯æ‰èƒ½è¢«consumeræ¶ˆè´¹ã€‚è¿™æ ·å°±ä¿è¯äº†å¦‚æœleaderæ‰€åœ¨çš„brokerå¤±æ•ˆï¼Œè¯¥æ¶ˆæ¯ä»ç„¶å¯ä»¥ä»æ–°é€‰ä¸¾çš„leaderä¸­è·å–ã€‚</p><h2 id="8-ä¼˜åŒ–"><a href="#8-ä¼˜åŒ–" class="headerlink" title="8. ä¼˜åŒ–"></a>8. ä¼˜åŒ–</h2><h3 id="8-1-å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±"><a href="#8-1-å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±" class="headerlink" title="8.1 å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±"></a>8.1 å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±</h3><ul><li>å‘é€æ–¹ï¼šackæ˜¯1æˆ–è€…-1/all å¯ä»¥é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼Œå¦‚æœè¦åšåˆ°99.9999%ï¼Œackè®¾ç½®ä¸ºallï¼ŒæŠŠmin.insync.replicasé…ç½®æˆåˆ†åŒºå¤‡ä»½æ•°</li><li>æ¶ˆè´¹æ–¹ï¼šæŠŠè‡ªåŠ¨æäº¤æ”¹ä¸ºæ‰‹åŠ¨æäº¤</li></ul><h3 id="8-2-å¦‚ä½•é˜²æ­¢æ¶ˆæ¯é‡å¤æ¶ˆè´¹"><a href="#8-2-å¦‚ä½•é˜²æ­¢æ¶ˆæ¯é‡å¤æ¶ˆè´¹" class="headerlink" title="8.2 å¦‚ä½•é˜²æ­¢æ¶ˆæ¯é‡å¤æ¶ˆè´¹"></a>8.2 å¦‚ä½•é˜²æ­¢æ¶ˆæ¯é‡å¤æ¶ˆè´¹</h3><p>å¦‚æœæŠŠç”Ÿäº§ç«¯çš„é‡è¯•æœºåˆ¶å…³é—­ã€æ¶ˆè´¹ç«¯çš„æ‰‹åŠ¨æäº¤æ”¹æˆè‡ªåŠ¨æäº¤ï¼Œè¿™æ ·åè€Œä¼šæ¶ˆæ¯ä¸¢å¤±ã€‚é‚£ä¹ˆå¯ä»¥åœ¨é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±æ—¶åŠ ä¸Šæ¶ˆè´¹æ¶ˆæ¯çš„å¹‚ç­‰æ€§ä¿è¯ã€‚</p><p>å¹‚ç­‰æ€§ä¿è¯ï¼š</p><ul><li>mysqlæ’å…¥ä¸šåŠ¡idä¸ºä¸»é”®ï¼Œä¸»é”®æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸€æ¬¡åªèƒ½æ’å…¥ä¸€æ¡ã€‚</li><li>ä½¿ç”¨redisæˆ–zkåˆ†å¸ƒå¼é”ï¼ˆä¸»æµçš„æ–¹æ¡ˆï¼‰</li></ul><p><img src="/2021/09/26/kafka/1\blog\source_posts\kafka\image-20211011185818080.png" alt="image-20211011185818080"></p><h3 id="8-3-å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹"><a href="#8-3-å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹" class="headerlink" title="8.3 å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹"></a>8.3 å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹</h3><ul><li>å‘é€æ–¹ï¼š ä½¿ç”¨åŒæ­¥å‘é€ï¼Œç­‰åˆ°å‘é€æˆåŠŸå†å‘é€ä¸‹ä¸€æ¡ï¼Œç¡®ä¿æ¶ˆæ¯æ˜¯é¡ºåºå‘é€çš„ã€‚</li><li>æ¥æ”¶æ–¹ï¼šæ¶ˆæ¯æ˜¯å‘é€ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹ç»„çš„æ¶ˆè´¹è€…æ¥æ¥æ”¶æ¶ˆæ¯ã€‚</li></ul><p>å› æ­¤ï¼Œkafkaçš„é¡ºåºæ¶ˆè´¹ä¼šç‰ºç‰²æ€§èƒ½ã€‚</p><h3 id="8-4-æ¶ˆæ¯ç§¯å‹é—®é¢˜"><a href="#8-4-æ¶ˆæ¯ç§¯å‹é—®é¢˜" class="headerlink" title="8.4 æ¶ˆæ¯ç§¯å‹é—®é¢˜"></a>8.4 æ¶ˆæ¯ç§¯å‹é—®é¢˜</h3><p>è¿™ä¸ªé—®é¢˜ä¼šäº§ç”Ÿï¼šç£ç›˜æ»¡äº†ã€ç”Ÿäº§ç«¯å‘æ¶ˆæ¯å¯¼è‡´kafkaæ€§èƒ½è¿‡æ…¢ï¼Œå®¹æ˜“å‡ºç°æœåŠ¡é›ªå´©ï¼ˆéšç€è¢«æ¶ˆè´¹çš„æ•°æ®å †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ¶ˆè´¹è€…å¯»å€çš„èƒ½åŠ›è¶Šæ¥è¶Šå·®ï¼Œæœ€åå¯¼è‡´æ•´ä¸ªkafkaå¯¹å¤–æä¾›æœåŠ¡çš„æ€§èƒ½å¾ˆå·®ï¼Œä»è€Œé€ æˆå…¶ä»–æœåŠ¡ä¹Ÿè®¿é—®å¾ˆæ…¢ï¼Œéœ€è¦æœ‰ï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼šåœ¨ä¸€ä¸ªæ¶ˆè´¹è€…ä¸­å¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œè®©å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¶ˆè´¹ã€‚â€”æå‡ä¸€ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›</li><li>æ–¹æ¡ˆäºŒï¼š å¦‚æœæ–¹æ¡ˆä¸€ä¸å¤Ÿï¼Œè¿™ä¸ªæ—¶å€™å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚å…¶å®å¤šä¸ªæ¶ˆè´¹è€…éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šä¹Ÿå¯ä»¥æé«˜æ¶ˆè´¹èƒ½åŠ›â€”â€”å……åˆ†åˆ©ç”¨æœåŠ¡å™¨çš„CPUèµ„æºã€‚</li><li>æ–¹æ¡ˆä¸‰ï¼šè®©ä¸€ä¸ªæ¶ˆè´¹è€…å»æŠŠæ”¶åˆ°çš„æ¶ˆæ¯å¾€å¦å¤–ä¸€ä¸ªtopicä¸Šå‘ï¼Œå¦å¤–ä¸€ä¸ªtopicè®¾ç½®å¤šä¸ªåˆ†åŒºå’Œå¤šä¸ªæ¶ˆè´¹è€…ï¼Œè¿›è¡Œå…·ä½“çš„ä¸šåŠ¡æ¶ˆè´¹ã€‚</li></ul><h3 id="8-5-å»¶è¿Ÿé˜Ÿåˆ—"><a href="#8-5-å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="8.5 å»¶è¿Ÿé˜Ÿåˆ—"></a>8.5 å»¶è¿Ÿé˜Ÿåˆ—</h3><p>åº”ç”¨åœºæ™¯ï¼šåœ¨è®¢å•åˆ›å»ºåå¦‚æœè¶…è¿‡30åˆ†é’Ÿæ²¡æœ‰ä»˜æ¬¾ï¼Œåˆ™éœ€è¦å–æ¶ˆè®¢å•ï¼Œæ­¤æ—¶å¯ç”¨å»¶æ—¶é˜Ÿåˆ—æ¥å®ç°ï¼š</p><ul><li>åˆ›å»ºå¤šä¸ªtopicï¼Œæ¯ä¸ªtopicè¡¨ç¤ºå»¶æ—¶çš„é—´éš”<ul><li>topic_5sï¼šå»¶æ—¶5sæ‰§è¡Œçš„é˜Ÿåˆ—</li><li>topic_1m: å»¶æ—¶1åˆ†é’Ÿæ‰§è¡Œçš„é˜Ÿåˆ—</li><li>topic_30m:å»¶æ—¶30åˆ†é’Ÿæ‰§è¡Œçš„é˜Ÿåˆ—</li></ul></li><li>æ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯åˆ°ç›¸åº”çš„topicï¼Œå¹¶å¸¦ä¸Šæ¶ˆæ¯å‘é€çš„æ—¶é—´</li><li>æ¶ˆæ¯è®¢é˜…ç›¸åº”çš„topicï¼Œæ¶ˆè´¹æ—¶è½®è¯¢æ¶ˆè´¹æ•´ä¸ªtopicä¸­çš„æ¶ˆæ¯<ul><li>å¦‚æœæ¶ˆæ¯å‘é€æ—¶é—´ï¼Œå’Œæ¶ˆè´¹çš„å½“å‰æ—¶é—´è¶…è¿‡é¢„è®¾çš„å€¼ï¼Œæ¯”å¦‚30åˆ†é’Ÿ</li><li>å¦‚æœæ¶ˆæ¯å‘é€æ—¶é—´ï¼Œå’Œæ¶ˆè´¹çš„å½“å‰æ—¶é—´æ²¡æœ‰è¶…è¿‡é¢„è®¾çš„å€¼ï¼Œåˆ™ä¸æ¶ˆè´¹å½“å‰çš„offsetåŠä¹‹åoffsetçš„æ‰€æœ‰æ¶ˆæ¯éƒ½æ¶ˆè´¹</li><li>ä¸‹æ¬¡ç»§ç»­æ¶ˆè´¹è¯¥offsetå¤„çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ—¶é—´æ˜¯å¦å·²ç»æ»¡è¶³é¢„è®¾å€¼</li></ul></li></ul><h2 id="9-Kafka-eagleç›‘æ§å¹³å°"><a href="#9-Kafka-eagleç›‘æ§å¹³å°" class="headerlink" title="9.Kafka-eagleç›‘æ§å¹³å°"></a>9.Kafka-eagleç›‘æ§å¹³å°</h2><p>kafka eagle å®˜ç½‘ï¼š<a href="https://docs.kafka-eagle.org/">Preface - Kafka Eagle (kafka-eagle.org)</a></p><ul><li><p>å®‰è£…</p><ul><li>jdkå¿…é¡»å®‰è£…</li></ul></li><li><p>è§£å‹å®‰è£…åŒ…</p></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>vim system-config.properties</code> ä¿®æ”¹zkåœ°å€å’Œmysqlåœ°å€</p></li><li></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>raftç®—æ³•</title>
      <link href="2021/09/22/raft-suan-fa/"/>
      <url>2021/09/22/raft-suan-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="Raftç®—æ³•"><a href="#Raftç®—æ³•" class="headerlink" title="Raftç®—æ³•"></a>Raftç®—æ³•</h1><h3 id="1ã€ä¸ºä»€ä¹ˆ"><a href="#1ã€ä¸ºä»€ä¹ˆ" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆ"></a>1ã€ä¸ºä»€ä¹ˆ</h3><p>éœ€è¦è·¨ç½‘ç»œçš„æœºå™¨ä¹‹é—´åè°ƒä¸€è‡´çš„å·¥ä½œã€‚</p><p>åº”å¯¹ç½‘ç»œçš„ä¸å¯é ä»¥åŠèŠ‚ç‚¹çš„å¤±æ•ˆã€‚</p><h3 id="2ã€-æ˜¯ä»€ä¹ˆ"><a href="#2ã€-æ˜¯ä»€ä¹ˆ" class="headerlink" title="2ã€ æ˜¯ä»€ä¹ˆ"></a>2ã€ æ˜¯ä»€ä¹ˆ</h3><p>ç»„ç»‡æœºå™¨ä½¿å…¶çŠ¶æ€æœ€ç»ˆä¸€è‡´å¹¶å…è®¸å±€éƒ¨å¤±è´¥çš„ç®—æ³•ã€‚</p><p>Paxosç®—æ³•ç”±æ¥å·²ä¹…ï¼Œç›®å‰æ˜¯åŠŸèƒ½å’Œæ€§èƒ½æœ€å®Œå–„çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œç„¶è€Œä»–éš¾ä»¥ç†è§£å’Œå®ç°ã€‚raftç®€åŒ–äº†paxosï¼Œä»¥ä¾¿äºç†è§£ä¸ºç›®æ ‡ã€‚å°½é‡æä¾›å’Œpaxosä¸€æ ·çš„åŠŸèƒ½å’Œæ€§èƒ½ã€‚</p><p><img src="/2021/09/22/raft-suan-fa/1\blog\source_posts\raftç®—æ³•\image-20210922161805776.png" alt="image-20210922161805776"></p><p>â€‹                                                                                        raft çŠ¶æ€æœº</p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MybatisPlus</title>
      <link href="2021/07/20/mybatisplus/"/>
      <url>2021/07/20/mybatisplus/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HAPIåŸç†</title>
      <link href="2021/07/19/hapi-yuan-li/"/>
      <url>2021/07/19/hapi-yuan-li/</url>
      
        <content type="html"><![CDATA[<p>HAPI ä¸»è¦æ˜¯ä¸¤ç§ä¸œè¥¿æ„æˆçš„ï¼š</p><p>ç¬¬ä¸€ä¸ªï¼šæ•°æ®æ¨¡å‹ã€‚</p><p>åŒ»ç–—ç›¸å…³æ•°æ®çš„æ•°æ®æ¨¡å‹ã€‚è¿™äº›æ•°æ®æ¨¡å‹éœ€è¦æ”¾åˆ°javaä¸­å®šä¹‰çš„æ•°æ®ç»“æ„é‡Œé¢ã€‚æ•°æ®ç»“æ„çš„å®ç°æ˜¯åŸºäºHL7æœºæ„çº¦å®šçš„æ ‡å‡†ã€‚ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼ŒHAPI å°†JAVAä¸­çš„ä¸€äº›åŸºæœ¬æ•°æ®ç±»å‹æ¯”å¦‚string boolean ç­‰é‡æ–°å°è£…æˆ stringType BooleanType ç­‰ï¼Œç„¶åå°†æ•°æ®å¡åˆ°è¿™äº›æ•°æ®ç±»å‹ä¸­ã€‚ é‡Œé¢çš„å…¶ä»–å¤åˆç±»å‹ï¼Œæ¯”å¦‚åœ°å€Addressè¿™ä¸ªæ•°æ®ç»“æ„ï¼Œä½¿ç”¨è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹è¿›è¡Œäº†ç»„åˆå°è£…ã€‚è¿™æ ·ç¬¦åˆäº†HL7 ç»“æ„å®šä¹‰çš„æ ‡å‡†ã€‚</p><p>ç¬¬äºŒä¸ªï¼šrestful API å¯¹äºäº¤æ¢è¿™ç§åŒ»ç–—æ•°æ®ã€‚</p><p>è¿™ä¸ªå…¶å®å°±æ˜¯servletçš„å®ç°äº†ï¼Œç±»ä¼¼äºspringbootä¸­çš„controlleré‚£ç§ï¼Œservletå¯¹è¯·æ±‚è¿›è¡Œè½¬å‘åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚</p><p>ä¸»è¦æ¨¡å—ï¼š</p><p>ç”¨javaå®ç°äº†HL7 å®šä¹‰çš„æ•°æ®æ ‡å‡†æ¨¡å‹ã€‚</p><p>å®ç°äº†æ•°æ®è½¬æ¢ ï¼ˆJSON + XMLï¼‰</p><p>æœåŠ¡å™¨ server framework</p><p>å®¢æˆ·ç«¯ client framework</p>]]></content>
      
      
      <categories>
          
          <category> HAPI </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿æ•™è‚²å¹³å°</title>
      <link href="2021/07/15/zai-xian-jiao-yu-ping-tai/"/>
      <url>2021/07/15/zai-xian-jiao-yu-ping-tai/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨çº¿æ•™è‚²å¹³å°"><a href="#åœ¨çº¿æ•™è‚²å¹³å°" class="headerlink" title="åœ¨çº¿æ•™è‚²å¹³å°"></a>åœ¨çº¿æ•™è‚²å¹³å°</h1><h2 id="1-ç»“æ„"><a href="#1-ç»“æ„" class="headerlink" title="1.ç»“æ„"></a>1.ç»“æ„</h2><p>æœ¬å¹³å°å•†ä¸šæ¨¡å¼æ˜¯B2B2Cæ¨¡å¼ã€‚</p><p>æ‹¥æœ‰ç³»ç»Ÿåå°ï¼ˆç®¡ç†å‘˜ä½¿ç”¨ï¼‰ã€ç³»ç»Ÿå‰å°ï¼ˆæ™®é€šç”¨æˆ·ä½¿ç”¨ï¼‰ã€‚</p><table><thead><tr><th align="left">åå°ï¼ˆ7å¤§æ¨¡å—ï¼‰</th><th align="left">å‰å°</th></tr></thead><tbody><tr><td align="left">è®²å¸ˆç®¡ç†æ¨¡å—</td><td align="left">é¦–é¡µæ•°æ®æ˜¾ç¤º</td></tr><tr><td align="left">è¯¾ç¨‹åˆ†ç±»ç®¡ç†æ¨¡å—</td><td align="left">è®²å¸ˆåˆ—è¡¨å’Œè¯¦æƒ…</td></tr><tr><td align="left">è¯¾ç¨‹ç®¡ç†æ¨¡å—ï¼ˆ1ï¼‰è§†é¢‘</td><td align="left">è¯¾ç¨‹åˆ—è¡¨å’Œè¯¾ç¨‹è¯¦æƒ…ï¼ˆ1ï¼‰è§†é¢‘çš„åœ¨çº¿æ’­æ”¾</td></tr><tr><td align="left">ç»Ÿè®¡åˆ†ææ¨¡å—</td><td align="left">ç™»å½•å’Œæ³¨å†Œ</td></tr><tr><td align="left">è®¢å•ç®¡ç†</td><td align="left">å¾®ä¿¡æ‰«ç ç™»å½•</td></tr><tr><td align="left">bannerç®¡ç†ï¼ˆå¹»ç¯ç‰‡åˆ‡æ¢ï¼‰</td><td align="left">å¾®ä¿¡æ‰«ç æ”¯ä»˜</td></tr><tr><td align="left">æƒé™ç®¡ç†</td><td align="left"></td></tr></tbody></table><h3 id="1-1-ä½¿ç”¨æŠ€æœ¯"><a href="#1-1-ä½¿ç”¨æŠ€æœ¯" class="headerlink" title="1.1 ä½¿ç”¨æŠ€æœ¯"></a>1.1 ä½¿ç”¨æŠ€æœ¯</h3><p>é¡¹ç›®ä½¿ç”¨ å‰åç«¯åˆ†ç¦»å¼€å‘</p><p><img src="https://bruce11111.github.io/2021/03/23/project/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.PNG" alt="img"></p><table><thead><tr><th align="left">åç«¯</th><th align="left">å‰ç«¯</th></tr></thead><tbody><tr><td align="left">springboot</td><td align="left">vue</td></tr><tr><td align="left">springcloud</td><td align="left">element-ui</td></tr><tr><td align="left">MybatisPlus</td><td align="left">axios</td></tr><tr><td align="left">spring security</td><td align="left">node.js</td></tr><tr><td align="left">redis</td><td align="left"></td></tr><tr><td align="left">maven</td><td align="left"></td></tr><tr><td align="left">easyExcel</td><td align="left"></td></tr><tr><td align="left">jwt</td><td align="left"></td></tr><tr><td align="left">OAuth2</td><td align="left"></td></tr></tbody></table><p>å…¶ä»–æŠ€æœ¯ï¼šé˜¿é‡Œäº‘ossã€é˜¿é‡Œäº‘è§†é¢‘ç‚¹æ’­æœåŠ¡ã€é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ã€å¾®ä¿¡æ”¯ä»˜å’Œç™»å½•ã€dockerã€gitã€jenkins</p><h2 id="2-MybatisPlus"><a href="#2-MybatisPlus" class="headerlink" title="2.MybatisPlus"></a>2.MybatisPlus</h2><p>å®˜ç½‘ï¼š<a href="http://mp.baomidou.com/">http://mp.baomidou.com/</a></p><p>å‚è€ƒæ•™ç¨‹ï¼š<a href="http://mp.baomidou.com/guide/">http://mp.baomidou.com/guide/</a></p><p>MPæ˜¯ä¸€ä¸ªMyBatisçš„å¢å¼ºå·¥å…·ï¼Œåœ¨Mybatisçš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p><h3 id="2-1-å¼€å‘æ­¥éª¤"><a href="#2-1-å¼€å‘æ­¥éª¤" class="headerlink" title="2.1 å¼€å‘æ­¥éª¤"></a>2.1 å¼€å‘æ­¥éª¤</h3><h4 id="2-1-1-åˆ›å»ºæ•°æ®åº“"><a href="#2-1-1-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="2.1.1 åˆ›å»ºæ•°æ®åº“"></a>2.1.1 åˆ›å»ºæ•°æ®åº“</h4><p>åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œæ·»åŠ æ•°æ®ï¼Œç”¨äºmpæ“ä½œã€‚</p><p>mysql</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">USE `mybatis_plus`;CREATE TABLE `user`(`id` BIGINT(20) NOT NULL COMMENT 'ä¸»é”®id',`name` VARCHAR(30) NULL DEFAULT NULL COMMENT 'å§“å',`age` INT(11) NULL DEFAULT NULL COMMENT 'å¹´é¾„',`email` VARCHAR(50) NULL DEFAULT NULL COMMENT 'é‚®ç®±',PRIMARY KEY (id));INSERT INTO `user` (id,`name`,age,email) VALUES (1, 'Jone',18,'test1@baomidou.com'),(2, 'Jack', 20, 'test2@baomidou.com'),(3, 'Tom', 28, 'test3@baomidou.com'),(4, 'Sandy', 21, 'test4@baomidou.com'),(5, 'Billie', 24, 'test5@baomidou.com');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-2-åˆ›å»ºspringbootå·¥ç¨‹"><a href="#2-1-2-åˆ›å»ºspringbootå·¥ç¨‹" class="headerlink" title="2.1.2 åˆ›å»ºspringbootå·¥ç¨‹"></a>2.1.2 åˆ›å»ºspringbootå·¥ç¨‹</h4><p>ä¸»è¦å°±æ˜¯æ“ä½œideaï¼Œspringbootç‰ˆæœ¬ä½¿ç”¨2.2.1.RELEASE</p><h4 id="2-1-3-å¼•å…¥ä¾èµ–"><a href="#2-1-3-å¼•å…¥ä¾èµ–" class="headerlink" title="2.1.3 å¼•å…¥ä¾èµ–"></a>2.1.3 å¼•å…¥ä¾èµ–</h4><p>springbootå’Œmpçš„ä¾èµ–ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-4-é…ç½®application-properties"><a href="#2-1-4-é…ç½®application-properties" class="headerlink" title="2.1.4 é…ç½®application.properties"></a>2.1.4 é…ç½®application.properties</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver #å¦‚æœæ˜¯mysql 8+ éœ€è¦åŠ cjå’Œä¸‹é¢çš„æ—¶åŒºspring.datasource.url=jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8spring.datasource.username=rootspring.datasource.password=000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦ä¸€ç§é…ç½®æ–‡ä»¶æ˜¯ymlï¼Œä¹Ÿå¯ä»¥ã€‚</p><h4 id="2-1-5-å†™ä»£ç "><a href="#2-1-5-å†™ä»£ç " class="headerlink" title="2.1.5 å†™ä»£ç "></a>2.1.5 å†™ä»£ç </h4><ul><li>å®ä½“ç±»</li></ul><p>java</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨ç±»</li></ul><p>å¯åŠ¨ç±»åŠ mapperscanï¼Œè‡ªåŠ¨æ‰«æå¯¹åº”çš„mapper</p><h4 id="2-1-6-æ€§èƒ½åˆ†ææ’ä»¶"><a href="#2-1-6-æ€§èƒ½åˆ†ææ’ä»¶" class="headerlink" title="2.1.6 æ€§èƒ½åˆ†ææ’ä»¶"></a>2.1.6 æ€§èƒ½åˆ†ææ’ä»¶</h4><p>æ€§èƒ½åˆ†ææ‹¦æˆªå™¨ï¼š</p><ol><li>åœ¨é…ç½®ç±»ä¸­åŠ ä¸Šæ€§èƒ½åˆ†ææ’ä»¶ï¼š</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"dev"</span><span class="token punctuation">,</span><span class="token string">"test"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//æœ‰ä¸‰ç§ç¯å¢ƒï¼šdev : å¼€å‘ç¯å¢ƒï¼Œtest : æµ‹è¯•ç¯å¢ƒï¼Œ prod : ç”Ÿäº§ç¯å¢ƒ</span><span class="token keyword">public</span> <span class="token class-name">PerformanceInterceptor</span> <span class="token function">performanceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">PerformanceInterceptor</span> performanceInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    performanceInterceptor<span class="token punctuation">.</span><span class="token function">setMaxTime</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ms,è¶…è¿‡æ­¤å¤„è®¾ç½®çš„msåˆ™sqlä¸æ‰§è¡Œ</span>    performanceInterceptor<span class="token punctuation">.</span><span class="token function">setFormat</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> performanceInterceptor<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>Springbootä¸­è®¾ç½®devç¯å¢ƒ</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">spring.profiles.active=dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-æ­å»ºé¡¹ç›®"><a href="#3-æ­å»ºé¡¹ç›®" class="headerlink" title="3. æ­å»ºé¡¹ç›®"></a>3. æ­å»ºé¡¹ç›®</h2><h3 id="3-1æ¨¡å—è¯´æ˜"><a href="#3-1æ¨¡å—è¯´æ˜" class="headerlink" title="3.1æ¨¡å—è¯´æ˜"></a>3.1æ¨¡å—è¯´æ˜</h3><p><strong>guli-parentï¼šåœ¨çº¿æ•™å­¦æ ¹ç›®å½•ï¼ˆçˆ¶å·¥ç¨‹ï¼‰ï¼Œç®¡ç†å››ä¸ªå­æ¨¡å—ï¼š</strong></p><p><strong>canal-client</strong>ï¼šcanalæ•°æ®åº“è¡¨åŒæ­¥æ¨¡å—ï¼ˆç»Ÿè®¡åŒæ­¥æ•°æ®ï¼‰**</p><p><strong>common</strong>ï¼šå…¬å…±æ¨¡å—çˆ¶èŠ‚ç‚¹**</p><p> common-utilï¼šå·¥å…·ç±»æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—éƒ½å¯ä»¥ä¾èµ–äºå®ƒ</p><p> service-baseï¼šserviceæœåŠ¡çš„baseåŒ…ï¼ŒåŒ…å«serviceæœåŠ¡çš„å…¬å…±é…ç½®ç±»ï¼Œæ‰€æœ‰serviceæ¨¡å—ä¾èµ–äºå®ƒ</p><p> spring-securityï¼šè®¤è¯ä¸æˆæƒæ¨¡å—ï¼Œéœ€è¦è®¤è¯æˆæƒçš„serviceæœåŠ¡ä¾èµ–äºå®ƒ</p><p><strong>infrastructure</strong>ï¼šåŸºç¡€æœåŠ¡æ¨¡å—çˆ¶èŠ‚ç‚¹**</p><p> api-gatewayï¼šapiç½‘å…³æœåŠ¡</p><p><strong>service</strong>ï¼šapiæ¥å£æœåŠ¡çˆ¶èŠ‚ç‚¹**</p><blockquote><blockquote><blockquote><p>service-aclï¼šç”¨æˆ·æƒé™ç®¡ç†apiæ¥å£æœåŠ¡ï¼ˆç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†å’Œæƒé™ç®¡ç†ç­‰ï¼‰</p></blockquote></blockquote><blockquote><blockquote><p>service-cmsï¼šcms apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-eduï¼šæ•™å­¦ç›¸å…³apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-msmï¼šçŸ­ä¿¡apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-orderï¼šè®¢å•ç›¸å…³apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-ossï¼šé˜¿é‡Œäº‘oss apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-statisticsï¼šç»Ÿè®¡æŠ¥è¡¨apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-ucenterï¼šä¼šå‘˜apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-vodï¼šè§†é¢‘ç‚¹æ’­apiæ¥å£æœåŠ¡</p></blockquote></blockquote></blockquote><h3 id="3-2-çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–"><a href="#3-2-çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–" class="headerlink" title="3.2 çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–"></a>3.2 çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–</h3><p>åœ¨èŠ‚ç‚¹åé¢æ·»åŠ pomç±»å‹</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>guli-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ·»åŠ propertiesç¡®å®šä¾èµ–ç‰ˆæœ¬</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>guli.version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>guli.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis-plus.version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis-plus.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>velocity.version</span><span class="token punctuation">&gt;</span></span>2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>velocity.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swagger.version</span><span class="token punctuation">&gt;</span></span>2.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swagger.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun.oss.version</span><span class="token punctuation">&gt;</span></span>2.8.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun.oss.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jodatime.version</span><span class="token punctuation">&gt;</span></span>2.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jodatime.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>poi.version</span><span class="token punctuation">&gt;</span></span>3.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>poi.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-fileupload.version</span><span class="token punctuation">&gt;</span></span>1.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-fileupload.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-io.version</span><span class="token punctuation">&gt;</span></span>2.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-io.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>httpclient.version</span><span class="token punctuation">&gt;</span></span>4.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>httpclient.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jwt.version</span><span class="token punctuation">&gt;</span></span>0.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jwt.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-java-sdk-core.version</span><span class="token punctuation">&gt;</span></span>4.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-java-sdk-core.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-sdk-oss.version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-sdk-oss.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-java-sdk-vod.version</span><span class="token punctuation">&gt;</span></span>2.15.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-java-sdk-vod.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-java-vod-upload.version</span><span class="token punctuation">&gt;</span></span>1.4.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-java-vod-upload.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-sdk-vod-upload.version</span><span class="token punctuation">&gt;</span></span>1.4.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-sdk-vod-upload.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fastjson.version</span><span class="token punctuation">&gt;</span></span>1.2.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fastjson.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gson.version</span><span class="token punctuation">&gt;</span></span>2.8.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gson.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>json.version</span><span class="token punctuation">&gt;</span></span>20170516<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>json.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-dbutils.version</span><span class="token punctuation">&gt;</span></span>1.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-dbutils.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canal.client.version</span><span class="token punctuation">&gt;</span></span>1.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canal.client.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>docker.image.prefix</span><span class="token punctuation">&gt;</span></span>zx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>docker.image.prefix</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>0.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®<code>dependencyManagement</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--Spring Cloud--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>Hoxton.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${cloud-alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--mybatis-plus æŒä¹…å±‚--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mybatis-plus.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- velocity æ¨¡æ¿å¼•æ“, Mybatis Plus ä»£ç ç”Ÿæˆå™¨éœ€è¦ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>velocity-engine-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${velocity.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--swagger--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--swagger ui--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--aliyunOSS--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun.oss.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥æœŸæ—¶é—´å·¥å…·--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${jodatime.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--xls--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${poi.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--xlsx--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi-ooxml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${poi.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ–‡ä»¶ä¸Šä¼ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-fileupload.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--commons-io--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-io.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--httpclient--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${httpclient.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.code.gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${gson.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- JWT --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${jwt.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--aliyun--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-java-sdk-core.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-sdk-oss.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-vod<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-java-sdk-vod.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-vod-upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-java-vod-upload.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-vod-upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-sdk-vod-upload.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${fastjson.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${json.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-dbutils<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-dbutils<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-dbutils.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.otter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>canal.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${canal.client.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-å­æ¨¡å—service"><a href="#3-3-å­æ¨¡å—service" class="headerlink" title="3.3 å­æ¨¡å—service"></a>3.3 å­æ¨¡å—service</h3><ol><li>æ·»åŠ æ¨¡å—ç±»å‹æ˜¯pom</li></ol><p>artifactIdèŠ‚ç‚¹åé¢æ·»åŠ pomç±»å‹</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>service<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li>æ·»åŠ ä¾èµ–</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-ribbon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--hystrixä¾èµ–ï¼Œä¸»è¦æ˜¯ç”¨  @HystrixCommand --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-hystrix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--æœåŠ¡æ³¨å†Œ--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--æœåŠ¡è°ƒç”¨--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--mybatis-plus--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--mysql--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- velocity æ¨¡æ¿å¼•æ“, Mybatis Plus ä»£ç ç”Ÿæˆå™¨éœ€è¦ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>velocity-engine-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--swagger--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--xls--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi-ooxml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--httpclient--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--commons-io--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--gson--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.code.gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4å¼€å‘è®²å¸ˆç®¡ç†æ¨¡å—"><a href="#3-4å¼€å‘è®²å¸ˆç®¡ç†æ¨¡å—" class="headerlink" title="3.4å¼€å‘è®²å¸ˆç®¡ç†æ¨¡å—"></a>3.4å¼€å‘è®²å¸ˆç®¡ç†æ¨¡å—</h3><ol><li>åˆ›å»ºapplication.propertiesæ–‡ä»¶</li><li>ç¼–å†™controllerã€ service ã€ mapper å†…å®¹</li></ol><p>mpæä¾›äº†ä»£ç ç”Ÿæˆå™¨ï¼Œç”Ÿæˆç›¸å…³ä»£ç </p><p><strong>resourcesç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ application.properties</strong></p><pre class="line-numbers language-none"><code class="language-none"># æœåŠ¡ç«¯å£server.port=8001# æœåŠ¡åspring.application.name=service-edu# ç¯å¢ƒè®¾ç½®ï¼šdevã€testã€prodspring.profiles.active=dev# mysqlæ•°æ®åº“è¿æ¥spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driverspring.datasource.url=jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8spring.datasource.username=rootspring.datasource.password=root#mybatisæ—¥å¿—mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><strong>æˆ–è€…åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ application.yml</strong></p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># æœåŠ¡ç«¯å£</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8001</span><span class="token comment"># æœåŠ¡å</span><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">service-edu</span><span class="token comment"># ç¯å¢ƒè®¾ç½®ï¼šdevã€testã€prod</span><span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span><span class="token comment"># mysqlæ•°æ®åº“è¿æ¥</span><span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.cj.jdbc.Driver</span><span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span><span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">000</span><span class="token comment">#è¿”å›jsonçš„å…¨å±€æ—¶é—´æ ¼å¼</span><span class="token attr-name">spring.jackson.date-format</span><span class="token punctuation">=</span><span class="token attr-value">yyyy-MM-dd HH:mm:ss</span><span class="token attr-name">spring.jackson.time-zone</span><span class="token punctuation">=</span><span class="token attr-value">GMT+8</span><span class="token comment">#mybatisæ—¥å¿—</span><span class="token attr-name">mybatis-plus.configuration.log-impl</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.ibatis.logging.stdout.StdOutImpl</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#### application.yml</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> service<span class="token punctuation">-</span>edu<span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev<span class="token comment">####  application-dev.yml</span><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl<span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>com/atguigu/service/<span class="token important">*/mapper/*.xml</span><span class="token key atrule">global-config</span><span class="token punctuation">:</span>    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>      <span class="token key atrule">logic-delete-value</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token key atrule">spring</span><span class="token punctuation">:</span><span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource<span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver<span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/guli<span class="token punctuation">?</span>serverTimezone=GMT%2B8<span class="token key atrule">username</span><span class="token punctuation">:</span> root<span class="token key atrule">password</span><span class="token punctuation">:</span> root<span class="token key atrule">hikari</span><span class="token punctuation">:</span>      <span class="token key atrule">connection-test-query</span><span class="token punctuation">:</span> SELECT 1<span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">60000</span><span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">500000</span><span class="token key atrule">max-lifetime</span><span class="token punctuation">:</span> <span class="token number">540000</span><span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token key atrule">pool-name</span><span class="token punctuation">:</span> GuliHikariPool<span class="token key atrule">jackson</span><span class="token punctuation">:</span>    <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss<span class="token key atrule">time-zone</span><span class="token punctuation">:</span> GMT+8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-1-åˆ›å»ºMPä»£ç ç”Ÿæˆå™¨"><a href="#3-4-1-åˆ›å»ºMPä»£ç ç”Ÿæˆå™¨" class="headerlink" title="3.4.1 åˆ›å»ºMPä»£ç ç”Ÿæˆå™¨"></a>3.4.1 åˆ›å»ºMPä»£ç ç”Ÿæˆå™¨</h4><p>åœ¨test/javaç›®å½•ä¸‹åˆ›å»ºåŒ…<code>com.atguigu.eduservice</code>ï¼Œåˆ›å»ºä»£ç ç”Ÿæˆå™¨ï¼š<code>CodeGenerator.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> getCode <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">main1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 1ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨</span>        <span class="token class-name">AutoGenerator</span> mpg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutoGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2ã€å…¨å±€é…ç½®</span>        <span class="token class-name">GlobalConfig</span> gc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span><span class="token function">setOutputDir</span><span class="token punctuation">(</span>projectPath <span class="token operator">+</span> <span class="token string">"/src/main/java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span><span class="token function">setAuthor</span><span class="token punctuation">(</span><span class="token string">"atguigu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span><span class="token function">setOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç”Ÿæˆåæ˜¯å¦æ‰“å¼€èµ„æºç®¡ç†å™¨</span>        gc<span class="token punctuation">.</span><span class="token function">setFileOverride</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//é‡æ–°ç”Ÿæˆæ—¶æ–‡ä»¶æ˜¯å¦è¦†ç›–</span>        <span class="token comment">/*         * mpç”Ÿæˆserviceå±‚ä»£ç ï¼Œé»˜è®¤æ¥å£åç§°ç¬¬ä¸€ä¸ªå­—æ¯æœ‰ I         * UcenterService         * */</span>        gc<span class="token punctuation">.</span><span class="token function">setServiceName</span><span class="token punctuation">(</span><span class="token string">"%sService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å»æ‰Serviceæ¥å£çš„é¦–å­—æ¯I</span>        gc<span class="token punctuation">.</span><span class="token function">setIdType</span><span class="token punctuation">(</span><span class="token class-name">IdType</span><span class="token punctuation">.</span>ID_WORKER<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸»é”®ç­–ç•¥</span>        gc<span class="token punctuation">.</span><span class="token function">setDateType</span><span class="token punctuation">(</span><span class="token class-name">DateType</span><span class="token punctuation">.</span>ONLY_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å®šä¹‰ç”Ÿæˆçš„å®ä½“ç±»ä¸­æ—¥æœŸç±»å‹</span>        gc<span class="token punctuation">.</span><span class="token function">setSwagger2</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯Swagger2æ¨¡å¼</span>        mpg<span class="token punctuation">.</span><span class="token function">setGlobalConfig</span><span class="token punctuation">(</span>gc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3ã€æ•°æ®æºé…ç½®</span>        <span class="token class-name">DataSourceConfig</span> dsc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setDriverName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setDbType</span><span class="token punctuation">(</span><span class="token class-name">DbType</span><span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">;</span>        mpg<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dsc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4ã€åŒ…é…ç½®</span>        <span class="token class-name">PackageConfig</span> pc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PackageConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setModuleName</span><span class="token punctuation">(</span><span class="token string">"serviceedu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ¨¡å—å</span>        pc<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span><span class="token string">"com.atguigu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setController</span><span class="token punctuation">(</span><span class="token string">"controller"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span><span class="token string">"entity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setService</span><span class="token punctuation">(</span><span class="token string">"service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setMapper</span><span class="token punctuation">(</span><span class="token string">"mapper"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mpg<span class="token punctuation">.</span><span class="token function">setPackageInfo</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5ã€ç­–ç•¥é…ç½®</span>        <span class="token class-name">StrategyConfig</span> strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StrategyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        strategy<span class="token punctuation">.</span><span class="token function">setInclude</span><span class="token punctuation">(</span><span class="token string">"edu_teacher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        strategy<span class="token punctuation">.</span><span class="token function">setNaming</span><span class="token punctuation">(</span><span class="token class-name">NamingStrategy</span><span class="token punctuation">.</span>underline_to_camel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span>        strategy<span class="token punctuation">.</span><span class="token function">setTablePrefix</span><span class="token punctuation">(</span>pc<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç”Ÿæˆå®ä½“æ—¶å»æ‰è¡¨å‰ç¼€</span>        strategy<span class="token punctuation">.</span><span class="token function">setColumnNaming</span><span class="token punctuation">(</span><span class="token class-name">NamingStrategy</span><span class="token punctuation">.</span>underline_to_camel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span>        strategy<span class="token punctuation">.</span><span class="token function">setEntityLombokModel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lombok æ¨¡å‹ @Accessors(chain = true) setteré“¾å¼æ“ä½œ</span>        strategy<span class="token punctuation">.</span><span class="token function">setRestControllerStyle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//restful apié£æ ¼æ§åˆ¶å™¨</span>        strategy<span class="token punctuation">.</span><span class="token function">setControllerMappingHyphenStyle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//urlä¸­é©¼å³°è½¬è¿å­—ç¬¦</span>        mpg<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6ã€æ‰§è¡Œ</span>        mpg<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-2-ç¼–å†™åå°ç®¡ç†apiæ¥å£"><a href="#3-4-2-ç¼–å†™åå°ç®¡ç†apiæ¥å£" class="headerlink" title="3.4.2 ç¼–å†™åå°ç®¡ç†apiæ¥å£"></a>3.4.2 ç¼–å†™åå°ç®¡ç†apiæ¥å£</h4><p><strong>1ã€ç¼–å†™controllerä»£ç </strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> <span class="token class-name">TeacherService</span> teacherService<span class="token punctuation">;</span><span class="token annotation punctuation">@GetMapping</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2. åˆ›å»ºSpringBooté…ç½®ç±»</strong></p><p>åœ¨eduåŒ…ä¸‹åˆ›å»ºconfigåŒ…ï¼Œåˆ›å»ºMyBatisPlusConfig.java</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableTransactionManagement</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.atguigu.eduservice.mapper"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisPlusConfig</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>3ã€é…ç½®SQLæ‰§è¡Œæ€§èƒ½åˆ†ææ’ä»¶</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**     * SQL æ‰§è¡Œæ€§èƒ½åˆ†ææ’ä»¶     * å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼Œçº¿ä¸Šä¸æ¨èã€‚ maxTime æŒ‡çš„æ˜¯ sql æœ€å¤§æ‰§è¡Œæ—¶é•¿     */</span><span class="token annotation punctuation">@Bean</span><span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"dev"</span><span class="token punctuation">,</span><span class="token string">"test"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// è®¾ç½® dev test ç¯å¢ƒå¼€å¯</span><span class="token keyword">public</span> <span class="token class-name">PerformanceInterceptor</span> <span class="token function">performanceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">PerformanceInterceptor</span> performanceInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    performanceInterceptor<span class="token punctuation">.</span><span class="token function">setMaxTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//msï¼Œè¶…è¿‡æ­¤å¤„è®¾ç½®çš„msåˆ™sqlä¸æ‰§è¡Œ</span>    performanceInterceptor<span class="token punctuation">.</span><span class="token function">setFormat</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> performanceInterceptor<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-3-åˆ›å»ºSpringBootå¯åŠ¨ç±»"><a href="#3-4-3-åˆ›å»ºSpringBootå¯åŠ¨ç±»" class="headerlink" title="3.4.3 åˆ›å»ºSpringBootå¯åŠ¨ç±»**"></a>3.4.3 åˆ›å»ºSpringBootå¯åŠ¨ç±»**</h4><p>åˆ›å»ºå¯åŠ¨ç±» EduApplication.javaï¼Œæ³¨æ„å¯åŠ¨ç±»çš„åˆ›å»ºä½ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EduApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EduApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-4-è¿è¡Œå¯åŠ¨ç±»"><a href="#3-4-4-è¿è¡Œå¯åŠ¨ç±»" class="headerlink" title="3.4.4 è¿è¡Œå¯åŠ¨ç±»"></a>3.4.4 è¿è¡Œå¯åŠ¨ç±»</h4><p>è®¿é—®<a href="http://localhost:8001/eduservice/teacher">http://localhost:8001/eduservice/teacher</a></p><p>å¾—åˆ°jsonæ•°æ®</p><h4 id="3-4-5-ç»Ÿä¸€è¿”å›çš„jsonæ—¶é—´æ ¼å¼"><a href="#3-4-5-ç»Ÿä¸€è¿”å›çš„jsonæ—¶é—´æ ¼å¼" class="headerlink" title="3.4.5 ç»Ÿä¸€è¿”å›çš„jsonæ—¶é—´æ ¼å¼"></a>3.4.5 ç»Ÿä¸€è¿”å›çš„jsonæ—¶é—´æ ¼å¼</h4><p>é»˜è®¤æƒ…å†µä¸‹jsonæ—¶é—´æ ¼å¼å¸¦æœ‰æ—¶åŒºï¼Œå¹¶ä¸”æ˜¯ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œå’Œæˆ‘ä»¬çš„æ—¶é—´å·®äº†å…«ä¸ªå°æ—¶</p><p>åœ¨application.propertiesä¸­è®¾ç½®</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">#è¿”å›jsonçš„å…¨å±€æ—¶é—´æ ¼å¼spring.jackson.date-format=yyyy-MM-dd HH:mm:ssspring.jackson.time-zone=GMT+8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3-5-è®²å¸ˆé€»è¾‘åˆ é™¤"><a href="#3-5-è®²å¸ˆé€»è¾‘åˆ é™¤" class="headerlink" title="3.5 è®²å¸ˆé€»è¾‘åˆ é™¤"></a>3.5 è®²å¸ˆé€»è¾‘åˆ é™¤</h3><h4 id="3-5-1-EduTeacherControlleræ·»åŠ åˆ é™¤æ–¹æ³•"><a href="#3-5-1-EduTeacherControlleræ·»åŠ åˆ é™¤æ–¹æ³•" class="headerlink" title="3.5.1 EduTeacherControlleræ·»åŠ åˆ é™¤æ–¹æ³•"></a>3.5.1 EduTeacherControlleræ·»åŠ åˆ é™¤æ–¹æ³•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">removeById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-5-2-é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶"><a href="#3-5-2-é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶" class="headerlink" title="3.5.2 é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶"></a>3.5.2 é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶</h4><pre class="line-numbers language-none"><code class="language-none">MyBatisPlusConfigä¸­é…ç½®<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**      * é€»è¾‘åˆ é™¤æ’ä»¶      */</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">ISqlInjector</span> <span class="token function">sqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogicSqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-6-Swagger2ä»‹ç»"><a href="#3-6-Swagger2ä»‹ç»" class="headerlink" title="3.6 Swagger2ä»‹ç»"></a>3.6 Swagger2ä»‹ç»</h3><p>å‰åç«¯åˆ†ç¦»å¼€å‘æ¨¡å¼ä¸­ï¼Œapiæ–‡æ¡£æ˜¯æœ€å¥½çš„æ²Ÿé€šæ–¹å¼ã€‚</p><p>Swagger æ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼çš„ Web æœåŠ¡ã€‚</p><p>åŠæ—¶æ€§ æ¥å£å˜æ›´åï¼Œèƒ½å¤ŸåŠæ—¶å‡†ç¡®åœ°é€šçŸ¥ç›¸å…³å‰åç«¯å¼€å‘äººå‘˜æ¥å£å˜æ›´åï¼Œèƒ½å¤ŸåŠæ—¶å‡†ç¡®åœ°é€šçŸ¥ç›¸å…³å‰åç«¯å¼€å‘äººå‘˜è§„èŒƒæ€§ å¹¶ä¸”ä¿è¯æ¥å£çš„è§„èŒƒæ€§ï¼Œå¦‚æ¥å£çš„åœ°å€ï¼Œè¯·æ±‚æ–¹å¼ï¼Œå‚æ•°åŠå“åº”æ ¼å¼å’Œé”™è¯¯ä¿¡æ¯å¹¶ä¸”ä¿è¯æ¥å£çš„è§„èŒƒæ€§ï¼Œå¦‚æ¥å£çš„åœ°å€ï¼Œè¯·æ±‚æ–¹å¼ï¼Œå‚æ•°åŠå“åº”æ ¼å¼å’Œé”™è¯¯ä¿¡æ¯ä¸€è‡´æ€§ æ¥å£ä¿¡æ¯ä¸€è‡´ï¼Œä¸ä¼šå‡ºç°å› å¼€å‘äººå‘˜æ‹¿åˆ°çš„æ–‡æ¡£ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œè€Œå‡ºç°åˆ†æ­§æ¥å£ä¿¡æ¯ä¸€è‡´ï¼Œä¸ä¼šå‡ºç°å› å¼€å‘äººå‘˜æ‹¿åˆ°çš„æ–‡æ¡£ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œè€Œå‡ºç°åˆ†æ­§å¯æµ‹æ€§ ç›´æ¥åœ¨æ¥å£æ–‡æ¡£ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä»¥æ–¹ä¾¿ç†è§£ä¸šåŠ¡ç›´æ¥åœ¨æ¥å£æ–‡æ¡£ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä»¥æ–¹ä¾¿ç†è§£ä¸šåŠ¡</p><h4 id="3-6-1-é…ç½®Swagger2"><a href="#3-6-1-é…ç½®Swagger2" class="headerlink" title="3.6.1 é…ç½®Swagger2"></a>3.6.1 é…ç½®Swagger2</h4><p><strong>1ã€åˆ›å»ºcommonæ¨¡å—</strong></p><p><strong>åœ¨guli-parentä¸‹åˆ›å»ºæ¨¡å—common</strong></p><p>é…ç½®ï¼š</p><pre class="line-numbers language-none"><code class="language-none">groupIdï¼šcom.atguiguartifactIdï¼šcommon<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://bruce11111.github.io/2021/03/23/project/9a40d77c-6b22-4f24-a288-c76d1082f98d.png" alt="img"></p><p><strong>img</strong></p><p><strong>2ã€åœ¨commonä¸­å¼•å…¥ç›¸å…³ä¾èµ–</strong></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!--mybatis-plus--&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶--&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!--swagger--&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!-- redis --&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2       &lt;dependency&gt;           &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;           &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;           &lt;version&gt;2.6.0&lt;/version&gt;       &lt;/dependency&gt;--&gt;</span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>3.åœ¨æ¨¡å—service-baseä¸­ï¼Œåˆ›å»ºswaggerçš„é…ç½®ç±»</strong></p><p>åˆ›å»ºåŒ…<code>com.atguigu.servicebase.config</code>ï¼Œåˆ›å»ºç±»<code>SwaggerConfig</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableSwagger2</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">webApiConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">groupName</span><span class="token punctuation">(</span><span class="token string">"webApi"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">webApiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">Predicates</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">"/admin/.*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">Predicates</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">"/error.*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token keyword">private</span> <span class="token class-name">ApiInfo</span> <span class="token function">webApiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"ç½‘ç«™-è¯¾ç¨‹ä¸­å¿ƒAPIæ–‡æ¡£"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"æœ¬æ–‡æ¡£æè¿°äº†è¯¾ç¨‹ä¸­å¿ƒå¾®æœåŠ¡æ¥å£å®šä¹‰"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">contact</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token string">"Helen"</span><span class="token punctuation">,</span> <span class="token string">"http://atguigu.com"</span><span class="token punctuation">,</span> <span class="token string">"55317332@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>4ã€åœ¨æ¨¡å—serviceæ¨¡å—ä¸­å¼•å…¥service-base</strong></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>service-base<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>5ã€åœ¨service-eduå¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œè¿›è¡Œæµ‹è¯•</strong></p><p><img src="https://bruce11111.github.io/2021/03/23/project/ef45a37b-8f5b-480e-9d85-e25bf5bdd3ce.png" alt="img"></p><h4 id="3-6-2-APIæ¨¡å‹"><a href="#3-6-2-APIæ¨¡å‹" class="headerlink" title="3.6.2 APIæ¨¡å‹"></a>3.6.2 APIæ¨¡å‹</h4><p>å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå®šä¹‰è®¾ç½®ï¼Œä¾‹å¦‚ï¼š</p><p>å®šä¹‰æ ·ä¾‹æ•°æ®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ›å»ºæ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-01-01 8:00:00"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> gmtCreate<span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ›´æ–°æ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-01-01 8:00:00"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT_UPDATE<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> gmtModified<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://bruce11111.github.io/2021/03/23/project/9c17851c-8e7e-4161-968c-18b36faf148a.png" alt="img"></p><h4 id="3-6-3-å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜"><a href="#3-6-3-å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜" class="headerlink" title="3.6.3 å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜"></a>3.6.3 å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜</h4><p>å®šä¹‰åœ¨ç±»ä¸Šï¼š@Api</p><p>å®šä¹‰åœ¨æ–¹æ³•ä¸Šï¼š@ApiOperation</p><p>å®šä¹‰åœ¨å‚æ•°ä¸Šï¼š@ApiParam</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"è®²å¸ˆç®¡ç†"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/admin/edu/teacher"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherAdminController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">TeacherService</span> teacherService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ‰€æœ‰è®²å¸ˆåˆ—è¡¨"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@GetMapping</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®IDåˆ é™¤è®²å¸ˆ"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">removeById</span><span class="token punctuation">(</span>            <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>            <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-7-ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼"><a href="#3-7-ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼" class="headerlink" title="3.7 ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼"></a>3.7 ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼</h3><p>é¡¹ç›®ä¸­æˆ‘ä»¬ä¼šå°†å“åº”å°è£…æˆ<code>json</code>è¿”å›ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°†æ‰€æœ‰æ¥å£çš„æ•°æ®æ ¼å¼ç»Ÿä¸€ï¼Œ ä½¿å‰ç«¯iOSAndroid,WebiOSAndroid,Webå¯¹æ•°æ®çš„æ“ä½œæ›´ä¸€è‡´ã€è½»æ¾ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼æ²¡æœ‰å›ºå®šçš„æ ¼å¼ï¼Œåªè¦èƒ½æè¿°æ¸…æ¥šè¿”å›çš„æ•°æ®çŠ¶æ€ä»¥åŠè¦è¿”å›çš„å…·ä½“æ•°æ®å°±å¯ä»¥ã€‚ä½†æ˜¯ä¸€èˆ¬ä¼šåŒ…å«çŠ¶æ€ç ã€è¿”å›æ¶ˆæ¯ã€æ•°æ®è¿™å‡ éƒ¨åˆ†å†…å®¹</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¦æ±‚è¿”å›çš„åŸºæœ¬æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p><p><strong>åˆ—è¡¨ï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"åˆ˜å¾·å"</span><span class="token punctuation">,</span>        <span class="token property">"intro"</span><span class="token operator">:</span> <span class="token string">"æ¯•ä¸šäºå¸ˆèŒƒå¤§å­¦æ•°å­¦ç³»ï¼Œçƒ­çˆ±æ•™è‚²äº‹ä¸šï¼Œæ‰§æ•™æ•°å­¦æ€ç»´6å¹´æœ‰ä½™"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>åˆ†é¡µï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span>    <span class="token property">"rows"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"åˆ˜å¾·å"</span><span class="token punctuation">,</span>        <span class="token property">"intro"</span><span class="token operator">:</span> <span class="token string">"æ¯•ä¸šäºå¸ˆèŒƒå¤§å­¦æ•°å­¦ç³»ï¼Œçƒ­çˆ±æ•™è‚²äº‹ä¸šï¼Œæ‰§æ•™æ•°å­¦æ€ç»´6å¹´æœ‰ä½™"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ²¡æœ‰è¿”å›æ•°æ®ï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¤±è´¥ï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">20001</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"å¤±è´¥"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ç»Ÿä¸€ç»“æœ</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> å¸ƒå°”<span class="token punctuation">,</span> <span class="token comment">//å“åº”æ˜¯å¦æˆåŠŸ</span>  <span class="token property">"code"</span><span class="token operator">:</span> æ•°å­—<span class="token punctuation">,</span> <span class="token comment">//å“åº”ç </span>  <span class="token property">"message"</span><span class="token operator">:</span> å­—ç¬¦ä¸²<span class="token punctuation">,</span> <span class="token comment">//è¿”å›æ¶ˆæ¯</span>  <span class="token property">"data"</span><span class="token operator">:</span> HashMap <span class="token comment">//è¿”å›æ•°æ®ï¼Œæ”¾åœ¨é”®å€¼å¯¹ä¸­</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-7-2-åˆ›å»ºç»Ÿä¸€ç»“æœè¿”å›ç±»"><a href="#3-7-2-åˆ›å»ºç»Ÿä¸€ç»“æœè¿”å›ç±»" class="headerlink" title="3.7.2 åˆ›å»ºç»Ÿä¸€ç»“æœè¿”å›ç±»"></a>3.7.2 åˆ›å»ºç»Ÿä¸€ç»“æœè¿”å›ç±»</h4><p><strong>1ã€åœ¨commonæ¨¡å—ä¸‹åˆ›å»ºå­æ¨¡å—common-utils</strong></p><p><img src="https://bruce11111.github.io/2021/03/23/project/3f2fb002-8f7c-47aa-aaf0-71da156e1b20.png" alt="img"></p><p><strong>2ã€åˆ›å»ºæ¥å£å®šä¹‰è¿”å›ç </strong></p><p><strong>åˆ›å»ºåŒ…com.atguigu.commonutilsï¼Œåˆ›å»ºæ¥å£ ResultCode.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>commonutils</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResultCode</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> SUCCESS <span class="token operator">=</span> <span class="token number">20000</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> ERROR <span class="token operator">=</span> <span class="token number">20001</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>3ã€åˆ›å»ºç»“æœç±»</strong></p><p><strong>åˆ›å»ºç±» R.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">R</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ˜¯å¦æˆåŠŸ"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> success<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è¿”å›ç "</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è¿”å›æ¶ˆæ¯"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è¿”å›æ•°æ®"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">R</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResultCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> r<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResultCode</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> r<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span> success<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">code</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>äºŒã€ç»Ÿä¸€è¿”å›ç»“æœä½¿ç”¨</p><p>1ã€åœ¨serviceæ¨¡å—ä¸­æ·»åŠ ä¾èµ–</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>common_utils<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€ä¿®æ”¹Controllerä¸­çš„è¿”å›ç»“æœ</p><p>åˆ—è¡¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ‰€æœ‰è®²å¸ˆåˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"items"</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®IDåˆ é™¤è®²å¸ˆ"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">removeById</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>    teacherService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-8-åˆ†é¡µ"><a href="#3-8-åˆ†é¡µ" class="headerlink" title="3.8 åˆ†é¡µ"></a>3.8 åˆ†é¡µ</h3><h4 id="3-8-1-MyBatisPlusConfigä¸­é…ç½®åˆ†é¡µæ’ä»¶"><a href="#3-8-1-MyBatisPlusConfigä¸­é…ç½®åˆ†é¡µæ’ä»¶" class="headerlink" title="3.8.1 MyBatisPlusConfigä¸­é…ç½®åˆ†é¡µæ’ä»¶"></a>3.8.1 MyBatisPlusConfigä¸­é…ç½®åˆ†é¡µæ’ä»¶</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * åˆ†é¡µæ’ä»¶ */</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">PaginationInterceptor</span> <span class="token function">paginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-8-2-åˆ†é¡µControlleræ–¹æ³•"><a href="#3-8-2-åˆ†é¡µControlleræ–¹æ³•" class="headerlink" title="3.8.2 åˆ†é¡µControlleræ–¹æ³•"></a>3.8.2 åˆ†é¡µControlleræ–¹æ³•</h4><p><code>TeacherAdminController</code>ä¸­æ·»åŠ åˆ†é¡µæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ†é¡µè®²å¸ˆåˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{page}/{limit}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">pageList</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"å½“å‰é¡µç "</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> page<span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"limit"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"æ¯é¡µè®°å½•æ•°"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> limit<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> pageParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">;</span>    teacherService<span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> total <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span>  <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"total"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"rows"</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€Swaggerä¸­æµ‹è¯•</p><h3 id="3-9-æ¡ä»¶æŸ¥è¯¢"><a href="#3-9-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="3.9 æ¡ä»¶æŸ¥è¯¢"></a>3.9 æ¡ä»¶æŸ¥è¯¢</h3><p>æ ¹æ®è®²å¸ˆåç§°nameï¼Œè®²å¸ˆå¤´è¡”levelã€è®²å¸ˆå…¥é©»æ—¶é—´gmt_createï¼ˆæ—¶é—´æ®µï¼‰æŸ¥è¯¢</p><h4 id="3-9-1-åˆ›å»ºæŸ¥è¯¢å¯¹è±¡"><a href="#3-9-1-åˆ›å»ºæŸ¥è¯¢å¯¹è±¡" class="headerlink" title="3.9.1 åˆ›å»ºæŸ¥è¯¢å¯¹è±¡"></a>3.9.1 åˆ›å»ºæŸ¥è¯¢å¯¹è±¡</h4><p>åˆ›å»º<code>com.guli.edu.query</code>åŒ…ï¼Œåˆ›å»º<code>TeacherQuery.java</code>æŸ¥è¯¢å¯¹è±¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>query</span><span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"TeacheræŸ¥è¯¢å¯¹è±¡"</span><span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">"è®²å¸ˆæŸ¥è¯¢å¯¹è±¡å°è£…"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherQuery</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ•™å¸ˆåç§°,æ¨¡ç³ŠæŸ¥è¯¢"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"å¤´è¡” 1é«˜çº§è®²å¸ˆ 2é¦–å¸­è®²å¸ˆ"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> level<span class="token punctuation">;</span>        <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æŸ¥è¯¢å¼€å§‹æ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-01-01 10:10:10"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> begin<span class="token punctuation">;</span><span class="token comment">//æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯Stringç±»å‹ï¼Œå‰ç«¯ä¼ è¿‡æ¥çš„æ•°æ®æ— éœ€è¿›è¡Œç±»å‹è½¬æ¢</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æŸ¥è¯¢ç»“æŸæ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-12-01 10:10:10"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> end<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-9-2-service"><a href="#3-9-2-service" class="headerlink" title="3.9.2 service"></a>3.9.2 service</h4><p>æ¥å£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TeacherService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">pageQuery</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> pageParam<span class="token punctuation">,</span> <span class="token class-name">TeacherQuery</span> teacherQuery<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TeacherMapper</span><span class="token punctuation">,</span> <span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">TeacherService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pageQuery</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> pageParam<span class="token punctuation">,</span> <span class="token class-name">TeacherQuery</span> teacherQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        queryWrapper<span class="token punctuation">.</span><span class="token function">orderByAsc</span><span class="token punctuation">(</span><span class="token string">"sort"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>teacherQuery <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            baseMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> teacherQuery<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> level <span class="token operator">=</span> teacherQuery<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> begin <span class="token operator">=</span> teacherQuery<span class="token punctuation">.</span><span class="token function">getBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> end <span class="token operator">=</span> teacherQuery<span class="token punctuation">.</span><span class="token function">getEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            queryWrapper<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"level"</span><span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            queryWrapper<span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span><span class="token string">"gmt_create"</span><span class="token punctuation">,</span> begin<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            queryWrapper<span class="token punctuation">.</span><span class="token function">le</span><span class="token punctuation">(</span><span class="token string">"gmt_create"</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        baseMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-9-3-controller"><a href="#3-9-3-controller" class="headerlink" title="3.9.3 controller"></a>3.9.3 controller</h4><p>TeacherAdminControllerä¸­ä¿®æ”¹ pageListæ–¹æ³•ï¼š</p><p>å¢åŠ å‚æ•°TeacherQuery teacherQueryï¼Œéå¿…é€‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ†é¡µè®²å¸ˆåˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{page}/{limit}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">pageQuery</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"å½“å‰é¡µç "</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> page<span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"limit"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"æ¯é¡µè®°å½•æ•°"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> limit<span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacherQuery"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"æŸ¥è¯¢å¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token class-name">TeacherQuery</span> teacherQuery<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> pageParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">;</span>    teacherService<span class="token punctuation">.</span><span class="token function">pageQuery</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span> teacherQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> total <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span>  <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"total"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"rows"</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-9-4-Swaggerä¸­æµ‹è¯•"><a href="#3-9-4-Swaggerä¸­æµ‹è¯•" class="headerlink" title="3.9.4 Swaggerä¸­æµ‹è¯•"></a>3.9.4 Swaggerä¸­æµ‹è¯•</h4><p>ä¸€ã€è‡ªåŠ¨å¡«å……å°è£…</p><p>1ã€åœ¨service-baseæ¨¡å—ä¸­æ·»åŠ </p><p><strong>åˆ›å»ºåŒ…handlerï¼Œåˆ›å»ºè‡ªåŠ¨å¡«å……ç±» MyMetaObjectHandler</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMetaObjectHandler</span> <span class="token keyword">implements</span> <span class="token class-name">MetaObjectHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtCreate"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtModified"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtModified"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€åœ¨å®ä½“ç±»æ·»åŠ è‡ªåŠ¨å¡«å……æ³¨è§£</p><p><img src="https://bruce11111.github.io/2021/03/23/project/91054b5b-c478-4ba3-86f5-95f465210b39.png" alt="img"></p><p><strong>äºŒã€controlleræ–¹æ³•å®šä¹‰</strong></p><p>1ã€æ–°å¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ–°å¢è®²å¸ˆ"</span><sp}} class="token punctuation">)</span><span class="token annotation punctuation">@PostMapping</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacher"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆå¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span><span class="token punctuation">{</span>    teacherService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€æ ¹æ®idæŸ¥è¯¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®IDæŸ¥è¯¢è®²å¸ˆ"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getById</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">Teacher</span> teacher <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"item"</span><span class="token punctuation">,</span> teacher<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€æ ¹æ®idä¿®æ”¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®IDä¿®æ”¹è®²å¸ˆ"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">updateById</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacher"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆå¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span><span class="token punctuation">{</span>    teacher<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    teacherService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-10-ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#3-10-ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="3.10 ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>3.10 ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h3><p><strong>1ã€åˆ¶é€ å¼‚å¸¸</strong></p><p>é™¤ä»¥0</p><p>none</p><pre class="line-numbers language-none"><code class="language-none">int a = 10/0;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://bruce11111.github.io/2021/03/23/project/42cfc6ab-afaf-4516-8b67-d1e198277567.png" alt="img"></p><p><strong>img</strong></p><p>æˆ‘ä»¬æƒ³è®©å¼‚å¸¸ç»“æœä¹Ÿæ˜¾ç¤ºä¸ºç»Ÿä¸€çš„è¿”å›ç»“æœå¯¹è±¡ï¼Œå¹¶ä¸”ç»Ÿä¸€å¤„ç†ç³»ç»Ÿçš„å¼‚å¸¸ä¿¡æ¯ï¼Œé‚£ä¹ˆéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†</p><p><strong>1ã€åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨</strong></p><p>åœ¨service-baseä¸­åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»GlobalExceptionHandler.javaï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±» */</span><span class="token annotation punctuation">@ControllerAdvice</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2ã€æµ‹è¯•</strong></p><p>è¿”å›ç»Ÿä¸€é”™è¯¯ç»“æœ</p><p><img src="https://bruce11111.github.io/2021/03/23/project/c54eac64-d736-4dc4-9923-fb85f87d31a2.png" alt="img"></p><p>å¤„ç†ç‰¹å®šå¼‚å¸¸</p><p><strong>1ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•</strong></p><p>GlobalExceptionHandler.javaä¸­æ·»åŠ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†è‡ªå®šä¹‰å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2ã€æµ‹è¯•</strong></p><p><img src="https://bruce11111.github.io/2021/03/23/project/2b02cb8f-53fd-4847-a5ad-10e134c44f28.png" alt="img"></p><p><strong>img</strong></p><p><strong>å››ã€è‡ªå®šä¹‰å¼‚å¸¸</strong></p><p>1ã€åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GuliException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"çŠ¶æ€ç "</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€ä¸šåŠ¡ä¸­éœ€è¦çš„ä½ç½®æŠ›å‡ºGuliException</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"å‡ºç°è‡ªå®šä¹‰å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•</p><p>GlobalExceptionHandler.javaä¸­æ·»åŠ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">GuliException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">GuliException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4ã€æµ‹è¯•</p><p><img src="https://bruce11111.github.io/2021/03/23/project/f3c5a449-4984-4d35-9f25-35d43197a3e8.png" alt="img"></p><p><strong>img</strong></p><h3 id="3-11-ç»Ÿä¸€æ—¥å¿—å¤„ç†"><a href="#3-11-ç»Ÿä¸€æ—¥å¿—å¤„ç†" class="headerlink" title="3.11 ç»Ÿä¸€æ—¥å¿—å¤„ç†"></a>3.11 ç»Ÿä¸€æ—¥å¿—å¤„ç†</h3><p>1ã€é…ç½®æ—¥å¿—çº§åˆ«</p><p>æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰çš„è¡Œä¸ºæ˜¯åˆ†ç­‰çº§çš„ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p>åˆ†ä¸ºï¼šOFFã€FATALã€ERRORã€WARNã€INFOã€DEBUGã€ALL</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œspring bootä»æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ—¥å¿—çº§åˆ«åªæœ‰INFOåŠä»¥ä¸Šçº§åˆ«ï¼Œå¯ä»¥é…ç½®æ—¥å¿—çº§åˆ«</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"># è®¾ç½®æ—¥å¿—çº§åˆ«logging.level.root=WARN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹å¼åªèƒ½å°†æ—¥å¿—æ‰“å°åœ¨æ§åˆ¶å°ä¸Š</p><p>äºŒã€Logbackæ—¥å¿—</p><p>spring bootå†…éƒ¨ä½¿ç”¨Logbackä½œä¸ºæ—¥å¿—å®ç°çš„æ¡†æ¶ã€‚</p><p>Logbackå’Œlog4jéå¸¸ç›¸ä¼¼ï¼Œå¦‚æœä½ å¯¹log4jå¾ˆç†Ÿæ‚‰ï¼Œé‚£å¯¹logbackå¾ˆå¿«å°±ä¼šå¾—å¿ƒåº”æ‰‹ã€‚</p><p>logbackç›¸å¯¹äºlog4jçš„ä¸€äº›ä¼˜ç‚¹ï¼š<a href="https://blog.csdn.net/caisini_vc/article/details/48551287">https://blog.csdn.net/caisini_vc/article/details/48551287</a></p><p>1ã€é…ç½®logbackæ—¥å¿—</p><p>åˆ é™¤application.propertiesä¸­çš„æ—¥å¿—é…ç½®</p><p>å®‰è£…ideaå½©è‰²æ—¥å¿—æ’ä»¶ï¼šgrep-console</p><p>resources ä¸­åˆ›å»º logback-spring.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span>  <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10 seconds<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜åˆ†ä¸ºTRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATALï¼Œå¦‚æœè®¾ç½®ä¸ºWARNï¼Œåˆ™ä½äºWARNçš„ä¿¡æ¯éƒ½ä¸ä¼šè¾“å‡º --&gt;</span>    <span class="token comment">&lt;!-- scan:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrue --&gt;</span>    <span class="token comment">&lt;!-- scanPeriod:è®¾ç½®ç›‘æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚ --&gt;</span>    <span class="token comment">&lt;!-- debug:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextName</span><span class="token punctuation">&gt;</span></span>logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextName</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- nameçš„å€¼æ˜¯å˜é‡çš„åç§°ï¼Œvalueçš„å€¼æ—¶å˜é‡å®šä¹‰çš„å€¼ã€‚é€šè¿‡å®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ã€‚å®šä¹‰å˜é‡åï¼Œå¯ä»¥ä½¿â€œ${}â€æ¥ä½¿ç”¨å˜é‡ã€‚ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log.path<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>D:/guli_log/edu<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- å½©è‰²æ—¥å¿— --&gt;</span>    <span class="token comment">&lt;!-- é…ç½®æ ¼å¼å˜é‡ï¼šCONSOLE_LOG_PATTERN å½©è‰²æ—¥å¿—æ ¼å¼ --&gt;</span>    <span class="token comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span>    <span class="token comment">&lt;!-- boldMagenta:ç²—çº¢--&gt;</span>    <span class="token comment">&lt;!-- cyan:é’è‰² --&gt;</span>    <span class="token comment">&lt;!-- white:ç™½è‰² --&gt;</span>    <span class="token comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE_LOG_PATTERN<span class="token punctuation">"</span></span>              <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%yellow(%date{yyyy-MM-dd HH:mm:ss}) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ­¤æ—¥å¿—appenderæ˜¯ä¸ºå¼€å‘ä½¿ç”¨ï¼Œåªé…ç½®æœ€åº•çº§åˆ«ï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çº§åˆ«æ˜¯å¤§äºæˆ–ç­‰äºæ­¤çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯--&gt;</span>        <span class="token comment">&lt;!-- ä¾‹å¦‚ï¼šå¦‚æœæ­¤å¤„é…ç½®äº†INFOçº§åˆ«ï¼Œåˆ™åé¢å…¶ä»–ä½ç½®å³ä½¿é…ç½®äº†DEBUGçº§åˆ«çš„æ—¥å¿—ï¼Œä¹Ÿä¸ä¼šè¢«è¾“å‡º --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pattern</span><span class="token punctuation">&gt;</span></span>${CONSOLE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- è®¾ç½®å­—ç¬¦é›† --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span>    <span class="token comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º INFO æ—¥å¿— --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log_info.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- æ¯å¤©æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log.path}/info/log-info-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•infoçº§åˆ«çš„ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º WARN æ—¥å¿— --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log_warn.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log.path}/warn/log-warn-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•warnçº§åˆ«çš„ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>warn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º ERROR æ—¥å¿— --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log_error.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log.path}/error/log-error-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•ERRORçº§åˆ«çš„ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--        &lt;logger&gt;ç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ã€ä»¥åŠæŒ‡å®š&lt;appender&gt;ã€‚        &lt;logger&gt;ä»…æœ‰ä¸€ä¸ªnameå±æ€§ï¼Œ        ä¸€ä¸ªå¯é€‰çš„levelå’Œä¸€ä¸ªå¯é€‰çš„addtivityå±æ€§ã€‚        name:ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»ã€‚        level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œ              å¦‚æœæœªè®¾ç½®æ­¤å±æ€§ï¼Œé‚£ä¹ˆå½“å‰loggerå°†ä¼šç»§æ‰¿ä¸Šçº§çš„çº§åˆ«ã€‚    --&gt;</span>    <span class="token comment">&lt;!--        ä½¿ç”¨mybatisçš„æ—¶å€™ï¼Œsqlè¯­å¥æ˜¯debugä¸‹æ‰ä¼šæ‰“å°ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬åªé…ç½®äº†infoï¼Œæ‰€ä»¥æƒ³è¦æŸ¥çœ‹sqlè¯­å¥çš„è¯ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š        ç¬¬ä¸€ç§æŠŠ&lt;root level="INFO"&gt;æ”¹æˆ&lt;root level="DEBUG"&gt;è¿™æ ·å°±ä¼šæ‰“å°sqlï¼Œä¸è¿‡è¿™æ ·æ—¥å¿—é‚£è¾¹ä¼šå‡ºç°å¾ˆå¤šå…¶ä»–æ¶ˆæ¯        ç¬¬äºŒç§å°±æ˜¯å•ç‹¬ç»™mapperä¸‹ç›®å½•é…ç½®DEBUGæ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹ï¼Œè¿™æ ·é…ç½®sqlè¯­å¥ä¼šæ‰“å°ï¼Œå…¶ä»–è¿˜æ˜¯æ­£å¸¸DEBUGçº§åˆ«ï¼š     --&gt;</span>    <span class="token comment">&lt;!--å¼€å‘ç¯å¢ƒ:æ‰“å°æ§åˆ¶å°--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dev<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--å¯ä»¥è¾“å‡ºé¡¹ç›®ä¸­çš„debugæ—¥å¿—ï¼ŒåŒ…æ‹¬mybatisçš„sqlæ—¥å¿—--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.guli<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>        <span class="token comment">&lt;!--            rootèŠ‚ç‚¹æ˜¯å¿…é€‰èŠ‚ç‚¹ï¼Œç”¨æ¥æŒ‡å®šæœ€åŸºç¡€çš„æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œåªæœ‰ä¸€ä¸ªlevelå±æ€§            level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œé»˜è®¤æ˜¯DEBUG            å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªappenderå…ƒç´ ã€‚        --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--ç”Ÿäº§ç¯å¢ƒ:è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pro<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DEBUG_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>å°†é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶</li></ol><p>GlobalExceptionHandler.java ä¸­</p><p>ç±»ä¸Šæ·»åŠ æ³¨è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼‚å¸¸è¾“å‡ºè¯­å¥</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>å°†æ—¥å¿—å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶</li></ol><p>å®šä¹‰å·¥å…·ç±»</p><p>guli-framework-commonä¸‹åˆ›å»ºutilåŒ…ï¼Œåˆ›å»ºExceptionUtil.javaå·¥å…·ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionUtil</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">StringWriter</span> sw <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">PrintWriter</span> pw <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            sw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            pw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>sw<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å°†å‡ºé”™çš„æ ˆä¿¡æ¯è¾“å‡ºåˆ°printWriterä¸­</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span>pw<span class="token punctuation">)</span><span class="token punctuation">;</span>            pw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>sw <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    sw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>pw <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                pw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> sw<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>GuliExceptionä¸­åˆ›å»ºtoStringæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"GuliException{"</span> <span class="token operator">+</span>        <span class="token string">"message="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>        <span class="token string">", code="</span> <span class="token operator">+</span> code <span class="token operator">+</span>        <span class="token string">'}'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-å‰ç«¯"><a href="#4-å‰ç«¯" class="headerlink" title="4. å‰ç«¯"></a>4. å‰ç«¯</h2><h2 id="å…¶ä»–çŸ¥è¯†"><a href="#å…¶ä»–çŸ¥è¯†" class="headerlink" title="å…¶ä»–çŸ¥è¯†"></a>å…¶ä»–çŸ¥è¯†</h2><h3 id="1-ä¸»é”®çš„ç”Ÿæˆç­–ç•¥"><a href="#1-ä¸»é”®çš„ç”Ÿæˆç­–ç•¥" class="headerlink" title="1.ä¸»é”®çš„ç”Ÿæˆç­–ç•¥"></a>1.ä¸»é”®çš„ç”Ÿæˆç­–ç•¥</h3><ol><li>è‡ªåŠ¨å¢é•¿</li></ol><p>åœ¨MYSQLä¸­æ˜¯AUTO_INCREMENTã€‚åœ¨åˆ†è¡¨ä¸­ï¼Œæ¯”å¦‚å°†ç”¨æˆ·æ•°æ®æ”¾å…¥3å¼ è¡¨ä¸­ï¼Œä¸‹ä¸€å¼ è¡¨éœ€è¦å¾—åˆ°ä¸Šä¸€å¼ è¡¨çš„æœ€åä¸€ä¸ªå€¼åŠ 1æ‰èƒ½è‡ªåŠ¨å¢é•¿ã€‚</p><ol><li>UUID</li></ol><p>æ¯æ¬¡ç”Ÿæˆéšæœºå”¯ä¸€çš„ä¸€ä¸ªå€¼ã€‚ä½†æ˜¯æ’åºä¸æ–¹ä¾¿ï¼Œä¸å¥½ç´¢å¼•ã€‚</p><ol><li>Redisç”ŸæˆIDã€‚</li><li>mpä¸­è‡ªå¸¦ç­–ç•¥</li></ol><p>ä½¿ç”¨snowflakeç®—æ³•ç”Ÿæˆã€‚19ä½idã€‚10bitä½œä¸ºæœºå™¨çš„IDï¼ˆ5bitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5bitæ˜¯æœºå™¨IDï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’å†…çš„æµæ°´å·ï¼Œæœ€åè¿˜æœ‰ç¬¦å·ä½ï¼Œæ°¸è¿œæ˜¯0ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type<span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>IdType</code>çš„ç±»å‹<code>AUTO</code>â€”â€”è‡ªåŠ¨å¢é•¿ã€<code>ID_WORKER</code>â€”â€”ç”Ÿæˆ19ä½å€¼ï¼Œæ•°å­—ç±»å‹ä½¿ç”¨è¿™ç§ç±»å‹ï¼Œæ¯”å¦‚longã€<code>ID_WORKER_STR</code>â€”â€”ç”Ÿæˆ19ä½å€¼ï¼Œå­—ç¬¦ä¸²ç±»å‹ä½¿ç”¨è¿™ç§ç±»å‹ï¼Œæ¯”å¦‚Stringã€<code>INPUTâ€”â€”è®¾ç½®idå€¼</code>ã€<code>NONEï¼šè¾“å…¥</code>ã€<code>UUID</code>â€”â€”éšæœºå”¯ä¸€å€¼ã€‚</p><h3 id="2-è‡ªåŠ¨å¡«å……"><a href="#2-è‡ªåŠ¨å¡«å……" class="headerlink" title="2.è‡ªåŠ¨å¡«å……"></a>2.è‡ªåŠ¨å¡«å……</h3><p>ä¸éœ€è¦setåˆ°å¯¹è±¡é‡Œé¢çš„å€¼ï¼Œä½¿ç”¨mqæ–¹å¼å®ç°æ•°æ®æ·»åŠ ã€‚</p><ol><li>åœ¨å®ä½“ç±»è‡ªåŠ¨å¡«å……å±æ€§ä¸Šæ·»åŠ æ³¨è§£ï¼š</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill<span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT_UPDATE<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>è‡ªå®šä¹‰å®ç°ç±»ï¼Œå®ç°æ¥å£<code>MetaObjectHandler</code>å’Œæ¥å£çš„æ–¹æ³•</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMetaObjectHandler</span> <span class="token keyword">implements</span> <span class="token class-name">MetaObjectHandler</span> <span class="token punctuation">{</span>    <span class="token comment">//ä½¿ç”¨mqå®ç°æ·»åŠ æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œ</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"createTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//ä½¿ç”¨mqå®ç°ä¿®æ”¹æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œ</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-ä¹è§‚é”"><a href="#3-ä¹è§‚é”" class="headerlink" title="3.ä¹è§‚é”"></a>3.ä¹è§‚é”</h3><p>è§£å†³ä¸¢å¤±æ›´æ–°é—®é¢˜ï¼ˆå¤šä¸ªäººåŒæ—¶ä¿®æ”¹åŒä¸€æ¡è®°å½•ï¼Œæœ€åæäº¤çš„æŠŠä¹‹å‰æäº¤çš„æ•°æ®è¦†ç›–ï¼‰ã€‚</p><p>ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼š</p><ol><li>å–å‡ºè®°å½•æ—¶ï¼Œè·å–å½“å‰çš„versionã€‚</li><li>æ›´æ–°æ—¶ï¼Œå¸¦ä¸Šè¿™ä¸ªversionã€‚</li><li>æ‰§è¡Œæ›´æ–°æ—¶ï¼Œ<code>set version = newVersion where version = oldVersion</code></li><li>å¦‚æœversionä¸å¯¹ï¼Œå°±æ›´æ–°å¤±è´¥ã€‚</li></ol><p>ä»£ç ä¸­çš„å®ç°ï¼š</p><ol><li><p>è¡¨ä¸­åŠ å­—æ®µversion</p></li><li><p>ç±»ä¸­åŠ å±æ€§versionï¼Œå¹¶ä¸”æ·»åŠ <code>@Version</code>æ³¨è§£</p></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Version</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> version<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li>é…ç½®ä¹è§‚é”æ’ä»¶</li></ol><h3 id="4-åˆ†é¡µæŸ¥è¯¢"><a href="#4-åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="4.åˆ†é¡µæŸ¥è¯¢"></a>4.åˆ†é¡µæŸ¥è¯¢</h3><ol><li>é…ç½®åˆ†é¡µæ’ä»¶</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//åˆ†é¡µæ’ä»¶</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">PaginationInterceptor</span> <span class="token function">paginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>ç¼–å†™åˆ†é¡µä»£ç </li></ol><p>ç›´æ¥new pageå¯¹è±¡ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•°ã€‚è°ƒå…¥mpæ–¹æ³•å®ç°åˆ†é¡µæŸ¥è¯¢ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//ç¬¬ä¸€ä¸ªå‚æ•° å½“å‰é¡µ ç¬¬äºŒä¸ª æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</span>    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è°ƒç”¨mpåˆ†é¡µæŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œåº•å±‚å°è£…æŠŠåˆ†é¡µæ‰€æœ‰æ•°æ®å°è£…åˆ°pageå¯¹è±¡é‡Œé¢ã€‚</span>    userMaper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//é€šè¿‡pageå¯¹è±¡è·å–æ‰€æœ‰æ•°æ®</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-é€»è¾‘åˆ é™¤"><a href="#5-é€»è¾‘åˆ é™¤" class="headerlink" title="5. é€»è¾‘åˆ é™¤"></a>5. é€»è¾‘åˆ é™¤</h3><p>æ•°æ®åº“è¡¨ä¸­åŠ ä¸Šä¸€åˆ—<code>deleted</code></p><ul><li>ç‰©ç†åˆ é™¤ï¼šæ•°æ®çœŸçš„ä¸åœ¨äº†ï¼Œåœ¨ç¡¬ä»¶ä¸Šåˆ é™¤ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> userMaper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç‰©ç†åˆ é™¤</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteBatchIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> userMaper<span class="token punctuation">.</span><span class="token function">deleteBatchIds</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰¹é‡åˆ é™¤</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é€»è¾‘åˆ é™¤ï¼šé€»è¾‘ä¸Šåˆ é™¤ï¼Œä½†æ•°æ®å®é™…è¿˜å­˜åœ¨ã€‚</li></ul><ol><li>è¡¨ä¸­æ·»åŠ é€»è¾‘åˆ é™¤å­—æ®µï¼Œå¯¹åº”å®ä½“ç±»æ·»åŠ å±æ€§ã€‚</li></ol><p>java</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableLogic</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> deleted<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li>é…ç½®é€»è¾‘æ’ä»¶</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">ISqlInjector</span> <span class="token function">sqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogicSqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol><li>å†è°ƒç”¨åˆ é™¤è¯­å¥ï¼Œå°±ä¼šå°†deletedå­—æ®µç½®ä¸º1ã€‚ï¼ˆå‡è£…åˆ é™¤ï¼‰</li></ol><p>å…¶åº•å±‚çš„sqlè¯­å¥æ˜¯<code>UPDATE user SET deleted=1 WHERE id=? AND deleted=0</code></p><h2 id="é¡¹ç›®æ€»ç»“"><a href="#é¡¹ç›®æ€»ç»“" class="headerlink" title="é¡¹ç›®æ€»ç»“"></a>é¡¹ç›®æ€»ç»“</h2><p>é—®é¢˜ï¼š</p><ol><li>å‰ç«¯é—®é¢˜-è·¯ç”±åˆ‡æ¢é—®é¢˜</li></ol><p>å¤šæ¬¡è·¯ç”±è·³è½¬åˆ°åŒä¸€ä¸ªvueé¡µé¢ï¼Œé¡µé¢ä¸­çš„createdæ–¹æ³•åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨vueç›‘å¬ã€‚</p><ol start="2"><li><p>å‰ç«¯-ES6 çš„æ¨¡å—åŒ–è¿è¡Œä¸èƒ½åœ¨es5ä¸­è¿è¡Œã€‚ ä½¿ç”¨babelæŠŠes6ä»£ç è½¬ä¸ºes5ã€‚</p></li><li><p>åç«¯ï¼Œmpç”Ÿæˆ19ä½idé—®é¢˜ã€‚åå°åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå†™æˆStringæ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœå†™æˆlongä¼šåªæœ‰16ä½ï¼Œåä¸‰ä½æ²¡æœ‰ã€‚</p></li><li><p>è·¨åŸŸé—®é¢˜ã€‚ åŠ äº†æ³¨è§£crossoriginã€‚</p></li><li><p>413 çŠ¶æ€ç ã€‚nginxå¤§å°æœ‰é™åˆ¶ï¼Œå¦‚æœè¶…è¿‡ä¸Šä¼ å¤§å°ä¼šæœ‰413é—®é¢˜ã€‚nginxä¸­é…ç½®å®¢æˆ·ç«¯å¤§å°ã€‚ è·¨åŸŸ 403. 302é‡å®šå‘ï¼ˆä¸€ä¸ªåœ°å€è·³åˆ°å¦ä¸€ä¸ªåœ°å€ï¼‰ã€‚</p></li><li><p>MavenåŠ è½½é—®é¢˜</p></li></ol><p>mavenåŠ è½½é¡¹ç›®æ—¶ï¼Œé»˜è®¤ä¸ä¼šåŠ è½½src-javaæ–‡ä»¶å¤¹é‡Œé¢çš„xmlç±»å‹çš„æ–‡ä»¶çš„ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š1.ç›´æ¥å¤åˆ¶xmlæ–‡ä»¶åˆ°targetç›®å½•ã€‚</p><ol start="2"><li>mybatisplus locations æ¥é…ç½®</li></ol><p>é¡¹ç›®æè¿°ï¼š</p><p>åœ¨çº¿æ•™è‚²ç³»ç»Ÿï¼Œåˆ†ä¸ºå‰å°ç½‘ç«™ç³»ç»Ÿå’Œåå°è¿è¥ç³»ç»Ÿï¼ŒB2Cæ¨¡å¼ã€‚</p><p>å‰å°ç³»ç»ŸåŒ…æ‹¬è¯¾ç¨‹ã€è®²å¸ˆã€é—®ç­”ã€æ–‡ç« å‡ ä¸ªéƒ¨åˆ†ï¼Œä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå‰åç«¯åˆ†ç¦»å¼€å‘ã€‚</p><p>åç«¯çš„ä¸»è¦æŠ€æœ¯æ¶æ„æ˜¯ï¼šSpringBoot + SpringCloud + Mybatis-Plus +  nginx</p><p>å‰ç«¯çš„ä¸»è¦æ¶æ„æ˜¯ï¼šNode.js + vue + element-ui + NUXT + Echarts</p><p>ç¬¬ä¸‰æ–¹æŠ€æœ¯åŒ…æ‹¬ï¼šé˜¿é‡Œäº‘OSS + è§†é¢‘ç‚¹æ’­ã€çŸ­ä¿¡æœåŠ¡ç­‰ã€‚</p><p>æ¶‰åŠåˆ°çš„ä¸­é—´ä»¶æœ‰</p><p>æˆ‘åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä¸»è¦è´Ÿè´£ å‰å°å¾®ä¿¡æ”¯ä»˜å’Œç™»å½•ï¼Œè´Ÿè´£åå°æƒé™ç®¡ç†å’Œç»Ÿè®¡åˆ†æã€‚</p><h3 id="1-å•ç‚¹ç™»å½•"><a href="#1-å•ç‚¹ç™»å½•" class="headerlink" title="1. å•ç‚¹ç™»å½•"></a>1. å•ç‚¹ç™»å½•</h3><ol><li>sessionå…±äº«</li></ol><p>æœ¬è´¨ä¸Šæ—¶sessionå¤åˆ¶ï¼Œå½“ç”¨æˆ·ç™»å½•å½“å‰æ¨¡å—åï¼Œå°†sessionå¤åˆ¶åˆ°å…¶ä»–æ¨¡å—ã€‚</p><ol start="2"><li>redis + cookie</li></ol><p>ç”¨æˆ·è®¿é—®åˆ°æŸä¸€ä¸ªæ¨¡å—åï¼Œé€šè¿‡ipã€idç­‰ç”Ÿæˆä¸€ä¸ªå…¨å±€éšæœºå”¯ä¸€å€¼keyï¼Œç„¶åç”¨æˆ·ä¿¡æ¯æ”¾å…¥redisç¼“å­˜ä¸­ï¼ˆkeyå¯¹åº”çš„ï¼‰ã€‚æŠŠredisé‡Œé¢ç”Ÿæˆçš„keyæ”¾å…¥cookieé‡Œé¢ã€‚</p><p>è®¿é—®å…¶ä»–æ¨¡å—ï¼Œå‘é€è¯·æ±‚å¸¦ç€cookieå‘é€ï¼Œè·å–cookieå€¼ï¼Œæ‹¿ç€cookieåšäº‹æƒ…ã€‚é€šè¿‡cookieæŸ¥rediså¾—åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚</p><ol start="3"><li><p>token</p></li><li><p>åœ¨é¡¹ç›®æŸä¸ªæ¨¡å—è¿›è¡Œç™»å½•ï¼Œç™»å½•ä¹‹åï¼ŒæŒ‰ç…§è§„åˆ™ç¼–ç ç”Ÿæˆå­—ç¬¦ä¸²ï¼ˆç™»é™†åçš„ç”¨æˆ·ä¿¡æ¯åŒ…å«åˆ°å­—ç¬¦ä¸²é‡Œï¼‰ï¼ŒæŠŠå­—ç¬¦ä¸²è¿”å›ï¼ˆå¯ä»¥é€šè¿‡cookieè¿”å›ï¼‰æˆ–è€…æŠŠå­—ç¬¦ä¸²é€šè¿‡åœ°å€æ è¿”å›ã€‚</p></li><li><p>å†å»è®¿é—®å…¶ä»–æ¨¡å—ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šå¸¦ç€ç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œæ ¹æ®å­—ç¬¦è§£ç ç”¨æˆ·ä¿¡æ¯ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mavenæ‰“åŒ…</title>
      <link href="2021/06/10/maven/"/>
      <url>2021/06/10/maven/</url>
      
        <content type="html"><![CDATA[<h2 id="1-æ‰“åŒ…é—®é¢˜"><a href="#1-æ‰“åŒ…é—®é¢˜" class="headerlink" title="1.æ‰“åŒ…é—®é¢˜"></a>1.æ‰“åŒ…é—®é¢˜</h2><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><p>parentï¼ˆçˆ¶ç±»å·¥ç¨‹ï¼‰</p><p>| - - - - - commonï¼ˆé€šç”¨å·¥å…·ç±»å­å·¥ç¨‹ï¼‰</p><p>| - - - - - projectAï¼ˆspringbootå­å·¥ç¨‹ï¼Œä¾èµ–commonå·¥ç¨‹ï¼‰</p><p>pom.xml</p><p>é—®é¢˜æè¿°ï¼š</p><p>é€šè¿‡parentçˆ¶å·¥ç¨‹è¿›è¡ŒMaven installï¼Œparentçˆ¶å·¥ç¨‹å’Œcommonå­å·¥ç¨‹æ‰“åŒ…æˆåŠŸï¼ŒprojectAå­å·¥ç¨‹æ‰“åŒ…å¤±è´¥å¹¶æŠ¥é”™</p><p>[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.1:compile (default-compile) on project projectA: Compilation failure<br>[ERROR] /xxxx.java:[14,36] ç¨‹åºåŒ…com.xxx.xxx.utilsä¸å­˜åœ¨</p><p>è§£å†³åŠæ³•ï¼š</p><p>åœ¨commonå­å·¥ç¨‹ä¸‹çš„pom.xmlï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classifier</span><span class="token punctuation">&gt;</span></span>exec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classifier</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸå› åˆ†æï¼š</p><p>commonä¹Ÿæ˜¯SpringBootå·¥ç¨‹ï¼ŒSpringBootå·¥ç¨‹æ‰“åŒ…ç¼–è¯‘æ—¶ï¼Œä¼šç”Ÿæˆä¸¤ç§jaråŒ…ï¼Œä¸€ç§æ˜¯æ™®é€šçš„jarï¼Œå¦ä¸€ç§æ˜¯å¯æ‰§è¡Œjarã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ç§jarçš„åç§°ç›¸åŒï¼Œåœ¨ä¸åšé…ç½®çš„æƒ…å†µä¸‹ï¼Œæ™®é€šçš„jarå…ˆç”Ÿæˆï¼Œå¯æ‰§è¡Œjaråç”Ÿæˆï¼Œé€ æˆå¯æ‰§è¡Œjarä¼šè¦†ç›–æ™®é€šçš„jarã€‚è€ŒprojectAå·¥ç¨‹æ— æ³•ä¾èµ–commonå·¥ç¨‹çš„å¯æ‰§è¡Œjarï¼Œæ‰€ä»¥ç¼–è¯‘å¤±è´¥ï¼šç¨‹åºåŒ…xxxä¸å­˜åœ¨ã€‚</p><h1 id="2-æœ¬åœ°ä»“åº“é…ç½®"><a href="#2-æœ¬åœ°ä»“åº“é…ç½®" class="headerlink" title="2.æœ¬åœ°ä»“åº“é…ç½®"></a>2.æœ¬åœ°ä»“åº“é…ç½®</h1><p>1.å»mavenå®˜ç½‘ä¸‹è½½mavençš„äºŒè¿›åˆ¶æ–‡ä»¶</p><p><img src="https://img2018.cnblogs.com/common/1580157/202002/1580157-20200218232409716-1017638258.png" alt="img"></p><p>2.ä¸‹è½½å®Œåï¼ŒæŠŠå®ƒè§£å‹è‡³ä»»æ„æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œæˆ‘æ”¾åˆ°Cç›˜</p><p>3.é…ç½®MAVEN_HOMEç¯å¢ƒå˜é‡ã€‚</p><p><img src="https://img2018.cnblogs.com/common/1580157/202002/1580157-20200218232455413-2062573888.png" alt="img"></p><p>4.åœ¨window10ç¯å¢ƒå˜é‡pathä¸­æ·»åŠ %MAVEN_HOME%\bin</p><p><img src="https://img2020.cnblogs.com/blog/1580157/202005/1580157-20200527214752594-207679886.png" alt="img"></p><p>5.åœ¨windowå‘½ä»¤è¡Œçª—å£é‡Œé¢æ‰§è¡Œmavenå‘½ä»¤ mvn -vï¼ŒæŸ¥çœ‹mavenæ˜¯å¦å®‰è£…æˆåŠŸï¼Œç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®æˆåŠŸã€‚</p><p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>C:\Users\Administrator&gt;mvn -v<br>Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)<br>Maven home: C:\Program Files\apache-maven-3.6.3\bin..<br>Java version: 1.8.0_221, vendor: Oracle Corporation, runtime: C:\Program Files\Java\jdk1.8.0_221\jre<br>Default locale: en_US, platform encoding: GBK<br>OS name: â€œwindows 10â€, version: â€œ10.0â€, arch: â€œamd64â€, family: â€œwindowsâ€</p><p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p><img src="https://img2018.cnblogs.com/common/1580157/202002/1580157-20200218232607093-617091844.png" alt="img"></p><p>6.mavençš„repositoryé»˜è®¤æ˜¯åœ¨C:\Users\ç”¨æˆ·å.m2ï¼Œè¿™é‡Œæˆ‘è®¾ç½®è‡ªå·±å–œæ¬¢çš„è·¯å¾„ï¼ˆä»¥ä¸‹ä¸ºå¯é€‰æ­¥éª¤ï¼‰</p><p><em>C:\Program Files\apache-maven-3.6.3\maven-repository</em></p><p><img src="https://img2018.cnblogs.com/common/1580157/202002/1580157-20200218232724365-1847630664.png" alt="img"></p><p>7.åœ¨mavenå®‰è£…è·¯å¾„é‡Œé¢æ‰¾åˆ°confè¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°settings.xmlæ–‡ä»¶.</p><p>åœ¨settings.xmlæ‰¾åˆ°localRepository,å¹¶æ›´æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±çš„maven repositoryè·¯å¾„. localRepositoryé»˜è®¤æ˜¯æ³¨é‡Šæ‰çš„ã€‚</p><p><em><localrepository>C:\Program Files\apache-maven-3.6.3\maven-repository</localrepository></em></p><p><img src="https://img2018.cnblogs.com/common/1580157/202002/1580157-20200218232809155-329236747.png" alt="img"></p><p>8.åœ¨dosæ‰§è¡Œä»¥ä¸‹mavenå‘½ä»¤ï¼Œå¦‚æœlocal repositoryè®¾ç½®æˆåŠŸï¼Œlocal repositoryé‡Œé¢ä¼šç”Ÿæˆä¸€äº›ä¸œè¥¿ã€‚</p><pre class="line-numbers language-none"><code class="language-none">mvn help:system<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ideaé…ç½®mavenå¹¶æ›´æ”¹mavençš„ä¸­å¤®ä»“åº“ä¸ºé˜¿é‡Œäº‘</p><p><a href="https://www.cnblogs.com/majestyking/p/12329535.html">https://www.cnblogs.com/majestyking/p/12329535.html</a></p>]]></content>
      
      
      <categories>
          
          <category> maven </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>linuxåŸºç¡€</title>
      <link href="2021/06/10/linux-ji-chu/"/>
      <url>2021/06/10/linux-ji-chu/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‘½ä»¤1"><a href="#1-å‘½ä»¤1" class="headerlink" title="1.å‘½ä»¤1"></a>1.å‘½ä»¤1</h2><h3 id="1-é‡å‘½åæ–‡ä»¶å¤¹"><a href="#1-é‡å‘½åæ–‡ä»¶å¤¹" class="headerlink" title="1. é‡å‘½åæ–‡ä»¶å¤¹"></a>1. é‡å‘½åæ–‡ä»¶å¤¹</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mv souce target # ç›´æ¥ä½¿ç”¨mvå°±å¥½äº†ï¼Œåœ¨æœ¬åœ°ç›¸å½“äºè¦†ç›–åœ°æ”¹äº†<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-æŸ¥çœ‹å½“å‰è·¯å¾„"><a href="#2-æŸ¥çœ‹å½“å‰è·¯å¾„" class="headerlink" title="2. æŸ¥çœ‹å½“å‰è·¯å¾„"></a>2. æŸ¥çœ‹å½“å‰è·¯å¾„</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pwd-L å¦‚æœ PWD ç¯å¢ƒå˜é‡åŒ…å«äº†ä¸åŒ…å«æ–‡ä»¶å .ï¼ˆç‚¹è¡¨ç¤ºå½“å‰ç›®å½•ï¼‰æˆ– ..ï¼ˆç‚¹ç‚¹è¡¨ç¤ºçˆ¶ç›®å½•ï¼‰çš„å½“å‰ç›®å½•çš„ç»å¯¹è·¯å¾„åï¼Œåˆ™æ˜¾ç¤º PWD ç¯å¢ƒå˜é‡çš„å€¼ã€‚å¦åˆ™ï¼Œ-L æ ‡å¿—ä¸ -P æ ‡å¿—ä¸€æ ·è¿è¡Œã€‚ -P æ˜¾ç¤ºå½“å‰ç›®å½•çš„ç»å¯¹è·¯å¾„åã€‚ä¸ -P æ ‡å¿—ä¸€èµ·æ˜¾ç¤ºçš„ç»å¯¹è·¯å¾„ä¸åŒ…å«åœ¨è·¯å¾„åçš„ç»å¯¹è·¯å¾„ä¸­æ¶‰åŠåˆ°ç¬¦å·é“¾æ¥ç±»å‹çš„æ–‡ä»¶çš„åç§°ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-ä¿®æ”¹ç¯å¢ƒå˜é‡"><a href="#3-ä¿®æ”¹ç¯å¢ƒå˜é‡" class="headerlink" title="3. ä¿®æ”¹ç¯å¢ƒå˜é‡"></a>3. ä¿®æ”¹ç¯å¢ƒå˜é‡</h3><p>ä½¿ç”¨exportå‘½ä»¤ç›´æ¥ä¿®æ”¹PATHçš„å€¼ï¼Œé…ç½®MySQLè¿›å…¥ç¯å¢ƒå˜é‡çš„æ–¹æ³•:</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">export PATH=/home/uusama/mysql/bin:$PATH#æˆ–è€…æŠŠPATHæ”¾åœ¨å‰é¢export PATH=$PATH:/home/uusama/mysql/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ç”Ÿæ•ˆæ—¶é—´ï¼šç«‹å³ç”Ÿæ•ˆ</li><li>ç”Ÿæ•ˆæœŸé™ï¼šå½“å‰ç»ˆç«¯æœ‰æ•ˆï¼Œçª—å£å…³é—­åæ— æ•ˆ</li><li>ç”Ÿæ•ˆèŒƒå›´ï¼šä»…å¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆ</li><li>é…ç½®çš„ç¯å¢ƒå˜é‡ä¸­ä¸è¦å¿˜äº†åŠ ä¸ŠåŸæ¥çš„é…ç½®ï¼Œå³$PATHéƒ¨åˆ†ï¼Œé¿å…è¦†ç›–åŸæ¥é…ç½®</li></ul><h4 id="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•äºŒï¼švim-bashrc"><a href="#Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•äºŒï¼švim-bashrc" class="headerlink" title="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•äºŒï¼švim ~/.bashrc"></a>Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•äºŒï¼švim ~/.bashrc</h4><p>é€šè¿‡ä¿®æ”¹ç”¨æˆ·ç›®å½•ä¸‹çš„~/.bashrcæ–‡ä»¶è¿›è¡Œé…ç½®ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim ~/.bashrc# åœ¨æœ€åä¸€è¡ŒåŠ ä¸Šexport PATH=$PATH:/home/uusama/mysql/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ç”Ÿæ•ˆæ—¶é—´ï¼šä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·æ‰“å¼€æ–°çš„ç»ˆç«¯æ—¶ç”Ÿæ•ˆï¼Œæˆ–è€…æ‰‹åŠ¨source ~/.bashrcç”Ÿæ•ˆ</li><li>ç”Ÿæ•ˆæœŸé™ï¼šæ°¸ä¹…æœ‰æ•ˆ</li><li>ç”Ÿæ•ˆèŒƒå›´ï¼šä»…å¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆ</li><li>å¦‚æœæœ‰åç»­çš„ç¯å¢ƒå˜é‡åŠ è½½æ–‡ä»¶è¦†ç›–äº†PATHå®šä¹‰ï¼Œåˆ™å¯èƒ½ä¸ç”Ÿæ•ˆ</li></ul><h4 id="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•ä¸‰ï¼švim-bash-profile"><a href="#Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•ä¸‰ï¼švim-bash-profile" class="headerlink" title="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•ä¸‰ï¼švim ~/.bash_profile"></a>Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•ä¸‰ï¼švim ~/.bash_profile</h4><p>å’Œä¿®æ”¹~/.bashrcæ–‡ä»¶ç±»ä¼¼ï¼Œä¹Ÿæ˜¯è¦åœ¨æ–‡ä»¶æœ€ååŠ ä¸Šæ–°çš„è·¯å¾„å³å¯ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim ~/.bash_profile# åœ¨æœ€åä¸€è¡ŒåŠ ä¸Šexport PATH=$PATH:/home/uusama/mysql/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ç”Ÿæ•ˆæ—¶é—´ï¼šä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·æ‰“å¼€æ–°çš„ç»ˆç«¯æ—¶ç”Ÿæ•ˆï¼Œæˆ–è€…æ‰‹åŠ¨source ~/.bash_profileç”Ÿæ•ˆ</li><li>ç”Ÿæ•ˆæœŸé™ï¼šæ°¸ä¹…æœ‰æ•ˆ</li><li>ç”Ÿæ•ˆèŒƒå›´ï¼šä»…å¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆ</li><li>å¦‚æœæ²¡æœ‰<del>/.bash_profileæ–‡ä»¶ï¼Œåˆ™å¯ä»¥ç¼–è¾‘</del>/.profileæ–‡ä»¶æˆ–è€…æ–°å»ºä¸€ä¸ª</li></ul><h4 id="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•å››ï¼švim-etc-bashrc"><a href="#Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•å››ï¼švim-etc-bashrc" class="headerlink" title="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•å››ï¼švim /etc/bashrc"></a>Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•å››ï¼švim /etc/bashrc</h4><p>è¯¥æ–¹æ³•æ˜¯ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼ˆå¦‚rootï¼‰æˆ–è€…å¯¹è¯¥æ–‡ä»¶çš„å†™å…¥æƒé™ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># å¦‚æœ/etc/bashrcæ–‡ä»¶ä¸å¯ç¼–è¾‘ï¼Œéœ€è¦ä¿®æ”¹ä¸ºå¯ç¼–è¾‘chmod -v u+w /etc/bashrcvim /etc/bashrc# åœ¨æœ€åä¸€è¡ŒåŠ ä¸Šexport PATH=$PATH:/home/uusama/mysql/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ç”Ÿæ•ˆæ—¶é—´ï¼šæ–°å¼€ç»ˆç«¯ç”Ÿæ•ˆï¼Œæˆ–è€…æ‰‹åŠ¨source /etc/bashrcç”Ÿæ•ˆ</li><li>ç”Ÿæ•ˆæœŸé™ï¼šæ°¸ä¹…æœ‰æ•ˆ</li><li>ç”Ÿæ•ˆèŒƒå›´ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆ</li></ul><h4 id="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•äº”ï¼švim-etc-profile"><a href="#Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•äº”ï¼švim-etc-profile" class="headerlink" title="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•äº”ï¼švim /etc/profile"></a>Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•äº”ï¼švim /etc/profile</h4><p>è¯¥æ–¹æ³•ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™æˆ–è€…å¯¹è¯¥æ–‡ä»¶çš„å†™å…¥æƒé™ï¼Œå’Œvim /etc/bashrcç±»ä¼¼ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># å¦‚æœ/etc/profileæ–‡ä»¶ä¸å¯ç¼–è¾‘ï¼Œéœ€è¦ä¿®æ”¹ä¸ºå¯ç¼–è¾‘chmod -v u+w /etc/profilevim /etc/profile# åœ¨æœ€åä¸€è¡ŒåŠ ä¸Šexport PATH=$PATH:/home/uusama/mysql/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ç”Ÿæ•ˆæ—¶é—´ï¼šæ–°å¼€ç»ˆç«¯ç”Ÿæ•ˆï¼Œæˆ–è€…æ‰‹åŠ¨source /etc/profileç”Ÿæ•ˆ</li><li>ç”Ÿæ•ˆæœŸé™ï¼šæ°¸ä¹…æœ‰æ•ˆ</li><li>ç”Ÿæ•ˆèŒƒå›´ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆ</li></ul><h4 id="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•å…­ï¼švim-etc-environment"><a href="#Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•å…­ï¼švim-etc-environment" class="headerlink" title="Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•å…­ï¼švim /etc/environment"></a>Linuxç¯å¢ƒå˜é‡é…ç½®æ–¹æ³•å…­ï¼švim /etc/environment</h4><p>è¯¥æ–¹æ³•æ˜¯ä¿®æ”¹ç³»ç»Ÿç¯å¢ƒé…ç½®æ–‡ä»¶ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™æˆ–è€…å¯¹è¯¥æ–‡ä»¶çš„å†™å…¥æƒé™ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># å¦‚æœ/etc/bashrcæ–‡ä»¶ä¸å¯ç¼–è¾‘ï¼Œéœ€è¦ä¿®æ”¹ä¸ºå¯ç¼–è¾‘chmod -v u+w /etc/environmentvim /etc/profile# åœ¨æœ€åä¸€è¡ŒåŠ ä¸Šexport PATH=$PATH:/home/uusama/mysql/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ç”Ÿæ•ˆæ—¶é—´ï¼šæ–°å¼€ç»ˆç«¯ç”Ÿæ•ˆï¼Œæˆ–è€…æ‰‹åŠ¨source /etc/environmentç”Ÿæ•ˆ</li><li>ç”Ÿæ•ˆæœŸé™ï¼šæ°¸ä¹…æœ‰æ•ˆ</li><li>ç”Ÿæ•ˆèŒƒå›´ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆ</li></ul><h4 id="Linuxç¯å¢ƒå˜é‡åŠ è½½åŸç†è§£æ"><a href="#Linuxç¯å¢ƒå˜é‡åŠ è½½åŸç†è§£æ" class="headerlink" title="Linuxç¯å¢ƒå˜é‡åŠ è½½åŸç†è§£æ"></a>Linuxç¯å¢ƒå˜é‡åŠ è½½åŸç†è§£æ</h4><p>ä¸Šé¢åˆ—å‡ºäº†ç¯å¢ƒå˜é‡çš„å„ç§é…ç½®æ–¹æ³•ï¼Œé‚£ä¹ˆLinuxæ˜¯å¦‚ä½•åŠ è½½è¿™äº›é…ç½®çš„å‘¢ï¼Ÿæ˜¯ä»¥ä»€ä¹ˆæ ·çš„é¡ºåºåŠ è½½çš„å‘¢ï¼Ÿ</p><p>ç‰¹å®šçš„åŠ è½½é¡ºåºä¼šå¯¼è‡´ç›¸åŒåç§°çš„ç¯å¢ƒå˜é‡å®šä¹‰è¢«è¦†ç›–æˆ–è€…ä¸ç”Ÿæ•ˆã€‚</p><p>ç¯å¢ƒå˜é‡çš„åˆ†ç±»</p><p>ç¯å¢ƒå˜é‡å¯ä»¥ç®€å•çš„åˆ†æˆç”¨æˆ·è‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡ä»¥åŠç³»ç»Ÿçº§åˆ«çš„ç¯å¢ƒå˜é‡ã€‚</p><ul><li>ç”¨æˆ·çº§åˆ«ç¯å¢ƒå˜é‡å®šä¹‰æ–‡ä»¶ï¼š~/.bashrcã€~/.profileï¼ˆéƒ¨åˆ†ç³»ç»Ÿä¸ºï¼š~/.bash_profileï¼‰</li><li>ç³»ç»Ÿçº§åˆ«ç¯å¢ƒå˜é‡å®šä¹‰æ–‡ä»¶ï¼š/etc/bashrcã€/etc/profile(éƒ¨åˆ†ç³»ç»Ÿä¸ºï¼š/etc/bash_profileï¼‰ã€/etc/environment</li></ul><p>å¦å¤–åœ¨ç”¨æˆ·ç¯å¢ƒå˜é‡ä¸­ï¼Œç³»ç»Ÿä¼šé¦–å…ˆè¯»å–<del>/.bash_profileï¼ˆæˆ–è€…</del>/.profileï¼‰æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰è¯¥æ–‡ä»¶åˆ™è¯»å–<del>/.bash_loginï¼Œæ ¹æ®è¿™äº›æ–‡ä»¶ä¸­å†…å®¹å†å»è¯»å–</del>/.bashrcã€‚</p><h4 id="æµ‹è¯•Linuxç¯å¢ƒå˜é‡åŠ è½½é¡ºåºçš„æ–¹æ³•"><a href="#æµ‹è¯•Linuxç¯å¢ƒå˜é‡åŠ è½½é¡ºåºçš„æ–¹æ³•" class="headerlink" title="æµ‹è¯•Linuxç¯å¢ƒå˜é‡åŠ è½½é¡ºåºçš„æ–¹æ³•"></a>æµ‹è¯•Linuxç¯å¢ƒå˜é‡åŠ è½½é¡ºåºçš„æ–¹æ³•</h4><p>ä¸ºäº†æµ‹è¯•å„ä¸ªä¸åŒæ–‡ä»¶çš„ç¯å¢ƒå˜é‡åŠ è½½é¡ºåºï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªç¯å¢ƒå˜é‡å®šä¹‰æ–‡ä»¶ä¸­çš„ç¬¬ä¸€è¡Œéƒ½å®šä¹‰ç›¸åŒçš„ç¯å¢ƒå˜é‡UU_ORDERï¼Œè¯¥å˜é‡çš„å€¼ä¸ºæœ¬èº«çš„å€¼è¿æ¥ä¸Šå½“å‰æ–‡ä»¶åç§°ã€‚</p><p>éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">/etc/environment/etc/profile/etc/profile.d/test.shï¼Œæ–°å»ºæ–‡ä»¶ï¼Œæ²¡æœ‰æ–‡ä»¶å¤¹å¯ç•¥è¿‡/etc/bashrcï¼Œæˆ–è€…/etc/bash.bashrc~/.bash_profileï¼Œæˆ–è€…~/.profile~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­çš„ç¬¬ä¸€è¡Œéƒ½åŠ ä¸Šä¸‹é¢è¿™å¥ä»£ç ï¼Œå¹¶ç›¸åº”çš„æŠŠå†’å·åçš„å†…å®¹ä¿®æ”¹ä¸ºå½“å‰æ–‡ä»¶çš„ç»å¯¹æ–‡ä»¶åã€‚</p><pre class="line-numbers language-none"><code class="language-none">export UU_ORDER="$UU_ORDER:~/.bash_profile"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹å®Œä¹‹åä¿å­˜ï¼Œæ–°å¼€ä¸€ä¸ªçª—å£ï¼Œç„¶åecho $UU_ORDERè§‚å¯Ÿå˜é‡çš„å€¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">uusama@ubuntu:~$ echo $UU_ORDER$UU_ORDER:/etc/environment:/etc/profile:/etc/bash.bashrc:/etc/profile.d/test.sh:~/.profile:~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯ä»¥æ¨æµ‹å‡ºLinuxåŠ è½½ç¯å¢ƒå˜é‡çš„é¡ºåºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">/etc/environment/etc/profile/etc/bash.bashrc/etc/profile.d/test.sh~/.profile~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Linuxç¯å¢ƒå˜é‡æ–‡ä»¶åŠ è½½è¯¦è§£"><a href="#Linuxç¯å¢ƒå˜é‡æ–‡ä»¶åŠ è½½è¯¦è§£" class="headerlink" title="Linuxç¯å¢ƒå˜é‡æ–‡ä»¶åŠ è½½è¯¦è§£"></a>Linuxç¯å¢ƒå˜é‡æ–‡ä»¶åŠ è½½è¯¦è§£</h4><p>ç”±ä¸Šé¢çš„æµ‹è¯•å¯å®¹æ˜“å¾—å‡ºLinuxåŠ è½½ç¯å¢ƒå˜é‡çš„é¡ºåºå¦‚ä¸‹ï¼Œï¼š</p><p>ç³»ç»Ÿç¯å¢ƒå˜é‡ -&gt; ç”¨æˆ·è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ /etc/environment -&gt; /etc/profile -&gt; ~/.profile</p><p>æ‰“å¼€/etc/profileæ–‡ä»¶ä½ ä¼šå‘ç°ï¼Œè¯¥æ–‡ä»¶çš„ä»£ç ä¸­ä¼šåŠ è½½/etc/bash.bashrcæ–‡ä»¶ï¼Œç„¶åæ£€æŸ¥/etc/profile.d/ç›®å½•ä¸‹çš„.shæ–‡ä»¶å¹¶åŠ è½½ã€‚</p><pre class="line-numbers language-none"><code class="language-none"># /etc/profile: system-wide .profile file for the Bourne shell (sh(1))# and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).if [ "$PS1" ]; then  if [ "$BASH" ] &amp;&amp; [ "$BASH" != "/bin/sh" ]; then    # The file bash.bashrc already sets the default PS1.    # PS1='h:w$ '    if [ -f /etc/bash.bashrc ]; then      . /etc/bash.bashrc    fi  else    if [ "`id -u`" -eq 0 ]; then      PS1='# '    else      PS1='$ '    fi  fifiif [ -d /etc/profile.d ]; then  for i in /etc/profile.d/*.sh; do    if [ -r $i ]; then      . $i    fi  done  unset ifi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶æ¬¡å†æ‰“å¼€<del>/.profileæ–‡ä»¶ï¼Œä¼šå‘ç°è¯¥æ–‡ä»¶ä¸­åŠ è½½äº†</del>/.bashrcæ–‡ä»¶ã€‚</p><pre class="line-numbers language-none"><code class="language-none"># if running bashif [ -n "$BASH_VERSION" ]; then    # include .bashrc if it exists    if [ -f "$HOME/.bashrc" ]; then . "$HOME/.bashrc"    fifi# set PATH so it includes user's private bin directoriesPATH="$HOME/bin:$HOME/.local/bin:$PATH"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»~/.profileæ–‡ä»¶ä¸­ä»£ç ä¸éš¾å‘ç°ï¼Œ/.profileæ–‡ä»¶åªåœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™è¯»å–ä¸€æ¬¡ï¼Œè€Œ/.bashrcä¼šåœ¨æ¯æ¬¡è¿è¡ŒShellè„šæœ¬çš„æ—¶å€™è¯»å–ä¸€æ¬¡ã€‚</p><h4 id="ä¸€äº›å°æŠ€å·§"><a href="#ä¸€äº›å°æŠ€å·§" class="headerlink" title="ä¸€äº›å°æŠ€å·§"></a>ä¸€äº›å°æŠ€å·§</h4><p>å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œæ¯”å¦‚åœ¨æŸä¸ªé¡¹ç›®ä¸‹å®šä¹‰uusama.profileï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨exportå®šä¹‰ä¸€ç³»åˆ—å˜é‡ï¼Œç„¶ååœ¨~/.profileæ–‡ä»¶åé¢åŠ ä¸Šï¼šsourc uusama.profileï¼Œè¿™æ ·ä½ æ¯æ¬¡ç™»é™†éƒ½å¯ä»¥åœ¨Shellè„šæœ¬ä¸­ä½¿ç”¨è‡ªå·±å®šä¹‰çš„ä¸€ç³»åˆ—å˜é‡ã€‚</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨aliaså‘½ä»¤å®šä¹‰ä¸€äº›å‘½ä»¤çš„åˆ«åï¼Œæ¯”å¦‚alias rm=â€rm -iâ€ï¼ˆåŒå¼•å·å¿…é¡»ï¼‰ï¼Œå¹¶æŠŠè¿™ä¸ªä»£ç åŠ å…¥åˆ°~/.profileä¸­ï¼Œè¿™æ ·ä½ æ¯æ¬¡ä½¿ç”¨rmå‘½ä»¤çš„æ—¶å€™ï¼Œéƒ½ç›¸å½“äºä½¿ç”¨rm -iå‘½ä»¤ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><h4 id="1-åƒµå°¸è¿›ç¨‹"><a href="#1-åƒµå°¸è¿›ç¨‹" class="headerlink" title="1.åƒµå°¸è¿›ç¨‹"></a>1.åƒµå°¸è¿›ç¨‹</h4><p>å½“å­è¿›ç¨‹é€€å‡ºæ—¶ï¼Œçˆ¶è¿›ç¨‹æ²¡æœ‰è°ƒç”¨waitå‡½æ•°æˆ–è€…waitpid()å‡½æ•°ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œåˆæ²¡æœ‰æ˜¾å¼å¿½ç•¥SIGCHLDä¿¡å·ï¼Œé‚£ä¹ˆå®ƒå°†ä¸€ç›´ä¿æŒåœ¨åƒµå°¸çŠ¶æ€ï¼Œå¦‚æœè¿™æ—¶çˆ¶è¿›ç¨‹ç»“æŸäº†ï¼Œinitè¿›ç¨‹ä¼šè‡ªåŠ¨æ¥æ”¶è¿™ä¸ªå­è¿›ç¨‹ï¼Œä¸ºå®ƒæ”¶å°¸ï¼Œä½†å¦‚æœçˆ¶è¿›ç¨‹æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œä¸ä¼šç»“æŸï¼Œé‚£ä¹ˆå­è¿›ç¨‹å°±ä¼šä¸€ç›´ä¿æŒåƒµæ­»çŠ¶æ€ã€‚</p><p>è¿›ç¨‹çŠ¶æ€ï¼š</p><ul><li>Z åƒµå°¸</li><li>S ä¼‘çœ </li><li>D ä¸å¯ä¸­æ–­çš„ä¼‘çœ </li><li>R è¿è¡Œ</li><li>T åœæ­¢æ—¶è·Ÿè¸ª</li></ul><p><span class="github-emoji"><span>ğŸ¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾‹å­1ï¼š</p><ul><li>æŸ¥çœ‹åƒµå°¸è¿›ç¨‹ï¼š<code>ps -A -o stat,ppid,pid,cmd | grep -e '^[Zz]'</code></li></ul><p>å‘½ä»¤æ³¨è§£ï¼š</p><p>-A å‚æ•°åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹</p><p>-o è‡ªå®šä¹‰è¾“å‡ºå­—æ®µ æˆ‘ä»¬è®¾å®šæ˜¾ç¤ºå­—æ®µä¸º statï¼ˆçŠ¶æ€ï¼‰, ppidï¼ˆè¿›ç¨‹çˆ¶idï¼‰, pid(è¿›ç¨‹id)ï¼Œcmdï¼ˆå‘½ä»¤ï¼‰è¿™å››ä¸ªå‚æ•°</p><ul><li>æ€æ­»åƒµå°¸è¿›ç¨‹ï¼š</li></ul><p><code>ps -A -o stat,ppid,pid,cmd | grep -e '^[Zz]' | awk '{print $2}' | xargs kill -9</code></p><p>æŸ¥æ‰¾åƒµæ­»è¿›ç¨‹ï¼Œç„¶åå°†çˆ¶è¿›ç¨‹æ€æ­»ã€‚</p><h2 id="4-linuxå„ä¸ªç›®å½•çš„ä½œç”¨"><a href="#4-linuxå„ä¸ªç›®å½•çš„ä½œç”¨" class="headerlink" title="4. linuxå„ä¸ªç›®å½•çš„ä½œç”¨"></a>4. linuxå„ä¸ªç›®å½•çš„ä½œç”¨</h2><p><code>bin</code> å­˜æ”¾ç³»ç»Ÿå‘½ä»¤çš„ç›®å½•ï¼Œæ™®é€šç”¨æˆ·å’Œè¶…çº§ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œã€‚/binç›®å½•ä¸‹çš„å‘½ä»¤å•ç”¨æˆ·æ¨¡å¼ä¸‹ä¹Ÿå¯ä»¥æ‰§è¡Œã€‚</p><p><code>sbin</code>ä¿å­˜ç³»ç»Ÿç¯å¢ƒè®¾ç½®ç›¸å…³çš„å‘½ä»¤ï¼Œåªæœ‰è¶…çº§ç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™äº›å‘½ä»¤è¿›è¡Œç³»ç»Ÿç¯å¢ƒè®¾ç½®ï¼Œä½†æ˜¯æœ‰äº›å‘½ä»¤å…è®¸æ™®é€šç”¨æˆ·æŸ¥çœ‹ã€‚</p><p><code>usr/bin</code>å­˜æ”¾ç³»ç»Ÿå‘½ä»¤çš„ç›®å½•ï¼Œæ™®é€šç”¨æˆ·å’Œè¶…çº§ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œã€‚è¿™äº›å‘½ä»¤å’Œç³»ç»Ÿå¯åŠ¨æ— å…³ï¼Œåœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹ä¸èƒ½æ‰§è¡Œã€‚</p><p><code>boot</code>ç³»ç»Ÿå¯åŠ¨ç›®å½•ï¼Œä¿å­˜ç³»ç»Ÿå¯åŠ¨ç›¸å…³çš„æ–‡ä»¶ï¼Œå¦‚å†…æ ¸æ–‡ä»¶å’Œå¯åŠ¨å¼•å¯¼(grub)ç¨‹åºæ–‡ä»¶ã€‚</p><p><code>dev</code> è®¾å¤‡æ–‡ä»¶ä¿å­˜ä½ç½®ã€‚Linuxä¸­æ‰€æœ‰å†…å®¹ä»¥æ–‡ä»¶å½¢å¼ä¿å­˜ï¼ŒåŒ…æ‹¬ç¡¬ä»¶ã€‚è¿™ä¸ªç›®å½•å°±æ˜¯ç”¨æ¥ä¿å­˜æ‰€æœ‰ç¡¬ä»¶è®¾å¤‡æ–‡ä»¶çš„ã€‚</p><p><code>/etc/</code> é…ç½®æ–‡ä»¶ä¿å­˜ä½ç½®ã€‚ç³»ç»Ÿå†…æ‰€æœ‰é‡‡ç”¨é»˜è®¤å®‰è£…æ–¹å¼çš„æœåŠ¡çš„é…ç½®æ–‡ä»¶å…¨éƒ¨ä¿å­˜åœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œå¦‚ç”¨æˆ·è´¦æˆ·å’Œå¯†ç ï¼ŒæœåŠ¡çš„å¯åŠ¨è„šæœ¬ï¼Œå¸¸ç”¨æœåŠ¡çš„é…ç½®æ–‡ä»¶ã€‚</p><p><code>home</code>å»ºç«‹æ¯ä¸ªç”¨æˆ·æ—¶ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦ä¸€ä¸ªé»˜è®¤ä½ç½®ï¼Œè¿™ä¸ªä½ç½®å°±æ˜¯ç”¨æˆ·å®¶ç›®å½•ã€‚æ‰€æœ‰æ™®é€šç”¨æˆ·çš„å®¶ç›®å½•å°±æ˜¯åœ¨/homeä¸‹å»ºç«‹ä¸€ä¸ªå’Œç”¨æˆ·åç›¸åŒçš„ç›®å½•ã€‚å¦‚ç”¨æˆ·usr1çš„å®¶ç›®å½•å°±æ˜¯/home/user1ã€‚</p><p><code>lib</code>ç³»ç»Ÿè°ƒç”¨çš„å‡½æ•°åº“ä½ç½®</p><p><code>/lost+found/</code>å½“ç³»ç»Ÿæ„å¤–å´©æºƒå’Œæœºå™¨æ„å¤–å…³æœºï¼Œè€Œäº§ç”Ÿä¸€äº›æ–‡ä»¶ç¢ç‰‡æ”¾åœ¨è¿™é‡Œã€‚å½“ç³»ç»Ÿå¯åŠ¨çš„è¿‡ç¨‹ä¸­fsckå·¥å…·ä¼šæ£€æŸ¥è¿™é‡Œï¼Œå¹¶ä¿®å¤å·²ç»æŸåçš„æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ä¸ªç›®å½•åªåœ¨æ¯ä¸ªåˆ†åŒºä¸­å‡ºç°ï¼Œä¾‹å¦‚/lost+fountå°±æ˜¯æ ¹åˆ†åŒºçš„å¤‡ä»½æ¢å¤ç›®å½•ã€‚/boot/lost+found å°±æ˜¯/bootåˆ†åŒºçš„å¤‡ä»½æ¢å¤ç›®å½•ã€‚</p><p><code>/mnt</code>æŒ‚è½½ç›®å½•ï¼Œæ—©æœŸlinuxä¸­åªæœ‰è¿™ä¸€ä¸ªæŒ‚è½½ç›®å½•ï¼Œå¹¶æ²¡æœ‰ç»†åˆ†ã€‚ç°åœ¨è¿™ä¸ªç›®å½•ç³»ç»Ÿå»ºè®®æŒ‚è½½é¢å¤–è®¾å¤‡ã€‚</p><p><code>mnt</code>æŒ‚åœ¨Uç›˜æˆ–è€…ç§»åŠ¨ç¡¬ç›˜ã€‚</p><p><code>/opt</code>ç¬¬ä¸‰æ–¹å®‰è£…çš„è½¯ä»¶ä¿å­˜ä½ç½®ã€‚ ç¬¬ä¸‰æ–¹ç°åœ¨ä¹ æƒ¯æ”¾åˆ°äº†/usr/localä¸‹ã€‚</p><p><code>proc</code> è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œè¯¥ç›®å½•ä¸­çš„æ•°æ®å¹¶ä¸ä¿å­˜åœ¨ç¡¬ç›˜ä¸­ï¼Œè€Œæ˜¯ä¿å­˜åœ¨å†…å­˜å½“ä¸­ã€‚</p><p><code>sys</code> è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚å’Œ/procç›®å½•ç›¸ä¼¼ï¼Œéƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜å½“ä¸­çš„ï¼Œä¸»è¦æ˜¯ä¿å­˜äºå†…æ ¸ç›¸å…³ä¿¡æ¯çš„ã€‚</p><p><code>usr</code> ç³»ç»Ÿè½¯ä»¶èµ„æºç›®å½•ã€‚ unix software resource çš„ç¼©å†™ï¼Œä¸æ˜¯å­˜æ”¾ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯å­˜æ”¾ç³»ç»Ÿè½¯ä»¶èµ„æºçš„ç›®å½•ã€‚ç³»ç»Ÿä¸­å®‰è£…çš„å¤§å¤šæ•°è½¯ä»¶éƒ½å­˜æ”¾åœ¨è¿™é‡Œã€‚</p><p><code>var</code>åŠ¨æ€æ•°æ®ï¼ˆæ¯”å¦‚æ—¥å¿—ï¼‰ä¿å­˜çš„ä½ç½®ã€‚ç¼“å­˜ã€æ—¥å¿—ä»¥åŠè½¯ä»¶è¿è¡Œæ‰€äº§ç”Ÿçš„æ–‡ä»¶ã€‚</p><h3 id="4-1-æ–‡ä»¶å¤„ç†"><a href="#4-1-æ–‡ä»¶å¤„ç†" class="headerlink" title="4.1 æ–‡ä»¶å¤„ç†"></a>4.1 æ–‡ä»¶å¤„ç†</h3><h4 id="4-1-1-ls"><a href="#4-1-1-ls" class="headerlink" title="4.1.1 ls"></a>4.1.1 ls</h4><p><code>ls -la /etc</code> å‘½ä»¤ [-é€‰é¡¹] [å‚æ•°]</p><p>ls -l (long é•¿æ ¼å¼æ˜¾ç¤º)</p><p>æ˜¾ç¤ºçš„æ ¼å¼å¦‚ä¸‹ï¼š</p><p>â€‹                            ç”¨æˆ·    ç”¨æˆ·ç»„ æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ æ—¶é—´ æ–‡ä»¶å</p><p><code>-rw------- 1 root root 1205 3æœˆ 3 08:10 anaconda-ks.cfg</code></p><p>- æ–‡ä»¶ç±»å‹ï¼ˆ- äºŒè¿›åˆ¶æ–‡ä»¶ dç›®å½• l è½¯é“¾æ¥æ–‡ä»¶ï¼‰</p><p>å…¶ååˆ†åˆ«æ˜¯ u g o</p><p>uæ‰€æœ‰è€… gæ‰€å±ç»„ oå…¶ä»–äºº</p><p>rè¯» wå†™ xæ‰§è¡Œï¼ˆæœ€é«˜æƒé™ï¼‰</p><p><img src="/2021/06/10/linux-ji-chu/image-20211107134330379.png" alt="image-20211107134330379"></p><h4 id="4-1-2-mkdir"><a href="#4-1-2-mkdir" class="headerlink" title="4.1.2 mkdir"></a>4.1.2 mkdir</h4><p><code>mkdir -p</code> é€’å½’åˆ›å»ºç›®å½•ã€‚</p><p><code>mkdir -p /tmp/japan/boduo</code></p><p><code>mkdir /tmp/Japan/longze  /tmp/Japan/cangjing</code></p><h4 id="4-1-3-cd-change-directory"><a href="#4-1-3-cd-change-directory" class="headerlink" title="4.1.3 cd (change directory)"></a>4.1.3 cd (change directory)</h4><p>æ‰“å¼€ç›®å½•</p><h4 id="4-1-4-rmdir"><a href="#4-1-4-rmdir" class="headerlink" title="4.1.4 rmdir"></a>4.1.4 rmdir</h4><p>åˆ é™¤ç›®å½•ã€‚</p><h4 id="4-1-5-cp-copy"><a href="#4-1-5-cp-copy" class="headerlink" title="4.1.5 cp (copy)"></a>4.1.5 cp (copy)</h4><p>cp -rp [åŸæ–‡ä»¶æˆ–ç›®å½•] [ç›®æ ‡ç›®å½•]</p><p>-r å¤åˆ¶ç›®å½•</p><p>-p ä¿ç•™æ–‡ä»¶å±æ€§</p><h4 id="4-1-6-touch"><a href="#4-1-6-touch" class="headerlink" title="4.1.6 touch"></a>4.1.6 touch</h4><p>åˆ›å»ºç©ºæ–‡ä»¶</p><h4 id="4-1-7-cat"><a href="#4-1-7-cat" class="headerlink" title="4.1.7 cat"></a>4.1.7 cat</h4><p><code>cat -n</code> æ˜¾ç¤ºè¡Œå·</p><p>tac åç€æ˜¾ç¤º</p><h4 id="4-1-8-more"><a href="#4-1-8-more" class="headerlink" title="4.1.8 more"></a>4.1.8 more</h4><p>åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶çš„å‘½ä»¤ã€‚</p><h4 id="4-1-9-less"><a href="#4-1-9-less" class="headerlink" title="4.1.9 less"></a>4.1.9 less</h4><p>lesså‘½ä»¤å¯ä»¥å‘ä¸Šç¿»é¡µã€‚</p><p>æµè§ˆçŠ¶æ€ä¸‹ï¼ŒæŸä¸ªå…³é”®è¯ä½ç½®ã€‚/å…³é”®è¯ å°±ä¼šæ‰¾åˆ°ï¼Œç„¶åné”®å¯ä»¥å¾€ä¸‹èµ°ã€‚</p><h4 id="4-1-10-head"><a href="#4-1-10-head" class="headerlink" title="4.1.10 head"></a>4.1.10 head</h4><p>åªçœ‹æ–‡ä»¶å‰å‡ ä¸ªéƒ¨åˆ†ã€‚</p><p><code>head -n 10 æ–‡ä»¶å</code> çœ‹å‰10è¡Œ</p><h4 id="4-1-11-tail"><a href="#4-1-11-tail" class="headerlink" title="4.1.11 tail"></a>4.1.11 tail</h4><p>æŸ¥çœ‹æœ«å°¾çš„å‡ è¡Œï¼ŒåŒheadã€‚</p><h4 id="4-1-12-ln"><a href="#4-1-12-ln" class="headerlink" title="4.1.12 ln"></a>4.1.12 ln</h4><p><code>ln -s /etc/issue /tmp/issue.soft</code></p><p>åˆ›å»º/etc/issueçš„è½¯è¿æ¥/tmp/issue.soft</p><p>ç¡¬é“¾æ¥ï¼šä¸èƒ½æŒ‡å‘ç›®å½•ã€ä¸èƒ½è·¨åˆ†åŒºã€‚</p><h4 id="4-1-13-locate"><a href="#4-1-13-locate" class="headerlink" title="4.1.13 locate"></a>4.1.13 locate</h4><p>findåœ¨æŸä¸€ä¸ªæ–‡ä»¶æˆ–è€…åˆ†åŒºç¡¬ç›˜ä¸Šå…¨éƒ¨éå†æŸ¥æ‰¾ã€‚</p><p>locateæ˜¯ç›´æ¥æ‰¾èµ„æ–™åº“ã€‚ç³»ç»Ÿæœ‰ä¸€ä¸ªç»´æŠ¤çš„æ–‡ä»¶èµ„æ–™åº“ï¼Œ</p><p>å¦‚æœä½¿ç”¨<code>locate locate</code>å¯»æ‰¾ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç°æ‰“å°å‡ºæ¥çš„</p><p><img src="/2021/06/10/linux-ji-chu/1\blog\source_posts\linuxåŸºç¡€\image-20211013124132522.png" alt="image-20211013124132522"></p><p>ç™½è‰²å°±æ˜¯èµ„æ–™åº“ã€‚<code>ä½†æ˜¯å¦‚æœæ–°å»ºç«‹çš„æ–‡ä»¶ï¼Œæ²¡æœ‰è¢«æ”¶å½•åˆ°è¿™ä¸ªèµ„æ–™åº“ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶æ˜¯æ‰¾ä¸åˆ°çš„</code>ã€‚</p><p>æˆ‘ä»¬éœ€è¦æ›´æ–°èµ„æ–™åº“ï¼Œ<code>updatedb</code> ï¼ˆé™¤äº†tmpä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶æ— æ³•æ›´æ–°ï¼‰</p><p>è¿™ä¸ªæ—¶å€™å°±ä¼šæ£€ç´¢åˆ°æ–°å»ºç«‹çš„æ–‡ä»¶ã€‚</p><ul><li>ä¸åŒºåˆ†å¤§å°å†™ -i</li></ul><h4 id="4-1-14-which"><a href="#4-1-14-which" class="headerlink" title="4.1.14 which"></a>4.1.14 which</h4><p>æœç´¢å‘½ä»¤æ‰€åœ¨çš„ç›®å½•åŠåˆ«åä¿¡æ¯</p><h4 id="4-1-15-whereis"><a href="#4-1-15-whereis" class="headerlink" title="4.1.15 whereis"></a>4.1.15 whereis</h4><p>å’ŒwhichåŠŸèƒ½ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºè¿˜åˆ—å‡ºäº†å¸®åŠ©æ–‡æ¡£ã€‚</p><h4 id="4-1-16-grep"><a href="#4-1-16-grep" class="headerlink" title="4.1.16 grep"></a>4.1.16 grep</h4><p>æ–‡ä»¶å†…å®¹ä¸­è¿›è¡Œæœç´¢ã€‚</p><p>æ‰§è¡Œæƒé™ ï¼š æ‰€æœ‰ç”¨æˆ·ã€‚</p><p><code>grep -iv [æ‰§è¡Œå­—ä¸²][æ–‡ä»¶]</code> <code>-i ä¸åŒºåˆ†å¤§å°å†™ -v æ’é™¤æŒ‡å®šå­—ä¸²</code></p><p>åœ¨æ–‡ä»¶å†…ï¼ŒæŸä¸ªå­—ä¸²æ‰€åœ¨çš„è¡Œæ‰¾å‡ºæ¥</p><p><img src="/2021/06/10/linux-ji-chu/1\blog\source_posts\linuxåŸºç¡€\image-20211013130905308.png" alt="image-20211013130905308"></p><p><code>grep -v ^# /etc/..file</code> æ‰¾åˆ°æ‰€æœ‰å¹¶æ’é™¤ä»¥ # å¼€å¤´çš„è¡Œ</p><h4 id="4-1-17-find"><a href="#4-1-17-find" class="headerlink" title="4.1.17 find"></a>4.1.17 find</h4><p><code>find /etc -name init</code> åœ¨etcæ–‡ä»¶å¤¹ä¸‹å¯»æ‰¾åå­—ä¸ºinitçš„æ–‡ä»¶ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯ç²¾å‡†æœç´¢ï¼Œå…¨åŒ¹é…ã€‚</p><p>å¦‚æœè¦æ¨¡ç³Šæœç´¢ï¼Œå¯ä»¥ï¼š<code>find /etc -name *init*</code> ä½¿ç”¨é€šé…ç¬¦ã€‚</p><p><code>find /etc/ -name init???</code> åŒ¹é…ä¸‰ä¸ªå­—ç¬¦ é—®å¥½åŒ¹é…å•ä¸ªå­—ç¬¦</p><p><code>find / -size +204800</code> åœ¨æ ¹ç›®å½•ä¸‹æŸ¥æ‰¾å¤§äº100MBçš„æ–‡ä»¶ã€‚ +n å¤§äº -n å°äº n ç­‰äºã€‚ ä¸€ä¸ªæ•°æ®å—0.5kã€‚ ç„¶å 100MB = 102400KB * 2 = 204800</p><p><code>find /home -user shenchao</code> åœ¨homeæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°æ‰€æœ‰è€…ä¸ºshenchaoçš„æ–‡ä»¶ã€‚</p><p><code>find /etc -cmin -5</code> åœ¨/etcç›®å½•ä¸‹æŸ¥æ‰¾5åˆ†é’Ÿå†…ï¼ˆæ³¨æ„-å·ï¼Œæ˜¯å°äº5åˆ†é’Ÿï¼‰è¢«ä¿®æ”¹è¿‡çš„å±æ€§çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p><p>-amin è®¿é—®æ—¶é—´ access</p><p>-cmin æ–‡ä»¶å±æ€§ change</p><p>-mmin æ–‡ä»¶å†…å®¹ modify</p><p><code>find /etc -size + 163840 -a -size -204800</code> åœ¨etcä¸‹æŸ¥æ‰¾å¤§äº80MBå°äº100MBçš„æ–‡ä»¶ã€‚</p><p>-a ä¸¤ä¸ªæ–‡ä»¶åŒæ—¶æ»¡è¶³ -o ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ä»»ä½•ä¸€ä¸ªå³å¯ã€‚</p><p>-type f æ–‡ä»¶ dç›®å½• lè½¯è¿æ¥æ–‡ä»¶</p><p><code>find /etc -name inittab -exec ls -l {}\;</code> åœ¨etcä¸‹æŸ¥æ‰¾inittabæ–‡ä»¶å¹¶æ˜¾ç¤ºå…¶è¯¦ç»†ä¿¡æ¯</p><p>-exec/-ok å‘½ä»¤{}\ ï¼Œå¯¹æœç´¢ç»“æœæ‰§è¡Œæ“ä½œã€‚</p><p>-inum ièŠ‚ç‚¹ï¼Œ æ ¹æ®ièŠ‚ç‚¹æŸ¥æ‰¾ã€‚</p><p><code>find -inum 31531 -exec rm {} \</code> åˆ é™¤ièŠ‚ç‚¹æ˜¯31531çš„æ–‡ä»¶ã€‚</p><h3 id="4-2-å¸®åŠ©å‘½ä»¤"><a href="#4-2-å¸®åŠ©å‘½ä»¤" class="headerlink" title="4.2 å¸®åŠ©å‘½ä»¤"></a>4.2 å¸®åŠ©å‘½ä»¤</h3><h4 id="4-2-1-man"><a href="#4-2-1-man" class="headerlink" title="4.2.1 man"></a>4.2.1 man</h4><p>å‘½ä»¤å’Œé…ç½®æ–‡ä»¶çš„å¸®åŠ©ä¿¡æ¯ã€‚</p><p><code>man ls</code> æŸ¥çœ‹lså‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯</p><p>1 æ˜¯å‘½ä»¤çš„å¸®åŠ© 5 æ˜¯é…ç½®æ–‡ä»¶çš„å¸®åŠ©ã€‚</p><h4 id="4-2-2-whatis"><a href="#4-2-2-whatis" class="headerlink" title="4.2.2 whatis"></a>4.2.2 whatis</h4><p>ç®€çŸ­åœ°å¾—åˆ°å‘½ä»¤åœ°ä¿¡æ¯</p><h4 id="4-2-3-apropos"><a href="#4-2-3-apropos" class="headerlink" title="4.2.3 apropos"></a>4.2.3 apropos</h4><p>æŸ¥çœ‹é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ <code>apropos services</code> </p><h4 id="4-2-4-help"><a href="#4-2-4-help" class="headerlink" title="4.2.4 help"></a>4.2.4 help</h4><p>æœ‰ä¸€éƒ¨åˆ†æ˜¯shellå†…ç½®å‘½ä»¤ã€‚æ‰¾ä¸åˆ°å®ƒå­˜æ”¾çš„è·¯å¾„ã€‚éœ€è¦ä½¿ç”¨helpè·å–å†…ç½®å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚</p><h3 id="4-3-ç”¨æˆ·ç®¡ç†"><a href="#4-3-ç”¨æˆ·ç®¡ç†" class="headerlink" title="4.3 ç”¨æˆ·ç®¡ç†"></a>4.3 ç”¨æˆ·ç®¡ç†</h3><h4 id="4-3-1-useradd"><a href="#4-3-1-useradd" class="headerlink" title="4.3.1 useradd"></a>4.3.1 useradd</h4><p>æ·»åŠ ç”¨æˆ·å‘½ä»¤ã€‚</p><h4 id="4-3-2-passwd"><a href="#4-3-2-passwd" class="headerlink" title="4.3.2 passwd"></a>4.3.2 passwd</h4><p>æ›´æ”¹å¯†ç  <code>passwd xxh</code></p><h4 id="4-3-3-who"><a href="#4-3-3-who" class="headerlink" title="4.3.3 who"></a>4.3.3 who</h4><p><img src="/2021/06/10/linux-ji-chu/1\blog\source_posts\linuxåŸºç¡€\image-20211014141358511.png" alt="image-20211014141358511"></p><h3 id="4-3-4-w"><a href="#4-3-4-w" class="headerlink" title="4.3.4 w"></a>4.3.4 w</h3><p><img src="/2021/06/10/linux-ji-chu/1\blog\source_posts\linuxåŸºç¡€\image-20211014141459636.png" alt="image-20211014141459636"></p><p>IDLE ç©ºé—²æ—¶é—´</p><p>JCPU ç´¯è®¡å ç”¨cpuæ—¶é—´</p><p>PCPU å½“å‰ç”¨æˆ·å ç”¨cpuçš„æ—¶é—´ã€‚</p><p>WHAT å½“å‰æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><h4 id="4-3-5-uptime"><a href="#4-3-5-uptime" class="headerlink" title="4.3.5 uptime"></a>4.3.5 uptime</h4><p>æ€»å…±è¿è¡Œæ—¶é—´ã€‚</p><h4 id="4-3-6-chmod"><a href="#4-3-6-chmod" class="headerlink" title="4.3.6 chmod"></a>4.3.6 chmod</h4><p><code>chmod [{ugoa}{+=}{rwx}] [æ–‡ä»¶æˆ–ç›®å½•][mode=421][æ–‡ä»¶æˆ–ç›®å½•] -R é€’å½’ä¿®æ”¹</code></p><h3 id="4-3-7-è¸¢å‡ºç”¨æˆ·"><a href="#4-3-7-è¸¢å‡ºç”¨æˆ·" class="headerlink" title="4.3.7 è¸¢å‡ºç”¨æˆ·"></a>4.3.7 è¸¢å‡ºç”¨æˆ·</h3><p>#who</p><p>USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT<br>root pts/0 192.168.153.72 14:52 10.00s 0.00s 0.00s w<br>root pts/1 192.168.153.72 14:52 0.00s 0.00s 0.00s -bash</p><p>æ–¹æ³•ä¸€ï¼š</p><p><code>pkill -kill -t pts/1</code></p><p>æ–¹æ³•äºŒï¼š</p><p><code>fuser -k /dev/pts/1</code></p><p>ä½ ä¹Ÿå¯ä»¥ç»™ä»–å‘é€å…³é—­ä¿¡æ¯ç„¶åå…³é—­</p><p><code>echo "ä½ è¢«ç®¡ç†å‘˜è¸¢å‡ºäº†" &gt; /dev/pts/1 &amp;&amp; fuser -k /dev/pts/1</code></p><h3 id="4-4-å‹ç¼©"><a href="#4-4-å‹ç¼©" class="headerlink" title="4.4 å‹ç¼©"></a>4.4 å‹ç¼©</h3><ul><li>å‹ç¼©æ ¼å¼ gzip</li></ul><p>.gz å¯¹åº”å‘½ä»¤ <code>gzip</code>  è§£å‹ç¼© <code>gunzip</code></p><p><code>gzip æ–‡ä»¶å</code> gzip åªèƒ½å‹ç¼©æ–‡ä»¶ï¼Œä¸èƒ½å‹ç¼©ç›®å½•ã€‚</p><p>å‹ç¼©å®Œå°±åªå‰©ä¸‹å‹ç¼©åŒ…äº†ï¼Œæºæ–‡ä»¶å°±ä¸è§äº†ã€‚</p><ul><li>tar</li></ul><p><code>tar -cvfz [-zcf][å‹ç¼©åæ–‡ä»¶å][ç›®å½•]</code></p><p>-c æ‰“åŒ…</p><p>-v æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</p><p>-f æŒ‡å®šæ–‡ä»¶å</p><p>-z æ‰“åŒ…åŒæ—¶å‹ç¼© æˆ–è€… è§£å‹ç¼©</p><p>-x è§£åŒ…</p><p>-j bzip2 çš„æ ¼å¼</p><ul><li>zip</li></ul><p><code>zip é€‰é¡¹[-r] [å‹ç¼©åçš„æ–‡ä»¶å] [æ–‡ä»¶æˆ–ç›®å½•]</code>  -rå‹ç¼©ç›®å½• </p><p>æ¯”gzipå‹ç¼©æ•ˆæœå·®</p><ul><li>bzip2 zipçš„å‡çº§ç‰ˆæœ¬</li></ul><p><code>bzip2 é€‰é¡¹[-k] [æ–‡ä»¶]</code> å‹ç¼©åä¿ç•™åŸæ–‡ä»¶ </p><p>å‹ç¼©æ¯”å¾ˆå‰å®³</p><h3 id="4-5-ç½‘ç»œå‘½ä»¤"><a href="#4-5-ç½‘ç»œå‘½ä»¤" class="headerlink" title="4.5 ç½‘ç»œå‘½ä»¤"></a>4.5 ç½‘ç»œå‘½ä»¤</h3><h4 id="4-5-1-write"><a href="#4-5-1-write" class="headerlink" title="4.5.1 write"></a>4.5.1 write</h4><p>å‘½ä»¤æ‰€åœ¨è·¯å¾„ï¼š<code>/usr/bin/write</code></p><p>è¯­æ³•ï¼š write &lt;ç”¨æˆ·å&gt;</p><p>åŠŸèƒ½ï¼š ç»™åœ¨çº¿ç”¨æˆ·å‘ä¿¡æ¯ï¼Œä»¥ctrl + D ä¿å­˜ç»“æŸ</p><h4 id="4-5-2-wall"><a href="#4-5-2-wall" class="headerlink" title="4.5.2 wall"></a>4.5.2 wall</h4><p>å¹¿æ’­æ‰€æœ‰åœ¨çº¿ç”¨æˆ·å‘é€ä¿¡æ¯</p><p><code>wall message</code></p><h4 id="4-5-3-ping"><a href="#4-5-3-ping" class="headerlink" title="4.5.3 ping"></a>4.5.3 ping</h4><p>æµ‹è¯•ç½‘ç»œçš„è¿é€šæ€§</p><p><code>ping ip</code></p><p><code>ping -c 3 ip</code> æ‰“å°3æ¬¡ä¿¡æ¯</p><h4 id="4-5-4-ifconfig"><a href="#4-5-4-ifconfig" class="headerlink" title="4.5.4 ifconfig"></a>4.5.4 ifconfig</h4><p><img src="/2021/06/10/linux-ji-chu/1\blog\source_posts\linuxåŸºç¡€\image-20211023205703132.png" alt="image-20211023205703132"></p><h4 id="4-5-5-mail"><a href="#4-5-5-mail" class="headerlink" title="4.5.5 mail"></a>4.5.5 mail</h4><p>æŸ¥çœ‹å‘é€ç”µå­é‚®ä»¶</p><p><code>mail ç”¨æˆ·å</code> </p><p>æ¥æ”¶ ï¼š mail å•¥éƒ½ä¸ç”¨åŠ ï¼Œå°±å¯ä»¥çœ‹äº†</p><h4 id="4-5-6-last"><a href="#4-5-6-last" class="headerlink" title="4.5.6 last"></a>4.5.6 last</h4><p>ç»Ÿè®¡è®¡ç®—æœºæ‰€æœ‰ç”¨æˆ·çš„ç™»å½•å’Œé‡å¯æ—¶é—´</p><h4 id="4-5-7-lastlog"><a href="#4-5-7-lastlog" class="headerlink" title="4.5.7 lastlog"></a>4.5.7 lastlog</h4><p><code>lastlog -u ç”¨æˆ·å</code></p><p>ä¸åŠ -u å¯ä»¥æ‰“å°å…¨éƒ¨ç”¨æˆ·</p><p>æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ· æœ€è¿‘ç™»å½•çš„ä¿¡æ¯</p><h4 id="4-5-8-traceroute"><a href="#4-5-8-traceroute" class="headerlink" title="4.5.8 traceroute"></a>4.5.8 traceroute</h4><p><code>traceroute ç½‘ç»œåœ°å€</code></p><h4 id="4-5-9-netstat"><a href="#4-5-9-netstat" class="headerlink" title="4.5.9 netstat"></a>4.5.9 netstat</h4><p>æŸ¥è¯¢ç½‘ç»œçŠ¶æ€ç›¸å…³ä¿¡æ¯</p><p>-t tcpåè®® </p><p>-u udp</p><p>-l ç›‘å¬</p><p>-r è·¯ç”± è®¡ç®—æœºç½‘å…³</p><p>-n æ˜¾ç¤ºIPåœ°å€å’Œç«¯å£å·</p><p>ä¸€èˆ¬å°±æ˜¯å†™ -tuln å°±æ»¡è¶³äº†å¤§éƒ¨åˆ†åœºæ™¯</p><h4 id="4-5-10-setup"><a href="#4-5-10-setup" class="headerlink" title="4.5.10 setup"></a>4.5.10 setup</h4><p>redhatç³»åˆ—ç³»ç»Ÿæ‰æœ‰çš„ã€‚</p><p>ç½‘ç»œé…ç½®ã€‚</p><h3 id="4-6-å…³æœºé‡å¯å‘½ä»¤"><a href="#4-6-å…³æœºé‡å¯å‘½ä»¤" class="headerlink" title="4.6 å…³æœºé‡å¯å‘½ä»¤"></a>4.6 å…³æœºé‡å¯å‘½ä»¤</h3><ul><li>shutdown</li></ul><p>-cï¼š å–æ¶ˆå‰ä¸€ä¸ªå…³æœºå‘½ä»¤</p><p>-h: å…³æœº</p><p>-rï¼šé‡å¯</p><p>å°½é‡ä½¿ç”¨shutdownå‘½ä»¤æ¥è¿›è¡Œå…³æœºé‡å¯ã€‚å› ä¸ºå®ƒä¼šå°†æœåŠ¡æ­£å¸¸å…³é—­ã€‚</p><p>å…¶ä»–çš„å…³æœºå‘½ä»¤</p><ul><li><p>halt </p></li><li><p>poweroff // ç›´æ¥æ–­ç”µ</p></li><li><p>init 0</p></li><li><p>reboot é‡æ–°å¯åŠ¨</p></li><li><p>init 6 é‡æ–°å¯åŠ¨</p></li></ul><p>**ç³»ç»Ÿè¿è¡Œçº§åˆ« **7ä¸ªè¿è¡Œçº§åˆ«</p><ul><li>0 å…³æœº</li><li>1 å•ç”¨æˆ·</li><li>2 ä¸å®Œå…¨å¤šç”¨æˆ·ï¼Œä¸å«NFSæœåŠ¡</li><li>3 å®Œå…¨å¤šç”¨æˆ·</li><li>4 æœªåˆ†é…</li><li>5 å›¾å½¢ç•Œé¢</li><li>6 é‡å¯</li></ul><p>runlevel æŸ¥çœ‹è¿è¡Œçº§åˆ«</p><ul><li>logout é€€å‡ºç™»å½•</li></ul><h3 id="4-7-æ–‡æœ¬ç¼–è¾‘å™¨-vim"><a href="#4-7-æ–‡æœ¬ç¼–è¾‘å™¨-vim" class="headerlink" title="4.7 æ–‡æœ¬ç¼–è¾‘å™¨ vim"></a>4.7 æ–‡æœ¬ç¼–è¾‘å™¨ vim</h3><p><img src="/2021/06/10/linux-ji-chu/image-20211027172327338.png" alt="image-20211027172327338"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211027190046265.png" alt="image-20211027190046265"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211027190422338.png" alt="image-20211027190422338"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211027191046576.png" alt="image-20211027191046576"></p><h4 id="4-7-1-å¸¸ç”¨æ“ä½œ"><a href="#4-7-1-å¸¸ç”¨æ“ä½œ" class="headerlink" title="4.7.1 å¸¸ç”¨æ“ä½œ"></a>4.7.1 å¸¸ç”¨æ“ä½œ</h4><p><img src="/2021/06/10/linux-ji-chu/image-20211029170805479.png" alt="image-20211029170805479"></p><h4 id="4-7-2-å¸¸ç”¨å‘½ä»¤"><a href="#4-7-2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="4.7.2 å¸¸ç”¨å‘½ä»¤"></a>4.7.2 å¸¸ç”¨å‘½ä»¤</h4><p>å¤åˆ¶å’Œå‰ªåˆ‡ yy-p å¤åˆ¶åˆ°ä¸‹é¢ dd-p å‰ªåˆ‡åˆ°ä¸Šé¢</p><p>æ›¿æ¢å’Œæ¢å¤ r/R u</p><h4 id="4-7-3-æŠ€å·§"><a href="#4-7-3-æŠ€å·§" class="headerlink" title="4.7.3 æŠ€å·§"></a>4.7.3 æŠ€å·§</h4><p>ç¼–è¾‘æ¨¡å¼ä¸­ï¼š</p><p><code>:r /etc/issue</code> å°†/etc/issue çš„æ–‡ä»¶å†…å®¹å¯¼å…¥åˆ°å½“å‰å…‰æ ‡æ‰€åœ¨çš„ä½ç½®ã€‚</p><p><code>:! ç³»ç»Ÿå‘½ä»¤</code> ä¸é€€å‡ºvimä¸­æ‰§è¡Œå‘½ä»¤</p><p><code>map ^P I#&lt;ESC&gt;</code> è§¦å‘å‘½ä»¤</p><p>^ è¡¨ç¤ºè¡Œé¦–ã€‚</p><p><img src="/2021/06/10/linux-ji-chu/image-20211029194326440.png" alt="image-20211029194326440"></p><ul><li>é…ç½®é»˜è®¤çš„vimæ–‡ä»¶ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹åº”çš„ç›®å½•ä¸‹è¿›è¡Œé…ç½®ï¼š/home/xxh/.vimrc</li></ul><h2 id="5-RPMè½¯ä»¶åŒ…"><a href="#5-RPMè½¯ä»¶åŒ…" class="headerlink" title="5. RPMè½¯ä»¶åŒ…"></a>5. RPMè½¯ä»¶åŒ…</h2><ul><li>æºä»£ç åŒ…</li><li>äºŒè¿›åˆ¶åŒ…<ul><li>RPMåŒ…å’Œç³»ç»Ÿé»˜è®¤åŒ…</li></ul></li></ul><h3 id="5-1-RPMåŒ…"><a href="#5-1-RPMåŒ…" class="headerlink" title="5.1 RPMåŒ…"></a>5.1 RPMåŒ…</h3><h4 id="5-1-1-RPMåŒ…å‘½åè§„åˆ™"><a href="#5-1-1-RPMåŒ…å‘½åè§„åˆ™" class="headerlink" title="5.1.1 RPMåŒ…å‘½åè§„åˆ™"></a>5.1.1 RPMåŒ…å‘½åè§„åˆ™</h4><p><img src="/2021/06/10/linux-ji-chu/image-20211030193430610.png" alt="image-20211030193430610"></p><h4 id="5-1-2-RPMåŒ…çš„ä¾èµ–æ€§"><a href="#5-1-2-RPMåŒ…çš„ä¾èµ–æ€§" class="headerlink" title="5.1.2 RPMåŒ…çš„ä¾èµ–æ€§"></a>5.1.2 RPMåŒ…çš„ä¾èµ–æ€§</h4><p><img src="/2021/06/10/linux-ji-chu/image-20211030212353633.png" alt="image-20211030212353633"></p><h4 id="5-1-4-rpmå®‰è£…"><a href="#5-1-4-rpmå®‰è£…" class="headerlink" title="5.1.4 rpmå®‰è£…"></a>5.1.4 rpmå®‰è£…</h4><p><code>rmp -ivh åŒ…å…¨å</code> -i(install) å®‰è£… </p><p>-vï¼ˆverboseï¼‰æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</p><p>-h (hash) æ˜¾ç¤ºè¿›åº¦</p><p>â€“nodeps ä¸æ£€æµ‹ä¾èµ–æ€§</p><h4 id="5-1-5-rpmå¸è½½"><a href="#5-1-5-rpmå¸è½½" class="headerlink" title="5.1.5 rpmå¸è½½"></a>5.1.5 rpmå¸è½½</h4><p><code>rpm -e åŒ…å</code> </p><p>-e å¸è½½</p><p>â€“nodeps ä¸æ£€æŸ¥ä¾èµ–æ€§</p><p><code>rpm -q åŒ…å</code> æŸ¥è¯¢æ˜¯å¦å®‰è£… -q query çš„æ„æ€</p><p><code>rpm -qa</code> æŸ¥è¯¢ç´ å¶åˆå®‰è£…çš„RPMåŒ…</p><p><code>rpm -qi åŒ…å</code> æŸ¥è¯¢åŒ…ä¿¡æ¯</p><p><code>rpm -qip åŒ…å</code> -p æŸ¥è¯¢æœªå®‰è£…åŒ…çš„ä¿¡æ¯</p><p><code>rpm -qR åŒ…å</code> æŸ¥è¯¢è½¯ä»¶åŒ…çš„ä¾èµ–æ€§</p><p><code>rpm -qf ç³»ç»Ÿæ–‡ä»¶å</code> æŸ¥è¯¢ç³»ç»Ÿæ–‡ä»¶å±äºå“ªä¸ªè½¯ä»¶åŒ…</p><p><code>rpm -V åŒ…å</code> æ ¡éªŒæŒ‡å®šRPMåŒ…ä¸­çš„æ–‡ä»¶ï¼ˆverify)</p><p><img src="/2021/06/10/linux-ji-chu/image-20211031215839628.png" alt="image-20211031215839628"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211101152754501.png" alt="image-20211101152754501"></p><h4 id="5-1-6-RPMåŒ…ä¸­æ–‡ä»¶æå–"><a href="#5-1-6-RPMåŒ…ä¸­æ–‡ä»¶æå–" class="headerlink" title="5.1.6 RPMåŒ…ä¸­æ–‡ä»¶æå–"></a>5.1.6 RPMåŒ…ä¸­æ–‡ä»¶æå–</h4><p><code>rpm2cpio åŒ…å…¨å | \</code> </p><p>cpio -idv .æ–‡ä»¶ç»å¯¹è·¯å¾„</p><p>rpm2cpio # å°†rpmåŒ…è½¬æ¢ä¸ºcpioæ ¼å¼çš„å‘½ä»¤</p><p>cpio æ˜¯ä¸€ä¸ªæ ‡å‡†å·¥å…·ï¼Œå®ƒç”¨äºåˆ›å»ºè½¯ä»¶æ¡£æ¡ˆæ–‡ä»¶å’Œä»æ¡£æ¡ˆæ–‡ä»¶ä¸­æå–æ–‡ä»¶ã€‚</p><p><code>cpio é€‰é¡¹ &lt; [æ–‡ä»¶|è®¾å¤‡] </code> -i: copy-inæ¨¡å¼ï¼Œè¿˜åŸ </p><p><img src="/2021/06/10/linux-ji-chu/image-20211101154530780.png" alt="image-20211101154530780"></p><h3 id="5-2-yumåœ¨çº¿ç®¡ç†"><a href="#5-2-yumåœ¨çº¿ç®¡ç†" class="headerlink" title="5.2 yumåœ¨çº¿ç®¡ç†"></a>5.2 yumåœ¨çº¿ç®¡ç†</h3><p>yumåœ¨çº¿ç®¡ç†è§£å†³åŒ…çš„ä¾èµ–æ€§ã€‚</p><p><code>yum list</code> æŸ¥è¯¢æ‰€æœ‰å¯ç”¨è½¯ä»¶åŒ…åˆ—è¡¨</p><p><code>yum search å…³é”®å­—</code> æœç´¢æœåŠ¡å™¨ä¸Šæ‰€æœ‰å’Œå…³é”®å­—ç›¸å…³çš„åŒ…</p><p><code>yum -y update åŒ…å</code> yum è‡ªåŠ¨å‡çº§åŒ… å¦‚æœä¸å†™åŒ…åï¼Œ<strong>ä¼šå‡çº§æ‰€æœ‰çš„åŒ…ï¼Œå¹¶ä¸”ä¼šå‡çº§linuxå†…æ ¸</strong>ã€‚</p><p><code>yum -y remove åŒ…å</code> yumå¸è½½ï¼Œè®°å¾—æŒ‰é¡ºåºå¸è½½ï¼Œå…ˆå¸è½½aï¼Œå¦åˆ™å…ˆå¸è½½cçš„è¯ï¼Œä¼šæŠŠä¾èµ–äºcçš„æ‰€æœ‰åŒ…å…¨éƒ¨å¸è½½æ‰ã€‚å¾ˆå®¹æ˜“é€ æˆç³»ç»Ÿæ•…éšœã€‚</p><p><img src="/2021/06/10/linux-ji-chu/image-20211102111108482.png" alt="image-20211102111108482"></p><h3 id="5-3-æºç åŒ…å’ŒRPMåŒ…çš„åŒºåˆ«"><a href="#5-3-æºç åŒ…å’ŒRPMåŒ…çš„åŒºåˆ«" class="headerlink" title="5.3 æºç åŒ…å’ŒRPMåŒ…çš„åŒºåˆ«"></a>5.3 æºç åŒ…å’ŒRPMåŒ…çš„åŒºåˆ«</h3><p>å®‰è£…ä¹‹å‰ï¼šæ¦‚å¿µä¸Šçš„åŒºåˆ«</p><p>å®‰è£…ä¹‹åï¼šå®‰è£…ä½ç½®ä¸åŒ</p><p><img src="/2021/06/10/linux-ji-chu/image-20211102134500800.png" alt="image-20211102134500800"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211102134801312.png" alt="image-20211102134801312"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211102140053616.png" alt="image-20211102140053616"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211102142647407.png" alt="image-20211102142647407"></p><ul><li><code>./configure</code> è½¯ä»¶é…ç½®ä¸æ£€æŸ¥</li></ul><p><img src="/2021/06/10/linux-ji-chu/image-20211102143533533.png" alt="image-20211102143533533"></p><h2 id="6-ç”¨æˆ·ç®¡ç†"><a href="#6-ç”¨æˆ·ç®¡ç†" class="headerlink" title="6. ç”¨æˆ·ç®¡ç†"></a>6. ç”¨æˆ·ç®¡ç†</h2><h3 id="6-1-ç”¨æˆ·ç®¡ç†é…ç½®æ–‡ä»¶"><a href="#6-1-ç”¨æˆ·ç®¡ç†é…ç½®æ–‡ä»¶" class="headerlink" title="6.1 ç”¨æˆ·ç®¡ç†é…ç½®æ–‡ä»¶"></a>6.1 ç”¨æˆ·ç®¡ç†é…ç½®æ–‡ä»¶</h3><h4 id="6-1-1-etc-passwd"><a href="#6-1-1-etc-passwd" class="headerlink" title="6.1.1 /etc/passwd"></a>6.1.1 /etc/passwd</h4><p>å­—æ®µ1ï¼š ç”¨æˆ·åç§°</p><p>å­—æ®µ2ï¼šå¯†ç æ ‡å¿— å¯†ç å…¶å®æ”¾åˆ°äº†shadowæ–‡ä»¶ä¸­ã€‚å› ä¸ºç”¨æˆ·å­˜æ”¾äº†ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥çœ‹åˆ°ä¿¡æ¯ï¼Œæ‰€ä»¥æ”¾åˆ°äº†æƒé™æ›´ä½çš„shadowã€‚shadowå½“ä¸­çš„å¯†ç è¿˜æ˜¯å¯†æ–‡ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒå®‰å…¨çš„ã€‚xè¡¨ç¤ºè¿™ä¸ªç”¨æˆ·æ˜¯æœ‰å¯†ç çš„ã€‚</p><p>å­—æ®µ3ï¼šUIDï¼ˆç”¨æˆ·IDï¼‰ 0ï¼šè¶…çº§ç”¨æˆ·ã€‚ 1-499ï¼šç³»ç»Ÿç”¨æˆ·ã€‚500-65535ï¼šæ™®é€šç”¨æˆ·ã€‚</p><p>å­—æ®µ4ï¼šGID ï¼ˆç”¨æˆ·åˆå§‹ç»„IDï¼‰</p><p>å­—æ®µ5ï¼šç”¨æˆ·è¯´æ˜ã€‚</p><p>å­—æ®µ6ï¼šå®¶ç›®å½•ã€‚æ™®é€šç”¨æˆ·/home/ç”¨æˆ·åã€‚ è¶…çº§ç”¨æˆ·:/root/</p><p>å­—æ®µ7ï¼šç™»å½•ä¹‹åçš„shellã€‚</p><h4 id="6-1-2-etc-shadow"><a href="#6-1-2-etc-shadow" class="headerlink" title="6.1.2 /etc/shadow"></a>6.1.2 /etc/shadow</h4><p>å­—æ®µ1ï¼šç”¨æˆ·å</p><p>å­—æ®µ2ï¼šåŠ å¯†å¯†ç ï¼ŒSHA512æ•£åˆ—åŠ å¯†ç®—æ³•ã€‚ å¦‚æœå¯†ç ä½æ˜¯â€œ!!â€æˆ–â€*â€ä»£è¡¨æ²¡æœ‰å¯†ç ï¼Œä¸èƒ½ç™»å½•ã€‚</p><p>å­—æ®µ3ï¼šå¯†ç æœ€åä¸€æ¬¡ä¿®æ”¹çš„æ—¥æœŸã€‚</p><p>å­—æ®µ4ï¼šä¸¤æ¬¡å¯†ç çš„ä¿®æ”¹é—´éš”æ—¶é—´ï¼ˆå’Œ3å­—æ®µç›¸æ¯”ï¼‰ã€‚</p><p>å­—æ®µ5ï¼šå¯†ç æœ‰æ•ˆæœŸï¼ˆå’Œ3å­—æ®µç›¸æ¯”ï¼‰</p><p>å­—æ®µ6ï¼šå¯†ç ä¿®æ”¹åˆ°æœŸå‰çš„è­¦å‘Šå¤©æ•°ï¼ˆå’Œç¬¬5å­—æ®µç›¸æ¯”ï¼‰ã€‚</p><h4 id="6-1-3-etc-group"><a href="#6-1-3-etc-group" class="headerlink" title="6.1.3 /etc/group"></a>6.1.3 /etc/group</h4><p>å­—æ®µ1ï¼šç»„åã€‚</p><p>å­—æ®µ2ï¼šç»„å¯†ç æ ‡å¿—ã€‚</p><p>å­—æ®µ3ï¼šGIDã€‚</p><p>å­—æ®µ4ï¼šç»„ä¸­é™„åŠ ç”¨æˆ·ã€‚</p><h4 id="6-1-4-etc-gshadow"><a href="#6-1-4-etc-gshadow" class="headerlink" title="6.1.4 /etc/gshadow"></a>6.1.4 /etc/gshadow</h4><p>å­—æ®µ1ï¼šç»„åã€‚</p><p>å­—æ®µ2ï¼šç»„å¯†ç ã€‚ ä¸æ¨èä½¿ç”¨ç»„å¯†ç ã€‚</p><p>å­—æ®µ3ï¼šç»„ç®¡ç†å‘˜ç”¨æˆ·åã€‚</p><p>å­—æ®µ4ï¼šç»„ä¸­é™„åŠ ç”¨æˆ·ã€‚</p><h3 id="6-2-useradd"><a href="#6-2-useradd" class="headerlink" title="6.2 useradd"></a>6.2 useradd</h3><p>æ™®é€šç”¨æˆ·ï¼š/home/ç”¨æˆ·åï¼Œ æ‰€æœ‰è€…å’Œæ‰€å±ç»„éƒ½æ˜¯æ­¤ç”¨æˆ·ï¼Œæƒé™æ˜¯700ã€‚</p><p>è¶…çº§ç”¨æˆ·ï¼š/root/ ï¼Œæ‰€æœ‰è€…å’Œæ‰€å±ç»„éƒ½æ˜¯rootç”¨æˆ·ï¼Œæƒé™æ˜¯550ã€‚</p><p><code>useradd [é€‰é¡¹] ç”¨æˆ·å</code></p><p>-u UIDï¼š æ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„UIDå·</p><p>-d å®¶ç›®å½•ï¼š æ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„å®¶ç›®å½•</p><p>-c ç”¨æˆ·è¯´æ˜ï¼šæ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„è¯´æ˜</p><p>-g ç»„åï¼šæ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„åˆå§‹ç»„</p><p>-G ç»„åï¼šæŒ‡å®šç”¨æˆ·çš„é™„åŠ ç»„</p><p>-s shellï¼šæ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„ç™»å½•shellã€‚é»˜è®¤æ˜¯/bin/bash</p><ul><li>/etc/default/useradd</li></ul><p>GROUP=100 #ç”¨æˆ·é»˜è®¤ç»„</p><p>HOME=/home #ç”¨æˆ·å®¶ç›®å½•</p><p>INACATIVE=-1 #å¯†ç è¿‡æœŸå®½é™å¤©æ•°ï¼ˆshadowæ–‡ä»¶7å­—æ®µï¼‰</p><p>EXPIRE= #å¯†ç å¤±æ•ˆæ—¶é—´</p><p>SHELL=/bin/bash</p><p>SKEL=/etc/skel</p><p>CREATE_MAIL_SPOOL=yes #æ˜¯å¦å»ºç«‹é‚®ç®±</p><ul><li>/etc/login.defs</li></ul><p>PASS_MAX_DAYS 99999 # å¯†ç æœ‰æ•ˆæœŸï¼ˆ5ï¼‰</p><p>PASS_MIN_DAYS 0 # å¯†ç ä¿®æ”¹é—´éš”ï¼ˆ4ï¼‰</p><p>PASS_MIN_LEN 5 #å¯†ç æœ€å°5ä½ï¼ˆPAMï¼‰ ç°åœ¨PAMç®¡ç†ï¼Œå…¶å®æ˜¯æœ€å°8ä½</p><p>PASS_WARN_AGE 7 # å¯†ç åˆ°æœŸè­¦å‘Šï¼ˆ6ï¼‰</p><p>UID_MIN 500 # æœ€å°å’Œæœ€å¤§UIDèŒƒå›´</p><p>GID_MAX 60000</p><p>ENCRYPT_METHOD SHA512 #åŠ å¯†æ¨¡å¼</p><h3 id="6-3-passwd"><a href="#6-3-passwd" class="headerlink" title="6.3 passwd"></a>6.3 passwd</h3><p>ä¿®æ”¹ç”¨æˆ·å¯†ç ã€‚</p><p>pass [é€‰é¡¹] ç”¨æˆ·å</p><p>-S æŸ¥è¯¢ç”¨æˆ·å¯†ç çš„å¯†ç çŠ¶æ€ã€‚ä»…rootç”¨æˆ·å¯ç”¨ã€‚</p><p>-l æš‚æ—¶é”å®šç”¨æˆ·ã€‚ä»…rootç”¨æˆ·å¯ç”¨ã€‚</p><p>-u è§£é”ç”¨æˆ·ï¼Œä»…rootç”¨æˆ·å¯ç”¨ã€‚</p><p>â€“stdin å¯ä»¥é€šè¿‡ç®¡é“ç¬¦è¾“å‡ºçš„æ•°æ®ä½œä¸ºç”¨æˆ·çš„å¯†ç ã€‚</p><h3 id="6-4-usermodå’Œchage"><a href="#6-4-usermodå’Œchage" class="headerlink" title="6.4 usermodå’Œchage"></a>6.4 usermodå’Œchage</h3><p>ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯å’Œä¿®æ”¹ç”¨æˆ·å¯†ç çŠ¶æ€ã€‚</p><ul><li>usermod [é€‰é¡¹] ç”¨æˆ·å</li></ul><p>-u UID: ä¿®æ”¹ç”¨æˆ·çš„UIDå·</p><p>-c ç”¨æˆ·è¯´æ˜ï¼š ä¿®æ”¹ç”¨æˆ·çš„è¯´æ˜ä¿¡æ¯</p><p>-G ç»„åï¼š ä¿®æ”¹ç”¨æˆ·çš„é™„åŠ ç»„ã€‚</p><p>-Lï¼š ä¸´æ—¶é”å®šç”¨æˆ·ï¼ˆLockï¼‰ã€‚</p><p>-Uï¼š è§£é”ç”¨æˆ·é”å®šï¼ˆUnlockï¼‰ã€‚</p><ul><li>chage [é€‰é¡¹] ç”¨æˆ·å</li></ul><p>-l: åˆ—å‡ºç”¨æˆ·çš„è¯¦ç»†å¯†ç çŠ¶æ€</p><p>-d æ—¥æœŸï¼š ä¿®æ”¹å¯†ç æœ€åä¸€æ¬¡æ›´æ”¹æ—¥æœŸï¼ˆshadow3å­—æ®µï¼‰</p><p>-m å¤©æ•°ï¼š ä¸¤æ¬¡å¯†ç ä¿®æ”¹é—´éš”ï¼ˆ4å­—æ®µï¼‰</p><p>-M å¤©æ•°ï¼š å¯†ç æœ‰æ•ˆæœŸï¼ˆ5å­—æ®µï¼‰</p><p>-W å¤©æ•°ï¼šå¯†ç æœ‰æ•ˆæœŸï¼ˆ5å­—æ®µï¼‰</p><p>-I å¤©æ•°ï¼šå¯†ç è¿‡åå®½é™å¤©æ•°ï¼ˆ7å­—æ®µï¼‰</p><p>-E æ—¥æœŸï¼šè´¦å·å¤±æ•ˆæ—¶é—´ï¼ˆ8å­—æ®µï¼‰</p><ul><li>userdel [-r] ç”¨æˆ·å</li></ul><p>-r åˆ é™¤ç”¨æˆ·çš„åŒæ—¶åˆ é™¤ç”¨æˆ·å®¶ç›®å½•</p><p><img src="/2021/06/10/linux-ji-chu/image-20211106161116574.png" alt="image-20211106161116574"></p><h3 id="6-5-ç”¨æˆ·ç»„ç®¡ç†å‘½ä»¤"><a href="#6-5-ç”¨æˆ·ç»„ç®¡ç†å‘½ä»¤" class="headerlink" title="6.5 ç”¨æˆ·ç»„ç®¡ç†å‘½ä»¤"></a>6.5 ç”¨æˆ·ç»„ç®¡ç†å‘½ä»¤</h3><ul><li>æ·»åŠ ç»„<code>groupadd [é€‰é¡¹] ç»„å</code></li></ul><p>-g GID: æŒ‡å®šç»„ID</p><ul><li>ä¿®æ”¹ç»„ groupmod [é€‰é¡¹] ç»„å</li></ul><p>-g GID: ä¿®æ”¹ç»„ID</p><p>-n æ–°ç»„åï¼š ä¿®æ”¹ç»„å</p><ul><li>groupmod -n testgrp group1</li></ul><p>æŠŠç»„ågroup1ä¿®æ”¹ä¸ºtestgrp</p><ul><li><p>åˆ é™¤ç»„ groupdel ç»„å</p></li><li><p>gpasswd é€‰é¡¹ ç»„å</p></li></ul><p>-a ç”¨æˆ·åï¼š æŠŠç”¨æˆ·åŠ å…¥ç»„</p><p>-d ç”¨æˆ·åï¼š æŠŠç”¨æˆ·ä»ç»„ä¸­åˆ é™¤</p><p><code>gpasswd -a user1 root</code> æŠŠuser1åŠ å…¥rootç»„ã€‚ </p><p>æˆ–è€…ç›´æ¥åœ¨/etc/groupæ–‡ä»¶ä¸­æœ€ååŠ å…¥ç”¨æˆ·åã€‚</p><h2 id="7-æƒé™ç®¡ç†"><a href="#7-æƒé™ç®¡ç†" class="headerlink" title="7. æƒé™ç®¡ç†"></a>7. æƒé™ç®¡ç†</h2><h3 id="7-1-ACLæƒé™"><a href="#7-1-ACLæƒé™" class="headerlink" title="7.1 ACLæƒé™"></a>7.1 ACLæƒé™</h3><p>èº«ä»½ä¸è¶³é—®é¢˜ï¼Œå› ä¸ºèº«ä»½åªæœ‰æ‰€æœ‰è€…ã€æ‰€å±ç»„å’Œå…¶ä»–äººã€‚</p><p>ACLå’Œwindowsæ¯”è¾ƒæ¥è¿‘ï¼Œç›´æ¥ç»™è¿™ä¸ªç”¨æˆ·åˆ†é…æƒé™ï¼Œä¸å†è€ƒè™‘æ‰€æœ‰è€…ã€æ‰€å±ç»„å•¥çš„ã€‚</p><ul><li>åˆ†åŒºå¿…é¡»æ”¯æŒACLæƒé™</li></ul><p><code>dumpe2fs -h /dev/sda3</code> dumpe2fså‘½ä»¤æ˜¯æŸ¥è¯¢æŒ‡å®šåˆ†åŒºè¯¦ç»†æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯çš„å‘½ä»¤é€‰é¡¹ï¼š-h ä»…æ˜¾ç¤ºè¶…çº§å—ä¸­ä¿¡æ¯ï¼Œè€Œä¸æ˜¾ç¤ºç£ç›˜å—ç»„çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p><img src="/2021/06/10/linux-ji-chu/image-20211107135443259.png" alt="image-20211107135443259"></p><p>ä¸Šé¢è¿™ä¸ªå›¾ç‰‡çš„ä¿¡æ¯è¡¨ç¤ºæ”¯æŒACLã€‚</p><p>å¦‚æœä¸æ”¯æŒACLï¼Œéœ€è¦å¼€å¯ï¼Œå¼€å¯æ–¹å¼å¦‚ä¸‹ï¼š</p><p><code>mount -o remount, acl /</code> é‡æ–°æŒ‚è½½æ ¹åˆ†åŒºï¼Œå¹¶æŒ‚è½½åŠ å…¥aclæƒé™ã€‚è¿™ä¸ªæ˜¯ä¸´æ—¶ç”Ÿæ•ˆçš„ï¼Œè‹¥æƒ³è¦æ°¸ä¹…ç”Ÿæ•ˆï¼Œéœ€è¦ï¼š</p><p><code>vi /etc/fstab</code> è¿™ä¸ªæ–‡ä»¶æ˜¯ç³»ç»Ÿå¼€æœºè‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ã€‚</p><p><img src="/2021/06/10/linux-ji-chu/image-20211107135936299.png" alt="image-20211107135936299"></p><p>ä¿®æ”¹å®Œæ¯•åï¼Œé‡å¯æˆ–è€…é‡æ–°æŒ‚è½½æ–‡ä»¶ <code>mount -o remount /</code>ã€‚</p><h3 id="7-2-ACLæŸ¥çœ‹ä¸è®¾å®š"><a href="#7-2-ACLæŸ¥çœ‹ä¸è®¾å®š" class="headerlink" title="7.2 ACLæŸ¥çœ‹ä¸è®¾å®š"></a>7.2 ACLæŸ¥çœ‹ä¸è®¾å®š</h3><ul><li><p><code>getfacle æ–‡ä»¶å</code> æŸ¥çœ‹aclæƒé™</p></li><li><p>setfacl é€‰é¡¹ æ–‡ä»¶å</p><ul><li>-m è®¾å®šACLæƒé™</li><li>-x åˆ é™¤æŒ‡å®šçš„ACLæƒé™</li><li>-b åˆ é™¤æ‰€æœ‰çš„ACLæƒé™</li><li>-d è®¾å®šé»˜è®¤ACLæƒé™</li><li>-k åˆ é™¤é»˜è®¤ACLæƒé™</li><li>-R é€’å½’è®¾å®šACLæƒé™</li></ul></li></ul><p><span class="github-emoji"><span>ğŸ¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾‹å­ï¼š ç»™ç”¨æˆ·<code>st</code> è¯»å’Œæ‰§è¡Œ<code>/project</code>ç›®å½•çš„æƒé™ï¼š</p><p><code>setfacl -m u:st:rx /project/</code> åŠ å®Œæƒé™ä¹‹åï¼Œå¯ä»¥å‘ç°<code>ll</code>ä¸‹çš„æƒé™ä¸­å¤šäº†ä¸€ä¸ª<code>+</code>å·ã€‚è¯´åæœ‰å…¶ä»–æƒé™ã€‚</p><p><img src="/2021/06/10/linux-ji-chu/image-20211107141712388.png" alt="image-20211107141712388"></p><p>æŸ¥çœ‹è¿™ä¸ª<code>+</code>æ˜¯ä»€ä¹ˆæƒé™ï¼Œä½¿ç”¨å‘½ä»¤ï¼š <code>getfacl /project</code> </p><p><img src="/2021/06/10/linux-ji-chu/image-20211107141922160.png" alt="image-20211107141922160"></p><h3 id="7-3-æœ€å¤§æœ‰æ•ˆæƒé™å’Œåˆ é™¤"><a href="#7-3-æœ€å¤§æœ‰æ•ˆæƒé™å’Œåˆ é™¤" class="headerlink" title="7.3 æœ€å¤§æœ‰æ•ˆæƒé™å’Œåˆ é™¤"></a>7.3 æœ€å¤§æœ‰æ•ˆæƒé™å’Œåˆ é™¤</h3><p>maskæ˜¯ç”¨æ¥æŒ‡å®šæœ€å¤§æœ‰æ•ˆæƒé™çš„ã€‚å¦‚æœæˆ‘ç»™ç”¨æˆ·èµ‹äºˆäº†ACLæƒé™ï¼Œéœ€è¦å’Œmaskçš„æƒé™â€œç›¸ä¸â€æ‰èƒ½å¾—åˆ°ç”¨æˆ·çš„çœŸæ­£æƒé™ã€‚</p><p><img src="/2021/06/10/linux-ji-chu/image-20211107143407319.png" alt="image-20211107143407319"></p><ul><li><p><code>setfacl -m m:rx /project/</code> æœ€å¤§æƒé™åªæœ‰è¯»å’Œæ‰§è¡Œã€‚</p></li><li><p><code>setfacl -b æ–‡ä»¶å</code> æŠŠæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰ACLæƒé™åˆ é™¤</p></li><li><p><code>setfacl -x g:tgroup2 /project/</code> æŒ‡å®šåˆ é™¤æŸä¸€ä¸ªç”¨æˆ·æˆ–è€…ç»„çš„æƒé™</p></li></ul><h3 id="7-4-é»˜è®¤ACLæƒé™å’Œé€’å½’ACLæƒé™"><a href="#7-4-é»˜è®¤ACLæƒé™å’Œé€’å½’ACLæƒé™" class="headerlink" title="7.4 é»˜è®¤ACLæƒé™å’Œé€’å½’ACLæƒé™"></a>7.4 é»˜è®¤ACLæƒé™å’Œé€’å½’ACLæƒé™</h3><h4 id="7-4-1-é€’å½’ACLæƒé™"><a href="#7-4-1-é€’å½’ACLæƒé™" class="headerlink" title="7.4.1 é€’å½’ACLæƒé™"></a>7.4.1 é€’å½’ACLæƒé™</h4><p>çˆ¶ç›®å½•è®¾å®šçš„ACLæƒé™ï¼Œå­ç›®å½•å’Œå­æ–‡ä»¶ä¹Ÿéƒ½ä¼šæœ‰ä¸€æ ·çš„ACLæƒé™ã€‚</p><ul><li><code>setfacl -m u:ç”¨æˆ·å:æƒé™ -R æ–‡ä»¶å</code> å…¶å®å°±æ˜¯-Rå‚æ•°ã€‚é’ˆå¯¹ç°æœ‰çš„æ–‡ä»¶èµ‹å€¼ACLæƒé™ã€‚</li></ul><h4 id="7-4-2-é»˜è®¤ACLæƒé™"><a href="#7-4-2-é»˜è®¤ACLæƒé™" class="headerlink" title="7.4.2 é»˜è®¤ACLæƒé™"></a>7.4.2 é»˜è®¤ACLæƒé™</h4><p>å¦‚æœçˆ¶ç›®å½•è®¾å®šäº†é»˜è®¤ACLæƒé™ï¼Œé‚£ä¹ˆçˆ¶ç›®å½•ä¸­æ‰€æœ‰æ–°å»ºçš„å­æ–‡ä»¶éƒ½ä¼šç»§æ‰¿çˆ¶ç›®å½•çš„ACLæƒé™ã€‚</p><ul><li><code>setfacl -m d:u:ç”¨æˆ·å:æƒé™ æ–‡ä»¶å</code> é’ˆå¯¹æœªæ¥çš„æ–‡ä»¶èµ‹å€¼ACLæƒé™ã€‚</li></ul><h3 id="7-5-æ–‡ä»¶ç‰¹æ®Šæƒé™"><a href="#7-5-æ–‡ä»¶ç‰¹æ®Šæƒé™" class="headerlink" title="7.5 æ–‡ä»¶ç‰¹æ®Šæƒé™"></a>7.5 æ–‡ä»¶ç‰¹æ®Šæƒé™</h3><h4 id="7-5-1-æ–‡ä»¶ç‰¹æ®Šæƒé™SetUID-4"><a href="#7-5-1-æ–‡ä»¶ç‰¹æ®Šæƒé™SetUID-4" class="headerlink" title="7.5.1 æ–‡ä»¶ç‰¹æ®Šæƒé™SetUID 4"></a>7.5.1 æ–‡ä»¶ç‰¹æ®Šæƒé™SetUID 4</h4><ul><li><p>åªæœ‰æ‰§è¡Œçš„äºŒè¿›åˆ¶ç¨‹åºæ‰èƒ½è®¾å®šSUIDæƒé™ã€‚</p></li><li><p>å‘½ä»¤æ‰§è¡Œè€…è¦å¯¹è¯¥ç¨‹åºæ‹¥æœ‰xï¼ˆæ‰§è¡Œï¼‰æƒé™ã€‚</p></li><li><p>å‘½ä»¤æ‰§è¡Œè€…åœ¨æ‰§è¡Œè¯¥ç¨‹åºæ—¶è·å¾—è¯¥ç¨‹åºæ–‡ä»¶å±ä¸»çš„èº«ä»½ã€‚</p></li><li><p>SetUIDæƒé™åªåœ¨è¯¥ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯èº«ä»½æ”¹å˜åªåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆã€‚</p></li></ul><p><span class="github-emoji"><span>ğŸ§</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f367.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾‹å­ï¼š</p><p><code>passwd</code> å‘½ä»¤æ‹¥æœ‰<code>SetUID</code>æƒé™ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹è‡ªå·±çš„å¯†ç ã€‚</p><p><img src="/2021/06/10/linux-ji-chu/image-20211112123708042.png" alt="image-20211112123708042"></p><p><code>cat</code>å‘½ä»¤æ²¡æœ‰SetUIDæƒé™ï¼Œæ‰€ä»¥æ— æ³•æŸ¥çœ‹<code>/etc/shadow</code>æ–‡ä»¶å†…å®¹ã€‚</p><p><img src="/2021/06/10/linux-ji-chu/image-20211112124519400.png" alt="image-20211112124519400"></p><p>è®¾å®šSetUIDçš„æ–¹æ³•ï¼š</p><ul><li>chmod 4755 æ–‡ä»¶å</li><li>chmod u+s æ–‡ä»¶å</li></ul><p>å–æ¶ˆSetUIDçš„æ–¹æ³•ï¼š</p><ul><li>chmod 755 æ–‡ä»¶å</li><li>chmod u-s æ–‡ä»¶å</li></ul><p>4 è¡¨ç¤ºSUIDã€‚</p><p>è¿™ä¸ªæƒé™å¾ˆå±é™©ï¼Œåœ¨ä½¿ç”¨æ—¶å¿…é¡»è¦è°¨æ…ã€‚æ¯”å¦‚ä½ æŠŠ<code>vi</code>è¿™ä¸ªå‘½ä»¤çš„å¯æ‰§è¡Œæ–‡ä»¶èµ‹äºˆäº†setuidæƒé™ï¼Œé‚£ä¹ˆä»¥åä»»ä½•ä¸€ä¸ªç”¨æˆ·éƒ½å¯ä»¥ç›¸å½“äºrootç”¨æˆ·æ¥ä¿å­˜å’Œä¿®æ”¹ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼ååˆ†å±é™©ï¼</p><p><code>find /bin -perm /u=s</code>  æŸ¥çœ‹/binç›®å½•ä¸‹çš„å¸¦æœ‰sæƒé™çš„æ–‡ä»¶ã€‚</p><p><span class="github-emoji"><span>ğŸ˜«</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f62b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ³¨æ„ï¼Œå¦‚æœ<code>ll</code>åæƒé™ä¸­æœ‰Sï¼Œè¯´æ˜èµ‹äºˆå±æ€§é”™è¯¯ã€‚</p><h4 id="7-5-2-SetGID-2"><a href="#7-5-2-SetGID-2" class="headerlink" title="7.5.2 SetGID 2"></a>7.5.2 SetGID 2</h4><ul><li><p>åªæœ‰äºŒè¿›åˆ¶æ–‡ä»¶æ‰èƒ½è®¾ç½®<code>SGID</code>æƒé™</p></li><li><p>å‘½ä»¤æ‰§è¡Œè€…è¦å¯¹è¯¥ç¨‹åºæ‹¥æœ‰xï¼ˆæ‰§è¡Œï¼‰æƒé™</p></li><li><p>å‘½ä»¤æ‰§è¡Œåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œç»„èº«ä»½å‡çº§ä¸ºè¯¥ç¨‹åºæ–‡ä»¶çš„å±ç»„ã€‚</p></li><li><p>SetGIDæƒé™åŒæ ·åªåœ¨è¯¥ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´ç»„èº«ä»½æ”¹å˜åªåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆã€‚</p></li></ul><p><strong>SetGIDå¯¹ç›®å½•çš„ä½œç”¨ï¼š</strong></p><p>æ™®é€šç”¨æˆ·å¿…é¡»å¯¹æ­¤ç›®å½•æ‹¥æœ‰rå’Œxæƒé™ï¼Œæ‰èƒ½è¿›å…¥æ­¤ç›®å½•ã€‚</p><p>æ™®é€šç”¨æˆ·åœ¨æ­¤ç›®å½•ä¸­çš„æœ‰æ•ˆç»„ä¼šå˜æˆæ­¤ç›®å½•çš„å±ç»„ã€‚</p><p>è‹¥æ™®é€šç”¨æˆ·å¯¹æ­¤ç›®å½•æ‹¥æœ‰wæƒé™æ—¶ï¼Œæ–°å»ºçš„æ–‡ä»¶çš„é»˜è®¤å±ç»„æ˜¯è¿™ä¸ªç›®å½•çš„å±ç»„ã€‚</p><p><span class="github-emoji"><span>ğŸ¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾‹å­ï¼š<img src="/2021/06/10/linux-ji-chu/image-20211112213029883.png" alt="image-20211112213029883"></p><h4 id="7-5-3-Sticky-BIT-æ–‡ä»¶ç‰¹æ®Šæƒé™-1"><a href="#7-5-3-Sticky-BIT-æ–‡ä»¶ç‰¹æ®Šæƒé™-1" class="headerlink" title="7.5.3 Sticky BIT æ–‡ä»¶ç‰¹æ®Šæƒé™ 1"></a>7.5.3 Sticky BIT æ–‡ä»¶ç‰¹æ®Šæƒé™ 1</h4><ul><li>ç²˜ç€ä½ç›®å‰åªå¯¹ç›®å½•æœ‰æ•ˆ</li><li>æ™®é€šç”¨æˆ·å¯¹è¯¥ç›®å½•æ‹¥æœ‰wå’Œxæƒé™ï¼Œå³æ™®é€šç”¨æˆ·å¯ä»¥åœ¨æ­¤ç›®å½•æ‹¥æœ‰å†™å…¥æƒé™ã€‚</li><li>å¦‚æœæ²¡æœ‰é»ç€ä½ï¼Œå› ä¸ºæ™®é€šç”¨æˆ·æ‹¥æœ‰wæƒé™ï¼Œæ‰€ä»¥å¯ä»¥åˆ é™¤æ­¤ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬å…¶ä»–ç”¨æˆ·å»ºç«‹çš„æ–‡ä»¶ã€‚ä¸€æ—¦èµ‹äºˆäº†é»ç€ä½ï¼Œé™¤äº†rootå¯ä»¥åˆ é™¤æ‰€æœ‰æ–‡ä»¶ï¼Œæ™®é€šç”¨æˆ·å°±ç®—æ‹¥æœ‰wæƒé™ï¼Œä¹Ÿåªèƒ½åˆ é™¤è‡ªå·±å»ºç«‹çš„æ–‡ä»¶ï¼Œä½†æ˜¯ä¸èƒ½åˆ é™¤å…¶ä»–ç”¨æˆ·å»ºç«‹çš„æ–‡ä»¶ã€‚</li></ul><p>è®¾ç½®é»ç€ä½ </p><ul><li>chmod 1755 ç›®å½•å</li><li>chmod o+t ç›®å½•å</li></ul><p>å–æ¶ˆé»ç€ä½</p><ul><li>chmod 777 ç›®å½•å</li><li>chmod o-t ç›®å½•å</li></ul><p><span class="github-emoji"><span>ğŸ¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾‹å­ï¼š</p><p><img src="/2021/06/10/linux-ji-chu/image-20211112213233069.png" alt="image-20211112213233069"></p><h3 id="7-6-chattræƒé™"><a href="#7-6-chattræƒé™" class="headerlink" title="7.6 chattræƒé™"></a>7.6 chattræƒé™</h3><p><code>chattr [+-=] [é€‰é¡¹] æ–‡ä»¶æˆ–ç›®å½•å</code></p><p><code>+:å¢åŠ æƒé™</code></p><p><code>-:åˆ é™¤æƒé™</code></p><p><code>=:ç­‰äºæŸæƒé™</code></p><p>æ”¹å˜æ–‡ä»¶å±æ€§</p><p><code>i</code>: å¦‚æœå¯¹æ–‡ä»¶è®¾ç½®iå±æ€§ï¼Œé‚£ä¹ˆä¸å…è®¸å¯¹æ–‡ä»¶è¿›è¡Œåˆ é™¤ã€æ”¹åï¼Œä¹Ÿä¸èƒ½æ·»åŠ å’Œä¿®æ”¹æ•°æ®ã€‚å¦‚æœå¯¹ç›®å½•è®¾<code>i</code>å±æ€§ï¼Œé‚£ä¹ˆåªèƒ½ä¿®æ”¹ç›®å½•ä¸‹æ–‡ä»¶çš„æ•°æ®ï¼Œä½†ä¸å…è®¸å»ºç«‹å’Œåˆ é™¤æ–‡ä»¶ã€‚</p><p><code>a</code>ï¼šå¦‚æœå¯¹æ–‡ä»¶è®¾ç½®aå±æ€§ï¼Œé‚£ä¹ˆåªèƒ½åœ¨æ–‡ä»¶ä¸­å¢åŠ æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½åˆ é™¤å’Œä¿®æ”¹æ•°æ®ã€‚å¦‚æœå¯¹ç›®å½•è®¾ç½®aå±æ€§ï¼Œé‚£ä¹ˆåªå…è®¸åœ¨ç›®å½•ä¸­å»ºç«‹å’Œä¿®æ”¹æ–‡ä»¶ï¼Œä½†æ˜¯ä¸å…è®¸åˆ é™¤ã€‚</p><p><strong>lsattr</strong> é€‰é¡¹ æ–‡ä»¶å ï¼ˆæŸ¥çœ‹æƒé™ï¼‰</p><ul><li>-a æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ã€‚</li><li>-d è‹¥ç›®æ ‡æ˜¯ç›®å½•ï¼Œä»…åˆ—å‡ºç›®å½•æœ¬èº«çš„å±æ€§ï¼Œè€Œä¸æ˜¯å­æ–‡ä»¶çš„ã€‚</li></ul><p><span class="github-emoji"><span>ğŸ¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>chattr +i abc</code> æ·»åŠ <code>i</code>å±æ€§ã€‚</p><h3 id="7-7-sudoæƒé™"><a href="#7-7-sudoæƒé™" class="headerlink" title="7.7 sudoæƒé™"></a>7.7 sudoæƒé™</h3><ul><li>rootæŠŠæœ¬æ¥åªèƒ½è¶…çº§ç”¨æˆ·æ‰§è¡Œçš„å‘½ä»¤èµ‹äºˆæ™®é€šç”¨æˆ·æ‰§è¡Œã€‚</li><li>sudoçš„æ“ä½œå¯¹è±¡æ˜¯ç³»ç»Ÿå‘½ä»¤ã€‚</li></ul><p><img src="/2021/06/10/linux-ji-chu/image-20211113144628539.png" alt="image-20211113144628539"></p><p><span class="github-emoji"><span>ğŸ¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ä¾‹å­ï¼š</p><p><code>sc ALL=/sbin/shudown -r now</code> å†™çš„å¾ˆç»†çš„å‘½ä»¤ï¼Œè¿™ä¸€æ¡scç”¨æˆ·å°±åªèƒ½ä½¿ç”¨å¸¦ç€-rå‚æ•°çš„å‘½ä»¤ã€‚</p><h2 id="8-åˆ†åŒº"><a href="#8-åˆ†åŒº" class="headerlink" title="8. åˆ†åŒº"></a>8. åˆ†åŒº</h2><h3 id="8-1-åˆ†åŒºç±»å‹"><a href="#8-1-åˆ†åŒºç±»å‹" class="headerlink" title="8.1 åˆ†åŒºç±»å‹"></a>8.1 åˆ†åŒºç±»å‹</h3><p><img src="/2021/06/10/linux-ji-chu/image-20211113151814602.png" alt="image-20211113151814602"></p><p><span class="github-emoji"><span>ğŸ¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f366.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ä¾‹å­ï¼š</p><p><img src="/2021/06/10/linux-ji-chu/image-20211113151824492.png" alt="image-20211113151824492"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211113151937225.png" alt="image-20211113151937225"></p><p><img src="/2021/06/10/linux-ji-chu/image-20211113152050859.png" alt="image-20211113152050859"></p><p>1 2 3 4 åªèƒ½åˆ†é…ç»™ä¸»åˆ†åŒºæˆ–è€…æ‰©å±•åˆ†åŒºå·ï¼Œé€»è¾‘åˆ†åŒºåªèƒ½ä»5å¼€å§‹ã€‚</p><h3 id="8-2-dfå‘½ä»¤"><a href="#8-2-dfå‘½ä»¤" class="headerlink" title="8.2 dfå‘½ä»¤"></a>8.2 dfå‘½ä»¤</h3><p><code>df [é€‰é¡¹][æŒ‚è½½ç‚¹]</code> æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿå¤§å°å’Œä½¿ç”¨æƒ…å†µ</p><p>é€‰é¡¹ï¼š</p><p> -a æ˜¾ç¤ºæ‰€æœ‰çš„æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ï¼š/procã€/sysfsã€‚</p><p>-h ä½¿ç”¨ä¹ æƒ¯å•ä½æ˜¾ç¤ºå®¹é‡ï¼Œå¦‚KBï¼ŒMBæˆ–GBç­‰ã€‚</p><p>-T æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚</p><p>-m å·²MBä¸ºå•ä½æ˜¾ç¤ºå®¹é‡ã€‚</p><p>-k ä»¥KBå•ä½æ˜¾ç¤ºå®¹é‡ã€‚é»˜è®¤å°±æ˜¯KBä¸ºå•ä½ã€‚</p><h3 id="8-3-ç»Ÿè®¡ç›®å½•æˆ–æ–‡ä»¶å¤§å°"><a href="#8-3-ç»Ÿè®¡ç›®å½•æˆ–æ–‡ä»¶å¤§å°" class="headerlink" title="8.3 ç»Ÿè®¡ç›®å½•æˆ–æ–‡ä»¶å¤§å°"></a>8.3 ç»Ÿè®¡ç›®å½•æˆ–æ–‡ä»¶å¤§å°</h3><p><code>du [é€‰é¡¹] [ç›®å½•æˆ–æ–‡ä»¶å]</code></p><p>-a æ˜¾ç¤ºæ¯ä¸ªå­æ–‡ä»¶çš„ç£ç›˜å ç”¨é‡ã€‚é»˜è®¤åªç»Ÿè®¡å­ç›®å½•çš„ç£ç›˜å ç”¨é‡</p><p>-h ä½¿ç”¨ä¹ æƒ¯å•ä½æ˜¾ç¤ºç£ç›˜å ç”¨é‡ï¼Œå¦‚KBï¼ŒMBæˆ–GBç­‰</p><p>-s ç»Ÿè®¡æ€»å ç”¨é‡ï¼Œè€Œä¸åˆ—å‡ºå­ç›®å½•å’Œå­æ–‡ä»¶çš„å ç”¨é‡ã€‚</p><p><span class="github-emoji"><span>ğŸ˜†</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> duå’Œdfçš„åŒºåˆ«æ˜¯ï¼Œdfæ˜¾ç¤ºçš„ç©ºé—´å¤§å°ä¸€èˆ¬å¤§äºduï¼Œå› ä¸ºé•¿æ—¶é—´ä¸é‡å¯æœºå­ï¼ŒæŸäº›è¿›ç¨‹æ‰€ç•™ä¸‹çš„ä¸´æ—¶æ–‡ä»¶æˆ–åˆ é™¤çš„æ–‡ä»¶ç©ºé—´å¹¶æ²¡æœ‰é‡Šæ”¾ã€‚</p><h3 id="8-4-æ–‡ä»¶ç³»ç»Ÿä¿®å¤å‘½ä»¤-fsck"><a href="#8-4-æ–‡ä»¶ç³»ç»Ÿä¿®å¤å‘½ä»¤-fsck" class="headerlink" title="8.4 æ–‡ä»¶ç³»ç»Ÿä¿®å¤å‘½ä»¤ fsck"></a>8.4 æ–‡ä»¶ç³»ç»Ÿä¿®å¤å‘½ä»¤ fsck</h3><p><code>fsck [é€‰é¡¹] åˆ†åŒºè®¾å¤‡æ–‡ä»¶å</code> </p><p>-aï¼šä¸ç”¨æ˜¾ç¤ºç”¨æˆ·æç¤ºï¼Œè‡ªåŠ¨ä¿®å¤æ–‡ä»¶ç³»ç»Ÿã€‚</p><p>-yï¼šè‡ªåŠ¨ä¿®å¤ã€‚å’Œ-aä½œç”¨ä¸€è‡´ï¼Œä¸è¿‡æœ‰äº›æ–‡ä»¶ç³»ç»Ÿåªæ”¯æŒ-yã€‚</p><h3 id="8-5-ç£ç›˜çŠ¶æ€å‘½ä»¤dumpe2fs"><a href="#8-5-ç£ç›˜çŠ¶æ€å‘½ä»¤dumpe2fs" class="headerlink" title="8.5 ç£ç›˜çŠ¶æ€å‘½ä»¤dumpe2fs"></a>8.5 ç£ç›˜çŠ¶æ€å‘½ä»¤dumpe2fs</h3><p><code>dumpe2fs åˆ†åŒºè®¾å¤‡æ–‡ä»¶å</code> è¿™ä¸ªå‘½ä»¤è¿˜å¯ä»¥æŸ¥è¯¢åˆ°è®¾å¤‡çš„UUIDå·ã€‚</p><h3 id="8-6-mountæŸ¥è¯¢å’Œè‡ªåŠ¨æŒ‚è½½"><a href="#8-6-mountæŸ¥è¯¢å’Œè‡ªåŠ¨æŒ‚è½½" class="headerlink" title="8.6 mountæŸ¥è¯¢å’Œè‡ªåŠ¨æŒ‚è½½"></a>8.6 mountæŸ¥è¯¢å’Œè‡ªåŠ¨æŒ‚è½½</h3><p>mountå‘½ä»¤æœ¬èº«å¯ä»¥æŸ¥è¯¢å·²ç»æŒ‚è½½çš„è®¾å¤‡ã€‚</p><p><code>mount [-l]</code> æŸ¥è¯¢ç³»ç»Ÿä¸­å·²ç»æŒ‚è½½çš„è®¾å¤‡ï¼Œ-lä¼šæ˜¾ç¤ºå·æ ‡åç§°ã€‚</p><p><code>mount -a</code> ä¾æ®é…ç½®æ–‡ä»¶<code>/etc/fstab</code>çš„å†…å®¹ï¼Œè‡ªåŠ¨æŒ‚è½½ã€‚</p><p><code>mount [-t æ–‡ä»¶ç³»ç»Ÿ] [-L å·æ ‡å] [-o ç‰¹æ®Šé€‰é¡¹] è®¾å¤‡æ–‡ä»¶å æŒ‚è½½ç‚¹</code></p><p>é€‰é¡¹ï¼š -t æ–‡ä»¶ç³»ç»Ÿï¼šåŠ å…¥æ–‡ä»¶ç³»ç»Ÿç±»å‹æ¥æŒ‡å®šæŒ‚è½½çš„ç±»å‹ï¼Œå¯ä»¥ext3ã€ext4ã€iso9660ç­‰æ–‡ä»¶ç³»ç»Ÿ</p><p>-L å·æ ‡åï¼š æŒ‚è½½æŒ‡å®šå·æ ‡çš„åˆ†åŒºï¼Œè€Œä¸æ˜¯å®‰è£…è®¾å¤‡æ–‡ä»¶åæŒ‚è½½</p><p>-o é€‰é¡¹ç‰¹æ®Šï¼šå¯ä»¥æŒ‡å®šæŒ‚è½½çš„é¢å¤–é€‰é¡¹</p><p><img src="/2021/06/10/linux-ji-chu/image-20211113172923073.png" alt="image-20211113172923073"></p><h4 id="8-6-1-æŒ‚è½½å…‰ç›˜å’ŒUç›˜"><a href="#8-6-1-æŒ‚è½½å…‰ç›˜å’ŒUç›˜" class="headerlink" title="8.6.1 æŒ‚è½½å…‰ç›˜å’ŒUç›˜"></a>8.6.1 æŒ‚è½½å…‰ç›˜å’ŒUç›˜</h4><blockquote><p>å»ºç«‹æŒ‚è½½ç‚¹</p><p><code>mkdir /mnt/cdrom/</code></p><p>æŒ‚è½½å…‰ç›˜</p><p><code>mount -t iso9660 /dev/cdrom /mnt/cdrom/</code> æŠŠè®¾å¤‡æ–‡ä»¶æŒ‚è½½åˆ°/mntçš„è¿™ä¸ªç›®å½•ä¸‹</p><p><code>mount /dev/sr0 /mnt/cdrom</code> æŠŠè®¾å¤‡æ–‡ä»¶æŒ‚è½½åˆ°/mntçš„è¿™ä¸ªç›®å½•ä¸‹</p></blockquote><blockquote><p>å¸è½½å‘½ä»¤</p><p><code>umount è®¾å¤‡æ–‡ä»¶åæˆ–æŒ‚è½½ç‚¹</code></p><p><code>umount /mnt/cdrom</code> </p></blockquote><h4 id="8-6-2-æŒ‚è½½uç›˜"><a href="#8-6-2-æŒ‚è½½uç›˜" class="headerlink" title="8.6.2 æŒ‚è½½uç›˜"></a>8.6.2 æŒ‚è½½uç›˜</h4><p><code>fdisk -l</code> æŸ¥çœ‹åˆ†åŒº</p><p><code>mount -t vfat /dev/sdb1 /mnt/usb/</code></p><p><span class="github-emoji"><span>ğŸ˜ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f620.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> linuxé»˜è®¤æ˜¯ä¸æ”¯æŒNTFSæ–‡ä»¶ç³»ç»Ÿçš„ã€‚</p><h4 id="8-6-3-æ”¯æŒNTFSæ–‡ä»¶ç³»ç»Ÿ"><a href="#8-6-3-æ”¯æŒNTFSæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="8.6.3 æ”¯æŒNTFSæ–‡ä»¶ç³»ç»Ÿ"></a>8.6.3 æ”¯æŒNTFSæ–‡ä»¶ç³»ç»Ÿ</h4><ul><li>é‡æ–°ç¼–è¯‘å†…æ ¸çš„æ–¹å¼ï¼Œä¸æ¨è :happy: ã€‚</li><li>åˆ©ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶: ntfs-3g</li></ul><blockquote><p>ntfs-3g</p><blockquote><p><code>tar -zxvf ntfs-3g_ntfsprogs-2013.1.13.tgz</code></p><p><code>cd ntfs-3gxxx</code></p><p><code>./configure</code></p><p><code>make</code></p><p><code>make install</code></p><p><code>mount -t ntfs-3g åˆ†åŒºè®¾å¤‡æ–‡ä»¶å æŒ‚è½½ç‚¹</code></p></blockquote></blockquote><h3 id="8-7-fdiskåˆ†åŒº"><a href="#8-7-fdiskåˆ†åŒº" class="headerlink" title="8.7 fdiskåˆ†åŒº"></a>8.7 fdiskåˆ†åŒº</h3><p>æŸ¥çœ‹ç¡¬ç›˜ï¼š</p><p><code>fdisk -l</code></p><p><code>fdisk /dev/sdb</code></p><p><img src="/2021/06/10/linux-ji-chu/image-20211114195657353.png" alt="image-20211114195657353"></p><p>é‡æ–°è¯»å–åˆ†åŒºè¡¨ä¿¡æ¯ï¼š <code>partprobe</code></p><h4 id="8-7-1-æ ¼å¼åŒ–åˆ†åŒº"><a href="#8-7-1-æ ¼å¼åŒ–åˆ†åŒº" class="headerlink" title="8.7.1 æ ¼å¼åŒ–åˆ†åŒº"></a>8.7.1 æ ¼å¼åŒ–åˆ†åŒº</h4><p><code>mkfs -t ext4 /dev/dsb1</code></p><h3 id="8-8-åˆ†åŒºè‡ªåŠ¨æŒ‚è½½å’Œfstabæ–‡ä»¶ä¿®å¤"><a href="#8-8-åˆ†åŒºè‡ªåŠ¨æŒ‚è½½å’Œfstabæ–‡ä»¶ä¿®å¤" class="headerlink" title="8.8 åˆ†åŒºè‡ªåŠ¨æŒ‚è½½å’Œfstabæ–‡ä»¶ä¿®å¤"></a>8.8 åˆ†åŒºè‡ªåŠ¨æŒ‚è½½å’Œfstabæ–‡ä»¶ä¿®å¤</h3><blockquote><p>è‡ªåŠ¨æŒ‚è½½</p><blockquote><p>å†™å…¥<code>/etc/fstab</code> æ–‡ä»¶ã€‚ ä¸€å®šè¦å†™å¯¹ï¼Œå¦‚æœå†™ä¸å¯¹å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</p><p>:happy: <code>fstab</code> æ–‡ä»¶å†…å®¹ï¼š</p><p><img src="/2021/06/10/linux-ji-chu/image-20211117213822198.png" alt="image-20211117213822198"></p></blockquote><p><span class="github-emoji"><span>ğŸ˜¢</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f622.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>fstab</code> <font color="red">å†…å®¹å¦‚æœæ”¹é”™äº†å’‹åŠï¼Ÿ</font></p><p><img src="/2021/06/10/linux-ji-chu/image-20211117220201017.png" alt="image-20211117220201017"></p><p>ä½¿ç”¨mount é‡æ–°æŒ‚è½½æ‰èƒ½ä¿®æ”¹<code>fstab</code> æ–‡ä»¶ã€‚</p></blockquote><h2 id="9-SHELL"><a href="#9-SHELL" class="headerlink" title="9.SHELL"></a>9.SHELL</h2><p><img src="/2021/06/10/linux-ji-chu/image-20211117220524694.png" alt="image-20211117220524694"></p><p>SHELL æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ˜¯è§£é‡Šæ‰§è¡Œçš„è„šæœ¬è¯­è¨€ï¼Œåœ¨SHELLä¸­å¯ä»¥ç›´æ¥è°ƒç”¨LINUXç³»ç»Ÿå‘½ä»¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysqlåŸºç¡€</title>
      <link href="2021/06/10/mysql-ji-chu/"/>
      <url>2021/06/10/mysql-ji-chu/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1.å®‰è£…"></a>1.å®‰è£…</h2><h1 id="1-centos"><a href="#1-centos" class="headerlink" title="1 centos"></a>1 centos</h1><h3 id="1-1-centos-mysql-5-7"><a href="#1-1-centos-mysql-5-7" class="headerlink" title="1.1 centos mysql 5.7"></a>1.1 centos mysql 5.7</h3><blockquote><p>CentOS 7çš„é»˜è®¤yumä»“åº“ä¸­å¹¶æ²¡æœ‰MySQL5.7ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼Œå¥½åœ¨MySQLå®˜æ–¹æä¾›äº†ä»“åº“çš„åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿæ¯”è¾ƒç®€å•åœ°å®‰è£…MySQLã€‚</p><p>æœ¬æ–‡æˆ‘ä»¬å°†ä»‹ç»CentOS 7ä¸‹MySQL5.7çš„å®‰è£…ã€‚</p></blockquote><ol><li>æ·»åŠ Mysql5.7ä»“åº“</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">rpm</span> -ivh https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>ç¡®è®¤Mysqlä»“åº“æˆåŠŸæ·»åŠ </li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum repolist all <span class="token operator">|</span> <span class="token function">grep</span> mysql <span class="token operator">|</span> <span class="token function">grep</span> enabled<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœå±•ç¤ºåƒä¸‹é¢,åˆ™è¡¨ç¤ºæˆåŠŸæ·»åŠ ä»“åº“:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql-connectors-community/x86_64  MySQL Connectors Community    enabled:     <span class="token number">51</span>mysql-tools-community/x86_64       MySQL Tools Community         enabled:     <span class="token number">63</span>mysql57-community/x86_64           MySQL <span class="token number">5.7</span> Community Server    enabled:    <span class="token number">267</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol><li>å¼€å§‹å®‰è£…Mysql5.7</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum -y <span class="token function">install</span> mysql-community-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>centos8.2å®‰è£…mysql8.0æ—¶æŠ¥é”™Error:Unable to find a match: mysql-community-server</p><pre class="line-numbers language-none"><code class="language-none">yum module disable mysqlyum -y install mysql-community-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li></li><li><p>å¯åŠ¨Mysql</p><ol><li>å¯åŠ¨</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>è®¾ç½®ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl status mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>Mysqlçš„å®‰å…¨è®¾ç½®</p><p>CentOSä¸Šçš„rooté»˜è®¤å¯†ç å¯ä»¥åœ¨æ–‡ä»¶/var/log/mysqld.logæ‰¾åˆ°ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥æ‰“å°å‡ºæ¥</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /var/log/mysqld.log <span class="token operator">|</span> <span class="token function">grep</span> -i <span class="token string">'temporary password'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰§è¡Œä¸‹é¢å‘½ä»¤è¿›è¡Œå®‰å…¨è®¾ç½®ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šè¿›è¡Œè®¾ç½®rootå¯†ç è®¾ç½®ï¼Œç§»é™¤åŒ¿åç”¨æˆ·ï¼Œç¦æ­¢rootç”¨æˆ·è¿œç¨‹è¿æ¥ç­‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql_secure_installation<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>è®¾ç½®æ•°æ®åº“ç¼–ç ä¸ºutf8</p><ol><li>æ‰“å¼€é…ç½®æ–‡ä»¶</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/my.cnf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>åœ¨[mysqld]ï¼Œ[client]ï¼Œ[mysql]èŠ‚ç‚¹ä¸‹æ·»åŠ ç¼–ç è®¾ç½®</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>client<span class="token punctuation">]</span>default-character-set<span class="token operator">=</span>utf8<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>default-character-set<span class="token operator">=</span>utf8<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>collation-server <span class="token operator">=</span> utf8_unicode_ciinit-connect<span class="token operator">=</span><span class="token string">'SET NAMES utf8'</span>character-set-server <span class="token operator">=</span> utf8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>é‡å¯Mysqlå³å¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h4 id="1-1-2-æ›´æ”¹ç”¨æˆ·åå’Œå¯†ç "><a href="#1-1-2-æ›´æ”¹ç”¨æˆ·åå’Œå¯†ç " class="headerlink" title="1.1.2 æ›´æ”¹ç”¨æˆ·åå’Œå¯†ç "></a>1.1.2 æ›´æ”¹ç”¨æˆ·åå’Œå¯†ç </h4><p>1ã€ä¿®æ”¹ <code>/etc/my.cnf</code>ï¼Œåœ¨ [mysqld] å°èŠ‚ä¸‹æ·»åŠ ä¸€è¡Œï¼š<code>skip-grant-tables=1</code></p><p>è¿™ä¸€è¡Œé…ç½®è®© mysqld å¯åŠ¨æ—¶ä¸å¯¹å¯†ç è¿›è¡ŒéªŒè¯</p><p>2ã€é‡å¯ mysqld æœåŠ¡ï¼š<code>systemctl restart mysqld</code></p><p>3ã€ä½¿ç”¨ root ç”¨æˆ·ç™»å½•åˆ° <code>mysqlï¼šmysql -u root</code></p><p>æ³¨é‡Šï¼šå½“çœ‹åˆ°å¯†ç è¾“å…¥æ—¶ç›´æ¥æŒ‰return</p><p>æ·»åŠ æ–°å¯†ç </p><p>1ã€åˆ‡æ¢åˆ°mysqlæ•°æ®åº“ï¼Œæ›´æ–° user è¡¨ï¼š</p><p><code>use mysql</code></p><p><code>update user set authentication_string = password('æ–°å¯†ç '), password_expired = 'N', password_last_changed = now() where user = 'root';</code></p><p>åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¯†ç å­—æ®µçš„å­—æ®µåæ˜¯ passwordï¼Œ5.7ç‰ˆæœ¬æ”¹ä¸ºäº† <code>authentication_string</code></p><p>æ¢å¤ä½¿ç”¨rootå¯†ç </p><p>1ã€é€€å‡º mysqlï¼Œç¼–è¾‘ <code>/etc/my.cnf </code>æ–‡ä»¶ï¼Œåˆ é™¤ skip-grant-tables=1 çš„å†…å®¹</p><p>2ã€é‡å¯ mysqld æœåŠ¡ï¼Œå†ç”¨æ–°å¯†ç ç™»å½•å³å¯</p><h2 id="2-å¤‡ä»½å’Œæ¢å¤"><a href="#2-å¤‡ä»½å’Œæ¢å¤" class="headerlink" title="2. å¤‡ä»½å’Œæ¢å¤"></a>2. å¤‡ä»½å’Œæ¢å¤</h2><p><strong>å¤‡ä»½æ–¹æ³•</strong></p><pre class="line-numbers language-none"><code class="language-none">mysqldump -uroot -p000 db table &gt; db.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¿˜åŸæ–¹æ³•</strong></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql -uroot -p000 &lt; db.sql #ç›´æ¥æ¢å¤æ•´ä¸ªæ•°æ®åº“mysql -uroot -p000 db_tencent_health_data &lt; t_doctor_20210607.sql #åœ¨è¿™ä¸ªæ•°æ®åº“ä¸­å»ºç«‹è¿™å¼ è¡¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> å‚è€ƒï¼š </p><p>1.æ‹·å¤‡æ–‡ä»¶      :  (ä¿è¯æ•°æ®åº“æ²¡æœ‰å†™æ“ä½œ(å¯ä»¥ç»™è¡¨ä¸Šé”å®š))ç›´æ¥æ‹·è´æ–‡ä»¶ä¸èƒ½ç§»æ¤åˆ°å…¶å®ƒæœºå™¨ä¸Šï¼Œé™¤éä½ æ­£åœ¨æ‹·è´çš„è¡¨ä½¿ç”¨MyISAMå­˜å‚¨æ ¼å¼<br>2.mysqldump   :  mysqldumpç”Ÿæˆèƒ½å¤Ÿç§»æ¤åˆ°å…¶å®ƒæœºå™¨çš„æ–‡æœ¬æ–‡ä»¶ </p><p>ä¾‹:<br>å¤‡ä»½æ•´ä¸ªæ•°æ®åº“   â€“&gt;   mysqldump db1 &gt;/backup/db1.20060725<br>å‹ç¼©å¤‡ä»½        â€“&gt;   mysqldump db1 | gzip &gt;/backup/db1.20060725<br>åˆ†è¡¨å¤‡ä»½        â€“&gt;   mysqldump db1 tab1 tab2 &gt;/backup/db1_tab1_tab2.sql<br>ç›´æ¥è¿œç¨‹å¤‡ä»½     â€“&gt;   mysqladmin -h boa.snake.net create db1<br>              â€“&gt;   mysqldump db1 | mysql -h boa.snake.net db1 </p><p>å¤åˆ¶å¤‡ä»½è¡¨      â€“&gt;   cp tab.*   backup/ </p><p>æ¢å¤<br>ç”¨æœ€æ–°çš„å¤‡ä»½æ–‡ä»¶é‡è£…æ•°æ®åº“ã€‚å¦‚æœä½ ç”¨mysqldumpäº§ç”Ÿçš„æ–‡ä»¶ï¼Œå°†å®ƒä½œä¸ºmysqlçš„è¾“å…¥ã€‚å¦‚æœä½ ç”¨ç›´æ¥ä»æ•°æ®åº“æ‹·è´æ¥çš„æ–‡ä»¶ï¼Œå°†å®ƒä»¬ç›´æ¥æ‹·å›æ•°æ®åº“ç›®å½•ï¼Œç„¶è€Œï¼Œæ­¤æ—¶ä½ éœ€è¦åœ¨æ‹·è´æ–‡ä»¶ä¹‹å‰å…³é—­æ•°æ®åº“ï¼Œç„¶åé‡å¯å®ƒã€‚  </p><h3 id="3-å½»åº•å¸è½½ï¼ˆä¸ä¿ç•™æ•°æ®ï¼‰"><a href="#3-å½»åº•å¸è½½ï¼ˆä¸ä¿ç•™æ•°æ®ï¼‰" class="headerlink" title="3. å½»åº•å¸è½½ï¼ˆä¸ä¿ç•™æ•°æ®ï¼‰"></a>3. å½»åº•å¸è½½ï¼ˆä¸ä¿ç•™æ•°æ®ï¼‰</h3><p>1ã€ rpm -qa | grep -i mysql</p><p>æŸ¥æ‰¾å·²ç»å®‰è£…çš„mysql.</p><p>MySQL-server-5.6.43-1.el6.x86_64 </p><p>MySQL-client-5.6.43-1.el6.x86_64</p><p>MySQL-devel-5.6.43-1.el6.x86_64</p><p>ä»¥ä¸Šä¸‰ä¸ªå°±æ˜¯æˆ‘å®‰è£…çš„mysql.</p><p>2ã€ yum -y remove MySQL-*</p><p>ç½‘ä¸Šçš„ä¸€èˆ¬ç”¨rpm -e çš„å‘½ä»¤åˆ é™¤mysql,è¿™æ ·è¡¨é¢ä¸Šåˆ é™¤äº†mysql,å¯æ˜¯mysqlçš„ä¸€äº›æ®‹ä½™ç¨‹åºä»ç„¶å­˜åœ¨,å¹¶ä¸”é€šè¿‡ç¬¬ä¸€æ­¥çš„æ–¹å¼ä¹ŸæŸ¥æ‰¾ä¸åˆ°æ®‹ä½™,è€Œyumå‘½ä»¤æ¯”è¾ƒå¼ºå¤§,å¯ä»¥å®Œå…¨åˆ é™¤mysql.(ps:ç”¨rpmåˆ é™¤åå†æ¬¡å®‰è£…çš„æ—¶å€™ä¼šæç¤ºå·²ç»å®‰è£…äº†,è¿™å°±æ˜¯rpmæ²¡åˆ é™¤å¹²å‡€çš„åŸå› )</p><p>3ã€ find / -name mysql</p><p>æŸ¥æ‰¾mysqlçš„ä¸€äº›ç›®å½•,æŠŠæ‰€æœ‰å‡ºç°çš„ç›®å½•ç»Ÿç»Ÿåˆ é™¤.å¯ä»¥ä½¿ç”¨rm -rf è·¯å¾„ï¼Œåˆ é™¤æ—¶è¯·æ³¨æ„ï¼Œä¸€æ—¦åˆ é™¤æ— æ³•æ¢å¤ã€‚</p><p>4ã€rm -rf /etc/my.cnf</p><p>è¿™ä¸ªæ˜¯åˆ é™¤é…ç½®æ–‡ä»¶</p><p>5ã€ rm -rf /root/.mysql_sercret</p><p>åˆ é™¤mysqlçš„é»˜è®¤å¯†ç ,å¦‚æœä¸åˆ é™¤,ä»¥åå®‰è£…mysqlè¿™ä¸ªsercretä¸­çš„é»˜è®¤å¯†ç ä¸ä¼šå˜,ä½¿ç”¨å…¶ä¸­çš„é»˜è®¤å¯†ç å°±å¯èƒ½ä¼šæŠ¥ç±»ä¼¼Access denied for user â€˜root@localhostâ€™ (using password:yes)çš„é”™è¯¯.</p><p>äº”æ­¥å®Œæˆä¹‹å,è¿™æ ·mysqlå°±å…¨éƒ¨åˆ é™¤å¹²å‡€äº†.</p><h1 id="2-ubuntu18-04"><a href="#2-ubuntu18-04" class="headerlink" title="2. ubuntu18.04"></a>2. ubuntu18.04</h1><p>ä¸€ï¼Œå½»åº•åˆ é™¤mysql5.7<br>ä¸€ï¼ŒæŸ¥çœ‹mysqlçš„ä¾èµ–é¡¹ï¼š</p><p><code>dpkg --list | grep mysql</code><br>äºŒï¼Œå¸è½½</p><p><code>sudo apt-get remove mysql-common</code><br>ä¸‰ï¼Œå¸è½½ï¼ˆæœ€åçš„ç‰ˆæœ¬æ•°å­—æ ¹æ®è‡ªå·±å…·ä½“çš„ç‰ˆæœ¬è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ï¼‰</p><p><code>sudo apt-get autoremove --purge mysql-server-5.7</code><br>å››ï¼Œæ¸…æ¥šæ®‹ç•™æ•°æ®</p><p><code>dpkg -l|grep ^rc|awk '{print$2}'|sudo xargs dpkg -P</code><br>äº”ï¼Œå†æ¬¡æŸ¥çœ‹ä¾èµ–é¡¹</p><p><code>dpkg --list|grep mysql</code><br>è‹¥å‘½ä»¤è¾“å…¥ä¹‹åæ— ååº”ç›´æ¥å‡ºç°å‘½ä»¤æç¤ºç¬¦ï¼Œåˆ™è¯´æ˜ä¾èµ–é¡¹å®Œå…¨åˆ é™¤ï¼šï¼ˆè¿™é‡Œæˆ‘é‡å¤è¾“å…¥äº†ä¸¤è¾¹ï¼‰</p><p>è‹¥ä»æœ‰å…¶ä»–å†…å®¹ï¼Œåˆ™ç»§ç»­æ¸…é™¤å‰©ä½™ä¾èµ–é¡¹ï¼šï¼ˆè¿™é‡Œçš„å‘½ä»¤ä¸ä¸Šä¸€æ¡æ¸…é™¤å‘½ä»¤ä¸åŒï¼‰</p><p><code>sudo apt-get autoremove --purge mysql-apt-config</code></p><p>æœ€åæŸ¥çœ‹ä¾èµ–é¡¹ï¼›æ— ï¼Œå®Œå…¨åˆ é™¤ï¼›</p><h2 id="2-1-å®‰è£…"><a href="#2-1-å®‰è£…" class="headerlink" title="2.1 å®‰è£…"></a>2.1 å®‰è£…</h2><p> <code>wget https://dev.mysql.com/get/mysql-apt-config_0.8.19-1_all.deb</code></p><p><code>dpkg -i mysql-apt-config_0.8.11-1_all.deb</code></p><p><code>apt-get update</code></p><p><code>apt-get install mysql-server</code></p><p>å‚è€ƒé“¾æ¥ï¼š <a href="http://www.4k8k.xyz/article/weixin_43900412/85053662">Ubuntu18.04å®‰è£…Mysql8.0_bird of paradiseçš„åšå®¢-ç¨‹åºå‘˜èµ„æ–™_ubuntuå®‰è£…mysql8.0 - ç¨‹åºå‘˜èµ„æ–™ (4k8k.xyz)</a></p><p><code>service mysql start</code></p><p><code>mysql -uroot -p</code></p><h3 id="2-1-1-é…ç½®"><a href="#2-1-1-é…ç½®" class="headerlink" title="2.1.1 é…ç½®"></a>2.1.1 é…ç½®</h3><p><code>use mysql</code></p><p><code>update user set host=% where user=root;</code></p><p><code>flush privileges</code></p><h3 id="2-1-2-åˆ›å»ºåˆ é™¤æˆæƒ"><a href="#2-1-2-åˆ›å»ºåˆ é™¤æˆæƒ" class="headerlink" title="2.1.2 åˆ›å»ºåˆ é™¤æˆæƒ"></a>2.1.2 åˆ›å»ºåˆ é™¤æˆæƒ</h3><p>Â·åˆ›å»ºç”¨æˆ·</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'test1'</span><span class="token variable">@'localhost'</span> identified <span class="token keyword">by</span> <span class="token string">'å¯†ç '</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Mysql8.0é»˜è®¤é‡‡ç”¨caching-sha2-passwordåŠ å¯†ï¼Œç›®å‰å¥½å¤šå®¢æˆ·ç«¯ä¸æ”¯æŒï¼Œå¯æ”¹ä¸ºmysql_native_password;</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">create user 'test'@'%' identified with mysql_native_password BY 'å¯†ç ';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä¸­localhostæŒ‡æœ¬åœ°æ‰å¯è¿æ¥</p><p>å¯ä»¥å°†å…¶æ¢æˆ%æŒ‡ä»»æ„ipéƒ½èƒ½è¿æ¥</p><p>ä¹Ÿå¯ä»¥æŒ‡å®šipè¿æ¥</p><ul><li>æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯:</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select host, user, authentication_string, plugin from user;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h2><pre class="line-numbers language-pgsql" data-language="pgsql"><code class="language-pgsql">Alter user 'test1'@'localhost' identified by 'æ–°å¯†ç ';ALTER user 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';flush privileges;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">grant all privileges on *.* to 'test1'@'localhost' with grant option;GRANT select,update,insert,create on *.* TO 'xxh'@'%' WITH GRANT OPTION;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>with gran optionè¡¨ç¤ºè¯¥ç”¨æˆ·å¯ç»™å…¶å®ƒç”¨æˆ·èµ‹äºˆæƒé™ï¼Œä½†ä¸å¯èƒ½è¶…è¿‡è¯¥ç”¨æˆ·å·²æœ‰çš„æƒé™</p><p>æ¯”å¦‚aç”¨æˆ·æœ‰select,insertæƒé™ï¼Œä¹Ÿå¯ç»™å…¶å®ƒç”¨æˆ·èµ‹æƒï¼Œä½†å®ƒä¸å¯èƒ½ç»™å…¶å®ƒç”¨æˆ·èµ‹deleteæƒé™ï¼Œé™¤äº†select,insertä»¥å¤–çš„éƒ½ä¸èƒ½</p><p>è¿™å¥è¯å¯åŠ å¯ä¸åŠ ï¼Œè§†æƒ…å†µè€Œå®šã€‚</p><p>all privileges å¯æ¢æˆselect,update,insert,delete,drop,createç­‰æ“ä½œ å¦‚ï¼šgrant select,insert,update,delete on <em>.</em> to â€˜test1â€™@â€™localhostâ€™;</p><p>ç¬¬ä¸€ä¸ª*è¡¨ç¤ºé€šé…æ•°æ®åº“ï¼Œå¯æŒ‡å®šæ–°å»ºç”¨æˆ·åªå¯æ“ä½œçš„æ•°æ®åº“</p><p>å¦‚ï¼šgrant all privileges on æ•°æ®åº“.* to â€˜test1â€™@â€™localhostâ€™;</p><p>ç¬¬äºŒä¸ª*è¡¨ç¤ºé€šé…è¡¨ï¼Œå¯æŒ‡å®šæ–°å»ºç”¨æˆ·åªå¯æ“ä½œçš„æ•°æ®åº“ä¸‹çš„æŸä¸ªè¡¨</p><p>å¦‚ï¼šgrant all privileges on æ•°æ®åº“.æŒ‡å®šè¡¨å to â€˜test1â€™@â€™localhostâ€™;</p><h2 id="åˆ·æ–°æƒé™"><a href="#åˆ·æ–°æƒé™" class="headerlink" title="åˆ·æ–°æƒé™"></a>åˆ·æ–°æƒé™</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">flush <span class="token keyword">privileges</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æŸ¥çœ‹ç”¨æˆ·æˆæƒä¿¡æ¯"><a href="#æŸ¥çœ‹ç”¨æˆ·æˆæƒä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç”¨æˆ·æˆæƒä¿¡æ¯"></a>æŸ¥çœ‹ç”¨æˆ·æˆæƒä¿¡æ¯</h2><pre class="line-numbers language-ada" data-language="ada"><code class="language-ada"><span class="token variable">show</span> <span class="token variable">grants</span> <span class="token keyword">for</span> '<span class="token variable">test1</span><span class="token char">'@'</span><span class="token variable">localhost</span>'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ’¤é”€æƒé™"><a href="#æ’¤é”€æƒé™" class="headerlink" title="æ’¤é”€æƒé™"></a>æ’¤é”€æƒé™</h2><pre class="line-numbers language-pgsql" data-language="pgsql"><code class="language-pgsql">revoke all privileges on *.* from 'test1'@'localhost';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”¨æˆ·æœ‰ä»€ä¹ˆæƒé™å°±æ’¤ä»€ä¹ˆæƒé™</p><h2 id="åˆ é™¤ç”¨æˆ·"><a href="#åˆ é™¤ç”¨æˆ·" class="headerlink" title="åˆ é™¤ç”¨æˆ·"></a>åˆ é™¤ç”¨æˆ·</h2><pre class="line-numbers language-n1ql" data-language="n1ql"><code class="language-n1ql"><span class="token keyword">drop</span> <span class="token keyword">user</span> <span class="token string">'test1'</span>@<span class="token string">'localhost'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-æ­å»ºé›†ç¾¤"><a href="#3-æ­å»ºé›†ç¾¤" class="headerlink" title="3. æ­å»ºé›†ç¾¤"></a>3. æ­å»ºé›†ç¾¤</h2><p><a href="https://blog.csdn.net/richie696/article/details/114261284?utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link">(3æ¡æ¶ˆæ¯) MySQL8.0é«˜çº§åº”ç”¨â€”â€”â€”é›†ç¾¤æ¨¡å¼é…ç½®ï¼ˆä¸»ä»ã€åŒä¸»ã€MHAé«˜å¯ç”¨æ¨¡å¼é…ç½®ï¼‰_richie696çš„ä¸“æ -CSDNåšå®¢</a></p><p>å‚è€ƒè¿™ä¸ªåšå®¢ã€‚</p><p>æ³¨æ„ ä¸»ä»æ¯ä¸ªæœºå­çš„server-id å¿…é¡»ä¸ä¸€æ ·</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">change master to master_host='172.16.6.94',master_port=3306,master_user='xxh',master_password='',master_log_file='mysql-bin.000003',master_log_pos=156;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mybatis-plus</title>
      <link href="2021/06/07/mybatis-plus/"/>
      <url>2021/06/07/mybatis-plus/</url>
      
        <content type="html"><![CDATA[<h2 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1. ä»‹ç»"></a>1. ä»‹ç»</h2><p>å®˜æ–¹åœ°å€ï¼š<a href="https://baomidou.com/">MyBatis-Plus (baomidou.com)</a></p><h2 id="2-ä¾èµ–"><a href="#2-ä¾èµ–" class="headerlink" title="2. ä¾èµ–"></a>2. ä¾èµ–</h2><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-æ³¨è§£"><a href="#3-æ³¨è§£" class="headerlink" title="3.æ³¨è§£"></a>3.æ³¨è§£</h2><h3 id="3-1-TableId"><a href="#3-1-TableId" class="headerlink" title="3.1 @TableId"></a>3.1 @TableId</h3><p>è®¾ç½®ä¸»é”®æ˜ å°„ã€‚valueè®¾ç½®æ˜ å°„ã€‚</p><p>type è®¾ç½®ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ã€‚</p><table><thead><tr><th>å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>AUTO</td><td>æ•°æ®åº“è‡ªå¢</td></tr><tr><td>NONE</td><td>MP setä¸»é”®ï¼Œé›ªèŠ±ç®—æ³•å®ç°</td></tr><tr><td>INPUT</td><td>éœ€è¦å¼€å‘è€…æ‰‹åŠ¨èµ‹å€¼</td></tr><tr><td>ASSIGN_ID</td><td>MPåˆ†é…IDï¼ŒLongã€Integerã€String</td></tr><tr><td>ASSIGN_UUID</td><td>åˆ†é…UUIDï¼ŒString</td></tr></tbody></table><p>INPUT å¦‚æœå¼€å‘è€…æ‰‹åŠ¨æ²¡æœ‰èµ‹å€¼ï¼Œåˆ™æ•°æ®åº“é€šè¿‡è‡ªå¢çš„æ–¹å¼ç»™ä¸»é”®èµ‹å€¼ï¼Œå¦‚æœå¼€å‘è€…æ‰‹åŠ¨èµ‹å€¼ï¼Œåˆ™å­˜å…¥è¯¥å€¼ã€‚</p><p>AUTOé»˜è®¤å°±æ˜¯æ•°æ®åº“è‡ªå¢ï¼Œå¼€å‘è€…æ— éœ€èµ‹å€¼ã€‚</p><p>ASSIGN_ID MP è‡ªåŠ¨èµ‹å€¼ï¼Œé›ªèŠ±ç®—æ³•ã€‚</p><p>ASSIGN_UUID ä¸»é”®çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯Stringï¼Œè‡ªåŠ¨ç”ŸæˆUUIDè¿›è¡Œèµ‹å€¼ã€‚</p><h3 id="3-2-TableField"><a href="#3-2-TableField" class="headerlink" title="3.2 @TableField"></a>3.2 @TableField</h3><p>è®¾ç½®ç±»ä¸­å±æ€§ä¸è¡¨ä¸­åå­—æ˜ å°„ã€‚</p><ul><li>exist</li></ul><p>æ˜¯å¦ä¸ºæ•°æ®åº“å­—æ®µã€‚falseï¼Œå‘Šè¯‰mybatisplusæŸ¥çš„æ—¶å€™ä¸è¦æŠŠè¿™ä¸ªå­—æ®µå¸¦ä¸Šã€‚</p><ul><li>fill</li></ul><p>è¡¨ç¤ºæ˜¯å¦è‡ªåŠ¨å¡«å……ï¼Œå°†å¯¹è±¡å­˜å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œç”±MyBatis Plusè‡ªåŠ¨ç»™æŸäº›å­—æ®µèµ‹å€¼ï¼Œcreate_timeã€update_timeã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMetaObjectHandler</span> <span class="token keyword">implements</span> <span class="token class-name">MetaObjectHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"crateTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-TableName"><a href="#3-3-TableName" class="headerlink" title="3.3 @TableName"></a>3.3 @TableName</h3><p>è®¾ç½®ç±»åå­—ä¸è¡¨ä¸­åå­—æ˜ å°„</p><h3 id="3-4-Version"><a href="#3-4-Version" class="headerlink" title="3.4 @Version"></a>3.4 @Version</h3><p>æ ‡è®°<strong>ä¹è§‚é”</strong>ï¼Œé€šè¿‡versionå­—æ®µæ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œå½“ä¿®æ”¹æ•°æ®çš„æ—¶å€™ä¼šä»¥versionä½œä¸ºæ¡ä»¶ï¼Œå½“æ¡ä»¶æˆç«‹çš„æ—¶å€™ï¼Œæ‰ä¼šä¿®æ”¹æˆåŠŸã€‚</p><p>version=1ã€‚ è¿™æ ·å½“å¤šä¸ªçº¿ç¨‹ä¿®æ”¹çš„æ—¶å€™ä¿è¯ä¿®æ”¹çš„æˆåŠŸã€‚(ä¸»è¦æ˜¯ä¿®æ”¹æ“ä½œ)</p><p>çº¿ç¨‹1ï¼šupdate â€¦ set version = 2 where version = 1</p><p>çº¿ç¨‹2ï¼šupdate â€¦ set version = 2 where version = 1</p><p>1ã€æ•°æ®åº“è¡¨æ·»åŠ versionå­—æ®µï¼Œé»˜è®¤ä¸º1ã€‚</p><p>2ã€å®ä½“ç±»æ·»åŠ versionæˆå‘˜å˜é‡ï¼Œå¹¶ä¸”æ·»åŠ @Versionæ³¨è§£</p><p>3ã€æ·»åŠ é…ç½®ç±»ï¼ŒVersionå­—æ®µä¼šè‡ªåŠ¨æ‰¾è¿™ä¸ªé…ç½®ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisPlusConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">OptimisticLockerIntegerceptor</span> <span class="token function">optimisticLockerIntegerceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OptimisticLockerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-5-EnumValue"><a href="#3-5-EnumValue" class="headerlink" title="3.5 @EnumValue"></a>3.5 @EnumValue</h3><ol><li>æ·»åŠ é…ç½®æ–‡ä»¶ä¸­ä¿¡æ¯</li></ol><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span><span class="token key atrule">type-enums-package</span><span class="token punctuation">:</span>com.southwind.mybatisplus.enums//è‡ªå·±çš„ç±»å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æ·»åŠ æ³¨è§£ç±»</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">StatusEnum</span> <span class="token punctuation">{</span>    <span class="token function">WORK</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"ä¸Šç­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REST</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ä¼‘æ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StatusEnum</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token annotation punctuation">@EnumValue</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥å°†æ•°æ®åº“ä¸­çš„1æ˜ å°„æˆä¸Šç­ï¼Œ0ä¼‘æ¯ã€‚</p><p>ç¬¬äºŒç§å®ç°æ–¹å¼ï¼š</p><p>å®ç°æ¥å£IEnun</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">AgeEnum</span> <span class="token keyword">implements</span> <span class="token class-name">IEnum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token function">ONE</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"ä¸€å²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">TWO</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"ä¸¤å²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">THREE</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"ä¸‰å²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> msg<span class="token punctuation">;</span>    <span class="token class-name">AgeEnum</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-6-TableLogic"><a href="#3-6-TableLogic" class="headerlink" title="3.6 TableLogic"></a>3.6 TableLogic</h3><ol><li>å®ä½“ç±»ä¸­æ·»åŠ æ˜ å°„é€»è¾‘åˆ é™¤ã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableLogic</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> deleted<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>2ã€é…ç½®æ–‡ä»¶ä¸­</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span><span class="token key atrule">global-config</span><span class="token punctuation">:</span><span class="token key atrule">db-donfig</span><span class="token punctuation">:</span><span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token key atrule">logic-delete-value</span> <span class="token punctuation">:</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-CRUD"><a href="#4-CRUD" class="headerlink" title="4. CRUD"></a>4. CRUD</h2><h3 id="4-1-æŸ¥è¯¢"><a href="#4-1-æŸ¥è¯¢" class="headerlink" title="4.1 æŸ¥è¯¢"></a>4.1 æŸ¥è¯¢</h3><h2 id="5-è‡ªåŠ¨ç”Ÿæˆ"><a href="#5-è‡ªåŠ¨ç”Ÿæˆ" class="headerlink" title="5. è‡ªåŠ¨ç”Ÿæˆ"></a>5. è‡ªåŠ¨ç”Ÿæˆ</h2><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p>è‡ªåŠ¨ç”Ÿæˆå™¨çš„åŒ…å’Œvelocityéƒ½éœ€è¦ï¼Œå› ä¸ºè‡ªåŠ¨ç”Ÿæˆå™¨æ ¹æ®velocityæ¨¡æ¿å¯¼å…¥çš„ã€‚</p></li><li><p>å¯åŠ¨ç±»</p></li></ol><h2 id="6-è‡ªå®šä¹‰SQLã€å¤šè¡¨å…³è”"><a href="#6-è‡ªå®šä¹‰SQLã€å¤šè¡¨å…³è”" class="headerlink" title="6. è‡ªå®šä¹‰SQLã€å¤šè¡¨å…³è”"></a>6. è‡ªå®šä¹‰SQLã€å¤šè¡¨å…³è”</h2><h3 id="7-SpringBoot-Mybatis-Plus-æ‰“åŒ…ç›´æ¥å‘å¸ƒ"><a href="#7-SpringBoot-Mybatis-Plus-æ‰“åŒ…ç›´æ¥å‘å¸ƒ" class="headerlink" title="7. SpringBoot + Mybatis Plus æ‰“åŒ…ç›´æ¥å‘å¸ƒ"></a>7. SpringBoot + Mybatis Plus æ‰“åŒ…ç›´æ¥å‘å¸ƒ</h3>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> mybatis plus </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/05/24/mybatis/"/>
      <url>2021/05/24/mybatis/</url>
      
        <content type="html"><![CDATA[<h1 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h1><h2 id="1-é…ç½®maven"><a href="#1-é…ç½®maven" class="headerlink" title="1. é…ç½®maven"></a>1. é…ç½®maven</h2><h3 id="1-1-ä¸‹è½½åœ°å€"><a href="#1-1-ä¸‹è½½åœ°å€" class="headerlink" title="1.1 ä¸‹è½½åœ°å€"></a>1.1 ä¸‹è½½åœ°å€</h3><p><a href="http://maven.apache.org/download.html">maven å®˜ç½‘ä¸‹è½½åœ°å€</a></p><p>å‚è€ƒç¯å¢ƒé…ç½® </p><p><a href="https://www.cnblogs.com/telwanggs/p/10820701.html">https://www.cnblogs.com/telwanggs/p/10820701.html</a></p><p>mybatis ä¸­æ–‡æ–‡æ¡£ <a href="https://mybatis.org/mybatis-3/zh/configuration.html">https://mybatis.org/mybatis-3/zh/configuration.html</a></p><h3 id="1-2-ç¼–å†™mybatisé…ç½®æ–‡ä»¶"><a href="#1-2-ç¼–å†™mybatisé…ç½®æ–‡ä»¶" class="headerlink" title="1.2 ç¼–å†™mybatisé…ç½®æ–‡ä»¶"></a>1.2 ç¼–å†™mybatisé…ç½®æ–‡ä»¶</h3><p>XMLé…ç½®æ–‡ä»¶<code>configuration XML</code>ä¸­åŒ…å«äº†å¯¹MyBatisç³»ç»Ÿçš„æ ¸å¿ƒè®¾ç½®ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>  <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>  <span class="token string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${driver}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${url}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${username}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${password}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org/mybatis/example/BlogMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-ç¼–å†™ä»£ç "><a href="#1-3-ç¼–å†™ä»£ç " class="headerlink" title="1.3 ç¼–å†™ä»£ç "></a>1.3 ç¼–å†™ä»£ç </h3><ul><li>å®ä½“ç±»</li><li>Daoæ¥å£</li><li>æ¥å£å®ç°ç±»</li></ul><p>æ¥å£å®ç°ç”±åŸæ¥çš„<code>UserDaoImpl</code>è½¬æ¢ä¸º<code>Mapper</code>é…ç½®æ–‡ä»¶ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.dao.UserDao<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserList<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.User <span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select * from mybatis.user    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-4-æµ‹è¯•"><a href="#1-4-æµ‹è¯•" class="headerlink" title="1.4 æµ‹è¯•"></a>1.4 æµ‹è¯•</h3><ul><li>junitæµ‹è¯•</li></ul><p>æ³¨æ„ç‚¹ï¼šæŠ¥é”™</p><p>org.apache.ibatis.binding.BindingException: Type interface com.kuang.dao.UserDao is not known to the MapperRegistry.</p><h3 id="1-5-çŸ¥è¯†ç‚¹"><a href="#1-5-çŸ¥è¯†ç‚¹" class="headerlink" title="1.5 çŸ¥è¯†ç‚¹"></a>1.5 çŸ¥è¯†ç‚¹</h3><ol><li><p>ä»SqlSessionFactoryä¸­è·å–SqlSessionã€‚</p></li><li><p>å‘½åç©ºé—´è¦å†™ï¼Œç»‘å®šæ¥å£ã€‚å†™å®Œå…¨é™å®šåã€‚</p></li><li><p><font color="red">SqlSessionFactoryBuilder</font></p><p>è¿™ä¸ªç±»å¯ä»¥è¢«å®ä¾‹åŒ–ã€ä½¿ç”¨å’Œä¸¢å¼ƒï¼Œä¸€æ—¦åˆ›å»ºSqlSessionFactoryå°±ä¸å†éœ€è¦ä»–äº†ã€‚å› æ­¤å®ƒå®ä¾‹çš„æœ€ä½³ä½œç”¨æ˜¯æ–¹æ³•ä½œç”¨åŸŸã€‚</p></li><li><p>SqlSessionFactory</p><ul><li>å¯ä»¥æƒ³è±¡ä¸ºæ•°æ®åº“è¿æ¥æ± ã€‚</li></ul><p>SqlSessionFactoryä¸€æ—¦åˆ›å»ºå°±åº”è¯¥åœ¨è¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ã€‚é»˜è®¤å•ä¾‹æ¨¡å¼æˆ–é™æ€å•ä¾‹æ¨¡å¼ã€‚ï¼ˆé€‚åˆå…¨å±€ï¼‰ã€‚</p></li><li><p>SqlSession</p><p>SqlSesionä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸èƒ½è¢«å…±äº«ã€‚æ¯æ¬¡æ”¶åˆ°çš„HTTPè¯·æ±‚ï¼Œå°±å¯ä»¥æ‰“å¼€ä¸€ä¸ªSqlSessionï¼Œè¿”å›ä¸€ä¸ªç›¸åº”å°±åº”è¯¥å…³é—­å®ƒã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    ä½ çš„åº”ç”¨é€»è¾‘ä»£ç <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><p>![](D:\1\å¥‡æŠ€æ·«å·§\photoDonâ€™t delete\Spring\mybatisFactory.PNG)</p><h2 id="2-CRUD"><a href="#2-CRUD" class="headerlink" title="2.CRUD"></a>2.CRUD</h2><h3 id="1ã€-namespace"><a href="#1ã€-namespace" class="headerlink" title="1ã€ namespace"></a>1ã€ namespace</h3><p>namespaceä¸­çš„åŒ…åè¦å’ŒDao/mapperæ¥å£ä¸­çš„ä¸€è‡´ã€‚</p><h3 id="2ã€select"><a href="#2ã€select" class="headerlink" title="2ã€select"></a>2ã€select</h3><p>é€‰æ‹©ï¼ŒæŸ¥è¯¢è¯­å¥</p><ul><li>id:å¯¹åº”çš„namespaceä¸­çš„æ–¹æ³•ã€‚</li><li>returnType:Sqlè¯­å¥æ‰§è¡Œçš„è¿”å›å€¼ï¼</li><li>parameterTypeï¼šå‚æ•°ç±»å‹</li></ul><h2 id="3-Map"><a href="#3-Map" class="headerlink" title="3. Map"></a>3. Map</h2><p>ä¸éœ€è¦çŸ¥é“æ•°æ®åº“ä¸­æœ‰ä»€ä¹ˆï¼Œåªéœ€è¦æŸ¥å¯¹åº”çš„å­—æ®µã€‚</p><p>æ•°æ®åº“ä¸­è¡¨æˆ–è€…å­—æ®µå‚æ•°è¿‡å¤šï¼Œåº”å½“è€ƒè™‘ä½¿ç”¨Mapã€‚</p><h2 id="4-é…ç½®è§£æ"><a href="#4-é…ç½®è§£æ" class="headerlink" title="4.é…ç½®è§£æ"></a>4.é…ç½®è§£æ</h2><h4 id="4-1-æ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#4-1-æ ¸å¿ƒé…ç½®æ–‡ä»¶" class="headerlink" title="4.1 æ ¸å¿ƒé…ç½®æ–‡ä»¶"></a>4.1 æ ¸å¿ƒé…ç½®æ–‡ä»¶</h4><p>  configurationï¼ˆé…ç½®ï¼‰</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">propertiesï¼ˆå±æ€§ï¼‰settingsï¼ˆè®¾ç½®ï¼‰typeAliasesï¼ˆç±»å‹åˆ«åï¼‰typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰objectFactoryï¼ˆå¯¹è±¡å·¥å‚ï¼‰pluginsï¼ˆæ’ä»¶ï¼‰environmentsï¼ˆç¯å¢ƒé…ç½®ï¼‰environmentï¼ˆç¯å¢ƒå˜é‡ï¼‰transactionManagerï¼ˆäº‹åŠ¡ç®¡ç†å™¨ï¼‰dataSourceï¼ˆæ•°æ®æºï¼‰databaseIdProviderï¼ˆæ•°æ®åº“å‚å•†æ ‡è¯†ï¼‰mappersï¼ˆæ˜ å°„å™¨ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-2-ç¯å¢ƒé…ç½®"><a href="#4-2-ç¯å¢ƒé…ç½®" class="headerlink" title="4.2 ç¯å¢ƒé…ç½®"></a>4.2 ç¯å¢ƒé…ç½®</h4><p>Mybatis äº‹åŠ¡ç®¡ç†å™¨æœ‰ä¸¤ç§ï¼šJDBCå’ŒMANAGEDã€‚é»˜è®¤JDBCã€‚</p><p>datasource è¿æ¥æ•°æ®åº“ã€‚å†…ç½®ä¸‰ç§æ•°æ®æºç±»å‹ type = UNPOOLED | POOLED| JNDIã€‚é»˜è®¤è¿æ¥æ± POOLEDã€‚</p><p>å­¦ä¼šä½¿ç”¨é…ç½®å¤šå¥—è¿è¡Œç¯å¢ƒã€‚</p><p>æ± å­çš„è§£é‡Šï¼šç”¨å®Œå¯ä»¥å›æ”¶ã€‚</p><h4 id="4-3-å±æ€§"><a href="#4-3-å±æ€§" class="headerlink" title="4.3 å±æ€§"></a>4.3 å±æ€§</h4><p>å¯ä»¥é€šè¿‡propertiesæ¥æä¾›å¤šç§å®ç°æ–¹å¼ã€‚</p><p>å±æ€§éƒ½æ˜¯å¯å¤–éƒ¨åŠ¨æ€æ›¿æ¢çš„ï¼Œå¯åœ¨å…¸å‹çš„Javaå±æ€§æ–‡ä»¶ä¸­é…ç½®ï¼Œäº¦å¯é€šè¿‡propertieså…ƒç´ çš„å­å…ƒç´ æ¥æ”¹é€ ã€‚</p><h4 id="4-4-åˆ«å"><a href="#4-4-åˆ«å" class="headerlink" title="4.4 åˆ«å"></a>4.4 åˆ«å</h4><ul><li>ç±»å‹åˆ«åæ˜¯ä¸ºJavaç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åå­—ã€‚</li><li>å­˜åœ¨çš„æ„ä¹‰ç”¨æ¥å‡å°‘ç±»å®Œå…¨é™å®šåçš„å†—ä½™ã€‚</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.User<span class="token punctuation">"</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ‰«æå®ä½“ç±»çš„åŒ…ï¼Œå®ƒçš„é»˜è®¤åˆ«åå°±ä¸ºè¿™ä¸ªç±»çš„ ç±»åï¼Œé¦–å­—æ¯å°å†™ï¼</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åœ¨å®ä½“ç±»æ¯”è¾ƒå°‘çš„æ—¶å€™ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼Œå¦‚æœå®ä½“ç±»æ¯”è¾ƒå¤šï¼Œä½¿ç”¨ç¬¬äºŒç§ã€‚ç¬¬ä¸€ç§å¯ä»¥DIYï¼Œ ç¬¬äºŒç§åˆ™ä¸è¡Œã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Alias</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-5-Mappers-æ˜ å°„"><a href="#4-5-Mappers-æ˜ å°„" class="headerlink" title="4.5 Mappers æ˜ å°„"></a>4.5 Mappers æ˜ å°„</h4><p>MapperRegistryï¼šæ³¨å†Œç»‘å®šmappersæ–‡ä»¶ã€‚</p><p>ç¬¬ä¸€ç§æ–¹å¼ã€‚mapperæ–‡ä»¶å¯ä»¥éšä¾¿æ”¾ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com/kuang/dao/UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒç§æ–¹å¼ã€‚ç±»çš„æ–¹å¼ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.dao.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ¥å£å’ŒMapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ã€‚</li><li>æ¥å£å’ŒMapperé…ç½®æ–‡ä»¶å¿…é¡»åŒåã€‚</li></ul><p>ç¬¬ä¸‰ç§æ–¹å¼ã€‚packageæ–¹å¼</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.dao<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„æ–¹å¼ï¼š</p><ul><li>æ¥å£å’ŒMapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ã€‚</li><li>æ¥å£å’ŒMapperé…ç½®æ–‡ä»¶å¿…é¡»åŒåã€‚</li></ul><h2 id="5-è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜"><a href="#5-è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜" class="headerlink" title="5. è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜"></a>5. è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜</h2><h3 id="5-1-ç»“æœé›†æ˜ å°„"><a href="#5-1-ç»“æœé›†æ˜ å°„" class="headerlink" title="5.1 ç»“æœé›†æ˜ å°„"></a>5.1 ç»“æœé›†æ˜ å°„</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">id name pwdid name password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--        column æ•°æ®åº“ä¸­çš„å­—æ®µ property å®ä½“ç±»å±æ€§--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pwd<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserMap<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select * from mybatis.user1 where id=#{id};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-æ—¥å¿—"><a href="#6-æ—¥å¿—" class="headerlink" title="6.æ—¥å¿—"></a>6.æ—¥å¿—</h2><p>å¦‚æœä¸€ä¸ªæ•°æ®åº“æ“ä½œå‡ºç°äº†å¼‚å¸¸ï¼Œéœ€è¦æ’é”™ã€‚æ—¥å¿—å°±æ˜¯æœ€å¥½çš„åŠ©æ‰‹ã€‚</p><p>æ›¾ç»ï¼šsoutã€debug</p><p>ç°åœ¨ï¼šæ—¥å¿—å·¥å‚ï¼</p><p>logImpl æŒ‡å®šMybatisæ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ã€‚</p><table><thead><tr><th>logImpl</th><th>æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚</th><th>SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</th><th>æœªè®¾ç½®</th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td></tr></tbody></table><p>å…·ä½“ä½¿ç”¨å“ªä¸€ä¸ªæ—¥å¿—å®ç°ï¼Œé»˜è®¤æœªè®¾ç½®æ—¥å¿—å·¥å‚ã€‚</p><p>æ ‡å‡†æ˜¯STDOUT_LOGGING</p><h3 id="6-1-Log4j"><a href="#6-1-Log4j" class="headerlink" title="6.1 Log4j"></a>6.1 Log4j</h3><p>å…ˆå¯¼å…¥Log4jçš„åŒ…ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥é…ç½®</li></ul><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#å°†ç­‰çº§ä¸ºDEBUGçš„æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°consoleå’Œfileè¿™ä¸¤ä¸ªç›®çš„åœ°ï¼Œconsoleå’Œfileçš„å®šä¹‰åœ¨ä¸‹é¢çš„ä»£ç </span><span class="token attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG,console,file</span><span class="token comment">#æ§åˆ¶å°è¾“å‡ºçš„ç›¸å…³é…ç½®</span><span class="token attr-name">log4j.appender.console</span> <span class="token punctuation">=</span> <span class="token attr-value">org.apache.log4j.ConsoleAppender</span><span class="token attr-name">log4j.appender.console.Target</span> <span class="token punctuation">=</span> <span class="token attr-value">System.out</span><span class="token attr-name">log4j.appender.console.Threshold</span> <span class="token punctuation">=</span> <span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.appender.console.layout</span> <span class="token punctuation">=</span> <span class="token attr-value">org.apache.log4j.PatternLayout</span><span class="token attr-name">log4j.appender.console.layout.ConversionPattern</span> <span class="token punctuation">=</span> <span class="token attr-value">[%c]-%m%n</span><span class="token comment"># å°†æ–‡ä»¶è¾“å‡ºçš„ç›¸å…³é…ç½®</span><span class="token attr-name">log4j.appender.file</span> <span class="token punctuation">=</span> <span class="token attr-value">org.apache.log4j.RollingFileAppender</span><span class="token attr-name">log4j.appender.file.File</span> <span class="token punctuation">=</span> <span class="token attr-value">./log/kuang.log</span><span class="token attr-name">log4j.appender.file.MaxFileSize</span><span class="token punctuation">=</span><span class="token attr-value">10mb</span><span class="token attr-name">log4j.appender.file.Threshold</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.appender.file.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span><span class="token attr-name">log4j.appender.file.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">[%p][%d{yy-MM-dd}][%c]%m%n</span><span class="token comment"># æ—¥å¿—è¾“å‡ºçº§åˆ«</span><span class="token attr-name">log4j.logger.org.mybatis</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.logger.java.sql</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.logger.java.sql.Statement</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.logger.java.sql.ResultSet</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.logger.java.sql.PreparedStatement</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>é…ç½®log4jä¸ºæ—¥å¿—çš„å®ç°</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Log4j<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>ä½¿ç”¨</p></li></ul><ol><li>åœ¨è¦ä½¿ç”¨Log4jçš„ç±»ä¸­å¯¼å…¥åŒ…ã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>æ—¥å¿—å¯¹è±¡åŠ è½½å‚æ•°ä¸ºå½“å‰ç±»çš„classã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">UserDaoTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>æ—¥å¿—çº§åˆ«</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java">logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="7-åˆ†é¡µ"><a href="#7-åˆ†é¡µ" class="headerlink" title="7.åˆ†é¡µ"></a>7.åˆ†é¡µ</h2><p>å¸¸è§çš„å°±æ˜¯ä½¿ç”¨mysqlé‡Œé¢çš„limitå…³é”®å­—.æ¯”å¦‚ï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM limit 0,2;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨mybatiså®ç°åˆ†é¡µï¼š</p><ol><li>æ¥å£</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//åˆ†é¡µ</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserByLimit</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>Mapper.XML</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByLimit<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select * from mybatis.user1 limit #{startIndex},${pageSize};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æµ‹è¯•</li></ol><h3 id="7-2-RowBounds"><a href="#7-2-RowBounds" class="headerlink" title="7.2 RowBounds"></a>7.2 RowBounds</h3><p>ä¸å†ä½¿ç”¨SQLå®ç°åˆ†é¡µã€‚</p><ol><li>æ¥å£</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserByRowBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>mapper.xml</li></ol><pre class="line-numbers language-none"><code class="language-none">&lt;select id="getUserByRowBounds" resultMap="UserMap"&gt;    select * from mybatis.user1;&lt;/select&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol><li>æµ‹è¯•</li></ol><h3 id="7-3-åˆ†é¡µæ’ä»¶"><a href="#7-3-åˆ†é¡µæ’ä»¶" class="headerlink" title="7.3 åˆ†é¡µæ’ä»¶"></a>7.3 åˆ†é¡µæ’ä»¶</h3><p>PageHelper</p><h2 id="8-ä½¿ç”¨æ³¨è§£å¼€å‘"><a href="#8-ä½¿ç”¨æ³¨è§£å¼€å‘" class="headerlink" title="8.ä½¿ç”¨æ³¨è§£å¼€å‘"></a>8.ä½¿ç”¨æ³¨è§£å¼€å‘</h2><h3 id="8-1-é¢å‘æ¥å£ç¼–ç¨‹"><a href="#8-1-é¢å‘æ¥å£ç¼–ç¨‹" class="headerlink" title="8.1 é¢å‘æ¥å£ç¼–ç¨‹"></a>8.1 é¢å‘æ¥å£ç¼–ç¨‹</h3><ul><li><p>å®šä¹‰ï¼ˆçº¦æŸä¸è§„èŒƒï¼‰ä¸å®ç°çš„åˆ†ç¦»</p></li><li><p>æœ‰ä¸€äº›mapperä¸ç”¨xmlé…ç½®ï¼Œç›´æ¥ä½¿ç”¨æ³¨è§£ã€‚</p></li></ul><ol><li>æ³¨è§£åœ¨æ¥å£ä¸Šå®ç°</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user1"</span><span class="token punctuation">)</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ç»‘å®šæ¥å£</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--        &lt;mapper resource="com/kuang/dao/UserMapper.xml"/&gt;--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.dao.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--        &lt;package name="com.kuang.dao"/&gt;--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>æµ‹è¯•</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-2-CURD"><a href="#8-2-CURD" class="headerlink" title="8.2 CURD"></a>8.2 CURD</h3><ul><li>å¯ä»¥åœ¨å·¥å…·ç±»åˆ›å»ºçš„æ—¶å€™å®ç°è‡ªåŠ¨æäº¤äº‹åŠ¡ã€‚</li><li>@Paramï¼ˆâ€nameâ€ï¼‰ã€‚SQLå¼•ç”¨çš„å°±æ˜¯è¿™ä¸ªèµ·çš„åå­—</li></ul><h2 id="9-Mybatisæ‰§è¡Œæµç¨‹"><a href="#9-Mybatisæ‰§è¡Œæµç¨‹" class="headerlink" title="9. Mybatisæ‰§è¡Œæµç¨‹"></a>9. Mybatisæ‰§è¡Œæµç¨‹</h2><h2 id="10-Lombok"><a href="#10-Lombok" class="headerlink" title="10. Lombok"></a>10. Lombok</h2><p>é€šè¿‡æ³¨è§£æ¶ˆé™¤å†—ä½™ä»£ç </p><p>ç¼ºç‚¹ï¼š1ã€ä¸æ”¯æŒå¤šç§å‚æ•°æ„é€ å™¨çš„é‡è½½ 2ã€é™ä½äº†æºä»£ç çš„å¯è¯»æ€§å’Œå®Œæ•´æ€§</p><ol><li>å®‰è£…æ’ä»¶</li><li>å¯¼å…¥lombokåŒ…(pom.xmlä¸­é…ç½®)</li><li>å®ä½“ç±»åŠ æ³¨è§£</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token operator">:</span>æ— å‚æ„é€ ã€getã€setã€tostringã€hashcodeã€equals<span class="token annotation punctuation">@ALLArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token annotation punctuation">@ToString</span><span class="token annotation punctuation">@Getter</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="11-å¤šå¯¹ä¸€"><a href="#11-å¤šå¯¹ä¸€" class="headerlink" title="11.å¤šå¯¹ä¸€"></a>11.å¤šå¯¹ä¸€</h2><ul><li>å¤šä¸ªå­¦ç”Ÿå¯¹åº”ä¸€ä¸ªè€å¸ˆ</li></ul><h3 id="11-1æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†"><a href="#11-1æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†" class="headerlink" title="11.1æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†"></a>11.1æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.dao.StudentMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getStudent<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>StudentTeacher<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select * from student    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>StudentTeacher<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.Student<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--        å¯¹è±¡ä½¿ç”¨association--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacher<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tid<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.Teacher<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getTeacher<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getTeacher<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.Teacher<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select * from teacher where id = #{id}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="11-2-æŒ‰ç…§ç»“æœåµŒå¥—æŸ¥è¯¢"><a href="#11-2-æŒ‰ç…§ç»“æœåµŒå¥—æŸ¥è¯¢" class="headerlink" title="11.2 æŒ‰ç…§ç»“æœåµŒå¥—æŸ¥è¯¢"></a>11.2 æŒ‰ç…§ç»“æœåµŒå¥—æŸ¥è¯¢</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getStudent2<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>StudentTeacher2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select s.id sid, s.name sname, t.name tname from student s, teacher t where s.tid = t.id;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>StudentTeacher2<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.Student<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--        å¯¹è±¡ä½¿ç”¨association--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sid<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sname<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacher<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.Teacher<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tname<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="11-3-ä¸€å¯¹å¤šå¤„ç†"><a href="#11-3-ä¸€å¯¹å¤šå¤„ç†" class="headerlink" title="11.3 ä¸€å¯¹å¤šå¤„ç†"></a>11.3 ä¸€å¯¹å¤šå¤„ç†</h3><p>åŒä¸Šï¼Œå…¶å®æ˜¯ç±»ä¼¼çš„</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>javaType &amp;&amp; ofType</p><p>javaType ç”¨æ¥æŒ‡å®šå®ä½“ç±»ä¸­çš„å±æ€§çš„ç±»å‹</p><p>ofTypeç”¨æ¥æŒ‡å®šæ˜ å°„åˆ°Listæˆ–é›†åˆä¸­çš„pojoç±»å‹ï¼Œæ³›å‹ä¸­çš„çº¦æŸç±»å‹ã€‚</p><h2 id="12-åŠ¨æ€SQL"><a href="#12-åŠ¨æ€SQL" class="headerlink" title="12. åŠ¨æ€SQL"></a>12. åŠ¨æ€SQL</h2><p>åŠ¨æ€SQLæ ¹æ®ä¸åŒçš„æ¡ä»¶ç”Ÿæˆä¸åŒçš„sqlè¯­å¥ã€‚</p><ul><li>if</li></ul><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>ä½¿ç”¨åŠ¨æ€ SQL æœ€å¸¸è§æƒ…æ™¯æ˜¯æ ¹æ®æ¡ä»¶åŒ…å« where å­å¥çš„ä¸€éƒ¨åˆ†ã€‚æ¯”å¦‚ï¼š</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findActiveBlogWithTitleLike<span class="token punctuation">"</span></span>        <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    SELECT * FROM BLOG    WHERE state = â€˜ACTIVEâ€™    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        AND title like #{title}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>choose (when, otherwise)</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findActiveBlogLike<span class="token punctuation">"</span></span>     <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  SELECT * FROM BLOG WHERE state = â€˜ACTIVEâ€™  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>choose</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      AND title like #{title}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author != null and author.name != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>      AND author_name like #{author.name}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>otherwise</span><span class="token punctuation">&gt;</span></span>      AND featured = 1    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>otherwise</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>choose</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>trim (where, set)</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findActiveBlogLike<span class="token punctuation">"</span></span>     <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  SELECT * FROM BLOG  WHERE  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>state != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    state = #{state}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    AND title like #{title}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author != null and author.name != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    AND author_name like #{author.name}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼Œsetè¯­å¥åˆ«å¿˜äº†åé¢åŠ ,</p><h3 id="SQLç‰‡æ®µ"><a href="#SQLç‰‡æ®µ" class="headerlink" title="SQLç‰‡æ®µ"></a>SQLç‰‡æ®µ</h3><ol><li>ä½¿ç”¨SQLæ ‡ç­¾æŠ½å–å…¬å…±çš„éƒ¨åˆ†</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>if-title-author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        title = #{title}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        author = #{author}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨inclludeæ ‡ç­¾å¼•ç”¨å³å¯</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>queryBlogIF<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.pojo.Blog<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    select * from mybatis.blog    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>if-title-author<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>foreach</li></ul><p>æ˜¯å¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œéå†ï¼Œé€šå¸¸æ„å»ºINæ¡ä»¶è¯­å¥çš„æ—¶å€™ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectPostIn<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  SELECT *  FROM POST P  WHERE ID in  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span>      <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        #{item}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="13-ç¼“å­˜"><a href="#13-ç¼“å­˜" class="headerlink" title="13. ç¼“å­˜"></a>13. ç¼“å­˜</h2><pre class="line-numbers language-none"><code class="language-none">æŸ¥è¯¢ ï¼š è¿æ¥æ•°æ®åº“ï¼Œè€—è´¹èµ„æºï¼ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœï¼Œç»™ä»–æš‚æ—¶å­˜åœ¨ä¸€ä¸ªç›´æ¥å–åˆ°çš„åœ°æ–¹ï¼--&gt; å†…å­˜ï¼š ç¼“å­˜æˆ‘ä»¬å†æ¬¡æŸ¥è¯¢ç›¸åŒæ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥èµ°ç¼“å­˜ï¼Œå°±ä¸ç”¨èµ°æ•°æ®åº“äº†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol><li>ä»€ä¹ˆæ˜¯ç¼“å­˜ï¼Ÿ<ul><li>æ”¾åœ¨å†…å­˜ä¸­çš„ä¸´æ—¶æ•°æ®</li><li>å°†ç”¨æˆ·ç»å¸¸æŸ¥çš„æ•°æ®æ”¾åœ¨å†…å­˜ä¸­å¯ä»¥æé«˜æ€§èƒ½ã€‚</li></ul></li></ol><ul><li><p>Mybatisé»˜è®¤ä¸¤çº§ç¼“å­˜ï¼Œé»˜è®¤ä¸€çº§ç¼“å­˜ã€‚</p></li><li><p>äºŒçº§ç¼“å­˜éœ€è¦æ‰‹åŠ¨å¼€å¯é…ç½®ã€‚ä»–æ˜¯åŸºäºnamespaceçº§åˆ«çš„ç¼“å­˜ã€‚</p></li><li><p>ä¸ºäº†æé«˜æ‰©å±•æ€§ï¼ŒMyBatiså®šä¹‰äº†ç¼“å­˜æ¥å£Cacheã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Cacheæ¥å£è‡ªå®šä¹‰äºŒçº§ç¼“å­˜ã€‚</p></li></ul><h3 id="13-1-ä¸€çº§ç¼“å­˜"><a href="#13-1-ä¸€çº§ç¼“å­˜" class="headerlink" title="13.1 ä¸€çº§ç¼“å­˜"></a>13.1 ä¸€çº§ç¼“å­˜</h3><p>ä¸€çº§ç¼“å­˜ä¹Ÿå«æœ¬åœ°ä¼šè¯ç¼“å­˜ã€‚</p><ul><li>ä¸æ•°æ®åº“åŒä¸€æ¬¡ä¼šè¯æœŸé—´æŸ¥è¯¢åˆ°çš„æ•°æ®ä¼šæ”¾åœ¨æœ¬åœ°ç¼“å­˜ä¸­ã€‚</li><li>ä»¥åå¦‚æœéœ€è¦è·å–ç›¸åŒçš„æ•°æ®ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿ï¼Œæ²¡å¿…é¡»å†å»æŸ¥è¯¢æ•°æ®åº“ã€‚</li></ul><p>ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š</p><ol><li>æ‰€æœ‰å¢åˆ æ”¹éƒ½è¦ç¼“å†²å¤±æ•ˆã€‚ï¼ˆå¢åˆ æ”¹æœ‰å¯èƒ½ä¼šæ”¹å˜æ•°æ®ï¼Œæ‰€ä»¥ç¼“å­˜éœ€è¦å¤±æ•ˆï¼‰</li><li>æŸ¥è¯¢ä¸åŒçš„mapper.xml</li><li>æŸ¥è¯¢ä¸åŒçš„æ•°æ®ã€‚</li><li>æ‰‹åŠ¨æ¸…ç†ç¼“å­˜ã€‚</li></ol><p>å°ç»“ï¼šä¸€çº§ç¼“å­˜é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œåªåœ¨ä¸€æ¬¡SqlSessionä¸­æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯æ‹¿åˆ°è¿æ¥åˆ°å…³é—­è¿æ¥ã€‚</p><h3 id="13-2-äºŒçº§ç¼“å­˜"><a href="#13-2-äºŒçº§ç¼“å­˜" class="headerlink" title="13.2 äºŒçº§ç¼“å­˜"></a>13.2 äºŒçº§ç¼“å­˜</h3><ul><li>å·¥ä½œæœºåˆ¶<ul><li>ä¸€ä¸ªä¼šè¯æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šè¢«æ”¾åœ¨å½“å‰ä¼šè¯çš„ä¸€çº§ç¼“å­˜ä¸­ã€‚</li><li>å¦‚æœå½“å‰ä¼šè¯å…³é—­ï¼Œè¿™ä¸ªä¼šè¯å¯¹åº”çš„ä¸€çº§ç¼“å­˜å°±æ²¡äº†ã€‚ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›ä¼šè¯å…³é—­äº†ï¼Œä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®è¢«ä¿å­˜åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚</li><li>æ–°çš„ä¼šè¯æŸ¥è¯¢ä¿¡æ¯ï¼Œå°±å¯ä»¥ä»äºŒçº§ç¼“å­˜ä¸­è·å–å†…å®¹ã€‚</li><li>ä¸åŒçš„mapperæŸ¥å‡ºçš„æ•°æ®ä¼šæ”¾åœ¨è‡ªå·±çš„ç¼“å­˜mapä¸­ã€‚</li></ul></li></ul><ol start="2"><li>ç¼“å­˜æ¸…é™¤ç­–ç•¥</li></ol><ul><li>LRU æœ€è¿‘æœ€å°‘ä½¿ç”¨</li><li>FIFO å…ˆè¿›å…ˆå‡º</li><li>SOFT è½¯å¼•ç”¨</li><li>WEAK å¼±å¼•ç”¨ï¼Œæ›´ç§¯æåœ°åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li></ul><p>æ­¥éª¤ï¼š</p><ol><li>å¼€å¯å…¨å±€ç¼“å­˜ã€‚<code>cacheEnabled = true</code></li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cacheEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li><p>åœ¨Mapper.xmlä¸­åŠ å…¥</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h3 id="13-3-ç¼“å­˜åŸç†"><a href="#13-3-ç¼“å­˜åŸç†" class="headerlink" title="13.3 ç¼“å­˜åŸç†"></a>13.3 ç¼“å­˜åŸç†</h3><p>å†æ¬¡æŸ¥è¯¢æ—¶ä¼šå…ˆæ‰¾äºŒçº§ç¼“å­˜ï¼Œå†ä¸€çº§ï¼Œå¦‚æœä¸¤ä¸ªéƒ½æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œå†ä»æ•°æ®åº“ä¸­æ‰¾ã€‚</p><h3 id="13-4-è‡ªå®šä¹‰ç¼“å­˜ehcache"><a href="#13-4-è‡ªå®šä¹‰ç¼“å­˜ehcache" class="headerlink" title="13.4 è‡ªå®šä¹‰ç¼“å­˜ehcache"></a>13.4 è‡ªå®šä¹‰ç¼“å­˜ehcache</h3><h1 id="é¢è¯•éƒ¨åˆ†"><a href="#é¢è¯•éƒ¨åˆ†" class="headerlink" title="é¢è¯•éƒ¨åˆ†"></a>é¢è¯•éƒ¨åˆ†</h1><h2 id="1-ä¸€éƒ¨åˆ†"><a href="#1-ä¸€éƒ¨åˆ†" class="headerlink" title="1. ä¸€éƒ¨åˆ†"></a>1. ä¸€éƒ¨åˆ†</h2><h3 id="1-1-å’Œjdbcçš„åŒºåˆ«"><a href="#1-1-å’Œjdbcçš„åŒºåˆ«" class="headerlink" title="1.1 å’Œjdbcçš„åŒºåˆ«"></a>1.1 å’Œjdbcçš„åŒºåˆ«</h3><p>jdbcæ˜¯javaæä¾›çš„æ“ä½œæ•°æ®åº“çš„APIã€‚</p><p>mybatisæ¶ˆé™¤äº†å‡ ä¹æ‰€æœ‰çš„JDBCä»£ç å’Œå‚æ•°çš„æ‰‹å·¥è®¾ç½®ä»¥åŠå¯¹åº”çš„ç»“æœé›†çš„æ£€ç´¢å°è£…ã€‚</p><p>mybatisæ˜¯å¯¹JDBCçš„å°è£…ï¼Œç›¸å¯¹äºJDBCï¼ŒMybatisæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li>ä¼˜åŒ–è·å–å’Œé‡Šæ”¾</li><li>SQLç»Ÿä¸€ç®¡ç†ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œå­˜å–æ“ä½œã€‚</li><li>ç”ŸæˆåŠ¨æ€SQLè¯­å¥</li><li>èƒ½å¤Ÿå¯¹ç»“æœé›†è¿›è¡Œæ˜ å°„</li></ol><h3 id="1-2-ä¸ºä»€ä¹ˆæ˜¯åŠè‡ªåŠ¨ORMæ˜ å°„å·¥å…·ï¼Ÿ"><a href="#1-2-ä¸ºä»€ä¹ˆæ˜¯åŠè‡ªåŠ¨ORMæ˜ å°„å·¥å…·ï¼Ÿ" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆæ˜¯åŠè‡ªåŠ¨ORMæ˜ å°„å·¥å…·ï¼Ÿ"></a>1.2 ä¸ºä»€ä¹ˆæ˜¯åŠè‡ªåŠ¨ORMæ˜ å°„å·¥å…·ï¼Ÿ</h3><ul><li><p>Hibernate å±äºå…¨è‡ªåŠ¨ORMæ˜ å°„å·¥å…·ï¼Œä½¿ç”¨HibernateæŸ¥è¯¢å…³è”å¯¹è±¡æˆ–è€…å…³è”é›†åˆå¯¹è±¡æ—¶ï¼Œå¯ä»¥æ ¹æ®å¯¹è±¡å…³ç³»æ¨¡å‹ç›´æ¥è·å–ï¼Œæ‰€ä»¥å®ƒæ˜¯å…¨è‡ªåŠ¨çš„ã€‚</p></li><li><p>mybatisåœ¨æŸ¥è¯¢å…³è”å¯¹è±¡æ—¶éœ€è¦æ‰‹åŠ¨ç¼–å†™sqlæ¥å®Œæˆï¼Œæ‰€ä»¥æ˜¯åŠè‡ªåŠ¨ORMæ˜ å°„å·¥å…·ã€‚</p></li></ul><h3 id="1-3-ä¸€ä¸ªxmlæ˜ å°„æ–‡ä»¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªDaoæ¥å£ä¸ä¹‹å¯¹åº”ã€‚daoæ¥å£å·¥ä½œåŸç†ä»¥åŠdaoçš„æ–¹æ³•å‚æ•°ä¸åŒæ˜¯å¦èƒ½å¤Ÿé‡è½½ï¼Ÿ"><a href="#1-3-ä¸€ä¸ªxmlæ˜ å°„æ–‡ä»¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªDaoæ¥å£ä¸ä¹‹å¯¹åº”ã€‚daoæ¥å£å·¥ä½œåŸç†ä»¥åŠdaoçš„æ–¹æ³•å‚æ•°ä¸åŒæ˜¯å¦èƒ½å¤Ÿé‡è½½ï¼Ÿ" class="headerlink" title="1.3 ä¸€ä¸ªxmlæ˜ å°„æ–‡ä»¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªDaoæ¥å£ä¸ä¹‹å¯¹åº”ã€‚daoæ¥å£å·¥ä½œåŸç†ä»¥åŠdaoçš„æ–¹æ³•å‚æ•°ä¸åŒæ˜¯å¦èƒ½å¤Ÿé‡è½½ï¼Ÿ"></a>1.3 ä¸€ä¸ªxmlæ˜ å°„æ–‡ä»¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªDaoæ¥å£ä¸ä¹‹å¯¹åº”ã€‚daoæ¥å£å·¥ä½œåŸç†ä»¥åŠdaoçš„æ–¹æ³•å‚æ•°ä¸åŒæ˜¯å¦èƒ½å¤Ÿé‡è½½ï¼Ÿ</h3><ul><li>Daoæ¥å£ï¼Œå°±æ˜¯å¸¸è¯´çš„Mapperæ¥å£ï¼Œæ¥å£çš„å…¨é™åï¼Œå°±æ˜¯æ˜ å°„æ–‡ä»¶ä¸­çš„namespaceå€¼ï¼Œæ¥å£çš„æ–¹æ³•åï¼Œå°±æ˜¯æ˜ å°„æ–‡ä»¶ä¸­çš„MappedStatementçš„idå€¼ï¼Œæ¥å£æ–¹æ³•å†…çš„å‚æ•°å°±æ˜¯ä¼ é€’ç»™sqlçš„å‚æ•°ã€‚</li><li>Mapperæ¥å£æ˜¯æ²¡æœ‰å®ç°ç±»çš„ï¼Œå½“è°ƒç”¨æ¥å£æ–¹æ³•æ—¶ï¼Œæ¥å£å…¨é™å+æ–¹æ³•åæ‹¼è£…å­—ç¬¦ä¸²ä½œä¸ºkeyå€¼ï¼Œå¯ä»¥å”¯ä¸€å®šä½ä¸€ä¸ªMappedStatementã€‚</li></ul><p>Daoæ¥å£çš„å·¥ä½œåŸç†æ˜¯JDKåŠ¨æ€ä»£ç†ï¼Œmybatisè¿è¡Œæ—¶ä¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†ä¸ºDaoæ¥å£ç”Ÿæˆä»£ç†proxyå¯¹è±¡ï¼Œä»£ç†å¯¹è±¡proxyä¼šæ‹¦æˆªæ¥å£æ–¹æ³•ï¼Œè½¬è€Œæ‰§è¡ŒMappedStatementæ‰€ä»£è¡¨çš„sqlï¼Œç„¶åå°†sqlæ‰§è¡Œç»“æœè¿”å›ã€‚</p><p>åŸç†å¯ä»¥å‚è€ƒï¼š[<a href="https://www.cnblogs.com/soundcode/p/6497291.html">MyBatis]DAOå±‚åªå†™æ¥å£ï¼Œä¸ç”¨å†™å®ç°ç±» - å·¦æ­£ - åšå®¢å›­ (cnblogs.com)</a></p><h3 id="1-4-å’Œibatisæ¯”è¾ƒå¤§çš„å‡ ä¸ªæ”¹è¿›ï¼Ÿ"><a href="#1-4-å’Œibatisæ¯”è¾ƒå¤§çš„å‡ ä¸ªæ”¹è¿›ï¼Ÿ" class="headerlink" title="1.4 å’Œibatisæ¯”è¾ƒå¤§çš„å‡ ä¸ªæ”¹è¿›ï¼Ÿ"></a>1.4 å’Œibatisæ¯”è¾ƒå¤§çš„å‡ ä¸ªæ”¹è¿›ï¼Ÿ</h3><ol><li>æœ‰æ¥å£ç»‘å®šï¼ŒåŒ…æ‹¬æ³¨è§£ç»‘å®šsqlå’Œxmlç»‘å®šsqlã€‚</li><li>åŠ¨æ€sqlç”±åŸæ¥çš„èŠ‚ç‚¹é…ç½®ç¼–ç¨‹äº†OGNLè¡¨è¾¾å¼ã€‚</li><li>åœ¨ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šçš„æ—¶å€™å¼•è¿›äº†associationï¼Œåœ¨ä¸€å¯¹å¤šçš„æ—¶å€™å¼•å…¥äº†collectionèŠ‚ç‚¹ï¼Œä¸è¿‡éƒ½æ˜¯åœ¨resultMapé‡Œé¢é…ç½®</li></ol><h3 id="1-5-æ¥å£ç»‘å®šæœ‰å‡ ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«å¦‚ä½•å®ç°ï¼Ÿ"><a href="#1-5-æ¥å£ç»‘å®šæœ‰å‡ ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="1.5 æ¥å£ç»‘å®šæœ‰å‡ ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«å¦‚ä½•å®ç°ï¼Ÿ"></a>1.5 æ¥å£ç»‘å®šæœ‰å‡ ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«å¦‚ä½•å®ç°ï¼Ÿ</h3><ol><li>é€šè¿‡xmlã€‚æŒ‡å®šxmlæ˜ å°„æ–‡ä»¶é‡Œé¢çš„namespaceå¿…é¡»ä¸ºæ¥å£çš„å…¨è·¯å¾„åã€‚</li><li>é€šè¿‡æ³¨è§£ã€‚é€šè¿‡åœ¨æ¥å£çš„æ–¹æ³•ä¸Šæ·»åŠ @selectç­‰æ³¨è§£ã€‚</li></ol><h3 id="1-6-mybatiså¦‚ä½•è¿›è¡Œåˆ†é¡µï¼Ÿåˆ†é¡µæ’ä»¶åŸç†ï¼Ÿ"><a href="#1-6-mybatiså¦‚ä½•è¿›è¡Œåˆ†é¡µï¼Ÿåˆ†é¡µæ’ä»¶åŸç†ï¼Ÿ" class="headerlink" title="1.6 mybatiså¦‚ä½•è¿›è¡Œåˆ†é¡µï¼Ÿåˆ†é¡µæ’ä»¶åŸç†ï¼Ÿ"></a>1.6 mybatiså¦‚ä½•è¿›è¡Œåˆ†é¡µï¼Ÿåˆ†é¡µæ’ä»¶åŸç†ï¼Ÿ</h3><p>ä½¿ç”¨<code>RowBounds</code>å¯¹è±¡è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯é’ˆå¯¹ResultSetç»“æœé›†æ‰§è¡Œçš„å†…å­˜åˆ†é¡µï¼Œè€Œéç‰©ç†åˆ†é¡µï¼Œå¯ä»¥åœ¨sqlå†…ç›´æ¥ä¹¦å†™å¸¦æœ‰ç‰©ç†åˆ†é¡µçš„å‚æ•°æ¥å®Œæˆç‰©ç†åˆ†é¡µï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†é¡µæ’ä»¶æ¥å®Œæˆç‰©ç†åˆ†é¡µã€‚</p><p>åˆ†é¡µæ’ä»¶çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨Mybatisæä¾›çš„æ’ä»¶æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ’ä»¶çš„æ‹¦æˆªæ–¹æ³•å†…æ‹¦æˆªæ‰§è¡Œçš„sqlï¼Œç„¶åé‡å†™sqlï¼Œæ ¹æ®dialectæ–¹è¨€ï¼Œæ·»åŠ å¯¹åº”çš„ç‰©ç†åˆ†é¡µè¯­å¥å’Œç‰©ç†åˆ†é¡µå‚æ•°ã€‚</p><h3 id="1-7-MybatisåŠ¨æ€sqlæ˜¯åšä»€ä¹ˆçš„ï¼Ÿéƒ½æœ‰å“ªäº›åŠ¨æ€sqlï¼Ÿèƒ½ç®€è¿°ä¸€ä¸‹åŠ¨æ€sqlçš„æ‰§è¡ŒåŸç†ä¸ï¼Ÿ"><a href="#1-7-MybatisåŠ¨æ€sqlæ˜¯åšä»€ä¹ˆçš„ï¼Ÿéƒ½æœ‰å“ªäº›åŠ¨æ€sqlï¼Ÿèƒ½ç®€è¿°ä¸€ä¸‹åŠ¨æ€sqlçš„æ‰§è¡ŒåŸç†ä¸ï¼Ÿ" class="headerlink" title="1.7 MybatisåŠ¨æ€sqlæ˜¯åšä»€ä¹ˆçš„ï¼Ÿéƒ½æœ‰å“ªäº›åŠ¨æ€sqlï¼Ÿèƒ½ç®€è¿°ä¸€ä¸‹åŠ¨æ€sqlçš„æ‰§è¡ŒåŸç†ä¸ï¼Ÿ"></a>1.7 MybatisåŠ¨æ€sqlæ˜¯åšä»€ä¹ˆçš„ï¼Ÿéƒ½æœ‰å“ªäº›åŠ¨æ€sqlï¼Ÿèƒ½ç®€è¿°ä¸€ä¸‹åŠ¨æ€sqlçš„æ‰§è¡ŒåŸç†ä¸ï¼Ÿ</h3><ul><li>MybatisåŠ¨æ€sqlå¯ä»¥è®©æˆ‘ä»¬åœ¨Xmlæ˜ å°„æ–‡ä»¶å†…ï¼Œ<strong>ä»¥æ ‡ç­¾çš„å½¢å¼ç¼–å†™åŠ¨æ€sqlï¼Œå®Œæˆé€»è¾‘åˆ¤æ–­å’ŒåŠ¨æ€æ‹¼æ¥sqlçš„åŠŸèƒ½</strong>ã€‚</li><li>Mybatisæä¾›äº†9ç§åŠ¨æ€sqlæ ‡ç­¾ï¼štrim|where|set|foreach|if|choose|when|otherwise|bindã€‚</li><li>å…¶æ‰§è¡ŒåŸç†ä¸ºï¼Œä½¿ç”¨OGNLä»sqlå‚æ•°å¯¹è±¡ä¸­è®¡ç®—è¡¨è¾¾å¼çš„å€¼ï¼Œ<strong>æ ¹æ®è¡¨è¾¾å¼çš„å€¼åŠ¨æ€æ‹¼æ¥sqlï¼Œä»¥æ­¤æ¥å®ŒæˆåŠ¨æ€sqlçš„åŠŸèƒ½</strong>ã€‚</li></ul><h3 id="1-8-Mybatisçš„Xmlæ˜ å°„æ–‡ä»¶ä¸­ï¼Œä¸åŒçš„Xmlæ˜ å°„æ–‡ä»¶ï¼Œidæ˜¯å¦å¯ä»¥é‡å¤ï¼Ÿ"><a href="#1-8-Mybatisçš„Xmlæ˜ å°„æ–‡ä»¶ä¸­ï¼Œä¸åŒçš„Xmlæ˜ å°„æ–‡ä»¶ï¼Œidæ˜¯å¦å¯ä»¥é‡å¤ï¼Ÿ" class="headerlink" title="1.8 Mybatisçš„Xmlæ˜ å°„æ–‡ä»¶ä¸­ï¼Œä¸åŒçš„Xmlæ˜ å°„æ–‡ä»¶ï¼Œidæ˜¯å¦å¯ä»¥é‡å¤ï¼Ÿ"></a>1.8 Mybatisçš„Xmlæ˜ å°„æ–‡ä»¶ä¸­ï¼Œä¸åŒçš„Xmlæ˜ å°„æ–‡ä»¶ï¼Œidæ˜¯å¦å¯ä»¥é‡å¤ï¼Ÿ</h3><p><strong>å¦‚æœé…ç½®äº†namespaceé‚£ä¹ˆå½“ç„¶æ˜¯å¯ä»¥é‡å¤çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„Statementå®é™…ä¸Šå°±æ˜¯namespace+id</strong>ã€‚</p><p>å¦‚æœæ²¡æœ‰é…ç½®namespaceçš„è¯ï¼Œé‚£ä¹ˆç›¸åŒçš„idå°±ä¼šå¯¼è‡´è¦†ç›–äº†ã€‚</p><h3 id="2-äºŒéƒ¨åˆ†"><a href="#2-äºŒéƒ¨åˆ†" class="headerlink" title="2. äºŒéƒ¨åˆ†"></a>2. äºŒéƒ¨åˆ†</h3><p>å‚è€ƒè‡³ï¼š<a href="https://blog.csdn.net/ThinkWon/article/details/101292950">MyBatisé¢è¯•é¢˜ï¼ˆ2020æœ€æ–°ç‰ˆï¼‰_ThinkWonçš„åšå®¢-CSDNåšå®¢_mybatisé¢è¯•é¢˜</a></p><h3 id="2-1-MyBatisç¼–ç¨‹æ­¥éª¤æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ"><a href="#2-1-MyBatisç¼–ç¨‹æ­¥éª¤æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ" class="headerlink" title="2.1 MyBatisç¼–ç¨‹æ­¥éª¤æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ"></a>2.1 MyBatisç¼–ç¨‹æ­¥éª¤æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</h3><p>1ã€ åˆ›å»ºSqlSessionFactory</p><p>2ã€ é€šè¿‡SqlSessionFactoryåˆ›å»ºSqlSession</p><p>3ã€ é€šè¿‡sqlsessionæ‰§è¡Œæ•°æ®åº“æ“ä½œ</p><p>4ã€ è°ƒç”¨session.commit()æäº¤äº‹åŠ¡</p><p>5ã€ è°ƒç”¨session.close()å…³é—­ä¼šè¯</p><h3 id="2-2-mybatiså·¥ä½œåŸç†"><a href="#2-2-mybatiså·¥ä½œåŸç†" class="headerlink" title="2.2 mybatiså·¥ä½œåŸç†"></a>2.2 mybatiså·¥ä½œåŸç†</h3><p><img src="/2021/05/24/mybatis/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0pvdXJXb24vaW1hZ2UvbWFzdGVyL015QmF0aXMlRTYlQTElODYlRTYlOUUlQjYlRTYlODAlQkIlRTclQkIlOTMvTXlCYXRpcyVFNSVCNyVBNSVFNCVCRCU5QyVFNSU4RSU5RiVFNyU5MCU4Ni5wbmc" alt="MyBatiså·¥ä½œåŸç†"></p><p>1ï¼‰è¯»å– MyBatis é…ç½®æ–‡ä»¶ï¼šmybatis-config.xml ä¸º MyBatis çš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œé…ç½®äº† MyBatis çš„è¿è¡Œç¯å¢ƒç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚</p><p>2ï¼‰åŠ è½½æ˜ å°„æ–‡ä»¶ã€‚æ˜ å°„æ–‡ä»¶å³ SQL æ˜ å°„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­é…ç½®äº†æ“ä½œæ•°æ®åº“çš„ SQL è¯­å¥ï¼Œéœ€è¦åœ¨ MyBatis é…ç½®æ–‡ä»¶ mybatis-config.xml ä¸­åŠ è½½ã€‚mybatis-config.xml æ–‡ä»¶å¯ä»¥åŠ è½½å¤šä¸ªæ˜ å°„æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚</p><p>3ï¼‰æ„é€ ä¼šè¯å·¥å‚ï¼šé€šè¿‡ MyBatis çš„ç¯å¢ƒç­‰é…ç½®ä¿¡æ¯æ„å»ºä¼šè¯å·¥å‚ SqlSessionFactoryã€‚</p><p>4ï¼‰åˆ›å»ºä¼šè¯å¯¹è±¡ï¼šç”±ä¼šè¯å·¥å‚åˆ›å»º SqlSession å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«äº†æ‰§è¡Œ SQL è¯­å¥çš„æ‰€æœ‰æ–¹æ³•ã€‚</p><p>5ï¼‰Executor æ‰§è¡Œå™¨ï¼šMyBatis åº•å±‚å®šä¹‰äº†ä¸€ä¸ª Executor æ¥å£æ¥æ“ä½œæ•°æ®åº“ï¼Œå®ƒå°†æ ¹æ® SqlSession ä¼ é€’çš„å‚æ•°åŠ¨æ€åœ°ç”Ÿæˆéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼ŒåŒæ—¶è´Ÿè´£æŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤ã€‚</p><p>6ï¼‰MappedStatement å¯¹è±¡ï¼šåœ¨ Executor æ¥å£çš„æ‰§è¡Œæ–¹æ³•ä¸­æœ‰ä¸€ä¸ª MappedStatement ç±»å‹çš„å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯å¯¹æ˜ å°„ä¿¡æ¯çš„å°è£…ï¼Œç”¨äºå­˜å‚¨è¦æ˜ å°„çš„ SQL è¯­å¥çš„ idã€å‚æ•°ç­‰ä¿¡æ¯ã€‚</p><p>7ï¼‰è¾“å…¥å‚æ•°æ˜ å°„ï¼šè¾“å…¥å‚æ•°ç±»å‹å¯ä»¥æ˜¯ Mapã€List ç­‰é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ POJO ç±»å‹ã€‚è¾“å…¥å‚æ•°æ˜ å°„è¿‡ç¨‹ç±»ä¼¼äº JDBC å¯¹ preparedStatement å¯¹è±¡è®¾ç½®å‚æ•°çš„è¿‡ç¨‹ã€‚</p><p>8ï¼‰è¾“å‡ºç»“æœæ˜ å°„ï¼šè¾“å‡ºç»“æœç±»å‹å¯ä»¥æ˜¯ Mapã€ List ç­‰é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ POJO ç±»å‹ã€‚è¾“å‡ºç»“æœæ˜ å°„è¿‡ç¨‹ç±»ä¼¼äº JDBC å¯¹ç»“æœé›†çš„è§£æè¿‡ç¨‹ã€‚</p><h3 id="2-3-Mybatiséƒ½æœ‰å“ªäº›Executoræ‰§è¡Œå™¨ï¼Ÿå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-3-Mybatiséƒ½æœ‰å“ªäº›Executoræ‰§è¡Œå™¨ï¼Ÿå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.3 Mybatiséƒ½æœ‰å“ªäº›Executoræ‰§è¡Œå™¨ï¼Ÿå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2.3 Mybatiséƒ½æœ‰å“ªäº›Executoræ‰§è¡Œå™¨ï¼Ÿå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Mybatisæœ‰ä¸‰ç§åŸºæœ¬çš„Executoræ‰§è¡Œå™¨ï¼ŒSimpleExecutorã€ReuseExecutorã€BatchExecutorã€‚</p><p><code>SimpleExecutor</code>ï¼šæ¯æ‰§è¡Œä¸€æ¬¡updateæˆ–selectï¼Œå°±å¼€å¯ä¸€ä¸ªStatementå¯¹è±¡ï¼Œç”¨å®Œç«‹åˆ»å…³é—­Statementå¯¹è±¡ã€‚</p><p><code>ReuseExecutor</code>ï¼šæ‰§è¡Œupdateæˆ–selectï¼Œä»¥sqlä½œä¸ºkeyæŸ¥æ‰¾Statementå¯¹è±¡ï¼Œå­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼Œç”¨å®Œåï¼Œä¸å…³é—­Statementå¯¹è±¡ï¼Œè€Œæ˜¯æ”¾ç½®äºMap&lt;String, Statement&gt;å†…ï¼Œä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚ç®€è¨€ä¹‹ï¼Œå°±æ˜¯é‡å¤ä½¿ç”¨Statementå¯¹è±¡ã€‚</p><p><code>BatchExecutor</code>ï¼šæ‰§è¡Œupdateï¼ˆæ²¡æœ‰selectï¼ŒJDBCæ‰¹å¤„ç†ä¸æ”¯æŒselectï¼‰ï¼Œå°†æ‰€æœ‰sqléƒ½æ·»åŠ åˆ°æ‰¹å¤„ç†ä¸­ï¼ˆaddBatch()ï¼‰ï¼Œç­‰å¾…ç»Ÿä¸€æ‰§è¡Œï¼ˆexecuteBatch()ï¼‰ï¼Œå®ƒç¼“å­˜äº†å¤šä¸ªStatementå¯¹è±¡ï¼Œæ¯ä¸ªStatementå¯¹è±¡éƒ½æ˜¯addBatch()å®Œæ¯•åï¼Œç­‰å¾…é€ä¸€æ‰§è¡ŒexecuteBatch()æ‰¹å¤„ç†ã€‚ä¸JDBCæ‰¹å¤„ç†ç›¸åŒã€‚</p><p>ä½œç”¨èŒƒå›´ï¼šExecutorçš„è¿™äº›ç‰¹ç‚¹ï¼Œéƒ½ä¸¥æ ¼é™åˆ¶åœ¨SqlSessionç”Ÿå‘½å‘¨æœŸèŒƒå›´å†…ã€‚</p><h3 id="1-4-Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå¦‚æœæ”¯æŒï¼Œå®ƒçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-4-Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå¦‚æœæ”¯æŒï¼Œå®ƒçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.4 Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå¦‚æœæ”¯æŒï¼Œå®ƒçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.4 Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå¦‚æœæ”¯æŒï¼Œå®ƒçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Mybatisä»…æ”¯æŒassociationå…³è”å¯¹è±¡å’Œcollectionå…³è”é›†åˆå¯¹è±¡çš„å»¶è¿ŸåŠ è½½ï¼ŒassociationæŒ‡çš„å°±æ˜¯ä¸€å¯¹ä¸€ï¼ŒcollectionæŒ‡çš„å°±æ˜¯ä¸€å¯¹å¤šæŸ¥è¯¢ã€‚åœ¨Mybatisé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é…ç½®æ˜¯å¦å¯ç”¨å»¶è¿ŸåŠ è½½lazyLoadingEnabled=true|falseã€‚</p><p>å®ƒçš„åŸç†æ˜¯ï¼Œä½¿ç”¨CGLIBåˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œå½“è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œè¿›å…¥æ‹¦æˆªå™¨æ–¹æ³•ï¼Œæ¯”å¦‚è°ƒç”¨a.getB().getName()ï¼Œæ‹¦æˆªå™¨invoke()æ–¹æ³•å‘ç°a.getB()æ˜¯nullå€¼ï¼Œé‚£ä¹ˆå°±ä¼šå•ç‹¬å‘é€äº‹å…ˆä¿å­˜å¥½çš„æŸ¥è¯¢å…³è”Bå¯¹è±¡çš„sqlï¼ŒæŠŠBæŸ¥è¯¢ä¸Šæ¥ï¼Œç„¶åè°ƒç”¨a.setB(b)ï¼Œäºæ˜¯açš„å¯¹è±¡bå±æ€§å°±æœ‰å€¼äº†ï¼Œæ¥ç€å®Œæˆa.getB().getName()æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™å°±æ˜¯å»¶è¿ŸåŠ è½½çš„åŸºæœ¬åŸç†ã€‚</p><p>å½“ç„¶äº†ï¼Œä¸å…‰æ˜¯Mybatisï¼Œå‡ ä¹æ‰€æœ‰çš„åŒ…æ‹¬Hibernateï¼Œæ”¯æŒå»¶è¿ŸåŠ è½½çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h3 id="2-5-å’Œ-çš„åŒºåˆ«"><a href="#2-5-å’Œ-çš„åŒºåˆ«" class="headerlink" title="2.5 #{}å’Œ${}çš„åŒºåˆ«"></a>2.5 #{}å’Œ${}çš„åŒºåˆ«</h3><p>#{}æ˜¯å ä½ç¬¦ï¼Œé¢„ç¼–è¯‘å¤„ç†ï¼›${}æ˜¯æ‹¼æ¥ç¬¦ï¼Œå­—ç¬¦ä¸²æ›¿æ¢ï¼Œæ²¡æœ‰é¢„ç¼–è¯‘å¤„ç†ã€‚</p><ol><li><p>Mybatisåœ¨å¤„ç†#{}æ—¶ï¼Œ#{}ä¼ å…¥å‚æ•°æ˜¯ä»¥å­—ç¬¦ä¸²ä¼ å…¥ï¼Œä¼šå°†SQLä¸­çš„#{}æ›¿æ¢ä¸º?å·ï¼Œè°ƒç”¨PreparedStatementçš„setæ–¹æ³•æ¥èµ‹å€¼ã€‚</p></li><li><p>Mybatisåœ¨å¤„ç†æ—¶ ï¼Œ æ˜¯ åŸ å€¼ ä¼  å…¥ ï¼Œ å°± æ˜¯ æŠŠ {}æ—¶ï¼Œæ˜¯åŸå€¼ä¼ å…¥ï¼Œå°±æ˜¯æŠŠæ—¶ï¼Œæ˜¯åŸå€¼ä¼ å…¥ï¼Œå°±æ˜¯æŠŠ{}æ›¿æ¢æˆå˜é‡çš„å€¼ï¼Œç›¸å½“äºJDBCä¸­çš„Statementç¼–è¯‘</p></li><li><p>å˜é‡æ›¿æ¢åï¼Œ#{} å¯¹åº”çš„å˜é‡è‡ªåŠ¨åŠ ä¸Šå•å¼•å· â€˜â€™ï¼›å˜é‡æ›¿æ¢åï¼Œ${} å¯¹åº”çš„å˜é‡ä¸ä¼šåŠ ä¸Šå•å¼•å· â€˜â€™</p></li><li><p>#{} å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢SQLæ³¨å…¥ï¼Œæé«˜ç³»ç»Ÿå®‰å…¨æ€§ï¼›${} ä¸èƒ½é˜²æ­¢SQL æ³¨å…¥</p></li><li><p>#{} çš„å˜é‡æ›¿æ¢æ˜¯åœ¨DBMS ä¸­ï¼›${} çš„å˜é‡æ›¿æ¢æ˜¯åœ¨ DBMS å¤–</p></li></ol><h3 id="2-6-Mapper-ç¼–å†™æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"><a href="#2-6-Mapper-ç¼–å†™æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="2.6 Mapper ç¼–å†™æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"></a>2.6 Mapper ç¼–å†™æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</h3><p>ç¬¬ä¸€ç§ï¼šæ¥å£å®ç°ç±»ç»§æ‰¿ SqlSessionDaoSupportï¼šä½¿ç”¨æ­¤ç§æ–¹æ³•éœ€è¦ç¼–å†™mapper æ¥å£ï¼Œmapper æ¥å£å®ç°ç±»ã€mapper.xml æ–‡ä»¶ã€‚</p><p>ï¼ˆ1ï¼‰åœ¨ sqlMapConfig.xml ä¸­é…ç½® mapper.xml çš„ä½ç½®</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper.xml æ–‡ä»¶çš„åœ°å€<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper.xml æ–‡ä»¶çš„åœ°å€<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ2ï¼‰å®šä¹‰ mapper æ¥å£</p><p>ï¼ˆ3ï¼‰å®ç°ç±»é›†æˆ SqlSessionDaoSupport</p><p>mapper æ–¹æ³•ä¸­å¯ä»¥ this.getSqlSession()è¿›è¡Œæ•°æ®å¢åˆ æ”¹æŸ¥ã€‚</p><p>ï¼ˆ4ï¼‰spring é…ç½®</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> <span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper æ¥å£çš„å®ç°<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sqlSessionFactory<span class="token punctuation">"</span></span>    <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sqlSessionFactory<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒç§ï¼šä½¿ç”¨ org.mybatis.spring.mapper.MapperFactoryBeanï¼š</p><p>ï¼ˆ1ï¼‰åœ¨ sqlMapConfig.xml ä¸­é…ç½® mapper.xml çš„ä½ç½®ï¼Œå¦‚æœ mapper.xml å’Œmappre æ¥å£çš„åç§°ç›¸åŒä¸”åœ¨åŒä¸€ä¸ªç›®å½•ï¼Œè¿™é‡Œå¯ä»¥ä¸ç”¨é…ç½®ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper.xml æ–‡ä»¶çš„åœ°å€<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper.xml æ–‡ä»¶çš„åœ°å€<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ2ï¼‰å®šä¹‰ mapper æ¥å£ï¼š</p><p>ï¼ˆ3ï¼‰mapper.xml ä¸­çš„ namespace ä¸º mapper æ¥å£çš„åœ°å€</p><p>ï¼ˆ4ï¼‰mapper æ¥å£ä¸­çš„æ–¹æ³•åå’Œ mapper.xml ä¸­çš„å®šä¹‰çš„ statement çš„ id ä¿æŒä¸€è‡´</p><p>ï¼ˆ5ï¼‰Spring ä¸­å®šä¹‰</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.spring.mapper.MapperFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapperInterface<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper æ¥å£åœ°å€<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sqlSessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sqlSessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸‰ç§ï¼šä½¿ç”¨ mapper æ‰«æå™¨ï¼š</p><p>ï¼ˆ1ï¼‰mapper.xml æ–‡ä»¶ç¼–å†™ï¼š</p><p>mapper.xml ä¸­çš„ namespace ä¸º mapper æ¥å£çš„åœ°å€ï¼›</p><p>mapper æ¥å£ä¸­çš„æ–¹æ³•åå’Œ mapper.xml ä¸­çš„å®šä¹‰çš„ statement çš„ id ä¿æŒä¸€è‡´ï¼›</p><p>å¦‚æœå°† mapper.xml å’Œ mapper æ¥å£çš„åç§°ä¿æŒä¸€è‡´åˆ™ä¸ç”¨åœ¨ sqlMapConfig.xmlä¸­è¿›è¡Œé…ç½®ã€‚</p><p>ï¼ˆ2ï¼‰å®šä¹‰ mapper æ¥å£ï¼š</p><p>æ³¨æ„ mapper.xml çš„æ–‡ä»¶åå’Œ mapper çš„æ¥å£åç§°ä¿æŒä¸€è‡´ï¼Œä¸”æ”¾åœ¨åŒä¸€ä¸ªç›®å½•</p><p>ï¼ˆ3ï¼‰é…ç½® mapper æ‰«æå™¨ï¼š</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.spring.mapper.MapperScannerConfigurer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>basePackage<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper æ¥å£åŒ…åœ°å€    <span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sqlSessionFactoryBeanName<span class="token punctuation">"</span></span>    <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sqlSessionFactory<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-7-ä½¿ç”¨æ‰«æå™¨åä»-spring-å®¹å™¨ä¸­è·å–-mapper-çš„å®ç°å¯¹è±¡ã€‚"><a href="#2-7-ä½¿ç”¨æ‰«æå™¨åä»-spring-å®¹å™¨ä¸­è·å–-mapper-çš„å®ç°å¯¹è±¡ã€‚" class="headerlink" title="2.7 ä½¿ç”¨æ‰«æå™¨åä» spring å®¹å™¨ä¸­è·å– mapper çš„å®ç°å¯¹è±¡ã€‚"></a>2.7 ä½¿ç”¨æ‰«æå™¨åä» spring å®¹å™¨ä¸­è·å– mapper çš„å®ç°å¯¹è±¡ã€‚</h3><p>ç®€è¿°Mybatisçš„Xmlæ˜ å°„æ–‡ä»¶å’ŒMybatiså†…éƒ¨æ•°æ®ç»“æ„ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Ÿ<br>ç­”ï¼šMybatiså°†æ‰€æœ‰Xmlé…ç½®ä¿¡æ¯éƒ½å°è£…åˆ°All-In-Oneé‡é‡çº§å¯¹è±¡Configurationå†…éƒ¨ã€‚åœ¨Xmlæ˜ å°„æ–‡ä»¶ä¸­ï¼Œ<parametermap>æ ‡ç­¾ä¼šè¢«è§£æä¸ºParameterMapå¯¹è±¡ï¼Œå…¶æ¯ä¸ªå­å…ƒç´ ä¼šè¢«è§£æä¸ºParameterMappingå¯¹è±¡ã€‚<resultmap>æ ‡ç­¾ä¼šè¢«è§£æä¸ºResultMapå¯¹è±¡ï¼Œå…¶æ¯ä¸ªå­å…ƒç´ ä¼šè¢«è§£æä¸ºResultMappingå¯¹è±¡ã€‚æ¯ä¸€ä¸ª<select>ã€ã€ã€æ ‡ç­¾å‡ä¼šè¢«è§£æä¸ºMappedStatementå¯¹è±¡ï¼Œæ ‡ç­¾å†…çš„sqlä¼šè¢«è§£æä¸ºBoundSqlå¯¹è±¡ã€‚</select></resultmap></parametermap></p><h3 id="2-8-ç¼“å­˜"><a href="#2-8-ç¼“å­˜" class="headerlink" title="2.8 ç¼“å­˜"></a>2.8 ç¼“å­˜</h3><p>Mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜<br>1ï¼‰ä¸€çº§ç¼“å­˜: åŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Sessionï¼Œå½“ Session flush æˆ– close ä¹‹åï¼Œè¯¥ Session ä¸­çš„æ‰€æœ‰ Cache å°±å°†æ¸…ç©ºï¼Œé»˜è®¤æ‰“å¼€ä¸€çº§ç¼“å­˜ã€‚</p><p>2ï¼‰äºŒçº§ç¼“å­˜ä¸ä¸€çº§ç¼“å­˜å…¶æœºåˆ¶ç›¸åŒï¼Œé»˜è®¤ä¹Ÿæ˜¯é‡‡ç”¨ PerpetualCacheï¼ŒHashMap å­˜å‚¨ï¼Œä¸åŒåœ¨äºå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Mapper(Namespace)ï¼Œå¹¶ä¸”å¯è‡ªå®šä¹‰å­˜å‚¨æºï¼Œå¦‚ Ehcacheã€‚é»˜è®¤ä¸æ‰“å¼€äºŒçº§ç¼“å­˜ï¼Œè¦å¼€å¯äºŒçº§ç¼“å­˜ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜å±æ€§ç±»éœ€è¦å®ç°Serializableåºåˆ—åŒ–æ¥å£(å¯ç”¨æ¥ä¿å­˜å¯¹è±¡çš„çŠ¶æ€),å¯åœ¨å®ƒçš„æ˜ å°„æ–‡ä»¶ä¸­é…ç½®<cache> ï¼›</cache></p><p>3ï¼‰å¯¹äºç¼“å­˜æ•°æ®æ›´æ–°æœºåˆ¶ï¼Œå½“æŸä¸€ä¸ªä½œç”¨åŸŸ(ä¸€çº§ç¼“å­˜ Session/äºŒçº§ç¼“å­˜Namespaces)çš„è¿›è¡Œäº†C/U/D æ“ä½œåï¼Œé»˜è®¤è¯¥ä½œç”¨åŸŸä¸‹æ‰€æœ‰ select ä¸­çš„ç¼“å­˜å°†è¢« clearã€‚</p><p><a href="https://segmentfault.com/a/1190000038544664">å½»åº•ææ˜ç™½mybatisç¼“å­˜ï¼ˆä¸Šï¼‰ - SegmentFault æ€å¦</a></p><h3 id="2-9-åˆ†é¡µåŸç†-pagehelper"><a href="#2-9-åˆ†é¡µåŸç†-pagehelper" class="headerlink" title="2.9 åˆ†é¡µåŸç† pagehelper"></a>2.9 åˆ†é¡µåŸç† pagehelper</h3><p>PageHelperé¦–å…ˆå°†å‰ç«¯ä¼ é€’çš„å‚æ•°ä¿å­˜åˆ°pageè¿™ä¸ªå¯¹è±¡ä¸­ï¼Œæ¥ç€å°†pageçš„å‰¯æœ¬å­˜æ”¾å…¥ThreadLoaclä¸­ï¼Œè¿™æ ·å¯ä»¥ä¿è¯åˆ†é¡µçš„æ—¶å€™ï¼Œå‚æ•°äº’ä¸å½±å“ï¼Œæ¥ç€åˆ©ç”¨äº†mybatisæä¾›çš„æ‹¦æˆªå™¨ï¼Œå–å¾—ThreadLocalçš„å€¼ï¼Œé‡æ–°æ‹¼è£…åˆ†é¡µSQLï¼Œå®Œæˆåˆ†é¡µã€‚</p><p><a href="https://blog.csdn.net/qq_21996541/article/details/79796117">æµ…æpagehelperåˆ†é¡µåŸç†_ç‹å¤§é”¤çš„åšå®¢-CSDNåšå®¢_pagehelperåˆ†é¡µåŸç†</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/05/24/springmvc/"/>
      <url>2021/05/24/springmvc/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><ol><li><p>æ¨¡å‹ dao service æ•°æ®æ¨¡å‹ï¼Œæä¾›è¦å±•ç¤ºçš„æ•°æ®ï¼Œä»–ä»¬çš„è¡Œä¸ºç”±serviceæä¾›ã€‚</p></li><li><p>è§†å›¾ jsp</p></li><li><p>æ§åˆ¶å™¨ Servletï¼šï¼ˆè½¬å‘ï¼Œé‡å®šå‘ï¼‰æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œå§”æ‰˜ç»™æ¨¡å‹è¿›è¡Œå¤„ç†ï¼ˆçŠ¶æ€æ”¹å˜ï¼‰ï¼Œå¤„ç†å®Œæ¯•åæŠŠè¿”å›çš„æ¨¡å‹æ•°æ®è¿”å›ç»™è§†å›¾ï¼Œç”±è§†å›¾è´Ÿè´£å±•ç¤ºã€‚æ§åˆ¶å™¨åšäº†è°ƒåº¦å‘˜çš„å·¥ä½œã€‚</p></li></ol><p>å®ƒæ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡è§„èŒƒã€‚å°†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®å’Œæ˜¾ç¤ºåˆ†ç¦»ã€‚</p><h2 id="1-åˆ›å»ºé¡¹ç›®"><a href="#1-åˆ›å»ºé¡¹ç›®" class="headerlink" title="1 åˆ›å»ºé¡¹ç›®"></a>1 åˆ›å»ºé¡¹ç›®</h2><ul><li>å¯¼å…¥ä¾èµ–ï¼šjunit,æ•°æ®åº“é©±åŠ¨ï¼Œè¿æ¥æ± ï¼Œservlet,jsp,mybatis,mybatis-spring,spring</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.46<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.mchange<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>c3p0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.5.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jsp-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.2.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>web.xmlä¸‹çš„ï¼š</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">"</span></span>         <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--    é…ç½®DispatchServletï¼šè¿™æ˜¯SpringMVCçš„æ ¸å¿ƒ--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>SpringMVC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.servlet.DispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>classpath:springmvc-servlet.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--        å¯åŠ¨çº§åˆ«--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--    åœ¨springmvc / å’Œ /* æœ‰åŒºåˆ«    / åªåŒ¹é…æ‰€æœ‰è¯·æ±‚ï¼Œä¸ä¼šåŒ¹é…jspé¡µé¢ï¼Œä¸€èˆ¬å†™/å°±å¯ä»¥äº†    /* åŒ¹é…æ‰€æœ‰è¯·æ±‚ï¼ŒåŒ…æ‹¬jsp    --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>SpringMVC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>servlet configurationé…ç½®æ–‡ä»¶ï¼š</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>mvc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/mvc<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans       https://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kuang.controller<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>default-servlet-handler</span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--    æ”¯æŒmvcæ³¨è§£é©±åŠ¨        åœ¨springä¸­ä¸€èˆ¬é‡‡ç”¨@RequestMappingæ³¨è§£æ¥å®Œæˆæ˜ å°„å…³ç³»        è¦æƒ³ä½¿@RequestMappingæ³¨è§£ç”Ÿæ•ˆ        å¿…é¡»å‘ä¸Šä¸‹æ–‡æ³¨å†ŒDefaultAnnotationHandlerMapping        å’Œä¸€ä¸ªAnnotationMethodHandlerAdapterå®ä¾‹        è¿™ä¸¤ä¸ªå®ä¾‹åˆ†åˆ«åœ¨ç±»åŒçº§åˆ«å’Œæ–¹æ³•çº§åˆ«å¤„ç†ã€‚        è€Œannotation-drivené…ç½®å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨å®Œæˆä¸Šè¿°ä¸¤ä¸ªå®ä¾‹çš„æ³¨å…¥ã€‚--&gt;</span><span class="token comment">&lt;!--    è§†å›¾è§£æå™¨--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.servlet.view.InternalResourceViewResolver<span class="token punctuation">"</span></span>      <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>internalResourceViewResolver<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prefix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/WEB-INF/jsp/<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>suffix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.jsp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-ControlleråŠRestFulé£æ ¼"><a href="#2-ControlleråŠRestFulé£æ ¼" class="headerlink" title="2. ControlleråŠRestFulé£æ ¼"></a>2. ControlleråŠRestFulé£æ ¼</h2><h3 id="1-æ§åˆ¶å™¨Controller"><a href="#1-æ§åˆ¶å™¨Controller" class="headerlink" title="1.æ§åˆ¶å™¨Controller"></a>1.æ§åˆ¶å™¨Controller</h3><ul><li>æ§åˆ¶å™¨å¤æ‚æä¾›è®¿é—®åº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼Œé€šå¸¸é€šè¿‡æ¥å£å®šä¹‰æˆ–æ³¨è§£å®šä¹‰ä¸¤ç§æ–¹æ³•å®ç°ã€‚</li><li>æ§åˆ¶å™¨è´Ÿè´£è§£æç”¨æˆ·çš„è¯·æ±‚å¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ¨¡å‹ã€‚</li><li>åœ¨SpringMVCä¸­ä¸€ä¸ªæ§åˆ¶å™¨ç±»å¯ä»¥åŒ…å«å¤šä¸ªæ–¹æ³•ã€‚</li><li>åœ¨SpringMVCä¸­ï¼Œå¯¹äºcontrollerçš„é…ç½®æ–¹å¼æœ‰å¾ˆå¤šç§ã€‚</li></ul><h3 id="2-å®ç°Controlleræ¥å£"><a href="#2-å®ç°Controlleræ¥å£" class="headerlink" title="2. å®ç°Controlleræ¥å£"></a>2. å®ç°Controlleræ¥å£</h3><p><code>Controller</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåœ¨<code>org.springframework.web.servlet.mvc</code>åŒ…ä¸‹ï¼Œæ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Nullable</span>    <span class="token class-name">ModelAndView</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> var1<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> var2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-æ³¨è§£-Controller"><a href="#3-æ³¨è§£-Controller" class="headerlink" title="3. æ³¨è§£@Controller"></a>3. æ³¨è§£@Controller</h3><p>åœ¨ç±»åŠ ä¸Š<code>@Controller</code>, æ–¹æ³•åŠ ä¸Š<code>RequestMapping("/hello")</code>(â€œ/helloâ€æ˜¯èµ·çš„åå­—)ã€‚</p><h3 id="4-RequestMapping"><a href="#4-RequestMapping" class="headerlink" title="4.RequestMapping"></a>4.RequestMapping</h3><p><strong>@RequestMapping</strong></p><ul><li><p>@RequestMappingæ³¨è§£ç”¨äºæ˜ å°„urlåˆ°æ§åˆ¶å™¨ç±»æˆ–ä¸€ä¸ªç‰¹å®šçš„å¤„ç†ç¨‹åºæ–¹æ³•ã€‚å¯ç”¨äºç±»æˆ–æ–¹æ³•ä¸Šã€‚ç”¨äºç±»ä¸Šï¼Œè¡¨ç¤ºç±»ä¸­çš„æ‰€æœ‰å“åº”è¯·æ±‚çš„æ–¹æ³•éƒ½æ˜¯ä»¥è¯¥åœ°å€ä½œä¸ºçˆ¶è·¯å¾„ã€‚</p></li><li><p>åªæ³¨è§£åœ¨æ–¹æ³•ä¸Šé¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/h1"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">return</span> <span class="token string">"test"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®¿é—®è·¯å¾„ï¼š<a href="http://localhost:8080/">http://localhost:8080</a> / é¡¹ç›®å / h1</p></li><li><p>åŒæ—¶æ³¨è§£ç±»ä¸æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/h1"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">return</span> <span class="token string">"test"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®¿é—®è·¯å¾„ï¼š<a href="http://localhost:8080/">http://localhost:8080</a> / é¡¹ç›®å/ admin /h1  , éœ€è¦å…ˆæŒ‡å®šç±»çš„è·¯å¾„å†æŒ‡å®šæ–¹æ³•çš„è·¯å¾„ï¼›</p></li></ul><h3 id="5-RestFulé£æ ¼"><a href="#5-RestFulé£æ ¼" class="headerlink" title="5. RestFulé£æ ¼"></a>5. RestFulé£æ ¼</h3><p>RestFulé£æ ¼å°±æ˜¯ä¸€ä¸ªèµ„æºå®šä½åŠèµ„æºæ“ä½œçš„é£æ ¼ã€‚ä¸æ˜¯æ ‡å‡†ä¹Ÿä¸æ˜¯åè®®ï¼Œåªæ˜¯ä¸€ç§é£æ ¼ã€‚åŸºäºè¿™ä¸ªé£æ ¼è®¾è®¡çš„è½¯ä»¶å¯ä»¥æ›´ç®€æ´ï¼Œæ›´æœ‰å±‚æ¬¡ï¼Œæ›´æ˜“äºå®ç°ç¼“å­˜ç­‰æœºåˆ¶ã€‚</p><p>é€šè¿‡ä¸åŒçš„è¯·æ±‚æ–¹å¼æ¥å®ç°ä¸åŒçš„æ•ˆæœï¼</p><h4 id="5-1-ä½œç”¨"><a href="#5-1-ä½œç”¨" class="headerlink" title="5.1 ä½œç”¨"></a>5.1 ä½œç”¨</h4><p>å®‰å…¨ ç»Ÿä¸€ é«˜æ•ˆ</p><p><strong>ä¼ ç»Ÿæ–¹å¼æ“ä½œèµ„æº</strong>  ï¼šé€šè¿‡ä¸åŒçš„å‚æ•°æ¥å®ç°ä¸åŒçš„æ•ˆæœï¼æ–¹æ³•å•ä¸€ï¼Œpost å’Œ get</p><p>â€‹    <a href="http://127.0.0.1/item/queryItem.action?id=1">http://127.0.0.1/item/queryItem.action?id=1</a> æŸ¥è¯¢,GET</p><p>â€‹    <a href="http://127.0.0.1/item/saveItem.action">http://127.0.0.1/item/saveItem.action</a> æ–°å¢,POST</p><p>â€‹    <a href="http://127.0.0.1/item/updateItem.action">http://127.0.0.1/item/updateItem.action</a> æ›´æ–°,POST</p><p>â€‹    <a href="http://127.0.0.1/item/deleteItem.action?id=1">http://127.0.0.1/item/deleteItem.action?id=1</a> åˆ é™¤,GETæˆ–POST</p><p><strong>ä½¿ç”¨RESTfulæ“ä½œèµ„æº</strong> ï¼šå¯ä»¥é€šè¿‡ä¸åŒçš„è¯·æ±‚æ–¹å¼æ¥å®ç°ä¸åŒçš„æ•ˆæœï¼å¦‚ä¸‹ï¼šè¯·æ±‚åœ°å€ä¸€æ ·ï¼Œä½†æ˜¯åŠŸèƒ½å¯ä»¥ä¸åŒï¼</p><p>â€‹    <a href="http://127.0.0.1/item/1">http://127.0.0.1/item/1</a> æŸ¥è¯¢,GET</p><p>â€‹    <a href="http://127.0.0.1/item">http://127.0.0.1/item</a> æ–°å¢,POST</p><p>â€‹    <a href="http://127.0.0.1/item">http://127.0.0.1/item</a> æ›´æ–°,PUT</p><p>â€‹    <a href="http://127.0.0.1/item/1">http://127.0.0.1/item/1</a> åˆ é™¤,DELETE</p><h3 id="5-2-æµ‹è¯•"><a href="#5-2-æµ‹è¯•" class="headerlink" title="5.2 æµ‹è¯•"></a>5.2 æµ‹è¯•</h3><ol><li><p>åœ¨æ–°å»ºä¸€ä¸ªç±» RestFulController</p><pre class="line-numbers language-none"><code class="language-none">@Controllerpublic class RestFulController {}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨Spring MVCä¸­å¯ä»¥ä½¿ç”¨  @PathVariable æ³¨è§£ï¼Œè®©æ–¹æ³•å‚æ•°çš„å€¼å¯¹åº”ç»‘å®šåˆ°ä¸€ä¸ªURIæ¨¡æ¿å˜é‡ä¸Šã€‚</p><pre class="line-numbers language-none"><code class="language-none">@Controllerpublic class RestFulController {   //æ˜ å°„è®¿é—®è·¯å¾„   @RequestMapping("/commit/{p1}/{p2}")   public String index(@PathVariable int p1, @PathVariable int p2, Model model){              int result = p1+p2;       //Spring MVCä¼šè‡ªåŠ¨å®ä¾‹åŒ–ä¸€ä¸ªModelå¯¹è±¡ç”¨äºå‘è§†å›¾ä¸­ä¼ å€¼       model.addAttribute("msg", "ç»“æœï¼š"+result);       //è¿”å›è§†å›¾ä½ç½®       return "test";         }   }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æˆ‘ä»¬æ¥æµ‹è¯•è¯·æ±‚æŸ¥çœ‹ä¸‹</p></li></ol><p><img src="/2021/05/24/springmvc/restfultest.PNG"></p><p><strong>ä½¿ç”¨methodå±æ€§æŒ‡å®šè¯·æ±‚ç±»å‹</strong></p><p>ç”¨äºçº¦æŸè¯·æ±‚çš„ç±»å‹ï¼Œå¯ä»¥æ”¶çª„è¯·æ±‚èŒƒå›´ã€‚æŒ‡å®šè¯·æ±‚è°“è¯çš„ç±»å‹å¦‚GET, POST, HEAD, OPTIONS, PUT, PATCH, DELETE, TRACEç­‰</p><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><ul><li><p>å¢åŠ ä¸€ä¸ªæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ˜ å°„è®¿é—®è·¯å¾„,å¿…é¡»æ˜¯POSTè¯·æ±‚</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/hello"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index2</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>   model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token string">"test"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨åœ°å€æ è¿›è¡Œè®¿é—®é»˜è®¤æ˜¯Getè¯·æ±‚ï¼Œä¼šæŠ¥é”™405ï¼š</p></li></ul><p>å¦‚æœå°†POSTä¿®æ”¹ä¸ºGETåˆ™æ­£å¸¸äº†ï¼›</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ˜ å°„è®¿é—®è·¯å¾„,å¿…é¡»æ˜¯Getè¯·æ±‚</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/hello"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index2</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>   model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token string">"test"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å°ç»“ï¼š</strong></p><p>Spring MVC çš„ @RequestMapping æ³¨è§£èƒ½å¤Ÿå¤„ç† HTTP è¯·æ±‚çš„æ–¹æ³•, æ¯”å¦‚ GET, PUT, POST, DELETE ä»¥åŠ PATCHã€‚</p><p><strong>æ‰€æœ‰çš„åœ°å€æ è¯·æ±‚é»˜è®¤éƒ½ä¼šæ˜¯ HTTP GET ç±»å‹çš„ã€‚</strong></p><p>æ–¹æ³•çº§åˆ«çš„æ³¨è§£å˜ä½“æœ‰å¦‚ä¸‹å‡ ä¸ªï¼šç»„åˆæ³¨è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token annotation punctuation">@PostMapping</span><span class="token annotation punctuation">@PutMapping</span><span class="token annotation punctuation">@DeleteMapping</span><span class="token annotation punctuation">@PatchMapping</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>@GetMapping æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œå¹³æ—¶ä½¿ç”¨çš„ä¼šæ¯”è¾ƒå¤šï¼</p><p>å®ƒæ‰€æ‰®æ¼”çš„æ˜¯ @RequestMapping(method =RequestMethod.GET) çš„ä¸€ä¸ªå¿«æ·æ–¹å¼ã€‚</p><h2 id="3-SpringMVC-ç»“æœè·³è½¬æ–¹å¼"><a href="#3-SpringMVC-ç»“æœè·³è½¬æ–¹å¼" class="headerlink" title="3.SpringMVC ç»“æœè·³è½¬æ–¹å¼"></a>3.SpringMVC ç»“æœè·³è½¬æ–¹å¼</h2><h3 id="3-1-ModelAndView"><a href="#3-1-ModelAndView" class="headerlink" title="3.1 ModelAndView"></a>3.1 ModelAndView</h3><p>è®¾ç½®ModelAndViewå¯¹è±¡ , æ ¹æ®viewçš„åç§° , å’Œè§†å›¾è§£æå™¨è·³åˆ°æŒ‡å®šçš„é¡µé¢ .</p><p>é¡µé¢ : {è§†å›¾è§£æå™¨å‰ç¼€} + viewName +{è§†å›¾è§£æå™¨åç¼€}</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- è§†å›¾è§£æå™¨ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.servlet.view.InternalResourceViewResolver<span class="token punctuation">"</span></span>     <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>internalResourceViewResolver<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>   <span class="token comment">&lt;!-- å‰ç¼€ --&gt;</span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prefix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/WEB-INF/jsp/<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>   <span class="token comment">&lt;!-- åç¼€ --&gt;</span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>suffix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.jsp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹åº”çš„controllerç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControllerTest1</span> <span class="token keyword">implements</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>   <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> httpServletResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>       <span class="token comment">//è¿”å›ä¸€ä¸ªæ¨¡å‹è§†å›¾å¯¹è±¡</span>       <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"ControllerTest1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> mv<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-ServletAPI"><a href="#3-2-ServletAPI" class="headerlink" title="3.2 ServletAPI"></a>3.2 ServletAPI</h3><p>é€šè¿‡è®¾ç½®ServletAPI , ä¸éœ€è¦è§†å›¾è§£æå™¨ .</p><p>1ã€é€šè¿‡HttpServletResponseè¿›è¡Œè¾“å‡º</p><p>2ã€é€šè¿‡HttpServletResponseå®ç°é‡å®šå‘</p><p>3ã€é€šè¿‡HttpServletResponseå®ç°è½¬å‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultGo</span> <span class="token punctuation">{</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/result/t1"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> rsp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>       rsp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello,Spring BY servlet API"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/result/t2"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> rsp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>       rsp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/index.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/result/t3"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> rsp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>       <span class="token comment">//è½¬å‘</span>       req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"/result/t3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/WEB-INF/jsp/test.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>rsp<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-SpringMVC"><a href="#3-3-SpringMVC" class="headerlink" title="3.3 SpringMVC"></a>3.3 SpringMVC</h3><p><strong>é€šè¿‡SpringMVCæ¥å®ç°è½¬å‘å’Œé‡å®šå‘ - æ— éœ€è§†å›¾è§£æå™¨ï¼›</strong></p><p>æµ‹è¯•å‰ï¼Œéœ€è¦å°†è§†å›¾è§£æå™¨æ³¨é‡Šæ‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultSpringMVC</span> <span class="token punctuation">{</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/rsm/t1"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token comment">//è½¬å‘</span>       <span class="token keyword">return</span> <span class="token string">"/index.jsp"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/rsm/t2"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token comment">//è½¬å‘äºŒ</span>       <span class="token keyword">return</span> <span class="token string">"forward:/index.jsp"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/rsm/t3"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token comment">//é‡å®šå‘</span>       <span class="token keyword">return</span> <span class="token string">"redirect:/index.jsp"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é€šè¿‡SpringMVCæ¥å®ç°è½¬å‘å’Œé‡å®šå‘ - æœ‰è§†å›¾è§£æå™¨ï¼›</strong></p><p>é‡å®šå‘ , ä¸éœ€è¦è§†å›¾è§£æå™¨ , æœ¬è´¨å°±æ˜¯é‡æ–°è¯·æ±‚ä¸€ä¸ªæ–°åœ°æ–¹å˜› , æ‰€ä»¥æ³¨æ„è·¯å¾„é—®é¢˜.</p><p>å¯ä»¥é‡å®šå‘åˆ°å¦å¤–ä¸€ä¸ªè¯·æ±‚å®ç° .</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultSpringMVC2</span> <span class="token punctuation">{</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/rsm2/t1"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token comment">//è½¬å‘</span>       <span class="token keyword">return</span> <span class="token string">"test"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/rsm2/t2"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token comment">//é‡å®šå‘</span>       <span class="token keyword">return</span> <span class="token string">"redirect:/index.jsp"</span><span class="token punctuation">;</span>       <span class="token comment">//return "redirect:hello.do"; //hello.doä¸ºå¦ä¸€ä¸ªè¯·æ±‚/</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-æ•°æ®å¤„ç†"><a href="#4-æ•°æ®å¤„ç†" class="headerlink" title="4.æ•°æ®å¤„ç†"></a>4.æ•°æ®å¤„ç†</h2><h3 id="4-1å¤„ç†æäº¤æ•°æ®"><a href="#4-1å¤„ç†æäº¤æ•°æ®" class="headerlink" title="4.1å¤„ç†æäº¤æ•°æ®"></a>4.1å¤„ç†æäº¤æ•°æ®</h3><p><strong>1ã€æäº¤çš„åŸŸåç§°å’Œå¤„ç†æ–¹æ³•çš„å‚æ•°åä¸€è‡´</strong></p><p>æäº¤æ•°æ® : <a href="http://localhost:8080/hello?name=kuangshen">http://localhost:8080/hello?name=kuangshen</a></p><p>å¤„ç†æ–¹æ³• :</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åå°è¾“å‡º : kuangshen</p><p><strong>2ã€æäº¤çš„åŸŸåç§°å’Œå¤„ç†æ–¹æ³•çš„å‚æ•°åä¸ä¸€è‡´</strong></p><p>æäº¤æ•°æ® : <a href="http://localhost:8080/hello?username=kuangshen">http://localhost:8080/hello?username=kuangshen</a></p><p>å¤„ç†æ–¹æ³• :</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//@RequestParam("username") : usernameæäº¤çš„åŸŸçš„åç§° .</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åå°è¾“å‡º : kuangshen</p><p><strong>3ã€æäº¤çš„æ˜¯ä¸€ä¸ªå¯¹è±¡</strong></p><p>è¦æ±‚æäº¤çš„è¡¨å•åŸŸå’Œå¯¹è±¡çš„å±æ€§åä¸€è‡´  , å‚æ•°ä½¿ç”¨å¯¹è±¡å³å¯</p><p>1ã€å®ä½“ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>   <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>   <span class="token comment">//æ„é€ </span>   <span class="token comment">//get/set</span>   <span class="token comment">//tostring()</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€æäº¤æ•°æ® : <a href="http://localhost:8080/mvc04/user?name=kuangshen&amp;id=1&amp;age=15">http://localhost:8080/mvc04/user?name=kuangshen&amp;id=1&amp;age=15</a></p><p>3ã€å¤„ç†æ–¹æ³• :</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åå°è¾“å‡º : User { id=1, name=â€™kuangshenâ€™, age=15 }</p><p>è¯´æ˜ï¼šå¦‚æœä½¿ç”¨å¯¹è±¡çš„è¯ï¼Œå‰ç«¯ä¼ é€’çš„å‚æ•°åå’Œå¯¹è±¡åå¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™å°±æ˜¯nullã€‚</p><h3 id="4-2æ•°æ®æ˜¾ç¤ºåˆ°å‰ç«¯"><a href="#4-2æ•°æ®æ˜¾ç¤ºåˆ°å‰ç«¯" class="headerlink" title="4.2æ•°æ®æ˜¾ç¤ºåˆ°å‰ç«¯"></a>4.2æ•°æ®æ˜¾ç¤ºåˆ°å‰ç«¯</h3><p><strong>ç¬¬ä¸€ç§ : é€šè¿‡ModelAndView</strong></p><p>æˆ‘ä»¬å‰é¢ä¸€ç›´éƒ½æ˜¯å¦‚æ­¤ . å°±ä¸è¿‡å¤šè§£é‡Š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControllerTest1</span> <span class="token keyword">implements</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>   <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> httpServletResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>       <span class="token comment">//è¿”å›ä¸€ä¸ªæ¨¡å‹è§†å›¾å¯¹è±¡</span>       <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"ControllerTest1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> mv<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç¬¬äºŒç§ : é€šè¿‡ModelMap</strong></p><p>ModelMap(ç»§æ‰¿äº†linkedhashmap)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">ModelMap</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">//å°è£…è¦æ˜¾ç¤ºåˆ°è§†å›¾ä¸­çš„æ•°æ®</span>   <span class="token comment">//ç›¸å½“äºreq.setAttribute("name",name);</span>   model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç¬¬ä¸‰ç§ : é€šè¿‡Model</strong></p><p>Model (ç²¾ç®€ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä½¿ç”¨modelå³å¯ï¼Œåªæœ‰å‡ ä¸ªæ–¹æ³•)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/ct2/hello"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">//å°è£…è¦æ˜¾ç¤ºåˆ°è§†å›¾ä¸­çš„æ•°æ®</span>   <span class="token comment">//ç›¸å½“äºreq.setAttribute("name",name);</span>   model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token string">"test"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-3å¯¹æ¯”"><a href="#4-3å¯¹æ¯”" class="headerlink" title="4.3å¯¹æ¯”"></a>4.3å¯¹æ¯”</h3><p>å°±å¯¹äºæ–°æ‰‹è€Œè¨€ç®€å•æ¥è¯´ä½¿ç”¨åŒºåˆ«å°±æ˜¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Model åªæœ‰å¯¥å¯¥å‡ ä¸ªæ–¹æ³•åªé€‚åˆç”¨äºå‚¨å­˜æ•°æ®ï¼Œç®€åŒ–äº†æ–°æ‰‹å¯¹äºModelå¯¹è±¡çš„æ“ä½œå’Œç†è§£ï¼›ModelMap ç»§æ‰¿äº† LinkedMap ï¼Œé™¤äº†å®ç°äº†è‡ªèº«çš„ä¸€äº›æ–¹æ³•ï¼ŒåŒæ ·çš„ç»§æ‰¿ LinkedMap çš„æ–¹æ³•å’Œç‰¹æ€§ï¼›ModelAndView å¯ä»¥åœ¨å‚¨å­˜æ•°æ®çš„åŒæ—¶ï¼Œå¯ä»¥è¿›è¡Œè®¾ç½®è¿”å›çš„é€»è¾‘è§†å›¾ï¼Œè¿›è¡Œæ§åˆ¶å±•ç¤ºå±‚çš„è·³è½¬ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶æ›´å¤šçš„ä»¥åå¼€å‘è€ƒè™‘çš„æ›´å¤šçš„æ˜¯æ€§èƒ½å’Œä¼˜åŒ–ï¼Œå°±ä¸èƒ½å•å•ä»…é™äºæ­¤çš„äº†è§£ã€‚</p><p><strong>è¯·ä½¿ç”¨80%çš„æ—¶é—´æ‰“å¥½æ‰å®çš„åŸºç¡€ï¼Œå‰©ä¸‹18%çš„æ—¶é—´ç ”ç©¶æ¡†æ¶ï¼Œ2%çš„æ—¶é—´å»å­¦ç‚¹è‹±æ–‡ï¼Œæ¡†æ¶çš„å®˜æ–¹æ–‡æ¡£æ°¸è¿œæ˜¯æœ€å¥½çš„æ•™ç¨‹ã€‚</strong></p><h2 id="5-ä¹±ç é—®é¢˜"><a href="#5-ä¹±ç é—®é¢˜" class="headerlink" title="5. ä¹±ç é—®é¢˜"></a>5. ä¹±ç é—®é¢˜</h2><p>æµ‹è¯•æ­¥éª¤ï¼š</p><p>1ã€æˆ‘ä»¬å¯ä»¥åœ¨é¦–é¡µç¼–å†™ä¸€ä¸ªæäº¤çš„è¡¨å•</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/e/t<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€åå°ç¼–å†™å¯¹åº”çš„å¤„ç†ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Encoding</span> <span class="token punctuation">{</span>   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/e/t"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">,</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>       model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å–è¡¨å•æäº¤çš„å€¼</span>       <span class="token keyword">return</span> <span class="token string">"test"</span><span class="token punctuation">;</span> <span class="token comment">//è·³è½¬åˆ°testé¡µé¢æ˜¾ç¤ºè¾“å…¥çš„å€¼</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€è¾“å…¥ä¸­æ–‡æµ‹è¯•ï¼Œå‘ç°ä¹±ç </p><p>ä¸å¾—ä¸è¯´ï¼Œä¹±ç é—®é¢˜æ˜¯åœ¨æˆ‘ä»¬å¼€å‘ä¸­ååˆ†å¸¸è§çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯è®©æˆ‘ä»¬ç¨‹åºçŒ¿æ¯”è¾ƒå¤´å¤§çš„é—®é¢˜ï¼</p><p>ä»¥å‰ä¹±ç é—®é¢˜é€šè¿‡è¿‡æ»¤å™¨è§£å†³ , è€ŒSpringMVCç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¿‡æ»¤å™¨ , å¯ä»¥åœ¨web.xmlä¸­é…ç½® .</p><p>ä¿®æ”¹äº†xmlæ–‡ä»¶éœ€è¦é‡å¯æœåŠ¡å™¨ï¼</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encoding<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.filter.CharacterEncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>encoding<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encoding<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯æˆ‘ä»¬å‘ç° , æœ‰äº›æç«¯æƒ…å†µä¸‹.è¿™ä¸ªè¿‡æ»¤å™¨å¯¹getçš„æ”¯æŒä¸å¥½ .</p><p>å¤„ç†æ–¹æ³• :</p><p>1ã€ä¿®æ”¹tomcaté…ç½®æ–‡ä»¶ ï¼šè®¾ç½®ç¼–ç ï¼</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">URIEncoding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8080<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>          <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>          <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>2ã€è‡ªå®šä¹‰è¿‡æ»¤å™¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kuang<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequestWrapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">UnsupportedEncodingException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token comment">/*** è§£å†³getå’Œpostè¯·æ±‚ å…¨éƒ¨ä¹±ç çš„è¿‡æ»¤å™¨*/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericEncodingFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>   <span class="token annotation punctuation">@Override</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>   <span class="token annotation punctuation">@Override</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>       <span class="token comment">//å¤„ç†responseçš„å­—ç¬¦ç¼–ç </span>       <span class="token class-name">HttpServletResponse</span> myResponse<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> response<span class="token punctuation">;</span>       myResponse<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// è½¬å‹ä¸ºä¸åè®®ç›¸å…³å¯¹è±¡</span>       <span class="token class-name">HttpServletRequest</span> httpServletRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">;</span>       <span class="token comment">// å¯¹requeståŒ…è£…å¢å¼º</span>       <span class="token class-name">HttpServletRequest</span> myrequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyRequest</span><span class="token punctuation">(</span>httpServletRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>       chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>myrequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span class="token annotation punctuation">@Override</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//è‡ªå®šä¹‰requestå¯¹è±¡ï¼ŒHttpServletRequestçš„åŒ…è£…ç±»</span><span class="token keyword">class</span> <span class="token class-name">MyRequest</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServletRequestWrapper</span> <span class="token punctuation">{</span>   <span class="token keyword">private</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">;</span>   <span class="token comment">//æ˜¯å¦ç¼–ç çš„æ ‡è®°</span>   <span class="token keyword">private</span> <span class="token keyword">boolean</span> hasEncode<span class="token punctuation">;</span>   <span class="token comment">//å®šä¹‰ä¸€ä¸ªå¯ä»¥ä¼ å…¥HttpServletRequestå¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œä»¥ä¾¿å¯¹å…¶è¿›è¡Œè£…é¥°</span>   <span class="token keyword">public</span> <span class="token class-name">MyRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token keyword">super</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// superå¿…é¡»å†™</span>       <span class="token keyword">this</span><span class="token punctuation">.</span>request <span class="token operator">=</span> request<span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span class="token comment">// å¯¹éœ€è¦å¢å¼ºæ–¹æ³• è¿›è¡Œè¦†ç›–</span>   <span class="token annotation punctuation">@Override</span>   <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment">// å…ˆè·å¾—è¯·æ±‚æ–¹å¼</span>       <span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"post"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token comment">// postè¯·æ±‚</span>           <span class="token keyword">try</span> <span class="token punctuation">{</span>               <span class="token comment">// å¤„ç†postä¹±ç </span>               request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>               e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token comment">// getè¯·æ±‚</span>           <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> parameterMap <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasEncode<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ç¡®ä¿getæ‰‹åŠ¨ç¼–ç é€»è¾‘åªè¿è¡Œä¸€æ¬¡</span>               <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> parameterName <span class="token operator">:</span> parameterMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> parameterMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>parameterName<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token keyword">if</span> <span class="token punctuation">(</span>values <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                           <span class="token keyword">try</span> <span class="token punctuation">{</span>                               <span class="token comment">// å¤„ç†getä¹±ç </span>                               values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>                                      <span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                               e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                          <span class="token punctuation">}</span>                      <span class="token punctuation">}</span>                  <span class="token punctuation">}</span>              <span class="token punctuation">}</span>               hasEncode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>           <span class="token keyword">return</span> parameterMap<span class="token punctuation">;</span>      <span class="token punctuation">}</span>       <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span class="token comment">//å–ä¸€ä¸ªå€¼</span>   <span class="token annotation punctuation">@Override</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> parameterMap <span class="token operator">=</span> <span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> parameterMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>values <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>       <span class="token keyword">return</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å–å›å‚æ•°çš„ç¬¬ä¸€ä¸ªå€¼</span>  <span class="token punctuation">}</span>   <span class="token comment">//å–æ‰€æœ‰å€¼</span>   <span class="token annotation punctuation">@Override</span>   <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getParameterValues</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> parameterMap <span class="token operator">=</span> <span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> parameterMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> values<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªä¹Ÿæ˜¯æˆ‘åœ¨ç½‘ä¸Šæ‰¾çš„ä¸€äº›å¤§ç¥å†™çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSpringMVCé»˜è®¤çš„ä¹±ç å¤„ç†å°±å·²ç»èƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³äº†ï¼</p><p><strong>ç„¶ååœ¨web.xmlä¸­é…ç½®è¿™ä¸ªè¿‡æ»¤å™¨å³å¯ï¼</strong></p><p>ä¹±ç é—®é¢˜ï¼Œéœ€è¦å¹³æ—¶å¤šæ³¨æ„ï¼Œåœ¨å°½å¯èƒ½èƒ½è®¾ç½®ç¼–ç çš„åœ°æ–¹ï¼Œéƒ½è®¾ç½®ä¸ºç»Ÿä¸€ç¼–ç  UTF-8ï¼</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nginx</title>
      <link href="2021/05/23/nginx/"/>
      <url>2021/05/23/nginx/</url>
      
        <content type="html"><![CDATA[<h1 id="NIGNX"><a href="#NIGNX" class="headerlink" title="NIGNX"></a>NIGNX</h1><h2 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. åŸºæœ¬æ¦‚å¿µ"></a>1. åŸºæœ¬æ¦‚å¿µ</h2><h3 id="1-1-æ­£å‘ä»£ç†"><a href="#1-1-æ­£å‘ä»£ç†" class="headerlink" title="1.1 æ­£å‘ä»£ç†"></a>1.1 æ­£å‘ä»£ç†</h3><p>éœ€è¦æˆ‘ä»¬è‡ªå·±é…ç½®ä»£ç†æœåŠ¡å™¨ï¼Œæˆ‘ä»¬çš„è¯·æ±‚éƒ½ç»è¿‡ä»£ç†æœåŠ¡å™¨ï¼Œè¿™ä¸ªå«åšæ­£å‘ä»£ç†ã€‚</p><h3 id="1-2-åå‘ä»£ç†"><a href="#1-2-åå‘ä»£ç†" class="headerlink" title="1.2 åå‘ä»£ç†"></a>1.2 åå‘ä»£ç†</h3><p>å®¢æˆ·ç«¯å¯¹ä»£ç†æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦åšä»»ä½•é…ç½®ã€‚æœåŠ¡å™¨æ–¹å¯¹å¤–æš´éœ²åå‘ä»£ç†æœåŠ¡å™¨çš„åœ°å€ï¼Œç„¶åå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ç›´æ¥ä¸åå‘ä»£ç†æœåŠ¡å™¨äº¤äº’ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ä¼šæ ¹æ®è¯·æ±‚å»å’Œè¦è¯·æ±‚çš„æœåŠ¡å™¨å°½å¿ƒäº¤äº’ï¼Œå†å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><h3 id="1-3-è´Ÿè½½å‡è¡¡"><a href="#1-3-è´Ÿè½½å‡è¡¡" class="headerlink" title="1.3 è´Ÿè½½å‡è¡¡"></a>1.3 è´Ÿè½½å‡è¡¡</h3><p>é€šè¿‡ä»£ç†æœåŠ¡å™¨ï¼Œå°†è¯·æ±‚å¹³å‡åˆ†åˆ°ä»£ç†æœåŠ¡å™¨ä¸­ã€‚</p><ol><li><p>nginx çš„ upstreamç›®å‰æ”¯æŒ 4 ç§æ–¹å¼çš„åˆ†é…<br>1)ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2)ã€weight</p><pre class="line-numbers language-none"><code class="language-none">æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2)ã€ip_hash</p><pre class="line-numbers language-none"><code class="language-none">æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3)ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4)ã€url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰</p></li></ol><h3 id="1-4-åŠ¨é™åˆ†ç¦»"><a href="#1-4-åŠ¨é™åˆ†ç¦»" class="headerlink" title="1.4 åŠ¨é™åˆ†ç¦»"></a>1.4 åŠ¨é™åˆ†ç¦»</h3><p>ä¸ºäº†åŠ å¿«ç½‘ç«™çš„è§£æé€Ÿåº¦ï¼Œå¯ä»¥æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç”±ä¸åŒçš„æœåŠ¡å™¨æ¥è§£æï¼ŒåŠ å¿«è§£æé€Ÿåº¦ï¼Œé™ä½åŸæ¥å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><p><img src="/2021/05/23/nginx/%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB.PNG"></p><h2 id="2-nginx-å¸¸ç”¨å‘½ä»¤"><a href="#2-nginx-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2. nginx å¸¸ç”¨å‘½ä»¤"></a>2. nginx å¸¸ç”¨å‘½ä»¤</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‰æå¿…é¡»è¿›å…¥nginxçš„ç›®å½•ä¸­</span><span class="token comment"># nginx ç‰ˆæœ¬</span>./nginx -v<span class="token comment"># å…³é—­nginx å‘½ä»¤</span>./nginx -s stop<span class="token comment"># é‡æ–°åŠ è½½ nginx</span>./nginx -s reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-nginx-é…ç½®æ–‡ä»¶"><a href="#3-nginx-é…ç½®æ–‡ä»¶" class="headerlink" title="3. nginx é…ç½®æ–‡ä»¶"></a>3. nginx é…ç½®æ–‡ä»¶</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¿®æ”¹ nginx.conf ä¸€èˆ¬åœ¨/usr/local/nginx/conf/nginx.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå…¨å±€å—ã€eventså—ã€HTTPå—ã€‚</p><p>å…¨å±€å—ä¸­ï¼Œä»é…ç½®æ–‡ä»¶å¼€å§‹åˆ°eventså—ä¹‹é—´çš„å†…å®¹</p><h3 id="3-1-å…¨å±€éƒ¨åˆ†"><a href="#3-1-å…¨å±€éƒ¨åˆ†" class="headerlink" title="3.1 å…¨å±€éƒ¨åˆ†"></a>3.1 å…¨å±€éƒ¨åˆ†</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">worker_process <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment"># è¿™æ˜¯nginxæœåŠ¡å™¨å¹¶å‘å¤„ç†æœåŠ¡çš„å…³é”®é…ç½®ï¼Œworker_processå€¼è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒçš„å¹¶å‘å¤„ç†é‡è¶Šå¤šï¼Œä½†æ˜¯å—åˆ°ç¡¬ä»¶ã€è½¯ä»¶ç­‰è®¾å¤‡çš„åˆ¶çº¦ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="3-2-eventså—"><a href="#3-2-eventså—" class="headerlink" title="3.2 eventså—"></a>3.2 eventså—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸»è¦æ˜¯nginxæœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ã€‚</span>events <span class="token punctuation">{</span>worker_connections <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment"># æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-httpå—"><a href="#3-3-httpå—" class="headerlink" title="3.3 httpå—"></a>3.3 httpå—</h3><h4 id="3-3-1-å…¨å±€å—"><a href="#3-3-1-å…¨å±€å—" class="headerlink" title="3.3.1 å…¨å±€å—"></a>3.3.1 å…¨å±€å—</h4><p>æŒ‡ä»¤åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€MIME-TYPEå®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€å•é“¾æ¥è¯·æ±‚æ•°ä¸Šé™ç­‰ã€‚</p><h4 id="3-3-2-serverå—"><a href="#3-3-2-serverå—" class="headerlink" title="3.3.2 serverå—"></a>3.3.2 serverå—</h4><p>å’Œè™šæ‹Ÿä¸»æœºæœ‰å¯†åˆ‡å…³ç³»ã€‚</p><p>æ¯ä¸ªhttpå—å¯ä»¥åŒ…æ‹¬å¤šä¸ªserverå—ï¼Œè€Œæ¯ä¸ªserverå—ç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚</p><p>æ¯ä¸ªserverå¿«å¯ä»¥åˆ†ä¸ºå…¨å±€serverå—ï¼Œä»¥åŠå¯ä»¥åŒæ—¶åŒ…å«å¤šä¸ªlocationå—ã€‚</p><ol><li><p>å…¨å±€serverå—</p><p>é…ç½®æœ¬è™šæ‹Ÿä¸»æœºçš„ç›‘å¬é…ç½®å’Œæœ¬è™šæ‹Ÿä¸»æœºçš„åç§°å’ŒIPé…ç½®ã€‚</p></li><li><p>locationå—</p><p>ä¸€ä¸ªserveå—å¯ä»¥é…ç½®å¤šä¸ªlocationå—ã€‚</p><p>è¿™å—çš„ä¸»è¦ä½œç”¨æ˜¯åŸºäºnginxæœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ server_name/uri-stringï¼‰ï¼Œå¯¹è™šæ‹Ÿä¸»æœºåç§°ï¼ˆä¹Ÿå¯ä»¥æ˜¯IPåˆ«åï¼‰ä¹‹å¤–çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚å‰é¢çš„ /uri-stringï¼‰è¿›è¡ŒåŒ¹é…ï¼Œå¯¹ç‰¹å®šçš„è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚åœ°å€å®šå‘ã€æ•°æ®ç¼“å†²å’Œåº”ç­”æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œè¿˜æœ‰è®¸å¤šç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ä¹Ÿåœ¨è¿™é‡Œè¿›è¡Œã€‚</p></li></ol><h2 id="4-é«˜å¯ç”¨"><a href="#4-é«˜å¯ç”¨" class="headerlink" title="4. é«˜å¯ç”¨"></a>4. é«˜å¯ç”¨</h2><p><img src="/2021/05/23/nginx/%E9%AB%98%E5%8F%AF%E7%94%A8.PNG"></p><p>éœ€è¦ä¸¤å°nginxæœåŠ¡å™¨ã€‚</p><p>éœ€è¦keepalivedã€‚</p><p>éœ€è¦è™šæ‹Ÿipã€‚</p><h2 id="5-åŸç†"><a href="#5-åŸç†" class="headerlink" title="5. åŸç†"></a>5. åŸç†</h2><ol><li>nginxå¯åŠ¨åæœ‰masterå’Œworkerã€‚</li></ol><p><img src="/2021/05/23/nginx/%E5%8E%9F%E7%90%86.PNG"></p><ol start="2"><li>workerçš„å·¥ä½œæœºåˆ¶ï¼š</li></ol><p><img src="/2021/05/23/nginx/worker%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6.PNG"></p><ol start="3"><li><p><img src="/2021/05/23/nginx/1\blog\source_posts\nginx\format,png" alt="Nginxåº•å±‚åŸç†ï¼šä¸€æ–‡è§£æNginxä¸ºä»€ä¹ˆå¹¶å‘æ•°å¯ä»¥è¾¾åˆ°3wï¼"></p></li><li><p>ä¸€ä¸ªmasterå¤šä¸ªworkerçš„å¥½å¤„ï¼š</p></li><li><p>å¯ä»¥ä½¿ç”¨ nginx -s reload çƒ­éƒ¨ç½²ã€‚</p></li><li><p>å¯¹äºæ¯ä¸ªworkeræ˜¯ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸éœ€è¦åŠ é”ã€‚</p></li><li><p>å¤šè·¯å¤ç”¨æœºåˆ¶ã€‚ï¼ˆwindowsä¸­æ²¡æœ‰ï¼Œlinuxä¸­æœ‰ï¼‰ã€‚workeræ•°å’Œcpuæ•°ç›¸ç­‰æ˜¯æœ€åˆé€‚çš„ï¼Œå› ä¸ºæ¯ä¸ªworkeréƒ½å¯ä»¥æŠŠcpuæ€§èƒ½å‘æŒ¥åˆ°æè‡´ã€‚</p></li><li><p>å¤šå°‘è¿æ¥æ•°æœ€åˆé€‚</p></li><li><p>å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå ç”¨äº†workerçš„å‡ ä¸ªè¿æ¥æ•°ï¼Ÿ</p></li></ol><p>æ¯æ¬¡è¯·æ±‚æœ‰å’Œå®¢æˆ·ç«¯çš„å‘é€è¿æ¥å’Œæ¥æ”¶è¿æ¥ï¼Œç„¶åworkerè¿˜è¦å’Œtomcatäº¤äº’ä¹Ÿæœ‰ä¸¤ä¸ªè¿æ¥ï¼Œæ‰€ä»¥å¯ä»¥è¯´æˆå ç”¨4ä¸ªè¿æ¥æ•°ï¼Œä¹Ÿå¯ä»¥è¯´æˆä¸¤ä¸ªï¼ˆé™æ€è®¿é—®ï¼‰ã€‚</p><ol start="2"><li>nginxæœ‰ä¸€ä¸ªmasterï¼Œå››ä¸ªworkerï¼Œæ¯ä¸ªworkeræ”¯æŒæœ€å¤§è¿æ¥æ•°1024ã€‚é—®æ”¯æŒçš„<strong>æœ€å¤§å¹¶å‘æ•°å¤šå°‘</strong>ï¼Ÿ</li></ol><pre><code>æœ€å¤§è¿æ¥æ•° 4 * 1024 / 2ï¼ˆé™æ€è®¿é—®ï¼‰æˆ– 4 ï¼ˆåå‘ä»£ç†ï¼Œéœ€è¦è®¿é—®tomcatï¼‰= å¹¶å‘æ•°</code></pre><h2 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h2><h3 id="1-å¯åŠ¨-Nginx"><a href="#1-å¯åŠ¨-Nginx" class="headerlink" title="1.å¯åŠ¨ Nginx"></a>1.å¯åŠ¨ Nginx</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">systemctl start nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-åœæ­¢-Nginx"><a href="#2-åœæ­¢-Nginx" class="headerlink" title="2.åœæ­¢ Nginx"></a>2.åœæ­¢ Nginx</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">systemctl stop nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-é‡å¯-Nginx"><a href="#3-é‡å¯-Nginx" class="headerlink" title="3.é‡å¯ Nginx"></a>3.é‡å¯ Nginx</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">systemctl restart nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-æŸ¥çœ‹-Nginx-çŠ¶æ€"><a href="#4-æŸ¥çœ‹-Nginx-çŠ¶æ€" class="headerlink" title="4.æŸ¥çœ‹ Nginx çŠ¶æ€"></a>4.æŸ¥çœ‹ Nginx çŠ¶æ€</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">systemctl status nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5-å¯ç”¨å¼€æœºå¯åŠ¨-Nginx"><a href="#5-å¯ç”¨å¼€æœºå¯åŠ¨-Nginx" class="headerlink" title="5.å¯ç”¨å¼€æœºå¯åŠ¨ Nginx"></a>5.å¯ç”¨å¼€æœºå¯åŠ¨ Nginx</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">systemctl enable nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="6-ç¦ç”¨å¼€æœºå¯åŠ¨-Nginx"><a href="#6-ç¦ç”¨å¼€æœºå¯åŠ¨-Nginx" class="headerlink" title="6.ç¦ç”¨å¼€æœºå¯åŠ¨ Nginx"></a>6.ç¦ç”¨å¼€æœºå¯åŠ¨ Nginx</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">systemctl disable nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å®‰è£…-Nginx"><a href="#å®‰è£…-Nginx" class="headerlink" title="å®‰è£… Nginx"></a>å®‰è£… Nginx</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">sudo yum install <span class="token operator">-</span>y nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®‰è£…æˆåŠŸåï¼Œé»˜è®¤çš„ç½‘ç«™ç›®å½•ä¸ºï¼š /usr/share/nginx/html</p><p>é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸ºï¼š/etc/nginx/nginx.conf</p><p>è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç›®å½•ä¸º: /etc/nginx/conf.d/</p>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>springboot</title>
      <link href="2021/05/19/springboot/"/>
      <url>2021/05/19/springboot/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><h2 id="1-1-è‡ªåŠ¨è£…é…åŸç†"><a href="#1-1-è‡ªåŠ¨è£…é…åŸç†" class="headerlink" title="1.1 è‡ªåŠ¨è£…é…åŸç†"></a>1.1 è‡ªåŠ¨è£…é…åŸç†</h2><ol><li>springbootåœ¨å¯åŠ¨æ—¶ï¼Œä»ç±»è·¯å¾„ä¸‹/META-INF/spring.factories è·å–æŒ‡å®šçš„å€¼ã€‚</li><li>å°†è¿™äº›è‡ªåŠ¨é…ç½®çš„ç±»å¯¼å…¥å®¹å™¨ï¼Œè‡ªåŠ¨é…ç½®å°±ä¼šç”Ÿæ•ˆï¼Œå¸®æˆ‘è¿›è¡Œè‡ªåŠ¨é…ç½®</li><li>ä»¥å‰éœ€è¦è‡ªåŠ¨é…ç½®çš„ä¸œè¥¿ï¼Œspringbootå¸®æˆ‘ä»¬åšäº†ã€‚</li><li>æ•´åˆjavaEEè§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨é…ç½®çš„ä¸œè¥¿éƒ½åœ¨<code>springbootautoconfiguration</code>ä¸‹é¢</li></ol><h2 id="2-yaml"><a href="#2-yaml" class="headerlink" title="2 yaml"></a>2 yaml</h2><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># æ™®é€š</span><span class="token key atrule">name</span><span class="token punctuation">:</span> qinjiang<span class="token comment"># å¯¹è±¡</span><span class="token key atrule">student</span><span class="token punctuation">:</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> qinjiang  age<span class="token punctuation">:</span><span class="token number">3</span><span class="token comment"># è¡Œå†…å†™æ³•</span><span class="token key atrule">student</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> qinjiang<span class="token punctuation">,</span> <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token comment"># æ•°ç»„</span><span class="token key atrule">pets</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> cat  <span class="token punctuation">-</span> dog  <span class="token punctuation">-</span> pig  <span class="token key atrule">pets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>cat<span class="token punctuation">,</span>dog<span class="token punctuation">,</span>pig<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-Shiro"><a href="#3-Shiro" class="headerlink" title="3. Shiro"></a>3. Shiro</h2><p>ä¸€ä¸ªJavaå®‰å…¨ï¼ˆæƒé™ï¼‰æ¡†æ¶ã€‚</p><p><img src="/2021/05/19/springboot/shiro%E7%BB%93%E6%9E%84.PNG"></p><ul><li>subjectï¼šç›´æ¥äº¤äº’çš„å¯¹è±¡æ˜¯subjectã€‚</li><li>SecurityManagerï¼šå®‰å…¨ç®¡ç†å™¨ï¼Œæ‰€æœ‰ä¸å®‰å…¨ç›¸å…³çš„æ“ä½œéƒ½ä¸æ­¤äº¤äº’ï¼Œå¹¶ä¸”ç®¡ç†æ‰€æœ‰çš„Subjectï¼Œç›¸å½“äºSpringMVCä¸­çš„DispatcherServletçš„è§’è‰²ã€‚</li><li>Realmï¼šShiroä»Realmè·å–å®‰å…¨æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ï¼Œè§’è‰²ï¼Œæƒé™ï¼‰ï¼Œå°±æ˜¯è¯´SecurityManagerè¦éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé‚£ä¹ˆå®ƒéœ€è¦ä»Realmè·å–ç›¸åº”çš„ç”¨æˆ·è¿›è¡Œæ¯”è¾ƒï¼Œæ¥ç¡®å®šç”¨æˆ·çš„èº«ä»½æ˜¯å¦åˆæ³•ï¼Œå¯ä»¥æŠŠRealmçœ‹æˆæ˜¯DataSourceã€‚</li></ul><h2 id="4-RestTemplate"><a href="#4-RestTemplate" class="headerlink" title="4.RestTemplate"></a>4.RestTemplate</h2><p>æä¾›äº†å¤šç§ä¾¿æ·è®¿é—®è¿œç¨‹HttpæœåŠ¡çš„æ–¹æ³•ã€‚</p><p>æ˜¯ä¸€ç§ç®€å•ä¾¿æ·çš„è®¿é—®resfulæœåŠ¡æ¨¡æ¿ç±»ï¼Œæ˜¯Springæä¾›çš„ç”¨äºè®¿é—®RestæœåŠ¡çš„å®¢æˆ·ç«¯æ¨¡æ¿å·¥å…·é›†ã€‚</p><p>ï¼ˆurlï¼ŒrequestMapï¼ŒResponseBean.classï¼‰è¿™ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨ï¼š</p><p>Restè¯·æ±‚åœ°å€ã€è¯·æ±‚å‚æ•°ã€HTTPå“åº”è½¬æ¢è¢«è½¬æ¢æˆçš„å¯¹è±¡ç±»å‹ã€‚</p><h2 id="1ã€-é¢è¯•é¢˜æ€»ç»“springboot"><a href="#1ã€-é¢è¯•é¢˜æ€»ç»“springboot" class="headerlink" title="1ã€ é¢è¯•é¢˜æ€»ç»“springboot"></a>1ã€ é¢è¯•é¢˜æ€»ç»“springboot</h2><h3 id="1-1-springbootçš„è£…é…åŸç†"><a href="#1-1-springbootçš„è£…é…åŸç†" class="headerlink" title="1.1 springbootçš„è£…é…åŸç†"></a>1.1 springbootçš„è£…é…åŸç†</h3><p>springbootçš„è£…é…åŸç†ä¸»è¦æ˜¯javaçš„SPIæœºåˆ¶ï¼Œå¯ä»¥ä»å®ƒçš„å¯åŠ¨å…¥å£<code>SpringBootApplicationConfiguration</code>æ¥çœ‹ï¼Œè¿™ä¸ªæ³¨è§£ä¸Šæœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ³¨è§£ï¼š<code>@ComponentScan</code>ã€<code>@EnableAutoConfiguration</code>ã€<code>@Confuguration</code>ã€‚</p><ol><li><p>@ComponentScan è¿™ä¸ªæ³¨è§£å¯ä»¥å°†æˆ‘ä»¬çš„ä»£ç ä¸­æ ‡æ³¨ @service @controllerç­‰çš„ç±»æ”¾åˆ°IOCå®¹å™¨ä¸­ã€‚</p></li><li><p>@Configuration è¿™ä¸ªæ³¨è§£å…è®¸åœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„beanæˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±»ã€‚</p></li><li><p>@EnableAutoConfiguration è¿™ä¸ªæ³¨è§£å¾ˆé‡è¦ï¼Œå®ƒå®ç°äº†æˆ‘ä»¬çš„è‡ªåŠ¨è£…é…æœºåˆ¶ã€‚</p><p>åœ¨è¿™ä¸ªæ³¨è§£ä¸Šï¼Œæœ‰@AutoConfigurationImportSelector.class è¿™ä¸ªç±»çš„ï¼Œè¿™ä¸ªç±»å®ƒåˆç»§æ‰¿äº†ImportSelectorè¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¸­çš„æ–¹æ³•è·å–äº†ç¬¦åˆæ¡ä»¶çš„ç±»çš„å…¨é™å®šç±»åï¼Œè¿™äº›ç±»è¢«åŠ è½½åˆ°IoCå®¹å™¨ä¸­ã€‚</p><p>å®ƒçš„è¿è¡Œæµç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼š</p><ol><li>åˆ¤æ–­è‡ªåŠ¨è£…é…çš„å¼€å…³æ˜¯å¦æ‰“å¼€ã€‚</li><li>è·å–<code>EnableAutoConfiguration</code>æ³¨è§£ä¸­çš„<code>exclude</code>å’Œ<code>excludeName</code>ã€‚</li><li>è·å–éœ€è¦è‡ªåŠ¨è£…é…çš„æ‰€æœ‰é…ç½®ç±»ï¼Œè¯»å–<code>META-INF/spring.factories</code>ã€‚è¯»å–é…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰ç»„ä»¶ä¿¡æ¯ã€‚</li><li>@ConditionOnXXX ä¸­æ‰€æœ‰æ¡ä»¶çš„éƒ½æ»¡è¶³ï¼Œè¯¥ç±»æ‰ä¼šç”Ÿæ•ˆã€‚</li></ol></li></ol><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><h3 id="1-1-springæ˜¯ä¸€ç§è½»é‡çº§çš„å¼€å‘æ¡†æ¶ï¼Œå®ƒæœ‰å¾ˆå¤šæ¨¡å—ã€‚"><a href="#1-1-springæ˜¯ä¸€ç§è½»é‡çº§çš„å¼€å‘æ¡†æ¶ï¼Œå®ƒæœ‰å¾ˆå¤šæ¨¡å—ã€‚" class="headerlink" title="1.1 springæ˜¯ä¸€ç§è½»é‡çº§çš„å¼€å‘æ¡†æ¶ï¼Œå®ƒæœ‰å¾ˆå¤šæ¨¡å—ã€‚"></a>1.1 springæ˜¯ä¸€ç§è½»é‡çº§çš„å¼€å‘æ¡†æ¶ï¼Œå®ƒæœ‰å¾ˆå¤šæ¨¡å—ã€‚</h3><ol><li>æ ¸å¿ƒæ¨¡å—ã€‚ å…¶ä¸­æœ‰coreç»„ä»¶æ˜¯æ‰€æœ‰ç»„ä»¶çš„æ ¸å¿ƒï¼Œä¸»è¦æä¾›IOCä¾èµ–æ³¨å…¥åŠŸèƒ½ã€‚</li><li>AOPï¼šæä¾›äº†åˆ‡é¢ç¼–ç¨‹çš„å®ç°ã€‚</li><li>æ•°æ®é›†æˆï¼šJDBCç­‰æ•°æ®åº“çš„è¿æ¥ã€‚</li><li>Testï¼šæä¾›äº†å¯¹Junitå’ŒTestNGæµ‹è¯•çš„æ”¯æŒã€‚</li><li>webï¼šåˆ›å»ºwebåº”ç”¨æä¾›äº†æ”¯æŒã€‚</li><li></li></ol><h3 id="1-2-springçš„å…­å¤§ç‰¹å¾"><a href="#1-2-springçš„å…­å¤§ç‰¹å¾" class="headerlink" title="1.2 springçš„å…­å¤§ç‰¹å¾"></a>1.2 springçš„å…­å¤§ç‰¹å¾</h3><ol><li>æ ¸å¿ƒæŠ€æœ¯ï¼š ä¾èµ–æ³¨å…¥ã€AOPï¼Œèµ„æºï¼ŒéªŒè¯ï¼Œi18nã€‚ã€‚ã€‚</li><li>æµ‹è¯•ï¼šæ¨¡æ‹Ÿå¯¹è±¡ï¼ŒTestContextæ¡†æ¶ï¼ŒSpring MVCæµ‹è¯•ï¼ŒWebTestClientã€‚</li><li>æ•°æ®è®¿é—®ï¼šäº‹åŠ¡ï¼ŒDAOæ”¯æŒï¼ŒJDBCï¼ŒORMï¼Œç»„ä»¶XMLã€‚</li><li>Webæ”¯æŒï¼š Spring MVC å’Œ Spring WebFlux Webæ¡†æ¶ã€‚</li><li>é›†æˆï¼šè¿œç¨‹å¤„ç†ï¼ŒJMSï¼ŒJCAï¼ŒJMXï¼Œç”µå­é‚®ä»¶ï¼Œä»»åŠ¡ï¼Œè°ƒåº¦ï¼Œç¼“å­˜ã€‚</li><li>è¯­è¨€ï¼šKotlinï¼ŒGroovyï¼ŒåŠ¨æ€è¯­è¨€ã€‚</li></ol><h3 id="1-3-RestController-Controller"><a href="#1-3-RestController-Controller" class="headerlink" title="1.3 @RestController @Controller"></a>1.3 @RestController @Controller</h3><p>Controllerè¿”å›ä¸€ä¸ªé¡µé¢ï¼Œè¿™æ˜¯å‰åç«¯ä¸åˆ†ç¦»ï¼Œä¼ ç»Ÿçš„SpringMVCçš„å¼€å‘æ–¹å¼ã€‚</p><p>@RestController = @Controller + @ResponseBody ã€‚è¿”å›jsonæˆ–xmlã€‚</p><h3 id="1-4-IOCå’ŒAOPçš„ç†è§£"><a href="#1-4-IOCå’ŒAOPçš„ç†è§£" class="headerlink" title="1.4 IOCå’ŒAOPçš„ç†è§£"></a>1.4 IOCå’ŒAOPçš„ç†è§£</h3><p>IOCæ˜¯ä¸ªå®¹å™¨ï¼Œåº•å±‚å…¶å®å°±æ˜¯ä¸ªmap&lt;K,V&gt;å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œæ˜¯ç”¨concurrentHashMapå®ç°çš„ã€‚å®ƒæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„ç®¡ç†äº¤ç»™å®¹å™¨ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œä¸€ä¸ªserviceå¾€å¾€åº•å±‚ä¾èµ–å¾ˆå¤šå…¶ä»–ç±»ï¼Œè¿™å¯¹ç¨‹åºå‘˜æ¥è¯´ç®¡ç†å¯¹è±¡æ˜¯ä¸€ç§ç¾éš¾ã€‚Springæ˜¯ç”¨xmlé…ç½®ç®¡ç†å¯¹è±¡ï¼Œåæ¥xmlé…ç½®è¿‡äºç¹æ‚ï¼Œå¼€å‘äº†springbootç®€åŒ–é…ç½®ã€‚</p><p>å®ƒçš„åˆå§‹åŒ–è¿‡ç¨‹æ˜¯ï¼š</p><ol><li>æŸ¥æ‰¾XMLæ–‡ä»¶ã€‚</li><li>å°†XMLæ–‡ä»¶è¯»å–æˆResourceã€‚</li><li>å°†resourceè§£ææˆBeanDefinationã€‚</li><li>æ³¨å†ŒBeanFactoryã€‚è¿™å°±æœ‰äº†beanã€‚</li></ol><p>AOP åŠ¨æ€ä»£ç†å®ç°çš„ã€‚å¦‚æœè¢«ä»£ç†çš„ç±»å®ç°äº†æ¥å£ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨JDKä»£ç†ã€‚å¦‚æœæ²¡æœ‰æ¥å£ï¼Œå°±ä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†ã€‚åŠ¨æ€ä»£ç†å¯ä»¥å¤ç”¨ä»£ç å¹¶ä¸”å‡å°‘è€¦åˆåº¦ã€‚</p><h3 id="1-5-SpringAOPå’ŒAspect-AOPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-5-SpringAOPå’ŒAspect-AOPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1.5 SpringAOPå’ŒAspect AOPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>1.5 SpringAOPå’ŒAspect AOPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>è¿™ä¸¤åŠŸèƒ½ç±»ä¼¼åšåˆ‡é¢ç¼–ç¨‹çš„ã€‚å¦‚æœåˆ‡é¢è¾ƒå°‘ï¼Œé‚£ä¹ˆä»–ä¸¤å·®ä¸å¤šï¼Œåˆ‡é¢è¾ƒå¤šï¼Œæœ€å¥½æ˜¯Aspect AOPï¼Œå› ä¸ºæ›´å¿«ã€‚</p><p>Springæ˜¯è¿è¡Œæ—¶å¢å¼ºï¼Œè€ŒAspect AOPæ˜¯ç¼–è¯‘æ—¶å¢å¼ºã€‚springåŸºäºä»£ç†ï¼ŒAspectåŸºäºå­—èŠ‚ç æ“ä½œã€‚springç›¸å¯¹Aspectæ¯”è¾ƒç®€å•ã€‚</p><h3 id="1-6-Spring-beançš„ä½œç”¨åŸŸã€‚"><a href="#1-6-Spring-beançš„ä½œç”¨åŸŸã€‚" class="headerlink" title="1.6 Spring beançš„ä½œç”¨åŸŸã€‚"></a>1.6 Spring beançš„ä½œç”¨åŸŸã€‚</h3><ul><li>singletonï¼šå”¯ä¸€çš„beanå®ä¾‹ï¼ŒSpringä¸­çš„beané»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</li><li>prototypeï¼šæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚</li><li>requestï¼šæ¯æ¬¡HTTPè¯·æ±‚éƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„beanï¼Œå¹¶ä¸”ä»…åœ¨å½“å‰HTTP requestå†…æœ‰æ•ˆã€‚</li><li>sessionï¼š æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªbeanï¼Œå°½åœ¨sessionæœ‰æ•ˆã€‚</li><li>global-sessionï¼šå…¨å±€sessionä½œç”¨åŸŸï¼Œä»…ä»…åœ¨åŸºäºportletçš„webåº”ç”¨ä¸­æ‰æœ‰æ„ä¹‰ï¼ŒSpring5å·²ç»æ²¡æœ‰äº†ã€‚</li></ul><h3 id="1-7-beançš„çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#1-7-beançš„çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="1.7 beançš„çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>1.7 beançš„çº¿ç¨‹å®‰å…¨ï¼Ÿ</h3><p>å½“å¤šä¸ªçº¿ç¨‹å¯¹å½“å‰beanæ“ä½œï¼Œè¿™ä¸ªæˆå‘˜å˜é‡çš„å†™æ“ä½œä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¸¸ç”¨Controller service è¿™äº›beanæ˜¯æ— çŠ¶æ€çš„ã€‚æ— çŠ¶æ€çš„beanä¸ä¿å­˜æ•°æ®ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>è§£å†³çº¿ç¨‹å®‰å…¨ï¼š</p><ol><li><p>å¯ä»¥é€šè¿‡åœ¨ç±»ä¸­å®šä¹‰ThreadLocalå˜é‡ï¼Œå°†å¯èƒ½è®¿é—®çš„å˜é‡æ”¾åˆ°threalocalä¸­ã€‚</p></li><li><p>æ›´æ”¹beançš„ä½œç”¨åŸŸä¸ºprototypeã€‚</p></li></ol><h3 id="1-8-Componentå’Œ-Beançš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#1-8-Componentå’Œ-Beançš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="1.8 @Componentå’Œ@Beançš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"></a>1.8 @Componentå’Œ@Beançš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</h3><ol><li>Componentæ³¨è§£ç”¨äºç±»ï¼Œbeanç”¨äºæ–¹æ³•ã€‚</li><li>componenté€šå¸¸é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨ä¾¦æµ‹ä»¥åŠè‡ªåŠ¨è£…é…åˆ°springå®¹å™¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨@ComponentScanæ³¨è§£å®šä¹‰è¦æ‰«æçš„è·¯å¾„ä»ä¸­æ‰¾å‡ºéœ€è¦è£…é…çš„ç±»è‡ªåŠ¨è£…é…åˆ°springçš„beanå®¹å™¨ä¸­ï¼‰ã€‚@Beanæ³¨è§£é€šå¸¸æ˜¯æˆ‘ä»¬åœ¨æ ‡æœ‰è¯¥æ³¨è§£çš„æ–¹æ³•ä¸­å®šä¹‰äº§ç”Ÿbeanï¼Œ@Beanå‘Šè¯‰Springè¿™æ˜¯æŸä¸ªç±»çš„ç¤ºä¾‹ï¼Œåœ¨æˆ‘éœ€è¦å®ƒçš„æ—¶å€™æŠŠä»–ç»™æˆ‘ã€‚</li><li>Beançš„è‡ªå®šä¹‰æ€§æ›´å¼ºï¼Œè€Œä¸”å¾ˆå¤šåœ°æ–¹åªèƒ½é€šè¿‡@Beanæ³¨è§£æ¥æ³¨å†Œbeanã€‚æ¯”å¦‚å½“æˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»éœ€è¦è£…é…åˆ°springå®¹å™¨æ—¶ï¼Œåªèƒ½é€šè¿‡@Beanæ¥å®ç°ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯é«˜å¯ç”¨</title>
      <link href="2021/05/18/shi-me-shi-gao-ke-yong/"/>
      <url>2021/05/18/shi-me-shi-gao-ke-yong/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨"><a href="#ä»€ä¹ˆæ˜¯é«˜å¯ç”¨" class="headerlink" title="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨"></a>ä»€ä¹ˆæ˜¯é«˜å¯ç”¨</h1><p>ä¸ºä»€ä¹ˆå°±ä¸è¯´äº†å§ï¼Œç³»ç»Ÿéƒ½è¦ä¿è¯è¿™ä¸€ç‚¹çš„ï¼Œå¦åˆ™ç»å¸¸å¥”æºƒé‚£è¿™ç³»ç»Ÿè¿˜èƒ½ç”¨å—ï¼Ÿ</p><h2 id="1-æ˜¯ä»€ä¹ˆ"><a href="#1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1. æ˜¯ä»€ä¹ˆ"></a>1. æ˜¯ä»€ä¹ˆ</h2><p>é«˜å¯ç”¨HA(High Availability)æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡ç§å¿…é¡»è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ã€‚æŒ‡é€šè¿‡è®¾è®¡å‡å°‘ç³»ç»Ÿä¸å¯ç”¨çš„æ—¶é—´ã€‚</p><p>å¦‚æœç³»ç»Ÿèƒ½å¤Ÿä¸€ç›´æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„å¯ç”¨æ€§æ˜¯100%ã€‚å¦‚æœç³»ç»Ÿæ¯è¿è¡Œ100ä¸ªæ—¶é—´å•ä½ï¼Œä¼šæœ‰1ä¸ªæ—¶é—´å•ä½æ— æ³•æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆå¯ç”¨æ€§æ˜¯99%ã€‚</p><h2 id="2-æ€ä¹ˆåš"><a href="#2-æ€ä¹ˆåš" class="headerlink" title="2. æ€ä¹ˆåš"></a>2. æ€ä¹ˆåš</h2><ol><li><p>é¦–å…ˆè¦åšçš„å°±æ˜¯å†—ä½™ã€‚</p><p>é€šè¿‡é›†ç¾¤åŒ–ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œé‚£ä¹ˆå…¶ä»–èŠ‚ç‚¹å¯ä»¥ç»§ç»­æä¾›æœåŠ¡ã€‚</p></li><li><p>è‡ªåŠ¨è½¬ç§»æ•…éšœæœºåˆ¶ã€‚</p><p>æœ‰äº†å†—ä½™ï¼Œå¦‚æœæ¯æ¬¡æ•…éšœéƒ½éœ€è¦äººä¸ºæ¥å…¥é‚£ä¹ˆå¤ªæ‹‰è·¨äº†ã€‚</p></li></ol><p>å¦‚ä½•æ•…éšœè½¬ç§»å‘¢ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†å…¸å‹çš„äº’è”ç½‘æ¶æ„ã€‚</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-b263bfcbf32c4bc0f1326b4faad7afef_720w.jpg" alt="img"></p><p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯å±‚ï¼šå…¸å‹è°ƒç”¨æ–¹æ˜¯æµè§ˆå™¨browseræˆ–è€…æ‰‹æœºåº”ç”¨APP</p><p>ï¼ˆ2ï¼‰åå‘ä»£ç†å±‚ï¼šç³»ç»Ÿå…¥å£ï¼Œåå‘ä»£ç†</p><p>ï¼ˆ3ï¼‰ç«™ç‚¹åº”ç”¨å±‚ï¼šå®ç°æ ¸å¿ƒåº”ç”¨é€»è¾‘ï¼Œè¿”å›htmlæˆ–è€…json</p><p>ï¼ˆ4ï¼‰æœåŠ¡å±‚ï¼šå¦‚æœå®ç°äº†æœåŠ¡åŒ–ï¼Œå°±æœ‰è¿™ä¸€å±‚</p><p>ï¼ˆ5ï¼‰æ•°æ®-ç¼“å­˜å±‚ï¼šç¼“å­˜åŠ é€Ÿè®¿é—®å­˜å‚¨</p><p>ï¼ˆ6ï¼‰æ•°æ®-æ•°æ®åº“å±‚ï¼šæ•°æ®åº“å›ºåŒ–æ•°æ®å­˜å‚¨</p><h2 id="3-æ¯å±‚æ¶æ„çš„é«˜å¯ç”¨"><a href="#3-æ¯å±‚æ¶æ„çš„é«˜å¯ç”¨" class="headerlink" title="3. æ¯å±‚æ¶æ„çš„é«˜å¯ç”¨"></a>3. æ¯å±‚æ¶æ„çš„é«˜å¯ç”¨</h2><h3 id="3-1å®¢æˆ·ç«¯å±‚-gt-åå‘ä»£ç†å±‚çš„é«˜å¯ç”¨"><a href="#3-1å®¢æˆ·ç«¯å±‚-gt-åå‘ä»£ç†å±‚çš„é«˜å¯ç”¨" class="headerlink" title="3.1å®¢æˆ·ç«¯å±‚->åå‘ä»£ç†å±‚çš„é«˜å¯ç”¨"></a>3.1å®¢æˆ·ç«¯å±‚-&gt;åå‘ä»£ç†å±‚çš„é«˜å¯ç”¨</h3><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-59ea4193669f2bbd9b1ad7593f069e44_720w.jpg" alt="img"></p><p>å®¢æˆ·ç«¯å±‚ã€‘åˆ°ã€åå‘ä»£ç†å±‚ã€‘çš„é«˜å¯ç”¨ï¼Œæ˜¯é€šè¿‡åå‘ä»£ç†å±‚çš„å†—ä½™æ¥å®ç°çš„ã€‚ä»¥nginxä¸ºä¾‹ï¼šæœ‰ä¸¤å°nginxï¼Œä¸€å°å¯¹çº¿ä¸Šæä¾›æœåŠ¡ï¼Œå¦ä¸€å°å†—ä½™ä»¥ä¿è¯é«˜å¯ç”¨ï¼Œå¸¸è§çš„å®è·µæ˜¯keepalivedå­˜æ´»æ¢æµ‹ï¼Œç›¸åŒvirtual IPæä¾›æœåŠ¡ã€‚</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-3c99711c68fcc7c1b504768e0e64fa3d_720w.jpg" alt="img"></p><p>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå½“nginxæŒ‚äº†çš„æ—¶å€™ï¼Œkeepalivedèƒ½å¤Ÿæ¢æµ‹åˆ°ï¼Œä¼šè‡ªåŠ¨çš„è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œå°†æµé‡è‡ªåŠ¨è¿ç§»åˆ°shadow-nginxï¼Œç”±äºä½¿ç”¨çš„æ˜¯ç›¸åŒçš„virtual IPï¼Œè¿™ä¸ªåˆ‡æ¢è¿‡ç¨‹å¯¹è°ƒç”¨æ–¹æ˜¯é€æ˜çš„ã€‚</p><h3 id="3-2-åå‘ä»£ç†å±‚-gt-ç«™ç‚¹å±‚-é«˜å¯ç”¨"><a href="#3-2-åå‘ä»£ç†å±‚-gt-ç«™ç‚¹å±‚-é«˜å¯ç”¨" class="headerlink" title="3.2 åå‘ä»£ç†å±‚ -> ç«™ç‚¹å±‚ é«˜å¯ç”¨"></a>3.2 åå‘ä»£ç†å±‚ -&gt; ç«™ç‚¹å±‚ é«˜å¯ç”¨</h3><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-1951d6ea670a6f879b06f62fa0d3223a_720w.jpg" alt="img"></p><p>ã€åå‘ä»£ç†å±‚ã€‘åˆ°ã€ç«™ç‚¹å±‚ã€‘çš„é«˜å¯ç”¨ï¼Œæ˜¯é€šè¿‡ç«™ç‚¹å±‚çš„å†—ä½™æ¥å®ç°çš„ã€‚å‡è®¾åå‘ä»£ç†å±‚æ˜¯nginxï¼Œnginx.confé‡Œèƒ½å¤Ÿé…ç½®å¤šä¸ªwebåç«¯ï¼Œå¹¶ä¸”nginxèƒ½å¤Ÿæ¢æµ‹åˆ°å¤šä¸ªåç«¯çš„å­˜æ´»æ€§ã€‚</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-7fd0f7076902f4534a6debddf2c999d8_720w.jpg" alt="img"></p><p>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå½“web-serveræŒ‚äº†çš„æ—¶å€™ï¼Œnginxèƒ½å¤Ÿæ¢æµ‹åˆ°ï¼Œä¼šè‡ªåŠ¨çš„è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œå°†æµé‡è‡ªåŠ¨è¿ç§»åˆ°å…¶ä»–çš„web-serverï¼Œæ•´ä¸ªè¿‡ç¨‹ç”±nginxè‡ªåŠ¨å®Œæˆï¼Œå¯¹è°ƒç”¨æ–¹æ˜¯é€æ˜çš„ã€‚</p><h3 id="3-3-ç«™ç‚¹å±‚-gt-æœåŠ¡å±‚çš„é«˜å¯ç”¨"><a href="#3-3-ç«™ç‚¹å±‚-gt-æœåŠ¡å±‚çš„é«˜å¯ç”¨" class="headerlink" title="3.3 ç«™ç‚¹å±‚->æœåŠ¡å±‚çš„é«˜å¯ç”¨"></a>3.3 ç«™ç‚¹å±‚-&gt;æœåŠ¡å±‚çš„é«˜å¯ç”¨</h3><p><img src="https://pic2.zhimg.com/80/v2-470b831cc42aa39eda3c98c0078abfb9_720w.jpg" alt="img"></p><p>ã€ç«™ç‚¹å±‚ã€‘åˆ°ã€æœåŠ¡å±‚ã€‘çš„é«˜å¯ç”¨ï¼Œæ˜¯é€šè¿‡æœåŠ¡å±‚çš„å†—ä½™æ¥å®ç°çš„ã€‚â€œæœåŠ¡è¿æ¥æ± â€ä¼šå»ºç«‹ä¸ä¸‹æ¸¸æœåŠ¡å¤šä¸ªè¿æ¥ï¼Œæ¯æ¬¡è¯·æ±‚ä¼šâ€œéšæœºâ€é€‰å–è¿æ¥æ¥è®¿é—®ä¸‹æ¸¸æœåŠ¡ã€‚</p><p><img src="https://pic1.zhimg.com/80/v2-62818fa9f676d50dbd4d9be076cba1dc_720w.jpg" alt="img"></p><p>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå½“serviceæŒ‚äº†çš„æ—¶å€™ï¼Œservice-connection-poolèƒ½å¤Ÿæ¢æµ‹åˆ°ï¼Œä¼šè‡ªåŠ¨çš„è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œå°†æµé‡è‡ªåŠ¨è¿ç§»åˆ°å…¶ä»–çš„serviceï¼Œæ•´ä¸ªè¿‡ç¨‹ç”±è¿æ¥æ± è‡ªåŠ¨å®Œæˆï¼Œå¯¹è°ƒç”¨æ–¹æ˜¯é€æ˜çš„ï¼ˆæ‰€ä»¥è¯´RPC-clientä¸­çš„æœåŠ¡è¿æ¥æ± æ˜¯å¾ˆé‡è¦çš„åŸºç¡€ç»„ä»¶ï¼‰ã€‚</p><h3 id="3-4-æœåŠ¡å±‚-gt-ç¼“å­˜å±‚çš„é«˜å¯ç”¨"><a href="#3-4-æœåŠ¡å±‚-gt-ç¼“å­˜å±‚çš„é«˜å¯ç”¨" class="headerlink" title="3.4 æœåŠ¡å±‚>ç¼“å­˜å±‚çš„é«˜å¯ç”¨"></a>3.4 æœåŠ¡å±‚&gt;ç¼“å­˜å±‚çš„é«˜å¯ç”¨</h3><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-4e031e94cfc8ae0303ac70020e61e4bc_720w.jpg" alt="img"></p><p>ã€æœåŠ¡å±‚ã€‘åˆ°ã€ç¼“å­˜å±‚ã€‘çš„é«˜å¯ç”¨ï¼Œæ˜¯é€šè¿‡ç¼“å­˜æ•°æ®çš„å†—ä½™æ¥å®ç°çš„ã€‚</p><p>ç¼“å­˜å±‚çš„æ•°æ®å†—ä½™åˆæœ‰å‡ ç§æ–¹å¼ï¼šç¬¬ä¸€ç§æ˜¯åˆ©ç”¨å®¢æˆ·ç«¯çš„å°è£…ï¼Œserviceå¯¹cacheè¿›è¡ŒåŒè¯»æˆ–è€…åŒå†™ã€‚</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-0fdeb1ee63b7c88ce2e727c0a6faf095_720w.jpg" alt="img"></p><p>ç¼“å­˜å±‚ä¹Ÿå¯ä»¥é€šè¿‡æ”¯æŒä¸»ä»åŒæ­¥çš„ç¼“å­˜é›†ç¾¤æ¥è§£å†³ç¼“å­˜å±‚çš„é«˜å¯ç”¨é—®é¢˜ã€‚</p><p>ä»¥redisä¸ºä¾‹ï¼Œrediså¤©ç„¶æ”¯æŒä¸»ä»åŒæ­¥ï¼Œrediså®˜æ–¹ä¹Ÿæœ‰sentinelå“¨å…µæœºåˆ¶ï¼Œæ¥åšredisçš„å­˜æ´»æ€§æ£€æµ‹ã€‚</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-cabab5281cfc4475bfa4b875953a4652_720w.jpg" alt="img"></p><p>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå½“redisä¸»æŒ‚äº†çš„æ—¶å€™ï¼Œsentinelèƒ½å¤Ÿæ¢æµ‹åˆ°ï¼Œä¼šé€šçŸ¥è°ƒç”¨æ–¹è®¿é—®æ–°çš„redisï¼Œæ•´ä¸ªè¿‡ç¨‹ç”±sentinelå’Œredisé›†ç¾¤é…åˆå®Œæˆï¼Œå¯¹è°ƒç”¨æ–¹æ˜¯é€æ˜çš„ã€‚</p><p>è¯´å®Œç¼“å­˜çš„é«˜å¯ç”¨ï¼Œè¿™é‡Œè¦å¤šè¯´ä¸€å¥ï¼Œä¸šåŠ¡å¯¹ç¼“å­˜å¹¶ä¸ä¸€å®šæœ‰â€œé«˜å¯ç”¨â€è¦æ±‚ï¼Œæ›´å¤šçš„å¯¹ç¼“å­˜çš„ä½¿ç”¨åœºæ™¯ï¼Œæ˜¯ç”¨æ¥â€œåŠ é€Ÿæ•°æ®è®¿é—®â€ï¼šæŠŠä¸€éƒ¨åˆ†æ•°æ®æ”¾åˆ°ç¼“å­˜é‡Œï¼Œå¦‚æœç¼“å­˜æŒ‚äº†æˆ–è€…ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œæ˜¯å¯ä»¥å»åç«¯çš„æ•°æ®åº“ä¸­å†å–æ•°æ®çš„ã€‚</p><p>è¿™ç±»å…è®¸â€œcache missâ€çš„ä¸šåŠ¡åœºæ™¯ï¼Œç¼“å­˜æ¶æ„çš„å»ºè®®æ˜¯ï¼š</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-e75def903e6669d81cb1dc46c22bf436_720w-1621330184627.jpg" alt="img"></p><p>å°†kvç¼“å­˜å°è£…æˆæœåŠ¡é›†ç¾¤ï¼Œä¸Šæ¸¸è®¾ç½®ä¸€ä¸ªä»£ç†ï¼ˆä»£ç†å¯ä»¥ç”¨é›†ç¾¤å†—ä½™çš„æ–¹å¼ä¿è¯é«˜å¯ç”¨ï¼‰ï¼Œä»£ç†çš„åç«¯æ ¹æ®ç¼“å­˜è®¿é—®çš„keyæ°´å¹³åˆ‡åˆ†æˆè‹¥å¹²ä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹çš„è®¿é—®å¹¶ä¸åšé«˜å¯ç”¨ã€‚</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-54882e121ce8268eb4ae6525cbfe3b23_720w-1621330182799.jpg" alt="img"></p><p>ç¼“å­˜å®ä¾‹æŒ‚äº†å±è”½ï¼šå½“æœ‰æ°´å¹³åˆ‡åˆ†çš„å®ä¾‹æŒ‚æ‰æ—¶ï¼Œä»£ç†å±‚ç›´æ¥è¿”å›cache missï¼Œæ­¤æ—¶ç¼“å­˜æŒ‚æ‰å¯¹è°ƒç”¨æ–¹ä¹Ÿæ˜¯é€æ˜çš„ã€‚keyæ°´å¹³åˆ‡åˆ†å®ä¾‹å‡å°‘ï¼Œä¸å»ºè®®åšre-hashï¼Œè¿™æ ·å®¹æ˜“å¼•å‘ç¼“å­˜æ•°æ®çš„ä¸ä¸€è‡´ã€‚</p><h3 id="3-5æœåŠ¡å±‚-gt-æ•°æ®åº“å±‚çš„é«˜å¯ç”¨"><a href="#3-5æœåŠ¡å±‚-gt-æ•°æ®åº“å±‚çš„é«˜å¯ç”¨" class="headerlink" title="3.5æœåŠ¡å±‚>æ•°æ®åº“å±‚çš„é«˜å¯ç”¨"></a>3.5æœåŠ¡å±‚&gt;æ•°æ®åº“å±‚çš„é«˜å¯ç”¨</h3><p>å¤§éƒ¨åˆ†äº’è”ç½‘æŠ€æœ¯ï¼Œæ•°æ®åº“å±‚éƒ½ç”¨äº†â€œä¸»ä»åŒæ­¥ï¼Œè¯»å†™åˆ†ç¦»â€æ¶æ„ï¼Œæ‰€ä»¥æ•°æ®åº“å±‚çš„é«˜å¯ç”¨ï¼Œåˆåˆ†ä¸ºâ€œè¯»åº“é«˜å¯ç”¨â€ä¸â€œå†™åº“é«˜å¯ç”¨â€ä¸¤ç±»ã€‚</p><p>ã€æœåŠ¡å±‚&gt;æ•°æ®åº“å±‚â€œè¯»â€ã€‘çš„é«˜å¯ç”¨</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-02eb450cf9d174e331540e31dd0345c5_720w.jpg" alt="img"></p><p>ã€æœåŠ¡å±‚ã€‘åˆ°ã€æ•°æ®åº“è¯»ã€‘çš„é«˜å¯ç”¨ï¼Œæ˜¯é€šè¿‡è¯»åº“çš„å†—ä½™æ¥å®ç°çš„ã€‚</p><p>æ—¢ç„¶å†—ä½™äº†è¯»åº“ï¼Œä¸€èˆ¬æ¥è¯´å°±è‡³å°‘æœ‰2ä¸ªä»åº“ï¼Œâ€œæ•°æ®åº“è¿æ¥æ± â€ä¼šå»ºç«‹ä¸è¯»åº“å¤šä¸ªè¿æ¥ï¼Œæ¯æ¬¡è¯·æ±‚ä¼šè·¯ç”±åˆ°è¿™äº›è¯»åº“ã€‚</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-4225d557e4561607ad7e503903ac0222_720w.jpg" alt="img"></p><p>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå½“è¯»åº“æŒ‚äº†çš„æ—¶å€™ï¼Œdb-connection-poolèƒ½å¤Ÿæ¢æµ‹åˆ°ï¼Œä¼šè‡ªåŠ¨çš„è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œå°†æµé‡è‡ªåŠ¨è¿ç§»åˆ°å…¶ä»–çš„è¯»åº“ï¼Œæ•´ä¸ªè¿‡ç¨‹ç”±è¿æ¥æ± è‡ªåŠ¨å®Œæˆï¼Œå¯¹è°ƒç”¨æ–¹æ˜¯é€æ˜çš„ï¼ˆæ‰€ä»¥è¯´DAOä¸­çš„æ•°æ®åº“è¿æ¥æ± æ˜¯å¾ˆé‡è¦çš„åŸºç¡€ç»„ä»¶ï¼‰ã€‚</p><h3 id="3-6æœåŠ¡å±‚-gt-æ•°æ®åº“å±‚â€œå†™â€çš„é«˜å¯ç”¨"><a href="#3-6æœåŠ¡å±‚-gt-æ•°æ®åº“å±‚â€œå†™â€çš„é«˜å¯ç”¨" class="headerlink" title="3.6æœåŠ¡å±‚>æ•°æ®åº“å±‚â€œå†™â€çš„é«˜å¯ç”¨"></a>3.6æœåŠ¡å±‚&gt;æ•°æ®åº“å±‚â€œå†™â€çš„é«˜å¯ç”¨</h3><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-246454fcc1f8819b67469b63485c2798_720w.jpg" alt="img"></p><p>ã€æœåŠ¡å±‚ã€‘åˆ°ã€æ•°æ®åº“å†™ã€‘çš„é«˜å¯ç”¨ï¼Œæ˜¯é€šè¿‡å†™åº“çš„å†—ä½™æ¥å®ç°çš„ã€‚</p><p>ä»¥mysqlä¸ºä¾‹ï¼Œå¯ä»¥è®¾ç½®ä¸¤ä¸ªmysqlåŒä¸»åŒæ­¥ï¼Œä¸€å°å¯¹çº¿ä¸Šæä¾›æœåŠ¡ï¼Œå¦ä¸€å°å†—ä½™ä»¥ä¿è¯é«˜å¯ç”¨ï¼Œå¸¸è§çš„å®è·µæ˜¯keepalivedå­˜æ´»æ¢æµ‹ï¼Œç›¸åŒvirtual IPæä¾›æœåŠ¡ã€‚</p><p><img src="/2021/05/18/shi-me-shi-gao-ke-yong/v2-ed96e26ab8c04b3fe16b61aa36c0f4bb_720w.jpg" alt="img"></p><p>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼šå½“å†™åº“æŒ‚äº†çš„æ—¶å€™ï¼Œkeepalivedèƒ½å¤Ÿæ¢æµ‹åˆ°ï¼Œä¼šè‡ªåŠ¨çš„è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œå°†æµé‡è‡ªåŠ¨è¿ç§»åˆ°shadow-db-masterï¼Œç”±äºä½¿ç”¨çš„æ˜¯ç›¸åŒçš„virtual IPï¼Œè¿™ä¸ªåˆ‡æ¢è¿‡ç¨‹å¯¹è°ƒç”¨æ–¹æ˜¯é€æ˜çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¨è®º </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>docker</title>
      <link href="2021/05/16/docker/"/>
      <url>2021/05/16/docker/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><h3 id="1-1-ä¸ºä»€ä¹ˆ"><a href="#1-1-ä¸ºä»€ä¹ˆ" class="headerlink" title="1.1 ä¸ºä»€ä¹ˆ"></a>1.1 ä¸ºä»€ä¹ˆ</h3><p>æˆ‘çš„ä»£ç åœ¨æˆ‘çš„æœºå­ä¸Šèƒ½è·‘ï¼Œåœ¨ä½ çš„æœºå­ä¸Šç«Ÿç„¶å´©äº†ï¼ï¼ï¼dockerè§£å†³è¿™ä¸ªé—®é¢˜ï¼</p><h3 id="1-2-æ˜¯ä»€ä¹ˆ"><a href="#1-2-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1.2 æ˜¯ä»€ä¹ˆ"></a>1.2 æ˜¯ä»€ä¹ˆ</h3><p>é€šè¿‡dockerç›´æ¥æŠŠè¿è¡Œç¯å¢ƒæ‰“åŒ…ä¸”è·¨å¹³å°ã€‚éš”ç¦»æ˜¯dockerçš„æ ¸å¿ƒæ€æƒ³ã€‚</p><h3 id="1-3-æ€ä¹ˆåš"><a href="#1-3-æ€ä¹ˆåš" class="headerlink" title="1.3 æ€ä¹ˆåš"></a>1.3 æ€ä¹ˆåš</h3><p><img src="/2021/05/16/docker/image-20210604194813470.png" alt="image-20210604194813470"></p><p>é€šè¿‡Docker Engine ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„å†…æ ¸ï¼Œç›¸æ¯”è™šæ‹Ÿæœºå°‘äº†ä¸€å±‚Guest OSçš„æŠ½è±¡å±‚ï¼Œæ‰€ä»¥å ç”¨ç©ºé—´å°‘ã€‚</p><h3 id="1-å®ç°åŸç†"><a href="#1-å®ç°åŸç†" class="headerlink" title="## 1 å®ç°åŸç†"></a>## 1 å®ç°åŸç†</h3><h3 id="1-1-å‘½åç©ºé—´"><a href="#1-1-å‘½åç©ºé—´" class="headerlink" title="1.1 å‘½åç©ºé—´"></a>1.1 å‘½åç©ºé—´</h3><p>å‘½åç©ºé—´æ˜¯Linuxæä¾›å…±çš„åˆ†ç¦»è¿›ç¨‹èµ„æºçš„æ–¹æ³•ï¼ˆæ¯”å¦‚nginxã€redisç­‰æœåŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°ï¼‰ã€‚Dockeré€šè¿‡Namespaceså¯¹ä¸åŒçš„å®¹å™¨å®ç°äº†éš”ç¦»ã€‚</p><p>ï¼ˆLinuxæä¾›äº†ä¸ƒç§ä¸åŒçš„å‘½åç©ºé—´ï¼Œé€šè¿‡è¿™äº›é€‰é¡¹èƒ½å¤Ÿåˆ›å»ºæ–°çš„è¿›ç¨‹æ—¶è®¾ç½®æ–°è¿›ç¨‹åº”è¯¥åœ¨å“ªäº›èµ„æºä¸Šä¸å®¿ä¸»æœºå™¨è¿›è¡Œéš”ç¦»ï¼‰ã€‚</p><ol><li>iptable å¯¹ç½‘ç»œè¯·æ±‚é‡å®šå‘</li></ol><p>Docker é»˜è®¤çš„ç½‘ç»œè®¾ç½®æ¨¡å¼ï¼šç½‘æ¡¥æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œé™¤äº†åˆ†é…éš”ç¦»çš„ç½‘ç»œå‘½åç©ºé—´ä¹‹å¤–ï¼ŒDocker è¿˜ä¼šä¸ºæ‰€æœ‰çš„å®¹å™¨è®¾ç½® IP åœ°å€ã€‚å½“ Docker æœåŠ¡å™¨åœ¨ä¸»æœºä¸Šå¯åŠ¨ä¹‹åä¼šåˆ›å»ºæ–°çš„è™šæ‹Ÿç½‘æ¡¥ docker0ï¼Œéšååœ¨è¯¥ä¸»æœºä¸Šå¯åŠ¨çš„å…¨éƒ¨æœåŠ¡åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½ä¸è¯¥ç½‘æ¡¥ç›¸è¿ã€‚ç½‘æ¡¥ docker0 é€šè¿‡ iptables ä¸­çš„é…ç½®ä¸å®¿ä¸»æœºå™¨ä¸Šçš„ç½‘å¡ç›¸è¿ï¼Œæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¯·æ±‚éƒ½ä¼šé€šè¿‡ iptables è½¬å‘åˆ° docker0 å¹¶ç”±ç½‘æ¡¥åˆ†å‘ç»™å¯¹åº”çš„æœºå™¨</p><p><img src="/2021/05/16/docker/1.PNG"></p><h3 id="1-2-æ§åˆ¶ç»„-CGroups-ï¼ˆControl-Groupsï¼‰"><a href="#1-2-æ§åˆ¶ç»„-CGroups-ï¼ˆControl-Groupsï¼‰" class="headerlink" title="1.2 æ§åˆ¶ç»„ CGroups ï¼ˆControl Groupsï¼‰"></a>1.2 æ§åˆ¶ç»„ CGroups ï¼ˆControl Groupsï¼‰</h3><p>å¯¹è¿›ç¨‹èµ„æºè¿›è¡Œæ§åˆ¶ï¼Œå®ç°äº†CPUå†…å­˜ç­‰èµ„æºçš„éš”ç¦»ã€‚</p><p><img src="/2021/05/16/docker/2.PNG"></p><p>æŸä¸ªå®¹å™¨æ‰§è¡ŒCPUå¯†é›†å‹ä»»åŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šå½±å“å…¶ä»–å®¹å™¨ä»»åŠ¡çš„æ€§èƒ½å’Œæ•ˆç‡ï¼Œå¯¼è‡´å¤šä¸ªå®¹å™¨ç›¸äº’å½±å“å¹¶æŠ¢å èµ„æºã€‚å¦‚ä½•å¯¹å¤šä¸ªå®¹å™¨çš„èµ„æºä½¿ç”¨è¿›è¡Œé™åˆ¶ï¼ŒCGroupsèƒ½å¤Ÿéš”ç¦»å®¿ä¸»æœºå™¨ä¸Šçš„ç‰©ç†èµ„æºã€‚</p><p><img src="/2021/05/16/docker/3.PNG"></p><p>æ¯ä¸€ä¸ªCGroupéƒ½æ˜¯ä¸€ç»„è¢«ç›¸åŒæ ‡å‡†å’Œå‚æ•°é™åˆ¶çš„è¿‡ç¨‹ï¼Œä¸åŒçš„CGroupä¹‹é—´æœ‰å±‚çº§å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å®ƒä»¬ä¹‹é—´å¯ä»¥ä»çˆ¶ç±»ç»§æ‰¿ä¸€äº›ç”¨äºé™åˆ¶èµ„æºä½¿ç”¨çš„æ ‡å‡†å’Œå‚æ•°ã€‚</p><p>æ‰€æœ‰çš„èµ„æºæ§åˆ¶éƒ½æ˜¯ä»¥ CGroup ä½œä¸ºå•ä½å®ç°çš„ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½å¯ä»¥éšæ—¶åŠ å…¥ä¸€ä¸ª CGroup ä¹Ÿå¯ä»¥éšæ—¶é€€å‡ºä¸€ä¸ª CGroupã€‚</p><h3 id="1-3-UnionFS"><a href="#1-3-UnionFS" class="headerlink" title="1.3 UnionFS"></a>1.3 UnionFS</h3><p>UnionFS å…¶å®æ˜¯ä¸€ç§ä¸ºLinuxæ“ä½œç³»ç»Ÿè®¾è®¡çš„æŠŠå¤šä¸ªæ–‡ä»¶ç³»ç»Ÿè”åˆåˆ°åŒä¸€ä¸ªæŒ‚è½½ç‚¹çš„æ–‡ä»¶ç³»ç»ŸæœåŠ¡ã€‚</p><p>é•œåƒçš„æœ¬è´¨å°±æ˜¯å‹ç¼©åŒ…ã€‚Dockerä¸­çš„æ¯ä¸€ä¸ªé•œåƒéƒ½æ˜¯ç”±ä¸€ç³»åˆ—åªè¯»çš„å±‚æ„æˆï¼ŒDockerfileä¸­æ¯ä¸€ä¸ªå‘½ä»¤éƒ½ä¼šåœ¨å·²æœ‰çš„å±‚ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ï¼š</p><p>ä¸€ä¸ªå®¹å™¨å…¶å®ç­‰äºé•œåƒåŠ ä¸Šä¸€ä¸ªå¯è¯»å†™çš„å±‚ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªé•œåƒå¯ä»¥å¯¹åº”å¤šä¸ªå®¹å™¨ã€‚</p><h2 id="2-å¸¸ç”¨å‘½ä»¤"><a href="#2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2. å¸¸ç”¨å‘½ä»¤"></a>2. å¸¸ç”¨å‘½ä»¤</h2><p>å®˜æ–¹å‘½ä»¤åœ°å€ï¼š<a href="https://docs.docker.com/engine/reference/commandline/login/">docker login | Docker Documentation</a></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker verison # æ˜¾ç¤ºdockerçš„ç‰ˆæœ¬ä¿¡æ¯docker info # æ˜¾ç¤ºdockerçš„ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨çš„æ•°é‡docker å‘½ä»¤ --help #ä¸‡èƒ½å‘½ä»¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-1-æœç´¢"><a href="#2-1-æœç´¢" class="headerlink" title="2.1 æœç´¢"></a>2.1 æœç´¢</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker searchdocker search mysql --filter=STARS=3000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-2-æ‹‰å–"><a href="#2-2-æ‹‰å–" class="headerlink" title="2.2 æ‹‰å–"></a>2.2 æ‹‰å–</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull # docker pull é•œåƒåå­—:tag# å¦‚æœä¸å†™tagå°±ä¸‹è½½æœ€æ–°çš„ latest# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-è¿è¡Œ"><a href="#2-3-è¿è¡Œ" class="headerlink" title="2.3 è¿è¡Œ"></a>2.3 è¿è¡Œ</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run [å¯é€‰å‚æ•°] image--name="name" #åå­—-d #åå°è¿è¡Œ-it #äº¤äº’æ–¹å¼è¿›è¡Œ-p æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼Œ -p 8080:8080-P éšæœºæŒ‡å®šç«¯å£<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-4-åˆ—å‡ºå®¹å™¨"><a href="#2-4-åˆ—å‡ºå®¹å™¨" class="headerlink" title="2.4 åˆ—å‡ºå®¹å™¨"></a>2.4 åˆ—å‡ºå®¹å™¨</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker ps æ­£åœ¨è¿è¡Œ-a æ­£åœ¨è¿è¡Œ+å†å²è¿è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-5-é€€å‡ºå®¹å™¨"><a href="#2-5-é€€å‡ºå®¹å™¨" class="headerlink" title="2.5 é€€å‡ºå®¹å™¨"></a>2.5 é€€å‡ºå®¹å™¨</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">exit #ç›´æ¥é€€å‡ºå®¹å™¨å¹¶åœæ­¢Ctrl + P + Q #å®¹å™¨ä¸åœæ­¢é€€å‡º<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-6-åˆ é™¤å®¹å™¨"><a href="#2-6-åˆ é™¤å®¹å™¨" class="headerlink" title="2.6 åˆ é™¤å®¹å™¨"></a>2.6 åˆ é™¤å®¹å™¨</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker rm id #é•œåƒæ˜¯rmidocker rm -f $(docker ps -aq)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-7-åœæ­¢å®¹å™¨"><a href="#2-7-åœæ­¢å®¹å™¨" class="headerlink" title="2.7 åœæ­¢å®¹å™¨"></a>2.7 åœæ­¢å®¹å™¨</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker stop iddocker kill iddocker start iddocker restart id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-8-æŸ¥çœ‹å†…éƒ¨ä¿¡æ¯"><a href="#2-8-æŸ¥çœ‹å†…éƒ¨ä¿¡æ¯" class="headerlink" title="2.8 æŸ¥çœ‹å†…éƒ¨ä¿¡æ¯"></a>2.8 æŸ¥çœ‹å†…éƒ¨ä¿¡æ¯</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker top id # æŸ¥çœ‹å†…éƒ¨ä¿¡æ¯<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-9-å¸¸ç”¨å…¶ä»–å‘½ä»¤"><a href="#2-9-å¸¸ç”¨å…¶ä»–å‘½ä»¤" class="headerlink" title="2.9 å¸¸ç”¨å…¶ä»–å‘½ä»¤"></a>2.9 å¸¸ç”¨å…¶ä»–å‘½ä»¤</h3><h4 id="2-9-1-åå°å¯åŠ¨å‘½ä»¤"><a href="#2-9-1-åå°å¯åŠ¨å‘½ä»¤" class="headerlink" title="2.9.1 åå°å¯åŠ¨å‘½ä»¤"></a>2.9.1 åå°å¯åŠ¨å‘½ä»¤</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d centos# é—®é¢˜docker ps å¦‚æœé€€å‡ºä¼šåœæ­¢ï¼Œå®¹å™¨ä½¿ç”¨åå°è¿›ç¨‹ï¼Œå®¹å™¨ä¸­å¿…é¡»è¦æœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è·‘ç€ï¼Œä¸ç„¶å°±è‡ªåŠ¨åœäº†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2-9-2-æŸ¥çœ‹æ—¥å¿—"><a href="#2-9-2-æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="2.9.2 æŸ¥çœ‹æ—¥å¿—"></a>2.9.2 æŸ¥çœ‹æ—¥å¿—</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker logs -ft --tail 10 å®¹å™¨id #æŸ¥çœ‹idå®¹å™¨çš„æ—¥å¿—ï¼Œä¸”ä¸€å¼€å§‹æ‰“å°æœ€æ–°çš„10æ¡logï¼ˆå¦‚æœè¿˜æœ‰æ–°æ—¥å¿—ï¼Œä¼šä¸€ç›´å¢åŠ æ˜¾ç¤ºæ–°æ—¥å¿—ï¼‰docker inspect å®¹å™¨id # æŸ¥çœ‹å®¹å™¨ä¿¡æ¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2-9-3-è¿›å…¥å½“å‰å®¹å™¨"><a href="#2-9-3-è¿›å…¥å½“å‰å®¹å™¨" class="headerlink" title="2.9.3 è¿›å…¥å½“å‰å®¹å™¨"></a>2.9.3 è¿›å…¥å½“å‰å®¹å™¨</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">docker exec -it å®¹å™¨id /bin/bash # è¿›å…¥å®¹å™¨åå¼€å¯æ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥åœ¨é‡Œé¢æ“ä½œï¼ˆå¸¸ç”¨ï¼‰docker attach å®¹å™¨id # è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2-9-4-å®¹å™¨å†…çš„æ–‡ä»¶æ‹·è´åˆ°æœºå­ä¸Š"><a href="#2-9-4-å®¹å™¨å†…çš„æ–‡ä»¶æ‹·è´åˆ°æœºå­ä¸Š" class="headerlink" title="2.9.4 å®¹å™¨å†…çš„æ–‡ä»¶æ‹·è´åˆ°æœºå­ä¸Š"></a>2.9.4 å®¹å™¨å†…çš„æ–‡ä»¶æ‹·è´åˆ°æœºå­ä¸Š</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># è¿›å…¥å®¹å™¨åï¼ï¼ï¼docker cp å®¹å™¨id:/dir/XXX.java /home<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>git</title>
      <link href="2021/05/16/git/"/>
      <url>2021/05/16/git/</url>
      
        <content type="html"><![CDATA[<h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h2><p>å¼€å‘ä¸­ç‰ˆæœ¬è¿­ä»£ï¼Œæ–°çš„å’Œè€çš„ç‰ˆæœ¬ä¹‹é—´è¿›è¡Œç®¡ç†ã€‚</p><h3 id="1-1-æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶"><a href="#1-1-æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="1.1 æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶"></a>1.1 æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶</h3><p>è®°å½•æ–‡ä»¶æ¯æ¬¡çš„æ›´æ–°ï¼Œå¯ä»¥å¯¹æ¯ä¸ªç‰ˆæœ¬åšä¸€ä¸ªå¿«ç…§ï¼Œæˆ–æ˜¯è®°å½•è¡¥ä¸æ–‡ä»¶ï¼Œé€‚åˆä¸ªäººç”¨ï¼Œå¦‚RCSã€‚</p><p><img src="/2021/05/16/git/local.PNG"></p><h3 id="1-2-é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶"><a href="#1-2-é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="1.2 é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶"></a>1.2 é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶</h3><p><img src="/2021/05/16/git/center.PNG"></p><p>æ‰€æœ‰ç‰ˆæœ¬æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼ŒååŒå¼€å‘è€…ä»æœåŠ¡å™¨ä¸ŠåŒæ­¥æ›´æ–°è‡ªå·±çš„ä¿®æ”¹ã€‚</p><p>ä»£è¡¨ä½œï¼šSVN</p><p>ä¸€æ—¦æœåŠ¡å™¨åäº†ï¼Œé‚£å·¥ç¨‹ç›´æ¥æ²¡äº†ã€‚</p><h3 id="1-3-åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶"><a href="#1-3-åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="1.3 åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶"></a>1.3 åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶</h3><p><img src="/2021/05/16/git/%E5%88%86%E5%B8%83%E5%BC%8F%E7%89%88%E6%9C%AC.PNG"></p><p>æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ä»“åº“å…¨éƒ¨åŒæ­¥åˆ°æœ¬åœ°çš„æ¯ä¸ªç”¨æˆ·ï¼Œè¿™æ ·</p><h3 id="1-1-gitå’Œsvnçš„åŒºåˆ«"><a href="#1-1-gitå’Œsvnçš„åŒºåˆ«" class="headerlink" title="1.1 gitå’Œsvnçš„åŒºåˆ«"></a>1.1 gitå’Œsvnçš„åŒºåˆ«</h3><ul><li>svn </li></ul><p>é›†ç§å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç‰ˆæœ¬åº“æ˜¯é›†ç§æ”¾åœ¨ä¸­å¤®æœåŠ¡å™¨çš„ã€‚è€Œå·¥ä½œçš„æ—¶å€™ï¼Œç”¨çš„éƒ½æ˜¯è‡ªå·±çš„ç”µè„‘ï¼Œæ‰€ä»¥é¦–å…ˆè¦ä»ä¸­å¤®æœåŠ¡å™¨å¾—åˆ°æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç„¶åå·¥ä½œï¼Œå®Œæˆå·¥ä½œåï¼Œéœ€è¦æŠŠè‡ªå·±åšå®Œçš„æ´»æ¨é€åˆ°ä¸­å¤®æœåŠ¡å™¨ã€‚é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ˜¯å¿…é¡»è”ç½‘æ‰èƒ½å·¥ä½œï¼Œå¯¹ç½‘ç»œå¸¦å®½è¦æ±‚è¾ƒé«˜ã€‚</p><ul><li>git</li></ul><p>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ²¡æœ‰ä¸­å¤®æœåŠ¡å™¨ï¼Œæ¯ä¸ªäººçš„ç”µè„‘å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œå·¥ä½œçš„æ—¶å€™ä¸éœ€è¦è”ç½‘ï¼Œå› ä¸ºç‰ˆæœ¬éƒ½åœ¨è‡ªå·±ç”µè„‘ä¸Šã€‚</p><p>æœ‰ä¸ªäººåœ¨è‡ªå·±ç”µè„‘ä¸Šæ”¹äº†æ–‡ä»¶Aï¼Œå…¶ä»–äººä¹Ÿåœ¨ç”µè„‘ä¸Šæ”¹äº†æ–‡ä»¶Aï¼Œè¿™æ—¶åªéœ€è¦æŠŠå„è‡ªä¿®æ”¹æ¨é€ç»™å¯¹æ–¹ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹æ–¹çš„ä¿®æ”¹äº†ã€‚</p><h2 id="2-ç¯å¢ƒé…ç½®"><a href="#2-ç¯å¢ƒé…ç½®" class="headerlink" title="2. ç¯å¢ƒé…ç½®"></a>2. ç¯å¢ƒé…ç½®</h2><p>ä¸‹è½½ä¸‹æ¥æ— è„‘nextå®‰è£…ã€‚</p><h3 id="2-1-gité…ç½®"><a href="#2-1-gité…ç½®" class="headerlink" title="2.1 gité…ç½®"></a>2.1 gité…ç½®</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ç³»ç»Ÿconfig</span><span class="token function">git</span> config --system --list<span class="token comment"># æŸ¥çœ‹å½“å‰ç”¨æˆ·(global)é…ç½®</span><span class="token function">git</span> config --global --list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>Git\etc\gitconfigï¼šGitå®‰è£…ç›®å½•ä¸‹çš„gitconfig â€“system ç³»åƒåœ¾</li><li>C:\Users\Admin.gitconfig å½“å‰ç™»å½•ç”¨æˆ·çš„é…ç½® â€“global å…¨å±€ è¿™é‡Œå¯ä»¥ç›´æ¥ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡å‘½ä»¤è®¾ç½®åä¼šå“åº”åˆ°è¿™é‡Œã€‚</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config --global user.name <span class="token string">"kuangshen"</span> <span class="token comment">#åç§°</span><span class="token function">git</span> config --global user.email <span class="token number">1256211675</span>@qq.com <span class="token comment">#é‚®ç®±</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>git config -l</code> æŸ¥çœ‹é…ç½®</p><h2 id="3-åŸºæœ¬ç†è®º"><a href="#3-åŸºæœ¬ç†è®º" class="headerlink" title="3. åŸºæœ¬ç†è®º"></a>3. åŸºæœ¬ç†è®º</h2><h3 id="3-1-å·¥ä½œåŸç†"><a href="#3-1-å·¥ä½œåŸç†" class="headerlink" title="3.1 å·¥ä½œåŸç†"></a>3.1 å·¥ä½œåŸç†</h3><p>å·¥ä½œç›®å½•(Working Directory)ã€æš‚å­˜åŒº(stage/Index)ã€èµ„æºåº“(Repository)ã€‚</p><p><img src="/2021/05/16/git/git%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.PNG"></p><h3 id="3-2-å·¥ä½œæµç¨‹"><a href="#3-2-å·¥ä½œæµç¨‹" class="headerlink" title="3.2 å·¥ä½œæµç¨‹"></a>3.2 å·¥ä½œæµç¨‹</h3><ol><li>åœ¨å·¥ä½œç›®å½•æ·»åŠ ã€ä¿®æ”¹æ–‡ä»¶ã€‚</li><li>å°†éœ€è¦è¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºã€‚</li><li>å°†æš‚å­˜åŒºçš„æ–‡ä»¶æäº¤åˆ°gitä»“åº“ã€‚</li></ol><p>gitç®¡ç†çš„æ–‡ä»¶æœ‰ä¸‰ç§çŠ¶æ€ï¼šå·²ä¿®æ”¹(modified)ã€å·²æš‚å­˜(staged)ã€å·²æäº¤(commited)</p><h2 id="4-æ–‡ä»¶æ“ä½œ"><a href="#4-æ–‡ä»¶æ“ä½œ" class="headerlink" title="4. æ–‡ä»¶æ“ä½œ"></a>4. æ–‡ä»¶æ“ä½œ</h2><p>å¯¹æ–‡ä»¶çš„ä¿®æ”¹ã€æäº¤ç­‰æ“ä½œï¼Œéœ€è¦çŸ¥é“æ–‡ä»¶å½“å‰åœ¨ä»€ä¹ˆçŠ¶æ€ã€‚</p><ol><li>Untrackedï¼šæœªè·Ÿè¸ªï¼Œæ­¤æ–‡ä»¶åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œä½†å¹¶æ²¡æœ‰åŠ å…¥åˆ°gitåº“ï¼Œä¸å‚ä¸ç‰ˆæœ¬æ§åˆ¶ã€‚é€šè¿‡<code>git add</code> çŠ¶æ€å˜ä¸º<code>staged</code>ã€‚</li><li>Unmodify:æœªä¿®æ”¹ï¼Œæ–‡ä»¶å…¥åº“æœªä¿®æ”¹ï¼Œå³ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶å¿«ç…§å†…å®¹ä¸æ–‡ä»¶å¤¹ä¸­å®Œå…¨ä¸€è‡´ã€‚è¿™ç§ç±»å‹çš„æ–‡ä»¶æœ‰ä¸¤ç§å»å¤„ï¼Œå¦‚æœå®ƒè¢«ä¿®æ”¹ï¼Œè€Œå˜ä¸º<code>Modified</code>ã€‚å¦‚æœä½¿ç”¨<code>git rm</code>ç§»å‡ºç‰ˆæœ¬åº“ï¼Œåˆ™æˆä¸º<code>Untracked</code>æ–‡ä»¶ã€‚</li><li>Modifiedï¼šå·²ä¿®æ”¹ï¼Œä»…ä»…æ˜¯ä¿®æ”¹ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå…¶ä»–æ“ä½œã€‚é€šè¿‡<code>git add</code>è¿›å…¥æš‚å­˜<code>staged</code>çŠ¶æ€ï¼Œä½¿ç”¨<code>git checkout</code>åˆ™ä¸¢å¼ƒä¿®æ”¹è¿‡ï¼Œè¿”å›åˆ°<code>unmodify</code>çŠ¶æ€ï¼Œè¿™ä¸ª<code>git checkout</code>å³ä»åº“ä¸­å–å‡ºæ–‡ä»¶ï¼Œè¦†ç›–å½“å‰ä¿®æ”¹ã€‚</li><li>Stageï¼šæš‚å­˜çŠ¶æ€ï¼Œæ‰§è¡Œ<code>git commit</code>åˆ™å°†ä¿®æ”¹åŒæ­¥åˆ°åº“ä¸­ï¼Œè¿™æ—¶åº“ä¸­çš„æ–‡ä»¶å’Œæœ¬åœ°æ–‡ä»¶åˆå˜ä¸ºä¸€è‡´ï¼Œæ–‡ä»¶ä¸º<code>Unmodify</code>çŠ¶æ€ã€‚æ‰§è¡Œ<code>git reset HEAD filename</code>å–æ¶ˆæš‚å­˜ï¼Œæ–‡ä»¶å˜ä¸º<code>Modified</code>ã€‚</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸ºæ³¨é‡Š</span>*.txt <span class="token comment">#å¿½ç•¥æ‰€æœ‰.txtç»“å°¾çš„æ–‡ä»¶</span><span class="token operator">!</span>lib.txt <span class="token comment">#ä½†lib.txté™¤å¤–</span>/temp <span class="token comment">#ä»…å¿½ç•¥é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„TODOæ–‡ä»¶ï¼Œä¸åŒ…æ‹¬å…¶ä»–ç›®å½•temp</span>build/ <span class="token comment">#å¿½ç•¥build/ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span>doc/*.txt <span class="token comment">#ä¼šå¿½ç•¥ doc/noted.txt ä½†ä¸åŒ…æ‹¬ doc/server/arch.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯</span><span class="token function">git</span> branch <span class="token punctuation">[</span>branch-name<span class="token punctuation">]</span><span class="token comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</span><span class="token function">git</span> checkout -b <span class="token punctuation">[</span>branch<span class="token punctuation">]</span><span class="token comment"># åˆ‡æ¢åˆ°å·²æœ‰åˆ†æ”¯</span><span class="token function">git</span> switch <span class="token punctuation">[</span>branch<span class="token punctuation">]</span><span class="token comment"># åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</span><span class="token function">git</span> merge <span class="token punctuation">[</span>branch<span class="token punctuation">]</span><span class="token comment"># åˆ é™¤åˆ†æ”¯</span><span class="token function">git</span> brach -d <span class="token punctuation">[</span>branch-name<span class="token punctuation">]</span><span class="token comment"># åˆ é™¤è¿œç¨‹åˆ†æ”¯</span><span class="token function">git</span> push origin --delete <span class="token punctuation">[</span>branch-name<span class="token punctuation">]</span><span class="token function">git</span> branch -dr <span class="token punctuation">[</span>remote/branch<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>springcloud</title>
      <link href="2021/05/16/springcloud/"/>
      <url>2021/05/16/springcloud/</url>
      
        <content type="html"><![CDATA[<h1 id="Springcloud"><a href="#Springcloud" class="headerlink" title="Springcloud"></a>Springcloud</h1><h2 id="1-å¾®æœåŠ¡æ¶æ„"><a href="#1-å¾®æœåŠ¡æ¶æ„" class="headerlink" title="1. å¾®æœåŠ¡æ¶æ„"></a>1. å¾®æœåŠ¡æ¶æ„</h2><h3 id="1-1-ä¸ºä»€ä¹ˆ"><a href="#1-1-ä¸ºä»€ä¹ˆ" class="headerlink" title="1.1 ä¸ºä»€ä¹ˆ"></a>1.1 ä¸ºä»€ä¹ˆ</h3><h3 id="2-2-æ˜¯ä»€ä¹ˆ"><a href="#2-2-æ˜¯ä»€ä¹ˆ" class="headerlink" title="2.2 æ˜¯ä»€ä¹ˆ"></a>2.2 æ˜¯ä»€ä¹ˆ</h3><p>å°†å•ä¸€åº”ç”¨åˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’åè°ƒã€äº’ç›¸é…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚</p><p>springcloud=å¤šç§å¾®æœåŠ¡æ¶æ„è½åœ°æŠ€æœ¯çš„é›†åˆä½“ï¼Œå¾®æœåŠ¡å…¨å®¶æ¡¶</p><p><img src="/2021/05/16/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97.PNG"></p><h3 id="1-3-pomæ–‡ä»¶"><a href="#1-3-pomæ–‡ä»¶" class="headerlink" title="1.3 pomæ–‡ä»¶"></a>1.3 pomæ–‡ä»¶</h3><p><code>dependencyManagement</code> æ˜¯mavenæä¾›çš„ä¸€ç§ç®¡ç†ä¾èµ–ç‰ˆæœ¬å·çš„æ–¹å¼ã€‚</p><p>ä½¿ç”¨<code>pom.xml</code>ä¸­çš„dependencyManagementå…ƒç´ èƒ½è®©æ‰€æœ‰åœ¨å­é¡¹ç›®ä¸­å¼•ç”¨ä¸€ä¸ªä¾èµ–è€Œä¸ç”¨æ˜¾ç¤ºçš„åˆ—å‡ºç‰ˆæœ¬å·ã€‚Mavenä¼šæ²¿ç€çˆ¶å­å±‚æ¬¡å‘ä¸Šèµ°ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ‹¥æœ‰dependencyManagementå…ƒç´ çš„é¡¹ç›®ï¼Œç„¶åå®ƒä¼šä½¿ç”¨è¿™ä¸ªdependencymanagementå…ƒç´ ä¸­æŒ‡å®šçš„ç‰ˆæœ¬å·ã€‚</p><p><font color="red"><code>dependencyManagement</code> åªæ˜¯å£°æ˜ä¾èµ–ï¼Œå¹¶ä¸å®ç°å¼•å…¥ï¼Œå› æ­¤å­é¡¹ç›®éœ€è¦æ˜¾ç¤ºçš„å£°æ˜éœ€è¦ç”¨çš„ä¾èµ–ã€‚</font></p><h2 id="2-æœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#2-æœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="2.æœåŠ¡æ³¨å†Œä¸­å¿ƒ"></a>2.æœåŠ¡æ³¨å†Œä¸­å¿ƒ</h2><h3 id="2-1-Zookeeper"><a href="#2-1-Zookeeper" class="headerlink" title="2.1 Zookeeper"></a>2.1 Zookeeper</h3><h3 id="2-2-Consul"><a href="#2-2-Consul" class="headerlink" title="2.2 Consul"></a>2.2 Consul</h3><h4 id="2-2-1-æ˜¯ä»€ä¹ˆ"><a href="#2-2-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="2.2.1 æ˜¯ä»€ä¹ˆ"></a>2.2.1 æ˜¯ä»€ä¹ˆ</h4><p>Consulæ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œæœ‰hashiCorpç”¨goè¯­è¨€å¼€å‘ã€‚</p><h3 id="2-3-Nacos"><a href="#2-3-Nacos" class="headerlink" title="2.3 Nacos"></a>2.3 Nacos</h3><h3 id="2-4-Eureka"><a href="#2-4-Eureka" class="headerlink" title="2.4 Eureka"></a>2.4 Eureka</h3><h4 id="2-4-1-åŸºç¡€çŸ¥è¯†"><a href="#2-4-1-åŸºç¡€çŸ¥è¯†" class="headerlink" title="2.4.1 åŸºç¡€çŸ¥è¯†"></a>2.4.1 åŸºç¡€çŸ¥è¯†</h4><ul><li>æœåŠ¡æ²»ç†</li></ul><p>Spring Cloudå°è£…äº†Netflicå…¬å¸å¼€å‘çš„Eurekaæ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç†ã€‚</p><p>åœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ç®¡ç†æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚</p><h4 id="2-4-2-å•æœºEurekaæ„å»ºæ­¥éª¤"><a href="#2-4-2-å•æœºEurekaæ„å»ºæ­¥éª¤" class="headerlink" title="2.4.2 å•æœºEurekaæ„å»ºæ­¥éª¤"></a>2.4.2 å•æœºEurekaæ„å»ºæ­¥éª¤</h4><h4 id="2-4-3-é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤"><a href="#2-4-3-é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤" class="headerlink" title="2.4.3  é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤"></a>2.4.3  é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤</h4><h4 id="2-4-4-Eureka-ç†è®º"><a href="#2-4-4-Eureka-ç†è®º" class="headerlink" title="2.4.4 Eureka ç†è®º"></a>2.4.4 Eureka ç†è®º</h4><p>ä¿æŠ¤æ¨¡å¼ä¸»è¦ç”¨äºä¸€ç»„å®¢æˆ·ç«¯å’ŒEureka Serverä¹‹é—´å­˜åœ¨ç½‘ç»œåˆ†åŒºåœºæ™¯ä¸‹çš„ä¿æŠ¤ã€‚ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼ŒEureka Serverå°†ä¼šå°è¯•ä¿æŠ¤å…¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ã€‚</p><p>å…¶å®å°±æ˜¯æŸæ—¶åˆ»æŸä¸€ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨ï¼ŒEurekaä¸ä¼šç«‹å³æ¸…ç†ï¼Œä¾æ—§ä¼šå¯¹è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯è¿›è¡Œä¿å­˜ã€‚</p><h3 id="2-5-zookeaper"><a href="#2-5-zookeaper" class="headerlink" title="2.5 zookeaper"></a>2.5 zookeaper</h3><h2 id="3-Hytrix"><a href="#3-Hytrix" class="headerlink" title="3.Hytrix"></a>3.Hytrix</h2><p>Hytrixå¯ä»¥é˜²æ­¢æœåŠ¡çš„çº§è”æ•…éšœï¼šé›ªå´©æ•ˆåº”ã€‚</p><h4 id="3-1-å·¥ä½œæµç¨‹"><a href="#3-1-å·¥ä½œæµç¨‹" class="headerlink" title="3.1 å·¥ä½œæµç¨‹"></a>3.1 å·¥ä½œæµç¨‹</h4><ol><li>å½“è°ƒç”¨å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œå¼€å¯ä¸€ä¸ªæ—¶é—´çª—ï¼Œé»˜è®¤10sã€‚</li><li>åœ¨è¿™ä¸ªæ—¶é—´çª—å†…ï¼Œç»Ÿè®¡è°ƒç”¨æ¬¡æ•°æ˜¯å¦è¾¾åˆ°æœ€å°è¯·æ±‚æ•°ã€‚å¦‚æœæ²¡æœ‰è¾¾åˆ°ï¼Œåˆ™é‡ç½®å›åˆ°ç¬¬ä¸€æ­¥ã€‚å¦‚æœè¾¾åˆ°äº†ï¼Œåˆ™ç»Ÿè®¡å¤±è´¥çš„è¯·æ±‚æ•°å æ‰€æœ‰è¯·æ±‚æ•°çš„ç™¾åˆ†æ¯”ï¼Œæ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼Ÿè¾¾åˆ°é˜ˆå€¼åˆ™ä¸å†è¯·æ±‚å¯¹åº”æœåŠ¡ï¼Œåˆ™è·³é—¸ã€‚å¦‚æœæ²¡æœ‰è¾¾åˆ°åˆ™å›åˆ°ç¬¬ä¸€æ­¥ã€‚</li><li>å¦‚æœè·³é—¸ï¼Œåˆ™å¼€å¯æ´»åŠ¨çª—å£ï¼ˆé»˜è®¤5sï¼‰ï¼Œæ¯éš”5sHystrixä¼šè®©ä¸€ä¸ªè¯·æ±‚é€šè¿‡ï¼Œåˆ°è¾¾é‚£ä¸ªæœåŠ¡ï¼Œçœ‹æ˜¯å¦è°ƒç”¨æˆåŠŸã€‚æˆåŠŸåˆ™å›åˆ°ç¬¬ä¸€æ­¥ï¼Œå¤±è´¥åˆ™å›åˆ°ç¬¬ä¸‰æ­¥ã€‚</li></ol><p><img src="/2021/05/16/springcloud/image-20210829103536402.png" alt="image-20210829103536402"></p><h4 id="3-2-çº¿ç¨‹æ± éš”ç¦»"><a href="#3-2-çº¿ç¨‹æ± éš”ç¦»" class="headerlink" title="3.2 çº¿ç¨‹æ± éš”ç¦»"></a>3.2 çº¿ç¨‹æ± éš”ç¦»</h4><p>ä¸€ä¸ªä¸šåŠ¡å‡ºç°æ•…éšœä¸ä¼šå½±å“å…¶ä»–æ¥å£çš„ä¸šåŠ¡ã€‚å¦‚æœéœ€è¦éš”ç¦»ä¸Šåƒä¸ªï¼Œä¸æ¨èã€‚æ¯•ç«Ÿä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ç­‰å¤§ã€‚</p><h4 id="3-3-ä¿¡å·é‡éš”ç¦»"><a href="#3-3-ä¿¡å·é‡éš”ç¦»" class="headerlink" title="3.3 ä¿¡å·é‡éš”ç¦»"></a>3.3 ä¿¡å·é‡éš”ç¦»</h4><p>æ¯æ¬¡è°ƒç”¨çº¿ç¨‹ï¼Œå½“å‰è¯·æ±‚é€šè¿‡è®¡æ•°ä¿¡å·é‡è¿›è¡Œé™åˆ¶ï¼Œå½“ä¿¡å·é‡å¤§äºäº†æœ€å¤§è¯·æ±‚æ•°<code>maxConcurrentRequest</code>æ—¶ï¼Œè¿›è¡Œé™åˆ¶ï¼Œè°ƒç”¨fallbackæ¥å£å¿«é€Ÿè¿”å›ã€‚ä¿¡å·é‡çš„è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½å¾—é˜»å¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ï¼Œç›´åˆ°ç»“æœè¿”å›ã€‚å¯¼è‡´æ— æ³•å¯¹è®¿é—®åšè¶…æ—¶ï¼ˆåªèƒ½è°ƒç”¨åè®®è¶…æ—¶ï¼Œæ— æ³•ä¸»åŠ¨é‡Šæ”¾ï¼‰ã€‚</p><p>ä¸€èˆ¬ç”¨æ¥éç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºç½‘ç»œæœ‰è¶…æ—¶ï¼Œä¿¡å·é‡æ— æ³•å¤„ç†è¶…æ—¶ã€‚</p><p><img src="/2021/05/16/springcloud/image-20210829192941272.png" alt="image-20210829192941272"></p><h3 id="4-é›ªå´©çš„è§£å†³æ–¹æ¡ˆ"><a href="#4-é›ªå´©çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4. é›ªå´©çš„è§£å†³æ–¹æ¡ˆ"></a>4. é›ªå´©çš„è§£å†³æ–¹æ¡ˆ</h3><p>é›ªå´©æ˜¯ç³»ç»Ÿçš„è´è¶æ•ˆåº”å¯¼è‡´ï¼Œå…¶å‘ç”Ÿçš„åŸå› å¤šç§å¤šæ ·ï¼Œä»æºå¤´æˆ‘ä»¬æ— æ³•å®Œå…¨æœç»é›ªå´©çš„å‘ç”Ÿã€‚</p><p>å¯ä»¥æœ‰ï¼š</p><ol><li>è¯·æ±‚ç¼“å­˜ï¼šå°†è¯·æ±‚ä¸è¿”å›ç»“æœåšç¼“å­˜å¤„ç†ã€‚</li><li>è¯·æ±‚åˆå¹¶ï¼šå°†ç›¸åŒçš„è¯·æ±‚è¿›è¡Œåˆå¹¶ç„¶åè°ƒç”¨æ‰¹å¤„ç†æ¥å£ã€‚</li><li>æœåŠ¡éš”ç¦»ï¼šé™åˆ¶è°ƒç”¨åˆ†å¸ƒå¼æœåŠ¡çš„èµ„æºï¼ŒæŸä¸€ä¸ªè°ƒç”¨çš„æœåŠ¡å‡ºç°é—®é¢˜ä¸ä¼šå½±å“å…¶ä»–æœåŠ¡è°ƒç”¨ã€‚</li><li>æœåŠ¡ç†”æ–­ï¼šç‰ºç‰²å±€éƒ¨æœåŠ¡ï¼Œä¿å…¨æ•´ä½“ç³»ç»Ÿç¨³å®šæ€§çš„æªæ–½ã€‚</li><li>æœåŠ¡é™çº§ï¼šæœåŠ¡ç†”æ–­ä»¥åï¼Œå®¢æˆ·ç«¯ç”¨è‡ªå·±æœ¬åœ°æ–¹æ³•è¿”å›ç¼ºçœå€¼ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå †æ ˆå†…å­˜ä¸å †å¤–å†…å­˜</title>
      <link href="2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/"/>
      <url>2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/</url>
      
        <content type="html"><![CDATA[<h2 id="Javaå †æ ˆå†…å­˜ä¸å †å¤–å†…å­˜"><a href="#Javaå †æ ˆå†…å­˜ä¸å †å¤–å†…å­˜" class="headerlink" title="Javaå †æ ˆå†…å­˜ä¸å †å¤–å†…å­˜"></a>Javaå †æ ˆå†…å­˜ä¸å †å¤–å†…å­˜</h2><p>å‚è€ƒè‡³ï¼š<a href="https://zhuanlan.zhihu.com/p/161939673">Java å †å¤–å†…å­˜ã€é›¶æ‹·è´ã€ç›´æ¥å†…å­˜ä»¥åŠé’ˆå¯¹äºNIOä¸­çš„FileChannelçš„æ€è€ƒ - çŸ¥ä¹ (zhihu.com)</a></p><h2 id="1-å †æ ˆå†…å­˜"><a href="#1-å †æ ˆå†…å­˜" class="headerlink" title="1. å †æ ˆå†…å­˜"></a>1. å †æ ˆå†…å­˜</h2><p>å †æ ˆå†…å­˜æŒ‡çš„æ˜¯å †å†…å­˜å’Œæ ˆå†…å­˜ï¼šå †å†…å­˜æ˜¯GCç®¡ç†çš„å†…å­˜ï¼Œæ ˆå†…å­˜æ˜¯çº¿ç¨‹å†…å­˜ã€‚</p><p>å †å†…å­˜ç»“æ„ï¼š</p><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-204901182bea659e8e72bc9bac66ffd5_720w.jpg" alt="img"></p><p>è¿˜æœ‰ä¸€ä¸ªæ›´ç»†è‡´çš„ç»“æ„å›¾ï¼ˆåŒ…æ‹¬MetaSpaceè¿˜æœ‰code cacheï¼‰ï¼š</p><p><strong>æ³¨æ„åœ¨Java8ä»¥åPermGenè¢«MetaSpaceä»£æ›¿ï¼Œè¿è¡Œæ—¶å¯è‡ªåŠ¨æ‰©å®¹ï¼Œå¹¶ä¸”é»˜è®¤æ˜¯æ— é™å¤§</strong></p><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-9e2284cf759dcbfd479d78cae9112983_720w.jpg" alt="img"></p><p>æˆ‘ä»¬çœ‹ä¸‹é¢ä¸€æ®µä»£ç æ¥ç®€å•ç†è§£ä¸‹å †æ ˆçš„å…³ç³»ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">public static void main(String[] args) {    Object o = new Object();}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­<code>new Object()</code>æ˜¯åœ¨å †ä¸Šé¢åˆ†é…ï¼Œè€ŒObject oè¿™ä¸ªå˜é‡ï¼Œæ˜¯åœ¨mainè¿™ä¸ªçº¿ç¨‹æ ˆä¸Šé¢ã€‚</p><ul><li>åº”ç”¨ç¨‹åºæ‰€æœ‰çš„éƒ¨åˆ†éƒ½ä½¿ç”¨å †å†…å­˜ï¼Œç„¶åæ ˆå†…å­˜é€šè¿‡ä¸€ä¸ªçº¿ç¨‹è¿è¡Œæ¥ä½¿ç”¨ã€‚</li><li>ä¸è®ºå¯¹è±¡ä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Œä»–éƒ½ä¼šå­˜å‚¨åœ¨å †å†…å­˜ä¸­ï¼Œæ ˆå†…å­˜åŒ…å«å®ƒçš„å¼•ç”¨ã€‚æ ˆå†…å­˜åªåŒ…å«åŸå§‹å€¼å˜é‡å¥½å’Œå †ä¸­å¯¹è±¡å˜é‡çš„å¼•ç”¨ã€‚</li><li>å­˜å‚¨åœ¨å †ä¸­çš„å¯¹è±¡æ˜¯å…¨å±€å¯ä»¥è¢«è®¿é—®çš„ï¼Œç„¶è€Œæ ˆå†…å­˜ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰€è®¿é—®ã€‚</li><li>é€šè¿‡JVMå‚æ•°<code>-Xmx</code>æˆ‘ä»¬å¯ä»¥æŒ‡å®šæœ€å¤§å †å†…å­˜å¤§å°ï¼Œé€šè¿‡<code>-Xss</code>æˆ‘ä»¬å¯ä»¥æŒ‡å®šæ¯ä¸ªçº¿ç¨‹çº¿ç¨‹æ ˆå ç”¨å†…å­˜å¤§å°</li></ul><h2 id="2-å †å¤–å†…å­˜"><a href="#2-å †å¤–å†…å­˜" class="headerlink" title="2. å †å¤–å†…å­˜"></a>2. å †å¤–å†…å­˜</h2><h3 id="2-1-å¹¿ä¹‰çš„å †å¤–å†…å­˜"><a href="#2-1-å¹¿ä¹‰çš„å †å¤–å†…å­˜" class="headerlink" title="2.1. å¹¿ä¹‰çš„å †å¤–å†…å­˜"></a>2.1. å¹¿ä¹‰çš„å †å¤–å†…å­˜</h3><p>é™¤äº†å †æ ˆå†…å­˜ï¼Œå‰©ä¸‹çš„å°±éƒ½æ˜¯å †å¤–å†…å­˜äº†ï¼ŒåŒ…æ‹¬äº†jvmæœ¬èº«åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åˆ†é…çš„å†…å­˜ï¼Œcodecacheï¼Œjnié‡Œåˆ†é…çš„å†…å­˜ï¼ŒDirectByteBufferåˆ†é…çš„å†…å­˜ç­‰ç­‰</p><h3 id="2-2-ç‹­ä¹‰çš„å †å¤–å†…å­˜-DirectByteBuffer"><a href="#2-2-ç‹­ä¹‰çš„å †å¤–å†…å­˜-DirectByteBuffer" class="headerlink" title="2.2. ç‹­ä¹‰çš„å †å¤–å†…å­˜ - DirectByteBuffer"></a>2.2. ç‹­ä¹‰çš„å †å¤–å†…å­˜ - DirectByteBuffer</h3><p>è€Œä½œä¸ºjavaå¼€å‘è€…ï¼Œæˆ‘ä»¬å¸¸è¯´çš„å †å¤–å†…å­˜æº¢å‡ºäº†ï¼Œå…¶å®æ˜¯ç‹­ä¹‰çš„å †å¤–å†…å­˜ï¼Œè¿™ä¸ªä¸»è¦æ˜¯æŒ‡java.nio.DirectByteBufferåœ¨åˆ›å»ºçš„æ—¶å€™åˆ†é…å†…å­˜ï¼Œæˆ‘ä»¬è¿™ç¯‡æ–‡ç« é‡Œä¹Ÿä¸»è¦æ˜¯è®²ç‹­ä¹‰çš„å †å¤–å†…å­˜ï¼Œå› ä¸ºå®ƒå’Œæˆ‘ä»¬å¹³æ—¶ç¢°åˆ°çš„é—®é¢˜æ¯”è¾ƒå¯†åˆ‡</p><p><strong>ä¸ºå•¥è¦ä½¿ç”¨å †å¤–å†…å­˜ã€‚é€šå¸¸å› ä¸ºï¼š</strong></p><ul><li>åœ¨è¿›ç¨‹é—´å¯ä»¥å…±äº«ï¼Œå‡å°‘è™šæ‹Ÿæœºé—´çš„å¤åˆ¶</li><li>å¯¹åƒåœ¾å›æ”¶åœé¡¿çš„æ”¹å–„ï¼šå¦‚æœåº”ç”¨æŸäº›é•¿æœŸå­˜æ´»å¹¶å¤§é‡å­˜åœ¨çš„å¯¹è±¡ï¼Œç»å¸¸ä¼šå‡ºå‘YGCæˆ–è€…FullGCï¼Œå¯ä»¥è€ƒè™‘æŠŠè¿™äº›å¯¹è±¡æ”¾åˆ°å †å¤–ã€‚è¿‡å¤§çš„å †ä¼šå½±å“Javaåº”ç”¨çš„æ€§èƒ½ã€‚å¦‚æœä½¿ç”¨å †å¤–å†…å­˜çš„è¯ï¼Œå †å¤–å†…å­˜æ˜¯ç›´æ¥å—æ“ä½œç³»ç»Ÿç®¡ç†( è€Œä¸æ˜¯è™šæ‹Ÿæœº )ã€‚è¿™æ ·åšçš„ç»“æœå°±æ˜¯èƒ½ä¿æŒä¸€ä¸ªè¾ƒå°çš„å †å†…å†…å­˜ï¼Œä»¥å‡å°‘åƒåœ¾æ”¶é›†å¯¹åº”ç”¨çš„å½±å“ã€‚</li><li>åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥æå‡ç¨‹åºI/Oæ“çºµçš„æ€§èƒ½ã€‚å°‘å»äº†å°†æ•°æ®ä»å †å†…å†…å­˜æ‹·è´åˆ°å †å¤–å†…å­˜çš„æ­¥éª¤ã€‚</li></ul><h2 id="3-JNIè°ƒç”¨ä¸å†…æ ¸æ€åŠç”¨æˆ·æ€"><a href="#3-JNIè°ƒç”¨ä¸å†…æ ¸æ€åŠç”¨æˆ·æ€" class="headerlink" title="3. JNIè°ƒç”¨ä¸å†…æ ¸æ€åŠç”¨æˆ·æ€"></a>3. JNIè°ƒç”¨ä¸å†…æ ¸æ€åŠç”¨æˆ·æ€</h2><ul><li>å†…æ ¸æ€ï¼šcpuå¯ä»¥è®¿é—®å†…å­˜çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬å¤–å›´è®¾å¤‡ï¼Œä¾‹å¦‚ç¡¬ç›˜ï¼Œç½‘å¡ï¼Œcpuä¹Ÿå¯ä»¥å°†è‡ªå·±ä»ä¸€ä¸ªç¨‹åºåˆ‡æ¢åˆ°å¦ä¸€ä¸ªç¨‹åºã€‚</li><li>ç”¨æˆ·æ€ï¼šåªèƒ½å—é™çš„è®¿é—®å†…å­˜ï¼Œä¸”ä¸å…è®¸è®¿é—®å¤–å›´è®¾å¤‡ï¼Œå ç”¨cpuçš„èƒ½åŠ›è¢«å‰¥å¤ºï¼Œcpuèµ„æºå¯ä»¥è¢«å…¶ä»–ç¨‹åºè·å–ã€‚</li><li>ç³»ç»Ÿè°ƒç”¨ï¼šä¸ºäº†ä½¿ä¸Šå±‚åº”ç”¨èƒ½å¤Ÿè®¿é—®åˆ°è¿™äº›èµ„æºï¼Œå†…æ ¸ä¸ºä¸Šå±‚åº”ç”¨æä¾›è®¿é—®çš„æ¥å£</li></ul><p><strong>Javaè°ƒç”¨åŸç”Ÿæ–¹æ³•å³JNIå°±æ˜¯ç³»ç»Ÿè°ƒç”¨çš„ä¸€ç§ã€‚</strong></p><p>æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œæ–‡ä»¶è¯»å–ï¼›Javaæœ¬èº«å¹¶ä¸èƒ½è¯»å–æ–‡ä»¶ï¼Œå› ä¸ºç”¨æˆ·æ€æ²¡æœ‰æƒé™è®¿é—®å¤–å›´è®¾å¤‡ã€‚éœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ‡æ¢å†…æ ¸æ€è¿›è¡Œè¯»å–ã€‚</p><p>ç›®å‰ï¼ŒJAVAçš„IOæ–¹å¼æœ‰åŸºäºæµçš„ä¼ ç»ŸIOè¿˜æœ‰åŸºäºå—çš„NIOæ–¹å¼ï¼ˆè™½ç„¶æ–‡ä»¶è¯»å–å…¶å®ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„NIOï¼Œå“ˆå“ˆï¼‰ã€‚é¢å‘æµæ„å‘³ç€ä»æµä¸­ä¸€æ¬¡å¯ä»¥è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ï¼Œæ‹¿åˆ°è¯»å–çš„è¿™äº›åšä»€ä¹ˆä½ è¯´äº†ç®—ï¼Œè¿™é‡Œæ²¡æœ‰ä»»ä½•ç¼“å­˜ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ä½¿ç”¨æµæ²¡æœ‰ä»»ä½•ç¼“å­˜ï¼Œæ¥æ”¶æˆ–è€…å‘é€çš„æ•°æ®æ˜¯ç¼“å­˜åˆ°æ“ä½œç³»ç»Ÿä¸­çš„ï¼Œæµå°±åƒä¸€æ ¹æ°´ç®¡ä»æ“ä½œç³»ç»Ÿçš„ç¼“å­˜ä¸­è¯»å–æ•°æ®ï¼‰è€Œä¸”åªèƒ½é¡ºåºä»æµä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœéœ€è¦è·³è¿‡ä¸€äº›å­—èŠ‚æˆ–è€…å†è¯»å–å·²ç»è¯»è¿‡çš„å­—èŠ‚ï¼Œä½ å¿…é¡»å°†ä»æµä¸­è¯»å–çš„æ•°æ®å…ˆç¼“å­˜èµ·æ¥ã€‚é¢å‘å—çš„å¤„ç†æ–¹å¼æœ‰äº›ä¸åŒï¼Œæ•°æ®æ˜¯å…ˆè¢« è¯»/å†™åˆ°bufferä¸­çš„ï¼Œæ ¹æ®éœ€è¦ä½ å¯ä»¥æ§åˆ¶è¯»å–ä»€ä¹ˆä½ç½®çš„æ•°æ®ã€‚è¿™åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ç»™ç”¨æˆ·å¤šäº†ä¸€äº›çµæ´»æ€§ï¼Œç„¶è€Œï¼Œä½ éœ€è¦é¢å¤–åšçš„å·¥ä½œæ˜¯æ£€æŸ¥ä½ éœ€è¦çš„æ•°æ®æ˜¯å¦å·²ç»å…¨éƒ¨åˆ°äº†bufferä¸­ï¼Œä½ è¿˜éœ€è¦ä¿è¯å½“æœ‰æ›´å¤šçš„æ•°æ®è¿›å…¥bufferä¸­æ—¶ï¼Œbufferä¸­æœªå¤„ç†çš„æ•°æ®ä¸ä¼šè¢«è¦†ç›–ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œåªåˆ†æåŸºäºå—çš„NIOæ–¹å¼ï¼Œåœ¨JAVAä¸­è¿™ä¸ªå—å°±æ˜¯ByteBufferã€‚</p><h2 id="4-Linuxä¸‹é›¶æ‹·è´åŸç†"><a href="#4-Linuxä¸‹é›¶æ‹·è´åŸç†" class="headerlink" title="4. Linuxä¸‹é›¶æ‹·è´åŸç†"></a>4. Linuxä¸‹é›¶æ‹·è´åŸç†</h2><p>å¤§éƒ¨åˆ†webæœåŠ¡å™¨éƒ½è¦å¤„ç†å¤§é‡çš„é™æ€å†…å®¹ï¼Œè€Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯ä»ç£ç›˜æ–‡ä»¶ä¸­è¯»å–æ•°æ®ç„¶åå†™åˆ°socketä¸­ã€‚æˆ‘ä»¬ä»¥è¿™ä¸ªè¿‡ç¨‹ä¸ºä¾‹å­ï¼Œæ¥çœ‹ä¸‹ä¸åŒæ¨¡å¼ä¸‹Linuxå·¥ä½œæµç¨‹</p><h3 id="4-1-æ™®é€šRead-Writeæ¨¡å¼"><a href="#4-1-æ™®é€šRead-Writeæ¨¡å¼" class="headerlink" title="4.1. æ™®é€šRead/Writeæ¨¡å¼"></a>4.1. æ™®é€šRead/Writeæ¨¡å¼</h3><p>æ¶‰åŠçš„ä»£ç æŠ½è±¡ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">//ä»æ–‡ä»¶ä¸­è¯»å–ï¼Œå­˜å…¥tmp_bufread(file, tmp_buf, len);//å°†tmp_bufå†™å…¥socketwrite(socket, tmp_buf, len);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä¸Šå»å¾ˆç®€å•çš„æ­¥éª¤ä½†æ˜¯ç»è¿‡äº†å¾ˆå¤šå¤åˆ¶ï¼š</p><ol><li>å½“è°ƒç”¨ read ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œé€šè¿‡ DMAï¼ˆDirect Memory Accessï¼‰å°†æ•°æ® copy åˆ°å†…æ ¸æ¨¡å¼</li><li>ç„¶åç”± CPU æ§åˆ¶å°†å†…æ ¸æ¨¡å¼æ•°æ® copy åˆ°ç”¨æˆ·æ¨¡å¼ä¸‹çš„ buffer ä¸­</li><li>read è°ƒç”¨å®Œæˆåï¼Œwrite è°ƒç”¨é¦–å…ˆå°†ç”¨æˆ·æ¨¡å¼ä¸‹ buffer ä¸­çš„æ•°æ® copy åˆ°å†…æ ¸æ¨¡å¼ä¸‹çš„ socket buffer ä¸­</li><li>æœ€åé€šè¿‡ DMA copy å°†å†…æ ¸æ¨¡å¼ä¸‹çš„ socket buffer ä¸­çš„æ•°æ® copy åˆ°ç½‘å¡è®¾å¤‡ä¸­ä¼ é€ã€‚</li></ol><p>ä»ä¸Šé¢çš„è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œæ•°æ®ç™½ç™½ä»å†…æ ¸æ¨¡å¼åˆ°ç”¨æˆ·æ¨¡å¼èµ°äº†ä¸€åœˆï¼Œæµªè´¹äº†ä¸¤æ¬¡ copy(ç¬¬ä¸€æ¬¡ï¼Œä»kernelæ¨¡å¼æ‹·è´åˆ°useræ¨¡å¼ï¼›ç¬¬äºŒæ¬¡ä»useræ¨¡å¼å†æ‹·è´å›kernelæ¨¡å¼ï¼Œå³ä¸Šé¢4æ¬¡è¿‡ç¨‹çš„ç¬¬2å’Œ3æ­¥éª¤ã€‚)ï¼Œè€Œè¿™ä¸¤æ¬¡ copy éƒ½æ˜¯ CPU copyï¼Œå³å ç”¨CPUèµ„æº</p><h3 id="4-2-sendfileæ¨¡å¼"><a href="#4-2-sendfileæ¨¡å¼" class="headerlink" title="4.2. sendfileæ¨¡å¼"></a>4.2. sendfileæ¨¡å¼</h3><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-2dd88958164ecc10b419f8ec741dbbe1_720w.jpg" alt="img"></p><p>é€šè¿‡ sendfile ä¼ é€æ–‡ä»¶åªéœ€è¦ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œå½“è°ƒç”¨ sendfile æ—¶ï¼š</p><ol><li>é¦–å…ˆé€šè¿‡ DMA copy å°†æ•°æ®ä»ç£ç›˜è¯»å–åˆ° kernel buffer ä¸­</li><li>ç„¶åé€šè¿‡ CPU copy å°†æ•°æ®ä» kernel buffer copy åˆ° sokcet buffer ä¸­</li><li>æœ€ç»ˆé€šè¿‡ DMA copy å°† socket buffer ä¸­æ•°æ® copy åˆ°ç½‘å¡ buffer ä¸­å‘é€ sendfile ä¸ read/write æ–¹å¼ç›¸æ¯”ï¼Œå°‘äº† ä¸€æ¬¡æ¨¡å¼åˆ‡æ¢ä¸€æ¬¡ CPU copyã€‚ä½†æ˜¯ä»ä¸Šè¿°è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥å‘ç°ä» kernel buffer ä¸­å°†æ•°æ® copy åˆ°socket buffer æ˜¯æ²¡å¿…è¦çš„ã€‚</li></ol><h3 id="4-3-sendfileæ¨¡å¼æ”¹è¿›"><a href="#4-3-sendfileæ¨¡å¼æ”¹è¿›" class="headerlink" title="4.3. sendfileæ¨¡å¼æ”¹è¿›"></a>4.3. sendfileæ¨¡å¼æ”¹è¿›</h3><p>Linux2.4 å†…æ ¸å¯¹sendFileæ¨¡å¼è¿›è¡Œäº†æ”¹è¿›ï¼š</p><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-d12a3c0a2cc43a104860e90ce835163a_720w.jpg" alt="img"></p><p>æ”¹è¿›åçš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>DMA copy å°†ç£ç›˜æ•°æ® copy åˆ° kernel buffer ä¸­ 2.å‘ socket buffer ä¸­è¿½åŠ å½“å‰è¦å‘é€çš„æ•°æ®åœ¨ kernel buffer ä¸­çš„ä½ç½®å’Œåç§»é‡</li><li>DMA gather copy æ ¹æ® socket buffer ä¸­çš„ä½ç½®å’Œåç§»é‡ç›´æ¥å°† kernel buffer ä¸­çš„æ•°æ® copy åˆ°ç½‘å¡ä¸Šã€‚</li></ol><p>ç»è¿‡ä¸Šè¿°è¿‡ç¨‹ï¼Œæ•°æ®åªç»è¿‡äº† 2 æ¬¡ copy å°±ä»ç£ç›˜ä¼ é€å‡ºå»äº†ã€‚ï¼ˆäº‹å®ä¸Šè¿™ä¸ª Zero copy æ˜¯é’ˆå¯¹å†…æ ¸æ¥è®²çš„ï¼Œæ•°æ®åœ¨å†…æ ¸æ¨¡å¼ä¸‹æ˜¯ Zeroï¼copy çš„ï¼‰ã€‚</p><p>å½“å‰è®¸å¤šé«˜æ€§èƒ½ http server éƒ½å¼•å…¥äº† sendfile æœºåˆ¶ï¼Œå¦‚ nginxï¼Œlighttpd ç­‰ã€‚</p><h2 id="5-Javaé›¶æ‹·è´å®ç°çš„å˜åŒ–"><a href="#5-Javaé›¶æ‹·è´å®ç°çš„å˜åŒ–" class="headerlink" title="5. Javaé›¶æ‹·è´å®ç°çš„å˜åŒ–"></a>5. Javaé›¶æ‹·è´å®ç°çš„å˜åŒ–</h2><p>Zero-CopyæŠ€æœ¯çœå»äº†å°†æ“ä½œç³»ç»Ÿçš„read bufferæ‹·è´åˆ°ç¨‹åºçš„bufferï¼Œä»¥åŠä»ç¨‹åºbufferæ‹·è´åˆ°socket bufferçš„æ­¥éª¤ï¼Œç›´æ¥å°†read bufferæ‹·è´åˆ°socket buffer. Java NIOä¸­çš„FileChannal.transferTo()æ–¹æ³•å°±æ˜¯è¿™æ ·çš„å®ç°</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">public void transferTo(long position,long count,WritableByteChannel target);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>transferTo()æ–¹æ³•å°†æ•°æ®ä»ä¸€ä¸ªchannelä¼ è¾“åˆ°å¦ä¸€ä¸ªå¯å†™çš„channelä¸Šï¼Œå…¶å†…éƒ¨å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿå¯¹zero copyæŠ€æœ¯çš„æ”¯æŒã€‚åœ¨unixæ“ä½œç³»ç»Ÿå’Œå„ç§linuxçš„å‘å‹ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§åŠŸèƒ½æœ€ç»ˆæ˜¯é€šè¿‡sendfile()ç³»ç»Ÿè°ƒç”¨å®ç°ã€‚ä¸‹è¾¹å°±æ˜¯è¿™ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">#include &lt;sys/socket.h&gt;ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="5-1-Linux-2-4ä¹‹å‰çš„åº•å±‚å®ç°"><a href="#5-1-Linux-2-4ä¹‹å‰çš„åº•å±‚å®ç°" class="headerlink" title="5.1. Linux 2.4ä¹‹å‰çš„åº•å±‚å®ç°"></a>5.1. Linux 2.4ä¹‹å‰çš„åº•å±‚å®ç°</h3><p>å’Œä¹‹å‰æ‰€è¿°ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢ä¸¤å¹…å›¾æ›´æ¸…æ¥šçš„å±•ç¤ºä¸€ä¸‹å‘ç”Ÿçš„å¤åˆ¶ä»¥åŠå†…æ ¸æ€ç”¨æˆ·æ€åˆ‡æ¢ï¼š</p><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-19e824356374ffa2e1cd1c9e6befc078_b.webp" alt="img"></p><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-a56109754a1558f5b64b8f02e45ddcc4_b.jpg" alt="img"></p><p>å†…æ ¸ã€ç”¨æˆ·æ€åˆ‡æ¢çš„æ¬¡æ•°åªæœ‰ä¸¤æ¬¡ï¼Œå°†æ•°æ®çš„å¤åˆ¶æ¬¡åªæœ‰ä¸‰æ¬¡(åªæœ‰ä¸€æ¬¡ç”¨åˆ°cpuèµ„æº) åœ¨Linux2.4ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä»…æœ‰çš„ä¸€æ¬¡cpuå¤åˆ¶ä¹Ÿå»æ‰</p><h3 id="5-2-Linux-2-4ä¹‹åçš„åº•å±‚å®ç°"><a href="#5-2-Linux-2-4ä¹‹åçš„åº•å±‚å®ç°" class="headerlink" title="5.2. Linux 2.4ä¹‹åçš„åº•å±‚å®ç°"></a>5.2. Linux 2.4ä¹‹åçš„åº•å±‚å®ç°</h3><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-61882b6e8a11b6ae6d60f69ba12fdbd9_b.jpg" alt="img"></p><p>åœ¨å†…æ ¸ä¸º2.4æˆ–è€…ä»¥ä¸Šç‰ˆæœ¬çš„linuxç³»ç»Ÿä¸Šï¼Œsocketç¼“å†²åŒºæè¿°ç¬¦å°†è¢«ç”¨æ¥æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚è¿™ä¸ªæ–¹å¼ä¸ä»…å‡å°‘äº†å†…æ ¸ç”¨æˆ·æ€é—´çš„åˆ‡æ¢ï¼Œè€Œä¸”ä¹Ÿçœå»äº†é‚£æ¬¡éœ€è¦cpuå‚ä¸çš„å¤åˆ¶è¿‡ç¨‹ã€‚ ä»ç”¨æˆ·è§’åº¦æ¥çœ‹ä¾æ—§æ˜¯è°ƒç”¨transferTo()æ–¹æ³•ï¼Œä½†æ˜¯å…¶æœ¬è´¨å‘ç”Ÿäº†å˜åŒ–ï¼š</p><ol><li>è°ƒç”¨transferToæ–¹æ³•åæ•°æ®è¢«DMAä»æ–‡ä»¶å¤åˆ¶åˆ°äº†å†…æ ¸çš„ä¸€ä¸ªç¼“å†²åŒºä¸­ã€‚</li><li>æ•°æ®ä¸å†è¢«å¤åˆ¶åˆ°socketå…³è”çš„ç¼“å†²åŒºä¸­äº†ï¼Œä»…ä»…æ˜¯å°†ä¸€ä¸ªæè¿°ç¬¦ï¼ˆåŒ…å«äº†æ•°æ®çš„ä½ç½®å’Œé•¿åº¦ç­‰ä¿¡æ¯ï¼‰è¿½åŠ åˆ°socketå…³è”çš„ç¼“å†²åŒºä¸­ã€‚DMAç›´æ¥å°†å†…æ ¸ä¸­çš„ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ è¾“ç»™åè®®å¼•æ“ï¼Œæ¶ˆé™¤äº†ä»…å‰©çš„ä¸€æ¬¡éœ€è¦cpuå‘¨æœŸçš„æ•°æ®å¤åˆ¶ã€‚</li></ol><h3 id="5-3-å¯¹äºJAVAæ™®é€šå­—èŠ‚æµIOä¸NIOFileChannelå®ç°çš„é›¶æ‹·è´æ€§èƒ½ï¼š"><a href="#5-3-å¯¹äºJAVAæ™®é€šå­—èŠ‚æµIOä¸NIOFileChannelå®ç°çš„é›¶æ‹·è´æ€§èƒ½ï¼š" class="headerlink" title="5.3 å¯¹äºJAVAæ™®é€šå­—èŠ‚æµIOä¸NIOFileChannelå®ç°çš„é›¶æ‹·è´æ€§èƒ½ï¼š"></a>5.3 å¯¹äºJAVAæ™®é€šå­—èŠ‚æµIOä¸NIOFileChannelå®ç°çš„é›¶æ‹·è´æ€§èƒ½ï¼š</h3><p>ç›´æ¥ä¸Šæºç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedOutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileNotFoundException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileCopyTest</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * é€šè¿‡å­—èŠ‚æµçš„æ–¹å¼å¤åˆ¶æ–‡ä»¶     * @param fromFile æºæ–‡ä»¶     * @param toFile   ç›®æ ‡æ–‡ä»¶     * @throws FileNotFoundException æœªæ‰¾åˆ°æ–‡ä»¶å¼‚å¸¸     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fileCopyNormal</span><span class="token punctuation">(</span><span class="token class-name">File</span> fromFile<span class="token punctuation">,</span> <span class="token class-name">File</span> toFile<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>fromFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>toFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//ç”¨æˆ·æ€ç¼“å†²æœ‰1kBè¿™ä¹ˆå¤§ï¼Œä¸ç®—å°äº†</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> i<span class="token punctuation">;</span>            <span class="token comment">//è¯»å–åˆ°è¾“å…¥æµæ•°æ®ï¼Œç„¶åå†™å…¥åˆ°è¾“å‡ºæµä¸­å»ï¼Œå®ç°å¤åˆ¶</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>inputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>outputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç”¨filechannelè¿›è¡Œæ–‡ä»¶å¤åˆ¶     *     * @param fromFile æºæ–‡ä»¶     * @param toFile   ç›®æ ‡æ–‡ä»¶     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fileCopyWithFileChannel</span><span class="token punctuation">(</span><span class="token class-name">File</span> fromFile<span class="token punctuation">,</span> <span class="token class-name">File</span> toFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">FileOutputStream</span> fileOutputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">FileChannel</span> fileChannelInput <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">FileChannel</span> fileChannelOutput <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>fromFile<span class="token punctuation">)</span><span class="token punctuation">;</span>            fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>toFile<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å¾—åˆ°fileInputStreamçš„æ–‡ä»¶é€šé“</span>            fileChannelInput <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å¾—åˆ°fileOutputStreamçš„æ–‡ä»¶é€šé“</span>            fileChannelOutput <span class="token operator">=</span> fileOutputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å°†fileChannelInputé€šé“çš„æ•°æ®ï¼Œå†™å…¥åˆ°fileChannelOutputé€šé“</span>            fileChannelInput<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileChannelInput<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fileChannelOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>fileInputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>fileChannelInput <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fileChannelInput<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>fileOutputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>fileChannelOutput <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fileChannelOutput<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">File</span> fromFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D:/readFile.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">File</span> toFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D:/outputFile.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//é¢„çƒ­</span>        <span class="token function">fileCopyNormal</span><span class="token punctuation">(</span>fromFile<span class="token punctuation">,</span> toFile<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fileCopyWithFileChannel</span><span class="token punctuation">(</span>fromFile<span class="token punctuation">,</span> toFile<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¡æ—¶</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">fileCopyNormal</span><span class="token punctuation">(</span>fromFile<span class="token punctuation">,</span> toFile<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"fileCopyNormal time: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">fileCopyWithFileChannel</span><span class="token punctuation">(</span>fromFile<span class="token punctuation">,</span> toFile<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"fileCopyWithFileChannel time: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">fileCopyNormal time: 14271fileCopyWithFileChannel time: 6632<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å·®äº†ä¸€å€å¤šçš„æ—¶é—´ï¼ˆæ–‡ä»¶å¤§å°å¤§æ¦‚8MBï¼‰ï¼Œå¦‚æœæ–‡ä»¶æ›´å¤§è¿™ä¸ªå·®è·åº”è¯¥æ›´åŠ æ˜æ˜¾ã€‚</p><h2 id="6-DirectBufferåˆ†é…"><a href="#6-DirectBufferåˆ†é…" class="headerlink" title="6. DirectBufferåˆ†é…"></a>6. DirectBufferåˆ†é…</h2><p>Javaä¸­NIOçš„æ ¸å¿ƒç¼“å†²å°±æ˜¯ByteBufferï¼Œæ‰€æœ‰çš„IOæ“ä½œéƒ½æ˜¯é€šè¿‡è¿™ä¸ªByteBufferè¿›è¡Œçš„ï¼›Bytebufferæœ‰ä¸¤ç§ï¼š <strong>åˆ†é…HeapByteBuffer</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>åˆ†é…DirectByteBuffer</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸¤è€…çš„åŒºåˆ«ï¼š</p><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-efa63bd49d8399351d3d4e8f2288d00b_720w.jpg" alt="img"></p><h3 id="6-1-ä¸ºä½•HeapByteBufferä¼šå¤šä¸€æ¬¡æ‹·è´ï¼Ÿ"><a href="#6-1-ä¸ºä½•HeapByteBufferä¼šå¤šä¸€æ¬¡æ‹·è´ï¼Ÿ" class="headerlink" title="6.1. ä¸ºä½•HeapByteBufferä¼šå¤šä¸€æ¬¡æ‹·è´ï¼Ÿ"></a>6.1. ä¸ºä½•HeapByteBufferä¼šå¤šä¸€æ¬¡æ‹·è´ï¼Ÿ</h3><h3 id="6-1-1-FileChannelçš„force-apiè¯´æ˜"><a href="#6-1-1-FileChannelçš„force-apiè¯´æ˜" class="headerlink" title="6.1.1. FileChannelçš„force apiè¯´æ˜"></a>6.1.1. FileChannelçš„force apiè¯´æ˜</h3><p>FileChannelçš„forceæ–¹æ³•ï¼š FileChannel.force()æ–¹æ³•å°†é€šé“é‡Œå°šæœªå†™å…¥ç£ç›˜çš„æ•°æ®å¼ºåˆ¶å†™åˆ°ç£ç›˜ä¸Šã€‚å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ— æ³•ä¿è¯å†™å…¥åˆ°FileChannelé‡Œçš„æ•°æ®ä¸€å®šä¼šå³æ—¶å†™åˆ°ç£ç›˜ä¸Šã€‚è¦ä¿è¯è¿™ä¸€ç‚¹ï¼Œéœ€è¦è°ƒç”¨force()æ–¹æ³•ã€‚ force()æ–¹æ³•æœ‰ä¸€ä¸ªbooleanç±»å‹çš„å‚æ•°ï¼ŒæŒ‡æ˜æ˜¯å¦åŒæ—¶å°†æ–‡ä»¶å…ƒæ•°æ®ï¼ˆæƒé™ä¿¡æ¯ç­‰ï¼‰å†™åˆ°ç£ç›˜ä¸Šã€‚</p><h3 id="6-1-2-FileChannelå’ŒSocketChannelä¾èµ–çš„IOUtilæºç è§£æ"><a href="#6-1-2-FileChannelå’ŒSocketChannelä¾èµ–çš„IOUtilæºç è§£æ" class="headerlink" title="6.1.2. FileChannelå’ŒSocketChannelä¾èµ–çš„IOUtilæºç è§£æ"></a>6.1.2. FileChannelå’ŒSocketChannelä¾èµ–çš„IOUtilæºç è§£æ</h3><p>æ— è®ºæ˜¯FileChannelè¿˜æ˜¯SocketChannelï¼Œä»–ä»¬çš„è¯»å†™æ–¹æ³•éƒ½ä¾èµ–IOUtilçš„ç›¸åŒæ–¹æ³•ï¼Œæˆ‘ä»¬è¿™é‡Œæ¥çœ‹ä¸‹ï¼š <strong>IOUtil.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">FileDescriptor</span> var0<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> var1<span class="token punctuation">,</span> <span class="token keyword">long</span> var2<span class="token punctuation">,</span> <span class="token class-name">NativeDispatcher</span> var4<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>    <span class="token comment">//å¦‚æœæ˜¯DirectBufferï¼Œç›´æ¥å†™</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>var1 <span class="token keyword">instanceof</span> <span class="token class-name">DirectBuffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">writeFromNativeBuffer</span><span class="token punctuation">(</span>var0<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment">//éDirectBuffer</span>        <span class="token comment">//è·å–å·²ç»è¯»å–åˆ°çš„ä½ç½®</span>        <span class="token keyword">int</span> var5 <span class="token operator">=</span> var1<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–å¯ä»¥è¯»åˆ°çš„ä½ç½®</span>        <span class="token keyword">int</span> var6 <span class="token operator">=</span> var1<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">assert</span> var5 <span class="token operator">&lt;=</span> var6<span class="token punctuation">;</span>        <span class="token comment">//ç”³è¯·ä¸€ä¸ªæºbufferå¯è¯»å¤§å°çš„DirectByteBuffer</span>        <span class="token keyword">int</span> var7 <span class="token operator">=</span> var5 <span class="token operator">&lt;=</span> var6 <span class="token operator">?</span> var6 <span class="token operator">-</span> var5 <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token class-name">ByteBuffer</span> var8 <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getTemporaryDirectBuffer</span><span class="token punctuation">(</span>var7<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> var10<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            var8<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>var1<span class="token punctuation">)</span><span class="token punctuation">;</span>            var8<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            var1<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>var5<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é€šè¿‡DirectBufferå†™</span>            <span class="token keyword">int</span> var9 <span class="token operator">=</span> <span class="token function">writeFromNativeBuffer</span><span class="token punctuation">(</span>var0<span class="token punctuation">,</span> var8<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>var9 <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                var1<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>var5 <span class="token operator">+</span> var9<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            var10 <span class="token operator">=</span> var9<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token comment">//å›æ”¶åˆ†é…çš„DirectByteBuffer</span>            <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">offerFirstTemporaryDirectBuffer</span><span class="token punctuation">(</span>var8<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> var10<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//è¯»çš„æ–¹æ³•å’Œå†™ç±»ä¼¼ï¼Œè¿™é‡Œçœç•¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-1-3-ä¸ºä½•ä¸€å®šè¦å¤åˆ¶åˆ°DirectByteBufferæ¥è¯»å†™ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰"><a href="#6-1-3-ä¸ºä½•ä¸€å®šè¦å¤åˆ¶åˆ°DirectByteBufferæ¥è¯»å†™ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰" class="headerlink" title="6.1.3. ä¸ºä½•ä¸€å®šè¦å¤åˆ¶åˆ°DirectByteBufferæ¥è¯»å†™ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰"></a>6.1.3. ä¸ºä½•ä¸€å®šè¦å¤åˆ¶åˆ°DirectByteBufferæ¥è¯»å†™ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰</h3><p>é¦–å…ˆï¼Œå…ˆè¯´ä¸€ç‚¹ï¼Œæ‰§è¡Œnativeæ–¹æ³•çš„çº¿ç¨‹ï¼Œè¢«è®¤ä¸ºæ˜¯å¤„äºSafePointï¼Œæ‰€ä»¥ï¼Œä¼šå‘ç”Ÿ NIO å¦‚æœä¸å¤åˆ¶åˆ° DirectByteBufferï¼Œå°±ä¼šæœ‰ GC å‘ç”Ÿé‡æ’åˆ—å¯¹è±¡å†…å­˜çš„æƒ…å†µï¼ˆå¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š <a href="https://link.zhihu.com/?target=https://blog.csdn.net/zhxdick/article/details/107450858%EF%BC%89%E3%80%82">https://blog.csdn.net/zhxdick/article/details/107450858ï¼‰ã€‚</a></p><p>ä¼ ç»Ÿ BIO æ˜¯é¢å‘ Stream çš„ï¼Œåº•å±‚å®ç°å¯ä»¥ç†è§£ä¸ºå†™å…¥çš„æ˜¯ byte æ•°ç»„ï¼Œè°ƒç”¨ native æ–¹æ³•å†™å…¥ IOï¼Œä¼ çš„å‚æ•°æ˜¯è¿™ä¸ªæ•°ç»„ï¼Œå°±ç®—GCæ”¹å˜äº†å†…å­˜åœ°å€ï¼Œä½†æ˜¯æ‹¿è¿™ä¸ªæ•°ç»„çš„å¼•ç”¨ç…§æ ·èƒ½æ‰¾åˆ°æœ€æ–°çš„åœ°å€ï¼Œï¼Œå¯¹åº”çš„æ–¹æ³•æ—¶æ˜¯ï¼šFileOutputStream.write</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">byte</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> off<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">boolean</span> append<span class="token punctuation">)</span>        <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä½†æ˜¯NIOï¼Œä¸ºäº†æå‡æ•ˆç‡ï¼Œä¼ çš„æ˜¯å†…å­˜åœ°å€ï¼Œçœå»äº†ä¸€æ¬¡é—´æ¥åº”ç”¨ï¼Œä½†æ˜¯å°±å¿…é¡»ç”¨ DirectByteBuffer é˜²æ­¢å†…å­˜åœ°å€æ”¹å˜ï¼Œå¯¹åº”çš„æ˜¯ NativeDispatcher.write</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">FileDescriptor</span> fd<span class="token punctuation">,</span> <span class="token keyword">long</span> address<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span>        <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é‚£ä¸ºä½•å†…å­˜åœ°å€ä¼šæ”¹å˜å‘¢ï¼ŸGCä¼šå›æ”¶æ— ç”¨å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¼šè¿›è¡Œç¢ç‰‡æ•´ç†ï¼Œç§»åŠ¨å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œæ¥å‡å°‘å†…å­˜ç¢ç‰‡ã€‚DirectByteBufferä¸å—GCæ§åˆ¶ã€‚å¦‚æœä¸ç”¨DirectByteBufferè€Œæ˜¯ç”¨HeapByteBufferï¼Œå¦‚æœåœ¨è°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå‘ç”Ÿäº†GCï¼Œå¯¼è‡´HeapByteBufferå†…å­˜ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯å†…æ ¸æ€å¹¶ä¸èƒ½æ„ŸçŸ¥åˆ°è¿™ä¸ªå˜åŒ–å¯¼è‡´ç³»ç»Ÿè°ƒç”¨è¯»å–æˆ–è€…å†™å…¥é”™è¯¯çš„æ•°æ®ã€‚æ‰€ä»¥ä¸€å®šè¦é€šè¿‡ä¸å—GCå½±å“çš„DirectByteBufferæ¥è¿›è¡ŒIOç³»ç»Ÿè°ƒç”¨ã€‚</p><p>å‡è®¾æˆ‘ä»¬è¦ä»ç½‘ç»œä¸­è¯»å…¥ä¸€æ®µæ•°æ®ï¼Œå†æŠŠè¿™æ®µæ•°æ®å‘é€å‡ºå»çš„è¯ï¼Œé‡‡ç”¨Non-direct ByteBufferçš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">ç½‘ç»œ â€“&gt; ä¸´æ—¶çš„DirectByteBuffer â€“&gt; åº”ç”¨ Non-direct ByteBuffer â€“&gt; ä¸´æ—¶çš„Direct ByteBuffer â€“&gt; ç½‘ç»œ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ç§æ–¹å¼æ˜¯ç›´æ¥åœ¨å †å¤–åˆ†é…ä¸€ä¸ªå†…å­˜(å³ï¼Œnative memory)æ¥å­˜å‚¨æ•°æ®ï¼Œ ç¨‹åºé€šè¿‡JNIç›´æ¥å°†æ•°æ®è¯»/å†™åˆ°å †å¤–å†…å­˜ä¸­ã€‚å› ä¸ºæ•°æ®ç›´æ¥å†™å…¥åˆ°äº†å †å¤–å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼å°±ä¸ä¼šå†åœ¨JVMç®¡æ§çš„å †å†…å†åˆ†é…å†…å­˜æ¥å­˜å‚¨æ•°æ®äº†ï¼Œä¹Ÿå°±ä¸å­˜åœ¨å †å†…å†…å­˜å’Œå †å¤–å†…å­˜æ•°æ®æ‹·è´çš„æ“ä½œäº†ã€‚è¿™æ ·åœ¨è¿›è¡ŒI/Oæ“ä½œæ—¶ï¼Œåªéœ€è¦å°†è¿™ä¸ªå †å¤–å†…å­˜åœ°å€ä¼ ç»™JNIçš„I/Oçš„å‡½æ•°å°±å¥½äº†ã€‚</p><p>é‡‡ç”¨Direct ByteBufferçš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">ç½‘ç»œ â€“&gt; åº”ç”¨ Direct ByteBuffer â€“&gt; ç½‘ç»œ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé™¤å¼€æ„é€ å’Œææ„ä¸´æ—¶Direct ByteBufferçš„æ—¶é—´å¤–ï¼Œèµ·ç è¿˜èƒ½èŠ‚çº¦ä¸¤æ¬¡å†…å­˜æ‹·è´çš„æ—¶é—´ã€‚é‚£ä¹ˆæ˜¯å¦åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½é‡‡ç”¨Direct Bufferå‘¢ï¼Ÿ</p><p>ä¸æ˜¯ã€‚å¯¹äºå¤§éƒ¨åˆ†åº”ç”¨è€Œè¨€ï¼Œä¸¤æ¬¡å†…å­˜æ‹·è´çš„æ—¶é—´å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œè€Œæ„é€ å’Œææ„DirectBufferçš„æ—¶é—´å´ç›¸å¯¹è¾ƒé•¿ã€‚åœ¨JVMçš„å®ç°å½“ä¸­ï¼ŒæŸäº›æ–¹æ³•ä¼šç¼“å­˜ä¸€éƒ¨åˆ†ä¸´æ—¶Direct ByteBufferï¼Œæ„å‘³ç€å¦‚æœé‡‡ç”¨Direct ByteBufferä»…ä»…èƒ½èŠ‚çº¦æ‰ä¸¤æ¬¡å†…å­˜æ‹·è´çš„æ—¶é—´ï¼Œ è€Œæ— æ³•èŠ‚çº¦æ„é€ å’Œææ„çš„æ—¶é—´ã€‚å°±ç”¨Sunçš„å®ç°æ¥è¯´ï¼Œwrite(ByteBuffer)å’Œread(ByteBuffer)æ–¹æ³•éƒ½ä¼šç¼“å­˜ä¸´æ—¶Direct ByteBufferï¼Œè€Œwrite(ByteBuffer[])å’Œread(ByteBuffer[])æ¯æ¬¡éƒ½ç”Ÿæˆæ–°çš„ä¸´æ—¶Direct ByteBufferã€‚</p><h3 id="6-2-ByteBufferåˆ›å»º"><a href="#6-2-ByteBufferåˆ›å»º" class="headerlink" title="6.2. ByteBufferåˆ›å»º"></a>6.2. ByteBufferåˆ›å»º</h3><h3 id="6-2-1-ByteBufferåˆ›å»ºHeapByteBuffer"><a href="#6-2-1-ByteBufferåˆ›å»ºHeapByteBuffer" class="headerlink" title="6.2.1. ByteBufferåˆ›å»ºHeapByteBuffer"></a>6.2.1. ByteBufferåˆ›å»ºHeapByteBuffer</h3><p>åˆ†é…åœ¨å †ä¸Šçš„ï¼Œç›´æ¥ç”±Javaè™šæ‹Ÿæœºè´Ÿè´£åƒåœ¾æ”¶é›†ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„åŒ…è£…ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">HeapByteBuffer</span>    <span class="token keyword">extends</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">{</span>    <span class="token class-name">HeapByteBuffer</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">,</span> <span class="token keyword">int</span> lim<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// package-private</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> lim<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>cap<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/*        hb = new byte[cap];        offset = 0;        */</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ByteBuffer</span>    <span class="token keyword">extends</span> <span class="token class-name">Buffer</span>    <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>    <span class="token comment">// These fields are declared here rather than in Heap-X-Buffer in order to</span>    <span class="token comment">// reduce the number of virtual method invocations needed to access these</span>    <span class="token comment">// values, which is especially costly when coding small buffers.</span>    <span class="token comment">//</span>    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hb<span class="token punctuation">;</span>                  <span class="token comment">// Non-null only for heap buffers</span>    <span class="token keyword">final</span> <span class="token keyword">int</span> offset<span class="token punctuation">;</span>    <span class="token keyword">boolean</span> isReadOnly<span class="token punctuation">;</span>                 <span class="token comment">// Valid only for heap buffers</span>    <span class="token comment">// Creates a new buffer with the given mark, position, limit, capacity,</span>    <span class="token comment">// backing array, and array offset</span>    <span class="token comment">//</span>    <span class="token class-name">ByteBuffer</span><span class="token punctuation">(</span><span class="token keyword">int</span> mark<span class="token punctuation">,</span> <span class="token keyword">int</span> pos<span class="token punctuation">,</span> <span class="token keyword">int</span> lim<span class="token punctuation">,</span> <span class="token keyword">int</span> cap<span class="token punctuation">,</span>   <span class="token comment">// package-private</span>                 <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hb<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>mark<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> lim<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>hb <span class="token operator">=</span> hb<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> offset<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-2-2-DirectByteBuffer"><a href="#6-2-2-DirectByteBuffer" class="headerlink" title="6.2.2. DirectByteBuffer"></a>6.2.2. DirectByteBuffer</h3><p>è¿™ä¸ªç±»å°±æ²¡æœ‰HeapByteBufferç®€å•äº†</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DirectByteBuffer</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token comment">// package-private</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cap<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> pa <span class="token operator">=</span> VM<span class="token punctuation">.</span><span class="token function">isDirectMemoryPageAligned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> ps <span class="token operator">=</span> <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">pageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> size <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>cap <span class="token operator">+</span> <span class="token punctuation">(</span>pa <span class="token operator">?</span> ps <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">reserveMemory</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        base <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">allocateMemory</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OutOfMemoryError</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">unreserveMemory</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">throw</span> x<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    unsafe<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>base <span class="token operator">%</span> ps <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// Round up to page boundary</span>        address <span class="token operator">=</span> base <span class="token operator">+</span> ps <span class="token operator">-</span> <span class="token punctuation">(</span>base <span class="token operator">&amp;</span> <span class="token punctuation">(</span>ps <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        address <span class="token operator">=</span> base<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cleaner <span class="token operator">=</span> <span class="token class-name">Cleaner</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Deallocator</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> size<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    att <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Bits.reserveMemory(size, cap) æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">reserveMemory</span><span class="token punctuation">(</span><span class="token keyword">long</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>memoryLimitSet <span class="token operator">&amp;&amp;</span> VM<span class="token punctuation">.</span><span class="token function">isBooted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            maxMemory <span class="token operator">=</span> VM<span class="token punctuation">.</span><span class="token function">maxDirectMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            memoryLimitSet <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// -XX:MaxDirectMemorySize limits the total capacity rather than the</span>        <span class="token comment">// actual memory usage, which will differ when buffers are page</span>        <span class="token comment">// aligned.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cap <span class="token operator">&lt;=</span> maxMemory <span class="token operator">-</span> totalCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>            reservedMemory <span class="token operator">+=</span> size<span class="token punctuation">;</span>            totalCapacity <span class="token operator">+=</span> cap<span class="token punctuation">;</span>            count<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// Restore interrupt status</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>totalCapacity <span class="token operator">+</span> cap <span class="token operator">&gt;</span> maxMemory<span class="token punctuation">)</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OutOfMemoryError</span><span class="token punctuation">(</span><span class="token string">"Direct buffer memory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        reservedMemory <span class="token operator">+=</span> size<span class="token punctuation">;</span>        totalCapacity <span class="token operator">+=</span> cap<span class="token punctuation">;</span>        count<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨DirectByteBufferä¸­ï¼Œé¦–å…ˆå‘Bitsç±»ç”³è¯·é¢åº¦ï¼ŒBitsç±»æœ‰ä¸€ä¸ªå…¨å±€çš„totalCapacityå˜é‡ï¼Œè®°å½•ç€å…¨éƒ¨DirectByteBufferçš„æ€»å¤§å°ï¼Œæ¯æ¬¡ç”³è¯·ï¼Œéƒ½å…ˆçœ‹çœ‹æ˜¯å¦è¶…é™,å †å¤–å†…å­˜çš„é™é¢é»˜è®¤ä¸å †å†…å†…å­˜(ç”±-Xmx è®¾å®š)ç›¸ä»¿ï¼Œå¯ç”¨ -XX:MaxDirectMemorySize é‡æ–°è®¾å®šã€‚</p><blockquote><p>å¦‚æœä¸æŒ‡å®šï¼Œè¯¥å‚æ•°çš„é»˜è®¤å€¼ä¸ºXmxçš„å€¼å‡å»1ä¸ªSurvioråŒºçš„å€¼ã€‚ å¦‚è®¾ç½®å¯åŠ¨å‚æ•°-Xmx20M -Xmn10M -XXï¼šSurvivorRatio=8,é‚£ä¹ˆç”³è¯·20M-1M=19Mçš„DirectMemory</p></blockquote><p>å¦‚æœå·²ç»è¶…é™ï¼Œä¼šä¸»åŠ¨æ‰§è¡ŒSytem.gc()ï¼ŒæœŸå¾…èƒ½ä¸»åŠ¨å›æ”¶ä¸€ç‚¹å †å¤–å†…å­˜ã€‚System.gc()ä¼šè§¦å‘ä¸€ä¸ªfull gcï¼Œå½“ç„¶å‰ææ˜¯ä½ æ²¡æœ‰æ˜¾ç¤ºçš„è®¾ç½®-XX:+DisableExplicitGCæ¥ç¦ç”¨æ˜¾å¼GCã€‚å¹¶ä¸”ä½ éœ€è¦çŸ¥é“ï¼Œè°ƒç”¨System.gc()å¹¶ä¸èƒ½å¤Ÿä¿è¯full gcé©¬ä¸Šå°±èƒ½è¢«æ‰§è¡Œã€‚ç„¶åä¼‘çœ ä¸€ç™¾æ¯«ç§’ï¼Œçœ‹çœ‹totalCapacityé™ä¸‹æ¥æ²¡æœ‰ï¼Œå¦‚æœå†…å­˜è¿˜æ˜¯ä¸è¶³ï¼Œå°±æŠ›å‡ºOOMå¼‚å¸¸ã€‚å¦‚æœé¢åº¦è¢«æ‰¹å‡†ï¼Œå°±è°ƒç”¨å¤§åé¼é¼çš„sun.misc.Unsafeå»åˆ†é…å†…å­˜,è¿”å›å†…å­˜åŸºåœ°å€</p><p><strong>æ‰€ä»¥ï¼Œä¸€èˆ¬çš„æ¡†æ¶é‡Œé¢ï¼Œä¼šåœ¨å¯åŠ¨æ—¶ç”³è¯·ä¸€å¤§å—DirectByteBufferï¼Œç„¶åè‡ªå·±åšå†…å­˜ç®¡ç†</strong></p><p>æœ€åï¼Œåˆ›å»ºä¸€ä¸ªCleanerï¼Œå¹¶æŠŠä»£è¡¨æ¸…ç†åŠ¨ä½œçš„Deallocatorç±»ç»‘å®š â€“ é™ä½Bitsé‡Œçš„totalCapacityï¼Œå¹¶è°ƒç”¨Unsafeè°ƒfreeå»é‡Šæ”¾å†…å­˜ã€‚</p><h3 id="6-2-3-ByteBufferå›æ”¶"><a href="#6-2-3-ByteBufferå›æ”¶" class="headerlink" title="6.2.3. ByteBufferå›æ”¶"></a>6.2.3. ByteBufferå›æ”¶</h3><p>HeapByteBufferå°±ä¸è¦è¯´äº†ï¼ŒGCå°±å¸®å¿™å¤„ç†äº†ã€‚è¿™å„¿ä¸»è¦è¯´ä¸‹DirectByteBuffer å­˜åœ¨äºå †å†…çš„DirectByteBufferå¯¹è±¡å¾ˆå°ï¼Œåªå­˜ç€åŸºåœ°å€å’Œå¤§å°ç­‰å‡ ä¸ªå±æ€§ï¼Œå’Œä¸€ä¸ªCleanerï¼Œä½†å®ƒä»£è¡¨ç€åé¢æ‰€åˆ†é…çš„ä¸€å¤§æ®µå†…å­˜ï¼Œæ˜¯æ‰€è°“çš„å†°å±±å¯¹è±¡ã€‚</p><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-9927b76bb9f0b3083524b079c5ed52b2_720w.jpg" alt="img"></p><p>å…¶ä¸­firstæ˜¯Cleanerç±»çš„é™æ€å˜é‡ï¼ŒCleanerå¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶ä¼šè¢«æ·»åŠ åˆ°Cleneré“¾è¡¨ä¸­ï¼Œå’Œfirstå½¢æˆå¼•ç”¨å…³ç³»ï¼ŒReferenceQueueæ˜¯ç”¨æ¥ä¿å­˜éœ€è¦å›æ”¶çš„Cleanerå¯¹è±¡ã€‚</p><p>å¦‚æœè¯¥DirectByteBufferå¯¹è±¡åœ¨ä¸€æ¬¡GCä¸­è¢«å›æ”¶äº†</p><p><img src="/2021/05/08/java-dui-zhan-nei-cun-yu-dui-wai-nei-cun/v2-385fcb32ebf4b5fc59ddd1c5548b7e39_720w.jpg" alt="img"></p><p>æ­¤æ—¶ï¼Œåªæœ‰Cleanerå¯¹è±¡å”¯ä¸€ä¿å­˜äº†å †å¤–å†…å­˜çš„æ•°æ®ï¼ˆå¼€å§‹åœ°å€ã€å¤§å°å’Œå®¹é‡ï¼‰ï¼Œåœ¨ä¸‹ä¸€æ¬¡Full GCæ—¶ï¼ŒæŠŠè¯¥Cleanerå¯¹è±¡æ”¾å…¥åˆ°ReferenceQueueä¸­ï¼Œå¹¶è§¦å‘cleanæ–¹æ³•ã€‚</p><p>å¿«é€Ÿå›é¡¾ä¸€ä¸‹å †å†…çš„GCæœºåˆ¶ï¼Œå½“æ–°ç”Ÿä»£æ»¡äº†ï¼Œå°±ä¼šå‘ç”Ÿyoung gcï¼›å¦‚æœæ­¤æ—¶å¯¹è±¡è¿˜æ²¡å¤±æ•ˆï¼Œå°±ä¸ä¼šè¢«å›æ”¶ï¼›æ’‘è¿‡å‡ æ¬¡young gcåï¼Œå¯¹è±¡è¢«è¿ç§»åˆ°è€ç”Ÿä»£ï¼›å½“è€ç”Ÿä»£ä¹Ÿæ»¡äº†ï¼Œå°±ä¼šå‘ç”Ÿfull gcã€‚</p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸€ç§å°´å°¬çš„æƒ…å†µï¼Œå› ä¸ºDirectByteBufferæœ¬èº«çš„ä¸ªå¤´å¾ˆå°ï¼Œåªè¦ç†¬è¿‡äº†young gcï¼Œå³ä½¿å·²ç»å¤±æ•ˆäº†ä¹Ÿèƒ½åœ¨è€ç”Ÿä»£é‡Œèˆ’æœçš„å‘†ç€ï¼Œä¸å®¹æ˜“æŠŠè€ç”Ÿä»£æ’‘çˆ†è§¦å‘full gcï¼Œå¦‚æœæ²¡æœ‰åˆ«çš„å¤§å—å¤´è¿›å…¥è€ç”Ÿä»£è§¦å‘full gcï¼Œå°±ä¸€ç›´åœ¨é‚£è€—ç€ï¼Œå ç€ä¸€å¤§ç‰‡å †å¤–å†…å­˜ä¸é‡Šæ”¾ã€‚</p><p>è¿™æ—¶ï¼Œå°±åªèƒ½é å‰é¢æåˆ°çš„ç”³è¯·é¢åº¦è¶…é™æ—¶è§¦å‘çš„system.gc()æ¥æ•‘åœºäº†ã€‚ä½†è¿™é“æœ€åçš„ä¿é™©å…¶å®ä¹Ÿä¸å¾ˆå¥½ï¼Œé¦–å…ˆå®ƒä¼šä¸­æ–­æ•´ä¸ªè¿›ç¨‹ï¼Œç„¶åå®ƒè®©å½“å‰çº¿ç¨‹ç¡äº†æ•´æ•´ä¸€ç™¾æ¯«ç§’ï¼Œè€Œä¸”å¦‚æœgcæ²¡åœ¨ä¸€ç™¾æ¯«ç§’å†…å®Œæˆï¼Œå®ƒä»ç„¶ä¼šæ— æƒ…çš„æŠ›å‡ºOOMå¼‚å¸¸ã€‚è¿˜æœ‰ï¼Œä¸‡ä¸€ï¼Œä¸‡ä¸€å¤§å®¶è¿·ä¿¡æŸä¸ªè°ƒä¼˜æŒ‡å—è®¾ç½®äº†-DisableExplicitGCç¦æ­¢äº†system.gc()ï¼Œé‚£å°±ä¸å¥½ç©äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå †å¤–å†…å­˜è¿˜æ˜¯è‡ªå·±ä¸»åŠ¨ç‚¹å›æ”¶æ›´å¥½ï¼Œæ¯”å¦‚Nettyå°±æ˜¯è¿™ä¹ˆåšçš„</p><h2 id="7-æŸ¥çœ‹DirectBufferä½¿ç”¨æƒ…å†µçš„æ–¹æ³•ï¼š"><a href="#7-æŸ¥çœ‹DirectBufferä½¿ç”¨æƒ…å†µçš„æ–¹æ³•ï¼š" class="headerlink" title="7. æŸ¥çœ‹DirectBufferä½¿ç”¨æƒ…å†µçš„æ–¹æ³•ï¼š"></a>7. æŸ¥çœ‹DirectBufferä½¿ç”¨æƒ…å†µçš„æ–¹æ³•ï¼š</h2><h3 id="7-1-è¿›ç¨‹å†…è·å–ï¼š"><a href="#7-1-è¿›ç¨‹å†…è·å–ï¼š" class="headerlink" title="7.1. è¿›ç¨‹å†…è·å–ï¼š"></a>7.1. è¿›ç¨‹å†…è·å–ï¼š</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">MBeanServer mbs = ManagementFactory. getPlatformMBeanServer() ;ObjectName objectName = new ObjectName("java.nio:type=BufferPool,name=direct" ) ;MBeanInfo info = mbs.getMBeanInfo(objectName) ;for(MBeanAttributeInfo i : info.getAttributes()) {    System.out .println(i.getName() + ":" + mbs.getAttribute(objectName , i.getName()));}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-2-è¿œç¨‹è¿›ç¨‹"><a href="#7-2-è¿œç¨‹è¿›ç¨‹" class="headerlink" title="7.2. è¿œç¨‹è¿›ç¨‹"></a>7.2. è¿œç¨‹è¿›ç¨‹</h3><p>JMXè·å– å¦‚æœç›®æ ‡æœºå™¨æ²¡æœ‰å¯åŠ¨JMXï¼Œé‚£ä¹ˆæ·»åŠ jvmå‚æ•°ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">-Dcom.sun.management.jmxremote.port=9999 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremotAe.ssl=false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é‡å¯è¿›ç¨‹ ç„¶åæœ¬æœºé€šè¿‡JMXè¿æ¥è®¿é—®ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">String jmxURL = "service:jmx:rmi:///jndi/rmi://10.125.6.204:9999/jmxrmi" ;JMXServiceURL serviceURL = new JMXServiceURL(jmxURL);Map map = new HashMap() ;String[] credentials = new String[] { "monitorRole" , "QED" } ;map.put( "jmx.remote.credentials" , credentials) ;JMXConnector connector = JMXConnectorFactory. connect(serviceURL , map);MBeanServerConnection mbsc = connector.getMBeanServerConnection() ;ObjectName objectName = new ObjectName("java.nio:type=BufferPool,name=direct" ) ;MBeanInfo mbInfo = mbsc.getMBeanInfo(objectName) ;for(MBeanAttributeInfo i : mbInfo.getAttributes()) {    System.out .println(i.getName() + ":" + mbsc.getAttribute(objectName , i.getName()));}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ¬åœ°ä¹Ÿå¯ä»¥é€šè¿‡ JConsole å·¥å…·æŸ¥çœ‹ï¼š</p><p><strong>ä½†æ˜¯æ³¨æ„ï¼Œé‡‡é›†ä¸è¦å¤ªé¢‘ç¹ã€‚å¦åˆ™ä¼šè§¦å‘æ‰€æœ‰çº¿ç¨‹è¿›å…¥å®‰å…¨ç‚¹ï¼ˆä¹Ÿå°±æ˜¯ Stop the worldï¼‰</strong></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>netty</title>
      <link href="2021/05/01/netty/"/>
      <url>2021/05/01/netty/</url>
      
        <content type="html"><![CDATA[<h1 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h1><h2 id="1-IOæ¨¡å‹"><a href="#1-IOæ¨¡å‹" class="headerlink" title="1. IOæ¨¡å‹"></a>1. IOæ¨¡å‹</h2><ul><li>BIO é€‚ç”¨äºè¿æ¥æ•°ç›®è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹äºæœåŠ¡å™¨èµ„æºè¦æ±‚è¾ƒé«˜ï¼Œæœ‰å¹¶å‘å±€é™ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ï¼Œä½†ç¨‹åºç®€å•æ˜“ç†è§£ã€‚åŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµï¼Œä»¥æµçš„æ–¹å¼è¿›è¡Œï¼Œé˜»å¡ã€‚</li><li>NIO é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¼¹å¹•ç³»ç»Ÿï¼ŒæœåŠ¡å™¨é—´é€šè®¯ç­‰ã€‚ç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK1.4å¼€å§‹æ”¯æŒã€‚åŸºäºchannelå’Œbufferï¼Œä»¥å—çš„æ–¹å¼è¿›è¡Œï¼Œä¸é˜»å¡ã€‚</li><li>AIO é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ—¶é—´é•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨OSå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7å¼€å§‹æ”¯æŒã€‚</li></ul><p>nettyåŸºäºNIOã€‚</p><h3 id="1-1-NIO"><a href="#1-1-NIO" class="headerlink" title="1.1 NIO"></a>1.1 NIO</h3><h4 id="1-1-1-buffer"><a href="#1-1-1-buffer" class="headerlink" title="1.1.1 buffer"></a><strong>1.1.1 buffer</strong></h4><p>ï¼ˆä¸ºä»€ä¹ˆï¼‰å®ƒæ˜¯ä¸ºäº†å®ç°ç¼“å†²åŒºçš„æ¦‚å¿µè€Œäº§ç”Ÿçš„ã€‚</p><p>ï¼ˆæ˜¯ä»€ä¹ˆï¼‰æ˜¯ä¸€ç§ç¼“å†²åŒºçš„æŠ½è±¡ç±»ï¼ˆ<code>abstract class</code>ï¼‰ã€‚æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥è¯»å†™æ•°æ®çš„å†…å­˜å—ï¼Œå¯ä»¥ç†è§£æˆæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼ˆå«æ•°ç»„ï¼‰ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥æ›´è½»æ¾åœ°ä½¿ç”¨å†…å­˜å—ï¼Œç¼“å†²åŒºå¯¹è±¡å†…ç½®äº†ä¸€äº›æœºåˆ¶ï¼Œèƒ½å¤Ÿè·Ÿè¸ªå’Œè®°å½•ç¼“å†²åŒºçš„çŠ¶æ€å˜åŒ–æƒ…å†µã€‚</p><p>ï¼ˆæ€ä¹ˆåšï¼‰å››ä¸ªå±æ€§ï¼š</p><p><img src="/2021/05/01/netty/Buffer_nio.PNG"></p><ol><li>capacity å®¹é‡ï¼Œå³å¯ä»¥å®¹çº³çš„æœ€å¤§æ•°æ®é‡ã€‚åœ¨ç¼“å†²åŒºåˆ›å»ºæ—¶è¢«è®¾å®šå¹¶ä¸”ä¸èƒ½æ”¹å˜ã€‚</li><li>limit ç¼“å†²åŒºå½“å‰ç»ˆç‚¹ï¼Œä¸èƒ½å¯¹ç¼“å†²åŒºè¶…è¿‡æé™ä½ç½®è¿›è¡Œè¯»å†™æ“ä½œã€‚ä¸”æé™ä½ç½®å¯ä»¥ä¿®æ”¹çš„</li><li>position ä½ç½®ï¼Œä¸‹ä¸€ä¸ªè¦è¢«è¯»æˆ–å†™çš„å…ƒç´ çš„ç´¢å¼•ï¼Œæ¯æ¬¡è¯»å†™ç¼“å†²åŒºæ•°æ®æ—¶éƒ½ä¼šæ”¹å˜å€¼ï¼Œä¸ºä¸‹æ¬¡è¯»å†™ä½œå‡†å¤‡ã€‚</li><li>mark æ ‡è®°</li></ol><ul><li><p>æ³¨æ„</p><p>bufferä¸­å­˜æ”¾çš„æ•°æ®ç±»å‹ï¼Œæ”¾å…¥å’Œå–é™¤çš„æ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´ã€‚å¦åˆ™æŠ›å‡º<code>BufferUnderflowException</code>å¼‚å¸¸ã€‚</p></li></ul><p>ä½¿ç”¨ï¼š</p><h5 id="1-ReadOnlyBuffer"><a href="#1-ReadOnlyBuffer" class="headerlink" title="1.ReadOnlyBuffer"></a>1.ReadOnlyBuffer</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuffer</span> readBuffer <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">asReadOnlyBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>readOnlyBuffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>readOnlyBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// é”™è¯¯çš„å¼‚å¸¸</span>readOnlyBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ReadOnlyBufferException</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-MappedByteBuffer"><a href="#2-MappedByteBuffer" class="headerlink" title="2. MappedByteBuffer"></a>2. MappedByteBuffer</h5><p>è¿™ä¸ªbufferå¯ä»¥è®©æ–‡ä»¶ç›´æ¥åœ¨å†…å­˜ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè€Œå¦‚ä½•åŒæ­¥åˆ°æ–‡ä»¶ç”±NIOæ¥å®Œæˆã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">RandomAccessFile</span> accessFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–å¯¹åº”çš„é€šé“</span>        <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> accessFile<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**         * ä½¿ç”¨çš„è¯»å†™æ¨¡å¼         * å¯ä»¥ç›´æ¥ä¿®æ”¹çš„è¯»å†™ä½ç½®         * æ˜ å°„åˆ°å†…å­˜çš„å¤§å°ï¼Œå³å°† 1.txt çš„å¤šå°‘ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜         * å¯ä»¥ç›´æ¥ä¿®æ”¹çš„èŒƒå›´æ˜¯ 0-5         */</span>        <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span>MappedByteBuffer</span> mappedByteBuffer <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">FileChannel<span class="token punctuation">.</span>MapMode</span><span class="token punctuation">.</span>READ_WRITE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mappedByteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">'H'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æŠ›å‡ºå¼‚å¸¸ï¼Œè¶…å‡ºç´¢å¼•èŒƒå›´</span>        mappedByteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        accessFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-bufferåˆ†æ•£å’Œèšé›†"><a href="#3-bufferåˆ†æ•£å’Œèšé›†" class="headerlink" title="3. bufferåˆ†æ•£å’Œèšé›†"></a>3. bufferåˆ†æ•£å’Œèšé›†</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>        <span class="token comment">// ä½¿ç”¨ServerSocketChannel å’Œ SocketChannel</span>        <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">InetSocketAddress</span> inetSocketAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>inetSocketAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> byteBuffers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        byteBuffers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        byteBuffers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç­‰å®¢æˆ·ç«¯è¿æ¥</span>        <span class="token comment">// å¾ªç¯è¯»å–</span>        <span class="token keyword">int</span> clientByteLen <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> byteRead <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>byteRead <span class="token operator">&lt;</span> clientByteLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">long</span> read <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffers<span class="token punctuation">)</span><span class="token punctuation">;</span>                byteRead <span class="token operator">+=</span> read<span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"byteRead = "</span> <span class="token operator">+</span> byteRead<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// ä½¿ç”¨æµæ‰“å°ï¼Œçœ‹çœ‹å½“å‰è¿™ä¸ªbufferçš„position å’Œ limit</span>                <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>byteBuffers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>buffer <span class="token operator">-&gt;</span> <span class="token string">"posiiton"</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", limit="</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span> <span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å°†æ‰€æœ‰çš„bufferè¿›è¡Œåè½¬</span>                <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>byteBuffers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>byteBuffer <span class="token operator">-&gt;</span> byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å°†æ•°æ®è¯»å‡ºæ˜¾ç¤ºåˆ°å®¢æˆ·ç«¯</span>                <span class="token keyword">long</span> byteWrite <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>byteWrite <span class="token operator">&lt;</span> clientByteLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">long</span> write <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffers<span class="token punctuation">)</span><span class="token punctuation">;</span>                    byteWrite <span class="token operator">+=</span> write<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>byteBuffers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>byteBuffer <span class="token operator">-&gt;</span> byteBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"byteRead:="</span> <span class="token operator">+</span> byteRead <span class="token operator">+</span> <span class="token string">" byteWrite = "</span> <span class="token operator">+</span> byteWrite<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>1.2 Channel</strong> é€šé“</p><p>ï¼ˆæ˜¯ä»€ä¹ˆï¼‰æ˜¯ä¸€ä¸ªæ¥å£(interface)</p><ul><li>é€šé“å¯ä»¥åŒæ—¶è¯»å†™ï¼Œè€Œæµåªèƒ½è¯»æˆ–è€…åªèƒ½å†™</li><li>é€šé“å¯ä»¥å®ç°å¼‚æ­¥è¯»å†™æ•°æ®</li><li>å¯ä»¥ä»ç¼“å†²åŒºè¯»æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æ•°æ®åˆ°ç¼“å†²</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Channel</span> <span class="token keyword">extends</span> <span class="token class-name">Closeable</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * Tells whether or not this channel is open.     *     * @return &lt;tt&gt;true&lt;/tt&gt; if, and only if, this channel is open     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * Closes this channel.     *     * &lt;p&gt; After a channel is closed, any further attempt to invoke I/O     * operations upon it will cause a {@link ClosedChannelException} to be     * thrown.     *     * &lt;p&gt; If this channel is already closed then invoking this method has no     * effect.     *     * &lt;p&gt; This method may be invoked at any time.  If some other thread has     * already invoked it, however, then another invocation will block until     * the first invocation is complete, after which it will return without     * effect. &lt;/p&gt;     *     * @throws  IOException  If an I/O error occurs     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¸¸ç”¨çš„<code>Channel</code>ç±»æœ‰ï¼š<code>FileChannel</code>ã€<code>DatagramChannel</code>ã€<code>ServerSocketChannel</code>å’Œ<code>SocketChannel</code>ã€‚</p><p><code>FileChannel</code>ç”¨äºæ–‡ä»¶çš„è¯»å†™ï¼Œ<code>DatagramChannel</code>ç”¨äºUDPçš„æ•°æ®è¯»å†™ï¼Œ<code>ServerSocketChannel</code>å’Œ<code>SocketChannel</code>ç”¨äºTCPçš„æ•°æ®è¯»å†™ã€‚</p><h3 id="1-2-Selector"><a href="#1-2-Selector" class="headerlink" title="1.2 Selector"></a><strong>1.2 Selector</strong></h3><p>æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>Selectorèƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿã€‚æ³¨æ„ï¼šå¤šä¸ªChannelä»¥äº‹ä»¶çš„æ–¹å¼å¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ªSelectorã€‚å¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¾¿è·å–äº‹ä»¶ç„¶åé’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚è¿™æ ·å°±å¯ä»¥åªç”¨ä¸€ä¸ªå•çº¿ç¨‹å»ç®¡ç†å¤šä¸ªé€šé“ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å¤šä¸ªè¿æ¥å’Œè¯·æ±‚ã€‚</p><p>æ€ä¹ˆåšï¼Ÿ</p><p>Nettyçš„IOçº¿ç¨‹<code>NioEventLoop</code>èšåˆäº†<code>Selectorï¼ˆé€‰æ‹©å™¨ï¼‰</code>ï¼ˆä¹Ÿå«å¤šè·¯å¤ç”¨å™¨ï¼‰ï¼Œå¯ä»¥åŒæ—¶å¹¶å‘å¤„ç†æˆç™¾ä¸Šåƒä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚</p><p>å½“çº¿ç¨‹ä»æŸå®¢æˆ·ç«¯Socketé€šé“è¿›è¡Œè¯»å†™æ•°æ®æ—¶ï¼Œè‹¥æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œè¯¥çº¿ç¨‹å¯ä»¥è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚</p><h5 id="1-å®ç°"><a href="#1-å®ç°" class="headerlink" title="1. å®ç°"></a>1. å®ç°</h5><p>Selectorç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»</p><ul><li><p>select()é˜»å¡ã€‚</p></li><li><p>select(long timeout) ç›‘æ§æ‰€æœ‰æ³¨å†Œçš„é€šé“ï¼Œå½“å…¶ä¸­æœ‰IOæ“ä½œå¯ä»¥è¿›è¡Œæ—¶ï¼Œå°†å¯¹åº”çš„<code>SelectionKey</code>åŠ å…¥åˆ°å†…éƒ¨é›†åˆä¸­å¹¶è¿”å›ï¼Œå‚æ•°ç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p></li><li><p>wakeup() å”¤é†’selector</p></li><li><p>selectNow() ä¸é˜»å¡ï¼Œç«‹é©¬è¿”å›ã€‚</p></li><li><p>Set<selectionkey> selectedKeys(); //ä»å†…éƒ¨é›†åˆä¸­å¾—åˆ°æ‰€æœ‰çš„SelectionKeyã€‚</selectionkey></p></li></ul><h5 id="2-NIO-éé˜»å¡ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾"><a href="#2-NIO-éé˜»å¡ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾" class="headerlink" title="2. NIO éé˜»å¡ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾"></a>2. NIO éé˜»å¡ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾</h5><ol><li>å½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä¼šé€šè¿‡<code>ServerSocketChannel</code>å¾—åˆ°<code>SocketChannel</code>ã€‚</li><li>å°†socketChannelæ³¨å†Œåˆ°Selectorä¸Šï¼Œregister(Selector sel, int ops)ï¼Œ ä¸€ä¸ªselectorä¸Šå¯ä»¥æ³¨å†Œå¤šä¸ªSocketChannelã€‚</li><li>æ³¨å†Œåè¿”å›ä¸€ä¸ªSelectionKeyï¼Œä¼šå’Œè¯¥Selectorå…³è”ï¼ˆé›†åˆï¼‰ã€‚</li><li>Selectorè¿›è¡Œç›‘å¬selectæ–¹æ³•ï¼Œè¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„é€šé“çš„ä¸ªæ•°ã€‚</li><li>è¿›ä¸€æ­¥å¾—åˆ°å„ä¸ªSelectionKeyã€‚</li><li>å†é€šè¿‡SelectionKeyå¾—åˆ°æ³¨å†Œçš„Channelã€‚</li><li>é€šè¿‡å¾—åˆ°çš„Channelå®Œæˆä¸šåŠ¡å¤„ç†ã€‚</li></ol><h2 id="2-é›¶æ‹·è´"><a href="#2-é›¶æ‹·è´" class="headerlink" title="2. é›¶æ‹·è´"></a>2. é›¶æ‹·è´</h2><p>é›¶æ‹·è´æŒ‡çš„æ˜¯ä»æ“ä½œç³»ç»Ÿè§’åº¦çœ‹çš„ï¼Œ<strong>ä¸æ˜¯ä¸æ‹·è´ï¼Œè€Œæ˜¯æ²¡æœ‰CPUæ‹·è´</strong>ã€‚</p><p>ä¼ ç»ŸIOï¼Œå››æ¬¡æ‹·è´ï¼Œä¸‰æ¬¡åˆ‡æ¢ã€‚</p><p><img src="/2021/05/01/netty/image-20210814204450894.png" alt="image-20210814204450894"></p><h3 id="3-1-mmapä¼˜åŒ–"><a href="#3-1-mmapä¼˜åŒ–" class="headerlink" title="3.1 mmapä¼˜åŒ–"></a>3.1 mmapä¼˜åŒ–</h3><ul><li>mmapé€šè¿‡å†…å­˜æ˜ å°„ï¼Œå°†æ–‡ä»¶æ˜ å°„åˆ°å†…æ ¸ç¼“å†²åŒºï¼ŒåŒæ—¶ï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥å…±äº«å†…æ ¸ç©ºé—´çš„æ•°æ®ã€‚è¿™æ ·ï¼Œåœ¨è¿›è¡Œç½‘ç»œä¼ è¾“æ—¶ï¼Œå°±å¯ä»¥å‡å°‘å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´æ¬¡æ•°ã€‚</li></ul><p>æ‹·è´å‡å°‘ä¸º3æ¬¡ï¼Œå†…æ ¸æ€å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ä»ç„¶ä¸º3æ¬¡ã€‚è¿™æ˜¯ç”±äºç”¨æˆ·bufferå’Œå†…æ ¸bufferå…±äº«ï¼Œæ‰€ä»¥å°‘äº†ä¸€æ¬¡kennel bufferæ‹·è´åˆ°user bufferçš„æ‹·è´ã€‚</p><p>é€‚åˆå°æ•°æ®é‡ã€‚</p><h3 id="3-2-sendfile-ä¼˜åŒ–ï¼ˆè¿™ä¸ªå‡½æ•°ï¼‰"><a href="#3-2-sendfile-ä¼˜åŒ–ï¼ˆè¿™ä¸ªå‡½æ•°ï¼‰" class="headerlink" title="3.2 sendfile ä¼˜åŒ–ï¼ˆè¿™ä¸ªå‡½æ•°ï¼‰"></a>3.2 sendfile ä¼˜åŒ–ï¼ˆè¿™ä¸ªå‡½æ•°ï¼‰</h3><p><img src="/2021/05/01/netty/image-20210814204743936.png" alt="image-20210814204743936"></p><p>åŸºæœ¬åŸç†ï¼šç›´æ¥ä»å†…æ ¸ç¼“å†²åŒºè¿›å…¥åˆ°Socket Bufferã€‚åŒæ—¶ï¼Œç”±äºå’Œç”¨æˆ·æ€å®Œå…¨æ— å…³ï¼Œå‡å°‘äº†ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p>é€‚åˆå¤§æ–‡ä»¶ä¼ è¾“ã€‚</p><p>åªéœ€è¦ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œæœ€å°‘2æ¬¡æ•°æ®æ‹·è´ã€‚</p><p>ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œå…¶å®ä¹Ÿè¿›è¡Œäº†CPUæ‹·è´ï¼Œkernel bufferåˆ°socket bufferä½†æ˜¯æ‹·è´çš„ä¿¡æ¯å¾ˆå°‘ï¼Œæ¯”å¦‚kernel bufferçš„lengthå’Œoffsetï¼Œåªä¸è¿‡æ¶ˆè€—ä½å¯ä»¥å¿½ç•¥ï¼Œç›¸å½“äºè¿™æ¬¡æ‹·è´åŠ¨ä½œæ²¡æœ‰äº†ã€‚</p><h3 id="3-3-javaä¸­çš„Reactorå’ŒProactor"><a href="#3-3-javaä¸­çš„Reactorå’ŒProactor" class="headerlink" title="3.3 javaä¸­çš„Reactorå’ŒProactor"></a>3.3 javaä¸­çš„Reactorå’ŒProactor</h3><p>javaä¸­çš„NIOå°±æ˜¯Reactorï¼Œå½“æœ‰æ—¶é—´å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡ç«¯å¾—åˆ°é€šçŸ¥ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p><p>AIOä½¿ç”¨Proactoræ¨¡å¼ï¼Œæœ‰æ•ˆçš„è¯·æ±‚æ‰å¯åŠ¨çº¿ç¨‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…ˆç”±æ“ä½œç³»ç»Ÿå®Œæˆåæ‰é€šçŸ¥æœåŠ¡ç«¯ç¨‹åºå¯åŠ¨çº¿ç¨‹å»å¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äºè¿æ¥æ•°è¾ƒå¤šä¸”è¿æ¥æ—¶é—´è¾ƒé•¿çš„åº”ç”¨ã€‚</p><h2 id="3-netty-æ¶æ„"><a href="#3-netty-æ¶æ„" class="headerlink" title="3. netty æ¶æ„"></a>3. netty æ¶æ„</h2><h3 id="3-1-å…¶ä»–çº¿ç¨‹æ¨¡å‹"><a href="#3-1-å…¶ä»–çº¿ç¨‹æ¨¡å‹" class="headerlink" title="3.1 å…¶ä»–çº¿ç¨‹æ¨¡å‹"></a>3.1 å…¶ä»–çº¿ç¨‹æ¨¡å‹</h3><p>ä¸åŒçš„çº¿ç¨‹æ¨¡å‹å¯¹ç¨‹åºçš„æ€§èƒ½å½±å“å¾ˆå¤§ã€‚</p><ul><li>ä¼ ç»Ÿé˜»å¡IOæ¨¡å¼</li><li>Reactoræ¨¡å¼<ul><li>å•Reactorå•çº¿ç¨‹</li><li>å•Reactorå¤šçº¿ç¨‹</li><li>ä¸»ä»Reactorå¤šçº¿ç¨‹</li></ul></li></ul><h4 id=""><a href="#" class="headerlink" title=""></a></h4><p><img src="/2021/05/01/netty/image-20210819201348411.png" alt="image-20210819201348411"></p><p>è“è‰²çš„æ¡†å­è¡¨ç¤ºçº¿ç¨‹ï¼Œç™½è‰²çš„æ¡†å­è¡¨ç¤ºæ–¹æ³•ï¼Œé»„è‰²çš„æ¡†å­è¡¨ç¤ºå¯¹è±¡ã€‚</p><h4 id="ä¼ ç»Ÿçš„å­˜åœ¨çš„é—®é¢˜"><a href="#ä¼ ç»Ÿçš„å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿçš„å­˜åœ¨çš„é—®é¢˜"></a>ä¼ ç»Ÿçš„å­˜åœ¨çš„é—®é¢˜</h4><ol><li>å½“å¹¶å‘æ•°å¾ˆå¤§ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œå ç”¨å¾ˆå¤§ç³»ç»Ÿèµ„æºã€‚</li><li>è¿æ¥åˆ›å»ºåï¼Œå¦‚æœå½“å‰çº¿ç¨‹æš‚æ—¶æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œè¯¥çº¿ç¨‹ä¼šé˜»å¡åœ¨readæ“ä½œï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹ã€‚</li></ol><h4 id="Reactor"><a href="#Reactor" class="headerlink" title="Reactor"></a>Reactor</h4><p><img src="/2021/05/01/netty/image-20210819202453405.png" alt="image-20210819202453405"></p><ol><li>åŸºäºIOå¤ç”¨æ¨¡å‹ï¼šå¤šä¸ªè¿æ¥å…±ç”¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦åœ¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ç­‰å¾…ï¼Œæ— éœ€é˜»å¡ç­‰å¾…æ‰€æœ‰è¿æ¥ã€‚å½“æŸä¸ªè¿æ¥æœ‰æ–°çš„æ•°æ®å¯ä»¥å¤„ç†æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œçº¿ç¨‹ä»é˜»å¡çŠ¶æ€è¿”å›ï¼Œå¼€å§‹è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚</li><li>é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥è¯·æ±‚ï¼ŒåŒæ—¶ä¼ é€’ç»™æœåŠ¡å¤„ç†å™¨çš„æ¨¡å¼ï¼ˆåŸºäºäº‹ä»¶é©±åŠ¨ï¼‰</li><li>æœåŠ¡å™¨ç«¯ç¨‹åºä¼šå¤„ç†ä¼ å…¥çš„å¤šä¸ªå¤šä¸ªè¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬åŒæ­¥åˆ†æ´¾ç›¸åº”çš„å¤„ç†çº¿ç¨‹ã€‚å› æ­¤Reactoræ¨¡å¼ä¹Ÿå«Dispatcheræ¨¡å¼ã€‚</li></ol><h3 id="3-2-nettyçº¿ç¨‹æ¨¡å‹"><a href="#3-2-nettyçº¿ç¨‹æ¨¡å‹" class="headerlink" title="3.2 nettyçº¿ç¨‹æ¨¡å‹"></a>3.2 nettyçº¿ç¨‹æ¨¡å‹</h3><h4 id="3-3-2-å•Reactorå•çº¿ç¨‹"><a href="#3-3-2-å•Reactorå•çº¿ç¨‹" class="headerlink" title="3.3.2 å•Reactorå•çº¿ç¨‹"></a>3.3.2 å•Reactorå•çº¿ç¨‹</h4><p><img src="/2021/05/01/netty/image-20210819202920042.png" alt="image-20210819202920042"></p><p>åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå†æ¥ä¸€ä¸ªè¯·æ±‚ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨å¤„ç†ä¸šåŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆé˜»å¡ã€‚äºæ˜¯äº§ç”Ÿäº†å•Reactorå¤šçº¿ç¨‹æ¨¡å‹ã€‚</p><h4 id="3-3-3-å•Reactorå¤šçº¿ç¨‹"><a href="#3-3-3-å•Reactorå¤šçº¿ç¨‹" class="headerlink" title="3.3.3 å•Reactorå¤šçº¿ç¨‹"></a>3.3.3 å•Reactorå¤šçº¿ç¨‹</h4><p><img src="/2021/05/01/netty/image-20210819204412985.png" alt="image-20210819204412985"></p><p>é€šè¿‡selectç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œé€šè¿‡dispatcherè¿›è¡Œåˆ†å‘ã€‚</p><p>å¦‚æœå»ºç«‹è¿æ¥è¯·æ±‚ï¼Œåˆ™é€šè¿‡Acceptoré€šè¿‡acceptå¤„ç†è¿æ¥è¯·æ±‚ï¼Œåˆ›å»ºHandlerå¯¹è±¡å¤„ç†å®Œæˆè¿æ¥åçš„å„ç§äº‹ä»¶ã€‚å¦‚æœä¸æ˜¯è¿æ¥è¯·æ±‚ï¼Œåˆ™ç”±reactoråˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„handleræ¥å¤„ç†ã€‚workerçº¿ç¨‹æ± ä¼šåˆ†é…çº¿ç¨‹å¤„ç†çœŸæ­£çš„ä¸šåŠ¡ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™handlerã€‚</p><p>ä¼˜ç‚¹ï¼šå¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„å¤„ç†èƒ½åŠ›ã€‚</p><p>ç¼ºç‚¹ï¼šå¤šçº¿ç¨‹ä¼šæ•°æ®å…±äº«å’Œè®¿é—®æ¯”è¾ƒå¤æ‚ã€‚reactorä¼šå¤„ç†æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯å®¹æ˜“å‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚</p><p>åŸºäºä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹ï¼Œ</p><p>å¹¶ä¸”å¯¹å…¶è¿›è¡Œäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹æœ‰å¤šä¸ªReactorã€‚</p><p><img src="/2021/05/01/netty/image-20210819210103212.png" alt="image-20210819210103212"></p><ol><li>Reactorä¸»çº¿ç¨‹MainReactorå¯¹è±¡é€šè¿‡selectç›‘å¬è¿æ¥äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼ŒMainReactorå°†è¿æ¥åˆ†é…ç»™SubReactorã€‚</li><li>SubReactorå°†è¿æ¥åŠ å…¥åˆ°è¿æ¥é˜Ÿåˆ—è¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ›å»ºhandlerè¿›è¡Œå¤„ç†ã€‚</li><li>å½“æœ‰æ–°äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œsubreactorå°±ä¼šè°ƒç”¨å¯¹åº”çš„handlerå¤„ç†ã€‚</li><li>handleré€šè¿‡readè¯»å–æ•°æ®ï¼Œåˆ†å‘ç»™åé¢çš„workerçº¿ç¨‹å¤„ç†ã€‚</li><li>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯¹ä¸šåŠ¡è¿›è¡Œå¤„ç†å¹¶è¿”å›ç»™handlerï¼Œhandlerå°†ç»“æœç»™å®¢æˆ·ç«¯ã€‚</li></ol><h4 id="nettyæ¨¡å‹çš„ä»‹ç»ï¼š"><a href="#nettyæ¨¡å‹çš„ä»‹ç»ï¼š" class="headerlink" title="nettyæ¨¡å‹çš„ä»‹ç»ï¼š"></a>nettyæ¨¡å‹çš„ä»‹ç»ï¼š</h4><p><img src="/2021/05/01/netty/image-20210820190525188.png" alt="image-20210820190525188"></p><p>ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯å’Œä¸»ä»ç±»ä¼¼ï¼Œä½†æ˜¯è¿™ä¸ªåˆ†äº†ä¸¤ä¸ªgroup = Boss group + worker groupã€‚Bossgroupé‡Œé¢å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹Acceptå’Œå¤„ç†selectorï¼Œå°†selectoræ³¨å†Œåˆ°Workergroupä¸­ã€‚</p><p>ç„¶åWorkergroupé‡Œé¢ä¹Ÿæœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å»å¤„ç†read write å’Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> netty </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Propertiesç±»Java</title>
      <link href="2021/04/27/properties-lei-java/"/>
      <url>2021/04/27/properties-lei-java/</url>
      
        <content type="html"><![CDATA[<h1 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h1><p><img src="/2021/04/27/properties-lei-java/UMLProperties%E7%B1%BB%E5%9B%BE.PNG"></p><p>å®ƒæä¾›äº†å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š</p><ol><li><code>getProperty(String key)</code>ï¼Œç”¨æŒ‡å®šçš„é”®åœ¨æ­¤å±æ€§åˆ—è¡¨ä¸­æœç´¢å±æ€§ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡å‚æ•°keyï¼Œå¾—åˆ°keyæ‰€å¯¹åº”çš„valueã€‚</li><li><code>load(InputStream inStream)</code>ï¼Œä»è¾“å…¥æµä¸­è¯»å–å±æ€§åˆ—è¡¨ï¼ˆé”®å’Œå…ƒç´ å¯¹ï¼‰ã€‚</li><li><code>setProperty(String key, String value)</code>ï¼Œè°ƒç”¨Hashtableçš„æ–¹æ³•putã€‚ä»–é€šè¿‡è°ƒç”¨åŸºç±»çš„putæ–¹æ³•æ¥è®¾ç½®é”®å€¼å¯¹ã€‚</li><li><code>store(OutputStream out, String comments)</code>ï¼Œä½¿ç”¨loadæ–¹æ³•åŠ è½½åˆ°Propertiesè¡¨ä¸­çš„æ ¼å¼ï¼Œå°†æ­¤Propertiesè¡¨ä¸­çš„å±æ€§åˆ—è¡¨ï¼ˆé”®å’Œå…ƒç´ å¯¹ï¼‰å†™å…¥è¾“å…¥æµã€‚ä¸loadæ–¹æ³•ç›¸åï¼Œè¯¥æ–¹æ³•å°†é”®å€¼å¯¹å†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­å»ã€‚ </li><li><code>clear()</code>ï¼Œæ¸…é™¤æ‰€æœ‰è£…è½½çš„é”®å€¼å¯¹ã€‚è¯¥æ–¹æ³•åœ¨åŸºç±»ä¸­æä¾›ã€‚</li></ol><h3 id="2-è¯»å–æ–‡ä»¶"><a href="#2-è¯»å–æ–‡ä»¶" class="headerlink" title="2. è¯»å–æ–‡ä»¶"></a>2. è¯»å–æ–‡ä»¶</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"èµ„æºName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dubbo</title>
      <link href="2021/04/23/dubbo/"/>
      <url>2021/04/23/dubbo/</url>
      
        <content type="html"><![CDATA[<h1 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h1><h2 id="1-åˆ†å¸ƒå¼åŸºç¡€"><a href="#1-åˆ†å¸ƒå¼åŸºç¡€" class="headerlink" title="1. åˆ†å¸ƒå¼åŸºç¡€"></a>1. åˆ†å¸ƒå¼åŸºç¡€</h2><h3 id="1-1-ä¸ºä»€ä¹ˆ"><a href="#1-1-ä¸ºä»€ä¹ˆ" class="headerlink" title="1.1 ä¸ºä»€ä¹ˆ"></a>1.1 ä¸ºä»€ä¹ˆ</h3><p>éšç€åº”ç”¨è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œå¸¸è§„çš„å‚ç›´åº”ç”¨æ¶æ„å·²ç»æ— æ³•åº”å¯¹ï¼Œåˆ†å¸ƒå¼æœåŠ¡æ¶æ„ä»¥åŠæµåŠ¨è®¡ç®—æ¶æ„åŠ¿åœ¨å¿…è¡Œã€‚åˆ†å¸ƒå¼ç³»ç»Ÿè§„æ¨¡å¦‚æœåšå¤§ï¼Œå¤šå°æœºå­ä¹‹é—´çš„äº¤äº’å¦‚ä½•è¿›è¡Œå¤„ç†éœ€è¦ä¸€ç§æœºåˆ¶è¿›è¡Œä¿è¯ï¼Œäºæ˜¯å‡ºç°äº†dubboã€‚</p><p>å¦‚æœå‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤š</p><ul><li>ç•Œé¢å’Œä¸šåŠ¡é€»è¾‘çš„å®ç°å¦‚ä½•è¿›è¡Œåˆ†ç¦»ã€‚</li><li>å„ä¸ªåº”ç”¨ä¹‹é—´éœ€è¦äº’ç›¸è°ƒç”¨ã€‚</li><li>ã€‚ã€‚ã€‚</li></ul><h3 id="1-2-æ˜¯ä»€ä¹ˆ"><a href="#1-2-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1.2 æ˜¯ä»€ä¹ˆ"></a>1.2 æ˜¯ä»€ä¹ˆ</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯è‹¥å¹²ç‹¬ç«‹è®¡ç®—æœºçš„é›†åˆï¼Œè¿™äº›è®¡ç®—æœºå¯¹äºç”¨æˆ·æ¥è¯´å°±åƒå•ä¸ªç›¸å…³ç³»ç»Ÿã€‚</p><h3 id="1-3-æ€ä¹ˆåš"><a href="#1-3-æ€ä¹ˆåš" class="headerlink" title="1.3 æ€ä¹ˆåš"></a>1.3 æ€ä¹ˆåš</h3><p>ä¸¤ä¸ªä¸åŒçš„æœåŠ¡åœ¨ä¸¤ä¸ªä¸åŒçš„æœºå­Aã€Bä¸Šï¼ŒAè¦è°ƒç”¨Bçš„ä¿¡æ¯ï¼Œå°±éœ€è¦ä½¿ç”¨<font color="greeb">è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</font>(RPC)ã€‚å°†ä¸€ä¸ªå¤§åº”ç”¨æ‹†æˆå‡ ä¸ªç‹¬ç«‹çš„å°åº”ç”¨ã€‚</p><p><img src="/2021/04/23/dubbo/RPC%E6%A1%86%E6%9E%B6.PNG"></p><center>RPCæ¡†æ¶åŸºæœ¬åŸç†</center><h3 id="1-4-å¹‚ç­‰"><a href="#1-4-å¹‚ç­‰" class="headerlink" title="1.4 å¹‚ç­‰"></a>1.4 å¹‚ç­‰</h3><p>å¹‚ç­‰ï¼ˆè®¾ç½®é‡ç½®æ¬¡æ•°ï¼‰ã€æŸ¥è¯¢ã€åˆ é™¤ã€ä¿®æ”¹ã€‘ã€éå¹‚ç­‰ï¼ˆä¸èƒ½è®¾ç½®é‡è¯•æ¬¡æ•°ï¼‰ã€æ–°å¢ã€‘ã€‚</p><p><code>retries = "0"</code> dubboä¸­çš„<code>retries</code>ä¸­çš„æ¬¡æ•°ï¼Œä¸åŒ…æ‹¬ç¬¬ä¸€æ¬¡å°è¯•ï¼Œæ‰€ä»¥æœ€ç»ˆå°è¯•æ¬¡æ•°=retries + 1ï¼›</p><h2 id="3-æ•´åˆSpringBoot"><a href="#3-æ•´åˆSpringBoot" class="headerlink" title="3. æ•´åˆSpringBoot"></a>3. æ•´åˆSpringBoot</h2><ol><li>å¯¼å…¥dubbo-starterï¼Œåœ¨application.propertiesé…ç½®å±æ€§ï¼Œä½¿ç”¨@Serviceã€æš´éœ²æœåŠ¡ã€‘ä½¿ç”¨@Referenceã€å¼•ç”¨æœåŠ¡ã€‘</li><li>ä¿ç•™dubbo xmlé…ç½®æ–‡ä»¶ã€‚å¯¼å…¥dubbo-starterï¼Œä½¿ç”¨@ImportResourceå¯¼å…¥dubboçš„é…ç½®æ–‡ä»¶å³å¯ã€‚</li></ol><p><code>@ImportResource("xxx.xml")</code></p><ol start="3"><li>ä½¿ç”¨æ³¨è§£APIæ–¹å¼ã€‚å•ç‹¬å†™ä¸€ä¸ªé…ç½®ç±»ï¼Œæ‰‹åŠ¨é…ç½®åˆ°å®¹å™¨ä¸­ã€‚è®©dubboæ‰«æå…¶ä¸­çš„ç»„ä»¶ã€‚</li></ol><h3 id="3-1-æ˜ å°„è§„åˆ™"><a href="#3-1-æ˜ å°„è§„åˆ™" class="headerlink" title="3.1 æ˜ å°„è§„åˆ™"></a>3.1 æ˜ å°„è§„åˆ™</h3><p>å®˜ç½‘ï¼š<a href="https://dubbo.apache.org/zh/docs/v2.7/user/configuration/properties/">å±æ€§é…ç½® | Apache Dubbo</a></p><h3 id="3-2-å¤šç‰ˆæœ¬"><a href="#3-2-å¤šç‰ˆæœ¬" class="headerlink" title="3.2 å¤šç‰ˆæœ¬"></a>3.2 å¤šç‰ˆæœ¬</h3><h3 id="3-2-1-æ˜¯ä»€ä¹ˆ"><a href="#3-2-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="3.2.1 æ˜¯ä»€ä¹ˆ"></a>3.2.1 æ˜¯ä»€ä¹ˆ</h3><p>å½“ä»£ç å‡çº§å‡ºç°ä¸å…¼å®¹æ—¶ï¼Œå¯ä»¥ç”¨ç‰ˆæœ¬å·è¿‡æ¸¡ï¼Œç‰ˆæœ¬å·ä¸åŒçš„æœåŠ¡ç›¸äº’é—´ä¸å¼•ç”¨ã€‚</p><h3 id="3-2-1-Dubbo-æ¶æ„"><a href="#3-2-1-Dubbo-æ¶æ„" class="headerlink" title="3.2.1 Dubbo æ¶æ„"></a>3.2.1 Dubbo æ¶æ„</h3><p><img src="/2021/04/23/dubbo/image-20210514212315189.png" alt="image-20210514212315189"></p><p>æœåŠ¡æä¾›è€…<code>provider</code>ï¼Œå°†æä¾›çš„æœåŠ¡æ³¨å†Œåˆ°<code>Registry</code>ã€‚Registryå¯ä»¥é€šè¿‡é•¿è¿æ¥çš„æ–¹å¼å°†è¿™æ¬¡æœåŠ¡å˜æ›´å‘é€ç»™æ¶ˆè´¹è€…ã€‚</p><p>æ‰€ä»¥åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œåº”è¯¥å…ˆæŠŠæœåŠ¡å†™å¥½ï¼Œæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œç„¶åæ¶ˆè´¹è€…è¿›è¡Œè°ƒç”¨ã€‚</p><h3 id="3-3-æœåŠ¡å­˜æ ¹"><a href="#3-3-æœåŠ¡å­˜æ ¹" class="headerlink" title="3.3 æœåŠ¡å­˜æ ¹"></a>3.3 æœåŠ¡å­˜æ ¹</h3><h4 id="3-3-1-ä¸ºä»€ä¹ˆ"><a href="#3-3-1-ä¸ºä»€ä¹ˆ" class="headerlink" title="3.3.1 ä¸ºä»€ä¹ˆ"></a>3.3.1 ä¸ºä»€ä¹ˆ</h4><p>ä¸»è¦æ˜¯åœ¨è°ƒç”¨è¿œç¨‹æœåŠ¡ä¹‹å‰ï¼Œåšä¸€äº›åˆ¤æ–­æˆ–è€…å®ç°ä¸€äº›å°åŠŸèƒ½ç­‰ã€‚åˆ¤æ–­é€šè¿‡åï¼Œå†å»è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚</p><h4 id="3-3-2-æ˜¯ä»€ä¹ˆ"><a href="#3-3-2-æ˜¯ä»€ä¹ˆ" class="headerlink" title="3.3.2 æ˜¯ä»€ä¹ˆ"></a>3.3.2 æ˜¯ä»€ä¹ˆ</h4><p>åˆ©ç”¨æœ¬åœ°å­˜æ ¹åœ¨å®¢æˆ·ç«¯æ‰§è¡Œéƒ¨åˆ†é€»è¾‘ã€‚</p><p><a href="https://dubbo.apache.org/zh/docs/v2.7/user/examples/local-stub/#m-zhdocsv27userexampleslocal-stub">æœ¬åœ°å­˜æ ¹ | Apache Dubbo</a></p><h4 id="3-3-3-æ€ä¹ˆåš"><a href="#3-3-3-æ€ä¹ˆåš" class="headerlink" title="3.3.3. æ€ä¹ˆåš"></a>3.3.3. æ€ä¹ˆåš</h4><p>è¿œç¨‹æœåŠ¡åï¼Œå®¢æˆ·ç«¯é€šå¸¸åªå‰©ä¸‹æ¥å£ï¼Œè€Œå®ç°å…¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œä½†æä¾›æ–¹æœ‰äº›æ—¶å€™æƒ³åœ¨å®¢æˆ·ç«¯ä¹Ÿæ‰§è¡Œéƒ¨åˆ†é€»è¾‘ï¼Œé‚£ä¹ˆå°±åœ¨æœåŠ¡æ¶ˆè´¹è€…è¿™ä¸€ç«¯æä¾›äº†ä¸€ä¸ªStubç±»ï¼Œç„¶åå½“æ¶ˆè´¹è€…è°ƒç”¨provideræ–¹æä¾›çš„dubboæœåŠ¡æ—¶ï¼Œå®¢æˆ·ç«¯ç”Ÿæˆ Proxy å®ä¾‹ï¼Œè¿™ä¸ªProxyå®ä¾‹å°±æ˜¯æˆ‘ä»¬æ­£å¸¸è°ƒç”¨dubboè¿œç¨‹æœåŠ¡è¦ç”Ÿæˆçš„ä»£ç†å®ä¾‹ï¼Œç„¶åæ¶ˆè´¹è€…è¿™æ–¹ä¼šæŠŠ Proxy é€šè¿‡æ„é€ å‡½æ•°ä¼ ç»™æ¶ˆè´¹è€…æ–¹çš„Stub ï¼Œç„¶åæŠŠ Stub æš´éœ²ç»™ç”¨æˆ·ï¼ŒStub å¯ä»¥å†³å®šè¦ä¸è¦å»è°ƒ Proxyã€‚ä¼šé€šè¿‡ä»£ç†ç±»å»å®Œæˆè¿™ä¸ªè°ƒç”¨ï¼Œè¿™æ ·åœ¨Stubç±»ä¸­ï¼Œå°±å¯ä»¥åšä¸€äº›é¢å¤–çš„äº‹ï¼Œæ¥å¯¹æœåŠ¡çš„è°ƒç”¨è¿‡ç¨‹è¿›è¡Œä¼˜åŒ–æˆ–è€…å®¹é”™çš„å¤„ç†ã€‚</p><h3 id="3-4-æ³¨è§£é…ç½®"><a href="#3-4-æ³¨è§£é…ç½®" class="headerlink" title="3.4 æ³¨è§£é…ç½®"></a>3.4 æ³¨è§£é…ç½®</h3><h4 id="3-4-1-ä¸ºä»€ä¹ˆ"><a href="#3-4-1-ä¸ºä»€ä¹ˆ" class="headerlink" title="3.4.1 ä¸ºä»€ä¹ˆ"></a>3.4.1 ä¸ºä»€ä¹ˆ</h4><p>æœ‰çš„æ—¶å€™ï¼Œxmlé…ç½®çš„æ–¹å¼é…ç½®å¾ˆç¹çï¼Œspringboot+propertiesçš„æ–¹å¼é…ç½®çš„å±æ€§åˆä¸å¤Ÿè¯¦ç»†ã€‚æ‰€ä»¥å‡ºç°äº†æ³¨è§£é…ç½®çš„æ–¹å¼ï¼Œå°†xmlä¸­æ‰€æœ‰å¯ä»¥é…ç½®çš„å±æ€§å…¨éƒ¨å¯¹åº”åˆ°ä»£ç ä¸­è¿›è¡Œé…ç½®å³å¯ã€‚</p><p><a href="https://dubbo.apache.org/zh/docs/v2.7/user/configuration/annotation/">æ³¨è§£é…ç½® | Apache Dubbo</a></p><h4 id="3-4-2-æ˜¯ä»€ä¹ˆ"><a href="#3-4-2-æ˜¯ä»€ä¹ˆ" class="headerlink" title="3.4.2 æ˜¯ä»€ä¹ˆ"></a>3.4.2 æ˜¯ä»€ä¹ˆ</h4><p><a href="https://dubbo.apache.org/zh/docs/v2.7/user/configuration/annotation/">æ³¨è§£é…ç½® | Apache Dubbo</a></p><h4 id="3-4-2-æ€ä¹ˆåš"><a href="#3-4-2-æ€ä¹ˆåš" class="headerlink" title="3.4.2 æ€ä¹ˆåš"></a>3.4.2 æ€ä¹ˆåš</h4><p>å¼€å‘ä¸­å¯ä»¥å‚è€ƒä¸Šè¿°å®˜ç½‘ã€‚</p><p>åŸç†ï¼š</p><p>éƒ½æ˜¯æ³¨è§£çš„é‚£ä¸€å¥—å®ç°åŸç†ã€‚</p><h2 id="4-é«˜å¯ç”¨"><a href="#4-é«˜å¯ç”¨" class="headerlink" title="4. é«˜å¯ç”¨"></a>4. é«˜å¯ç”¨</h2><p>é€šç”¨è®¾è®¡ï¼Œå‡å°‘ç³»ç»Ÿä¸èƒ½æä¾›æœåŠ¡çš„æ—¶é—´ã€‚</p><p>zookeeperå®•æœºä¸dubboç›´è¿ï¼Œè¿˜å¯ä»¥æ¶ˆè´¹dubboæš´éœ²çš„æœåŠ¡ã€‚</p><p>åŸå› ï¼š</p><ul><li>ç›‘æ§ä¸­å¿ƒå®•æœºä¸å½±å“ä½¿ç”¨ï¼Œåªæ˜¯ä¸¢å¤±éƒ¨åˆ†é‡‡æ ·æ•°æ®ã€‚</li><li>æ•°æ®åº“å®•æœºåï¼Œæ³¨å†Œä¸­å¿ƒä»èƒ½é€šè¿‡ç¼“å­˜æä¾›æœåŠ¡åˆ—è¡¨æŸ¥è¯¢</li><li>æ³¨å†Œä¸­å¿ƒå¯¹ç­‰é›†ç¾¤ï¼Œä»»æ„ä¸€å°å®•æœºåï¼Œå°†è‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€å°ã€‚</li><li>æ³¨å†Œä¸­å¿ƒå…¨éƒ¨å®•æœºåï¼ŒæœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ä»èƒ½é€šè¿‡<font color="red"> æœ¬åœ°ç¼“å­˜</font>é€šè®¯ã€‚</li><li>æœåŠ¡æä¾›è€…æ— çŠ¶æ€ï¼Œä»»ä½•ä¸€å°å®•æœºåï¼Œä¸å½±å“ä½¿ç”¨ã€‚</li><li>æœåŠ¡æä¾›è€…å…¨éƒ¨å®•æœºåï¼ŒæœåŠ¡æ¶ˆè´¹è€…åº”ç”¨å°†æ— æ³•ä½¿ç”¨ï¼Œå¹¶æ— é™æ¬¡é‡è¿ç­‰å¾…æœåŠ¡æä¾›è€…æ¢å¤ã€‚</li></ul><h3 id="4-1-è´Ÿè½½å‡è¡¡"><a href="#4-1-è´Ÿè½½å‡è¡¡" class="headerlink" title="4.1 è´Ÿè½½å‡è¡¡"></a>4.1 è´Ÿè½½å‡è¡¡</h3><h4 id="4-1-éšæœºè´Ÿè½½å‡è¡¡æœºåˆ¶"><a href="#4-1-éšæœºè´Ÿè½½å‡è¡¡æœºåˆ¶" class="headerlink" title="4.1 éšæœºè´Ÿè½½å‡è¡¡æœºåˆ¶"></a>4.1 éšæœºè´Ÿè½½å‡è¡¡æœºåˆ¶</h4><ol><li>åŸºäºæƒé‡çš„éšæœºè´Ÿè½½å‡è¡¡æœºåˆ¶</li></ol><p><img src="/2021/04/23/dubbo/%E9%9A%8F%E6%9C%BA%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.PNG"></p><ol start="2"><li>åŸºäºæƒé‡çš„è½®è¯¢è´Ÿè½½å‡è¡¡æœºåˆ¶</li></ol><p><img src="/2021/04/23/dubbo/%E6%9D%83%E9%87%8D%E8%AE%BA%E6%96%87%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.PNG"></p><ol start="3"><li>æœ€å°‘æ´»è·ƒæ•°</li></ol><p><img src="/2021/04/23/dubbo/%E6%9C%80%E5%B0%91%E6%B4%BB%E8%B7%83%E6%95%B0.PNG"></p><ol start="4"><li>ä¸€è‡´æ€§å“ˆå¸Œ</li></ol><p><img src="/2021/04/23/dubbo/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C.PNG"></p><h4 id="4-2-æœåŠ¡é™çº§"><a href="#4-2-æœåŠ¡é™çº§" class="headerlink" title="4.2 æœåŠ¡é™çº§"></a>4.2 æœåŠ¡é™çº§</h4><p>å½“æœåŠ¡å™¨å‹åŠ›å‰§å¢çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µåŠæµé‡ï¼Œå¯¹ä¸€äº›æœåŠ¡å’Œé¡µé¢æœ‰ç­–ç•¥çš„ä¸å¤„ç†æˆ–æ¢ç§ç®€å•çš„æ–¹å¼å¤„ç†ï¼Œä»è€Œé‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒäº¤æ˜“æ­£å¸¸è¿ä½œæˆ–é«˜æ•ˆè¿ä½œã€‚</p><p>æœ¬è´¨ä¸Šå°±æ˜¯ä¸è®©ä»–è°ƒç”¨æ­¤æœåŠ¡äº†ã€‚</p><p>é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå®¹é”™çš„æ¦‚å¿µï¼Œå®¹é”™åœ¨è°ƒç”¨å¤±è´¥æ—¶æ‰è¿”å›ä¸º<code>null</code>ã€‚</p><h4 id="4-3-æœåŠ¡å®¹é”™"><a href="#4-3-æœåŠ¡å®¹é”™" class="headerlink" title="4.3 æœåŠ¡å®¹é”™"></a>4.3 æœåŠ¡å®¹é”™</h4><ol><li>FailFast Cluster</li></ol><p>å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ã€‚</p><ol start="2"><li>FailSast Cluster</li></ol><p>å¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸åˆ™ç›´æ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œã€‚</p><ol start="3"><li>FailBack Cluster</li></ol><p>å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚</p><ol start="4"><li>Forcking Cluster</li></ol><p>å¹¶è¡Œè°ƒåº¦å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚æ¯”å¦‚ä¸€ä¸ªå®¢æˆ·ç«¯å‘3ä¸ªæä¾›è€…å‘èµ·æœåŠ¡è¯·æ±‚ï¼ˆå¤ªæµªè´¹èµ„æºäº†ï¼‰ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡<code>forks=2</code>æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚</p><ol start="5"><li>Broadcast Cluster</li></ol><p>å¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚</p><p>é›†ç¾¤æ¨¡å¼é…ç½®</p><p>&lt;dubbo:service cluster=â€failsafeâ€&gt;</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬æ•´åˆhystrixæä¾›æ›´å¼ºå¤§çš„å®¹é”™èƒ½åŠ›ã€‚</p><p><code>&lt;HystrixCommand(fallbackMethod="hello")</code></p><h2 id="5-åŸç†"><a href="#5-åŸç†" class="headerlink" title="5. åŸç†"></a>5. åŸç†</h2><h3 id="5-1-RPC"><a href="#5-1-RPC" class="headerlink" title="5.1 RPC"></a>5.1 RPC</h3><ol><li>æœåŠ¡æ¶ˆè´¹æ–¹(Client)è°ƒç”¨ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡ã€‚</li><li>client stub æ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ã€‚</li><li>client stub æ‰¾åˆ°æœåŠ¡åœ°å€ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯ã€‚</li><li>serve stub æ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç ã€‚</li><li>server stub æ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°æœåŠ¡ã€‚</li><li>æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æœè¿”å›ç»™server stubã€‚</li><li>serve stub å°†è¿”å›ç»“æœæ‰“åŒ…æˆæ¶ˆæ¯å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹ã€‚</li><li>client stub æ¥æ”¶åˆ°ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œè§£ç ã€‚</li><li>æœåŠ¡æ¶ˆè´¹æ–¹å¾—åˆ°æœ€ç»ˆç»“æœã€‚</li></ol><p>RPC æ¡†æ¶å°±æ˜¯å°†è¿™äº›æ­¥éª¤éƒ½å°è£…èµ·æ¥ã€‚</p><h3 id="5-2-æ¡†æ¶è®¾è®¡"><a href="#5-2-æ¡†æ¶è®¾è®¡" class="headerlink" title="5.2 æ¡†æ¶è®¾è®¡"></a>5.2 æ¡†æ¶è®¾è®¡</h3><h3 id="5-3-æœåŠ¡æš´éœ²"><a href="#5-3-æœåŠ¡æš´éœ²" class="headerlink" title="5.3 æœåŠ¡æš´éœ²"></a>5.3 æœåŠ¡æš´éœ²</h3><h3 id="5-4-æœåŠ¡å¼•ç”¨"><a href="#5-4-æœåŠ¡å¼•ç”¨" class="headerlink" title="5.4 æœåŠ¡å¼•ç”¨"></a>5.4 æœåŠ¡å¼•ç”¨</h3><h3 id="5-5-æœåŠ¡è°ƒç”¨"><a href="#5-5-æœåŠ¡è°ƒç”¨" class="headerlink" title="5.5 æœåŠ¡è°ƒç”¨"></a>5.5 æœåŠ¡è°ƒç”¨</h3>]]></content>
      
      
      <categories>
          
          <category> dubbo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HTTPSæ·±å…¥ç†è§£</title>
      <link href="2021/04/18/http-zhi-shi/"/>
      <url>2021/04/18/http-zhi-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="HTTPSæ˜¯ä»€ä¹ˆ"><a href="#HTTPSæ˜¯ä»€ä¹ˆ" class="headerlink" title="HTTPSæ˜¯ä»€ä¹ˆ"></a>HTTPSæ˜¯ä»€ä¹ˆ</h2><h1 id="1-HTTP"><a href="#1-HTTP" class="headerlink" title="1. HTTP"></a>1. HTTP</h1><h2 id="1-1-HTTP-çŠ¶æ€ç "><a href="#1-1-HTTP-çŠ¶æ€ç " class="headerlink" title="1.1 HTTP çŠ¶æ€ç "></a>1.1 HTTP çŠ¶æ€ç </h2><table><thead><tr><th>åˆ†ç±»</th><th>åˆ†ç±»æè¿°</th></tr></thead><tbody><tr><td>1**</td><td>ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œ</td></tr><tr><td>2**</td><td>æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç†</td></tr><tr><td>3**</td><td>é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚</td></tr><tr><td>4**</td><td>å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚</td></tr><tr><td>5**</td><td>æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯</td></tr></tbody></table><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç è‹±æ–‡åç§°</th><th>ä¸­æ–‡æè¿°</th></tr></thead><tbody><tr><td>100</td><td>Continue</td><td>ç»§ç»­ï¼Œå®¢æˆ·ç«¯åº”ç»§ç»­å…¶è¯·æ±‚</td></tr><tr><td>101</td><td>Switching Protocols</td><td>åˆ‡æ¢åè®®</td></tr><tr><td>200</td><td>OK</td><td>è¯·æ±‚æˆåŠŸã€‚ä¸€èˆ¬ç”¨äºGETä¸POSTè¯·æ±‚ã€‚</td></tr><tr><td>201</td><td>Created</td><td>å·²åˆ›å»ºï¼ŒæˆåŠŸè¯·æ±‚å¹¶åˆ›å»ºæ–°çš„èµ„æº</td></tr><tr><td>202</td><td>Accepted</td><td>å·²æ¥å—ï¼Œå·²ç»æ¥æ”¶è¯·æ±‚ï¼Œä½†æœªå¤„ç†å®Œæˆ</td></tr><tr><td>203</td><td>Non-Authoritative Information</td><td>éæˆæƒä¿¡æ¯ã€‚è¯·æ±‚æˆåŠŸï¼Œä½†è¿”å›çš„metaä¿¡æ¯ä¸åœ¨åŸå§‹æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå‰¯æœ¬</td></tr><tr><td>204</td><td>No Content</td><td>æ— å†…å®¹ã€‚æœåŠ¡å™¨å¤„ç†æˆåŠŸï¼Œä½†æœªè¿”å›å†…å®¹ã€‚åœ¨æœªæ›´æ–°ç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯ç¡®ä¿æµè§ˆå™¨ç»§ç»­æ˜¾ç¤ºå½“å‰æ–‡æ¡£ã€‚</td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç è‹±æ–‡åç§°</th><th></th><th>ä¸­æ–‡æè¿°</th></tr></thead><tbody><tr><td>500</td><td>Internal Server Error</td><td></td><td>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚</td></tr><tr><td>501</td><td>Not Implemented</td><td></td><td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„åŠŸèƒ½ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚</td></tr><tr><td>502</td><td>Bad Gateway</td><td></td><td>å“åº”æ— æ•ˆ</td></tr><tr><td>503</td><td>Service Unavailable</td><td></td><td></td></tr><tr><td>504</td><td>GateWay Time-out</td><td></td><td>å“åº”è¶…æ—¶</td></tr><tr><td>505</td><td></td><td></td><td></td></tr></tbody></table><h4 id="Http1-x"><a href="#Http1-x" class="headerlink" title="Http1.x"></a>Http1.x</h4><p><img src="https://www.debugger.wiki/logo/1565502376359371.png" alt="img"></p><ul><li><strong>ç¼ºé™·</strong>ï¼šçº¿ç¨‹é˜»å¡ï¼Œåœ¨åŒä¸€æ—¶é—´ï¼ŒåŒä¸€åŸŸåçš„è¯·æ±‚æœ‰ä¸€å®šæ•°é‡é™åˆ¶ï¼Œè¶…è¿‡é™åˆ¶æ•°ç›®çš„è¯·æ±‚ä¼šè¢«é˜»å¡</li></ul><h4 id="http1-0"><a href="#http1-0" class="headerlink" title="http1.0"></a>http1.0</h4><p><img src="https://www.debugger.wiki/logo/1565502376359371.png" alt="img"></p><ul><li><strong>ç¼ºé™·</strong>ï¼šæµè§ˆå™¨ä¸æœåŠ¡å™¨åªä¿æŒçŸ­æš‚çš„è¿æ¥ï¼Œæµè§ˆå™¨çš„æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼ˆT<strong>CPè¿æ¥çš„æ–°å»ºæˆæœ¬å¾ˆé«˜ï¼Œå› ä¸ºéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼‰ï¼ŒæœåŠ¡å™¨å®Œæˆè¯·æ±‚å¤„ç†åç«‹å³æ–­å¼€TCPè¿æ¥ï¼ŒæœåŠ¡å™¨ä¸è·Ÿè¸ªæ¯ä¸ªå®¢æˆ·ä¹Ÿä¸è®°å½•è¿‡å»çš„è¯·æ±‚ï¼›</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<ul><li>æ·»åŠ å¤´ä¿¡æ¯â€”â€”éæ ‡å‡†çš„Connectionå­—æ®µ<code>Connection: keep-alive</code></li></ul></li></ul><h4 id="http1-1ï¼š"><a href="#http1-1ï¼š" class="headerlink" title="http1.1ï¼š"></a>http1.1ï¼š</h4><ul><li><strong>æ”¹è¿›ç‚¹ï¼š</strong></li></ul><ol><li><strong>æŒä¹…è¿æ¥</strong><ul><li>å¼•å…¥äº†æŒä¹…è¿æ¥ï¼Œå³TCPè¿æ¥é»˜è®¤ä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨ï¼Œä¸ç”¨å£°æ˜<code>Connection: keep-alive</code>(å¯¹äºåŒä¸€ä¸ªåŸŸåï¼Œå¤§å¤šæ•°æµè§ˆå™¨å…è®¸åŒæ—¶å»ºç«‹6ä¸ªæŒä¹…è¿æ¥)</li></ul></li><li><strong>ç®¡é“æœºåˆ¶</strong><ul><li>å³åœ¨åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ã€‚</li></ul></li><li><strong>åˆ†å—ä¼ è¾“ç¼–ç </strong><ul><li>å³æœåŠ¡ç«¯æ¯äº§ç”Ÿä¸€å—æ•°æ®ï¼Œå°±å‘é€ä¸€å—ï¼Œé‡‡ç”¨â€æµæ¨¡å¼â€è€Œå–ä»£â€ç¼“å­˜æ¨¡å¼â€ã€‚</li></ul></li><li><strong>æ–°å¢è¯·æ±‚æ–¹å¼</strong><ul><li>PUT:è¯·æ±‚æœåŠ¡å™¨å­˜å‚¨ä¸€ä¸ªèµ„æº;</li><li>DELETEï¼šè¯·æ±‚æœåŠ¡å™¨åˆ é™¤æ ‡è¯†çš„èµ„æºï¼›</li><li>OPTIONSï¼šè¯·æ±‚æŸ¥è¯¢æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæˆ–è€…æŸ¥è¯¢ä¸èµ„æºç›¸å…³çš„é€‰é¡¹å’Œéœ€æ±‚ï¼›</li><li>TRACEï¼šè¯·æ±‚æœåŠ¡å™¨å›é€æ”¶åˆ°çš„è¯·æ±‚ä¿¡æ¯ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ï¼›</li><li>CONNECTï¼šä¿ç•™å°†æ¥ä½¿ç”¨</li></ul></li></ol><ul><li><strong>ç¼ºç‚¹ï¼š</strong><ul><li>è™½ç„¶å…è®¸å¤ç”¨TCPè¿æ¥ï¼Œä½†æ˜¯åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œæ‰€æœ‰çš„æ•°æ®é€šä¿¡æ˜¯<strong>æŒ‰æ¬¡åºè¿›è¡Œ</strong>çš„ã€‚æœåŠ¡å™¨åªæœ‰å¤„ç†å®Œä¸€ä¸ªè¯·æ±‚ï¼Œæ‰ä¼šæ¥ç€å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚å¦‚æœå‰é¢çš„å¤„ç†ç‰¹åˆ«æ…¢ï¼Œåé¢å°±ä¼šæœ‰è®¸å¤šè¯·æ±‚æ’é˜Ÿç­‰ç€ã€‚è¿™å°†å¯¼è‡´â€œé˜Ÿå¤´å µå¡â€</li><li><strong>é¿å…æ–¹å¼ï¼š</strong>ä¸€æ˜¯å‡å°‘è¯·æ±‚æ•°ï¼ŒäºŒæ˜¯åŒæ—¶å¤šå¼€æŒä¹…è¿æ¥</li></ul></li></ul><h4 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP/2.0"></a>HTTP/2.0</h4><p><img src="https://www.debugger.wiki/logo/1565502376359602.png" alt="img"></p><ul><li><h4 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ol><li>é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼è€Œéæ–‡æœ¬æ ¼å¼ï¼›</li><li>å®Œå…¨å¤šè·¯å¤ç”¨ï¼Œè€Œéæœ‰åºå¹¶é˜»å¡çš„ã€åªéœ€ä¸€ä¸ªè¿æ¥å³å¯å®ç°å¹¶è¡Œï¼›</li><li>ä½¿ç”¨æŠ¥å¤´å‹ç¼©ï¼Œé™ä½å¼€é”€</li><li>æœåŠ¡å™¨æ¨é€</li></ol></li></ul><p><strong>1. äºŒè¿›åˆ¶åè®®</strong></p><ul><li>HTTP/1.1 ç‰ˆçš„å¤´ä¿¡æ¯è‚¯å®šæ˜¯æ–‡æœ¬ï¼ˆASCIIç¼–ç ï¼‰ï¼Œæ•°æ®ä½“å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶ã€‚HTTP/2 åˆ™æ˜¯ä¸€ä¸ªå½»åº•çš„äºŒè¿›åˆ¶åè®®ï¼Œå¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”ç»Ÿç§°ä¸ºâ€å¸§â€ï¼šå¤´ä¿¡æ¯å¸§å’Œæ•°æ®å¸§ã€‚</li><li>äºŒè¿›åˆ¶åè®®è§£æèµ·æ¥æ›´é«˜æ•ˆã€â€œçº¿ä¸Šâ€æ›´ç´§å‡‘ï¼Œæ›´é‡è¦çš„æ˜¯é”™è¯¯æ›´å°‘ã€‚</li></ul><p><strong>2. å®Œå…¨å¤šè·¯å¤ç”¨</strong></p><ul><li>HTTP/2 å¤ç”¨TCPè¿æ¥ï¼Œåœ¨ä¸€ä¸ªè¿æ¥é‡Œï¼Œå®¢æˆ·ç«¯å’Œæµè§ˆå™¨éƒ½å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æˆ–å›åº”ï¼Œè€Œä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºä¸€ä¸€å¯¹åº”ï¼Œè¿™æ ·å°±é¿å…äº†â€é˜Ÿå¤´å µå¡â€ã€‚</li></ul><p><strong>3. æŠ¥å¤´å‹ç¼©</strong></p><ul><li>HTTP åè®®æ˜¯æ²¡æœ‰çŠ¶æ€ï¼Œå¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œè¯·æ±‚çš„å¾ˆå¤šå¤´å­—æ®µéƒ½æ˜¯é‡å¤çš„ï¼Œæ¯”å¦‚Cookieï¼Œä¸€æ ·çš„å†…å®¹æ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„å¸¦ï¼Œè¿™ä¼šæµªè´¹å¾ˆå¤šå¸¦å®½ï¼Œä¹Ÿå½±å“é€Ÿåº¦ã€‚</li><li>å¯¹äºç›¸åŒçš„å¤´éƒ¨ï¼Œä¸å¿…å†é€šè¿‡è¯·æ±‚å‘é€ï¼Œåªéœ€å‘é€ä¸€æ¬¡ï¼›</li><li>HTTP/2 å¯¹è¿™ä¸€ç‚¹åšäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†å¤´ä¿¡æ¯å‹ç¼©æœºåˆ¶ï¼›</li><li>ä¸€æ–¹é¢ï¼Œå¤´ä¿¡æ¯ä½¿ç”¨gzipæˆ–compresså‹ç¼©åå†å‘é€ï¼›</li><li>å¦ä¸€æ–¹é¢ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤ä¸€å¼ å¤´ä¿¡æ¯è¡¨ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å…¥è¿™ä¸ªè¡¨ï¼Œäº§ç”Ÿä¸€ä¸ªç´¢å¼•å·ï¼Œä¹‹åå°±ä¸å‘é€åŒæ ·å­—æ®µäº†ï¼Œåªéœ€å‘é€ç´¢å¼•å·ã€‚</li></ul><p><strong>4. æœåŠ¡å™¨æ¨é€</strong></p><ul><li>HTTP/2 å…è®¸æœåŠ¡å™¨æœªç»è¯·æ±‚ï¼Œä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€èµ„æºï¼›</li><li>é€šè¿‡æ¨é€é‚£äº›æœåŠ¡å™¨ä»»åŠ¡å®¢æˆ·ç«¯å°†ä¼šéœ€è¦çš„å†…å®¹åˆ°å®¢æˆ·ç«¯çš„ç¼“å­˜ä¸­ï¼Œé¿å…å¾€è¿”çš„å»¶è¿Ÿ</li></ul><h3 id="HTTPå­˜åœ¨é—®é¢˜"><a href="#HTTPå­˜åœ¨é—®é¢˜" class="headerlink" title="HTTPå­˜åœ¨é—®é¢˜"></a>HTTPå­˜åœ¨é—®é¢˜</h3><p>ç”±äºHTTPåè®®è¿‡äºç®€å•ï¼š</p><ul><li>é€šä¿¡ä½¿ç”¨æ˜æ–‡ï¼ˆä¸åŠ å¯†ï¼‰ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ã€‚</li><li>ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œå› æ­¤å¯èƒ½é­é‡ä¼ªè£…</li><li>æ— æ³•éªŒè¯æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å·²é­ç¯¡æ”¹ã€‚</li></ul><p>ä¸ºäº†è§£å†³è¯¸å¤šé—®é¢˜ï¼ŒHTTPSåº”è¿è€Œç”Ÿã€‚</p><h3 id="HTTPSçš„å®è´¨"><a href="#HTTPSçš„å®è´¨" class="headerlink" title="HTTPSçš„å®è´¨"></a>HTTPSçš„å®è´¨</h3><p>HTTPåŠ ä¸Š<strong>åŠ å¯†å¤„ç†</strong>ã€<strong>è®¤è¯æœºåˆ¶</strong>ã€ä»¥åŠ<strong>å®Œæ•´æ€§ä¿æŠ¤</strong>åçš„å°±æ˜¯HTTPSã€‚</p><p>éœ€è¦çŸ¥é“çš„æ˜¯ï¼ŒHTTPSå¹¶éæ˜¯åº”ç”¨å±‚çš„ä¸€ç§æ–°çš„åè®®ã€‚åªæ˜¯HTTPé€šä¿¡æ¥å£éƒ¨åˆ†ç”¨SSLæˆ–TLSåè®®ä»£æ›¿è€Œå·²ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€è°“çš„HTTPSï¼Œ<strong>å…¶å®å°±æ˜¯èº«æŠ«SSLåè®®å¤–å£³çš„HTTPã€‚</strong></p><p><img src="/2021/04/18/http-zhi-shi/1460000012196647" alt="img"></p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒSSLæ˜¯ç‹¬ç«‹äºHTTPåè®®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶ä»–è¿è¡Œåœ¨åº”ç”¨å±‚çš„åè®®å‡å¯é…åˆSSLåè®®ä½¿ç”¨ã€‚ç°ä»ŠSSLæ˜¯æœ€ä¸ºå¹¿æ³›çš„ç½‘ç»œå®‰å…¨æŠ€æœ¯ã€‚</p><h3 id="SSLå’ŒTLS"><a href="#SSLå’ŒTLS" class="headerlink" title="SSLå’ŒTLS"></a>SSLå’ŒTLS</h3><p>HTTPSä¸­ä½¿ç”¨äº†SSLå’ŒTLSè¿™ä¸¤ä¸ªåè®®ã€‚</p><p>TLSä»¥SSL3.0ä¸ºåŸºå‡†ï¼Œååˆåˆ¶å®šäº†TLS1.0ã€TLS1.1å’ŒTLS1.2ã€‚å½“å‰ä¸»æµçš„ç‰ˆæœ¬æ˜¯SSL3.0å’ŒTLS1.0ã€‚</p><p><strong>TLSæ˜¯ä»¥SSLä¸ºåŸå‹å¼€å‘çš„åè®®ï¼Œæœ‰æ—¶å€™ä¼šç»Ÿç§°è¯¥åè®®ä¸ºSSLã€‚</strong></p><h2 id="HTTPSçš„åŠ å¯†åŸç†"><a href="#HTTPSçš„åŠ å¯†åŸç†" class="headerlink" title="HTTPSçš„åŠ å¯†åŸç†"></a>HTTPSçš„åŠ å¯†åŸç†</h2><p>è¿‘ä»£çš„åŠ å¯†ç®—æ³•ä¸­åŠ å¯†ç®—æ³•æ˜¯å…¬å¼€çš„ï¼Œè€Œå¯†é’¥æ˜¯ä¿å¯†çš„ã€‚é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¿æŒåŠ å¯†æ–¹æ³•çš„å®‰å…¨æ€§ã€‚</p><p>åŠ å¯†å’Œè§£å¯†è¦ç”¨åˆ°å¯†é’¥ï¼Œå¦‚æœæ²¡æœ‰å¯†é’¥å°±æ²¡æœ‰åŠæ³•å¯¹å¯†ç è§£å¯†ã€‚æ¢å¥è¯æ¥è¯´ï¼Œä»»ä½•äººåªè¦æŒæœ‰å¯†é’¥å°±èƒ½å¤Ÿå¯¹å¯†æ–‡è¿›è¡Œè§£å¯†ã€‚</p><p>HTTPSåœ¨åŠ å¯†è¿‡ç¨‹ä¸­ä½¿ç”¨äº†<strong>éå¯¹ç§°åŠ å¯†æŠ€æœ¯</strong>å’Œ<strong>å¯¹ç§°åŠ å¯†æŠ€æœ¯</strong>ã€‚</p><h3 id="å¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#å¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="å¯¹ç§°åŠ å¯†ç®—æ³•"></a>å¯¹ç§°åŠ å¯†ç®—æ³•</h3><blockquote><p>é‡‡ç”¨å•é’¥å¯†ç ç³»ç»Ÿçš„åŠ å¯†æ–¹å¼ï¼ŒåŒä¸€ä¸ªå¯†é’¥å¯ä»¥åŒæ—¶åšä¿¡æ¯çš„åŠ å¯†å’Œè§£å¯†ï¼Œè¿™ç§åŠ å¯†çš„æ–¹æ³•ç§°ä¸ºå¯¹ç§°åŠ å¯†ï¼Œä¹Ÿç§°ä¸ºå•å¯†é’¥åŠ å¯†ã€‚</p></blockquote><p>ä¸‹é¢ä¼šæŠŠå¯¹ç§°åŠ å¯†ç®—æ³•ç§°ä¸ºå…±äº«å¯†é’¥åŠ å¯†ç®—æ³•ã€‚</p><p>å‡å¦‚ç°åœ¨ï¼ŒSSLåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨äº†å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶å…±äº«ä¸€ä¸ªå¯†é’¥ã€‚</p><p>äºæ˜¯ï¼Œä»¥å…±äº«å¯†é’¥çš„æ–¹å¼åŠ å¯†ï¼Œå¿…é¡»å°†å¯†é’¥å‘ç»™å¯¹æ–¹ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå‡å¦‚é€šä¿¡è¿‡ç¨‹è¢«ç›‘å¬ï¼Œå¯†é’¥è¢«æ”»å‡»è€…è·å–äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä¹Ÿå°±å¤±å»äº†åŠ å¯†çš„æ„ä¹‰äº†ã€‚</p><p><img src="/2021/04/18/http-zhi-shi/1460000012196648" alt="img"></p><p>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸¤æŠŠå¯†é’¥ã€‚</p><p>ä¸‹é¢å…ˆçœ‹ä½¿ç”¨ä¸¤æŠŠå¯†é’¥çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚</p><h3 id="éå¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#éå¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="éå¯¹ç§°åŠ å¯†ç®—æ³•"></a>éå¯¹ç§°åŠ å¯†ç®—æ³•</h3><blockquote><p>ä¸å¯¹ç§°åŠ å¯†ç®—æ³•ç›¸åï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦ä¸¤ä¸ªå¯†é’¥æ¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œè¿™ä¸¤ä¸ªå¯†é’¥æ˜¯é…å¯¹çš„ï¼Œåˆ†åˆ«æ˜¯å…¬å¼€å¯†é’¥ï¼ˆå…¬é’¥ï¼‰å’Œç§æœ‰å¯†é’¥ï¼ˆç§é’¥ï¼‰ã€‚</p></blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå…¬é’¥æ˜¯å¯ä»¥è¢«<strong>å…¬å¼€</strong>çš„ï¼Œå®ƒä¸»è¦ç”¨æ¥åŠ å¯†æ˜æ–‡ã€‚è€Œç›¸åº”çš„ï¼Œç§é’¥<strong>ä¸èƒ½è¢«å…¬å¼€</strong>ï¼Œç”¨æ¥è§£å¯†å…¬é’¥åŠ å¯†çš„å¯†æ–‡ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<strong>å…¬é’¥åŠ å¯†åçš„å¯†æ–‡åªèƒ½é€šè¿‡å¯¹åº”çš„ç§é’¥æ¥è§£å¯†ï¼Œè€Œç§é’¥åŠ å¯†çš„å¯†æ–‡å´å¯ä»¥é€šè¿‡å¯¹åº”çš„å…¬é’¥æ¥è§£å¯†ã€‚</strong></p><p>ä»¥ä¸Šï¼Œå…¬é’¥åŠ å¯†ç§é’¥è§£å¯†ç”¨æ¥åŠ å¯†ï¼Œç§é’¥åŠ å¯†å…¬é’¥è§£å¯†ç”¨æ¥ç­¾åã€‚ç›¸å…³ç”¨é€”åé¢ä¼šè®²åˆ°ã€‚</p><p>ä¸‹é¢ä¼šæŠŠéå¯¹ç§°åŠ å¯†ç®—æ³•ç§°ä¸ºå…¬å¼€å¯†é’¥åŠ å¯†ç®—æ³•ã€‚</p><p>äºæ˜¯ç°åœ¨ï¼Œå‡è®¾ç°åœ¨ç”±æœåŠ¡å™¨æ¥ç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ã€‚</p><p>å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘è¯·æ±‚å’ŒæœåŠ¡å™¨åå•†çš„æ—¶å€™ï¼Œ<strong>æœåŠ¡å™¨å°±ç”Ÿæˆäº†ä¸€å¯¹å…¬é’¥å’Œç§é’¥</strong>ã€‚</p><p>ç´§æ¥ç€ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥å‘ç»™å®¢æˆ·ç«¯ï¼ˆæ˜æ–‡ï¼Œä¸éœ€è¦åšä»»ä½•åŠ å¯†ï¼‰ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åï¼Œéšæœºç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œ<strong>ä½¿ç”¨æœåŠ¡å™¨å‘è¿‡æ¥çš„å…¬é’¥è¿›è¡ŒåŠ å¯†</strong>ã€‚</p><p>å†æ¥ç€ï¼Œå®¢æˆ·ç«¯æŠŠä½¿ç”¨å…¬é’¥åŠ å¯†çš„å¯†é’¥å‘ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°äº†ä»¥åï¼Œ<strong>ç”¨é…å¯¹çš„ç§é’¥è¿›è¡Œè§£å¯†</strong>ï¼Œå°±å¾—åˆ°äº†å®¢æˆ·ç«¯éšæœºç”Ÿæˆçš„é‚£ä¸ªå¯†é’¥ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ‰€æŒçš„å¯†é’¥éƒ½æ˜¯ç›¸åŒçš„ã€‚æ­¤æ—¶ï¼Œäº¤æ¢å¯†é’¥ç¯èŠ‚å°±å®Œæˆäº†ã€‚</p><p>äºæ˜¯<strong>é€šä¿¡</strong>å¼€å§‹æ—¶å°±å¯è¿›è¡Œä¸Šé¢æ‰€è¿°çš„<strong>å…±äº«å¯†é’¥åŠ å¯†æ–¹å¼</strong>æ¥è¿›è¡ŒåŠ å¯†ã€‚</p><h3 id="åŒæ—¶ä½¿ç”¨"><a href="#åŒæ—¶ä½¿ç”¨" class="headerlink" title="åŒæ—¶ä½¿ç”¨"></a>åŒæ—¶ä½¿ç”¨</h3><p>å¯èƒ½ï¼Œæœ‰å°ä¼™ä¼´å°±ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦å¤§è´¹å‘¨ç« ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼ï¼Œç„¶åå†å¾—åˆ°ç›¸åŒçš„å¯†é’¥ï¼Œè¿›è¡Œå…±äº«å¯†é’¥åŠ å¯†çš„é€šä¿¡å‘¢ï¼Ÿ</p><p>ç”±äºå…¬å¼€å¯†é’¥åŠ å¯†å¤„ç†èµ·æ¥æ¯”å…±äº«å¯†é’¥åŠ å¯†æ–¹å¼æ›´ä¸ºå¤æ‚ï¼Œå› æ­¤åœ¨é€šä¿¡çš„æ—¶å€™ä½¿ç”¨å…¬å¼€å¯†é’¥åŠ å¯†çš„æ–¹å¼ï¼Œæ•ˆç‡å¾ˆä½ã€‚</p><p>äºæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼æ¥ä¿è¯å¯†é’¥å…±äº«çš„è¿‡ç¨‹ä¸­å¯†é’¥çš„å®‰å…¨æ€§ï¼Œè€Œååœ¨é€šä¿¡çš„è¿‡ç¨‹ä¸­ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œè¿™æ˜¯æœ€åˆç†çš„è®¾è®¡æ–¹å¼ï¼Œåœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶åˆä¿è¯äº†æ€§èƒ½ã€‚</p><p>æ‰€ä»¥ï¼ŒHTTPSé‡‡ç”¨å…±äº«å¯†é’¥åŠ å¯†å’Œå…¬å¼€å¯†é’¥åŠ å¯†ä¸¤è€…å¹¶ç”¨çš„æ··åˆåŠ å¯†æœºåˆ¶ã€‚<strong>åœ¨äº¤æ¢å¯†é’¥ä½¿ç”¨ç¯èŠ‚ä½¿ç”¨å…¬å¼€å¯†é’¥åŠ å¯†æ–¹å¼ï¼Œä¹‹åå»ºç«‹çš„é€šä¿¡äº¤æ¢æŠ¥æ–‡é˜¶æ®µåˆ™ä½¿ç”¨å…±äº«å¯†é’¥åŠ å¯†æ–¹å¼ã€‚</strong></p><p>ä»¥ä¸Šï¼Œå¤§æ¦‚å°±æ˜¯ä½¿ç”¨å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„è¿‡ç¨‹ã€‚çœ‹ä¼¼è¿‡ç¨‹å¾ˆå®Œç¾ï¼Œå…¶å®è¿˜å­˜åœ¨ç€ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ï¼š<strong>å¦‚ä½•ä¿è¯æœåŠ¡å™¨ä¼ è¿‡æ¥çš„å…¬å¼€å¯†é’¥çš„æ­£ç¡®æ€§ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¿è¯å®ƒä¸è¢«æ‹¦æˆªç¯¡æ”¹ã€‚</strong></p><h2 id="ä½¿ç”¨è¯ä¹¦ä¿è¯å…¬é’¥çš„æ­£ç¡®æ€§"><a href="#ä½¿ç”¨è¯ä¹¦ä¿è¯å…¬é’¥çš„æ­£ç¡®æ€§" class="headerlink" title="ä½¿ç”¨è¯ä¹¦ä¿è¯å…¬é’¥çš„æ­£ç¡®æ€§"></a>ä½¿ç”¨è¯ä¹¦ä¿è¯å…¬é’¥çš„æ­£ç¡®æ€§</h2><p>å‡å¦‚ç°åœ¨æ­£å‡†å¤‡å’ŒæŸå°æœåŠ¡å™¨å»ºç«‹å…¬å¼€å¯†é’¥åŠ å¯†æ–¹å¼ä¸‹çš„é€šä¿¡ï¼Œå¦‚ä½•è¯æ˜å®¢æˆ·ç«¯æ”¶åˆ°çš„å…¬é’¥å°±æ˜¯åŸæœ¬é¢„æƒ³çš„é‚£å°æœåŠ¡å™¨å‘è¡Œçš„å…¬å¼€å¯†é’¥å‘¢ï¼Ÿæˆ–è®¸ï¼Œåœ¨å…¬é’¥ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼ŒçœŸæ­£çš„å…¬é’¥å¯èƒ½å·²ç»è¢«æ”»å‡»è€…æ›¿æ¢æ‰äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ç”±æ•°å­—è¯ä¹¦æœºæ„å’Œå…¶ç›¸å…³é¢å‘çš„å…¬å¼€å¯†é’¥è¯ä¹¦ã€‚</p><p>ä¸‹é¢é˜è¿°ä¸€ä¸‹æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆç®€ç§°CAï¼‰çš„ä¸šåŠ¡æµç¨‹ï¼š</p><p>é¦–å…ˆï¼ŒæœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘æ•°å­—è¯ä¹¦æœºæ„æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ã€‚æ•°å­—è¯ä¹¦è®¤è¯æœºæ„åœ¨åˆ¤æ˜æå‡ºç”³è¯·è€…çš„èº«ä»½ä¹‹åï¼Œä¼šå¯¹å·²ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾åï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†è¯¥å…¬å¼€å¯†é’¥æ”¾å…¥å…¬é’¥è¯ä¹¦åç»‘å®šåœ¨ä¸€èµ·ã€‚<br>æˆ‘ä»¬ç”¨<strong>ç™½è¯æ–‡</strong>æ¥ç¿»è¯‘ä¸€ä¸‹ä¸Šé¢è¿™æ®µè¯ï¼š</p><ul><li>é¦–å…ˆï¼ŒCAä¼šå‘ç”³è¯·è€…é¢å‘ä¸€ä¸ªè¯ä¹¦ï¼Œè¿™ä¸ªè¯ä¹¦é‡Œé¢çš„å†…å®¹æœ‰ï¼šç­¾å‘è€…ã€è¯ä¹¦ç”¨é€”ã€ä½¿ç”¨çš„HASHç®—æ³•ã€ç­¾åæ‰€ä½¿ç”¨çš„ç®—æ³•ã€è¯ä¹¦åˆ°æœŸçš„æ—¶é—´ç­‰ç­‰ã€‚</li><li>ç´§æ¥ç€ï¼ŒæŠŠä¸Šé¢æ‰€æåˆ°çš„å†…å®¹ï¼Œåšä¸€æ¬¡HASHæ±‚å€¼ï¼Œå¾—åˆ°ä¸€ä¸ªHASHå€¼ã€‚</li><li>å†æ¥ç€ï¼Œç”¨CAçš„<strong>ç§é’¥</strong>å¯¹è¿™ä¸ªHASHå€¼å’Œæ‰€ä½¿ç”¨çš„HASHç®—æ³•åŠ å¯†ï¼Œè¿™æ ·å°±å®Œæˆäº†æ•°å­—ç­¾åã€‚è€Œç”¨CAçš„ç§é’¥åŠ å¯†åï¼Œå°±ç”Ÿæˆäº†ç±»ä¼¼äººä½“æŒ‡çº¹çš„ç­¾åï¼Œä»»ä½•ç¯¡æ”¹è¯ä¹¦çš„å°è¯•ï¼Œéƒ½ä¼šè¢«æ•°å­—ç­¾åå‘ç°ã€‚</li><li>æœ€åï¼ŒæŠŠæ•°å­—ç­¾åï¼Œé™„åœ¨æ•°å­—è¯ä¹¦çš„æœ«å°¾ï¼Œä¼ è¾“ç»™æœåŠ¡å™¨ã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¿™ä»½ç”±æ•°å­—è¯ä¹¦è®¤è¯æœºæ„é¢å‘çš„å…¬é’¥è¯ä¹¦å‘ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨æ•°å­—è¯ä¹¦æœºæ„çš„å…¬å¼€å¯†é’¥å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚ä¸€æ—¦éªŒè¯æˆåŠŸï¼Œå®¢æˆ·ç«¯ä¾¿èƒ½å¤Ÿç¡®å®šè¿™ä¸ªå…¬å¼€å¯†é’¥æ˜¯å¯ä¿¡çš„ã€‚<br>æˆ‘ä»¬å†ç”¨<strong>ç™½è¯æ–‡</strong>æ¥ç¿»è¯‘ä¸€ä¸‹ï¼š</p><ul><li>å®¢æˆ·ç«¯æ‹¿åˆ°è¿™ä¸ªæ•°å­—è¯ä¹¦ä»¥åï¼Œç”¨CAç§é’¥å¯¹åº”çš„å…¬é’¥ï¼Œå¯ä»¥è§£å¯†æ•°å­—è¯ä¹¦æœ«å°¾çš„æ•°å­—ç­¾åï¼Œå¾—åˆ°HASHå€¼å’Œæ‰€é‡‡ç”¨çš„HASHç®—æ³•ã€‚</li><li>ç´§æ¥ç€ï¼Œå®¢æˆ·ç«¯æŒ‰ç…§è§£å¯†åˆ°çš„è¿™ä¸ªHASHç®—æ³•ï¼Œå¯¹è¯ä¹¦çš„å†…å®¹æ±‚HASHå€¼ã€‚å¦‚æœé€šè¿‡CAå…¬é’¥è§£å¯†çš„HASHå’Œé€šè¿‡è®¡ç®—æ±‚å¾—çš„HASHå€¼ç›¸åŒï¼Œé‚£ä¹ˆè®¤è¯é€šè¿‡ï¼Œå¦åˆ™å¤±è´¥ã€‚</li><li>å¦‚æœè®¤è¯é€šè¿‡ï¼Œå°±å¯ä»¥å–å¾—æœåŠ¡å™¨çš„å…¬å¼€å¯†é’¥ã€‚</li></ul><p>é‚£å®¢æˆ·ç«¯ä¸Šé¢çš„CAå…¬é’¥æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ</p><p>å…¶å®ï¼ŒCAé™¤äº†ç»™ç”³è¯·è€…å‘å¸ƒè¯ä¹¦ï¼Œå®ƒè‡ªå·±æœ¬èº«ä¹Ÿæœ‰è‡ªå·±çš„è¯ä¹¦ã€‚CAè‡ªèº«çš„æ•°å­—è¯ä¹¦ï¼ˆä¸€èˆ¬ç”±å®ƒè‡ªå·±ç”Ÿæˆï¼‰åœ¨æˆ‘ä»¬æ“ä½œç³»ç»Ÿåˆšå®‰è£…å¥½çš„æ—¶å€™ï¼Œè¿™äº›CAè‡ªèº«çš„æ•°å­—è¯ä¹¦å°±å·²ç»è¢«å¾®è½¯ï¼ˆæˆ–è€…å…¶å®ƒæ“ä½œç³»ç»Ÿçš„å¼€å‘æœºæ„ï¼‰å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¸­äº†ã€‚è€ŒCAçš„å…¬é’¥å°±åŒ…å«åœ¨å…¶ä¸­ã€‚è¿™æ ·ï¼ŒCAå°±å¯ä»¥é€šè¿‡è‡ªèº«çš„ç§é’¥å¯¹å‘å¸ƒçš„æ•°å­—è¯ä¹¦è¿›è¡Œç­¾åï¼Œè€Œåœ¨å®¢æˆ·ç«¯å°±èƒ½å¤Ÿç”¨å¯¹åº”çš„å…¬é’¥æ¥å¯¹å…¶è¿›è¡Œè§£å¯†ã€‚</p><p>å…¶å…·ä½“è¿‡ç¨‹æ˜¯è¿™æ ·å­çš„ï¼ˆå›¾ä¸­ç®€åŒ–äº†æ•°å­—ç­¾åçš„è¿‡ç¨‹ï¼‰ï¼š</p><p><img src="/2021/04/18/http-zhi-shi/1460000012196649" alt="img"></p><p>è¿™é‡Œå…¶å®å°±ç”¨åˆ°äº†<strong>éå¯¹ç§°åŠ å¯†ç®—æ³•</strong>ï¼Œåªä¸è¿‡ç°åœ¨è¿™ä¸ªåŠ å¯†ç®—æ³•ç”¨æ¥<strong>ç­¾å</strong>è€Œä¸æ˜¯<strong>åŠ å¯†</strong>ã€‚</p><p>ä½¿ç”¨ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼Œç”¨äºå…¬é’¥çš„æŒæœ‰è€…éªŒè¯é€šè¿‡ç§é’¥åŠ å¯†çš„å†…å®¹æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œä½†æ˜¯ä¸ç”¨æ¥ä¿è¯å†…å®¹æ˜¯å¦è¢«ä»–äººè·å¾—ã€‚</p><p>è€Œä½¿ç”¨å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œåˆ™æ˜¯ç›¸åçš„ï¼Œå®ƒä¸ä¿è¯ä¿¡æ¯è¢«ä»–äººæˆªè·ç¯¡æ”¹ï¼Œä½†æ˜¯ä¿è¯ä¿¡æ¯æ— æ³•è¢«ä¸­é—´äººè·å¾—ã€‚</p><h3 id="å®¢æˆ·ç«¯è¯ä¹¦"><a href="#å®¢æˆ·ç«¯è¯ä¹¦" class="headerlink" title="å®¢æˆ·ç«¯è¯ä¹¦"></a>å®¢æˆ·ç«¯è¯ä¹¦</h3><p>HTTPSä¸­ä¸ä»…å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨è¯ä¹¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦ã€‚ä»¥å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œå®¢æˆ·ç«¯è®¤è¯ï¼Œå®ƒçš„ä½œç”¨ä¸æœåŠ¡å™¨è¯ä¹¦æ˜¯ç›¸åŒçš„ã€‚</p><p>ç”±äºå®¢æˆ·ç«¯è·å–è¯ä¹¦éœ€è¦ç”¨æˆ·è‡ªè¡Œå®‰è£…å®¢æˆ·ç«¯è¯ä¹¦ï¼ŒåŒæ—¶ä¹Ÿé¢ä¸´ç€è´¹ç”¨çš„é—®é¢˜ã€‚</p><p>å› æ­¤ï¼Œç°çŠ¶æ˜¯ï¼Œå®‰å…¨æ€§æé«˜çš„è®¤è¯æœºæ„å¯åŠæ³•å®¢æˆ·ç«¯è¯ä¹¦ä½†æ˜¯ä»…ç”¨äºç‰¹æ®Šç”¨é€”çš„ä¸šåŠ¡ã€‚æ¯”å¦‚é‚£äº›å¯æ”¯æ’‘å®¢æˆ·ç«¯è¯ä¹¦æ”¯å‡ºè´¹ç”¨çš„ä¸šåŠ¡ã€‚</p><p>ä¾‹å¦‚ï¼Œé“¶è¡Œçš„ç½‘ä¸Šé“¶è¡Œå°±é‡‡ç”¨äº†å®¢æˆ·ç«¯è¯ä¹¦ã€‚åœ¨ç™»å½•ç½‘é“¶æ—¶ä¸ä»…è¦æ±‚ç”¨æˆ·ç¡®è®¤è¾“å…¥IDå’Œå¯†ç ï¼Œè¿˜ä¼šè¦æ±‚ç”¨æˆ·çš„å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä»¥ç¡®è®¤ç”¨æˆ·æ˜¯å¦ä»ç‰¹å®šçš„ç»ˆç«¯è®¿é—®ç½‘é“¶ã€‚</p><h2 id="HTTPSé€šä¿¡çš„è¿‡ç¨‹"><a href="#HTTPSé€šä¿¡çš„è¿‡ç¨‹" class="headerlink" title="HTTPSé€šä¿¡çš„è¿‡ç¨‹"></a>HTTPSé€šä¿¡çš„è¿‡ç¨‹</h2><p><img src="/2021/04/18/http-zhi-shi/1460000012196650" alt="img"></p><p>ç°åœ¨æˆ‘ä»¬æ¥ç†æ¸…ä¸€ä¸‹SSLå»ºç«‹çš„è¿‡ç¨‹ï¼š</p><ol><li><p>å®¢æˆ·ç«¯é€šè¿‡å‘é€Client HelloæŠ¥æ–‡å¼€å§‹SSLé€šä¿¡ã€‚æŠ¥æ–‡ä¸­åŒ…å«å®¢æˆ·ç«¯æ”¯æŒçš„SSLçš„æŒ‡å®šç‰ˆæœ¬ã€åŠ å¯†ç»„ä»¶ï¼ˆCipher Suiteï¼‰åˆ—è¡¨ï¼ˆæ‰€ä½¿ç”¨çš„åŠ å¯†ç®—æ³•åŠå¯†é’¥é•¿åº¦ç­‰ï¼‰ã€‚<br>æ³¨æ„ï¼šå®¢æˆ·ç«¯è¿˜ä¼šé™„åŠ ä¸€ä¸ª<strong>éšæœºæ•°</strong>ï¼Œè¿™é‡Œè®°ä¸ºAã€‚</p></li><li><p>æœåŠ¡å™¨å¯è¿›è¡ŒSSLé€šä¿¡æ—¶ï¼Œä¼šä»¥Server HelloæŠ¥æ–‡ä½œä¸ºåº”ç­”ã€‚å’Œå®¢æˆ·ç«¯ä¸€æ ·ï¼Œåœ¨æŠ¥æ–‡ä¸­åŒ…å«SSLç‰ˆæœ¬ä»¥åŠåŠ å¯†ç»„ä»¶ã€‚æœåŠ¡å™¨çš„åŠ å¯†ç»„ä»¶å†…å®¹æ˜¯ä»æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯åŠ å¯†ç»„ä»¶å†…ç­›é€‰å‡ºæ¥çš„ã€‚<br>æ³¨æ„ï¼šè¿™é‡ŒæœåŠ¡å™¨åŒæ ·ä¼šé™„åŠ ä¸€ä¸ª<strong>éšæœºæ•°</strong>ï¼Œå‘ç»™å®¢æˆ·ç«¯ï¼Œè¿™é‡Œè®°ä¸ºBã€‚</p></li><li><p>ä¹‹åæœåŠ¡å™¨å‘é€CertificateæŠ¥æ–‡ã€‚æŠ¥æ–‡ä¸­åŒ…å«å…¬å¼€å¯†é’¥è¯ä¹¦ã€‚ï¼ˆå…·ä½“çš„æ•°å­—ç­¾åè¯·çœ‹è¯ä¹¦ä¸€èŠ‚ï¼‰</p></li><li><p>æœ€åæœåŠ¡å™¨å‘é€Server Hello DoneæŠ¥æ–‡é€šçŸ¥å®¢æˆ·ç«¯ï¼Œæœ€åˆé˜¶æ®µçš„SSLæ¡æ‰‹åå•†éƒ¨åˆ†ç»“æŸã€‚</p></li><li><p>SSLç¬¬ä¸€æ¬¡æ¡æ‰‹ç»“æŸåï¼Œå®¢æˆ·ç«¯ä¼šå¯¹æœåŠ¡å™¨å‘è¿‡æ¥çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œè§£å¯†å–å‡ºè¯ä¹¦ä¸­çš„å…¬é’¥ã€‚ï¼ˆå…·ä½“æŸ¥çœ‹è¯ä¹¦ä¸€èŠ‚ï¼‰<br>æ¥ç€ï¼Œå®¢æˆ·ç«¯ä»¥Client Key ExchangeæŠ¥æ–‡ä½œä¸ºå›åº”ã€‚æŠ¥æ–‡ä¸­åŒ…å«é€šä¿¡åŠ å¯†ä¸­ä½¿ç”¨çš„ä¸€ç§è¢«ç§°ä¸º<code>Pre-master secret</code>çš„éšæœºå¯†ç ä¸²ã€‚è¯¥æŠ¥æ–‡ä½¿ç”¨ä»è¯ä¹¦ä¸­è§£å¯†è·å¾—çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼ˆå…¶å®å°±æ˜¯æœåŠ¡å™¨çš„å…¬é’¥ï¼‰ã€‚</p></li><li><p>å®¢æˆ·ç«¯ç»§ç»­å‘é€Change Cipher SpecæŠ¥æ–‡ã€‚ç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯å·²ç»åˆ‡æ¢åˆ°ä¹‹å‰åå•†å¥½çš„åŠ å¯†å¥—ä»¶ï¼ˆCipher Suiteï¼‰çš„çŠ¶æ€ï¼Œå‡†å¤‡ä½¿ç”¨ä¹‹å‰åå•†å¥½çš„åŠ å¯†å¥—ä»¶åŠ å¯†æ•°æ®å¹¶ä¼ è¾“äº†ã€‚</p></li><li><p>å®¢æˆ·ç«¯å‘é€FinishedæŠ¥æ–‡ã€‚è¯¥æŠ¥æ–‡åŒ…å«è¿æ¥è‡³ä»Šå…¨éƒ¨æŠ¥æ–‡çš„æ•´ä½“æ ¡éªŒå€¼ï¼ˆä¹Ÿå°±æ˜¯HASHå€¼ï¼‰ï¼Œç”¨æ¥ä¾›æœåŠ¡å™¨æ ¡éªŒã€‚</p></li><li><p>æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ä¹‹åï¼Œä½¿ç”¨ç§é’¥è§£å¯†æŠ¥æ–‡ï¼ŒæŠŠ<code>Pre-master secret</code>å–å‡ºæ¥ã€‚æ¥ç€ï¼ŒæœåŠ¡å™¨åŒæ ·å‘é€Change Cipher SpecæŠ¥æ–‡ã€‚</p></li><li><p>æœåŠ¡å™¨åŒæ ·å‘é€FinishedæŠ¥æ–‡ï¼Œç”¨æ¥ä¾›å®¢æˆ·ç«¯æ ¡éªŒã€‚</p></li><li><p>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„FinishedæŠ¥æ–‡äº¤æ¢å®Œæ¯•ä¹‹åï¼ŒSSLè¿æ¥å°±ç®—å»ºç«‹å®Œæˆã€‚å½“ç„¶ï¼Œé€šä¿¡ä¼šå—åˆ°SSLçš„ä¿æŠ¤ã€‚ä»æ­¤å¤„å¼€å§‹è¿›è¡Œåº”ç”¨å±‚åè®®çš„é€šä¿¡ï¼Œå³å‘é€HTTPè¯·æ±‚ã€‚</p></li><li><p>åº”ç”¨å±‚åè®®é€šä¿¡ï¼Œå³å‘é€HTTPå“åº”ã€‚</p></li><li><p>æœ€åç”±å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ã€‚æ–­å¼€è¿æ¥æ—¶ï¼Œå‘é€close_notifyæŠ¥æ–‡ã€‚ä¸Šå›¾åšäº†ä¸€äº›çœç•¥ï¼Œè¿™æ­¥ä¹‹åå†å‘é€TCP FINæŠ¥æ–‡æ¥å…³é—­ä¸TCPçš„é€šä¿¡ã€‚</p></li></ol><p>è¯»åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šå¯¹ä¸Šé¢çš„ä¸€äº›ç»†èŠ‚äº§ç”Ÿå¾ˆå¤šç–‘æƒ‘ï¼Œç°åœ¨æˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥ç†æ¸…æ¥šï¼Ÿ</p><h4 id="é—®é¢˜ä¸€"><a href="#é—®é¢˜ä¸€" class="headerlink" title="é—®é¢˜ä¸€"></a>é—®é¢˜ä¸€</h4><p>ä¸ºä»€ä¹ˆæœ€åå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½è¦å‘é€ä¸€ä¸ªFinishæŠ¥æ–‡ï¼Ÿ</p><p>ä¸Šé¢å·²ç»æåŠï¼ŒFinishæŠ¥æ–‡æ˜¯å¯¹è‡³ä»Šå…¨éƒ¨æŠ¥æ–‡çš„æ•´ä½“æ ¡éªŒå€¼ï¼ˆä¹Ÿå°±æ˜¯HASHå€¼ï¼‰ã€‚å½“å®¢æˆ·ç«¯æŠŠè¿™ä¸ªå€¼é€šè¿‡å¾—åˆ°çš„å…¬é’¥è¿›è¡ŒåŠ å¯†çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å¾—åˆ°ä¹‹åå¯¹å…¶è¿›è¡Œè§£å¯†ï¼Œç„¶åå†å¯¹å…¨éƒ¨æŠ¥æ–‡è¿›è¡Œä¸€ä¸ªHASHæ±‚å€¼ã€‚å¦‚æœè¿™ä¸ªå€¼è·Ÿè§£å¯†å¾—åˆ°çš„å€¼ç›¸ç­‰çš„è¯ï¼Œé‚£ä¹ˆè¯´æ˜å®¢æˆ·ç«¯æ˜¯å¯ä¿¡èµ–çš„ã€‚<br>åŒæ ·çš„ï¼ŒæœåŠ¡å™¨å‘é€è¿™æ ·çš„ä¸€ä¸ªæ•´ä½“æ ¡éªŒå€¼ï¼Œç”¨æ¥å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨æ˜¯å¦æ˜¯çœŸæ­£è¦è¿›è¡Œé€šä¿¡çš„é‚£ä¸€ä¸ªã€‚<br>ç»¼ä¸Šï¼Œè¿™ä¸ªFinishæŠ¥æ–‡å°±æ˜¯ç”¨æ¥æ ¡éªŒåŒæ–¹çš„èº«ä»½çš„ã€‚</p><h4 id="é—®é¢˜äºŒ"><a href="#é—®é¢˜äºŒ" class="headerlink" title="é—®é¢˜äºŒ"></a>é—®é¢˜äºŒ</h4><p>æ•´ä¸ªè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸‰ä¸ª<strong>éšæœºæ•°</strong>æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¿˜æœ‰ï¼Œåé¢è¿›è¡ŒHTTPé€šä¿¡çš„æ—¶å€™ï¼Œæ˜¯ç”¨å“ªä¸€ä¸ªå¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œè¿˜æœ‰æ€ä¹ˆä¿è¯æŠ¥æ–‡çš„å®Œæ•´æ€§ã€‚</p><p>çœ‹ä¸‹é¢è¿™å¼ å›¾ã€‚</p><p><img src="/2021/04/18/http-zhi-shi/1460000012196651" alt="img"></p><p>å¯¹äº<strong>å®¢æˆ·ç«¯</strong>ï¼š<br>å½“å…¶ç”Ÿæˆäº†<code>Pre-master secret</code>ä¹‹åï¼Œä¼šç»“åˆåŸæ¥çš„Aã€Béšæœºæ•°ï¼Œç”¨DHç®—æ³•è®¡ç®—å‡ºä¸€ä¸ª<code>master secret</code>ï¼Œç´§æ¥ç€æ ¹æ®è¿™ä¸ª<code>master secret</code>æ¨å¯¼å‡º<code>hash secret</code>å’Œ<code>session secret</code>ã€‚</p><p>å¯¹äº<strong>æœåŠ¡ç«¯</strong>ï¼š<br>å½“å…¶è§£å¯†è·å¾—äº†<code>Pre-master secret</code>ä¹‹åï¼Œä¼šç»“åˆåŸæ¥çš„Aã€Béšæœºæ•°ï¼Œç”¨DHç®—æ³•è®¡ç®—å‡ºä¸€ä¸ª<code>master secret</code>ï¼Œç´§æ¥ç€æ ¹æ®è¿™ä¸ª<code>master secret</code>æ¨å¯¼å‡º<code>hash secret</code>å’Œ<code>session secret</code>ã€‚</p><blockquote><p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„<code>master secret</code>æ˜¯ä¾æ®ä¸‰ä¸ªéšæœºæ•°æ¨å¯¼å‡ºæ¥çš„ï¼Œå®ƒæ˜¯ä¸ä¼šåœ¨ç½‘ç»œä¸Šä¼ è¾“çš„ï¼Œåªæœ‰åŒæ–¹çŸ¥é“ï¼Œä¸ä¼šæœ‰ç¬¬ä¸‰è€…çŸ¥é“ã€‚åŒæ—¶ï¼Œå®¢æˆ·ç«¯æ¨å¯¼å‡ºæ¥çš„<code>session secret</code>å’Œ<code>hash secret</code>ä¸æœåŠ¡ç«¯ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p></blockquote><p>é‚£ä¹ˆç°åœ¨åŒæ–¹å¦‚æœå¼€å§‹ä½¿ç”¨å¯¹ç§°ç®—æ³•åŠ å¯†æ¥è¿›è¡Œé€šè®¯ï¼Œä½¿ç”¨å“ªä¸ªä½œä¸ºå…±äº«çš„å¯†é’¥å‘¢ï¼Ÿè¿‡ç¨‹æ˜¯è¿™æ ·å­çš„ï¼š</p><p>åŒæ–¹ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œç”¨<code>hash secret</code>å¯¹HTTPæŠ¥æ–‡åšä¸€æ¬¡è¿ç®—ç”Ÿæˆä¸€ä¸ª<code>MAC</code>ï¼Œé™„åœ¨HTTPæŠ¥æ–‡çš„åé¢ï¼Œç„¶åç”¨<code>session-secret</code>åŠ å¯†æ‰€æœ‰æ•°æ®ï¼ˆ<code>HTTP+MAC</code>ï¼‰ï¼Œç„¶åå‘é€ã€‚</p><p>æ¥æ”¶æ–¹åˆ™å…ˆç”¨<code>session-secret</code>è§£å¯†æ•°æ®ï¼Œç„¶åå¾—åˆ°<code>HTTP+MAC</code>ï¼Œå†ç”¨ç›¸åŒçš„ç®—æ³•è®¡ç®—å‡ºè‡ªå·±çš„<code>MAC</code>ï¼Œå¦‚æœä¸¤ä¸ª<code>MAC</code>ç›¸ç­‰ï¼Œè¯æ˜æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p><blockquote><p>MAC(Message Authentication Code)ç§°ä¸ºæŠ¥æ–‡æ‘˜è¦ï¼Œèƒ½å¤ŸæŸ¥çŸ¥æŠ¥æ–‡æ˜¯å¦é­åˆ°ç¯¡æ”¹ï¼Œä»è€Œä¿æŠ¤æŠ¥æ–‡çš„å®Œæ•´æ€§ã€‚</p></blockquote><h4 id="é—®é¢˜ä¸‰"><a href="#é—®é¢˜ä¸‰" class="headerlink" title="é—®é¢˜ä¸‰"></a>é—®é¢˜ä¸‰</h4><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰ä¸ªéšæœºæ•°å‘¢ï¼Ÿ</p><p>ç½‘å‹dog250æ˜¯è¿™ä¹ˆè§£é‡Šçš„ï¼š</p><blockquote><p>â€œä¸ç®¡æ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œéƒ½éœ€è¦éšæœºæ•°ï¼Œè¿™æ ·ç”Ÿæˆçš„å¯†é’¥æ‰ä¸ä¼šæ¯æ¬¡éƒ½ä¸€æ ·ã€‚ç”±äºSSLåè®®ä¸­è¯ä¹¦æ˜¯é™æ€çš„ï¼Œå› æ­¤ååˆ†æœ‰å¿…è¦å¼•å…¥ä¸€ç§éšæœºå› ç´ æ¥ä¿è¯åå•†å‡ºæ¥çš„å¯†é’¥çš„éšæœºæ€§ã€‚<br>å¯¹äºRSAå¯†é’¥äº¤æ¢ç®—æ³•æ¥è¯´ï¼Œ<code>pre-master secret</code>æœ¬èº«å°±æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œå†åŠ ä¸Šhelloæ¶ˆæ¯ä¸­çš„éšæœºï¼Œä¸‰ä¸ªéšæœºæ•°é€šè¿‡ä¸€ä¸ªå¯†é’¥å¯¼å‡ºå™¨æœ€ç»ˆå¯¼å‡ºä¸€ä¸ªå¯¹ç§°å¯†é’¥ã€‚<br><code>pre-master secret</code>çš„å­˜åœ¨åœ¨äºSSLåè®®ä¸ä¿¡ä»»æ¯ä¸ªä¸»æœºéƒ½èƒ½äº§ç”Ÿå®Œå…¨éšæœºçš„éšæœºæ•°ï¼Œå¦‚æœéšæœºæ•°ä¸éšæœºï¼Œé‚£ä¹ˆ<code>pre-master secret</code>å°±æœ‰å¯èƒ½è¢«çŒœå‡ºæ¥ï¼Œé‚£ä¹ˆä»…é€‚ç”¨<code>pre-master secret</code>ä½œä¸ºå¯†é’¥å°±ä¸åˆé€‚äº†ï¼Œå› æ­¤å¿…é¡»å¼•å…¥æ–°çš„éšæœºå› ç´ ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŠ ä¸Š<code>pre-master secret</code>ä¸‰ä¸ªéšæœºæ•°ä¸€åŒç”Ÿæˆçš„å¯†é’¥å°±ä¸å®¹æ˜“è¢«çŒœå‡ºäº†ï¼Œä¸€ä¸ªä¼ªéšæœºå¯èƒ½å®Œå…¨ä¸éšæœºï¼Œå¯æ˜¯æ˜¯ä¸‰ä¸ªä¼ªéšæœºå°±ååˆ†æ¥è¿‘éšæœºäº†ï¼Œæ¯å¢åŠ ä¸€ä¸ªè‡ªç”±åº¦ï¼Œéšæœºæ€§å¢åŠ çš„å¯ä¸æ˜¯ä¸€ã€‚â€</p></blockquote><p>æ³¨ï¼šæˆ‘ä»¬åœ¨è®¡ç®—æœºæ‰€ä½¿ç”¨çš„éšæœºæ•°éƒ½æ˜¯ä¼ªéšæœºï¼Œè€Œä¸æ˜¯ç‰©ç†ä¸Šæ‰€è¯´çš„çœŸæ­£éšæœºã€‚</p><p>å¦å¤–ï¼Œé»‘å®¢å¯èƒ½æ‹¦æˆªäº†è¿™æ ·çš„ä¸€ä¸ªåŠ å¯†çš„æŠ¥æ–‡ï¼Œä»–ä¸å¯¹æŠ¥æ–‡è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯ä¸åœçš„å‘æŠ¥æ–‡çš„æ¥å—è€…å‘é€é‡å¤çš„æŠ¥æ–‡ï¼Œä»¥æ‰°ä¹±é€šä¿¡çš„å»ºç«‹ã€‚äºæ˜¯ï¼Œå°±å¯ä»¥åŠ è¿™ä¹ˆä¸€ä¸ªéšæœºæ•°ã€‚åªè¦ä»»ä½•ä¸€ä¸ªé€šä¿¡æ–¹ï¼Œæ¥æ”¶åˆ°çš„æŠ¥æ–‡ä¸­çš„éšæœºæ•°å‡ºç°é‡å¤çš„æƒ…å†µï¼Œå°±å¯ä»¥çŸ¥é“æœ‰ä¸­é—´è€…å¯¹é€šä¿¡çš„è¿‡ç¨‹è¿›è¡Œäº†æ‰°ä¹±ï¼Œå¯ä»¥ç«‹å³ä¸­æ–­é€šä¿¡ã€‚</p><h4 id="é—®é¢˜å››"><a href="#é—®é¢˜å››" class="headerlink" title="é—®é¢˜å››"></a>é—®é¢˜å››</h4><p>å¦‚æœé»‘å®¢æ‹¦æˆªäº†æœåŠ¡å™¨æŠŠè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¹¶å¯¹è¯ä¹¦è¿›è¡Œæ¶æ„ä¿®æ”¹ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ</p><p>ç¬¬ä¸€ç§æƒ…å†µï¼Œå‡å¦‚é»‘å®¢åªæ˜¯å•çº¯çš„ä¿®æ”¹æ•°å­—è¯ä¹¦ä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆç”±äºæ•°å­—ç­¾åçš„å­˜åœ¨ï¼Œå®¢æˆ·ç«¯ä¼šå¾ˆå®¹æ˜“çš„åˆ¤æ–­å‡ºæŠ¥æ–‡æ˜¯å¦è¢«ç¯¡æ”¹ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µï¼Œé»‘å®¢ä¸ä»…ä¿®æ”¹äº†æ•°å­—è¯ä¹¦çš„å†…å®¹ï¼Œå¹¶ä¸”æŠŠæ•°å­—ç­¾åæ›¿æ¢æ‰äº†ï¼Œç”±äºé»‘å®¢ä¸å¯èƒ½çŸ¥é“CAçš„ç§é’¥ï¼Œäºæ˜¯åœ¨å®¢æˆ·ç«¯ç”¨CAçš„å…¬é’¥è¿›è¡Œè§£å¯†çš„æ—¶å€™ï¼Œè§£å¯†ä¹‹åå¾—ä¸åˆ°æ­£ç¡®çš„ä¿¡æ¯ï¼Œä¹Ÿå¾ˆå®¹æ˜“åˆ¤æ–­å‡ºæŠ¥æ–‡æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p><p>ç¬¬ä¸‰ç§æƒ…å†µï¼Œé»‘å®¢æ¶æ„çš„ä»ç›¸åŒçš„ç¬¬ä¸‰æ–¹CAç”³è¯·äº†ä¸€ä¸ªæ•°å­—è¯ä¹¦ã€‚ç”±äºè¿™ä¸ªCAæ˜¯çœŸå®å­˜åœ¨çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯æ˜¯å¯ä»¥ç”¨CAçš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°äº†é»‘å®¢æä¾›çš„æ•°å­—è¯ä¹¦ä¸­çš„å…¬é’¥ã€‚ä½†æ˜¯ï¼Œç”±äºæ•°å­—è¯ä¹¦åœ¨ç”³è¯·çš„æ—¶å€™ï¼Œä¼šç»‘å®šä¸€ä¸ª<strong>åŸŸå</strong>ï¼Œå½“å®¢æˆ·ç«¯æ¯”å¦‚è¯´æµè§ˆå™¨ï¼Œæ£€æµ‹åˆ°è¿™ä¸ªæ•°å­—è¯ä¹¦ä¸­çš„åŸŸåå’Œæˆ‘ä»¬ç°åœ¨ç½‘é¡µè®¿é—®çš„åŸŸåä¸ä¸€è‡´ï¼Œä¾¿ä¼šå‘å‡ºè­¦å‘Šï¼Œæ­¤æ—¶æˆ‘ä»¬ä¹Ÿèƒ½å¾—çŸ¥æ•°å­—è¯ä¹¦è¢«æ›¿æ¢äº†ã€‚å‘å‡ºçš„è­¦å‘Šå¦‚ä¸‹ï¼š</p><p><img src="/2021/04/18/http-zhi-shi/bV0FNg" alt="89294765.jpg"></p><h2 id="ä¸€å®šè¦ç”¨HTTPSå—"><a href="#ä¸€å®šè¦ç”¨HTTPSå—" class="headerlink" title="ä¸€å®šè¦ç”¨HTTPSå—"></a>ä¸€å®šè¦ç”¨HTTPSå—</h2><p>å½“HTTPæŠ«ä¸ŠSSLå¤–å£³ä¹‹åï¼Œç”±äºåŠ å…¥äº†è¯¸å¤šéªŒè¯çš„æœºåˆ¶ï¼Œè™½ç„¶å®‰å…¨æ€§å¤§å¤§æé«˜äº†ï¼Œä½†æ˜¯å®ƒçš„å¤„ç†é€Ÿåº¦ä¼šå˜æ…¢ã€‚æ…¢çš„åŸå› åˆ†ä»¥ä¸‹ä¸¤ç§ï¼š</p><ul><li>æœåŠ¡å™¨åœ¨ä¸å®¢æˆ·ç«¯åå•†æ¬¡æ•°å¢å¤šï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä½“ä¸Šå¤„ç†<strong>é€šä¿¡é‡</strong>ä¼šä¸å¯é¿å…çš„å¢åŠ ã€‚</li><li>SSLè¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½éœ€è¦è¿›è¡ŒåŠ å¯†å’Œè§£å¯†çš„<strong>è¿ç®—å¤„ç†</strong>ã€‚ç»“æœä¼šæ¶ˆè€—æ›´å¤šçš„ç¡¬ä»¶èµ„æºï¼Œå¯¼è‡´è´Ÿè½½å¢åŠ ã€‚</li></ul><p>å¯è§ï¼Œä½¿ç”¨HTTPSä¼šæ¶ˆè€—æ›´å¤šçš„èµ„æºã€‚å¦‚æœæ¯æ¬¡é€šä¿¡éƒ½åŠ å¯†ï¼Œé‚£ä¹ˆå¹³æ‘Šåˆ°ä¸€å°è®¡ç®—æœºä¸Šï¼Œèƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚æ•°é‡ä¹Ÿå¿…å®šä¼šå‡å°‘ã€‚</p><p>åŒæ—¶ï¼Œä½¿ç”¨HTTPSéœ€è¦å‘CAè´­ä¹°è¯ä¹¦ï¼Œäºæ˜¯<strong>å¼€é”€</strong>ä¹Ÿæˆä¸ºè€ƒè™‘æ˜¯å¦ä½¿ç”¨HTTPSçš„åŸå› ä¹‹ä¸€ã€‚</p><p>æ‰€ä»¥ï¼Œå¤§éƒ¨åˆ†çš„Webç½‘ç«™éƒ½é‡‡å–äº†ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ³•ã€‚å¯¹äºä¸€äº›éœ€è¦éšè—ã€ç§å¯†çš„ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œè€Œæ™®é€šçš„ä¿¡æ¯ä¸è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œä»¥èŠ‚çœèµ„æºã€‚</p><h2 id="fiddleræ‹¦æˆªHTTPSè¯·æ±‚çš„åŸç†"><a href="#fiddleræ‹¦æˆªHTTPSè¯·æ±‚çš„åŸç†" class="headerlink" title="fiddleræ‹¦æˆªHTTPSè¯·æ±‚çš„åŸç†"></a>fiddleræ‹¦æˆªHTTPSè¯·æ±‚çš„åŸç†</h2><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡fiddleræ¥è¿›è¡ŒæŠ“HTTPåŒ…ï¼Œä½†æ˜¯å½“é‡åˆ°è¿æ¥é‡‡ç”¨çš„æ˜¯HTTPSçš„æ—¶å€™ï¼Œè¿‡ç¨‹å¯èƒ½å°±ä¸é‚£ä¹ˆæ„‰å¿«äº†ã€‚ä½†å®é™…ä¸Šå®ç°æ‹¦æˆªä¹Ÿååˆ†ç®€å•ã€‚</p><p>fiddleræ‹¦æˆªHTTPSè¯·æ±‚æœ€æ ¸å¿ƒçš„åœ°æ–¹åœ¨äºçœŸæ­£çš„<strong>å®¢æˆ·ç«¯</strong>éœ€è¦<strong>å®‰è£…fiddlerçš„è¯ä¹¦</strong>ã€‚è¿™æ ·å­çš„è¯ï¼Œfiddlerèƒ½å¤Ÿä¼ªé€ å‡ºCAè¯ä¹¦ï¼Œè¾¾åˆ°æ¬ºéª—å®¢æˆ·ç«¯ï¼Œæ‹¿åˆ°éœ€è¦çš„ä¿¡æ¯å¹¶æ¨ç®—å‡ºä¹‹ååŒæ–¹æ­£å¸¸é€šä¿¡çš„å¯¹ç§°åŠ å¯†å¯†é’¥ã€‚</p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>è¿™å­¦æœŸåˆšå¥½æœ‰ã€Šä¿¡æ¯å®‰å…¨ã€‹è¿™é—¨è¯¾ç¨‹ï¼Œé‚£å°±ç®€æ˜çš„ä»‹ç»ä¸€ä¸‹å…¬é’¥å¯†ç å¯†ç ä½“ç³»RSAç®—æ³•åŸç†æ˜¯ä»€ä¹ˆã€‚</p><p>å®ƒæ˜¯è¿™æ ·å­å·¥ä½œçš„ï¼š</p><ol><li>é€‰å–ä¸¤ä¸ªå¤§ç´ æ•°<code>p</code>å’Œ<code>q</code>ï¼Œç›¸ä¹˜å¾—åˆ°<code>n</code>ã€‚</li><li><code>p-1</code>å’Œ<code>q-1</code>ç›¸ä¹˜ï¼Œå¾—åˆ°<code>f(n)</code>ã€‚</li><li>éšæœºé€‰å–ä¸€ä¸ª<code>e</code>ä¸<code>f(n)</code>äº’è´¨ï¼Œç„¶åå¾—åˆ°å…¬é’¥<code>(e, n)</code>ã€‚</li><li>ç§é’¥çš„æ±‚æ³•ä¸º<code>ed = 1 mod f(n)</code>ã€‚ [è¿™æ˜¯ä¸€ä¸ªç­‰ä»·å…³ç³»è€Œä¸æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼ä¹Ÿå°±æ˜¯<code>ed</code>æ¨¡<code>fn(n)</code>çš„ç»“æœæ˜¯1ï¼Œè¿™æ˜¯æ±‚æ¨¡è¿ç®—çš„é€†è¿ç®—ï¼Œå¯ä»¥ç”¨æ¬§å‡ é‡Œå¾·è¾—è½¬ç›¸é™¤æ³•æ±‚å¾—]</li><li>æœ€åå¾—åˆ°çš„ç§é’¥ä¸º<code>(d, n)</code>ã€‚</li></ol><blockquote><p>æ•´ä¸ªRSAå…¬é’¥å¯†ç ç®—æ³•çš„éš¾åº¦å…¶å®åœ¨äºåˆ†è§£è¿™ä¸€ä¸ªå¤§æ•°<code>n</code>ï¼Œ<code>pq=n</code>æ­£å‘è¿ç®—å¾ˆå®¹æ˜“ï¼Œé€†å‘è¿ç®—å¾ˆå›°éš¾ï¼Œéšç€è¿™ä¸ªæ•°è¶Šæ¥è¶Šå¤§ï¼Œæƒ³è¦é€†å‘åˆ†è§£éœ€è¦å¾ˆå¤šå¹´çš„æ—¶é—´ã€‚</p></blockquote><p><img src="/2021/04/18/http-zhi-shi/1460000012630692" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¿›ç¨‹é—´çš„é€šä¿¡IPC</title>
      <link href="2021/04/13/jin-cheng-jian-de-tong-xin-ipc/"/>
      <url>2021/04/13/jin-cheng-jian-de-tong-xin-ipc/</url>
      
        <content type="html"><![CDATA[<h4 id="ä¸€ã€è¿›ç¨‹é—´é€šä¿¡çš„æ¦‚å¿µ"><a href="#ä¸€ã€è¿›ç¨‹é—´é€šä¿¡çš„æ¦‚å¿µ" class="headerlink" title="ä¸€ã€è¿›ç¨‹é—´é€šä¿¡çš„æ¦‚å¿µ"></a>ä¸€ã€è¿›ç¨‹é—´é€šä¿¡çš„æ¦‚å¿µ</h4><p>æ¯ä¸ªè¿›ç¨‹å„è‡ªæœ‰ä¸åŒçš„ç”¨æˆ·åœ°å€ç©ºé—´ï¼Œä»»ä½•ä¸€ä¸ªè¿›ç¨‹çš„å…¨å±€å˜é‡åœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­éƒ½çœ‹ä¸åˆ°ï¼Œæ‰€ä»¥è¿›ç¨‹ä¹‹é—´è¦äº¤æ¢æ•°æ®å¿…é¡»é€šè¿‡å†…æ ¸ï¼Œåœ¨å†…æ ¸ä¸­å¼€è¾Ÿä¸€å—ç¼“å†²åŒºï¼Œè¿›ç¨‹1æŠŠæ•°æ®ä»ç”¨æˆ·ç©ºé—´æ‹·åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œè¿›ç¨‹2å†ä»å†…æ ¸ç¼“å†²åŒºæŠŠæ•°æ®è¯»èµ°ï¼Œå†…æ ¸æä¾›çš„è¿™ç§æœºåˆ¶ç§°ä¸º<strong>è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼ŒInterProcess Communicationï¼‰</strong></p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1.PNG"></p><p>è¿›ç¨‹é—´é€šä¿¡æ¨¡å‹</p><h4 id="äºŒã€è¿›ç¨‹é—´é€šä¿¡çš„7ç§æ–¹å¼"><a href="#äºŒã€è¿›ç¨‹é—´é€šä¿¡çš„7ç§æ–¹å¼" class="headerlink" title="äºŒã€è¿›ç¨‹é—´é€šä¿¡çš„7ç§æ–¹å¼"></a>äºŒã€è¿›ç¨‹é—´é€šä¿¡çš„7ç§æ–¹å¼</h4><p><strong>ç¬¬ä¸€ç±»ï¼šä¼ ç»Ÿçš„Unixé€šä¿¡æœºåˆ¶</strong><br> <strong>1. ç®¡é“/åŒ¿åç®¡é“(pipe)</strong></p><ul><li><p>ç®¡é“æ˜¯åŠåŒå·¥çš„ï¼Œæ•°æ®åªèƒ½å‘ä¸€ä¸ªæ–¹å‘æµåŠ¨ï¼›éœ€è¦åŒæ–¹é€šä¿¡æ—¶ï¼Œéœ€è¦å»ºç«‹èµ·ä¸¤ä¸ªç®¡é“ã€‚</p></li><li><p>åªèƒ½ç”¨äºçˆ¶å­è¿›ç¨‹æˆ–è€…å…„å¼Ÿè¿›ç¨‹ä¹‹é—´(å…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹);</p></li><li><p>å•ç‹¬æ„æˆä¸€ç§ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼šç®¡é“å¯¹äºç®¡é“ä¸¤ç«¯çš„è¿›ç¨‹è€Œè¨€ï¼Œå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†å®ƒä¸æ˜¯æ™®é€šçš„æ–‡ä»¶ï¼Œå®ƒä¸å±äºæŸç§æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯è‡ªç«‹é—¨æˆ·ï¼Œå•ç‹¬æ„æˆä¸€ç§æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”åªå­˜åœ¨ä¸å†…å­˜ä¸­ã€‚</p></li><li><p>æ•°æ®çš„è¯»å‡ºå’Œå†™å…¥ï¼šä¸€ä¸ªè¿›ç¨‹å‘ç®¡é“ä¸­å†™çš„å†…å®¹è¢«ç®¡é“å¦ä¸€ç«¯çš„è¿›ç¨‹è¯»å‡ºã€‚å†™å…¥çš„å†…å®¹æ¯æ¬¡éƒ½æ·»åŠ åœ¨ç®¡é“ç¼“å†²åŒºçš„æœ«å°¾ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½æ˜¯ä»ç¼“å†²åŒºçš„å¤´éƒ¨è¯»å‡ºæ•°æ®ã€‚</p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.PNG"></p><p>è¿›ç¨‹é—´ç®¡é“é€šä¿¡æ¨¡å‹</p></li></ul><p><strong>ç®¡é“çš„å®è´¨ï¼š</strong><br> ç®¡é“çš„å®è´¨æ˜¯ä¸€ä¸ªå†…æ ¸ç¼“å†²åŒºï¼Œè¿›ç¨‹ä»¥å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼ä»ç¼“å†²åŒºå­˜å–æ•°æ®ï¼Œç®¡é“ä¸€ç«¯çš„è¿›ç¨‹é¡ºåºçš„å°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå¦ä¸€ç«¯çš„è¿›ç¨‹åˆ™é¡ºåºçš„è¯»å‡ºæ•°æ®ã€‚<br> è¯¥ç¼“å†²åŒºå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œè¯»å’Œå†™çš„ä½ç½®éƒ½æ˜¯è‡ªåŠ¨å¢é•¿çš„ï¼Œä¸èƒ½éšæ„æ”¹å˜ï¼Œä¸€ä¸ªæ•°æ®åªèƒ½è¢«è¯»ä¸€æ¬¡ï¼Œè¯»å‡ºæ¥ä»¥ååœ¨ç¼“å†²åŒºå°±ä¸å¤å­˜åœ¨äº†ã€‚<br> å½“ç¼“å†²åŒºè¯»ç©ºæˆ–è€…å†™æ»¡æ—¶ï¼Œæœ‰ä¸€å®šçš„è§„åˆ™æ§åˆ¶ç›¸åº”çš„è¯»è¿›ç¨‹æˆ–è€…å†™è¿›ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå½“ç©ºçš„ç¼“å†²åŒºæœ‰æ–°æ•°æ®å†™å…¥æˆ–è€…æ»¡çš„ç¼“å†²åŒºæœ‰æ•°æ®è¯»å‡ºæ¥æ—¶ï¼Œå°±å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ç»§ç»­è¯»å†™ã€‚</p><p><strong>ç®¡é“çš„å±€é™ï¼š</strong><br> ç®¡é“çš„ä¸»è¦å±€é™æ€§æ­£ä½“ç°åœ¨å®ƒçš„ç‰¹ç‚¹ä¸Šï¼š</p><ul><li>åªæ”¯æŒå•å‘æ•°æ®æµï¼›</li><li>åªèƒ½ç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´ï¼›</li><li>æ²¡æœ‰åå­—ï¼›</li><li>ç®¡é“çš„ç¼“å†²åŒºæ˜¯æœ‰é™çš„ï¼ˆç®¡é“åˆ¶å­˜åœ¨äºå†…å­˜ä¸­ï¼Œåœ¨ç®¡é“åˆ›å»ºæ—¶ï¼Œä¸ºç¼“å†²åŒºåˆ†é…ä¸€ä¸ªé¡µé¢å¤§å°ï¼‰ï¼›</li><li>ç®¡é“æ‰€ä¼ é€çš„æ˜¯æ— æ ¼å¼å­—èŠ‚æµï¼Œè¿™å°±è¦æ±‚ç®¡é“çš„è¯»å‡ºæ–¹å’Œå†™å…¥æ–¹å¿…é¡»äº‹å…ˆçº¦å®šå¥½æ•°æ®çš„æ ¼å¼ï¼Œæ¯”å¦‚å¤šå°‘å­—èŠ‚ç®—ä½œä¸€ä¸ªæ¶ˆæ¯ï¼ˆæˆ–å‘½ä»¤ã€æˆ–è®°å½•ï¼‰ç­‰ç­‰ï¼›</li></ul><p><strong>2. æœ‰åç®¡é“(FIFO)</strong><br> åŒ¿åç®¡é“ï¼Œç”±äºæ²¡æœ‰åå­—ï¼Œåªèƒ½ç”¨äºäº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªç¼ºç‚¹ï¼Œæå‡ºäº†æœ‰åç®¡é“(FIFO)ã€‚<br> æœ‰åç®¡é“ä¸åŒäºåŒ¿åç®¡é“ä¹‹å¤„åœ¨äºå®ƒæä¾›äº†ä¸€ä¸ªè·¯å¾„åä¸ä¹‹å…³è”ï¼Œ<strong>ä»¥æœ‰åç®¡é“çš„æ–‡ä»¶å½¢å¼å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­</strong>ï¼Œè¿™æ ·ï¼Œ<strong>å³ä½¿ä¸æœ‰åç®¡é“çš„åˆ›å»ºè¿›ç¨‹ä¸å­˜åœ¨äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼Œåªè¦å¯ä»¥è®¿é—®è¯¥è·¯å¾„ï¼Œå°±èƒ½å¤Ÿå½¼æ­¤é€šè¿‡æœ‰åç®¡é“ç›¸äº’é€šä¿¡</strong>ï¼Œå› æ­¤ï¼Œé€šè¿‡æœ‰åç®¡é“ä¸ç›¸å…³çš„è¿›ç¨‹ä¹Ÿèƒ½äº¤æ¢æ•°æ®ã€‚å€¼çš„æ³¨æ„çš„æ˜¯ï¼Œæœ‰åç®¡é“ä¸¥æ ¼éµå¾ª<strong>å…ˆè¿›å…ˆå‡º(first in first out)</strong>,å¯¹åŒ¿åç®¡é“åŠæœ‰åç®¡é“çš„è¯»æ€»æ˜¯ä»å¼€å§‹å¤„è¿”å›æ•°æ®ï¼Œå¯¹å®ƒä»¬çš„å†™åˆ™æŠŠæ•°æ®æ·»åŠ åˆ°æœ«å°¾ã€‚å®ƒä»¬ä¸æ”¯æŒè¯¸å¦‚lseek()ç­‰æ–‡ä»¶å®šä½æ“ä½œã€‚<strong>æœ‰åç®¡é“çš„åå­—å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå†…å®¹å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚</strong></p><blockquote><p><strong>åŒ¿åç®¡é“å’Œæœ‰åç®¡é“æ€»ç»“ï¼š</strong><br> ï¼ˆ1ï¼‰ç®¡é“æ˜¯ç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œåœ¨æ»¡è¶³å…ˆå…¥å…ˆå‡ºçš„åŸåˆ™æ¡ä»¶ä¸‹å¯ä»¥è¿›è¡Œè¯»å†™ï¼Œä½†ä¸èƒ½è¿›è¡Œå®šä½è¯»å†™ã€‚<br> ï¼ˆ2ï¼‰åŒ¿åç®¡é“æ˜¯å•å‘çš„ï¼Œåªèƒ½åœ¨æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ï¼›æœ‰åç®¡é“ä»¥ç£ç›˜æ–‡ä»¶çš„æ–¹å¼å­˜åœ¨ï¼Œå¯ä»¥å®ç°æœ¬æœºä»»æ„ä¸¤ä¸ªè¿›ç¨‹é€šä¿¡ã€‚<br> ï¼ˆ3ï¼‰<strong>æ— åç®¡é“é˜»å¡é—®é¢˜ï¼š</strong>æ— åç®¡é“æ— éœ€æ˜¾ç¤ºæ‰“å¼€ï¼Œåˆ›å»ºæ—¶ç›´æ¥è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œåœ¨è¯»å†™æ—¶éœ€è¦ç¡®å®šå¯¹æ–¹çš„å­˜åœ¨ï¼Œå¦åˆ™å°†é€€å‡ºã€‚å¦‚æœå½“å‰è¿›ç¨‹å‘æ— åç®¡é“çš„ä¸€ç«¯å†™æ•°æ®ï¼Œå¿…é¡»ç¡®å®šå¦ä¸€ç«¯æœ‰æŸä¸€è¿›ç¨‹ã€‚å¦‚æœå†™å…¥æ— åç®¡é“çš„æ•°æ®è¶…è¿‡å…¶æœ€å¤§å€¼ï¼Œå†™æ“ä½œå°†é˜»å¡ï¼Œå¦‚æœç®¡é“ä¸­æ²¡æœ‰æ•°æ®ï¼Œè¯»æ“ä½œå°†é˜»å¡ï¼Œå¦‚æœç®¡é“å‘ç°å¦ä¸€ç«¯æ–­å¼€ï¼Œå°†è‡ªåŠ¨é€€å‡ºã€‚<br> ï¼ˆ4ï¼‰<strong>æœ‰åç®¡é“é˜»å¡é—®é¢˜ï¼š</strong>æœ‰åç®¡é“åœ¨æ‰“å¼€æ—¶éœ€è¦ç¡®å®å¯¹æ–¹çš„å­˜åœ¨ï¼Œå¦åˆ™å°†é˜»å¡ã€‚å³ä»¥è¯»æ–¹å¼æ‰“å¼€æŸç®¡é“ï¼Œåœ¨æ­¤ä¹‹å‰å¿…é¡»ä¸€ä¸ªè¿›ç¨‹ä»¥å†™æ–¹å¼æ‰“å¼€ç®¡é“ï¼Œå¦åˆ™é˜»å¡ã€‚æ­¤å¤–ï¼Œå¯ä»¥ä»¥è¯»å†™ï¼ˆO_RDWRï¼‰æ¨¡å¼æ‰“å¼€æœ‰åç®¡é“ï¼Œå³å½“å‰è¿›ç¨‹è¯»ï¼Œå½“å‰è¿›ç¨‹å†™ï¼Œä¸ä¼šé˜»å¡ã€‚</p></blockquote><p><a href="https://link.jianshu.com/?t=http://blog.chinaunix.net/uid-26833883-id-3227144.html">å»¶ä¼¸é˜…è¯»ï¼šè¯¥åšå®¢æœ‰åŒ¿åç®¡é“å’Œæœ‰åç®¡é“çš„Cè¯­è¨€å®è·µ</a></p><p><strong>3. ä¿¡å·(Signal)</strong></p><ul><li>ä¿¡å·æ˜¯Linuxç³»ç»Ÿä¸­ç”¨äºè¿›ç¨‹é—´äº’ç›¸é€šä¿¡æˆ–è€…æ“ä½œçš„ä¸€ç§æœºåˆ¶ï¼Œä¿¡å·å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å‘ç»™æŸä¸€è¿›ç¨‹ï¼Œè€Œæ— éœ€çŸ¥é“è¯¥è¿›ç¨‹çš„çŠ¶æ€ã€‚</li><li>å¦‚æœè¯¥è¿›ç¨‹å½“å‰å¹¶æœªå¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œåˆ™è¯¥ä¿¡å·å°±æœ‰å†…æ ¸ä¿å­˜èµ·æ¥ï¼ŒçŸ¥é“è¯¥è¿›ç¨‹å›å¤æ‰§è¡Œå¹¶ä¼ é€’ç»™å®ƒä¸ºæ­¢ã€‚</li><li>å¦‚æœä¸€ä¸ªä¿¡å·è¢«è¿›ç¨‹è®¾ç½®ä¸ºé˜»å¡ï¼Œåˆ™è¯¥ä¿¡å·çš„ä¼ é€’è¢«å»¶è¿Ÿï¼Œç›´åˆ°å…¶é˜»å¡è¢«å–æ¶ˆæ˜¯æ‰è¢«ä¼ é€’ç»™è¿›ç¨‹ã€‚</li></ul><blockquote><p><strong>Linuxç³»ç»Ÿä¸­å¸¸ç”¨ä¿¡å·ï¼š</strong><br> ï¼ˆ1ï¼‰<strong>SIGHUPï¼š</strong>ç”¨æˆ·ä»ç»ˆç«¯æ³¨é”€ï¼Œæ‰€æœ‰å·²å¯åŠ¨è¿›ç¨‹éƒ½å°†æ”¶åˆ°è¯¥è¿›ç¨‹ã€‚ç³»ç»Ÿç¼ºçœçŠ¶æ€ä¸‹å¯¹è¯¥ä¿¡å·çš„å¤„ç†æ˜¯ç»ˆæ­¢è¿›ç¨‹ã€‚<br> ï¼ˆ2ï¼‰<strong>SIGINTï¼š</strong>ç¨‹åºç»ˆæ­¢ä¿¡å·ã€‚ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŒ‰<code>Ctrl+C</code>é”®å°†äº§ç”Ÿè¯¥ä¿¡å·ã€‚<br> ï¼ˆ3ï¼‰<strong>SIGQUITï¼š</strong>ç¨‹åºé€€å‡ºä¿¡å·ã€‚ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŒ‰<code>Ctrl+\\</code>é”®å°†äº§ç”Ÿè¯¥ä¿¡å·ã€‚<br> ï¼ˆ4ï¼‰<strong>SIGBUSå’ŒSIGSEGVï¼š</strong>è¿›ç¨‹è®¿é—®éæ³•åœ°å€ã€‚<br> ï¼ˆ5ï¼‰<strong>SIGFPEï¼š</strong>è¿ç®—ä¸­å‡ºç°è‡´å‘½é”™è¯¯ï¼Œå¦‚é™¤é›¶æ“ä½œã€æ•°æ®æº¢å‡ºç­‰ã€‚<br> ï¼ˆ6ï¼‰<strong>SIGKILLï¼š</strong>ç”¨æˆ·ç»ˆæ­¢è¿›ç¨‹æ‰§è¡Œä¿¡å·ã€‚shellä¸‹æ‰§è¡Œ<code>kill -9</code>å‘é€è¯¥ä¿¡å·ã€‚<br> ï¼ˆ7ï¼‰<strong>SIGTERMï¼š</strong>ç»“æŸè¿›ç¨‹ä¿¡å·ã€‚shellä¸‹æ‰§è¡Œ<code>kill è¿›ç¨‹pid</code>å‘é€è¯¥ä¿¡å·ã€‚<br> ï¼ˆ8ï¼‰<strong>SIGALRMï¼š</strong>å®šæ—¶å™¨ä¿¡å·ã€‚<br> ï¼ˆ9ï¼‰<strong>SIGCLDï¼š</strong>å­è¿›ç¨‹é€€å‡ºä¿¡å·ã€‚å¦‚æœå…¶çˆ¶è¿›ç¨‹æ²¡æœ‰å¿½ç•¥è¯¥ä¿¡å·ä¹Ÿæ²¡æœ‰å¤„ç†è¯¥ä¿¡å·ï¼Œåˆ™å­è¿›ç¨‹é€€å‡ºåå°†å½¢æˆåƒµå°¸è¿›ç¨‹ã€‚</p></blockquote><p><strong>ä¿¡å·æ¥æº</strong><br> ä¿¡å·æ˜¯è½¯ä»¶å±‚æ¬¡ä¸Šå¯¹ä¸­æ–­æœºåˆ¶çš„ä¸€ç§æ¨¡æ‹Ÿï¼Œæ˜¯ä¸€ç§å¼‚æ­¥é€šä¿¡æ–¹å¼ï¼Œï¼Œä¿¡å·å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´è¿›ç¨‹å’Œå†…æ ¸ä¹‹é—´ç›´æ¥äº¤äº’ï¼Œå†…æ ¸å¯ä»¥åˆ©ç”¨ä¿¡å·æ¥é€šçŸ¥ç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹å‘ç”Ÿäº†å“ªäº›ç³»ç»Ÿäº‹ä»¶ï¼Œä¿¡å·äº‹ä»¶ä¸»è¦æœ‰ä¸¤ä¸ªæ¥æºï¼š</p><ul><li>ç¡¬ä»¶æ¥æºï¼šç”¨æˆ·æŒ‰é”®è¾“å…¥<code>Ctrl+C</code>é€€å‡ºã€ç¡¬ä»¶å¼‚å¸¸å¦‚æ— æ•ˆçš„å­˜å‚¨è®¿é—®ç­‰ã€‚</li><li>è½¯ä»¶ç»ˆæ­¢ï¼šç»ˆæ­¢è¿›ç¨‹ä¿¡å·ã€å…¶ä»–è¿›ç¨‹è°ƒç”¨killå‡½æ•°ã€è½¯ä»¶å¼‚å¸¸äº§ç”Ÿä¿¡å·ã€‚</li></ul><p><strong>ä¿¡å·ç”Ÿå‘½å‘¨æœŸå’Œå¤„ç†æµç¨‹</strong><br> ï¼ˆ1ï¼‰ä¿¡å·è¢«æŸä¸ªè¿›ç¨‹äº§ç”Ÿï¼Œå¹¶è®¾ç½®æ­¤ä¿¡å·ä¼ é€’çš„å¯¹è±¡ï¼ˆä¸€èˆ¬ä¸ºå¯¹åº”è¿›ç¨‹çš„pidï¼‰ï¼Œç„¶åä¼ é€’ç»™æ“ä½œç³»ç»Ÿï¼›<br> ï¼ˆ2ï¼‰æ“ä½œç³»ç»Ÿæ ¹æ®æ¥æ”¶è¿›ç¨‹çš„è®¾ç½®ï¼ˆæ˜¯å¦é˜»å¡ï¼‰è€Œé€‰æ‹©æ€§çš„å‘é€ç»™æ¥æ”¶è€…ï¼Œå¦‚æœæ¥æ”¶è€…é˜»å¡è¯¥ä¿¡å·ï¼ˆä¸”è¯¥ä¿¡å·æ˜¯å¯ä»¥é˜»å¡çš„ï¼‰ï¼Œæ“ä½œç³»ç»Ÿå°†æš‚æ—¶ä¿ç•™è¯¥ä¿¡å·ï¼Œè€Œä¸ä¼ é€’ï¼Œç›´åˆ°è¯¥è¿›ç¨‹è§£é™¤äº†å¯¹æ­¤ä¿¡å·çš„é˜»å¡ï¼ˆå¦‚æœå¯¹åº”è¿›ç¨‹å·²ç»é€€å‡ºï¼Œåˆ™ä¸¢å¼ƒæ­¤ä¿¡å·ï¼‰ï¼Œå¦‚æœå¯¹åº”è¿›ç¨‹æ²¡æœ‰é˜»å¡ï¼Œæ“ä½œç³»ç»Ÿå°†ä¼ é€’æ­¤ä¿¡å·ã€‚<br> ï¼ˆ3ï¼‰ç›®çš„è¿›ç¨‹æ¥æ”¶åˆ°æ­¤ä¿¡å·åï¼Œå°†æ ¹æ®å½“å‰è¿›ç¨‹å¯¹æ­¤ä¿¡å·è®¾ç½®çš„é¢„å¤„ç†æ–¹å¼ï¼Œæš‚æ—¶ç»ˆæ­¢å½“å‰ä»£ç çš„æ‰§è¡Œï¼Œä¿æŠ¤ä¸Šä¸‹æ–‡ï¼ˆä¸»è¦åŒ…æ‹¬ä¸´æ—¶å¯„å­˜å™¨æ•°æ®ï¼Œå½“å‰ç¨‹åºä½ç½®ä»¥åŠå½“å‰CPUçš„çŠ¶æ€ï¼‰ã€è½¬è€Œæ‰§è¡Œä¸­æ–­æœåŠ¡ç¨‹åºï¼Œæ‰§è¡Œå®Œæˆååœ¨å›å¤åˆ°ä¸­æ–­çš„ä½ç½®ã€‚å½“ç„¶ï¼Œå¯¹äºæŠ¢å å¼å†…æ ¸ï¼Œåœ¨ä¸­æ–­è¿”å›æ—¶è¿˜å°†å¼•å‘æ–°çš„è°ƒåº¦ã€‚</p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/%E4%BF%A1%E5%8F%B7%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F.PNG"></p><p>ä¿¡å·çš„ç”Ÿå‘½å‘¨æœŸ</p><p><strong>4. æ¶ˆæ¯(Message)é˜Ÿåˆ—</strong></p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å­˜æ”¾åœ¨å†…æ ¸ä¸­çš„æ¶ˆæ¯é“¾è¡¨ï¼Œæ¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦è¡¨ç¤ºã€‚</li><li>ä¸ç®¡é“ï¼ˆæ— åç®¡é“ï¼šåªå­˜åœ¨äºå†…å­˜ä¸­çš„æ–‡ä»¶ï¼›å‘½åç®¡é“ï¼šå­˜åœ¨äºå®é™…çš„ç£ç›˜ä»‹è´¨æˆ–è€…æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸åŒçš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—å­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œåªæœ‰åœ¨å†…æ ¸é‡å¯(å³ï¼Œæ“ä½œç³»ç»Ÿé‡å¯)æˆ–è€…æ˜¾ç¤ºåœ°åˆ é™¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œè¯¥æ¶ˆæ¯é˜Ÿåˆ—æ‰ä¼šè¢«çœŸæ­£çš„åˆ é™¤ã€‚</li><li>å¦å¤–ä¸ç®¡é“ä¸åŒçš„æ˜¯ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åœ¨æŸä¸ªè¿›ç¨‹å¾€ä¸€ä¸ªé˜Ÿåˆ—å†™å…¥æ¶ˆæ¯ä¹‹å‰ï¼Œå¹¶ä¸éœ€è¦å¦å¤–æŸä¸ªè¿›ç¨‹åœ¨è¯¥é˜Ÿåˆ—ä¸Šç­‰å¾…æ¶ˆæ¯çš„åˆ°è¾¾ã€‚<a href="https://link.jianshu.com/?t=http://blog.csdn.net/yang_yulei/article/details/19772649">å»¶ä¼¸é˜…è¯»ï¼šæ¶ˆæ¯é˜Ÿåˆ—Cè¯­è¨€çš„å®è·µ</a></li></ul><blockquote><p><strong>æ¶ˆæ¯é˜Ÿåˆ—ç‰¹ç‚¹æ€»ç»“ï¼š</strong><br> ï¼ˆ1ï¼‰æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„é“¾è¡¨,å…·æœ‰ç‰¹å®šçš„æ ¼å¼,å­˜æ”¾åœ¨å†…å­˜ä¸­å¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†.<br> ï¼ˆ2ï¼‰æ¶ˆæ¯é˜Ÿåˆ—å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å‘å®ƒå†™å…¥ä¸è¯»å–æ¶ˆæ¯.<br> ï¼ˆ3ï¼‰ç®¡é“å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„é€šä¿¡æ•°æ®éƒ½æ˜¯å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ã€‚<br> ï¼ˆ4ï¼‰æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°æ¶ˆæ¯çš„éšæœºæŸ¥è¯¢,æ¶ˆæ¯ä¸ä¸€å®šè¦ä»¥å…ˆè¿›å…ˆå‡ºçš„æ¬¡åºè¯»å–,ä¹Ÿå¯ä»¥æŒ‰æ¶ˆæ¯çš„ç±»å‹è¯»å–.æ¯”FIFOæ›´æœ‰ä¼˜åŠ¿ã€‚<br> ï¼ˆ5ï¼‰æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·æ‰¿è½½ä¿¡æ¯é‡å°‘ï¼Œç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­— èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºã€‚<br> ï¼ˆ6ï¼‰ç›®å‰ä¸»è¦æœ‰ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼šPOSIXæ¶ˆæ¯é˜Ÿåˆ—ä»¥åŠSystem Væ¶ˆæ¯é˜Ÿåˆ—ï¼Œç³»ç»ŸVæ¶ˆæ¯é˜Ÿåˆ—ç›®å‰è¢«å¤§é‡ä½¿ç”¨ã€‚ç³»ç»ŸVæ¶ˆæ¯é˜Ÿåˆ—æ˜¯éšå†…æ ¸æŒç»­çš„ï¼Œåªæœ‰åœ¨å†…æ ¸é‡èµ·æˆ–è€…äººå·¥åˆ é™¤æ—¶ï¼Œè¯¥æ¶ˆæ¯é˜Ÿåˆ—æ‰ä¼šè¢«åˆ é™¤ã€‚</p></blockquote><p><strong>5. å…±äº«å†…å­˜(share memory)</strong></p><ul><li><p>ä½¿å¾—å¤šä¸ªè¿›ç¨‹å¯ä»¥å¯ä»¥ç›´æ¥è¯»å†™åŒä¸€å—å†…å­˜ç©ºé—´ï¼Œæ˜¯æœ€å¿«çš„å¯ç”¨IPCå½¢å¼ã€‚æ˜¯é’ˆå¯¹å…¶ä»–é€šä¿¡æœºåˆ¶è¿è¡Œæ•ˆç‡è¾ƒä½è€Œè®¾è®¡çš„ã€‚</p></li><li><p>ä¸ºäº†åœ¨å¤šä¸ªè¿›ç¨‹é—´äº¤æ¢ä¿¡æ¯ï¼Œå†…æ ¸ä¸“é—¨ç•™å‡ºäº†ä¸€å—å†…å­˜åŒºï¼Œå¯ä»¥ç”±éœ€è¦è®¿é—®çš„è¿›ç¨‹å°†å…¶æ˜ å°„åˆ°è‡ªå·±çš„ç§æœ‰åœ°å€ç©ºé—´ã€‚è¿›ç¨‹å°±å¯ä»¥ç›´æ¥è¯»å†™è¿™ä¸€å—å†…å­˜è€Œä¸éœ€è¦è¿›è¡Œæ•°æ®çš„æ‹·è´ï¼Œä»è€Œå¤§å¤§æé«˜æ•ˆç‡ã€‚</p></li><li><p>ç”±äºå¤šä¸ªè¿›ç¨‹å…±äº«ä¸€æ®µå†…å­˜ï¼Œå› æ­¤éœ€è¦ä¾é æŸç§åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ä¿¡å·é‡ï¼‰æ¥è¾¾åˆ°è¿›ç¨‹é—´çš„åŒæ­¥åŠäº’æ–¥ã€‚</p><p>å»¶ä¼¸é˜…è¯»ï¼šLinuxæ”¯æŒçš„ä¸»è¦ä¸‰ç§å…±äº«å†…å­˜æ–¹å¼ï¼šmmap()ç³»ç»Ÿè°ƒç”¨ã€Posixå…±äº«å†…å­˜ï¼Œä»¥åŠSystem Vå…±äº«å†…å­˜å®è·µ</p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E5%8E%9F%E7%90%86.PNG"></p><p>å…±äº«å†…å­˜åŸç†å›¾</p></li></ul><p><strong>6. ä¿¡å·é‡(semaphore)</strong><br> ä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºå¤šè¿›ç¨‹å¯¹å…±äº«æ•°æ®çš„è®¿é—®ï¼Œä¿¡å·é‡çš„æ„å›¾åœ¨äºè¿›ç¨‹é—´åŒæ­¥ã€‚<br> ä¸ºäº†è·å¾—å…±äº«èµ„æºï¼Œè¿›ç¨‹éœ€è¦æ‰§è¡Œä¸‹åˆ—æ“ä½œï¼š<br> ï¼ˆ1ï¼‰<strong>åˆ›å»ºä¸€ä¸ªä¿¡å·é‡</strong>ï¼šè¿™è¦æ±‚è°ƒç”¨è€…æŒ‡å®šåˆå§‹å€¼ï¼Œå¯¹äºäºŒå€¼ä¿¡å·é‡æ¥è¯´ï¼Œå®ƒé€šå¸¸æ˜¯1ï¼Œä¹Ÿå¯æ˜¯0ã€‚<br> ï¼ˆ2ï¼‰<strong>ç­‰å¾…ä¸€ä¸ªä¿¡å·é‡</strong>ï¼šè¯¥æ“ä½œä¼šæµ‹è¯•è¿™ä¸ªä¿¡å·é‡çš„å€¼ï¼Œå¦‚æœå°äº0ï¼Œå°±é˜»å¡ã€‚ä¹Ÿç§°ä¸ºPæ“ä½œã€‚<br> ï¼ˆ3ï¼‰<strong>æŒ‚å‡ºä¸€ä¸ªä¿¡å·é‡</strong>ï¼šè¯¥æ“ä½œå°†ä¿¡å·é‡çš„å€¼åŠ 1ï¼Œä¹Ÿç§°ä¸ºVæ“ä½œã€‚</p><p>ä¸ºäº†æ­£ç¡®åœ°å®ç°ä¿¡å·é‡ï¼Œä¿¡å·é‡å€¼çš„æµ‹è¯•åŠå‡1æ“ä½œåº”å½“æ˜¯åŸå­æ“ä½œã€‚ä¸ºæ­¤ï¼Œä¿¡å·é‡é€šå¸¸æ˜¯åœ¨å†…æ ¸ä¸­å®ç°çš„ã€‚Linuxç¯å¢ƒä¸­ï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼š<strong>Posixï¼ˆ<a href="https://link.jianshu.com/?t=http://baike.baidu.com/link?url=hYEo6ngm9MlqsQHT3h28baIDxEooeSPX6wr_FdGF-F8mf7wDp2xJWIDtQWGEDxthtPNiJtlsw460g1_N0txJYa">å¯ç§»æ¤æ€§æ“ä½œç³»ç»Ÿæ¥å£</a>ï¼‰æœ‰åä¿¡å·é‡ï¼ˆä½¿ç”¨Posix IPCåå­—æ ‡è¯†ï¼‰</strong>ã€<strong>PosixåŸºäºå†…å­˜çš„ä¿¡å·é‡ï¼ˆå­˜æ”¾åœ¨å…±äº«å†…å­˜åŒºä¸­ï¼‰</strong>ã€<strong>System Vä¿¡å·é‡ï¼ˆåœ¨å†…æ ¸ä¸­ç»´æŠ¤ï¼‰</strong>ã€‚è¿™ä¸‰ç§ä¿¡å·é‡éƒ½å¯ç”¨äºè¿›ç¨‹é—´æˆ–çº¿ç¨‹é—´çš„åŒæ­¥ã€‚</p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/%E8%BF%9B%E7%A8%8B%E4%BD%BF%E7%94%A8%E4%BA%8C%E5%80%BC%E4%BF%A1%E5%8F%B7%E9%87%8F.PNG"></p><p>ä¸¤ä¸ªè¿›ç¨‹ä½¿ç”¨ä¸€ä¸ªäºŒå€¼ä¿¡å·é‡</p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/%E8%BF%9B%E7%A8%8B%E4%BD%BF%E7%94%A8Posix%E6%9C%89%E5%90%8D%E4%BA%8C%E5%80%BC%E4%BF%A1%E5%8F%B7%E9%87%8F.PNG"></p><p>ä¸¤ä¸ªè¿›ç¨‹æ‰€ä»¥ç”¨ä¸€ä¸ªPosixæœ‰åäºŒå€¼ä¿¡å·é‡</p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E7%9A%84%E4%BF%A1%E5%8F%B7%E9%87%8F.PNG"></p><p>ä¸€ä¸ªè¿›ç¨‹ä¸¤ä¸ªçº¿ç¨‹å…±äº«åŸºäºå†…å­˜çš„ä¿¡å·é‡</p><blockquote><p><strong>ä¿¡å·é‡ä¸æ™®é€šæ•´å‹å˜é‡çš„åŒºåˆ«ï¼š</strong><br> ï¼ˆ1ï¼‰ä¿¡å·é‡æ˜¯éè´Ÿæ•´å‹å˜é‡ï¼Œé™¤äº†åˆå§‹åŒ–ä¹‹å¤–ï¼Œå®ƒåªèƒ½é€šè¿‡ä¸¤ä¸ªæ ‡å‡†åŸå­æ“ä½œï¼šwait(semap) , signal(semap) ; æ¥è¿›è¡Œè®¿é—®ï¼›<br> ï¼ˆ2ï¼‰æ“ä½œä¹Ÿè¢«æˆä¸ºPVåŸè¯­ï¼ˆPæ¥æºäºè·å…°è¯­proberenâ€æµ‹è¯•â€ï¼ŒVæ¥æºäºè·å…°è¯­verhogenâ€å¢åŠ â€ï¼ŒPè¡¨ç¤ºé€šè¿‡çš„æ„æ€ï¼ŒVè¡¨ç¤ºé‡Šæ”¾çš„æ„æ€ï¼‰ï¼Œè€Œæ™®é€šæ•´å‹å˜é‡åˆ™å¯ä»¥åœ¨ä»»ä½•è¯­å¥å—ä¸­è¢«è®¿é—®ï¼›</p></blockquote><blockquote><p><strong>ä¿¡å·é‡ä¸äº’æ–¥é‡ä¹‹é—´çš„åŒºåˆ«ï¼š</strong><br> ï¼ˆ1ï¼‰äº’æ–¥é‡ç”¨äºçº¿ç¨‹çš„äº’æ–¥ï¼Œä¿¡å·é‡ç”¨äºçº¿ç¨‹çš„åŒæ­¥ã€‚è¿™æ˜¯äº’æ–¥é‡å’Œä¿¡å·é‡çš„æ ¹æœ¬åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯äº’æ–¥å’ŒåŒæ­¥ä¹‹é—´çš„åŒºåˆ«ã€‚<br> <strong>äº’æ–¥ï¼š</strong>æ˜¯æŒ‡æŸä¸€èµ„æºåŒæ—¶åªå…è®¸ä¸€ä¸ªè®¿é—®è€…å¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œå…·æœ‰å”¯ä¸€æ€§å’Œæ’å®ƒæ€§ã€‚ä½†äº’æ–¥æ— æ³•é™åˆ¶è®¿é—®è€…å¯¹èµ„æºçš„è®¿é—®é¡ºåºï¼Œå³è®¿é—®æ˜¯æ— åºçš„ã€‚<br> <strong>åŒæ­¥ï¼š</strong>æ˜¯æŒ‡åœ¨äº’æ–¥çš„åŸºç¡€ä¸Šï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰ï¼Œé€šè¿‡å…¶å®ƒæœºåˆ¶å®ç°è®¿é—®è€…å¯¹èµ„æºçš„æœ‰åºè®¿é—®ã€‚<br> åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒåŒæ­¥å·²ç»å®ç°äº†äº’æ–¥ï¼Œç‰¹åˆ«æ˜¯æ‰€æœ‰å†™å…¥èµ„æºçš„æƒ…å†µå¿…å®šæ˜¯äº’æ–¥çš„ã€‚å°‘æ•°æƒ…å†µæ˜¯æŒ‡å¯ä»¥å…è®¸å¤šä¸ªè®¿é—®è€…åŒæ—¶è®¿é—®èµ„æº<br> ï¼ˆ2ï¼‰äº’æ–¥é‡å€¼åªèƒ½ä¸º0/1ï¼Œä¿¡å·é‡å€¼å¯ä»¥ä¸ºéè´Ÿæ•´æ•°ã€‚<br> ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªäº’æ–¥é‡åªèƒ½ç”¨äºä¸€ä¸ªèµ„æºçš„äº’æ–¥è®¿é—®ï¼Œå®ƒä¸èƒ½å®ç°å¤šä¸ªèµ„æºçš„å¤šçº¿ç¨‹äº’æ–¥é—®é¢˜ã€‚ä¿¡å·é‡å¯ä»¥å®ç°å¤šä¸ªåŒç±»èµ„æºçš„å¤šçº¿ç¨‹äº’æ–¥å’ŒåŒæ­¥ã€‚å½“ä¿¡å·é‡ä¸ºå•å€¼ä¿¡å·é‡æ˜¯ï¼Œä¹Ÿå¯ä»¥å®Œæˆä¸€ä¸ªèµ„æºçš„äº’æ–¥è®¿é—®ã€‚<br> ï¼ˆ3ï¼‰äº’æ–¥é‡çš„åŠ é”å’Œè§£é”å¿…é¡»ç”±åŒä¸€çº¿ç¨‹åˆ†åˆ«å¯¹åº”ä½¿ç”¨ï¼Œä¿¡å·é‡å¯ä»¥ç”±ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°ã€‚</p></blockquote><p><strong>7. å¥—æ¥å­—(socket)</strong><br> å¥—æ¥å­—æ˜¯ä¸€ç§é€šä¿¡æœºåˆ¶ï¼Œå‡­å€Ÿè¿™ç§æœºåˆ¶ï¼Œå®¢æˆ·/æœåŠ¡å™¨ï¼ˆå³è¦è¿›è¡Œé€šä¿¡çš„è¿›ç¨‹ï¼‰ç³»ç»Ÿçš„å¼€å‘å·¥ä½œæ—¢å¯ä»¥åœ¨æœ¬åœ°å•æœºä¸Šè¿›è¡Œï¼Œä¹Ÿå¯ä»¥è·¨ç½‘ç»œè¿›è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥è®©ä¸åœ¨åŒä¸€å°è®¡ç®—æœºä½†é€šè¿‡ç½‘ç»œè¿æ¥è®¡ç®—æœºä¸Šçš„è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚</p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/Socket.PNG"></p><p>Socketæ˜¯åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´çš„æ¡¥æ¢</p><p>å¥—æ¥å­—æ˜¯æ”¯æŒTCP/IPçš„ç½‘ç»œé€šä¿¡çš„åŸºæœ¬æ“ä½œå•å…ƒï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸åŒä¸»æœºä¹‹é—´çš„è¿›ç¨‹è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹ï¼Œç®€å•çš„è¯´å°±æ˜¯é€šä¿¡çš„ä¸¤æ–¹çš„ä¸€ç§çº¦å®šï¼Œç”¨å¥—æ¥å­—ä¸­çš„ç›¸å…³å‡½æ•°æ¥å®Œæˆé€šä¿¡è¿‡ç¨‹ã€‚</p><p><strong>å¥—æ¥å­—ç‰¹æ€§</strong><br> å¥—æ¥å­—çš„ç‰¹æ€§ç”±3ä¸ªå±æ€§ç¡®å®šï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šåŸŸã€ç«¯å£å·ã€åè®®ç±»å‹ã€‚<br> <strong>ï¼ˆ1ï¼‰å¥—æ¥å­—çš„åŸŸ</strong><br> å®ƒæŒ‡å®šå¥—æ¥å­—é€šä¿¡ä¸­ä½¿ç”¨çš„ç½‘ç»œä»‹è´¨ï¼Œæœ€å¸¸è§çš„å¥—æ¥å­—åŸŸæœ‰ä¸¤ç§ï¼š<br> <strong>ä¸€æ˜¯AF_INETï¼Œå®ƒæŒ‡çš„æ˜¯Internetç½‘ç»œã€‚</strong>å½“å®¢æˆ·ä½¿ç”¨å¥—æ¥å­—è¿›è¡Œè·¨ç½‘ç»œçš„è¿æ¥æ—¶ï¼Œå®ƒå°±éœ€è¦ç”¨åˆ°æœåŠ¡å™¨è®¡ç®—æœºçš„IPåœ°å€å’Œç«¯å£æ¥æŒ‡å®šä¸€å°è”ç½‘æœºå™¨ä¸Šçš„æŸä¸ªç‰¹å®šæœåŠ¡ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨socketä½œä¸ºé€šä¿¡çš„ç»ˆç‚¹ï¼ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºå¿…é¡»åœ¨å¼€å§‹é€šä¿¡ä¹‹å‰ç»‘å®šä¸€ä¸ªç«¯å£ï¼ŒæœåŠ¡å™¨åœ¨æŒ‡å®šçš„ç«¯å£ç­‰å¾…å®¢æˆ·çš„è¿æ¥ã€‚<br> <strong>å¦ä¸€ä¸ªåŸŸAF_UNIXï¼Œè¡¨ç¤ºUNIXæ–‡ä»¶ç³»ç»Ÿï¼Œ</strong>å®ƒå°±æ˜¯æ–‡ä»¶è¾“å…¥/è¾“å‡ºï¼Œè€Œå®ƒçš„åœ°å€å°±æ˜¯æ–‡ä»¶åã€‚<br> <strong>ï¼ˆ2ï¼‰å¥—æ¥å­—çš„ç«¯å£å·</strong><br> æ¯ä¸€ä¸ªåŸºäºTCP/IPç½‘ç»œé€šè®¯çš„ç¨‹åº(è¿›ç¨‹)éƒ½è¢«èµ‹äºˆäº†å”¯ä¸€çš„ç«¯å£å’Œç«¯å£å·ï¼Œç«¯å£æ˜¯ä¸€ä¸ªä¿¡æ¯ç¼“å†²åŒºï¼Œç”¨äºä¿ç•™Socketä¸­çš„è¾“å…¥/è¾“å‡ºä¿¡æ¯ï¼Œç«¯å£å·æ˜¯ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´æ•°ï¼ŒèŒƒå›´æ˜¯0-65535ï¼Œä»¥åŒºåˆ«ä¸»æœºä¸Šçš„æ¯ä¸€ä¸ªç¨‹åºï¼ˆç«¯å£å·å°±åƒæˆ¿å±‹ä¸­çš„æˆ¿é—´å·ï¼‰ï¼Œä½äº256çš„ç«¯å£å·ä¿ç•™ç»™æ ‡å‡†åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚pop3çš„ç«¯å£å·å°±æ˜¯110ï¼Œæ¯ä¸€ä¸ªå¥—æ¥å­—éƒ½ç»„åˆè¿›äº†IPåœ°å€ã€ç«¯å£ï¼Œè¿™æ ·å½¢æˆçš„æ•´ä½“å°±å¯ä»¥åŒºåˆ«æ¯ä¸€ä¸ªå¥—æ¥å­—ã€‚<br> <strong>ï¼ˆ3ï¼‰å¥—æ¥å­—åè®®ç±»å‹</strong><br> å› ç‰¹ç½‘æä¾›ä¸‰ç§é€šä¿¡æœºåˆ¶ï¼Œ<br> <strong>ä¸€æ˜¯æµå¥—æ¥å­—ï¼Œ</strong>æµå¥—æ¥å­—åœ¨åŸŸä¸­é€šè¿‡TCP/IPè¿æ¥å®ç°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯AF_UNIXä¸­å¸¸ç”¨çš„å¥—æ¥å­—ç±»å‹ã€‚æµå¥—æ¥å­—æä¾›çš„æ˜¯ä¸€ä¸ªæœ‰åºã€å¯é ã€åŒå‘å­—èŠ‚æµçš„è¿æ¥ï¼Œå› æ­¤å‘é€çš„æ•°æ®å¯ä»¥ç¡®ä¿ä¸ä¼šä¸¢å¤±ã€é‡å¤æˆ–ä¹±åºåˆ°è¾¾ï¼Œè€Œä¸”å®ƒè¿˜æœ‰ä¸€å®šçš„å‡ºé”™åé‡æ–°å‘é€çš„æœºåˆ¶ã€‚<br> <strong>äºŒä¸ªæ˜¯æ•°æ®æŠ¥å¥—æ¥å­—ï¼Œ</strong>å®ƒä¸éœ€è¦å»ºç«‹è¿æ¥å’Œç»´æŒä¸€ä¸ªè¿æ¥ï¼Œå®ƒä»¬åœ¨åŸŸä¸­é€šå¸¸æ˜¯é€šè¿‡UDP/IPåè®®å®ç°çš„ã€‚å®ƒå¯¹å¯ä»¥å‘é€çš„æ•°æ®çš„é•¿åº¦æœ‰é™åˆ¶ï¼Œæ•°æ®æŠ¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œæ¶ˆæ¯è¢«ä¼ è¾“,å®ƒå¯èƒ½ä¼šä¸¢å¤±ã€å¤åˆ¶æˆ–é”™ä¹±åˆ°è¾¾ï¼ŒUDPä¸æ˜¯ä¸€ä¸ªå¯é çš„åè®®ï¼Œä½†æ˜¯å®ƒçš„é€Ÿåº¦æ¯”è¾ƒé«˜ï¼Œå› ä¸ºå®ƒå¹¶ä¸€éœ€è¦æ€»æ˜¯è¦å»ºç«‹å’Œç»´æŒä¸€ä¸ªè¿æ¥ã€‚<br> <strong>ä¸‰æ˜¯åŸå§‹å¥—æ¥å­—ï¼Œ</strong>åŸå§‹å¥—æ¥å­—å…è®¸å¯¹è¾ƒä½å±‚æ¬¡çš„åè®®ç›´æ¥è®¿é—®ï¼Œæ¯”å¦‚IPã€ ICMPåè®®ï¼Œå®ƒå¸¸ç”¨äºæ£€éªŒæ–°çš„åè®®å®ç°ï¼Œæˆ–è€…è®¿é—®ç°æœ‰æœåŠ¡ä¸­é…ç½®çš„æ–°è®¾å¤‡ï¼Œå› ä¸ºRAW SOCKETå¯ä»¥è‡ªå¦‚åœ°æ§åˆ¶Windowsä¸‹çš„å¤šç§åè®®ï¼Œèƒ½å¤Ÿå¯¹ç½‘ç»œåº•å±‚çš„ä¼ è¾“æœºåˆ¶è¿›è¡Œæ§åˆ¶ï¼Œæ‰€ä»¥å¯ä»¥åº”ç”¨åŸå§‹å¥—æ¥å­—æ¥æ“çºµç½‘ç»œå±‚å’Œä¼ è¾“å±‚åº”ç”¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡RAW SOCKETæ¥æ¥æ”¶å‘å‘æœ¬æœºçš„ICMPã€IGMPåè®®åŒ…ï¼Œæˆ–è€…æ¥æ”¶TCP/IPæ ˆä¸èƒ½å¤Ÿå¤„ç†çš„IPåŒ…ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å‘é€ä¸€äº›è‡ªå®šåŒ…å¤´æˆ–è‡ªå®šåè®®çš„IPåŒ…ã€‚ç½‘ç»œç›‘å¬æŠ€æœ¯å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºSOCKET_RAWã€‚</p><blockquote><p><strong>åŸå§‹å¥—æ¥å­—ä¸æ ‡å‡†å¥—æ¥å­—çš„åŒºåˆ«åœ¨äºï¼š</strong><br> åŸå§‹å¥—æ¥å­—å¯ä»¥è¯»å†™å†…æ ¸æ²¡æœ‰å¤„ç†çš„IPæ•°æ®åŒ…ï¼Œè€Œæµå¥—æ¥å­—åªèƒ½è¯»å–TCPåè®®çš„æ•°æ®ï¼Œæ•°æ®æŠ¥å¥—æ¥å­—åªèƒ½è¯»å–UDPåè®®çš„æ•°æ®ã€‚å› æ­¤ï¼Œå¦‚æœè¦è®¿é—®å…¶ä»–åè®®å‘é€æ•°æ®å¿…é¡»ä½¿ç”¨åŸå§‹å¥—æ¥å­—ã€‚</p></blockquote><p><strong>å¥—æ¥å­—é€šä¿¡çš„å»ºç«‹</strong></p><p><img src="/2021/04/13/jin-cheng-jian-de-tong-xin-ipc/Socket%E9%80%9A%E4%BF%A1%E6%B5%81%E7%A8%8B.PNG"></p><p>Socketé€šä¿¡åŸºæœ¬æµç¨‹</p><p><strong>æœåŠ¡å™¨ç«¯</strong><br> ï¼ˆ1ï¼‰é¦–å…ˆæœåŠ¡å™¨åº”ç”¨ç¨‹åºç”¨ç³»ç»Ÿè°ƒç”¨socketæ¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå®ƒæ˜¯ç³»ç»Ÿåˆ†é…ç»™è¯¥æœåŠ¡å™¨è¿›ç¨‹çš„ç±»ä¼¼æ–‡ä»¶æè¿°ç¬¦çš„èµ„æºï¼Œå®ƒä¸èƒ½ä¸å…¶ä»–çš„è¿›ç¨‹å…±äº«ã€‚<br> ï¼ˆ2ï¼‰ç„¶åï¼ŒæœåŠ¡å™¨è¿›ç¨‹ä¼šç»™å¥—æ¥å­—èµ·ä¸ªåå­—ï¼Œæˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨bindæ¥ç»™å¥—æ¥å­—å‘½åã€‚ç„¶åæœåŠ¡å™¨è¿›ç¨‹å°±å¼€å§‹ç­‰å¾…å®¢æˆ·è¿æ¥åˆ°è¿™ä¸ªå¥—æ¥å­—ã€‚<br> ï¼ˆ3ï¼‰æ¥ä¸‹æ¥ï¼Œç³»ç»Ÿè°ƒç”¨listenæ¥åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å¹¶å°†å…¶ç”¨äºå­˜æ”¾æ¥è‡ªå®¢æˆ·çš„è¿›å…¥è¿æ¥ã€‚<br> ï¼ˆ4ï¼‰æœ€åï¼ŒæœåŠ¡å™¨é€šè¿‡ç³»ç»Ÿè°ƒç”¨acceptæ¥æ¥å—å®¢æˆ·çš„è¿æ¥ã€‚å®ƒä¼šåˆ›å»ºä¸€ä¸ªä¸åŸæœ‰çš„å‘½åå¥—æ¥ä¸åŒçš„æ–°å¥—æ¥å­—ï¼Œè¿™ä¸ªå¥—æ¥å­—åªç”¨äºä¸è¿™ä¸ªç‰¹å®šå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œè€Œå‘½åå¥—æ¥å­—ï¼ˆå³åŸå…ˆçš„å¥—æ¥å­—ï¼‰åˆ™è¢«ä¿ç•™ä¸‹æ¥ç»§ç»­å¤„ç†æ¥è‡ªå…¶ä»–å®¢æˆ·çš„è¿æ¥ï¼ˆå»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç”¨äºé€šä¿¡çš„æµï¼Œè¿›è¡Œé€šä¿¡ï¼‰ã€‚</p><p><strong>å®¢æˆ·ç«¯</strong><br> ï¼ˆ1ï¼‰å®¢æˆ·åº”ç”¨ç¨‹åºé¦–å…ˆè°ƒç”¨socketæ¥åˆ›å»ºä¸€ä¸ªæœªå‘½åçš„å¥—æ¥å­—ï¼Œç„¶åå°†æœåŠ¡å™¨çš„å‘½åå¥—æ¥å­—ä½œä¸ºä¸€ä¸ªåœ°å€æ¥è°ƒç”¨connectä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚<br> ï¼ˆ2ï¼‰ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒä½¿ç”¨åº•å±‚çš„æ–‡ä»¶æè¿°ç¬¦é‚£æ ·ç”¨å¥—æ¥å­—æ¥å®ç°åŒå‘æ•°æ®çš„é€šä¿¡ï¼ˆé€šè¿‡æµè¿›è¡Œæ•°æ®ä¼ è¾“ï¼‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—ä»£ç å†…å­˜æ¶ˆè€—</title>
      <link href="2021/04/12/ji-suan-dai-ma-nei-cun-xiao-hao/"/>
      <url>2021/04/12/ji-suan-dai-ma-nei-cun-xiao-hao/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸åŒè¯­è¨€çš„å†…å­˜ç®¡ç†"><a href="#ä¸åŒè¯­è¨€çš„å†…å­˜ç®¡ç†" class="headerlink" title="ä¸åŒè¯­è¨€çš„å†…å­˜ç®¡ç†"></a>ä¸åŒè¯­è¨€çš„å†…å­˜ç®¡ç†</h2><p>ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å„è‡ªçš„å†…å­˜ç®¡ç†æ–¹å¼ã€‚</p><ul><li>C/C++è¿™ç§å†…å­˜å †ç©ºé—´çš„ç”³è¯·å’Œé‡Šæ”¾å®Œå…¨é è‡ªå·±ç®¡ç†</li><li>Java ä¾èµ–JVMæ¥åšå†…å­˜ç®¡ç†ï¼Œä¸äº†è§£jvmå†…å­˜ç®¡ç†çš„æœºåˆ¶ï¼Œå¾ˆå¯èƒ½ä¼šå› ä¸€äº›é”™è¯¯çš„ä»£ç å†™æ³•è€Œå¯¼è‡´å†…å­˜æ³„æ¼æˆ–å†…å­˜æº¢å‡º</li><li>Pythonå†…å­˜ç®¡ç†æ˜¯ç”±ç§æœ‰å †ç©ºé—´ç®¡ç†çš„ï¼Œæ‰€æœ‰çš„pythonå¯¹è±¡å’Œæ•°æ®ç»“æ„éƒ½å­˜å‚¨åœ¨ç§æœ‰å †ç©ºé—´ä¸­ã€‚ç¨‹åºå‘˜æ²¡æœ‰è®¿é—®å †çš„æƒé™ï¼Œåªæœ‰è§£é‡Šå™¨æ‰èƒ½æ“ä½œã€‚</li></ul><p>ä¾‹å¦‚Pythonä¸‡ç‰©çš†å¯¹è±¡ï¼Œå¹¶ä¸”å°†å†…å­˜æ“ä½œå°è£…çš„å¾ˆå¥½ï¼Œ<strong>æ‰€ä»¥pythonçš„åŸºæœ¬æ•°æ®ç±»å‹æ‰€ç”¨çš„å†…å­˜ä¼šè¦è¿œå¤§äºå­˜æ”¾çº¯æ•°æ®ç±»å‹æ‰€å çš„å†…å­˜</strong>ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å­˜å‚¨intå‹æ•°æ®éœ€è¦å››ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯ä½¿ç”¨Python ç”³è¯·ä¸€ä¸ªå¯¹è±¡æ¥å­˜æ”¾æ•°æ®çš„è¯ï¼Œæ‰€ç”¨ç©ºé—´è¦è¿œå¤§äºå››ä¸ªå­—èŠ‚ã€‚</p><h2 id="C-çš„å†…å­˜ç®¡ç†"><a href="#C-çš„å†…å­˜ç®¡ç†" class="headerlink" title="C++çš„å†…å­˜ç®¡ç†"></a>C++çš„å†…å­˜ç®¡ç†</h2><p>ä»¥C++ä¸ºä¾‹æ¥ä»‹ç»ä¸€ä¸‹ç¼–ç¨‹è¯­è¨€çš„å†…å­˜ç®¡ç†ã€‚</p><p>å¦‚æœæˆ‘ä»¬å†™C++çš„ç¨‹åºï¼Œå°±è¦çŸ¥é“æ ˆå’Œå †çš„æ¦‚å¿µï¼Œç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„å†…å­˜ç©ºé—´åˆ†ä¸º å›ºå®šéƒ¨åˆ†ï¼Œå’Œå¯å˜éƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2021/04/12/ji-suan-dai-ma-nei-cun-xiao-hao/640" alt="å›¾ç‰‡"></p><p>å›ºå®šéƒ¨åˆ†çš„å†…å­˜æ¶ˆè€— æ˜¯ä¸ä¼šéšç€ä»£ç è¿è¡Œäº§ç”Ÿå˜åŒ–çš„ï¼Œ å¯å˜éƒ¨åˆ†åˆ™æ˜¯ä¼šäº§ç”Ÿå˜åŒ–çš„</p><p>æ›´å…·ä½“ä¸€äº›ï¼Œä¸€ä¸ªç”±C/C++ç¼–è¯‘çš„ç¨‹åºå ç”¨çš„å†…å­˜åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>æ ˆåŒº(Stack) ï¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾ï¼Œå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰ï¼Œå…¶æ“ä½œæ–¹å¼ç±»ä¼¼äºæ•°æ®ç»“æ„ä¸­çš„æ ˆã€‚</li><li>å †åŒº(Heap) ï¼šä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œè‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±OSæ”¶å›</li><li>æœªåˆå§‹åŒ–æ•°æ®åŒº(Uninitialized Data)ï¼šå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡</li><li>åˆå§‹åŒ–æ•°æ®åŒº(Initialized Data)ï¼šå­˜æ”¾å·²ç»åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡</li><li>ç¨‹åºä»£ç åŒº(Text)ï¼šå­˜æ”¾å‡½æ•°ä½“çš„äºŒè¿›åˆ¶ä»£ç </li></ul><p>ä»£ç åŒºå’Œæ•°æ®åŒºæ‰€å ç©ºé—´éƒ½æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”å ç”¨çš„ç©ºé—´éå¸¸å°ï¼Œé‚£ä¹ˆçœ‹è¿è¡Œæ—¶æ¶ˆè€—çš„å†…å­˜ä¸»è¦çœ‹å¯å˜éƒ¨åˆ†ã€‚</p><p>åœ¨å¯å˜éƒ¨åˆ†ä¸­ï¼Œæ ˆåŒºé—´çš„æ•°æ®åœ¨ä»£ç å—æ‰§è¡Œç»“æŸä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ”¶ï¼Œè€Œå †åŒºé—´æ•°æ®æ˜¯éœ€è¦ç¨‹åºå‘˜è‡ªå·±å›æ”¶ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯é€ æˆå†…å­˜æ³„æ¼çš„å‘æºåœ°ã€‚</p><p><strong>è€ŒJavaã€Pythonçš„è¯åˆ™ä¸éœ€è¦ç¨‹åºå‘˜å»è€ƒè™‘å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œè™šæ‹Ÿæœºéƒ½åšäº†è¿™äº›äº‹æƒ…</strong>ã€‚</p><h2 id="å¦‚ä½•è®¡ç®—ç¨‹åºå ç”¨å¤šå¤§å†…å­˜"><a href="#å¦‚ä½•è®¡ç®—ç¨‹åºå ç”¨å¤šå¤§å†…å­˜" class="headerlink" title="å¦‚ä½•è®¡ç®—ç¨‹åºå ç”¨å¤šå¤§å†…å­˜"></a>å¦‚ä½•è®¡ç®—ç¨‹åºå ç”¨å¤šå¤§å†…å­˜</h2><p>æƒ³è¦ç®—å‡ºè‡ªå·±ç¨‹åºä¼šå ç”¨å¤šå°‘å†…å­˜å°±ä¸€å®šè¦äº†è§£è‡ªå·±å®šä¹‰çš„æ•°æ®ç±»å‹çš„å¤§å°ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2021/04/12/ji-suan-dai-ma-nei-cun-xiao-hao/640" alt="å›¾ç‰‡"></p><p>æ³¨æ„å›¾ä¸­æœ‰ä¸¤ä¸ªä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œä¸ºä»€ä¹ˆ64ä½çš„æŒ‡é’ˆå°±å ç”¨äº†8ä¸ªå­—èŠ‚ï¼Œè€Œ32ä½çš„æŒ‡é’ˆå ç”¨4ä¸ªå­—èŠ‚å‘¢ï¼Ÿ</p><p>1ä¸ªå­—èŠ‚å 8ä¸ªæ¯”ç‰¹ï¼Œé‚£ä¹ˆ4ä¸ªå­—èŠ‚å°±æ˜¯32ä¸ªæ¯”ç‰¹ï¼Œå¯å­˜æ”¾æ•°æ®çš„å¤§å°ä¸º2^32ï¼Œä¹Ÿå°±æ˜¯4Gç©ºé—´çš„å¤§å°ï¼Œå³ï¼šå¯ä»¥å¯»æ‰¾4Gç©ºé—´å¤§å°çš„å†…å­˜åœ°å€ã€‚</p><p>å¤§å®¶ç°åœ¨ä½¿ç”¨çš„è®¡ç®—æœºä¸€èˆ¬éƒ½æ˜¯64ä½äº†ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¹Ÿéƒ½æ˜¯64ä½çš„ã€‚</p><p>å®‰è£…64ä½çš„æ“ä½œç³»ç»Ÿçš„è®¡ç®—æœºå†…å­˜éƒ½å·²ç»è¶…è¿‡äº†4Gï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆå¤§å°å¦‚æœè¿˜æ˜¯4ä¸ªå­—èŠ‚çš„è¯ï¼Œå°±å·²ç»ä¸èƒ½å¯»å€å…¨éƒ¨çš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥64ä½ç¼–è¯‘å™¨ä½¿ç”¨8ä¸ªå­—èŠ‚çš„æŒ‡é’ˆæ‰èƒ½å¯»æ‰¾æ‰€æœ‰çš„å†…å­˜åœ°å€ã€‚</p><p>æ³¨æ„2^64æ˜¯ä¸€ä¸ªéå¸¸å·¨å¤§çš„æ•°ï¼Œå¯¹äºå¯»æ‰¾åœ°å€æ¥è¯´å·²ç»è¶³å¤Ÿç”¨äº†ã€‚</p><h2 id="å†…å­˜å¯¹é½"><a href="#å†…å­˜å¯¹é½" class="headerlink" title="å†…å­˜å¯¹é½"></a>å†…å­˜å¯¹é½</h2><p>å†ä»‹ç»ä¸€ä¸‹å†…å­˜ç®¡ç†ä¸­å¦ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹ï¼š<strong>å†…å­˜å¯¹é½</strong>ã€‚</p><p><strong>ä¸è¦ä»¥ä¸ºåªæœ‰C/C++æ‰ä¼šæœ‰å†…å­˜å¯¹é½ï¼Œåªè¦å¯ä»¥è·¨å¹³å°çš„ç¼–ç¨‹è¯­è¨€éƒ½éœ€è¦åšå†…å­˜å¯¹é½ï¼ŒJavaã€Pythonéƒ½æ˜¯ä¸€æ ·çš„</strong>ã€‚</p><p>è€Œä¸”è¿™æ˜¯é¢è¯•ä¸­é¢è¯•å®˜éå¸¸å–œæ¬¢é—®åˆ°çš„é—®é¢˜ï¼Œå°±æ˜¯ï¼š<strong>ä¸ºä»€ä¹ˆä¼šæœ‰å†…å­˜å¯¹é½ï¼Ÿ</strong></p><p>ä¸»è¦æ˜¯ä¸¤ä¸ªåŸå› </p><ol><li>å¹³å°åŸå› ï¼šä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶å¹³å°éƒ½èƒ½è®¿é—®ä»»æ„å†…å­˜åœ°å€ä¸Šçš„ä»»æ„æ•°æ®ï¼ŒæŸäº›ç¡¬ä»¶å¹³å°åªèƒ½åœ¨æŸäº›åœ°å€å¤„å–æŸäº›ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œå¦åˆ™æŠ›å‡ºç¡¬ä»¶å¼‚å¸¸ã€‚ä¸ºäº†åŒä¸€ä¸ªç¨‹åºå¯ä»¥åœ¨å¤šå¹³å°è¿è¡Œï¼Œéœ€è¦å†…å­˜å¯¹é½ã€‚</li><li>ç¡¬ä»¶åŸå› ï¼šç»è¿‡å†…å­˜å¯¹é½åï¼ŒCPUè®¿é—®å†…å­˜çš„é€Ÿåº¦å¤§å¤§æå‡ã€‚</li></ol><p>å¯ä»¥çœ‹ä¸€ä¸‹è¿™æ®µC++ä»£ç è¾“å‡ºçš„å„ä¸ªæ•°æ®ç±»å‹å¤§å°æ˜¯å¤šå°‘ï¼Ÿ</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">struct node{   int num;   char cha;}st;int main() {    int a[100];    char b[100];    cout &lt;&lt; sizeof(int) &lt;&lt; endl;    cout &lt;&lt; sizeof(char) &lt;&lt; endl;    cout &lt;&lt; sizeof(a) &lt;&lt; endl;    cout &lt;&lt; sizeof(b) &lt;&lt; endl;    cout &lt;&lt; sizeof(st) &lt;&lt; endl;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä¸€ä¸‹å’Œè‡ªå·±æƒ³çš„ç»“æœä¸€æ ·ä¹ˆï¼Œ æˆ‘ä»¬æ¥é€ä¸€åˆ†æä¸€ä¸‹ã€‚</p><p>å…¶è¾“å‡ºçš„ç»“æœä¾æ¬¡ä¸ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">414001008<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶ä¼šå‘ç°ï¼Œå’Œå•çº¯è®¡ç®—å­—èŠ‚æ•°çš„è¯æ˜¯æœ‰ä¸€äº›è¯¯å·®çš„ã€‚</p><p>è¿™å°±æ˜¯å› ä¸ºå†…å­˜å¯¹é½çš„åŸå› ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹å†…å­˜å¯¹é½å’Œéå†…å­˜å¯¹é½äº§ç”Ÿçš„æ•ˆæœåŒºåˆ«ã€‚</p><p>CPUè¯»å–å†…å­˜ä¸æ˜¯ä¸€æ¬¡è¯»å–å•ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—çš„æ¥è¯»å–å†…å­˜ï¼Œå—çš„å¤§å°å¯ä»¥æ˜¯2ï¼Œ4ï¼Œ8ï¼Œ16ä¸ªå­—èŠ‚ï¼Œå…·ä½“å–å¤šå°‘ä¸ªå­—èŠ‚å–å†³äºç¡¬ä»¶ã€‚</p><p>å‡è®¾CPUæŠŠå†…å­˜åˆ’åˆ†ä¸º4å­—èŠ‚å¤§å°çš„å—ï¼Œè¦è¯»å–ä¸€ä¸ª4å­—èŠ‚å¤§å°çš„intå‹æ•°æ®ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ç§æƒ…å†µä¸‹CPUçš„å·¥ä½œé‡ï¼š</p><p>ç¬¬ä¸€ç§å°±æ˜¯å†…å­˜å¯¹é½çš„æƒ…å†µï¼Œå¦‚å›¾ï¼š</p><p><img src="/2021/04/12/ji-suan-dai-ma-nei-cun-xiao-hao/640" alt="å›¾ç‰‡">å†…å­˜å¯¹é½</p><p>ä¸€å­—èŠ‚çš„charå ç”¨äº†å››ä¸ªå­—èŠ‚ï¼Œç©ºäº†ä¸‰ä¸ªå­—èŠ‚çš„å†…å­˜åœ°å€ï¼Œintæ•°æ®ä»åœ°å€4å¼€å§‹ã€‚</p><p>æ­¤æ—¶ï¼Œç›´æ¥å°†åœ°å€4ï¼Œ5ï¼Œ6ï¼Œ7å¤„çš„å››ä¸ªå­—èŠ‚æ•°æ®è¯»å–åˆ°å³å¯ã€‚</p><p>ç¬¬äºŒç§æ˜¯æ²¡æœ‰å†…å­˜å¯¹é½çš„æƒ…å†µå¦‚å›¾ï¼š</p><p><img src="/2021/04/12/ji-suan-dai-ma-nei-cun-xiao-hao/640" alt="å›¾ç‰‡">éå†…å­˜å¯¹é½</p><p>charå‹çš„æ•°æ®å’Œintå‹çš„æ•°æ®æŒ¨åœ¨ä¸€èµ·ï¼Œè¯¥intæ•°æ®ä»åœ°å€1å¼€å§‹ï¼Œé‚£ä¹ˆCPUæƒ³è¦è¯»è¿™ä¸ªæ•°æ®çš„è¯æ¥çœ‹çœ‹éœ€è¦å‡ æ­¥æ“ä½œï¼š</p><ol><li>å› ä¸ºCPUæ˜¯å››ä¸ªå­—èŠ‚å››ä¸ªå­—èŠ‚æ¥å¯»å€ï¼Œé¦–å…ˆCPUè¯»å–0ï¼Œ1ï¼Œ2ï¼Œ3å¤„çš„å››ä¸ªå­—èŠ‚æ•°æ®</li><li>CPUè¯»å–4ï¼Œ5ï¼Œ6ï¼Œ7å¤„çš„å››ä¸ªå­—èŠ‚æ•°æ®</li><li>åˆå¹¶åœ°å€1ï¼Œ2ï¼Œ3ï¼Œ4å¤„å››ä¸ªå­—èŠ‚çš„æ•°æ®æ‰æ˜¯æœ¬æ¬¡æ“ä½œéœ€è¦çš„intæ•°æ®</li></ol><p>æ­¤æ—¶ä¸€å…±éœ€è¦ä¸¤æ¬¡å¯»å€ï¼Œä¸€æ¬¡åˆå¹¶çš„æ“ä½œã€‚</p><p><strong>å¤§å®¶å¯èƒ½ä¼šå‘ç°å†…å­˜å¯¹é½å²‚ä¸æ˜¯æµªè´¹çš„å†…å­˜èµ„æºä¹ˆï¼Ÿ</strong></p><p>æ˜¯è¿™æ ·çš„ï¼Œä½†äº‹å®ä¸Šï¼Œç›¸å¯¹æ¥è¯´è®¡ç®—æœºå†…å­˜èµ„æºä¸€èˆ¬éƒ½æ˜¯å……è¶³çš„ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›çš„æ˜¯æé«˜è¿è¡Œé€Ÿåº¦ã€‚</p><p><strong>ç¼–è¯‘å™¨ä¸€èˆ¬éƒ½ä¼šåšå†…å­˜å¯¹é½çš„ä¼˜åŒ–æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´å½“è€ƒè™‘ç¨‹åºçœŸæ­£å ç”¨çš„å†…å­˜å¤§å°çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦è®¤è¯†åˆ°å†…å­˜å¯¹é½çš„å½±å“</strong>ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è´Ÿè½½å‡è¡¡</title>
      <link href="2021/04/10/fu-zai-jun-heng/"/>
      <url>2021/04/10/fu-zai-jun-heng/</url>
      
        <content type="html"><![CDATA[<h1 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h1><p>æ¦‚å¿µï¼šLB (Load Balanceï¼Œè´Ÿè½½å‡è¡¡)æ˜¯ä¸€ç§é›†ç¾¤æŠ€æœ¯ï¼Œå®ƒå°†ç‰¹å®šçš„ä¸šåŠ¡ï¼ˆç½‘ç»œæœåŠ¡ã€ç½‘ç»œæµé‡ç­‰ï¼‰åˆ†æ‹…ç»™å¤šå°ç½‘ç»œè®¾å¤‡ï¼ˆåŒ…æ‹¬æœåŠ¡å™¨ã€é˜²ç«å¢™ç­‰ï¼‰æˆ–å¤šæ¡é“¾è·¯ï¼Œä»è€Œæé«˜äº†ä¸šåŠ¡å¤„ç†èƒ½åŠ›ï¼Œä¿è¯äº†ä¸šåŠ¡çš„é«˜å¯é æ€§ã€‚</p><p>è´Ÿè½½å‡è¡¡è®¡æ•°å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li>é«˜æ€§èƒ½ï¼šè´Ÿè½½å‡è¡¡æŠ€æœ¯å°†ä¸šåŠ¡è¾ƒå‡è¡¡åœ°åˆ†æ‹…åˆ°å¤šå°è®¾å¤‡æˆ–é“¾è·¯ä¸Šï¼Œä»è€Œæé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚</li><li>å¯æ‰©å±•æ€§ï¼šè´Ÿè½½å‡è¡¡æŠ€æœ¯å¯ä»¥æ–¹ä¾¿çš„å¢åŠ é›†ç¾¤ä¸­è®¾å¤‡æˆ–é“¾è·¯çš„æ•°é‡ï¼Œåœ¨ä¸é™ä½ä¸šåŠ¡è´¨é‡çš„å‰æä¸‹æ»¡è¶³ä¸æ–­å¢é•¿çš„ä¸šåŠ¡éœ€æ±‚ã€‚</li><li>é«˜å¯é æ€§ï¼šå•ä¸ªè®¾ç½®å¤šä¸ªè®¾å¤‡æˆ–é“¾è·¯æ•…éšœä¹Ÿä¸ä¼šå¯¼è‡´ä¸šåŠ¡ä¸­æ–­ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯é æ€§ã€‚</li><li>å¯ç®¡ç†æ€§ï¼šå¤§é‡çš„ç®¡ç†å…±ç»„éƒ½é›†ä¸­åœ¨ä½¿ç”¨è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„è®¾å¤‡ä¸Šï¼Œè®¾å¤‡é›†ç¾¤æˆ–é“¾è·¯é›†ç¾¤åªéœ€è¦ç»´æŠ¤é€šè¿‡çš„é…ç½®å³å¯ã€‚</li><li>é€æ˜æ€§ï¼šå¯¹ç”¨æˆ·è€Œè¨€ï¼Œé›†ç¾¤ç­‰äºä¸€ä¸ªæˆ–å¤šä¸ªé«˜å¯é æ€§ã€é«˜æ€§èƒ½çš„è®¾å¤‡æˆ–é“¾è·¯ï¼Œç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°ï¼Œä¹Ÿä¸å…³å¿ƒå…·ä½“çš„ç½‘ç»œç»“æ„ï¼Œå¢åŠ æˆ–å‡å°‘è®¾å¤‡æˆ–é“¾è·¯æ•°é‡éƒ½ä¸ä¼šå½±å“æ­£å¸¸çš„ä¸šåŠ¡ã€‚</li></ol><p>è´Ÿè½½å‡è¡¡æŠ€æœ¯åˆ†ç±»ï¼š</p><ol><li>æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼šåœ¨æ•°æ®ä¸­å¿ƒç­‰ç»„ç½‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥é‡‡ç”¨æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå°†ç½‘ç»œæœåŠ¡åˆ†æ‹…ç»™å¤šå°æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œæé«˜æ•°æ®ä¸­å¿ƒçš„ä¸šåŠ¡å¤„ç†èƒ½åŠ›ã€‚</li><li>é“¾è·¯è´Ÿè½½å‡è¡¡ï¼šåœ¨æœ‰å¤šä¸ªè¿è¥å•†å‡ºæ¥å£çš„ç»„ç½‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥é‡‡ç”¨å‡ºæ–¹å‘å¤šé“¾è·¯åŠ¨æ€è´Ÿè½½å‡è¡¡ï¼Œå®ç°é“¾è·¯çš„åŠ¨æ€é€‰æ‹©ï¼Œæé«˜æœåŠ¡çš„å¯é æ€§ã€‚</li><li>é˜²ç«å¢™è´Ÿè½½å‡è¡¡ï¼šåœ¨é˜²ç«å¢™å¤„ç†èƒ½åŠ›æˆä¸ºç“¶é¢ˆçš„ç»„ç½‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥é‡‡ç”¨é˜²ç«å¢™è´Ÿè½½å‡è¡¡ï¼Œå°†ç½‘ç»œæµé‡åˆ†æ‹…ç»™å¤šæ€é˜²ç«å¢™è®¾å¤‡ï¼Œæé«˜é˜²ç«å¢™çš„å¤„ç†èƒ½åŠ›ã€‚</li></ol><h2 id="è´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#è´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="è´Ÿè½½å‡è¡¡ç®—æ³•"></a>è´Ÿè½½å‡è¡¡ç®—æ³•</h2><p>æœ€ç®€å•çš„è´Ÿè½½å‡è¡¡ç®—æ³•æ˜¯éšæœºç®—æ³•å’Œè½®è¯¢ç®—æ³•ã€‚</p><p>æ¨¡æ‹ŸåŠ æƒéšæœºç®—æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> deviceList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>            <span class="token string">"192.168.0.1"</span><span class="token punctuation">,</span>            <span class="token string">"192.168.0.2"</span><span class="token punctuation">,</span>            <span class="token string">"192.168.0.3"</span><span class="token punctuation">,</span>            <span class="token string">"192.168.0.4"</span><span class="token punctuation">,</span>            <span class="token string">"192.168.0.5"</span><span class="token punctuation">,</span>            <span class="token string">"192.168.0.6"</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> weightMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> ip <span class="token operator">:</span> weightMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Integer</span> integer <span class="token operator">=</span> weightMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> integer<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    deviceList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>weightMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç®€å•çš„è½®è¯¢å°±æ˜¯ä¾æ¬¡éå†æ¯å°æœºå­ï¼ŒæŠŠä¸šåŠ¡æ”¾åœ¨å½“å‰éå†çš„æœºå­ä¸Šå°±è¡Œã€‚</p><p>æ¨¡æ‹Ÿè½®è¯¢ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> è´Ÿè½½å‡è¡¡ java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pythonBase</title>
      <link href="2021/04/09/pythonbase/"/>
      <url>2021/04/09/pythonbase/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Pythonçº¿ç¨‹æ¨¡å—"><a href="#1-Pythonçº¿ç¨‹æ¨¡å—" class="headerlink" title="1. Pythonçº¿ç¨‹æ¨¡å—"></a>1. Pythonçº¿ç¨‹æ¨¡å—</h2><p>GILï¼ˆGlobal Interpreter Lockï¼Œå…¨å±€è§£é‡Šå™¨é”ï¼‰ä¸æ˜¯Pythonç‹¬æœ‰çš„ç‰¹æ€§ï¼Œå®ƒåªæ˜¯åœ¨å®ç°CPythonï¼ˆPythonè§£é‡Šå™¨ï¼‰æ—¶ï¼Œå¼•å…¥çš„ä¸€ä¸ªæ¦‚å¿µã€‚åœ¨å®˜æ–¹ç½‘ç«™ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>In CPython, the global interpreter lock, or GIL, is a mutex that prevents multiple native threads from executing Python bytecodes at once. This lock is necessary mainly because CPythonâ€™s memory management is not thread-safe. (However, since the GIL exists, other features have grown to depend on the guarantees that it enforces.)</p></blockquote><p>ç”±å®šä¹‰å¯çŸ¥ï¼ŒGILæ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼ˆmutexï¼‰ã€‚å®ƒé˜»æ­¢äº† å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒPythonå­—èŠ‚ç ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™é™ä½äº†æ‰§è¡Œæ•ˆç‡ã€‚ç†è§£GILçš„å¿…è¦æ€§ï¼Œéœ€è¦äº†è§£CPythonå¯¹äºçº¿ç¨‹å®‰å…¨çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å•æ ¸CPUä¸‹ï¼Œå¤šçº¿ç¨‹ä»»åŠ¡æ˜¯å¦‚ä½•è°ƒåº¦çš„ã€‚</p><p><img src="/2021/04/09/pythonbase/v2-036bb273ba382803c29bfe075ed07b8d_1440w.jpg" alt="img"></p><p>ç”±å›¾å¯çŸ¥ï¼Œç”±äºGILçš„æœºåˆ¶ï¼Œå•æ ¸CPUåœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œã€‚å½“çº¿ç¨‹é‡åˆ°IOæ“ä½œæˆ–Timer Tickåˆ°æœŸï¼Œé‡Šæ”¾GILé”ã€‚å…¶ä»–çš„ä¸¤ä¸ªçº¿ç¨‹å»ç«äº‰è¿™æŠŠé”ï¼Œå¾—åˆ°é”ä¹‹åï¼Œæ‰å¼€å§‹è¿è¡Œã€‚</p><p>çº¿ç¨‹é‡Šæ”¾GILé”æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€æ˜¯é‡åˆ°IOæ“ä½œï¼ŒäºŒæ˜¯Time Tickåˆ°æœŸã€‚IOæ“ä½œå¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚å‘å‡ºä¸€ä¸ªhttpè¯·æ±‚ï¼Œç­‰å¾…å“åº”ã€‚é‚£ä¹ˆTime Tickåˆ°æœŸæ˜¯ä»€ä¹ˆå‘¢ï¼ŸTime Tickè§„å®šäº†çº¿ç¨‹çš„æœ€é•¿æ‰§è¡Œæ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åè‡ªåŠ¨é‡Šæ”¾GILé”ã€‚</p><p>è™½ç„¶éƒ½æ˜¯é‡Šæ”¾GILé”ï¼Œä½†è¿™ä¸¤ç§æƒ…å†µæ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯”å¦‚ï¼ŒThread1é‡åˆ°IOæ“ä½œé‡Šæ”¾GILï¼Œç”±Thread2å’ŒThread3æ¥ç«äº‰è¿™ä¸ªGILé”ï¼ŒThread1ä¸å†å‚ä¸è¿™æ¬¡ç«äº‰ã€‚å¦‚æœæ˜¯Thread1å› ä¸ºTime Tickåˆ°æœŸé‡Šæ”¾GILï¼Œé‚£ä¹ˆä¸‰ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ç«äº‰è¿™æŠŠGILé”ï¼Œå¯èƒ½å‡ºç°Thread1åœ¨ç«äº‰ä¸­èƒœå‡ºï¼Œå†æ¬¡æ‰§è¡Œçš„æƒ…å†µã€‚å•æ ¸CPUä¸‹ï¼Œè¿™ç§æƒ…å†µä¸ç®—ç‰¹åˆ«ç³Ÿç³•ã€‚å› ä¸ºåªæœ‰1ä¸ªCPUï¼Œæ‰€ä»¥CPUçš„åˆ©ç”¨ç‡æ˜¯å¾ˆé«˜çš„ã€‚</p><p>åœ¨å¤šæ ¸CPUä¸‹ï¼Œç”±äºGILé”çš„å…¨å±€ç‰¹æ€§ï¼Œæ— æ³•å‘æŒ¥å¤šæ ¸çš„ç‰¹æ€§ï¼ŒGILé”ä¼šä½¿å¾—å¤šçº¿ç¨‹ä»»åŠ¡çš„æ•ˆç‡å¤§å¤§é™ä½ã€‚</p><p><img src="/2021/04/09/pythonbase/v2-3577df8b9dd94d4f2075e34a67aaa919_1440w.jpg" alt="img"></p><p>Thread1åœ¨CPU1ä¸Šè¿è¡Œï¼ŒThread2åœ¨CPU2ä¸Šè¿è¡Œã€‚GILæ˜¯å…¨å±€çš„ï¼ŒCPU2ä¸Šçš„Thread2éœ€è¦ç­‰å¾…CPU1ä¸Šçš„Thread1è®©å‡ºGILé”ï¼Œæ‰æœ‰å¯èƒ½æ‰§è¡Œã€‚å¦‚æœåœ¨å¤šæ¬¡ç«äº‰ä¸­ï¼ŒThread1éƒ½èƒœå‡ºï¼ŒThread2æ²¡æœ‰å¾—åˆ°GILé”ï¼Œæ„å‘³ç€CPU2ä¸€ç›´æ˜¯é—²ç½®çš„ï¼Œæ— æ³•å‘æŒ¥å¤šæ ¸çš„ä¼˜åŠ¿ã€‚</p><p>ä¸ºäº†é¿å…åŒä¸€çº¿ç¨‹éœ¸å CPUï¼Œåœ¨python3.xä¸­ï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨çš„è°ƒæ•´è‡ªå·±çš„ä¼˜å…ˆçº§ï¼Œä½¿å¾—å¤šçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚</p><p>æ—¢ç„¶GILé™ä½äº†å¤šæ ¸çš„æ•ˆç‡ï¼Œé‚£ä¿ç•™å®ƒçš„ç›®çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™å°±å’Œçº¿ç¨‹æ‰§è¡Œçš„å®‰å…¨æœ‰å…³ã€‚</p><p>å‡†ç¡®çš„è¯´ï¼ŒGILçš„çº¿ç¨‹å®‰å…¨æ˜¯ç²—ç²’åº¦çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰GILéƒ½ä¸æ„å‘³ç€çº¿ç¨‹å®‰å…¨ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­:</p><pre class="line-numbers language-python3" data-language="python3"><code class="language-python3">def add():    global n    for i in range(10**1000):        n = n +1def sub():    global n    for i in range(10**1000):        n = n - 1n = 0import threadinga = threading.Thread(target=add,)b = threading.Thread(target=sub,)a.start()b.start()#join ç”¨äºé˜»å¡ä¸»çº¿ç¨‹ï¼Œé¿å…è¿‡æ—©æ‰“å°na.join()b.join()print n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„ç¨‹åºå¯¹nåšäº†åŒæ ·æ•°é‡çš„åŠ æ³•å’Œå‡æ³•ï¼Œé‚£ä¹ˆnç†è®ºä¸Šæ˜¯0ã€‚ä½†è¿è¡Œç¨‹åºï¼Œæ‰“å°nï¼Œå‘ç°å®ƒä¸æ˜¯0ã€‚é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Œé—®é¢˜åœ¨äºpythonçš„æ¯è¡Œä»£ç ä¸æ˜¯åŸå­åŒ–çš„æ“ä½œã€‚æ¯”å¦‚n = n+1è¿™æ­¥ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§æ‰§è¡Œçš„ã€‚å¦‚æœå»æŸ¥çœ‹pythonç¼–è¯‘åçš„å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">19 LOAD_GLOBAL              1 (n)22 LOAD_CONST               3 (1)25 BINARY_ADD          26 STORE_GLOBAL             1 (n)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä»è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œn = n +1 æ“ä½œåˆ†æˆäº†å››æ­¥å®Œæˆã€‚å› æ­¤ï¼Œn = n+1ä¸æ˜¯ä¸€ä¸ªåŸå­åŒ–æ“ä½œã€‚</p><p>1.åŠ è½½å…¨å±€å˜é‡nï¼Œ2.åŠ è½½å¸¸æ•°1ï¼Œ3.è¿›è¡ŒäºŒè¿›åˆ¶åŠ æ³•è¿ç®—ï¼Œ4.å°†è¿ç®—ç»“æœå­˜å…¥å˜é‡nã€‚</p><p>æ ¹æ®å‰é¢çš„çº¿ç¨‹é‡Šæ”¾GILé”åŸåˆ™ï¼Œçº¿ç¨‹aæ‰§è¡Œè¿™å››æ­¥çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½ä¼šè®©å‡ºGILã€‚å¦‚æœè¿™æ ·ï¼Œn=n+1çš„è¿ç®—è¿‡ç¨‹å°±è¢«æ‰“ä¹±äº†ã€‚æœ€åçš„ç»“æœä¸­ï¼Œå¾—åˆ°ä¸€ä¸ªéé›¶çš„nä¹Ÿå°±ä¸è¶³ä¸ºå¥‡ã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´GILæ˜¯ç²—ç²’åº¦çš„ï¼Œå®ƒåªä¿è¯äº†ä¸€å®šç¨‹åº¦çš„å®‰å…¨ã€‚å¦‚æœè¦åšåˆ°çº¿ç¨‹çš„ç»å¯¹å®‰å…¨ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„éIOæ“ä½œï¼Œæˆ‘ä»¬éƒ½éœ€è¦è‡ªå·±å†åŠ ä¸€æŠŠé”å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚åœ¨pythonä¸­ï¼Œæœ‰äº›æ“ä½œæ˜¯æ˜¯åŸå­çº§çš„ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªå­—èŠ‚ç ï¼ŒGILæ— æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡Šæ”¾ã€‚å¯¹äºè¿™ç§åŸå­çº§çš„æ–¹æ³•æ“ä½œï¼Œæˆ‘ä»¬æ— éœ€æ‹…å¿ƒå®ƒçš„å®‰å…¨ã€‚æ¯”å¦‚sortæ–¹æ³•ï¼Œ[1,4,2].sort()ï¼Œç¿»è¯‘æˆå­—èŠ‚ç å°±æ˜¯CALL METHOD 0ã€‚åªæœ‰ä¸€è¡Œï¼Œæ— æ³•å†åˆ†ï¼Œæ‰€ä»¥å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p><strong>æ€»ç»“</strong></p><p>å¯¹äºIOå¯†é›†å‹åº”ç”¨ï¼Œå¤šçº¿ç¨‹çš„åº”ç”¨å’Œå¤šè¿›ç¨‹åº”ç”¨åŒºåˆ«ä¸å¤§ã€‚å³ä¾¿æœ‰GILå­˜åœ¨ï¼Œç”±äºIOæ“ä½œä¼šå¯¼è‡´GILé‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿè·å¾—æ‰§è¡Œæƒé™ã€‚ç”±äºå¤šçº¿ç¨‹çš„é€šè®¯æˆæœ¬ä½äºå¤šè¿›ç¨‹ï¼Œå› æ­¤åå‘ä½¿ç”¨å¤šçº¿ç¨‹ã€‚</p><p>å¯¹äºè®¡ç®—å¯†é›†å‹åº”ç”¨ï¼Œå¤šçº¿ç¨‹å¤„äºç»å¯¹åŠ£åŠ¿ï¼Œå¯ä»¥é‡‡ç”¨å¤šè¿›ç¨‹æˆ–åç¨‹ã€‚</p><h3 id="1-1-å®é™…ä½¿ç”¨"><a href="#1-1-å®é™…ä½¿ç”¨" class="headerlink" title="1.1 å®é™…ä½¿ç”¨"></a>1.1 å®é™…ä½¿ç”¨</h3><p>pythonä¸»è¦é€šè¿‡<code>thread</code>å’Œ<code>threading</code>è¿™ä¸¤ä¸ªæ¨¡å—æ¥å®ç°å¤šçº¿ç¨‹æ”¯æŒã€‚pythonçš„threadæ¨¡å—æ˜¯æ¯”è¾ƒåº•å±‚çš„æ¨¡å—ï¼Œ<code>threding</code>æ˜¯å¯¹threadåšäº†ä¸€äº›å°è£…ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„è¢«ä½¿ç”¨ã€‚ä½†æ˜¯pythonç”±äºGILçš„å­˜åœ¨æ— æ³•ä½¿ç”¨threadingå……åˆ†åˆ©ç”¨GPUèµ„æºï¼Œå¦‚æœæƒ³å……åˆ†å‘æŒ¥å¤šæ ¸CPUçš„è®¡ç®—èƒ½åŠ›éœ€è¦ä½¿ç”¨<code>multiprocessing</code>æ¨¡å—ã€‚</p><h3 id="1-1-1-å¦‚ä½•åˆ›å»ºçº¿ç¨‹"><a href="#1-1-1-å¦‚ä½•åˆ›å»ºçº¿ç¨‹" class="headerlink" title="1.1.1 å¦‚ä½•åˆ›å»ºçº¿ç¨‹"></a>1.1.1 å¦‚ä½•åˆ›å»ºçº¿ç¨‹</h3><p><code>python3.x</code>ä¸­å·²ç»æ”¾å¼ƒäº†<code>python2.x</code>ä¸­é‡‡ç”¨å‡½æ•°å¼<code>thread</code>æ¨¡å—ä¸­çš„<code>start_new_thread()</code>å‡½æ•°æ¥äº§ç”Ÿæ–°çº¿ç¨‹çš„æ–¹å¼ã€‚</p><p>python3ä¸­é€šè¿‡threadingæ¨¡å—åˆ›å»ºæ–°çš„çº¿ç¨‹æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p>ç¬¬ä¸€ç§æ˜¯é€šè¿‡threading.Thread(Target=executable Method)â€”â€”å³ä¼ é€’ç»™Threadå¯¹è±¡ä¸€ä¸ªå¯æ‰§è¡Œæ–¹æ³•ï¼ˆæˆ–å¯¹è±¡ï¼‰ã€‚</p><p>ç¬¬äºŒç§æ˜¯ç»§æ‰¿threading.Threadå®šä¹‰å­ç±»å¹¶é‡å†™run()æ–¹æ³•ã€‚</p><p>ï¼ˆ1ï¼‰é€šè¿‡threading.Threadè¿›è¡Œåˆ›å»ºå¤šçº¿ç¨‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Socket</title>
      <link href="2021/04/09/socket/"/>
      <url>2021/04/09/socket/</url>
      
        <content type="html"><![CDATA[<h1 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h1><h3 id="1-socketè¯»å†™ç¼“å†²åŒºçš„å·¥ä½œæœºåˆ¶"><a href="#1-socketè¯»å†™ç¼“å†²åŒºçš„å·¥ä½œæœºåˆ¶" class="headerlink" title="1. socketè¯»å†™ç¼“å†²åŒºçš„å·¥ä½œæœºåˆ¶"></a>1. socketè¯»å†™ç¼“å†²åŒºçš„å·¥ä½œæœºåˆ¶</h3><p>æ¯ä¸ªsocketéƒ½æœ‰ä¸¤ä¸ªç¼“å†²åŒºï¼Œä¸€ä¸ªæ˜¯è¾“å…¥ç¼“å†²åŒºï¼Œä¸€ä¸ªæ˜¯è¾“å‡ºç¼“å†²åŒºã€‚</p><p><img src="/2021/04/09/socket/socket%E7%BC%93%E5%86%B2%E5%8C%BA.PNG"></p><p><font color="red">æœ‰è¿™ä¹ˆä¸€ç§ç‰¹æ®Šæƒ…å†µ</font>ï¼Œå¦‚æœä½ çš„<code>socket</code>å·²ç»<code>close</code>äº†ï¼Œä½ çš„è¾“å‡ºç¼“å†²åŒºè¿˜æœ‰æ•°æ®ï¼Œè¿™æ—¶TCPä¼šç»§ç»­å°†å‰©ä¸‹çš„ç¼“å†²åŒºæ•°æ®å‘é€ç»™å¯¹æ–¹ã€‚</p><p>ä½†æ˜¯socketå»closeæ—¶è¾“å…¥ç¼“å†²åŒºè¿˜æœ‰æ•°æ®ï¼Œè¿™æ—¶è¾“å…¥ç¼“å†²åŒºçš„æ•°æ®å°±ä¸¢å¤±äº†ã€‚</p><h2 id="ä¸€ã€I-O-æ¨¡å‹"><a href="#ä¸€ã€I-O-æ¨¡å‹" class="headerlink" title="ä¸€ã€I/O æ¨¡å‹"></a>ä¸€ã€I/O æ¨¡å‹</h2><p>ä¸€ä¸ªè¾“å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li>ç­‰å¾…æ•°æ®å‡†å¤‡å¥½</li><li>ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ®</li></ul><p>å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ‰€ç­‰å¾…æ•°æ®åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚</p><p>Unix æœ‰äº”ç§ I/O æ¨¡å‹ï¼š</p><ul><li>é˜»å¡å¼ I/O</li><li>éé˜»å¡å¼ I/O</li><li>I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰</li><li>ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰</li><li>å¼‚æ­¥ I/Oï¼ˆAIOï¼‰</li></ul><h3 id="1-é˜»å¡å¼-I-O"><a href="#1-é˜»å¡å¼-I-O" class="headerlink" title="1. é˜»å¡å¼ I/O"></a>1. é˜»å¡å¼ I/O</h3><p>åº”ç”¨è¿›ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›ã€‚</p><p>åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨é˜»å¡çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤é˜»å¡ä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å› ä¸ºå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œè¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡ä¼šæ¯”è¾ƒé«˜ã€‚</p><p>ä¸‹å›¾ä¸­ï¼Œrecvfrom() ç”¨äºæ¥æ”¶ Socket ä¼ æ¥çš„æ•°æ®ï¼Œå¹¶å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒº buf ä¸­ã€‚è¿™é‡ŒæŠŠ recvfrom() å½“æˆç³»ç»Ÿè°ƒç”¨ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">ssize_t</span> <span class="token function">recvfrom</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>src_addr<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> <span class="token operator">*</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/04/09/socket/1492928416812_4.png" alt="img"></p><h3 id="2-éé˜»å¡å¼-I-O"><a href="#2-éé˜»å¡å¼-I-O" class="headerlink" title="2. éé˜»å¡å¼ I/O"></a>2. éé˜»å¡å¼ I/O</h3><p>åº”ç”¨è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥è·çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºè½®è¯¢ï¼ˆpollingï¼‰ã€‚</p><p>ç”±äº CPU è¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ¯”è¾ƒä½ã€‚</p><p><img src="/2021/04/09/socket/1492929000361_5.png" alt="img"></p><h3 id="I-O-å¤ç”¨"><a href="#I-O-å¤ç”¨" class="headerlink" title="I/O å¤ç”¨"></a>I/O å¤ç”¨</h3><p>å› ä¸ºåœ¨å¤šçº¿ç¨‹ä¸­ä¸Šä¸‹æ–‡åˆ‡æ¢ä»£ä»·å¤ªé«˜ï¼Œå°†å…¶è½¬æ¢ä¸ºå•çº¿ç¨‹çš„æ€è·¯ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å•çº¿ç¨‹è½®è¯¢çš„æ–¹å¼ï¼Œå¦‚æœæ•°æ®æ²¡è¯»å®Œå°±ä¸€ç›´è¯»ä¸‹å»</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>fdx in <span class="token punctuation">(</span>cache<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fdx have data<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//è¿™é‡Œçš„åˆ¤æ–­è¿˜æ˜¯æˆ‘ä»¬è‡ªå·±çš„ç¨‹åºåšçš„ï¼Œæ•ˆç‡å¯èƒ½ä¸æ˜¯å¾ˆé«˜ï¼Œç”¨ä¸Šç³»ç»Ÿå†…éƒ¨çš„ä¸œè¥¿å°±å¥½äº†</span>            <span class="token function">read</span><span class="token punctuation">(</span>fdx<span class="token punctuation">)</span><span class="token punctuation">;</span>            process<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-select-å‡½æ•°çš„ä»£ç "><a href="#1-select-å‡½æ•°çš„ä»£ç " class="headerlink" title="1. select å‡½æ•°çš„ä»£ç "></a><strong>1. select å‡½æ•°çš„ä»£ç </strong></h4><p><img src="/2021/04/09/socket/selectCode.PNG"></p><p>selectå‡½æ•°å®ç°I/Oç«¯å£çš„å¤ç”¨ï¼Œä¼ é€’ç»™selectå‡½æ•°çš„å‚æ•°ä¼šå‘Šè¯‰å†…æ ¸ï¼š</p><ol><li>æˆ‘ä»¬æ‰€å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦</li><li>å¯¹æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæˆ‘ä»¬æ‰€å…³å¿ƒçš„çŠ¶æ€</li><li>æˆ‘ä»¬è¦ç­‰å¾…å¤šé•¿æ—¶é—´</li></ol><p>ä»selectå‡½æ•°è¿”å›åï¼Œå†…æ ¸å‘Šè¯‰æˆ‘ä»¬ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ol><li>å¯¹æˆ‘ä»¬çš„è¦æ±‚å·²ç»åšå¥½å‡†å¤‡çš„æè¿°ç¬¦ä¸ªæ•°</li><li>å¯¹äºä¸‰ç§æ¡ä»¶å“ªäº›æè¿°ç¬¦å·²ç»åšå¥½å‡†å¤‡ï¼ˆè¯»ï¼Œå†™ï¼Œå¼‚å¸¸ï¼‰ã€‚</li></ol><p>Linux select å‡½æ•°æ¥å£ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;sys/select.h&gt;int select(int maxfdp1, fd_set *readset, fd_set *writeset, fd_set *exceptset, struct timeval *timeout);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å…¶ä¸­çš„timevalç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">struct timeval {    long tv_sec;//ç§’    long tv_usec;//å¾®ç§’}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æœ‰ä¸‰ç§æƒ…å†µ</p><ol><li>timeout == NULL ç­‰å¾…æ— é™é•¿çš„æ—¶é—´</li><li>timeout -&gt; tv_sec == 0 &amp;&amp; timeout -&gt; tv_usec == 0 ä¸ç­‰å¾…ï¼Œç›´æ¥è¿”å›ã€‚ï¼ˆéé˜»å¡ï¼‰</li><li>timeout -&gt; tv_sec != 0 &amp;&amp; timeout -&gt; tv_usec != 0 ç­‰å¾…æŒ‡å®šçš„æ—¶é—´ã€‚</li></ol><p>ä¸­é—´çš„ä¸‰ä¸ªå‚æ•°readsetï¼Œwritesetå’Œexceptsetï¼ŒæŒ‡å‘æè¿°ç¬¦é›†ã€‚è¿™äº›å‚æ•°æŒ‡æ˜äº†æˆ‘ä»¬å…³å¿ƒå“ªäº›æè¿°ç¬¦ï¼Œå’Œæ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼ˆå¯å†™ï¼Œå¯è¯»ï¼Œå¼‚å¸¸ï¼‰ã€‚</p><p>ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å­˜å‚¨åœ¨fd_setç±»å‹ä¸­ï¼Œfd_setå…¶å®å°±æ˜¯ä½å›¾(bitmap)ï¼›è¿™ä¸ªfd_setçš„é•¿åº¦æ˜¯1024ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™æˆ‘ä»¬ä»…ä»…éœ€è¦ä¸ªä½æ•°çš„è¯»å–ï¼Œæ‰€ä»¥ä½¿ç”¨maxfdp1æ¥è®¾ç½®æœ€å¤§çœŸæ­£çš„æœ‰æ•ˆä½ã€‚</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">fdset  = 0001110000000000000000000000000......maxfdp1 = 5 (index start from 0,å’Œç½‘ä¸Šè¯´çš„æœ‰æ•ˆä½æ•°+1æ˜¯ä¸€ä¸ªæ„æ€)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>linuxæä¾›äº†ä¸€ç»„å®ï¼Œæ¥ä¸ºfd_setè¿›è¡Œèµ‹å€¼ç­‰æ“ä½œã€‚</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;sys/select.h&gt;// FD_ZEROå®å°†ä¸€ä¸ªfd_setç±»å‹çš„æ‰€æœ‰ä½è®¾ç½®ä¸º0int FD_ZERO(fd_set *fdset);//æ¸…é™¤æŸä¸ªä½æ—¶ç”¨ FD_CLRint FD_CLR(int fd, fdset *fdset);//ä½¿ç”¨FD_SETå°†æŒ‡å®šä½ç½®çš„bitå€¼è®¾ç½®ä¸º1int FD_SET(int fd, fdset *fdset);//FD_ISSET æ¥æµ‹è¯•æŸä¸ªä½æ˜¯å¦è¢«ç½®ä½int FD_ISSET(int fd, fd_set *fdset);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‚æ•°ä¸­int maxfdp æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œæ˜¯æŒ‡é›†åˆä¸­æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„èŒƒå›´ï¼Œå³æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§å€¼åŠ 1ï¼Œä¸èƒ½é”™ã€‚</p><p>C++ä¸­ä½¿ç”¨ linux select å‡½æ•°çš„demo</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include "sys/select.h"//socket å»ºç«‹è¿æ¥sockfd = socket(AF_INEF, SOCK_STREAM, 0);memset(&amp;addr, 0, sizeof(addr));addr.sin_family = AF_INET;addr.sin_port = htons(2000);addr.sin_addr.s.addr = INADDR_ANY;bind(sockfd, (struct sockaddr*)&amp;addr, sizeof(addr));listen(sockfd, s);for(int i = 0; i &lt; 5; i++) {    memset(&amp;client, 0, sizeof(client));    addrlen = sizeof(client);    fds[i] = accept(sockfd, (struct sockaddr*)&amp;client, &amp;addrlen);    if(fds[i] &gt; max) {        max = fds[i];    }}while (1) {    FD_ZERO(&amp;rset);    for (int i = 0; i &lt; 5; i++) {        FD_SET(fds[i], &amp;rset);    }    print("round again");    select(max + 1, &amp;rset, NULL, NULL, NULL);        for (int i = 0; i &lt; 5; i++) {        if (FD_ISSET(fds[i], &amp;rset)) {            memset(buffer, 0, MAXBUF);            read(fds[i], buffer, MAXBUF);            print(buffer);        }    }   }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼ºç‚¹ï¼š</p><ol><li>resetæ¯æ¬¡ä¸èƒ½å¤ç”¨ï¼Œéœ€è¦é‡æ–°è®¾ç½®ã€‚ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œæ€»æ˜¯æ‹·è´ã€‚</li><li>fd_set 1024ä¸ªå¤§å°é™åˆ¶ã€‚</li></ol><h4 id="2-epoll"><a href="#2-epoll" class="headerlink" title="2. epoll"></a>2. epoll</h4><p>æ˜¯åœ¨2.6å†…æ ¸ä¸­æå‡ºçš„ã€‚æ˜¯ä¹‹å‰<code>select</code>å’Œ<code>poll</code>çš„å¢å¼ºç‰ˆæœ¬ã€‚epollæ²¡æœ‰æè¿°ç¬¦å¤§å°é™åˆ¶ï¼Œä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦çš„æ—¶é—´å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„copyåªéœ€è¦ä¸€æ¬¡ã€‚</p><p>å¤§ä½“ç»“æ„ï¼š</p><p><img src="/2021/04/09/socket/epoll%E7%BB%93%E6%9E%84.PNG"></p><p>fdæŒ‡å®šepollé‡Œé¢å“ªä¸ªsocketï¼Œepollé‡Œé¢æœ‰ä¸ªåˆ—è¡¨ä¿å­˜å¾ˆå¤šä¸ªäº‹ä»¶ï¼ˆå¯¹åº”socketï¼‰ã€‚ç„¶åæœ‰å¾ˆå¤šä¸ªä¸åŒçš„epollã€‚</p><p>æ¯ä¸ªepollé‡Œé¢æœ‰äº‹ä»¶åˆ—è¡¨å’Œå°±ç»ªåˆ—è¡¨ã€‚å°±ç»ªåˆ—è¡¨é‡Œé¢ä¿å­˜å·²ç»æ³¨å†Œçš„äº‹ä»¶ä¿¡æ¯ã€‚å°±ç»ªåˆ—è¡¨ä¸»è¦æ˜¯ç”±<code>epoll_wait()</code>è¿›è¡Œè®¿é—®ï¼Œå½“å°±ç»ªåˆ—è¡¨é‡Œé¢æœ‰ä¿¡æ¯æ—¶å¯ä»¥ç›´æ¥è¿”å›ï¼Œå½“æ²¡æœ‰ä¿¡æ¯ï¼Œåˆ™éœ€è¦é˜»å¡ï¼ˆæŒ‡å®šçš„timeoutï¼Œå½“timeoutè®¾å®šä¸º -1 æ—¶ä¸€ç›´é˜»å¡ç›´åˆ°æœ‰ä¿¡æ¯ï¼‰ã€‚</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p>epollè¿‡ç¨‹éœ€è¦ä¸‰ä¸ªæ¥å£ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;sys/epoll.h&gt;//è¿™ä¸ªå‡½æ•°æ˜¯ä¸ªç³»ç»Ÿå‡½æ•°ï¼Œå‡½æ•°å°†åœ¨å†…æ ¸ç©ºé—´å†…å¼€è¾Ÿä¸€å—æ–°çš„ç©ºé—´ï¼Œå¯ä»¥ç†è§£ä¸ºepollç»“æ„ç©ºé—´ï¼Œè¿”å›å€¼ä¸ºepollçš„æ–‡ä»¶æè¿°ç¬¦ç¼–å·ï¼Œæ–¹ä¾¿åç»­æ“ä½œä½¿ç”¨ã€‚int epoll_create(int size);//æ˜¯epollå‡½æ•°çš„äº‹ä»¶æ³¨å†Œå‡½æ•°ï¼ŒæŠŠäº‹ä»¶æ”¾åˆ°äº‹ä»¶åˆ—è¡¨é‡Œé¢ã€‚è¿™æ ·äº‹ä»¶çš„ä»»ä½•æ”¹åŠ¨å†…æ ¸å¯ä»¥ç›´åˆ°ï¼Œä¸ç”¨æ¥å›æ”¹åŠ¨ã€‚ï¼ˆå®é™…ä¸Šäº‹ä»¶çš„æ³¨å†Œä¸é”€æ¯é¢‘ç‡ä¸ä¼šå¤ªé«˜ï¼Œæ‰€ä»¥å’Œå†…æ ¸æ€äº¤äº’ä¸ä¼šå¤ªé¢‘ç¹ï¼‰ã€‚epollä¸selectä¸åŒï¼Œselectå‡½æ•°æ˜¯è°ƒç”¨æ—¶æŒ‡å®šéœ€è¦ç›‘å¬çš„æè¿°ç¬¦å’Œäº‹ä»¶ï¼Œepollå…ˆå°†ç”¨æˆ·æ„Ÿå…´è¶£çš„æè¿°ç¬¦äº‹ä»¶æ³¨å†Œåˆ°epollç©ºé—´ï¼Œæ­¤å‡½æ•°//æ˜¯éé˜»å¡å‡½æ•°ï¼Œä½œç”¨ä»…ä»…æ˜¯å¢åˆ æ”¹epollç©ºé—´å†…çš„æè¿°ç¬¦ä¿¡æ¯ã€‚//å‚æ•°ï¼šepfdï¼ŒæŒ‡å®šå“ªä¸ªepollï¼Œä»è€Œå¯ä»¥è®©åé¢çš„è¿›ç¨‹fdç¼–å·æ‰¾åˆ°åŒ¹é…çš„socketï¼Œå‡½æ•°å°†ä¾é ç¼–å·æ‰¾åˆ°å¯¹åº”çš„epollç»“æ„ã€‚//opï¼Œè¡¨ç¤ºå½“å‰è¯·æ±‚ç±»å‹ï¼Œç”±ä¸‰ä¸ªå®å®šä¹‰(EPOLL_CTL_ADD:æ³¨å†Œæ–°çš„fdåˆ°epfdä¸­ã€EPOLL_CTL_MOD:ä¿®æ”¹å·²ç»æ³¨å†Œçš„fdçš„ç›‘å¬äº‹ä»¶ã€EPOLL_CTL_DELï¼šä»epfdä¸­åˆ é™¤ä¸€ä¸ªfd)int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);//epoll_wait ç­‰å¾…äº‹ä»¶çš„äº§ç”Ÿï¼Œç±»ä¼¼äºselect()è°ƒç”¨ï¼Œæ ¹æ®å‚æ•°timeoutï¼Œæ¥å†³å®šæ˜¯å¦é˜»å¡ã€‚//è¿”å›å›æ¥çš„äº‹ä»¶éƒ½æ˜¯å°±ç»ªäº‹ä»¶ï¼Œä¸ç”¨åƒselectä¸€ä½ä¸€ä½æ£€æŸ¥æ˜¯å¦å°±ç»ªã€‚//int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>epoll_eventç»“æ„ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">struct epoll_event {    _unit32_t events; //Epoll events    epoll_data_t data // User data variable}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>eventså¯ä»¥æ˜¯ä»¥ä¸‹å‡ ä¸ªå®çš„é›†åˆï¼šè¡¨æ˜å¯¹å“ªç§äº‹ä»¶æ„Ÿå…´è¶£</p><p>EPOLLINï¼ˆè¯»äº‹ä»¶ï¼‰ã€EPOLLOUTã€EPOLLRPIã€EPOLLERRã€EPOLLHUPï¼ˆæŒ‚æ–­ï¼‰ã€EPOLLETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰ã€EPOLLONESHOTï¼ˆåªç›‘å¬ä¸€æ¬¡ï¼Œäº‹ä»¶è§¦å‘åè‡ªåŠ¨æ¸…é™¤è¯¥fdï¼Œä»epollåˆ—è¡¨ï¼‰ã€‚</p><p><strong>å·¥ä½œæ¨¡å¼ï¼š</strong></p><p>1.LTï¼ˆæ°´å¹³è§¦å‘ï¼‰å’ŒETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰ã€‚LTæ˜¯é»˜è®¤æ¨¡å¼ï¼ŒLTæ¨¡å¼ä¸ETæ¨¡å¼çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><p>LTï¼šäº‹ä»¶å°±ç»ªåï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å¤„ç†æˆ–è€…ä¸å¤„ç†ï¼Œå¦‚æœç”¨æˆ·æœ¬æ¬¡æœªå¤„ç†ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ä»ç„¶ä¼šå°†æœªå¤„ç†çš„äº‹ä»¶æ‰“åŒ…ç»™ä½ ã€‚</p><p>ETï¼šäº‹ä»¶å°±ç»ªåï¼Œç”¨æˆ·å¿…é¡»å¤„ç†ï¼Œå› ä¸ºå†…æ ¸ä¸ç»™ä½ å…œåº•äº†ï¼Œå†…æ ¸æŠŠå°±ç»ªäº‹ä»¶æ‰“åŒ…ç»™ä½ åï¼Œå°±æŠŠå¯¹åº”çš„å°±ç»ªäº‹ä»¶åˆ é™¤ã€‚</p><p>ETæ¨¡å¼å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†epolläº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡æ¯”LTæ¨¡å¼é«˜ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int epfd = epoll_create(10);struct epoll_event events[5];for (int i = 0; i &lt; 5; i++) {    static struct epoll_event ev;    memset(&amp;client, 0, sizeof(client));    addlen = sizeof(client);    ev.data.fd = accept(sockfd, (struct sockaddr*)&amp;client, &amp;addrlen);    ev.events = EPOLLIN;    epoll_ctl(epfd, EPOLL_CTL_ADD, ev.data.fd, &amp;ev);}while (1) {    print("round again");    nfds = epoll_wait(epfd, events, 5, 10000);    for (int i = 0; i &lt; nfds; i++) {        memset(buffer, 0, MAXBUF);        read(events[i].data.fd, buffer, MAXBUF);        prints(buffer);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>epollåŸç†</strong>:</p><p><img src="/2021/04/09/socket/epoll%E5%8E%9F%E7%90%86.PNG"></p><p>ç›‘å¬äº‹ä»¶åˆ—è¡¨æ˜¯ä¸ªçº¢é»‘æ ‘ï¼ŒåŠ å¿«å¯»æ‰¾é€Ÿåº¦ã€‚</p><p>ä½¿ç”¨ select æˆ–è€… poll ç­‰å¾…æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ç­‰å¾…å¤šä¸ªå¥—æ¥å­—ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜ä¸ºå¯è¯»ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šè¢«é˜»å¡ï¼Œå½“æŸä¸€ä¸ªå¥—æ¥å­—å¯è¯»æ—¶è¿”å›ï¼Œä¹‹åå†ä½¿ç”¨ recvfrom æŠŠæ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è¿›ç¨‹ä¸­ã€‚</p><p>å®ƒå¯ä»¥è®©å•ä¸ªè¿›ç¨‹å…·æœ‰å¤„ç†å¤šä¸ª I/O äº‹ä»¶çš„èƒ½åŠ›ã€‚åˆè¢«ç§°ä¸º Event Driven I/Oï¼Œå³äº‹ä»¶é©±åŠ¨ I/Oã€‚</p><p>å¦‚æœä¸€ä¸ª Web æœåŠ¡å™¨æ²¡æœ‰ I/O å¤ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª Socket è¿æ¥éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ã€‚å¦‚æœåŒæ—¶æœ‰å‡ ä¸‡ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºç›¸åŒæ•°é‡çš„çº¿ç¨‹ã€‚ç›¸æ¯”äºå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ï¼ŒI/O å¤ç”¨ä¸éœ€è¦è¿›ç¨‹çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€ï¼Œç³»ç»Ÿå¼€é”€æ›´å°ã€‚</p><p><img src="/2021/04/09/socket/1492929444818_6.png" alt="img"></p><p>åœºæ™¯ï¼šè®¾è®¡é«˜æ€§èƒ½æœåŠ¡å™¨ã€‚</p><h3 id="ä¿¡å·é©±åŠ¨-I-O"><a href="#ä¿¡å·é©±åŠ¨-I-O" class="headerlink" title="ä¿¡å·é©±åŠ¨ I/O"></a>ä¿¡å·é©±åŠ¨ I/O</h3><p>åº”ç”¨è¿›ç¨‹ä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éé˜»å¡çš„ã€‚å†…æ ¸åœ¨æ•°æ®åˆ°è¾¾æ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€ SIGIO ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹ååœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨ recvfrom å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ã€‚</p><p>ç›¸æ¯”äºéé˜»å¡å¼ I/O çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨ I/O çš„ CPU åˆ©ç”¨ç‡æ›´é«˜ã€‚</p><p><img src="/2021/04/09/socket/1492929553651_7.png" alt="img"></p><h3 id="å¼‚æ­¥-I-O"><a href="#å¼‚æ­¥-I-O" class="headerlink" title="å¼‚æ­¥ I/O"></a>å¼‚æ­¥ I/O</h3><p>åº”ç”¨è¿›ç¨‹æ‰§è¡Œ aio_read ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œå†…æ ¸ä¼šåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åå‘åº”ç”¨è¿›ç¨‹å‘é€ä¿¡å·ã€‚</p><p>å¼‚æ­¥ I/O ä¸ä¿¡å·é©±åŠ¨ I/O çš„åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡å·é©±åŠ¨ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹å¯ä»¥å¼€å§‹ I/Oã€‚</p><p><img src="/2021/04/09/socket/1492930243286_8.png" alt="img"></p><h3 id="äº”å¤§-I-O-æ¨¡å‹æ¯”è¾ƒ"><a href="#äº”å¤§-I-O-æ¨¡å‹æ¯”è¾ƒ" class="headerlink" title="äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒ"></a>äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒ</h3><ul><li>åŒæ­¥ I/Oï¼šå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºçš„é˜¶æ®µï¼ˆç¬¬äºŒé˜¶æ®µï¼‰ï¼Œåº”ç”¨è¿›ç¨‹ä¼šé˜»å¡ã€‚</li><li>å¼‚æ­¥ I/Oï¼šç¬¬äºŒé˜¶æ®µåº”ç”¨è¿›ç¨‹ä¸ä¼šé˜»å¡ã€‚</li></ul><p>åŒæ­¥ I/O åŒ…æ‹¬é˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/O ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚</p><p>éé˜»å¡å¼ I/O ã€ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/O åœ¨ç¬¬ä¸€é˜¶æ®µä¸ä¼šé˜»å¡ã€‚</p><p><img src="/2021/04/09/socket/1492928105791_3.png" alt="img"></p><h2 id="äºŒã€I-O-å¤ç”¨"><a href="#äºŒã€I-O-å¤ç”¨" class="headerlink" title="äºŒã€I/O å¤ç”¨"></a>äºŒã€I/O å¤ç”¨</h2><p>select/poll/epoll éƒ½æ˜¯ I/O å¤šè·¯å¤ç”¨çš„å…·ä½“å®ç°ï¼Œselect å‡ºç°çš„æœ€æ—©ï¼Œä¹‹åæ˜¯ pollï¼Œå†æ˜¯ epollã€‚</p><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>readfds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>writefds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>exceptfds<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">timeval</span> <span class="token operator">*</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>select å…è®¸åº”ç”¨ç¨‹åºç›‘è§†ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ï¼Œç­‰å¾…ä¸€ä¸ªæˆ–è€…å¤šä¸ªæè¿°ç¬¦æˆä¸ºå°±ç»ªçŠ¶æ€ï¼Œä»è€Œå®Œæˆ I/O æ“ä½œã€‚</p><ul><li>fd_set ä½¿ç”¨æ•°ç»„å®ç°ï¼Œæ•°ç»„å¤§å°ä½¿ç”¨ FD_SETSIZE å®šä¹‰ï¼Œæ‰€ä»¥åªèƒ½ç›‘å¬å°‘äº FD_SETSIZE æ•°é‡çš„æè¿°ç¬¦ã€‚æœ‰ä¸‰ç§ç±»å‹çš„æè¿°ç¬¦ç±»å‹ï¼šreadsetã€writesetã€exceptsetï¼Œåˆ†åˆ«å¯¹åº”è¯»ã€å†™ã€å¼‚å¸¸æ¡ä»¶çš„æè¿°ç¬¦é›†åˆã€‚</li><li>timeout ä¸ºè¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ select ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰æè¿°ç¬¦çš„äº‹ä»¶åˆ°è¾¾æˆ–è€…ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ timeoutã€‚</li><li>æˆåŠŸè°ƒç”¨è¿”å›ç»“æœå¤§äº 0ï¼Œå‡ºé”™è¿”å›ç»“æœä¸º -1ï¼Œè¶…æ—¶è¿”å›ç»“æœä¸º 0ã€‚</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c">fd_set fd_in<span class="token punctuation">,</span> fd_out<span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span><span class="token comment">// Reset the sets</span><span class="token function">FD_ZERO</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>fd_in <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">FD_ZERO</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>fd_out <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Monitor sock1 for input events</span><span class="token function">FD_SET</span><span class="token punctuation">(</span> sock1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fd_in <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Monitor sock2 for output events</span><span class="token function">FD_SET</span><span class="token punctuation">(</span> sock2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fd_out <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Find out which socket has the largest numeric value as select requires it</span><span class="token keyword">int</span> largest_sock <span class="token operator">=</span> sock1 <span class="token operator">&gt;</span> sock2 <span class="token operator">?</span> sock1 <span class="token operator">:</span> sock2<span class="token punctuation">;</span><span class="token comment">// Wait up to 10 seconds</span>tv<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>tv<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// Call the select</span><span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span> largest_sock <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fd_in<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fd_out<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>tv <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Check if select actually succeed</span><span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span>    <span class="token comment">// report error and abort</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>    <span class="token comment">// timeout; no event detected</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">FD_ISSET</span><span class="token punctuation">(</span> sock1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fd_in <span class="token punctuation">)</span> <span class="token punctuation">)</span>        <span class="token comment">// input event on sock1</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">FD_ISSET</span><span class="token punctuation">(</span> sock2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fd_out <span class="token punctuation">)</span> <span class="token punctuation">)</span>        <span class="token comment">// output event on sock2</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">poll</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">pollfd</span> <span class="token operator">*</span>fds<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nfds<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>poll çš„åŠŸèƒ½ä¸ select ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç­‰å¾…ä¸€ç»„æè¿°ç¬¦ä¸­çš„ä¸€ä¸ªæˆä¸ºå°±ç»ªçŠ¶æ€ã€‚</p><p>poll ä¸­çš„æè¿°ç¬¦æ˜¯ pollfd ç±»å‹çš„æ•°ç»„ï¼Œpollfd çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">pollfd</span> <span class="token punctuation">{</span>               <span class="token keyword">int</span>   fd<span class="token punctuation">;</span>         <span class="token comment">/* file descriptor */</span>               <span class="token keyword">short</span> events<span class="token punctuation">;</span>     <span class="token comment">/* requested events */</span>               <span class="token keyword">short</span> revents<span class="token punctuation">;</span>    <span class="token comment">/* returned events */</span>           <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// The structure for two events</span><span class="token keyword">struct</span> <span class="token class-name">pollfd</span> fds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// Monitor sock1 for input</span>fds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> sock1<span class="token punctuation">;</span>fds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">=</span> POLLIN<span class="token punctuation">;</span><span class="token comment">// Monitor sock2 for output</span>fds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> sock2<span class="token punctuation">;</span>fds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">=</span> POLLOUT<span class="token punctuation">;</span><span class="token comment">// Wait 10 seconds</span><span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">poll</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>fds<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Check if poll actually succeed</span><span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span>    <span class="token comment">// report error and abort</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>    <span class="token comment">// timeout; no event detected</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token comment">// If we detect the event, zero it out so we can reuse the structure</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> fds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>revents <span class="token operator">&amp;</span> POLLIN <span class="token punctuation">)</span>        fds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>revents <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">// input event on sock1</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> fds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>revents <span class="token operator">&amp;</span> POLLOUT <span class="token punctuation">)</span>        fds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>revents <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">// output event on sock2</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h3><h4 id="1-åŠŸèƒ½"><a href="#1-åŠŸèƒ½" class="headerlink" title="1. åŠŸèƒ½"></a>1. åŠŸèƒ½</h4><p>select å’Œ poll çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä¸è¿‡åœ¨ä¸€äº›å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚</p><ul><li>select ä¼šä¿®æ”¹æè¿°ç¬¦ï¼Œè€Œ poll ä¸ä¼šï¼›</li><li>select çš„æè¿°ç¬¦ç±»å‹ä½¿ç”¨æ•°ç»„å®ç°ï¼ŒFD_SETSIZE å¤§å°é»˜è®¤ä¸º 1024ï¼Œå› æ­¤é»˜è®¤åªèƒ½ç›‘å¬å°‘äº 1024 ä¸ªæè¿°ç¬¦ã€‚å¦‚æœè¦ç›‘å¬æ›´å¤šæè¿°ç¬¦çš„è¯ï¼Œéœ€è¦ä¿®æ”¹ FD_SETSIZE ä¹‹åé‡æ–°ç¼–è¯‘ï¼›è€Œ poll æ²¡æœ‰æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼›</li><li>poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ä¸”å¯¹æè¿°ç¬¦çš„é‡å¤åˆ©ç”¨ä¸Šæ¯” select é«˜ã€‚</li><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªæè¿°ç¬¦è°ƒç”¨äº† select æˆ–è€… pollï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†è¯¥æè¿°ç¬¦ï¼Œä¼šå¯¼è‡´è°ƒç”¨ç»“æœä¸ç¡®å®šã€‚</li></ul><h4 id="2-é€Ÿåº¦"><a href="#2-é€Ÿåº¦" class="headerlink" title="2. é€Ÿåº¦"></a>2. é€Ÿåº¦</h4><p>select å’Œ poll é€Ÿåº¦éƒ½æ¯”è¾ƒæ…¢ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å°†å…¨éƒ¨æè¿°ç¬¦ä»åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºã€‚</p><h4 id="3-å¯ç§»æ¤æ€§"><a href="#3-å¯ç§»æ¤æ€§" class="headerlink" title="3. å¯ç§»æ¤æ€§"></a>3. å¯ç§»æ¤æ€§</h4><p>å‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¾ƒæ–°çš„ç³»ç»Ÿæ”¯æŒ pollã€‚</p><h3 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">epoll_create</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">epoll_ctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> epfd<span class="token punctuation">,</span> <span class="token keyword">int</span> op<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> <span class="token operator">*</span>event<span class="token punctuation">)</span>ï¼›<span class="token keyword">int</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span><span class="token keyword">int</span> epfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> <span class="token operator">*</span> events<span class="token punctuation">,</span> <span class="token keyword">int</span> maxevents<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>epoll_ctl() ç”¨äºå‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Šï¼Œé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°† I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ç®¡ç†ï¼Œè¿›ç¨‹è°ƒç”¨ epoll_wait() ä¾¿å¯ä»¥å¾—åˆ°äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚</p><p>ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œepoll åªéœ€è¦å°†æè¿°ç¬¦ä»è¿›ç¨‹ç¼“å†²åŒºå‘å†…æ ¸ç¼“å†²åŒºæ‹·è´ä¸€æ¬¡ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸éœ€è¦é€šè¿‡è½®è¯¢æ¥è·å¾—äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚</p><p>epoll ä»…é€‚ç”¨äº Linux OSã€‚</p><p>epoll æ¯” select å’Œ poll æ›´åŠ çµæ´»è€Œä¸”æ²¡æœ‰æè¿°ç¬¦æ•°é‡é™åˆ¶ã€‚</p><p>epoll å¯¹å¤šçº¿ç¨‹ç¼–ç¨‹æ›´æœ‰å‹å¥½ï¼Œä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† epoll_wait() å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†åŒä¸€ä¸ªæè¿°ç¬¦ä¹Ÿä¸ä¼šäº§ç”Ÿåƒ select å’Œ poll çš„ä¸ç¡®å®šæƒ…å†µã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// Create the epoll descriptor. Only one is needed per app, and is used to monitor all sockets.</span><span class="token comment">// The function argument is ignored (it was not before, but now it is), so put your favorite number here</span><span class="token keyword">int</span> pollingfd <span class="token operator">=</span> <span class="token function">epoll_create</span><span class="token punctuation">(</span> <span class="token number">0xCAFE</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> pollingfd <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token comment">// report error</span><span class="token comment">// Initialize the epoll structure in case more members are added in future</span><span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> ev <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// Associate the connection class instance with the event. You can associate anything</span><span class="token comment">// you want, epoll does not use this information. We store a connection class pointer, pConnection1</span>ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ptr <span class="token operator">=</span> pConnection1<span class="token punctuation">;</span><span class="token comment">// Monitor for input, and do not automatically rearm the descriptor after the event</span>ev<span class="token punctuation">.</span>events <span class="token operator">=</span> EPOLLIN <span class="token operator">|</span> EPOLLONESHOT<span class="token punctuation">;</span><span class="token comment">// Add the descriptor into the monitoring list. We can do it even if another thread is</span><span class="token comment">// waiting in epoll_wait - the descriptor will be properly added</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">epoll_ctl</span><span class="token punctuation">(</span> epollfd<span class="token punctuation">,</span> EPOLL_CTL_ADD<span class="token punctuation">,</span> pConnection1<span class="token operator">-&gt;</span><span class="token function">getSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ev <span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>    <span class="token comment">// report error</span><span class="token comment">// Wait for up to 20 events (assuming we have added maybe 200 sockets before that it may happen)</span><span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> pevents<span class="token punctuation">[</span> <span class="token number">20</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// Wait for 10 seconds, and retrieve less than 20 epoll_event and store them into epoll_event array</span><span class="token keyword">int</span> ready <span class="token operator">=</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span> pollingfd<span class="token punctuation">,</span> pevents<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Check if epoll actually succeed</span><span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span>    <span class="token comment">// report error and abort</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>    <span class="token comment">// timeout; no event detected</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token comment">// Check if any events detected</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ready<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> pevents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">&amp;</span> EPOLLIN <span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token comment">// Get back our connection pointer</span>            Connection <span class="token operator">*</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>Connection<span class="token operator">*</span><span class="token punctuation">)</span> pevents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>ptr<span class="token punctuation">;</span>            c<span class="token operator">-&gt;</span><span class="token function">handleReadEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å·¥ä½œæ¨¡å¼"><a href="#å·¥ä½œæ¨¡å¼" class="headerlink" title="å·¥ä½œæ¨¡å¼"></a>å·¥ä½œæ¨¡å¼</h3><p>epoll çš„æè¿°ç¬¦äº‹ä»¶æœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚</p><h4 id="1-LT-æ¨¡å¼"><a href="#1-LT-æ¨¡å¼" class="headerlink" title="1. LT æ¨¡å¼"></a>1. LT æ¨¡å¼</h4><p>å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œå°†æ­¤äº‹ä»¶é€šçŸ¥è¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() ä¼šå†æ¬¡é€šçŸ¥è¿›ç¨‹ã€‚æ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blockingã€‚</p><h4 id="2-ET-æ¨¡å¼"><a href="#2-ET-æ¨¡å¼" class="headerlink" title="2. ET æ¨¡å¼"></a>2. ET æ¨¡å¼</h4><p>å’Œ LT æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œé€šçŸ¥ä¹‹åè¿›ç¨‹å¿…é¡»ç«‹å³å¤„ç†äº‹ä»¶ï¼Œä¸‹æ¬¡å†è°ƒç”¨ epoll_wait() æ—¶ä¸ä¼šå†å¾—åˆ°äº‹ä»¶åˆ°è¾¾çš„é€šçŸ¥ã€‚</p><p>å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚</p><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ç§é”™è§‰è®¤ä¸ºåªè¦ç”¨ epoll å°±å¯ä»¥äº†ï¼Œselect å’Œ poll éƒ½å·²ç»è¿‡æ—¶äº†ï¼Œå…¶å®å®ƒä»¬éƒ½æœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ã€‚</p><h4 id="1-select-åº”ç”¨åœºæ™¯"><a href="#1-select-åº”ç”¨åœºæ™¯" class="headerlink" title="1. select åº”ç”¨åœºæ™¯"></a>1. select åº”ç”¨åœºæ™¯</h4><p>select çš„ timeout å‚æ•°ç²¾åº¦ä¸ºå¾®ç§’ï¼Œè€Œ poll å’Œ epoll ä¸ºæ¯«ç§’ï¼Œå› æ­¤ select æ›´åŠ é€‚ç”¨äºå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æ§åˆ¶ã€‚</p><p>select å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚</p><h4 id="2-poll-åº”ç”¨åœºæ™¯"><a href="#2-poll-åº”ç”¨åœºæ™¯" class="headerlink" title="2. poll åº”ç”¨åœºæ™¯"></a>2. poll åº”ç”¨åœºæ™¯</h4><p>poll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æœå¹³å°æ”¯æŒå¹¶ä¸”å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œåº”è¯¥ä½¿ç”¨ poll è€Œä¸æ˜¯ selectã€‚</p><h4 id="3-epoll-åº”ç”¨åœºæ™¯"><a href="#3-epoll-åº”ç”¨åœºæ™¯" class="headerlink" title="3. epoll åº”ç”¨åœºæ™¯"></a>3. epoll åº”ç”¨åœºæ™¯</h4><p>åªéœ€è¦è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œå¹¶ä¸”è¿™äº›è¿æ¥æœ€å¥½æ˜¯é•¿è¿æ¥ã€‚</p><p>éœ€è¦åŒæ—¶ç›‘æ§å°äº 1000 ä¸ªæè¿°ç¬¦ï¼Œå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“ç° epoll çš„ä¼˜åŠ¿ã€‚</p><p>éœ€è¦ç›‘æ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éå¸¸çŸ­æš‚çš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ä½¿ç”¨ epollã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½æ•ˆç‡ã€‚å¹¶ä¸” epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•ã€‚</p><h1 id="ä¸‰ã€-linux-ç½‘ç»œç›‘æ§"><a href="#ä¸‰ã€-linux-ç½‘ç»œç›‘æ§" class="headerlink" title="ä¸‰ã€ linux ç½‘ç»œç›‘æ§"></a>ä¸‰ã€ linux ç½‘ç»œç›‘æ§</h1><h3 id="3-1-netstat-å’Œ-ss-çš„åŸç†"><a href="#3-1-netstat-å’Œ-ss-çš„åŸç†" class="headerlink" title="3.1 netstat å’Œ ss çš„åŸç†"></a>3.1 netstat å’Œ ss çš„åŸç†</h3><p>ssæ¯”netstatå¿«çš„ä¸»è¦åŸå› æ˜¯ï¼Œnetstatæ˜¯éå†/procä¸‹é¢æ¯ä¸ªPIDç›®å½•ï¼Œssç›´æ¥è¯»/proc/netä¸‹é¢çš„ç»Ÿè®¡ä¿¡æ¯ã€‚æ‰€ä»¥ssæ‰§è¡Œçš„æ—¶å€™æ¶ˆè€—èµ„æºä»¥åŠæ¶ˆè€—çš„æ—¶é—´éƒ½æ¯”netstatå°‘å¾ˆå¤šã€‚</p><p>å½“æœåŠ¡å™¨çš„socketè¿æ¥æ•°é‡éå¸¸å¤§æ—¶ï¼ˆå¦‚ä¸Šä¸‡ä¸ªï¼‰ï¼Œæ— è®ºæ˜¯ä½¿ç”¨netstatå‘½ä»¤è¿˜æ˜¯ç›´æ¥cat /proc/net/tcpæ‰§è¡Œé€Ÿåº¦éƒ½ä¼šå¾ˆæ…¢ï¼Œç›¸æ¯”ä¹‹ä¸‹sså¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚sså¿«çš„ç§˜è¯€åœ¨äºï¼Œå®ƒåˆ©ç”¨äº†TCPåè®®æ ˆä¸­tcp_diagï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ†æç»Ÿè®¡çš„æ¨¡å—ï¼Œå¯ä»¥è·å¾—Linuxå†…æ ¸ä¸­çš„ç¬¬ä¸€æ‰‹ä¿¡æ¯ã€‚å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰tcp_diagï¼Œssä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯æ•ˆç‡ä¼šå˜å¾—ç¨å¾®æ…¢ä½†ä»ç„¶æ¯”netstatè¦å¿«ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python+flask</title>
      <link href="2021/04/08/python-flask/"/>
      <url>2021/04/08/python-flask/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>RedisåŸºç¡€</title>
      <link href="2021/04/06/redis-ji-chu/"/>
      <url>2021/04/06/redis-ji-chu/</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p><a href="https://www.linuxidc.com/topicnews.aspx?tid=22">Redis</a> (è¿œç¨‹å­—å…¸æœåŠ¡å™¨Remote Dictionary Server)æ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜æ•°æ®åº“ï¼Œç”¨ä½œç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ã€‚å®ƒä¸å…¶ä»–ä¸»è¦æ•°æ®åº“çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒèƒ½å¤Ÿå­˜å‚¨é«˜çº§æ•°æ®ç±»å‹ï¼ˆåŒ…æ‹¬åœ°å›¾ï¼Œåˆ—è¡¨ï¼Œé›†åˆç­‰ï¼‰ï¼Œæ˜“äºä½¿ç”¨çš„ç•Œé¢ï¼Œå¯¹æ•°æ®è¿›è¡ŒåŸå­æ“ä½œä»¥åŠå…¶ä»–äººæ— æ³•æ‰¾åˆ°çš„å‡ºè‰²æ€§èƒ½ç°æœ‰æ•°æ®åº“ã€‚</p><p>è¿™å°±æ˜¯åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨<a href="https://www.linuxidc.com/topicnews.aspx?tid=2">Ubuntu</a> 18.04ä¸Šå®‰è£…Redisã€‚</p><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Redisï¼Ÿ</p><p>å¦‚ä¸Šæ‰€è¿°ï¼ŒRedisçš„æ€§èƒ½å’Œå“è¶ŠåŠŸèƒ½ä½¿å…¶æ¯”ä¼ ç»Ÿæ•°æ®åº“æ›´å¥½ã€‚ Redisçš„å…¸å‹ç”¨æ³•æ˜¯ï¼š</p><ul><li>ç¼“å­˜â€“å…¶å¢å¼ºçš„æ•°æ®æŒä¹…å­˜å‚¨åˆ°ç£ç›˜çš„èƒ½åŠ›ä½¿å…¶æˆä¸ºä¼ ç»Ÿç¼“å­˜è§£å†³æ–¹æ¡ˆçš„ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©</li><li>é˜Ÿåˆ—â€“ Rediså¯ç”¨äºåœ¨åå°å¯¹ä½œä¸šè¿›è¡Œæ’é˜Ÿã€‚</li><li>æ•°å™¨-Rediså…è®¸ç®€å•åœ°åˆ›å»ºå’Œå®ç°è®¡æ•°å™¨ï¼Œè€Œæ— éœ€è¯»å–æ•°æ®æˆ–æ›´æ–°æ•°æ®åº“çš„æ–¹æ¡ˆã€‚ Redisä¸­çš„è®¡æ•°å™¨å°†ä¿æŒä¸€è‡´</li><li>å‘å¸ƒå’Œè®¢é˜…â€“ç”¨æˆ·å¯ä»¥ä½¿ç”¨â€œå‘å¸ƒ/è®¢é˜…â€èŒƒå¼è½»æ¾åˆ†å‘æ•°æ®</li></ul><p><strong>å¦‚ä½•åœ¨Ubuntuä¸Šå®‰è£…Redisï¼Ÿ</strong></p><p>Rediså­˜åœ¨äºUbuntuçš„å®˜æ–¹è½¯ä»¶åŒ…å­˜å‚¨åº“ä¸­ã€‚ç°åœ¨è®©æˆ‘ä»¬åœ¨Ubuntuä¸Šå®‰è£…Redisï¼š</p><p>1ã€æ›´æ–°APTå­˜å‚¨åº“ç¼“å­˜</p><p>ä¸ºäº†å®‰è£…Redisï¼Œé¦–å…ˆéœ€è¦æ›´æ–°Ubuntuçš„APTå­˜å‚¨åº“ç¼“å­˜ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ“ä½œï¼š</p><p>[linuxidc@linux:~/<a href="http://www.linuxidc.com]$">www.linuxidc.com]$</a> <code>sudo apt update</code></p><p>2ã€ä½¿ç”¨APTå‘½ä»¤åœ¨Ubuntuä¸Šå®‰è£…Redis</p><p>[linuxidc@linux:~/<a href="http://www.linuxidc.com]$">www.linuxidc.com]$</a> <code>sudo apt install redis</code></p><p><img src="/2021/04/06/redis-ji-chu/1\blog\source_posts\RedisåŸºç¡€\20031721526433.png" alt="å¦‚ä½•åœ¨Ubuntu 18.04ä¸Šå®‰è£…å’Œé…ç½®Redis"></p><p>æŒ‰yï¼Œç„¶åæŒ‰Enteré”®ç»§ç»­ã€‚</p><p>3ã€æ£€æŸ¥Redisç‰ˆæœ¬</p><p>ä¸ºäº†æ£€æŸ¥Redisæ˜¯å¦æ­£ç¡®å®‰è£…å¹¶æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><p>[linuxidc@linux:~/<a href="http://www.linuxidc.com]$">www.linuxidc.com]$</a> redis-cli â€“version</p><p><img src="/2021/04/06/redis-ji-chu/1\blog\source_posts\RedisåŸºç¡€\20031721522504.png" alt="å¦‚ä½•åœ¨Ubuntu 18.04ä¸Šå®‰è£…å’Œé…ç½®Redis"></p><p>è¾“å‡ºå°†æ˜¾ç¤ºè®¡ç®—æœºä¸Šå½“å‰å®‰è£…çš„å®ç”¨ç¨‹åºçš„ç‰ˆæœ¬ã€‚</p><p><strong>å¯åŠ¨å’Œåœæ­¢Redis</strong></p><p>å®Œæˆå®‰è£…åï¼Œå¯ä»¥æ£€æŸ¥Redisæ˜¯å¦æ­£åœ¨è¿è¡Œã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œæ­¤æ“ä½œï¼š</p><p>[linuxidc@linux:~/<a href="http://www.linuxidc.com]$">www.linuxidc.com]$</a> sudo systemctl status redis</p><p>In the output, locate Active: active (running).</p><p>åœ¨è¾“å‡ºä¸­ï¼Œæ‰¾åˆ°â€œ Active**: active (running)**â€œã€‚</p><p><img src="/2021/04/06/redis-ji-chu/1\blog\source_posts\RedisåŸºç¡€\20031721521984.png" alt="å¦‚ä½•åœ¨Ubuntu 18.04ä¸Šå®‰è£…å’Œé…ç½®Redis"></p><p>å¦‚æœå°šæœªå¯åŠ¨Redisï¼Œåˆ™å¯ä»¥é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨å®ƒï¼š</p><p>[linuxidc@linux:~/<a href="http://www.linuxidc.com]$">www.linuxidc.com]$</a> <code>sudo systemctl start redis-server</code></p><p>å¦‚æœRediså·²ç»åœ¨è¿è¡Œå¹¶ä¸”è¦åœæ­¢å®ƒï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><p>[linuxidc@linux:~/<a href="http://www.linuxidc.com]$">www.linuxidc.com]$</a> <code>sudo systemctl stop redis</code></p><p>æ­¤åï¼Œæ‚¨å°†åœ¨æœ¬èŠ‚ä¸­ç¬¬ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä¸­çœ‹åˆ°â€œ<strong>Active: inactive (dead)</strong> â€ã€‚</p><p><img src="/2021/04/06/redis-ji-chu/1\blog\source_posts\RedisåŸºç¡€\20031721524836.png" alt="å¦‚ä½•åœ¨Ubuntu 18.04ä¸Šå®‰è£…å’Œé…ç½®Redis"></p><p><strong>å¦‚ä½•åœ¨Ubuntuä¸Šé…ç½®RedisæœåŠ¡å™¨</strong></p><p>Redisçš„é»˜è®¤é…ç½®ä½äº/etc/redis/redis.confä¸­ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¾¦å¬æ¥è‡ªæœåŠ¡å™¨ä¸Šæ‰€æœ‰å¯ç”¨æ¥å£çš„è¿æ¥ã€‚ æ‚¨å¯ä»¥è®©å®ƒä¾¦å¬æ‚¨é€‰æ‹©çš„æ¥å£ï¼Œæ ¹æ®éœ€è¦å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚ è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ç»‘å®šé…ç½®æŒ‡ä»¤æ¥å®Œæˆï¼Œè¯¥æŒ‡ä»¤åè·Ÿä¸€ä¸ªæˆ–å¤šä¸ªIPåœ°å€ã€‚</p><p>è¦æŒ‡ç¤ºRedisæœåŠ¡å™¨ä¾¦å¬ç‰¹å®šçš„IPåœ°å€ï¼Œæ‚¨éœ€è¦ç¼–è¾‘/etc/redis/redis.confæ–‡ä»¶ã€‚ ç”¨æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€å®ƒã€‚ æˆ‘ä»¬å°†ä½¿ç”¨viã€‚ æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€æ–‡ä»¶ï¼š</p><p><code>sudo vim /etc/redis/redis.conf</code></p><p>æ‰¾åˆ° <code>bind 127.0.0.1 ::1</code></p><p><img src="/2021/04/06/redis-ji-chu/1\blog\source_posts\RedisåŸºç¡€\20031721539592.png" alt="å¦‚ä½•åœ¨Ubuntu 18.04ä¸Šå®‰è£…å’Œé…ç½®Redis"></p><p>ç°åœ¨ï¼Œé€šè¿‡è¾“å…¥æ‚¨å¸Œæœ›RedisæœåŠ¡å™¨ç›‘å¬çš„æ¥å£çš„å€¼æ¥æ›´æ”¹IPåœ°å€ã€‚ ä¾‹å¦‚ï¼š</p><p>bind 192.168.213.135</p><p>å¦‚æœæ‚¨æƒ³æ·»åŠ å¤šä¸ªIPåœ°å€ï¼Œåªéœ€å°†å®ƒä»¬ç”¨ç©ºæ ¼éš”å¼€å³å¯ï¼š</p><p>bind 192.168.213.135 192.168.213.136</p><p>åœ¨è¿™é‡Œæ‚¨éœ€è¦è¾“å…¥è‡ªå·±ç½‘ç»œçš„IPåœ°å€ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœå¸Œæœ›æœåŠ¡å™¨ä¾¦å¬ç½‘ç»œä¸Šçš„æ‰€æœ‰æ¥å£ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><p><code>bind 0.0.0.0</code></p><p>å®Œæˆæ›´æ”¹åï¼Œä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚ åœ¨vimä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç‚¹å‡»ï¼šå¹¶æ‰§è¡Œwq!æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ ç„¶åé‡æ–°å¯åŠ¨RedisæœåŠ¡å™¨ä»¥åº”ç”¨æ›´æ”¹ã€‚ é‡æ–°å¯åŠ¨çš„å‘½ä»¤æ˜¯ï¼š</p><p><code>sudo systemctl restart redis-server</code></p><h2 id="1-NoSQL-æ•°æ®æ¨¡å‹"><a href="#1-NoSQL-æ•°æ®æ¨¡å‹" class="headerlink" title="1. NoSQL æ•°æ®æ¨¡å‹"></a>1. NoSQL æ•°æ®æ¨¡å‹</h2><h3 id="1-1èšåˆæ¨¡å‹"><a href="#1-1èšåˆæ¨¡å‹" class="headerlink" title="1.1èšåˆæ¨¡å‹"></a>1.1èšåˆæ¨¡å‹</h3><ol><li>KVé”®å€¼</li><li>Bson</li><li>åˆ—æ— ï¼ˆåˆ—çš„å½¢å¼æ‰©å±•ï¼‰</li><li>å›¾å½¢ ï¼ˆç½‘ç»œç»“æ„ï¼‰</li></ol><h3 id="1-2-å››å¤§åˆ†ç±»"><a href="#1-2-å››å¤§åˆ†ç±»" class="headerlink" title="1.2 å››å¤§åˆ†ç±»"></a>1.2 å››å¤§åˆ†ç±»</h3><ol><li><p>KVé”®å€¼</p></li><li><p>æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆbsonæ ¼å¼æ¯”è¾ƒå¤šï¼‰</p><ol><li><p>CouchDB</p></li><li><p>MongoDB</p><p>åŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ã€‚ç”±C++è¯­è¨€ç¼–å†™ï¼Œæ—¨åœ¨ä¸ºWEBåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚MongoDBæ˜¯ä¸€ä¸ªä»‹äºå…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´çš„äº§å“ï¼Œæ˜¯éå…³ç³»æ•°æ®åº“å½“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒå…³ç³»æ•°æ®åº“çš„ã€‚</p></li></ol></li><li><p>åˆ—å­˜å‚¨æ•°æ®åº“</p><ol><li>Cassandra,HBase</li><li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</li></ol></li><li><p>å›¾å…³ç³»æ•°æ®åº“</p><ol><li>Neo4J,InfoGrid</li><li>ä¸æ˜¯æ”¾å›¾å½¢çš„ï¼Œæ”¾çš„æ˜¯å…³ç³»æ¯”å¦‚ï¼šæœ‹å‹åœˆç¤¾äº¤ç½‘ç»œã€å¹¿å‘Šæ¨èç³»ç»Ÿã€‚æ„å»ºå…³ç³»å›¾è°±ã€‚</li></ol></li></ol><h3 id="1-3-CAP-BASE"><a href="#1-3-CAP-BASE" class="headerlink" title="1.3 CAP + BASE"></a>1.3 CAP + BASE</h3><p>Cï¼šConsistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰</p><p>Aï¼šAvailabilityï¼ˆå¯ç”¨æ€§ï¼‰</p><p>Pï¼šPartition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</p><p>ä¸‰é€‰äºŒã€‚åœ¨åˆ†å¸ƒå¼ä¸­ï¼ŒPæ˜¯å¿…é¡»è¦å®ç°çš„ã€‚</p><p><img src="/2021/04/06/redis-ji-chu/CAP.PNG"></p><p><strong>BASE</strong>ï¼šä¸ºäº†è§£å†³å…³ç³»æ•°æ®åº“å¼ºä¸€è‡´æ€§å¼•èµ·çš„é—®é¢˜è€Œå¼•èµ·çš„å¯ç”¨æ€§é™ä½è€Œæå‡ºçš„è§£å†³æ–¹æ¡ˆã€‚</p><p>åŸºæœ¬å¯ç”¨(Basically Available)</p><p>è½¯çŠ¶æ€(Soft state)</p><p>æœ€ç»ˆä¸€è‡´(Eventually consistent)</p><p>å®ƒçš„æ€æƒ³æ˜¯é€šè¿‡è®©ç³»ç»Ÿæ”¾æ¾å¯¹æŸä¸€æ—¶åˆ»æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚æ¥æ¢å–ç³»ç»Ÿæ•´ä½“ä¼¸ç¼©æ€§å’Œæ€§èƒ½ä¸Šæ”¹è§‚ã€‚ç¼˜ç”±å°±åœ¨äºå¤§å‹ç³»ç»Ÿå¾€å¾€ç”±äºåœ°åŸŸåˆ†å¸ƒå’Œæé«˜æ€§èƒ½çš„è¦æ±‚ï¼Œä¸å¯èƒ½é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥å®Œæˆè¿™äº›æŒ‡æ ‡ï¼Œè¦æƒ³è·å¾—è¿™äº›æŒ‡æ ‡ï¼Œbaseæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="1-benchmark-æ€§èƒ½æµ‹è¯•"><a href="#1-benchmark-æ€§èƒ½æµ‹è¯•" class="headerlink" title="1. benchmark æ€§èƒ½æµ‹è¯•"></a>1. benchmark æ€§èƒ½æµ‹è¯•</h2><p><img src="/2021/04/06/redis-ji-chu/redis%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%8F%82%E6%95%B0.PNG"></p><h2 id="2-åŸºç¡€"><a href="#2-åŸºç¡€" class="headerlink" title="2. åŸºç¡€"></a>2. åŸºç¡€</h2><p>Redisé»˜è®¤16ä¸ªæ•°æ®åº“ã€‚é»˜è®¤ä½¿ç”¨ç¬¬0ä¸ªæ•°æ®åº“ã€‚</p><p>Redisæ˜¯å•çº¿ç¨‹çš„ï¼ŒRedisæ˜¯åŸºäºå†…å­˜æ“ä½œï¼ŒCPUä¸æ˜¯Redisæ€§èƒ½ç“¶é¢ˆï¼ŒRedisçš„ç“¶é¢ˆæ˜¯æ ¹æ®æœºå™¨çš„å†…å­˜å’Œç½‘ç»œå¸¦å®½ï¼Œæ—¢ç„¶å¯ä»¥ä½¿ç”¨å•çº¿ç¨‹ï¼Œå°±æ˜¯ç”¨äº†å•çº¿ç¨‹ã€‚</p><p>Redisæ˜¯cè¯­è¨€å†™çš„ï¼Œå®˜æ–¹æä¾›çš„æ•°æ®æ˜¯100000+çš„QPSï¼Œè¿™ä¸ªä¸æ¯”Memecacheå·®ï¼</p><h3 id="2-1-Redisæ•°æ®ç±»å‹"><a href="#2-1-Redisæ•°æ®ç±»å‹" class="headerlink" title="2.1 Redisæ•°æ®ç±»å‹"></a>2.1 Redisæ•°æ®ç±»å‹</h3><ol><li>Stringçš„åº”ç”¨åœºæ™¯ï¼š</li></ol><p>å•†å“ç¼–å·ã€è®¢å•å·å¯ä»¥ä½¿ç”¨INCR KEY è¿™ä¸ªå‘½ä»¤ç”Ÿæˆ</p><p>æ˜¯å¦å–œæ¬¢æŸä¸ªæ–‡ç« ï¼Œç‚¹ä¸€ä¸‹åŠ ä¸ª1ã€‚</p><p>åˆ†å¸ƒå¼é”ï¼š setnx key value </p><ol start="2"><li>hashçš„åº”ç”¨åœºæ™¯ï¼š</li></ol><p>hash å¯¹åº” javaä¸­çš„ map&lt;String, map&lt;object, object&gt;&gt;</p><p>è´­ç‰©è½¦ï¼šç‚¹å‡»è´­ä¹°æ•°é‡ï¼Œå¯¹æŸä¸ªé”®çš„å€¼åŠ 1ã€‚</p><p>æ–°å¢å•†å“å°±ç›´æ¥hset KVå³å¯ã€‚</p><p>å…¨éƒ¨é€‰æ‹© hgetAllå³å¯ã€‚</p><ol start="3"><li>list</li></ol><p>å¾®ä¿¡å…¬ä¼—å· è®¢é˜…å…¬ä¼—å·ã€‚è°è®¢é˜…äº†æˆ‘ï¼Œé‚£ä¹ˆå°±åŠ è¿›listã€‚</p><p>å–œæ¬¢çš„æ–‡ç« åˆ—è¡¨å•¥çš„ã€‚</p><ol start="4"><li>set</li></ol><p>å¾®ä¿¡æŠ½å¥–å°ç¨‹åº æŠ½å–ä¸€ä¸ªå¹¸è¿ç”¨æˆ·ã€‚ srandmember set 1 æŠ½å–ä¸€ä¸ªã€‚ Scard len çœ‹å‡ ä¸ªäººå‚ä¸æŠ½å¥–ã€‚SPOP key 3 å…ƒç´ åˆ é™¤ã€‚</p><p>å¾®ä¿¡æœ‹å‹åœˆç‚¹èµ ç‚¹èµçš„å°±åŠ åˆ°seté›†åˆé‡Œé¢ï¼Œ å–æ¶ˆç‚¹èµ srem ç”¨æˆ·idã€‚ å±•ç°æ‰€æœ‰ç‚¹èµç”¨æˆ· Smembers ç”¨æˆ·æ•°ç»Ÿè®¡ Scardã€‚</p><p>å¥½å‹çš„å…³æ³¨ç¤¾äº¤å…³ç³» å…±åŒå…³æ³¨ sadd sinter</p><p>QQå¯èƒ½è®¤è¯†çš„äºº Sdiff å·®é›†</p><ol start="5"><li>zset</li></ol><p>å®šä¹‰é”€å”®æ’è¡Œæ¦œ zadd 100 id1 90 id2 </p><p>ç‚¹å‡»é‡å¢åŠ  zincrby name 2 id idå°±ä¼šå¢åŠ 2</p><h4 id="2-1-1-Redis-Key"><a href="#2-1-1-Redis-Key" class="headerlink" title="2.1.1 Redis-Key"></a>2.1.1 Redis-Key</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">keys * <span class="token comment">#æŸ¥çœ‹æ‰€æœ‰</span>EXPIRE name <span class="token number">10</span> <span class="token comment">#è¿‡æœŸæ—¶é—´</span>ttl name <span class="token comment">#å‰©ä½™æ—¶é—´</span><span class="token builtin class-name">type</span> name <span class="token comment"># æŸ¥çœ‹ç±»å‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-2-String"><a href="#2-1-2-String" class="headerlink" title="2.1.2 String"></a>2.1.2 String</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ­¥é•¿<span class="token builtin class-name">set</span> views <span class="token number">1</span> <span class="token comment">#è®¾ç½®</span>get viewsincr views<span class="token comment">#å¢åŠ </span>decr views <span class="token comment">#å‡å°‘</span>decrby views <span class="token number">10</span>incrby views <span class="token number">10</span>getrange views <span class="token number">0</span> <span class="token number">3</span> <span class="token comment">#æˆªå–viewsä¸­çš„1-3ä½å­—ç¬¦</span>getrange views <span class="token number">0</span> -1 <span class="token comment">#è·å¾—å…¨éƒ¨å­—ç¬¦</span>setnx views <span class="token comment">#ä¸å­˜åœ¨åˆ™è®¾ç½®æˆåŠŸ</span>setex views <span class="token comment">#è®¾ç½®è¿‡æœŸæ—¶é—´ (åˆ†å¸ƒå¼é”ä¸­å¸¸ç”¨)</span>mset k1 v1 k2 v2 k3 v3 <span class="token comment">#åŒæ—¶è®¾ç½®å¤šä¸ªå€¼</span>mget k1 k2 k3 <span class="token comment"># åŒæ—¶å¾—åˆ°</span>msetnx k1 v1 k4 v4<span class="token comment"># åŸå­æ“ä½œï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥</span><span class="token comment"># å¯¹è±¡</span><span class="token builtin class-name">set</span> user:1<span class="token punctuation">{</span>name:zhangsan,age:3<span class="token punctuation">}</span><span class="token comment">#æˆ–è¿™ä¹ˆå†™ user:{id}:{filed}ï¼Œå¦‚æ­¤è®¾è®¡æ˜¯Rediså®Œå…¨okçš„</span>mset user:1:name zhangsan user:1:age <span class="token number">3</span><span class="token comment">###########</span>getset db redis <span class="token comment">#å¦‚æœå­˜åœ¨å€¼ï¼Œè·å–åŸæ¥å€¼ï¼Œè®¾ç½®æ–°çš„å€¼ï¼Œæ²¡æœ‰çš„è¯å¾—åˆ°nilï¼Œå¹¶set db redis</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Stringç±»ä¼¼çš„åœºæ™¯ï¼švalueé™¤äº†æ˜¯å­—ç¬¦ä¸²è¿˜å¯ä»¥æ˜¯æ•°å­—</p><h4 id="2-1-3-List"><a href="#2-1-3-List" class="headerlink" title="2.1.3 List"></a>2.1.3 List</h4><p>åˆ—è¡¨ã€‚listå¯ä»¥ç©æˆæ ˆã€é˜Ÿåˆ—ã€æˆ–é˜»å¡é˜Ÿåˆ—ã€‚</p><p>æ‰€æœ‰listå‘½ä»¤éƒ½æ˜¯lå¼€å¤´çš„ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">LPUSH list oneLPUSH list twoLPUSH list threeLRANGE list <span class="token number">0</span> -1 <span class="token comment">#å…¨éƒ¨</span>LRANGE list <span class="token number">0</span> <span class="token number">1</span> <span class="token comment"># three two</span>RPUSH list four <span class="token comment">#å³è¾¹</span>LPOPRPOP<span class="token comment">############</span>LINDEX list <span class="token number">0</span> <span class="token comment">#å·¦ä¾§ç¬¬ä¸€ä¸ªå€¼</span>Llen list <span class="token comment">#é•¿åº¦</span>Lrem list <span class="token number">1</span> one <span class="token comment"># ç§»é™¤ one 1ä¸ª</span>ltrim list <span class="token number">1</span> <span class="token number">2</span> <span class="token comment"># é€šè¿‡æˆªå–æŒ‡å®šçš„é•¿åº¦</span>rpoplpush list anotherlist <span class="token comment"># ç§»é™¤listä¸­å³ä¾§ç¬¬ä¸€ä¸ªæ•°æ®ç„¶åæ”¾å…¥anotherlistä¸­</span>exists list <span class="token comment">#åˆ¤æ–­åˆ—è¡¨æ˜¯å¦å­˜åœ¨</span><span class="token comment">####</span>lset list <span class="token number">0</span> item <span class="token comment">#å°†åˆ—è¡¨ä¸­å¯¹åº”ä¸‹æ ‡çš„å€¼æ›¿æ¢</span>linsert list before <span class="token string">"item"</span> <span class="token string">"other"</span> <span class="token comment"># åœ¨itemå€¼å‰é¢æ’å…¥otherè¿™ä¸ªå€¼</span>linsert list after <span class="token string">"item"</span> <span class="token string">"new"</span> <span class="token comment"># åœ¨itemå€¼åé¢æ’å…¥newè¿™ä¸ªå€¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»ç»“ï¼šL</p><ul><li>æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œbefore Node after left right éƒ½å¯ä»¥æ’å…¥å€¼</li><li>å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°é“¾è¡¨</li><li>å¦‚æœå­˜åœ¨ï¼Œæ–°å¢å†…å®¹</li><li>å¦‚æœç§»é™¤äº†æ‰€æœ‰å€¼ï¼Œç©ºé“¾è¡¨ï¼Œä»£è¡¨ä¸å­˜åœ¨</li><li>åœ¨ä¸¤è¾¹æ’å…¥æˆ–æ”¹åŠ¨ï¼Œæ•ˆç‡æœ€é«˜ï¼Œä¸­é—´å…ƒç´ ï¼Œç›¸å¯¹æ¥è¯´æ•ˆç‡ä½ä¸€ç‚¹ã€‚</li></ul><p>æ¶ˆæ¯æ’é˜Ÿï¼Œæ¶ˆæ¯é˜Ÿåˆ— LPUSH RPOP å•¥çš„</p><h4 id="2-1-4-Set"><a href="#2-1-4-Set" class="headerlink" title="2.1.4 Set"></a>2.1.4 Set</h4><p>setå¼€å¤´éƒ½æ˜¯s</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># set å€¼ä¸èƒ½é‡å¤</span>sadd myset <span class="token string">"hello"</span>smembers myset <span class="token comment">#æŸ¥çœ‹å…ƒç´ </span>sismember myset hello <span class="token comment">#æŸ¥çœ‹å…ƒç´ æ˜¯å¦å­˜åœ¨</span><span class="token comment">###</span>srem myset hello <span class="token comment">#ç§»é™¤seté›†åˆä¸­çš„æŒ‡å®šå…ƒç´ </span>scard myset <span class="token comment"># è·å–seté›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°</span><span class="token comment">###</span>srandmember myset <span class="token comment"># æ— éœ€ä¸é‡å¤é›†åˆã€‚æŠ½éšæœº</span><span class="token comment">###</span>spop myset <span class="token comment"># éšæœºåˆ é™¤ä¸€ä¸ªå…ƒç´ </span><span class="token comment">###</span><span class="token comment"># å·®é›† äº¤é›† å¹¶é›†</span>Sdiff set1 set2sinter set1 set2sunion set1 <span class="token builtin class-name">set</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-5-Hash"><a href="#2-1-5-Hash" class="headerlink" title="2.1.5 Hash()"></a>2.1.5 Hash()</h4><p>Mapé›†åˆã€‚key-mapï¼Œå€¼æ˜¯mapé›†åˆ</p><p>å‘½ä»¤ä»¥hå¼€å¤´</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hset myhash field1 kuangshenhget myhash field1hmset myhash field1 hello field2 world <span class="token comment">#åŒæ—¶è®¾ç½®å€¼</span>hgetall myhash <span class="token comment"># å¾—åˆ°å…¨éƒ¨çš„å€¼</span>hdel myhash field1 <span class="token comment">#åˆ é™¤å“ˆå¸ŒæŒ‡å®šçš„å€¼å­—æ®µï¼å¯¹åº”çš„valueå€¼ä¹Ÿå°±æ¶ˆå¤±äº†ã€‚</span>hlen myhash <span class="token comment">#è·å–hashé•¿åº¦</span>hexists myhash field1 <span class="token comment"># åˆ¤æ–­hashä¸­æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hashä¿å­˜å˜æ›´æ•°æ® user name age </p><h4 id="2-1-6-Zsetï¼ˆæœ‰åºé›†åˆï¼‰"><a href="#2-1-6-Zsetï¼ˆæœ‰åºé›†åˆï¼‰" class="headerlink" title="2.1.6 Zsetï¼ˆæœ‰åºé›†åˆï¼‰"></a>2.1.6 Zsetï¼ˆæœ‰åºé›†åˆï¼‰</h4><p>åœ¨setçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªå€¼ï¼Œ set k1 v1 , zset k1 score v1</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#å¢åŠ </span>zadd myset <span class="token number">1</span> one <span class="token comment"># ä¸­é—´çš„æ˜¯1åºå·ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªåºå·ï¼Œè‡ªåŠ¨æ’åº</span>zrange myset <span class="token number">0</span> -1 <span class="token comment"># æŸ¥çœ‹èŒƒå›´ï¼Œè¿™ä¸ª-1å°±æ˜¯çœ‹çš„å…¨éƒ¨äº†</span><span class="token comment">#æ’åºå¦‚ä½•å®ç°</span>zrangebyscore salary -inf +inf <span class="token comment"># ä»æœ€å°å€¼åˆ°æœ€å¤§å€¼æ’åº</span>zrevrange salary <span class="token number">0</span> -1 <span class="token comment"># å€’å™ï¼Œä»å¤§åˆ°å°æ’åº</span><span class="token comment"># è·å–æœ‰åºé›†åˆçš„ä¸ªæ•°</span>zcard myset zcard myset <span class="token number">1</span> hellozcount myset <span class="token number">1</span> <span class="token number">3</span> <span class="token comment"># è·å–æŒ‡å®šåŒºé—´çš„æ•°é‡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä½™çš„ä¸€äº›APIï¼Œå‰©ä¸‹çš„å¦‚æœå·¥ä½œä¸­æœ‰éœ€è¦è¿™ä¸ªæ—¶å€™å¯ä»¥å»æŸ¥å®˜æ–¹æ–‡æ¡£ã€‚</p><h3 id="2-2-ä¸‰ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹"><a href="#2-2-ä¸‰ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹" class="headerlink" title="2.2 ä¸‰ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹"></a>2.2 ä¸‰ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹</h3><p>æœ‹å‹çš„å®šä½ï¼Œé™„è¿‘çš„äººï¼Œæ‰“è½¦è·ç¦»è®¡ç®—ï¼Ÿ</p><h4 id="2-2-1-åœ°ç†ç©ºé—´"><a href="#2-2-1-åœ°ç†ç©ºé—´" class="headerlink" title="2.2.1 åœ°ç†ç©ºé—´"></a>2.2.1 åœ°ç†ç©ºé—´</h4><p>Redisçš„Geoåœ¨Redis 3.2 ç‰ˆæœ¬å°±æ¨å‡ºäº†ã€‚è¿™ä¸ªåŠŸèƒ½å¯ä»¥æ¨ç®—åœ°ç†ä½ç½®çš„ä¿¡æ¯ï¼Œä¸¤åœ°ä¹‹é—´çš„è·ç¦»ï¼Œæ–¹åœ†å‡ é‡Œçš„äººï¼</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">GEOADD <span class="token comment">#å°†æŒ‡å®šçš„ç»åº¦ã€çº¬åº¦ã€åç§°æ·»åŠ åˆ°æŒ‡å®šçš„keyä¸­ã€‚åœ°çƒä¸¤ææ— æ³•æ·»åŠ ï¼Œé€šè¿‡javaç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ å‚æ•° key</span>geoadd china:city <span class="token number">116.40</span> <span class="token number">39.90</span> beijing<span class="token comment">#############</span>GEODIST <span class="token comment"># ç»™å®šä¸¤ä¸ªä½ç½®ä¹‹é—´çš„è·ç¦»</span><span class="token comment"># m å•ä½ ç±³</span><span class="token comment"># km å•ä½æ˜¯åƒç±³</span><span class="token comment"># mi å•ä½æ˜¯è‹±é‡Œ</span><span class="token comment"># ft å•ä½æ˜¯è‹±å°º</span>geodist china:city beijing chongqin km <span class="token comment">##############</span>GEOHASH <span class="token comment"># è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®å…ƒç´ çš„Geohashè¡¨ç¤º</span><span class="token comment"># è¿”å›11ä¸ªå­—ç¬¦çš„Geohashå­—ç¬¦ä¸²</span>geohash china:city beijing <span class="token comment"># å°†å½“å‰ç»çº¬åº¦è½¬æ¢ä¸ºä¸€ç»´çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²è¶Šæ¥è¿‘ï¼Œé‚£ä¹ˆåˆ™è·ç¦»è¶Šè¿‘ï¼</span><span class="token comment">#######################</span>GEOPOS <span class="token comment"># è·å–å½“å‰å®šä½ï¼šä¸€å®šæ˜¯ä¸€ä¸ªåæ ‡å€¼</span>geopos china:city beijing <span class="token comment"># è·å–æŒ‡å®šçš„åŸå¸‚çš„ç»åº¦å’Œçº¬åº¦</span><span class="token comment">#########################</span>GEORADIUS <span class="token comment"># ä»¥ç»™å®šçš„ç»åº¦çº¬åº¦ä¸ºä¸­å¿ƒï¼ŒåŠå¾„å†…çš„</span>georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km <span class="token comment"># ä»¥ 110 30 ä¸ºä¸­å¿ƒï¼Œæ‰¾æ–¹åœ†1000kmå†…çš„åŸå¸‚</span>georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km <span class="token punctuation">[</span>withcoord<span class="token punctuation">]</span> <span class="token punctuation">[</span>withdist<span class="token punctuation">]</span> <span class="token comment"># withcodeæ‰“å°æ—¶å¸¦ä¸Šç»åº¦çº¬åº¦ withdistæ‰“å°æ—¶å¸¦ä¸Šè·ç¦»</span><span class="token comment">###########################</span>GEORADIUSBYMEMBER <span class="token comment"># æ‰¾å‡ºä½äºæŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ï¼Œä¸­å¿ƒç‚¹æ˜¯ç”±ç»™å®šçš„ä½ç½®å…ƒç´ å†³å®šçš„</span>georadiusbymember china:city shanghai <span class="token number">400</span> km <span class="token comment"># æ‰¾å‡ºä¸Šæµ·é™„è¿‘400kmçš„åŸå¸‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-2-2-Hyperloglog"><a href="#2-2-2-Hyperloglog" class="headerlink" title="2.2.2 Hyperloglog"></a>2.2.2 Hyperloglog</h4><p>åŸºæ•°ï¼šä¸é‡å¤çš„å…ƒç´ ã€‚æ¯”å¦‚A = {1,3,5,7,8}ï¼ŒåŸºæ•°ï¼ˆä¸é‡å¤çš„å…ƒç´ ï¼‰ = 5ï¼Œå¯ä»¥æ¥å—è¯¯å·®ã€‚</p><p>Redis 2.8.9ç‰ˆæœ¬å°±æ›´æ–°äº† Hyperloglogæ•°æ®ç»“æ„ã€‚æ˜¯åŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ã€‚</p><p>ç½‘é¡µUVï¼ˆä¸€ä¸ªäººè®¿é—®ä¸€ä¸ªç½‘ç«™å¤šæ¬¡ï¼Œä½†æ˜¯è¿˜æ˜¯ç®—ä½œä¸€ä¸ªäººï¼‰ã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†è®¡æ•°ï¼Œè€Œä¸æ˜¯ä¿æŠ¤ç”¨æˆ·idã€‚</p><ul><li>ä¼˜ç‚¹ï¼šå ç”¨çš„å†…å­˜æ˜¯å›ºå®šï¼Œ2^64ä¸åŒçš„å…ƒç´ çš„æŠ€æœ¯ï¼Œåªéœ€è¦åºŸ12KBå†…å­˜ï¼å¦‚æœè¦ä»å†…å­˜çš„è§’åº¦æ¥æ¯”è¾ƒçš„è¯ï¼Œhyperloglogæ˜¯é¦–é€‰ï¼</li><li>0.81%é”™è¯¯ç‡ã€‚</li></ul><p>è¿™ä¸ªå‘½ä»¤éƒ½ä»¥PFå¼€å¤´ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ·»åŠ </span>PFadd mykey a b c d e f g h i j<span class="token comment"># è®¡æ•°</span>PFcount mykey<span class="token comment"># åˆå¹¶</span>PFmerge mykey3 mykey<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä¸šåŠ¡éœ€æ±‚ä¸èƒ½å®¹é”™ï¼Œé‚£ä¹ˆå°±æ¢æˆsetã€‚</p><h3 id="2-2-3-Bitmaps"><a href="#2-2-3-Bitmaps" class="headerlink" title="2.2.3 Bitmaps"></a>2.2.3 Bitmaps</h3><p>ä½å­˜å‚¨ï¼Œæ“ä½œäºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œï¼Œåªæœ‰0å’Œ1ä¸¤ä¸ªçŠ¶æ€ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">setbit sign <span class="token number">5</span> <span class="token number">0</span>bitcount sign <span class="token comment"># ç»Ÿè®¡1çš„ä¸ªæ•°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="3-äº‹åŠ¡"><a href="#3-äº‹åŠ¡" class="headerlink" title="3. äº‹åŠ¡"></a>3. äº‹åŠ¡</h2><p>Rediså•æ¡å‘½ä»¤è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼ŒåŸå­æ€§ï¼</p><p><font color="red">ä½†æ˜¯Redisäº‹åŠ¡ä¸ä¿è¯åŸå­æ€§ï¼</font>ä¸€ä¸ªäº‹åŠ¡æ‰€æœ‰å‘½ä»¤è¢«åºåˆ—åŒ–ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼</p><p>Redisäº‹åŠ¡å¹¶æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µï¼</p><p>Redisäº‹åŠ¡ï¼š</p><ol><li>å¼€å¯äº‹åŠ¡ï¼ˆmulti)</li><li>å‘½ä»¤å…¥é˜Ÿ</li><li>æ‰§è¡Œäº‹åŠ¡ï¼ˆexec)</li></ol><p>æ”¾å¼ƒäº‹åŠ¡ï¼šdiscard</p><p><strong>æ‚²è§‚é”</strong>ï¼š</p><p>å¾ˆæ‚²è§‚ï¼Œä»€ä¹ˆæ—¶å€™éƒ½è¦åŠ é”ã€‚</p><p><strong>ä¹è§‚é”</strong>ï¼š</p><p>å¾ˆä¹è§‚ï¼Œä»€ä¹ˆæ—¶å€™éƒ½ä¸æƒ³åŠ é”ã€‚æ›´æ–°æ•°æ®æ—¶å»åˆ¤æ–­ä»¥ä¸‹ï¼Œåœ¨æ­¤æœŸé—´æ˜¯å¦æœ‰äººä¿®æ”¹è¿‡è¿™ä¸ªæ•°æ®ã€‚</p><p>Redis ç›‘è§†æµ‹è¯•ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">watch</span> money <span class="token comment">#å¯ä»¥å½“ä½œä¹è§‚é”æ“ä½œ</span>multidecrby money <span class="token number">10</span>incrby out <span class="token number">10</span><span class="token builtin class-name">exec</span> <span class="token comment">#æ‰§è¡Œä¹‹å‰å¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æˆ‘ä»¬çš„å€¼ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå¯¼è‡´äº‹åŠ¡æ‰§è¡Œå¤±è´¥</span>unwatch è¿›è¡Œè§£é”<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-Jedis"><a href="#3-Jedis" class="headerlink" title="3. Jedis"></a>3. Jedis</h2><p>éœ€è¦ä½¿ç”¨Javaæ¥æ“ä½œRedisã€‚</p><p>Jediså®˜æ–¹æ¨èçš„javaè¿æ¥å·¥å…·ï¼Œä½¿ç”¨javaæ“ä½œRedisã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.75<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-SpringBoot-æ•´åˆ"><a href="#4-SpringBoot-æ•´åˆ" class="headerlink" title="4. SpringBoot æ•´åˆ"></a>4. SpringBoot æ•´åˆ</h2><p>SpringBootæ“ä½œæ•°æ®:spring-data jpa jdbc mongodb redisï¼</p><p>SpringData ä¹Ÿæ˜¯å’Œ SpringBooté½åçš„é¡¹ç›®ã€‚</p><p>åœ¨springBoot2.xä¹‹åï¼ŒåŸæ¥ä½¿ç”¨çš„jedisè¢«æ›¿æ¢æˆäº†lettuce</p><p>jedis:é‡‡ç”¨ç›´è¿ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œä¸å®‰å…¨ã€‚å¦‚æœé¿å…ä¸å®‰å…¨ï¼Œéœ€è¦ä½¿ç”¨jedis poolè¿æ¥æ± ï¼BIO</p><p>lettuce:é‡‡ç”¨nettyï¼Œå®ä¾‹å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä¸å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹æ•°æ®ï¼Œæ›´åƒNIOæ¨¡å¼ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisAutoConfiguration</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">RedisAutoConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>        name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"redisTemplate"</span><span class="token punctuation">}</span>    <span class="token punctuation">)</span>    <span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> template<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@ConditionalOnMissingBean</span>    <span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">StringRedisTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> template<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-Config"><a href="#5-Config" class="headerlink" title="5. Config"></a>5. Config</h2><ul><li>é…ç½®æ–‡ä»¶å¯¹å¤§å°å†™ä¸æ•æ„Ÿ</li></ul><blockquote><p>ç½‘ç»œ</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 <span class="token comment">#ç»‘å®šip</span>protected-mode <span class="token function">yes</span> <span class="token comment"># ä¿æŠ¤æ¨¡å¼</span>port <span class="token number">6379</span> <span class="token comment"># ç«¯å£è®¾ç½®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>é€šç”¨</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">daemonize <span class="token function">yes</span> <span class="token comment"># ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œé»˜è®¤æ˜¯noï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å¼€å¯ä¸ºyes</span>pidfile /var/run/redis_6379.pid <span class="token comment"># å¦‚æœä»¥åå°æ–¹å¼è¿è¡Œï¼Œæˆ‘ä»¬å°±è¦æŒ‡å®šä¸€ä¸ª pid è¿›ç¨‹æ–‡ä»¶</span><span class="token comment"># Specify the server verbosity level.</span><span class="token comment"># This can be one of:</span><span class="token comment"># debug (a lot of information, useful for development/testing)</span><span class="token comment"># verbose (many rarely useful info, but not a mess like the debug level)</span><span class="token comment"># notice (moderately verbose, what you want in production probably) ç”Ÿäº§ç¯å¢ƒé€‚ç”¨</span><span class="token comment"># warning (only very important / critical messages are logged)</span>loglevel noticelogfile <span class="token string">""</span> <span class="token comment"># æ—¥å¿—çš„æ–‡ä»¶ä½ç½®å</span>databases <span class="token number">16</span> <span class="token comment"># æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤16ä¸ªæ•°æ®åº“</span>always-show-logo <span class="token function">yes</span> <span class="token comment">#æ˜¯å¦æ˜¾ç¤ºlogo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¿«ç…§</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">save <span class="token number">900</span> <span class="token number">1</span> <span class="token comment"># 900så†…å¦‚ä½•è‡³å°‘æœ‰ä¸€ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬å°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span><span class="token comment"># 300så†…è‡³å°‘10ä¸ªkey è¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬åŠè¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span>save <span class="token number">300</span> <span class="token number">10</span><span class="token comment"># 60så†…è‡³å°‘10000ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼ŒæŒä¹…åŒ–</span>save <span class="token number">60</span> <span class="token number">10000</span>stop-writes-on-bgsave-error <span class="token function">yes</span> <span class="token comment"># æŒä¹…åŒ–å¦‚æœé”™è¯¯äº†ï¼ŒRedisæ˜¯å¦è¿˜ç»§ç»­å·¥ä½œ</span>rdbcompression <span class="token function">yes</span> <span class="token comment"># æ˜¯å¦å‹ç¼© rdb æ–‡ä»¶ï¼Œéœ€è¦æ¶ˆè€—ä¸€äº›cpuèµ„æºã€‚</span>rdbchecksum <span class="token function">yes</span> <span class="token comment"># ä¿å­˜rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿›è¡Œé”™è¯¯çš„æ£€æŸ¥æ ¡éªŒ</span><span class="token function">dir</span> ./ <span class="token comment"># rdb æ–‡ä»¶ä¿å­˜çš„ç›®å½•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŒä¹…åŒ–ï¼Œåœ¨è§„å®šçš„æ—¶é—´å†…ï¼Œæ‰§è¡Œäº†å¤šå°‘æ¬¡æ“ä½œï¼Œåˆ™ä¼šæŒä¹…åŒ–åˆ°æ–‡ä»¶ .rdb .aof</p><p>redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰æŒä¹…åŒ–ï¼Œé‚£ä¹ˆæ•°æ®æ–­ç”µå³å¤±ã€‚</p><blockquote><p>security</p></blockquote><p>å¯ä»¥ä¿®æ”¹å¯†ç ï¼Œé»˜è®¤æ²¡æœ‰è®¾ç½®å¯†ç ï¼</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">config get requirepassconfig <span class="token builtin class-name">set</span> requirepass <span class="token string">"123456"</span> <span class="token comment"># è®¾ç½®rediså¯†ç </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>é™åˆ¶clients</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">maxclients <span class="token number">10000</span> <span class="token comment"># æœ€å¤§è¿æ¥æ•°é‡</span>maxmemory <span class="token operator">&lt;</span>bytes<span class="token operator">&gt;</span> <span class="token comment"># redis é…ç½®æœ€å¤§çš„å†…å­˜å®¹é‡</span>maxmemory-policy noeviction <span class="token comment"># å†…å­˜åˆ°è¾¾ä¸Šé™ä¹‹åçš„å¤„ç†ç­–ç•¥ï¼Œç§»é™¤ä¸€äº›è¿‡æœŸçš„key</span>maxmemory-policy å…­ç§æ–¹å¼ï¼š<span class="token number">1</span>ã€volatile-lruï¼šåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyè¿›è¡ŒLRUï¼ˆé»˜è®¤å€¼ï¼‰ <span class="token number">2</span>ã€allkeys-lru ï¼š åˆ é™¤lruç®—æ³•çš„key   <span class="token number">3</span>ã€volatile-randomï¼šéšæœºåˆ é™¤å³å°†è¿‡æœŸkey   <span class="token number">4</span>ã€allkeys-randomï¼šéšæœºåˆ é™¤   <span class="token number">5</span>ã€volatile-ttl ï¼š åˆ é™¤å³å°†è¿‡æœŸçš„   <span class="token number">6</span>ã€noeviction ï¼š æ°¸ä¸è¿‡æœŸï¼Œè¿”å›é”™è¯¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>APPEND ONLY æ¨¡å¼ aofé…ç½®</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">appendonly no <span class="token comment"># é»˜è®¤ä¸å¼€å¯ï¼Œå› ä¸ºrdbå¤§éƒ¨åˆ†åœºæ™¯å¤Ÿç”¨äº†ï¼Œè¿™ä¸ªè¿˜ç‰¹åˆ«æ…¢</span>appendfilename <span class="token string">"appendonly.aof"</span> <span class="token comment"># æŒä¹…åŒ–çš„æ–‡ä»¶çš„åå­— .rdb</span>appendfsync always <span class="token comment"># æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šsyncï¼Œæ¶ˆè€—æ€§èƒ½ã€‚</span>appendfsync everysec <span class="token comment"># æ¯ç§’æ‰§è¡Œä¸€æ¬¡ syncï¼Œå¯èƒ½ä¼šä¸¢å¤±è¿™1sçš„æ•°æ®</span>appendfsync no <span class="token comment"># ä¸æ‰§è¡Œ syncï¼Œè¿™ä¸ªæ—¶å€™æ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-æŒä¹…åŒ–"><a href="#6-æŒä¹…åŒ–" class="headerlink" title="6. æŒä¹…åŒ–"></a>6. æŒä¹…åŒ–</h2><p>Redisæ˜¯å†…å­˜æ•°æ®åº“ã€‚</p><h3 id="6-1-rdb"><a href="#6-1-rdb" class="headerlink" title="6.1 rdb"></a>6.1 rdb</h3><h4 id="6-1-1-æ˜¯ä»€ä¹ˆ"><a href="#6-1-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="6.1.1 æ˜¯ä»€ä¹ˆ"></a>6.1.1 æ˜¯ä»€ä¹ˆ</h4><p>rdb(Redis Database)æ˜¯RedisæŒä¹…åŒ–çš„æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚rediså°†å†…å­˜ä¸­çš„æ•°æ®åº“å¿«ç…§ï¼ˆä»¥æ•°æ®ç»“æ„çš„å½¢å¼ä¿å­˜æ•°æ®ï¼‰ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚</p><h4 id="6-1-2-ä¸ºä»€ä¹ˆ"><a href="#6-1-2-ä¸ºä»€ä¹ˆ" class="headerlink" title="6.1.2 ä¸ºä»€ä¹ˆ"></a>6.1.2 ä¸ºä»€ä¹ˆ</h4><p>é˜²æ­¢ä¸‹ä¸€æ¬¡ä½¿ç”¨æ•°æ®åº“æ—¶ï¼Œå½“å‰æ•°æ®åº“çš„æ•°æ®ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚</p><h4 id="6-1-3-æ€ä¹ˆåš"><a href="#6-1-3-æ€ä¹ˆåš" class="headerlink" title="6.1.3 æ€ä¹ˆåš"></a>6.1.3 æ€ä¹ˆåš</h4><p><img src="/2021/04/06/redis-ji-chu/graphviz-cd96bfa5c61ef2b8dd69a9b0a97cde047cb722a8.svg" alt="digraph persistent {      rankdir = LR;      node [shape = circle, style = filled];      edge [style = bold];      redis_object [label = &quot;å†…å­˜ä¸­çš„\næ•°æ®å¯¹è±¡&quot;, fillcolor = &quot;#A8E270&quot;];      rdb [label = &quot;ç£ç›˜ä¸­çš„\nRDBæ–‡ä»¶&quot;, fillcolor = &quot;#95BBE3&quot;];      redis_object -> rdb [label = &quot;rdbSave&quot;];      rdb -> redis_object [label = &quot;rdbLoad&quot;]; }"></p><p><img src="/2021/04/06/redis-ji-chu/rdb.PNG"></p><p>åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯Snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚</p><p>Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ã€‚è¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„å›å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£ä¹ˆRDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</p><p>rdbä¿å­˜çš„æ–‡ä»¶æ˜¯dump.rdbçš„ã€‚</p><blockquote><p>è§¦å‘æœºåˆ¶</p></blockquote><ol><li>saveçš„è§„åˆ™æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨è§¦å‘rdbè§„åˆ™ã€‚</li><li>æ‰§è¡Œflushallå‘½ä»¤ï¼Œä¹Ÿä¼šè§¦å‘æˆ‘ä»¬çš„rdbè§„åˆ™ã€‚</li><li>æ¨å‡ºredisï¼Œäº§ç”Ÿrdbæ–‡ä»¶ã€‚</li></ol><blockquote><p>æ¢å¤rdbæ–‡ä»¶</p></blockquote><p>åªéœ€è¦å°†rdbæ–‡ä»¶æ”¾åœ¨rediså¯åŠ¨ç›®å½•å³å¯ï¼Œrediså¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ£€æŸ¥dump.rdbæ¢å¤å…¶ä¸­çš„æ•°æ®ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">config get <span class="token function">dir</span> <span class="token comment"># æŸ¥çœ‹å¯åŠ¨ç›®å½•</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="6-2-AOF-ï¼ˆAppend-Only-File"><a href="#6-2-AOF-ï¼ˆAppend-Only-File" class="headerlink" title="6.2 AOF ï¼ˆAppend Only File)"></a>6.2 AOF ï¼ˆAppend Only File)</h3><p>é»˜è®¤ä¸å¼€å¯ï¼Œæ‰‹åŠ¨è¿›è¡Œé…ç½®ã€‚å¦‚æœaofæœ‰é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>redis-check-aof --fix</code>å³å¯ã€‚ï¼ˆä¼šä¸¢å¼ƒé”™è¯¯çš„æ•°æ®ï¼‰</p><p>å°†æˆ‘ä»¬æ‰€æœ‰å‘½ä»¤éƒ½è®°å½•ï¼Œ</p><p><img src="/2021/04/06/redis-ji-chu/aof.PNG"></p><p>ä»¥æ—¥å¿—å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼ˆè¯»æ“ä½œä¸è®°å½•ï¼‰ï¼Œåªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨ä¹‹åˆä¼šæ ¹æ®è¯¥æ–‡ä»¶è¯»å–é‡æ–°æ„å»ºæ•°æ®ï¼Œredisé‡å¯çš„è¯å°±æ˜¯æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚</p><h2 id="7-Rediså‘å¸ƒè®¢é˜…"><a href="#7-Rediså‘å¸ƒè®¢é˜…" class="headerlink" title="7. Rediså‘å¸ƒè®¢é˜…"></a>7. Rediså‘å¸ƒè®¢é˜…</h2><h3 id="7-1-æ˜¯ä»€ä¹ˆ"><a href="#7-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="7.1 æ˜¯ä»€ä¹ˆ"></a>7.1 æ˜¯ä»€ä¹ˆ</h3><p>å‘å¸ƒè®¢é˜…(pub/sub)æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…ï¼ˆpubï¼‰å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…ï¼ˆsubï¼‰æ¥æ”¶æ¶ˆæ¯ã€‚</p><h3 id="7-2-ä¸ºä»€ä¹ˆ"><a href="#7-2-ä¸ºä»€ä¹ˆ" class="headerlink" title="7.2 ä¸ºä»€ä¹ˆ"></a>7.2 ä¸ºä»€ä¹ˆ</h3><p>å› ä¸ºæˆ‘ä»¬æ—¥å¸¸ä¸­å¾®ä¿¡å…¬ä¼—å·ã€å¾®åšè®¢é˜…å·ï¼Œéœ€è¦æ¨é€ç»™è®¢é˜…çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œè¿™ç§è¡Œä¸ºå°±éœ€è¦Redisçš„å‘å¸ƒè®¢é˜…ã€‚</p><h3 id="7-3-æ€ä¹ˆåš"><a href="#7-3-æ€ä¹ˆåš" class="headerlink" title="7.3 æ€ä¹ˆåš"></a>7.3 æ€ä¹ˆåš</h3><p>Rediså®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚</p><p>è®¢é˜…/å‘å¸ƒæ¶ˆæ¯å›¾ï¼š</p><p>ç¬¬ä¸€ä¸ªï¼šæ¶ˆæ¯å‘é€è€…ï¼Œç¬¬äºŒä¸ªï¼šé¢‘é“ ç¬¬ä¸‰ä¸ªï¼šæ¶ˆæ¯è®¢é˜…è€…ã€‚</p><p><img src="/2021/04/06/redis-ji-chu/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.PNG"></p><p>ä½œä¸ºä¾‹å­ï¼Œ ä¸‹å›¾å±•ç¤ºäº†é¢‘é“ <code>channel1</code> ï¼Œ ä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯ â€”â€” <code>client2</code> ã€ <code>client5</code> å’Œ <code>client1</code> ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-58f7b1f1f52b28f59291d194555fc9f4b1462a4c.svg"></p><p>å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡ <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> å‘½ä»¤å‘é€ç»™é¢‘é“ <code>channel1</code> æ—¶ï¼Œ è¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-84c95abf88d6c0ac55b007da08805a4b9a582fdf.svg"></p><p>åœ¨åé¢çš„å†…å®¹ä¸­ï¼Œ æˆ‘ä»¬å°†æ¢è®¨ <a href="http://redis.readthedocs.org/en/latest/pub_sub/subscribe.html#subscribe">SUBSCRIBE</a> å’Œ <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> å‘½ä»¤çš„å®ç°ï¼Œ ä»¥åŠè¿™å¥—è®¢é˜…ä¸å‘å¸ƒæœºåˆ¶çš„è¿ä½œåŸç†ã€‚</p><h4 id="7-3-1-è®¢é˜…æœºåˆ¶"><a href="#7-3-1-è®¢é˜…æœºåˆ¶" class="headerlink" title="7.3.1 è®¢é˜…æœºåˆ¶"></a>7.3.1 è®¢é˜…æœºåˆ¶</h4><p>æ¯ä¸ª Redis æœåŠ¡å™¨è¿›ç¨‹éƒ½ç»´æŒç€ä¸€ä¸ªè¡¨ç¤ºæœåŠ¡å™¨çŠ¶æ€çš„ <code>redis.h/redisServer</code> ç»“æ„ï¼Œ ç»“æ„çš„ <code>pubsub_channels</code> å±æ€§æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œ è¿™ä¸ªå­—å…¸å°±ç”¨äºä¿å­˜è®¢é˜…é¢‘é“çš„ä¿¡æ¯ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">redisServer</span> <span class="token punctuation">{</span>    <span class="token comment">// ...</span>    dict <span class="token operator">*</span>pubsub_channels<span class="token punctuation">;</span>    <span class="token comment">// ...</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ï¼Œå­—å…¸çš„é”®ä¸ºæ­£åœ¨è¢«è®¢é˜…çš„é¢‘é“ï¼Œ è€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œ é“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰è®¢é˜…è¿™ä¸ªé¢‘é“çš„å®¢æˆ·ç«¯ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œåœ¨ä¸‹å›¾å±•ç¤ºçš„è¿™ä¸ª <code>pubsub_channels</code> ç¤ºä¾‹ä¸­ï¼Œ <code>client2</code> ã€ <code>client5</code> å’Œ <code>client1</code> å°±è®¢é˜…äº† <code>channel1</code> ï¼Œ è€Œå…¶ä»–é¢‘é“ä¹Ÿåˆ†åˆ«è¢«åˆ«çš„å®¢æˆ·ç«¯æ‰€è®¢é˜…ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-241c988b86bb9bed6bf26537e654baaab4eef77b.svg"></p><p>å½“å®¢æˆ·ç«¯è°ƒç”¨ <a href="http://redis.readthedocs.org/en/latest/pub_sub/subscribe.html#subscribe">SUBSCRIBE</a> å‘½ä»¤æ—¶ï¼Œ ç¨‹åºå°±å°†å®¢æˆ·ç«¯å’Œè¦è®¢é˜…çš„é¢‘é“åœ¨ <code>pubsub_channels</code> å­—å…¸ä¸­å…³è”èµ·æ¥ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœå®¢æˆ·ç«¯ <code>client10086</code> æ‰§è¡Œå‘½ä»¤ <code>SUBSCRIBE channel1 channel2 channel3</code> ï¼Œé‚£ä¹ˆå‰é¢å±•ç¤ºçš„ <code>pubsub_channels</code> å°†å˜æˆä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-cb250b1be4aaaedc9d5ddde113a80998d7f9c480-1618619828704.svg"></p><p><a href="http://redis.readthedocs.org/en/latest/pub_sub/subscribe.html#subscribe">SUBSCRIBE</a> å‘½ä»¤çš„è¡Œä¸ºå¯ä»¥ç”¨ä¼ªä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">def SUBSCRIBE(client, channels):    # éå†æ‰€æœ‰è¾“å…¥é¢‘é“    for channel in channels:        # å°†å®¢æˆ·ç«¯æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾        redisServer.pubsub_channels[channel].append(client)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ <code>pubsub_channels</code> å­—å…¸ï¼Œ ç¨‹åºåªè¦æ£€æŸ¥æŸä¸ªé¢‘é“æ˜¯å¦ä¸ºå­—å…¸çš„é”®ï¼Œ å°±å¯ä»¥çŸ¥é“è¯¥é¢‘é“æ˜¯å¦æ­£åœ¨è¢«å®¢æˆ·ç«¯è®¢é˜…ï¼› åªè¦å–å‡ºæŸä¸ªé”®çš„å€¼ï¼Œ å°±å¯ä»¥å¾—åˆ°æ‰€æœ‰è®¢é˜…è¯¥é¢‘é“çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚</p><h4 id="7-3-2-å‘é€ä¿¡æ¯åˆ°é¢‘é“"><a href="#7-3-2-å‘é€ä¿¡æ¯åˆ°é¢‘é“" class="headerlink" title="7.3.2 å‘é€ä¿¡æ¯åˆ°é¢‘é“"></a>7.3.2 å‘é€ä¿¡æ¯åˆ°é¢‘é“</h4><p>äº†è§£äº† <code>pubsub_channels</code> å­—å…¸çš„ç»“æ„ä¹‹åï¼Œ è§£é‡Š <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> å‘½ä»¤çš„å®ç°å°±éå¸¸ç®€å•äº†ï¼š å½“è°ƒç”¨ <code>PUBLISH channel message</code> å‘½ä»¤ï¼Œ ç¨‹åºé¦–å…ˆæ ¹æ® <code>channel</code> å®šä½åˆ°å­—å…¸çš„é”®ï¼Œ ç„¶åå°†ä¿¡æ¯å‘é€ç»™å­—å…¸å€¼é“¾è¡¨ä¸­çš„æ‰€æœ‰å®¢æˆ·ç«¯ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œå¯¹äºä»¥ä¸‹è¿™ä¸ª <code>pubsub_channels</code> å®ä¾‹ï¼Œ å¦‚æœæŸä¸ªå®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤ <code>PUBLISH channel1 "hello moto"</code> ï¼Œé‚£ä¹ˆ <code>client2</code> ã€ <code>client5</code> å’Œ <code>client1</code> ä¸‰ä¸ªå®¢æˆ·ç«¯éƒ½å°†æ¥æ”¶åˆ° <code>"hello moto"</code> ä¿¡æ¯ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-241c988b86bb9bed6bf26537e654baaab4eef77b.svg"></p><p><a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> å‘½ä»¤çš„å®ç°å¯ä»¥ç”¨ä»¥ä¸‹ä¼ªä»£ç æ¥æè¿°ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">PUBLISH</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># éå†æ‰€æœ‰è®¢é˜…é¢‘é“ channel çš„å®¢æˆ·ç«¯</span>    <span class="token keyword">for</span> client <span class="token keyword">in</span> server<span class="token punctuation">.</span>pubsub_channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token comment"># å°†ä¿¡æ¯å‘é€ç»™å®ƒä»¬</span>        send_message<span class="token punctuation">(</span>client<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7-3-3-é€€è®¢é¢‘é“"><a href="#7-3-3-é€€è®¢é¢‘é“" class="headerlink" title="7.3.3 é€€è®¢é¢‘é“"></a>7.3.3 é€€è®¢é¢‘é“</h4><p>ä½¿ç”¨ <a href="http://redis.readthedocs.org/en/latest/pub_sub/unsubscribe.html#unsubscribe">UNSUBSCRIBE</a> å‘½ä»¤å¯ä»¥é€€è®¢æŒ‡å®šçš„é¢‘é“ï¼Œ è¿™ä¸ªå‘½ä»¤æ‰§è¡Œçš„æ˜¯è®¢é˜…çš„åæ“ä½œï¼š å®ƒä» <code>pubsub_channels</code> å­—å…¸çš„ç»™å®šé¢‘é“ï¼ˆé”®ï¼‰ä¸­ï¼Œ åˆ é™¤å…³äºå½“å‰å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œ è¿™æ ·è¢«é€€è®¢é¢‘é“çš„ä¿¡æ¯å°±ä¸ä¼šå†å‘é€ç»™è¿™ä¸ªå®¢æˆ·ç«¯ã€‚</p><h4 id="7-3-4-æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€"><a href="#7-3-4-æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€" class="headerlink" title="7.3.4 æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€"></a>7.3.4 æ¨¡å¼çš„è®¢é˜…ä¸ä¿¡æ¯å‘é€</h4><p>å½“ä½¿ç”¨ <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> å‘½ä»¤å‘é€ä¿¡æ¯åˆ°æŸä¸ªé¢‘é“æ—¶ï¼Œ ä¸ä»…æ‰€æœ‰è®¢é˜…è¯¥é¢‘é“çš„å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¿¡æ¯ï¼Œ å¦‚æœæœ‰æŸä¸ª/æŸäº›æ¨¡å¼å’Œè¿™ä¸ªé¢‘é“åŒ¹é…çš„è¯ï¼Œ é‚£ä¹ˆæ‰€æœ‰è®¢é˜…è¿™ä¸ª/è¿™äº›é¢‘é“çš„å®¢æˆ·ç«¯ä¹ŸåŒæ ·ä¼šæ”¶åˆ°ä¿¡æ¯ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå¸¦æœ‰é¢‘é“å’Œæ¨¡å¼çš„ä¾‹å­ï¼Œ å…¶ä¸­ <code>tweet.shop.*</code> æ¨¡å¼åŒ¹é…äº† <code>tweet.shop.kindle</code> é¢‘é“å’Œ <code>tweet.shop.ipad</code> é¢‘é“ï¼Œ å¹¶ä¸”æœ‰ä¸åŒçš„å®¢æˆ·ç«¯åˆ†åˆ«è®¢é˜…å®ƒä»¬ä¸‰ä¸ªï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-49c2b60cc3c2b52ec1623fbd8a9002eb6f335a54.svg"></p><p>å½“æœ‰ä¿¡æ¯å‘é€åˆ° <code>tweet.shop.kindle</code> é¢‘é“æ—¶ï¼Œ ä¿¡æ¯é™¤äº†å‘é€ç»™ <code>clientX</code> å’Œ <code>clientY</code> ä¹‹å¤–ï¼Œ è¿˜ä¼šå‘é€ç»™è®¢é˜… <code>tweet.shop.*</code> æ¨¡å¼çš„ <code>client123</code> å’Œ <code>client256</code> ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-3d1f513ee0718a326d53152b2b97f82977e38ad6.svg"></p><p>å¦ä¸€æ–¹é¢ï¼Œ å¦‚æœæ¥æ”¶åˆ°ä¿¡æ¯çš„æ˜¯é¢‘é“ <code>tweet.shop.ipad</code> ï¼Œ é‚£ä¹ˆ <code>client123</code> å’Œ <code>client256</code> åŒæ ·ä¼šæ”¶åˆ°ä¿¡æ¯ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-ba8c4d4dd538464659aeb52d6c366f23ad3d0dc1.svg"></p><h4 id="7-3-5-è®¢é˜…æ¨¡å¼"><a href="#7-3-5-è®¢é˜…æ¨¡å¼" class="headerlink" title="7.3.5 è®¢é˜…æ¨¡å¼"></a>7.3.5 è®¢é˜…æ¨¡å¼</h4><p><code>redisServer.pubsub_patterns</code> å±æ€§æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸­ä¿å­˜ç€æ‰€æœ‰å’Œæ¨¡å¼ç›¸å…³çš„ä¿¡æ¯ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">redisServer</span> <span class="token punctuation">{</span>    <span class="token comment">// ...</span>    list <span class="token operator">*</span>pubsub_patterns<span class="token punctuation">;</span>    <span class="token comment">// ...</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ª <code>redis.h/pubsubPattern</code> ç»“æ„ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">pubsubPattern</span> <span class="token punctuation">{</span>    redisClient <span class="token operator">*</span>client<span class="token punctuation">;</span>    robj <span class="token operator">*</span>pattern<span class="token punctuation">;</span><span class="token punctuation">}</span> pubsubPattern<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>client</code> å±æ€§ä¿å­˜ç€è®¢é˜…æ¨¡å¼çš„å®¢æˆ·ç«¯ï¼Œè€Œ <code>pattern</code> å±æ€§åˆ™ä¿å­˜ç€è¢«è®¢é˜…çš„æ¨¡å¼ã€‚</p><p>æ¯å½“è°ƒç”¨ <code>PSUBSCRIBE</code> å‘½ä»¤è®¢é˜…ä¸€ä¸ªæ¨¡å¼æ—¶ï¼Œ ç¨‹åºå°±åˆ›å»ºä¸€ä¸ªåŒ…å«å®¢æˆ·ç«¯ä¿¡æ¯å’Œè¢«è®¢é˜…æ¨¡å¼çš„ <code>pubsubPattern</code> ç»“æ„ï¼Œ å¹¶å°†è¯¥ç»“æ„æ·»åŠ åˆ° <code>redisServer.pubsub_patterns</code> é“¾è¡¨ä¸­ã€‚</p><p>ä½œä¸ºä¾‹å­ï¼Œä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ¨¡å¼çš„ <code>pubsub_patterns</code> é“¾è¡¨ï¼Œ å…¶ä¸­ <code>client123</code> å’Œ <code>client256</code> éƒ½æ­£åœ¨è®¢é˜… <code>tweet.shop.*</code> æ¨¡å¼ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-b8d101c1b582531bce2b0daef87adbaf30ebc195.svg"></p><p>å¦‚æœè¿™æ—¶å®¢æˆ·ç«¯ <code>client10086</code> æ‰§è¡Œ <code>PSUBSCRIBE broadcast.list.*</code> ï¼Œ é‚£ä¹ˆ <code>pubsub_patterns</code> é“¾è¡¨å°†è¢«æ›´æ–°æˆè¿™æ ·ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-a84f3abf466ca19297faaa4e11d37f9257355c60.svg"></p><p>é€šè¿‡éå†æ•´ä¸ª <code>pubsub_patterns</code> é“¾è¡¨ï¼Œç¨‹åºå¯ä»¥æ£€æŸ¥æ‰€æœ‰æ­£åœ¨è¢«è®¢é˜…çš„æ¨¡å¼ï¼Œä»¥åŠè®¢é˜…è¿™äº›æ¨¡å¼çš„å®¢æˆ·ç«¯ã€‚</p><h4 id="7-3-6-å‘é€ä¿¡æ¯åˆ°æ¨¡å¼"><a href="#7-3-6-å‘é€ä¿¡æ¯åˆ°æ¨¡å¼" class="headerlink" title="7.3.6 å‘é€ä¿¡æ¯åˆ°æ¨¡å¼"></a>7.3.6 å‘é€ä¿¡æ¯åˆ°æ¨¡å¼</h4><p>å‘é€ä¿¡æ¯åˆ°æ¨¡å¼çš„å·¥ä½œä¹Ÿæ˜¯ç”± <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> å‘½ä»¤è¿›è¡Œçš„ï¼Œ åœ¨å‰é¢è®²è§£é¢‘é“çš„æ—¶å€™ï¼Œ æˆ‘ä»¬ç»™å‡ºäº†è¿™æ ·ä¸€æ®µä¼ªä»£ç ï¼Œ è¯´å®ƒå®šä¹‰äº† <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> å‘½ä»¤çš„è¡Œä¸ºï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">PUBLISH</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># éå†æ‰€æœ‰è®¢é˜…é¢‘é“ channel çš„å®¢æˆ·ç«¯</span>    <span class="token keyword">for</span> client <span class="token keyword">in</span> server<span class="token punctuation">.</span>pubsub_channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token comment"># å°†ä¿¡æ¯å‘é€ç»™å®ƒä»¬</span>        send_message<span class="token punctuation">(</span>client<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯ï¼Œè¿™æ®µä¼ªä»£ç å¹¶æ²¡æœ‰å®Œæ•´æè¿° <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> å‘½ä»¤çš„è¡Œä¸ºï¼Œ å› ä¸º <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> é™¤äº†å°† <code>message</code> å‘é€åˆ°æ‰€æœ‰è®¢é˜… <code>channel</code> çš„å®¢æˆ·ç«¯ä¹‹å¤–ï¼Œ å®ƒè¿˜ä¼šå°† <code>channel</code> å’Œ <code>pubsub_patterns</code> ä¸­çš„æ¨¡å¼è¿›è¡Œå¯¹æ¯”ï¼Œ å¦‚æœ <code>channel</code> å’ŒæŸä¸ªæ¨¡å¼åŒ¹é…çš„è¯ï¼Œ é‚£ä¹ˆä¹Ÿå°† <code>message</code> å‘é€åˆ°è®¢é˜…é‚£ä¸ªæ¨¡å¼çš„å®¢æˆ·ç«¯ã€‚</p><p>å®Œæ•´æè¿° <a href="http://redis.readthedocs.org/en/latest/pub_sub/publish.html#publish">PUBLISH</a> åŠŸèƒ½çš„ä¼ªä»£ç å®šäºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">PUBLISH</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># éå†æ‰€æœ‰è®¢é˜…é¢‘é“ channel çš„å®¢æˆ·ç«¯</span>    <span class="token keyword">for</span> client <span class="token keyword">in</span> server<span class="token punctuation">.</span>pubsub_channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token comment"># å°†ä¿¡æ¯å‘é€ç»™å®ƒä»¬</span>        send_message<span class="token punctuation">(</span>client<span class="token punctuation">,</span> message<span class="token punctuation">)</span>    <span class="token comment"># å–å‡ºæ‰€æœ‰æ¨¡å¼ï¼Œä»¥åŠè®¢é˜…æ¨¡å¼çš„å®¢æˆ·ç«¯</span>    <span class="token keyword">for</span> pattern<span class="token punctuation">,</span> client <span class="token keyword">in</span> server<span class="token punctuation">.</span>pubsub_patterns<span class="token punctuation">:</span>        <span class="token comment"># å¦‚æœ channel å’Œæ¨¡å¼åŒ¹é…</span>        <span class="token keyword">if</span> match<span class="token punctuation">(</span>channel<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment"># é‚£ä¹ˆä¹Ÿå°†ä¿¡æ¯å‘ç»™è®¢é˜…è¿™ä¸ªæ¨¡å¼çš„å®¢æˆ·ç«¯</span>            send_message<span class="token punctuation">(</span>client<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ Redis æœåŠ¡å™¨çš„ <code>pubsub_patterns</code> çŠ¶æ€å¦‚ä¸‹ï¼š</p><p><img src="/2021/04/06/redis-ji-chu/graphviz-a84f3abf466ca19297faaa4e11d37f9257355c60.svg"></p><p>é‚£ä¹ˆå½“æŸä¸ªå®¢æˆ·ç«¯å‘é€ä¿¡æ¯ <code>"Amazon Kindle, $69."</code> åˆ° <code>tweet.shop.kindle</code> é¢‘é“æ—¶ï¼Œ é™¤äº†æ‰€æœ‰è®¢é˜…äº† <code>tweet.shop.kindle</code> é¢‘é“çš„å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¿¡æ¯ä¹‹å¤–ï¼Œ å®¢æˆ·ç«¯ <code>client123</code> å’Œ <code>client256</code> ä¹ŸåŒæ ·ä¼šæ”¶åˆ°ä¿¡æ¯ï¼Œ å› ä¸ºè¿™ä¸¤ä¸ªå®¢æˆ·ç«¯è®¢é˜…çš„ <code>tweet.shop.*</code> æ¨¡å¼å’Œ <code>tweet.shop.kindle</code> é¢‘é“åŒ¹é…ã€‚</p><h4 id="7-3-7-é€€è®¢æ¨¡å¼"><a href="#7-3-7-é€€è®¢æ¨¡å¼" class="headerlink" title="7.3.7 é€€è®¢æ¨¡å¼"></a>7.3.7 é€€è®¢æ¨¡å¼</h4><p>ä½¿ç”¨ <a href="http://redis.readthedocs.org/en/latest/pub_sub/punsubscribe.html#punsubscribe">PUNSUBSCRIBE</a> å‘½ä»¤å¯ä»¥é€€è®¢æŒ‡å®šçš„æ¨¡å¼ï¼Œ è¿™ä¸ªå‘½ä»¤æ‰§è¡Œçš„æ˜¯è®¢é˜…æ¨¡å¼çš„åæ“ä½œï¼š ç¨‹åºä¼šåˆ é™¤ <code>redisServer.pubsub_patterns</code> é“¾è¡¨ä¸­ï¼Œ æ‰€æœ‰å’Œè¢«é€€è®¢æ¨¡å¼ç›¸å…³è”çš„ <code>pubsubPattern</code> ç»“æ„ï¼Œ è¿™æ ·å®¢æˆ·ç«¯å°±ä¸ä¼šå†æ”¶åˆ°å’Œæ¨¡å¼ç›¸åŒ¹é…çš„é¢‘é“å‘æ¥çš„ä¿¡æ¯ã€‚</p><h2 id="8-ä¸»ä»å¤åˆ¶"><a href="#8-ä¸»ä»å¤åˆ¶" class="headerlink" title="8. ä¸»ä»å¤åˆ¶"></a>8. ä¸»ä»å¤åˆ¶</h2><h3 id="8-1-æ˜¯ä»€ä¹ˆ"><a href="#8-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="8.1 æ˜¯ä»€ä¹ˆ"></a>8.1 æ˜¯ä»€ä¹ˆ</h3><p>ä¸»ä»å¤åˆ¶ï¼ŒæŒ‡çš„æ˜¯å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹ï¼ˆmaster/leaderï¼‰ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹ï¼ˆslave/followerï¼‰ï¼›æ•°æ®çš„å¤åˆ¶éƒ½æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚Masterä»¥å†™ä¸ºä¸»ï¼ŒSlaveä»¥è¯»ä¸ºä¸»ã€‚</p><h3 id="8-2-ä¸ºä»€ä¹ˆ"><a href="#8-2-ä¸ºä»€ä¹ˆ" class="headerlink" title="8.2 ä¸ºä»€ä¹ˆ"></a>8.2 ä¸ºä»€ä¹ˆ</h3><ol><li>æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li>æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°äº†é—®é¢˜ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li>è´Ÿè½½å‡è¡¡ï¼šä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li>é«˜å¯ç”¨åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚</li></ol><h3 id="8-3-æ€ä¹ˆåš"><a href="#8-3-æ€ä¹ˆåš" class="headerlink" title="8.3 æ€ä¹ˆåš"></a>8.3 æ€ä¹ˆåš</h3><p>Slaveå¯åŠ¨æˆåŠŸæˆåŠŸè¿æ¥åˆ°masterä¼šå‘é€ä¸€ä¸ªsyncåŒæ­¥å‘½ä»¤ã€‚</p><p>Masteræ”¶åˆ°åŒæ­¥å‘½ä»¤ï¼Œå¯åŠ¨åå°å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slaveï¼Œå¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚</p><p>å…¨é‡å¤åˆ¶ï¼šslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°masteræ•°æ®åº“æ–‡ä»¶æ•°æ®ï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><p>å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slaveï¼Œå®ŒæˆåŒæ­¥ã€‚</p><h2 id="9-å“¨å…µæ¨¡å¼"><a href="#9-å“¨å…µæ¨¡å¼" class="headerlink" title="9. å“¨å…µæ¨¡å¼"></a>9. å“¨å…µæ¨¡å¼</h2><h3 id="9-1-æ˜¯ä»€ä¹ˆ"><a href="#9-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="9.1 æ˜¯ä»€ä¹ˆ"></a>9.1 æ˜¯ä»€ä¹ˆ</h3><p>è‡ªåŠ¨é€‰æ‹©Masterã€‚èƒ½å¤Ÿè®©åå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“ã€‚</p><h3 id="9-2-ä¸ºä»€ä¹ˆ"><a href="#9-2-ä¸ºä»€ä¹ˆ" class="headerlink" title="9.2 ä¸ºä»€ä¹ˆ"></a>9.2 ä¸ºä»€ä¹ˆ</h3><p>ä¸»ä»åˆ‡æ¢æŠ€æœ¯ï¼Œå½“ä¸»æœåŠ¡å™¨å®•æœºåï¼Œéœ€è¦æ‰‹åŠ¨æŠŠä¸€å°æœåŠ¡å™¨åˆ‡æ¢ä¸ºä¸»æœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦äººå·¥å¹²é¢„ï¼Œè´¹æ—¶è´¹åŠ›ï¼Œè¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡ä¸å¯ç”¨ã€‚è¿™ä¸æ˜¯ä¸€ç§æ¨èçš„æ–¹å¼ï¼Œæ›´å¤šæ—¶å€™ï¼Œä¼˜å…ˆè€ƒè™‘å“¨å…µæ¨¡å¼ã€‚Redis2.8æ­£å¼æä¾›äº†Sentinelï¼ˆå“¨å…µï¼‰æ¶æ„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="9-3-æ€ä¹ˆåš"><a href="#9-3-æ€ä¹ˆåš" class="headerlink" title="9.3 æ€ä¹ˆåš"></a>9.3 æ€ä¹ˆåš</h3><p><img src="/2021/04/06/redis-ji-chu/%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F.PNG"></p><p>å‡è®¾ä¸»æœåŠ¡å™¨å®•æœºï¼Œå“¨å…µ1å…ˆæ£€æµ‹åˆ°è¿™ä¸ªç»“æœï¼Œç³»ç»Ÿå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œfailoverè¿‡ç¨‹ï¼Œä»…ä»…æ˜¯å“¨å…µ1ä¸»è§‚çš„è®¤ä¸ºä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¿™ä¸ªç°è±¡ç§°ä¸ºä¸»è§‚ä¸‹çº¿ã€‚</p><p>å½“åé¢çš„å“¨å…µä¹Ÿæ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå¹¶ä¸”æ•°é‡è¾¾åˆ°ä¸€å®šå€¼æ—¶ï¼Œé‚£ä¹ˆå“¨å…µä¹‹é—´å°±ä¼šè¿›è¡Œä¸€æ¬¡æŠ•ç¥¨ï¼ŒæŠ•ç¥¨çš„ç»“æœç”±ä¸€ä¸ªå“¨å…µå‘èµ·ï¼Œè¿›è¡Œfailoverï¼ˆæ•…éšœè½¬ç§»ï¼‰æ“ä½œã€‚åˆ‡æ¢æˆåŠŸåï¼Œå°±ä¼šå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œè®©å„ä¸ªå“¨å…µæŠŠè‡ªå·±ç›‘æ§çš„ä»æœåŠ¡å™¨å®ç°åˆ‡æ¢ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå®¢è§‚ä¸‹çº¿ã€‚</p><h2 id="10-Redis-ç¼“å­˜ç©¿é€å’Œé›ªå´©"><a href="#10-Redis-ç¼“å­˜ç©¿é€å’Œé›ªå´©" class="headerlink" title="10. Redis ç¼“å­˜ç©¿é€å’Œé›ªå´©"></a>10. Redis ç¼“å­˜ç©¿é€å’Œé›ªå´©</h2><p>éƒ½æ˜¯é«˜å¯ç”¨é—®é¢˜ã€‚</p><h3 id="10-1-ç¼“å­˜ç©¿é€"><a href="#10-1-ç¼“å­˜ç©¿é€" class="headerlink" title="10.1 ç¼“å­˜ç©¿é€"></a>10.1 ç¼“å­˜ç©¿é€</h3><h4 id="10-1-1-æ˜¯ä»€ä¹ˆ"><a href="#10-1-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="10.1.1 æ˜¯ä»€ä¹ˆ"></a>10.1.1 æ˜¯ä»€ä¹ˆ</h4><p>ç”¨æˆ·æƒ³è¦æŸ¥è¯¢çš„æ•°æ®ç¼“å­˜ï¼ˆrediså†…å­˜æ•°æ®åº“ï¼‰æ²¡æœ‰ï¼Œäºæ˜¯å‘æŒä¹…å±‚æ•°æ®åº“æŸ¥è¯¢ã€‚å¾ˆå¤šç”¨æˆ·å‡ºç°æ—¶ï¼Œéƒ½å‘æŒä¹…å±‚æ•°æ®åº“å»æŸ¥è¯¢ï¼Œç»™æŒä¹…å±‚æ•°æ®åº“é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œè¿™å°±æ˜¯ç¼“å­˜ç©¿é€ã€‚</p><h4 id="10-1-2-ä¸ºä»€ä¹ˆ"><a href="#10-1-2-ä¸ºä»€ä¹ˆ" class="headerlink" title="10.1.2 ä¸ºä»€ä¹ˆ"></a>10.1.2 ä¸ºä»€ä¹ˆ</h4><p>å› ä¸ºä¸å¾—ä¸è¦è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="10-1-3-æ€ä¹ˆåš"><a href="#10-1-3-æ€ä¹ˆåš" class="headerlink" title="10.1.3 æ€ä¹ˆåš"></a>10.1.3 æ€ä¹ˆåš</h4><p>æ€ä¹ˆé˜²æ­¢ï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼šå¸ƒéš†è¿‡æ»¤å™¨</li></ul><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯¹æ‰€æœ‰å¯èƒ½æŸ¥è¯¢çš„å‚æ•°ä»¥hashå½¢å¼å­˜å‚¨ï¼Œåœ¨æ§åˆ¶å±‚å…ˆè¿›è¡Œæ ¡éªŒï¼Œä¸ç¬¦åˆåˆ™ä¸¢å¼ƒï¼Œä»è€Œç¬”è¿·æ‹¿äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚</p><ul><li>æ–¹æ¡ˆäºŒï¼šç¼“å­˜ç©ºå¯¹è±¡</li></ul><p><img src="/2021/04/06/redis-ji-chu/%E7%BC%93%E5%AD%98%E7%A9%BA%E5%AF%B9%E8%B1%A1.PNG"></p><p>è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>ç©ºå€¼èƒ½å¤Ÿè¢«ç¼“å­˜ï¼Œæ„å‘³ç€ç¼“å­˜éœ€è¦æ›´å¤šçš„ç©ºé—´å­˜å‚¨æ›´å¤šçš„é”®ï¼Œå› ä¸ºè¿™å½“ä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„ç©ºå€¼é”®ã€‚</li><li>å³ä½¿å¯¹ç©ºå€¼è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚æ•°æ®ä¼šæœ‰ä¸€æ®µæ—¶é—´ä¸ä¸€è‡´ï¼Œè¿™å¯¹äºä¿æŒä¸€è‡´æ€§çš„ä¸šåŠ¡ä¼šæœ‰å½±å“ã€‚</li></ol><h3 id="10-2-ç¼“å­˜å‡»ç©¿"><a href="#10-2-ç¼“å­˜å‡»ç©¿" class="headerlink" title="10.2 ç¼“å­˜å‡»ç©¿"></a>10.2 ç¼“å­˜å‡»ç©¿</h3><h4 id="10-2-1-æ˜¯ä»€ä¹ˆ"><a href="#10-2-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="10.2.1 æ˜¯ä»€ä¹ˆ"></a>10.2.1 æ˜¯ä»€ä¹ˆ</h4><p>ä¸€ä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œkeyå¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨redisä¸­æ­£å¥½è¿‡æœŸã€‚åœ¨è¿‡æœŸçš„æ—¶é—´æ®µå†…è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p><h4 id="10-2-2-ä¸ºä»€ä¹ˆ"><a href="#10-2-2-ä¸ºä»€ä¹ˆ" class="headerlink" title="10.2.2 ä¸ºä»€ä¹ˆ"></a>10.2.2 ä¸ºä»€ä¹ˆ</h4><h4 id="10-2-3-æ€ä¹ˆåš"><a href="#10-2-3-æ€ä¹ˆåš" class="headerlink" title="10.2.3 æ€ä¹ˆåš"></a>10.2.3 æ€ä¹ˆåš</h4><ul><li>æ–¹æ¡ˆä¸€ï¼šSETNX ä½¿ç”¨äº’æ–¥é”ã€‚åªæœ‰ä¸å­˜åœ¨çš„æ—¶å€™æ‰è®¾ç½®ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥å®ç°é”çš„æ•ˆæœã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token class-name">String</span> value <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//ä»£è¡¨ç¼“å­˜å€¼è¿‡æœŸ</span>          <span class="token comment">//è®¾ç½®3minçš„è¶…æ—¶ï¼Œé˜²æ­¢delæ“ä½œå¤±è´¥çš„æ—¶å€™ï¼Œä¸‹æ¬¡ç¼“å­˜è¿‡æœŸä¸€ç›´ä¸èƒ½load db</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span>key_mutex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//ä»£è¡¨è®¾ç½®æˆåŠŸ</span>               value <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>                      redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> expire_secs<span class="token punctuation">)</span><span class="token punctuation">;</span>                      redis<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span>key_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">//è¿™ä¸ªæ—¶å€™ä»£è¡¨åŒæ—¶å€™çš„å…¶ä»–çº¿ç¨‹å·²ç»load dbå¹¶å›è®¾åˆ°ç¼“å­˜äº†ï¼Œè¿™æ—¶å€™é‡è¯•è·å–ç¼“å­˜å€¼å³å¯</span>                      <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//é‡è¯•</span>              <span class="token punctuation">}</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> value<span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ–¹æ¡ˆäºŒï¼šè®¾ç½®æ•°æ®æ°¸ä¸è¿‡æœŸã€‚ï¼ˆå†…å­˜éœ€è¦å¾ˆå¤§ï¼‰</li></ul><h3 id="10-3-é›ªå´©"><a href="#10-3-é›ªå´©" class="headerlink" title="10.3 é›ªå´©"></a>10.3 é›ªå´©</h3><h4 id="10-3-1-æ˜¯ä»€ä¹ˆ"><a href="#10-3-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="10.3.1 æ˜¯ä»€ä¹ˆ"></a>10.3.1 æ˜¯ä»€ä¹ˆ</h4><p>å½“ç¼“å­˜æœåŠ¡å™¨é‡å¯æˆ–è€…å¤§é‡ç¼“å­˜é›†ä¸­åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µå¤±æ•ˆï¼Œè¿™æ ·åœ¨å¤±æ•ˆçš„æ—¶å€™ï¼Œä¹Ÿä¼šç»™åç«¯ç³»ç»Ÿ(æ¯”å¦‚DB)å¸¦æ¥å¾ˆå¤§å‹åŠ›ã€‚</p><h4 id="10-3-2-ä¸ºä»€ä¹ˆ"><a href="#10-3-2-ä¸ºä»€ä¹ˆ" class="headerlink" title="10.3.2 ä¸ºä»€ä¹ˆ"></a>10.3.2 ä¸ºä»€ä¹ˆ</h4><h4 id="10-3-3-æ€ä¹ˆåš"><a href="#10-3-3-æ€ä¹ˆåš" class="headerlink" title="10.3.3 æ€ä¹ˆåš"></a>10.3.3 æ€ä¹ˆåš</h4><ul><li>æ–¹æ¡ˆä¸€ï¼šredisé«˜å¯ç”¨</li></ul><p>æ—¢ç„¶redisæœ‰å¯èƒ½æŒ‚æ‰ï¼Œé‚£æˆ‘å¤šå‡ å°redisï¼Œè¿™æ ·ä¸€å°æŒ‚æ‰åå…¶ä»–è¿˜å¯ä»¥ç»§ç»­å·¥ä½œï¼Œå…¶å®å°±æ˜¯æ­å»ºçš„é›†ç¾¤ã€‚</p><ul><li>æ–¹æ¡ˆäºŒï¼šé™æµé™çº§</li></ul><p>ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡åŠ é”æˆ–è€…é˜Ÿåˆ—æ¥æ§åˆ¶æ•°æ®åº“å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ã€‚æ¯”å¦‚å¯¹æŸä¸ªkeyåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®å’Œå†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚</p><ul><li>æ–¹æ¡ˆä¸‰ï¼šæ•°æ®é¢„çƒ­</li></ul><p>åœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰ï¼ŒæŠŠæ‰€æœ‰å¯èƒ½åŠ è½½åˆ°çš„æ•°æ®é¢„å…ˆè®¿é—®ä¸€éï¼Œè¿™æ ·éƒ¨åˆ†å¯èƒ½å¤§é‡è®¿é—®çš„æ•°æ®å°±ä¼šåŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚å³å°†å‘ç”Ÿå¤§å¹¶å‘è®¿é—®å‰æ‰‹åŠ¨è§¦å‘åŠ è½½ç¼“å­˜ä¸åŒçš„keyï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜çš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ã€‚</p><h2 id="11-æ•°æ®ä¸ä¸€è‡´é—®é¢˜"><a href="#11-æ•°æ®ä¸ä¸€è‡´é—®é¢˜" class="headerlink" title="11. æ•°æ®ä¸ä¸€è‡´é—®é¢˜"></a>11. æ•°æ®ä¸ä¸€è‡´é—®é¢˜</h2><p>Rediså’ŒMySQLçš„æ•°æ®ä¸ä¸€è‡´äº§ç”Ÿçš„æ ¹æºæ˜¯ä¸šåŠ¡éœ€è¦è¿›è¡Œæ›´æ–°(å†™å…¥)æ“ä½œã€‚</p><p>å…ˆæ“ä½œRedis è¿˜æ˜¯ å…ˆæ“ä½œMySQLæ˜¯ä¸ªé—®é¢˜ï¼Œæ“ä½œæ—¶åºä¸åŒäº§ç”Ÿçš„å½±å“ä¹Ÿä¸åŒã€‚</p><p>å°ºæœ‰æ‰€çŸ­ï¼Œå¯¸æœ‰æ‰€é•¿ï¼Œè¯´åˆ°åº•æ˜¯ä¸€ç§æƒè¡¡ï¼Œå“ªä¸€ç§ç»„åˆäº§ç”Ÿçš„è´Ÿé¢å½±å“å¯¹ä¸šåŠ¡æœ€å°ï¼Œå°±å€¾å‘äºå“ªç§æ–¹æ¡ˆã€‚</p><p>ç¼“å­˜ç³»ç»Ÿçš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œæ˜¯ä¸ªç»å…¸çš„é—®é¢˜ï¼Œå› æ­¤è‚¯å®šæœ‰å¾ˆå¤šè§£å†³é—®é¢˜çš„å¥—è·¯ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¸¦ç€åˆ†æå’Œæ€è€ƒå»çœ‹çœ‹ï¼Œå„ä¸ªæ–¹æ¡ˆçš„åˆ©å¼Šã€‚</p><p><strong>æ€è·¯ä¸€ï¼šè®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´</strong></p><p>å½“å‘Rediså†™å…¥ä¸€æ¡æ•°æ®æ—¶ï¼ŒåŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´xç§’ï¼Œä¸šåŠ¡ä¸åŒè¿‡æœŸæ—¶é—´ä¸åŒã€‚</p><p>è¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶Rediså°±ä¼šåˆ æ‰è¿™æ¡æ•°æ®ï¼Œåç»­è¯»è¯·æ±‚Rediså‡ºç°Cache Missï¼Œè¿›è€Œè¯»å–MySQLï¼Œç„¶åæŠŠæ•°æ®å†™åˆ°Redisã€‚</p><p>å¦‚æœå‘ç”Ÿæ›´æ–°æ“ä½œæ—¶ï¼Œåªæ“ä½œMySQLï¼Œé‚£ä¹ˆRedisä¸­çš„æ•°æ®æ›´æ–°å°±åªæ˜¯ä¾èµ–äºè¿‡æœŸæ—¶é—´æ¥ä¿åº•ï¼Œæ·˜æ±°åå†è¢«åŠ è½½å°±æ˜¯æ–°æ•°æ®äº†ã€‚</p><p>ç”»å¤–éŸ³ï¼šè¿™ç§æ–¹æ¡ˆæ˜¯æœ€ç®€å•çš„ï¼Œå¦‚æœä¸šåŠ¡å¯¹çŸ­æ—¶é—´ä¸ä¸€è‡´é—®é¢˜å¹¶ä¸åœ¨æ„ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´çš„æ–¹æ¡ˆå°±è¶³å¤Ÿäº†ï¼Œæ²¡æœ‰å¿…è¦æå¤ªå¤æ‚ã€‚</p><p><strong>æ€è·¯äºŒï¼šå…ˆæ·˜æ±°ç¼“å­˜&amp;å†æ›´æ–°ä¸»å­˜</strong></p><p>è¿›è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œä¸ºäº†é˜²æ­¢å…¶ä»–çº¿ç¨‹è¯»åˆ°ç¼“å­˜ä¸­çš„æ—§æ•°æ®ï¼Œå¹²è„†æ·˜æ±°æ‰ï¼Œç„¶åæŠŠæ•°æ®æ›´æ–°åˆ°ä¸»å­˜å‚¨ï¼Œåç»­çš„è¯·æ±‚å†æ¬¡è¯»å–æ—¶è§¦å‘Cache Missï¼Œä»è€Œè¯»å–MySQLå†å°†æ–°æ•°æ®æ›´æ–°åˆ°Redisã€‚</p><p><a href="https://s5.51cto.com/oss/202104/18/32ced2ae2665c3a2482d7eaa2d880cfa.png"><img src="/2021/04/06/redis-ji-chu/32ced2ae2665c3a2482d7eaa2d880cfa.png" alt="img"></a></p><ul><li>åœ¨T1æ—¶åˆ»ï¼šRediså’ŒMySQLå¯¹äºageçš„å€¼éƒ½æ˜¯18ï¼ŒäºŒè€…ä¸€è‡´;</li><li>åœ¨T2æ—¶åˆ»ï¼šæœ‰æ›´æ–°è¯·æ±‚éœ€è¦è®¾ç½®age=20ï¼Œæ­¤æ—¶Redisä¸­å°±æ²¡æœ‰ageè¿™ä¸ªæ•°æ®äº†;åœ¨å®ŒæˆRedisæ·˜æ±°åï¼Œè¿›è¡ŒMySQLæ•°æ®æ›´æ–°age=20;</li></ul><p>è¿™ä¸ªæ–¹æ¡ˆå¬ç€è¿˜ä¸é”™çš„æ ·å­ï¼Œä½†æ˜¯è¯»å†™è¯·æ±‚éƒ½æ˜¯å¹¶å‘çš„ï¼Œå…ˆåé¡ºåºå®Œå…¨æ— æ³•é¢„æµ‹ï¼Œç”šè‡³åå‘å‡ºçš„è¯·æ±‚å…ˆå¤„ç†å®Œæˆï¼Œä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ã€‚</p><p>å¯è§ä¸€ä¸ªæ˜æ˜¾çš„æ¼æ´ï¼šåœ¨æ·˜æ±°Redisçš„æ•°æ®å®Œæˆåï¼Œæ›´æ–°MySQLå®Œæˆä¹‹å‰ï¼Œè¿™ä¸ªæ—¶é—´æ®µå†…å¦‚æœæœ‰æ–°çš„è¯»è¯·æ±‚è¿‡æ¥ï¼Œå‘ç°Cache Missäº†ï¼Œå°±ä¼šæŠŠæ—§æ•°æ®é‡æ–°å†™åˆ°Redisä¸­ï¼Œå†æ¬¡é€ æˆä¸ä¸€è‡´ï¼Œå¹¶ä¸”æ¯«æ— å¯Ÿè§‰åç»­è¯»çš„éƒ½æ˜¯æ—§æ•°æ®ã€‚</p><p><a href="https://s3.51cto.com/oss/202104/18/222bab6d0ea863ad4e2e97c39c4ed5e4.png"><img src="/2021/04/06/redis-ji-chu/222bab6d0ea863ad4e2e97c39c4ed5e4.png" alt="img"></a></p><p>ç”»å¤–éŸ³ï¼šè¿™ä¸ªæ–¹æ¡ˆå…¶å®ä¸èƒ½è¯´å®Œå…¨æ²¡æœ‰ç”¨ï¼Œä½†æ˜¯è‡³å°‘ä¸å®Œç¾å§ã€‚</p><h3 id="æ€è·¯ä¸‰ï¼šå…ˆæ›´æ–°ä¸»å­˜-amp-å†æ·˜æ±°ç¼“å­˜"><a href="#æ€è·¯ä¸‰ï¼šå…ˆæ›´æ–°ä¸»å­˜-amp-å†æ·˜æ±°ç¼“å­˜" class="headerlink" title="æ€è·¯ä¸‰ï¼šå…ˆæ›´æ–°ä¸»å­˜&amp;å†æ·˜æ±°ç¼“å­˜"></a>æ€è·¯ä¸‰ï¼šå…ˆæ›´æ–°ä¸»å­˜&amp;å†æ·˜æ±°ç¼“å­˜</h3><p>è¿›è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œå…ˆæ›´æ–°MySQLï¼ŒæˆåŠŸä¹‹åï¼Œæ·˜æ±°ç¼“å­˜ï¼Œåç»­è¯»å–è¯·æ±‚æ—¶è§¦å‘Cache Misså†å°†æ–°æ•°æ®å›å†™Redisã€‚</p><p><a href="https://s5.51cto.com/oss/202104/18/7b22bb7a62cff14508fd7009905828d7.png"><img src="/2021/04/06/redis-ji-chu/7b22bb7a62cff14508fd7009905828d7.png" alt="img"></a></p><p>è¿™ç§æ¨¡å¼åœ¨æ›´æ–°MySQLå’Œæ·˜æ±°Redisè¿™æ®µæ—¶é—´å†…ï¼Œè¯·æ±‚è¯»å–çš„è¿˜æ˜¯Redisçš„æ—§æ•°æ®ï¼Œä¸è¿‡ç­‰MySQLæ›´æ–°å®Œæˆï¼Œå°±å¯ä»¥ç«‹åˆ»æ¢å¤ä¸€è‡´ï¼Œå½±å“ç›¸å¯¹æ¯”è¾ƒå°ã€‚</p><p><a href="https://s4.51cto.com/oss/202104/18/4d460d288713e562d017f8f2cdb2cb8b.png"><img src="/2021/04/06/redis-ji-chu/4d460d288713e562d017f8f2cdb2cb8b.png" alt="img"></a></p><p>ä¸Šè¿°æ˜¯åœ¨ç¼“å­˜ä¸­æœ‰æ•°æ®çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯T2æ—¶åˆ»çš„è¯»è¯·æ±‚æ²¡æœ‰è§¦å‘Cache Missï¼Œä¹Ÿå°±ä¸ä¼šæ›´æ–°ç¼“å­˜ï¼Œå› æ­¤é—®é¢˜ä¸å¤§ã€‚</p><p>ä½†æ˜¯ï¼Œå‡å¦‚T2æ—¶åˆ»è¯»å–çš„æ•°æ®åœ¨ç¼“å­˜æ²¡æœ‰ï¼Œé‚£ä¹ˆè§¦å‘Cache Missåä¼šäº§ç”Ÿå›å†™ï¼Œå‡å¦‚è¿™ä¸ªå›å†™åŠ¨ä½œæ˜¯åœ¨T4æ—¶åˆ»å®Œæˆï¼Œé‚£ä¹ˆå†™å…¥çš„è¿˜æ˜¯è€æ•°æ®ï¼Œå¦‚å›¾ï¼š</p><p><a href="https://s4.51cto.com/oss/202104/18/5985e39605da8ddbe03ebfe3dffd8946.png-wh_600x-s_290050075.png"><img src="/2021/04/06/redis-ji-chu/5985e39605da8ddbe03ebfe3dffd8946.png-wh_600x-s_290050075.png" alt="img"></a></p><p>è¿™ç§æƒ…å†µç¡®å®æœ‰é—®é¢˜ï¼Œä½†æ˜¯çœŸæ˜¯å¤ªå·§äº†å§ï¼Œåˆ†æä¸€ä¸‹ï¼š</p><ul><li>äº‹ä»¶Aï¼šæ·˜æ±°Rediså‰æ¥äº†ä¸€ä¸ªè¯»è¯·æ±‚;</li><li>äº‹ä»¶Bï¼šT2æ—¶åˆ»çš„è¯»è¯·æ±‚è§¦å‘äº†Cache Miss;</li><li>äº‹ä»¶Cï¼šå›å†™Rediså‘ç”Ÿåœ¨æ·˜æ±°ç¼“å­˜ä¹‹å;</li></ul><p>é‚£ä¹ˆå‘ç”Ÿé—®é¢˜çš„æ¦‚ç‡å°±æ˜¯P(A)*P(B)*P(C)ï¼Œä»å®é™…è€ƒè™‘è¿™ç§ç»¼åˆäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡éå¸¸ä½ï¼Œå› ä¸ºå†™æ“ä½œè¿œæ…¢äºè¯»æ“ä½œï¼Œä¹Ÿå°±æ˜¯å›¾ä¸Šçš„T4äº‹ä»¶å¤§æ¦‚ç‡æ˜¯å‘ç”Ÿåœ¨T3äº‹ä»¶ä¹‹å‰çš„ã€‚</p><p>ç”»å¤–éŸ³ï¼šå…ˆæ›´æ–°MySQLå†æ·˜æ±°Redisçš„æ–¹æ¡ˆï¼Œè™½ç„¶å­˜åœ¨å°æ¦‚ç‡ä¸ä¸€è‡´é—®é¢˜ï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´å·¥ç¨‹ä¸Šæ˜¯å¯ç”¨çš„ï¼Œæ¯”å¦‚éè¦è¯´å†™å®ŒMySQLæŒ‚äº†ï¼ŒRediså°±æ²¡æ·˜æ±°ï¼Œè¿™ç§æƒ…å†µåªèƒ½è¯´ç¡®å®æœ‰é—®é¢˜ã€‚</p><h3 id="æ€è·¯å››ï¼šå»¶æ—¶åŒåˆ -æ·˜æ±°"><a href="#æ€è·¯å››ï¼šå»¶æ—¶åŒåˆ -æ·˜æ±°" class="headerlink" title="æ€è·¯å››ï¼šå»¶æ—¶åŒåˆ (æ·˜æ±°)"></a>æ€è·¯å››ï¼šå»¶æ—¶åŒåˆ (æ·˜æ±°)</h3><p>å‰é¢æåˆ°çš„æ€è·¯äºŒå’Œæ€è·¯ä¸‰éƒ½åªæœ‰ä¸€æ¬¡Redisæ·˜æ±°æ“ä½œï¼Œè¿™é‡Œè¦è¯´çš„å»¶æ—¶åŒåˆ æœ¬è´¨ä¸Šæ˜¯æ€è·¯äºŒå’Œæ€è·¯ä¸‰çš„ç»“åˆï¼š</p><p><a href="https://s2.51cto.com/oss/202104/18/debdfb9c6c6e7d93e0959d240ce75d54.png-wh_600x-s_3948280338.png"><img src="/2021/04/06/redis-ji-chu/debdfb9c6c6e7d93e0959d240ce75d54.png-wh_600x-s_3948280338.png" alt="img"></a></p><p>è¯´å®è¯ä¸ªäººè§‰å¾—ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ‰ç‚¹å †æ“ä½œçš„æ„Ÿè§‰ï¼Œè€Œä¸”è®¾ç½®å»¶æ—¶çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…æ€è·¯ä¸‰çš„å°æ¦‚ç‡é—®é¢˜ï¼Œå»¶æ—¶è®¾ç½®å¤šä¹…ä¸å¥½ç¡®å®šï¼ŒäºŒæ¥å»¶æ—¶é™ä½äº†å¹¶å‘æ€§èƒ½ï¼ŒåŒæ—¶å‰ç½®çš„åˆ é™¤ç¼“å­˜æ“ä½œèµ·åˆ°çš„ä½œç”¨å¹¶ä¸å¤§ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆå€’æ˜¯é€éœ²å‡ºä¸€ç§æ€æƒ³ï¼šå¤šåˆ å‡ æ¬¡ï¼Œå¯èƒ½ä¸€è‡´æ€§æ›´æœ‰ä¿è¯ï¼Œé‚£ç¡®å®å¦‚æ­¤ï¼Œä½†æ˜¯å‘½ä¸­ç‡ä¹Ÿå°±ä½äº†ï¼Œå‘½ä¸­ç‡å’Œä¸€è‡´æ€§çœ‹æ¥ä¹Ÿæ˜¯ä¸€å¯¹çŸ›ç›¾ã€‚</p><p>ç”»å¤–éŸ³ï¼šè¿™ä¸ªæ–¹æ¡ˆä¹Ÿä¸æ˜¯è¯´ä¸è¡Œï¼Œå…¶å®æœ‰ç‚¹éº»çƒ¦ï¼Œå¹¶ä¸”åœ¨å¤æ‚é«˜å¹¶å‘åœºæ™¯ä¸­åè€Œå½±å“æ€§èƒ½ï¼Œè¦æ˜¯ä¸€èˆ¬çš„åœºæ™¯æˆ–è®¸ä¹Ÿèƒ½ç”¨èµ·æ¥ã€‚</p><h3 id="æ€è·¯äº”ï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜"><a href="#æ€è·¯äº”ï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜" class="headerlink" title="æ€è·¯äº”ï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜"></a>æ€è·¯äº”ï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜</h3><p>æ—¢ç„¶ç›´æ¥æ“ä½œMySQLå’ŒRediséƒ½å¤šå°‘å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½å¼•å…¥ä¸­é—´å±‚æ¥è§£å†³é—®é¢˜å‘¢?</p><p>æŠŠMySQLçš„æ›´æ–°æ“ä½œå®Œæˆåä¸ç›´æ¥æ“ä½œRedisï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªæ“ä½œå‘½ä»¤(æ¶ˆæ¯)æ‰”åˆ°ä¸€ä¸ªä¸­é—´å±‚ï¼Œç„¶åç”±Redisè‡ªå·±æ¥æ¶ˆè´¹æ›´æ–°æ•°æ®ï¼Œè¿™æ˜¯ä¸€ç§è§£è€¦çš„å¼‚æ­¥æ–¹æ¡ˆã€‚</p><p><a href="https://s5.51cto.com/oss/202104/18/a098eb9f48abb2d5e3be936259d1ee56.png-wh_600x-s_2588560741.png"><img src="/2021/04/06/redis-ji-chu/a098eb9f48abb2d5e3be936259d1ee56.png-wh_600x-s_2588560741.png" alt="img"></a></p><p>å•çº¯ä¸ºäº†æ›´æ–°ç¼“å­˜å¼•å…¥ä¸­é—´ä»¶ç¡®å®æœ‰äº›å¤æ‚ï¼Œä½†æ˜¯åƒMySQLæä¾›äº†binlogçš„åŒæ­¥æœºåˆ¶ï¼Œæ­¤æ—¶Rediså°±ä½œä¸ºSlaveè¿›è¡Œä¸»ä»åŒæ­¥ï¼Œå®ç°æ•°æ®çš„æ›´æ–°ï¼Œæˆæœ¬ä¹Ÿè¿˜å¯ä»¥æ¥å—ã€‚</p><h3 id="12-é¢è¯•é¢˜ï¼ˆ1ï¼‰"><a href="#12-é¢è¯•é¢˜ï¼ˆ1ï¼‰" class="headerlink" title="12. é¢è¯•é¢˜ï¼ˆ1ï¼‰"></a>12. é¢è¯•é¢˜ï¼ˆ1ï¼‰</h3><h4 id="12-1-Redisä¸Memcached"><a href="#12-1-Redisä¸Memcached" class="headerlink" title="12.1 Redisä¸Memcached"></a>12.1 Redisä¸Memcached</h4><h3 id="12-2-redisåˆ†å¸ƒå¼é”"><a href="#12-2-redisåˆ†å¸ƒå¼é”" class="headerlink" title="12.2 redisåˆ†å¸ƒå¼é”"></a>12.2 redisåˆ†å¸ƒå¼é”</h3><p>å¤šä¸ªæœåŠ¡é—´ï¼Œä¿è¯åŒä¸€æ—¶åˆ»å†…åŒä¸€ä¸ªç”¨æˆ·åªèƒ½ç”±ä¸€ä¸ªè¯·æ±‚ï¼Œé˜²æ­¢å…³é”®ä¸šåŠ¡å‡ºç°æ•°æ®å†²çªã€‚</p><p>ç”µå•†åº“å­˜ ä¼šå‡ºç°è¶…å–ç°è±¡ã€‚</p><p>redisåšåˆ†å¸ƒå¼é”è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ</p><ol><li>å•æœºç‰ˆçš„JVM é”è§£å†³ä¸äº†åŒæ—¶å¹¶å‘è®¿é—®redisçš„é—®é¢˜ï¼Œæ¯”å¦‚ç”µå•†åº“å­˜ä¼šå‡ºç°è¶…å–ç°è±¡ã€‚</li><li>ä½¿ç”¨seté”æ—¶ï¼Œä¸åŠ è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœç¨‹åºä¸šåŠ¡é€»è¾‘å´©äº†ï¼Œé‚£ä¹ˆåé¢çš„ç¨‹åºéƒ½æ— æ³•ç»§ç»­ä¸šåŠ¡é€»è¾‘ã€‚</li><li>setå¿…é¡»åŠ è¿‡æœŸæ—¶é—´ï¼Œå¹¶ä¸”è¿‡æœŸæ—¶é—´å’Œè·å¾—é”çš„è¯­å¥æ˜¯åŸå­æ€§çš„æ‰è¡Œï¼Œé˜²æ­¢è·å¾—é”äº†ä½†æ˜¯å´©äº†æ²¡è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</li><li>å¦‚æœä¸šåŠ¡æ‰§è¡Œè¶…è¿‡äº†è¿‡æœŸæ—¶é—´ï¼Œé”è‡ªåŠ¨è¿‡æœŸäº†ï¼Œç„¶åå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°äº†é”ï¼Œç»“æœåˆšæ‰é‚£ä¸ªä¸šåŠ¡æ‰§è¡Œå®ŒæŠŠé”åˆ äº†ã€‚ï¼ˆ<strong>æˆ‘æ­£åœ¨åœ¨ä¸Šå•æ‰€ï¼Œæ˜æ˜è®°å¾—é”å•æ‰€é—¨äº†ã€‚ç»“æœçªç„¶é”æ²¡äº†ï¼Œå¦å¤–ä¸€ä¸ªäººåˆè¿›æ¥äº†ï¼Œé‚£æˆ‘ã€‚ã€‚ã€‚å“¦ä¸å¥½åƒé‚£ä¸ªçº¿ç¨‹ä¹Ÿå°´å°¬</strong>ï¼‰ã€‚æ‰€ä»¥åªèƒ½åˆ é™¤è‡ªå·±çš„é”ã€‚</li><li>å½“å‰çº¿ç¨‹åˆ¤æ–­æ˜¯ä¸æ˜¯åˆ é™¤çš„è‡ªå·±çš„é”ã€‚keyæ˜¯é”ï¼Œvalueæ˜¯UUIDå’Œå½“å‰çº¿ç¨‹åå­—ã€‚</li><li>ä½†æ˜¯finallyä¸­çš„deleteåˆ é™¤æ“ä½œä¸æ˜¯åŸå­æ€§çš„ luaè„šæœ¬ï¼Œä¿è¯åŸå­æ€§åˆ é™¤ã€‚<strong>å¦‚æœä¸ç”¨luaè„šæœ¬ï¼Œå¼€å¯redisçš„äº‹åŠ¡ã€‚</strong></li></ol><p>redisäº‹åŠ¡æ˜¯ä¸ªé›†åˆé˜Ÿåˆ—ï¼Œä¼šæŠŠé˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ‰§è¡Œå®Œæ¯•(multi exec watch discard)ã€‚</p><ol start="7"><li>è¿˜æœ‰ä¸€ä¸ªè§£å†³çš„é—®é¢˜ï¼Œç¡®ä¿redisLockè¿‡æœŸæ—¶é—´å¤§äºä¸šåŠ¡æ‰§è¡Œæ—¶é—´çš„é—®é¢˜ã€‚redisåˆ†å¸ƒå¼é”è¦ç»­æœŸã€‚<strong>ä½¿ç”¨redisson</strong>å¦‚æœç›´æ¥ä½¿ç”¨lockå’Œunlockï¼Œé‚£ä¹ˆä¼šå‡ºç°illegalmonitorçŠ¶æ€å¼‚å¸¸ï¼Œä¸Šé”å’Œè§£é”çš„ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ã€‚</li></ol><p>æ‰€ä»¥éœ€è¦ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>redissonLock<span class="token punctuation">.</span><span class="token function">isLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span>redissonLock<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹è¿›è¡Œè§£é”</span>        redissonLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>rediså•ç‚¹éƒ¨ç½²ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œæ¯”å¦‚ä¸»ä»æ¨¡å¼ï¼Œæœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ</p><p>CAPé›†ç¾¤æ•…éšœã€‚masterå’Œslaveæ¨¡å¼ä¸‹ï¼Œredisæœ¬èº«æ˜¯APï¼ŒmasteråˆšåˆšåŠ ä¸Šé”ï¼Œmasterå®•æœºäº†ä½†æ˜¯slaveæ²¡æ¥å¾—åŠé”åŒæ­¥ã€‚ä»æœºæˆäº†masterå¯¼è‡´äº†é”ä¸¢å¤±ã€‚Zookeeper æ˜¯CPï¼Œå…¨éƒ¨åŒæ­¥å®Œæˆäº†æ‰ä¼šå‘Šè¯‰å¯¹æ–¹æœ‰é”äº†ã€‚</p><p>ç„¶åä¸ºäº†redisç‰›é€¼è¿™ç§æƒ…å†µä¸‹ä¹Ÿç‰›é€¼ï¼Œå‡ºç°äº†redissonã€‚</p><p>redissson çš„redlockã€‚</p><p>RedLock redission è°ˆä¸€è°ˆ</p><p>redisåˆ†å¸ƒå¼é”å¦‚ä½•ç»­æœŸ çœ‹é—¨ç‹—çŸ¥é“å—ï¼Ÿ</p><p>è¿™æ˜¯redissonçš„ä¸€äº›æ“ä½œï¼Œçœ‹é—¨ç‹—æœºåˆ¶ã€‚</p><h3 id="12-3-redisè®¾ç½®å†…å­˜"><a href="#12-3-redisè®¾ç½®å†…å­˜" class="headerlink" title="12.3 redisè®¾ç½®å†…å­˜"></a>12.3 redisè®¾ç½®å†…å­˜</h3><p>redis é…ç½®æ–‡ä»¶ maxmemory byte ï¼ˆ859è¡Œï¼‰ </p><p>64ä½æœºå­é»˜è®¤ å ç”¨å…¨éƒ¨å†…å­˜ 32ä½ 3Gå¤§å°</p><p>è¿˜å¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œ <code>config get maxmemory</code> <code>config set maxmeroty xxx</code></p><h3 id="12-4-å¦‚æœrediså†…å­˜å¤§äºè®¾å®šçš„"><a href="#12-4-å¦‚æœrediså†…å­˜å¤§äºè®¾å®šçš„" class="headerlink" title="12.4 å¦‚æœrediså†…å­˜å¤§äºè®¾å®šçš„"></a>12.4 å¦‚æœrediså†…å­˜å¤§äºè®¾å®šçš„</h3><p>redisä¼šOOMæŠ¥é”™ï¼ŒæŠ¥é”™å¤§äºmaxmeroryã€‚</p><h3 id="12-5-è¿‡æœŸç­–ç•¥"><a href="#12-5-è¿‡æœŸç­–ç•¥" class="headerlink" title="12.5 è¿‡æœŸç­–ç•¥"></a>12.5 è¿‡æœŸç­–ç•¥</h3><p>å¦‚æœä¸€ä¸ªé”®è¿‡æœŸæ—¶é—´åˆ°äº†ï¼Œä¸ä¼šç«‹é©¬åˆ é™¤ã€‚ç«‹å³åˆ é™¤å¯¹CPUä¸å‹å¥½ã€‚</p><p>å®ƒä¼šï¼š</p><p>å®šæ—¶åˆ é™¤ï¼Œå®šæœŸåˆ é™¤ï¼Œæƒ°æ€§åˆ é™¤ã€‚ å®šæœŸæ˜¯å¯¹å¦å¤–ä¸¤ç§æ“ä½œçš„æŠ˜ä¸­ã€‚æ¯é—´éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œåˆ é™¤æ“ä½œåšï¼Œé€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹CPUæ—¶é—´çš„å½±å“ï¼ˆå‘¨æœŸæ€§æŠ½æŸ¥å­˜å‚¨ç©ºé—´ï¼ŒéšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥ï¼‰ã€‚</p><p>å®šæœŸåˆ é™¤ä¼šäº§ç”Ÿæ¼ç½‘ä¹‹é±¼ï¼Œå®šæœŸåˆ é™¤æ—¶æŸä¸ªkeyä¸€ç›´æ²¡æœ‰è¢«æŠ½æŸ¥è¿‡ï¼Œä¼šæœ‰å¤§é‡çš„keyå †ç§¯å†…å­˜ä¸­ã€‚</p><p>æ‰€ä»¥æœ‰äº†å†…å­˜æ·˜æ±°ç­–ç•¥äº§ç”Ÿäº†ã€‚</p><p><img src="/2021/04/06/redis-ji-chu/image-20210817101710454.png" alt="image-20210817101710454"></p><p><img src="/2021/04/06/redis-ji-chu/image-20210817101846479.png" alt="image-20210817101846479"></p><p>ä¸€èˆ¬éƒ½æ˜¯ç”¨LRUç®—æ³•ã€‚éšæœºçš„ä¸å¯æ§å•Šã€‚</p><p>é€šè¿‡å‘½ä»¤å’Œé…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚ é…ç½®æ–‡ä»¶ä¸­<code>maxmemory policy all-keys-lru</code> `config  </p>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>javaä¸­hashMapåŸç†</title>
      <link href="2021/04/01/java-zhong-hash-yuan-li/"/>
      <url>2021/04/01/java-zhong-hash-yuan-li/</url>
      
        <content type="html"><![CDATA[<h3 id="å“ˆå¸Œ"><a href="#å“ˆå¸Œ" class="headerlink" title="å“ˆå¸Œ"></a>å“ˆå¸Œ</h3><p><strong>Hashï¼Œä¸€èˆ¬ç¿»è¯‘åšâ€œæ•£åˆ—â€ï¼Œä¹Ÿæœ‰ç›´æ¥éŸ³è¯‘ä¸ºâ€œå“ˆå¸Œâ€çš„ï¼Œå°±æ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œé€šè¿‡æ•£åˆ—ç®—æ³•ï¼Œå˜æ¢æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¯¥è¾“å‡ºå°±æ˜¯æ•£åˆ—å€¼ã€‚</strong>è¿™ç§è½¬æ¢æ˜¯ä¸€ç§å‹ç¼©æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯ï¼Œæ•£åˆ—å€¼çš„ç©ºé—´é€šå¸¸è¿œå°äºè¾“å…¥çš„ç©ºé—´ï¼Œä¸åŒçš„è¾“å…¥å¯èƒ½ä¼šæ•£åˆ—æˆç›¸åŒçš„è¾“å‡ºï¼Œæ‰€ä»¥ä¸å¯èƒ½ä»æ•£åˆ—å€¼æ¥å”¯ä¸€çš„ç¡®å®šè¾“å…¥å€¼ã€‚ç®€å•çš„è¯´å°±æ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯å‹ç¼©åˆ°æŸä¸€å›ºå®šé•¿åº¦çš„æ¶ˆæ¯æ‘˜è¦çš„å‡½æ•°ã€‚</p><p>æ‰€æœ‰æ•£åˆ—å‡½æ•°éƒ½æœ‰å¦‚ä¸‹ä¸€ä¸ªåŸºæœ¬ç‰¹æ€§ï¼š<strong>æ ¹æ®åŒä¸€æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºçš„æ•£åˆ—å€¼å¦‚æœä¸åŒï¼Œé‚£ä¹ˆè¾“å…¥å€¼è‚¯å®šä¹Ÿä¸åŒã€‚ä½†æ˜¯ï¼Œæ ¹æ®åŒä¸€æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºçš„æ•£åˆ—å€¼å¦‚æœç›¸åŒï¼Œè¾“å…¥å€¼ä¸ä¸€å®šç›¸åŒã€‚</strong></p><p><strong>ä¸¤ä¸ªä¸åŒçš„è¾“å…¥å€¼ï¼Œæ ¹æ®åŒä¸€æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºçš„æ•£åˆ—å€¼ç›¸åŒçš„ç°è±¡å«åšç¢°æ’ã€‚</strong></p><p>å¸¸è§çš„Hashå‡½æ•°æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><blockquote><p>ç›´æ¥å®šå€æ³•ï¼šç›´æ¥ä»¥å…³é”®å­—kæˆ–è€…kåŠ ä¸ŠæŸä¸ªå¸¸æ•°ï¼ˆk+cï¼‰ä½œä¸ºå“ˆå¸Œåœ°å€ã€‚</p><p>æ•°å­—åˆ†ææ³•ï¼šæå–å…³é”®å­—ä¸­å–å€¼æ¯”è¾ƒå‡åŒ€çš„æ•°å­—ä½œä¸ºå“ˆå¸Œåœ°å€ã€‚</p><p>é™¤ç•™ä½™æ•°æ³•ï¼šç”¨å…³é”®å­—ké™¤ä»¥æŸä¸ªä¸å¤§äºå“ˆå¸Œè¡¨é•¿åº¦mçš„æ•°pï¼Œå°†æ‰€å¾—ä½™æ•°ä½œä¸ºå“ˆå¸Œè¡¨åœ°å€ã€‚</p><p>åˆ†æ®µå åŠ æ³•ï¼šæŒ‰ç…§å“ˆå¸Œè¡¨åœ°å€ä½æ•°å°†å…³é”®å­—åˆ†æˆä½æ•°ç›¸ç­‰çš„å‡ éƒ¨åˆ†ï¼Œå…¶ä¸­æœ€åä¸€éƒ¨åˆ†å¯ä»¥æ¯”è¾ƒçŸ­ã€‚ç„¶åå°†è¿™å‡ éƒ¨åˆ†ç›¸åŠ ï¼Œèˆå¼ƒæœ€é«˜è¿›ä½åçš„ç»“æœå°±æ˜¯è¯¥å…³é”®å­—çš„å“ˆå¸Œåœ°å€ã€‚</p><p>å¹³æ–¹å–ä¸­æ³•ï¼šå¦‚æœå…³é”®å­—å„ä¸ªéƒ¨åˆ†åˆ†å¸ƒéƒ½ä¸å‡åŒ€çš„è¯ï¼Œå¯ä»¥å…ˆæ±‚å‡ºå®ƒçš„å¹³æ–¹å€¼ï¼Œç„¶åæŒ‰ç…§éœ€æ±‚å–ä¸­é—´çš„å‡ ä½ä½œä¸ºå“ˆå¸Œåœ°å€ã€‚</p><p>ä¼ªéšæœºæ•°æ³•ï¼šé‡‡ç”¨ä¸€ä¸ªä¼ªéšæœºæ•°å½“ä½œå“ˆå¸Œå‡½æ•°ã€‚</p></blockquote><p>ä¸Šé¢ä»‹ç»è¿‡ç¢°æ’ã€‚è¡¡é‡ä¸€ä¸ªå“ˆå¸Œå‡½æ•°çš„å¥½åçš„é‡è¦æŒ‡æ ‡å°±æ˜¯å‘ç”Ÿç¢°æ’çš„æ¦‚ç‡ä»¥åŠå‘ç”Ÿç¢°æ’çš„è§£å†³æ–¹æ¡ˆã€‚ä»»ä½•å“ˆå¸Œå‡½æ•°åŸºæœ¬éƒ½æ— æ³•å½»åº•é¿å…ç¢°æ’ï¼Œå¸¸è§çš„è§£å†³ç¢°æ’çš„æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>å¼€æ”¾å®šå€æ³•ï¼š<ul><li>å¼€æ”¾å®šå€æ³•å°±æ˜¯ä¸€æ—¦å‘ç”Ÿäº†å†²çªï¼Œå°±å»å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºçš„æ•£åˆ—åœ°å€ï¼Œåªè¦æ•£åˆ—è¡¨è¶³å¤Ÿå¤§ï¼Œç©ºçš„æ•£åˆ—åœ°å€æ€»èƒ½æ‰¾åˆ°ï¼Œå¹¶å°†è®°å½•å­˜å…¥ã€‚</li></ul></li><li>é“¾åœ°å€æ³•<ul><li>å°†å“ˆå¸Œè¡¨çš„æ¯ä¸ªå•å…ƒä½œä¸ºé“¾è¡¨çš„å¤´ç»“ç‚¹ï¼Œæ‰€æœ‰å“ˆå¸Œåœ°å€ä¸ºiçš„å…ƒç´ æ„æˆä¸€ä¸ªåŒä¹‰è¯é“¾è¡¨ã€‚å³å‘ç”Ÿå†²çªæ—¶å°±æŠŠè¯¥å…³é”®å­—é“¾åœ¨ä»¥è¯¥å•å…ƒä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨çš„å°¾éƒ¨ã€‚</li></ul></li><li>å†å“ˆå¸Œæ³•<ul><li>å½“å“ˆå¸Œåœ°å€å‘ç”Ÿå†²çªç”¨å…¶ä»–çš„å‡½æ•°è®¡ç®—å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°åœ°å€ï¼Œç›´åˆ°å†²çªä¸å†äº§ç”Ÿä¸ºæ­¢ã€‚</li></ul></li><li>å»ºç«‹å…¬å…±æº¢å‡ºåŒº<ul><li>å°†å“ˆå¸Œè¡¨åˆ†ä¸ºåŸºæœ¬è¡¨å’Œæº¢å‡ºè¡¨ä¸¤éƒ¨åˆ†ï¼Œå‘ç”Ÿå†²çªçš„å…ƒç´ éƒ½æ”¾å…¥æº¢å‡ºè¡¨ä¸­ã€‚</li></ul></li></ul><h2 id="1-HashMap-çš„æ•°æ®ç»“æ„"><a href="#1-HashMap-çš„æ•°æ®ç»“æ„" class="headerlink" title="1. HashMap çš„æ•°æ®ç»“æ„"></a>1. HashMap çš„æ•°æ®ç»“æ„</h2><p>åœ¨Javaä¸­ï¼Œä¿å­˜æ•°æ®æœ‰ä¸¤ç§æ¯”è¾ƒç®€å•çš„æ•°æ®ç»“æ„ï¼šæ•°ç»„å’Œé“¾è¡¨ã€‚<strong>æ•°ç»„çš„ç‰¹ç‚¹æ˜¯ï¼šå¯»å€å®¹æ˜“ï¼Œæ’å…¥å’Œåˆ é™¤å›°éš¾ï¼›è€Œé“¾è¡¨çš„ç‰¹ç‚¹æ˜¯ï¼šå¯»å€å›°éš¾ï¼Œæ’å…¥å’Œåˆ é™¤å®¹æ˜“ã€‚</strong>ä¸Šé¢æˆ‘ä»¬æåˆ°è¿‡ï¼Œå¸¸ç”¨çš„å“ˆå¸Œå‡½æ•°çš„å†²çªè§£å†³åŠæ³•ä¸­æœ‰ä¸€ç§æ–¹æ³•å«åšé“¾åœ°å€æ³•ï¼Œå…¶å®å°±æ˜¯å°†æ•°ç»„å’Œé“¾è¡¨ç»„åˆåœ¨ä¸€èµ·ï¼Œå‘æŒ¥äº†ä¸¤è€…çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸ºé“¾è¡¨çš„æ•°ç»„ã€‚</p><p><a href="http://www.hollischuang.com/wp-content/uploads/2018/03/640.png"><img src="/2021/04/01/java-zhong-hash-yuan-li/640.png" alt="640"></a></p><p>æˆ‘ä»¬å¯ä»¥ä»ä¸Šå›¾çœ‹åˆ°ï¼Œå·¦è¾¹å¾ˆæ˜æ˜¾æ˜¯ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªæˆå‘˜æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚è¯¥æ•°æ®ç»“æ„æ‰€å®¹çº³çš„æ‰€æœ‰å…ƒç´ å‡åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼Œç”¨äºå…ƒç´ é—´çš„é“¾æ¥ã€‚æˆ‘ä»¬æ ¹æ®å…ƒç´ çš„è‡ªèº«ç‰¹å¾æŠŠå…ƒç´ åˆ†é…åˆ°ä¸åŒçš„é“¾è¡¨ä¸­å»ï¼Œåè¿‡æ¥æˆ‘ä»¬ä¹Ÿæ­£æ˜¯é€šè¿‡è¿™äº›ç‰¹å¾æ‰¾åˆ°æ­£ç¡®çš„é“¾è¡¨ï¼Œå†ä»é“¾è¡¨ä¸­æ‰¾å‡ºæ­£ç¡®çš„å…ƒç´ ã€‚å…¶ä¸­ï¼Œæ ¹æ®å…ƒç´ ç‰¹å¾è®¡ç®—å…ƒç´ æ•°ç»„ä¸‹æ ‡çš„æ–¹æ³•å°±æ˜¯å“ˆå¸Œç®—æ³•ï¼Œå³æœ¬æ–‡çš„ä¸»è§’hash()å‡½æ•°ï¼ˆå½“ç„¶ï¼Œè¿˜åŒ…æ‹¬indexOf()å‡½æ•°ï¼‰ã€‚</p><h3 id="1-è‡ªåŠ¨æ‰©å®¹"><a href="#1-è‡ªåŠ¨æ‰©å®¹" class="headerlink" title="1. è‡ªåŠ¨æ‰©å®¹"></a>1. è‡ªåŠ¨æ‰©å®¹</h3><blockquote><p>æœ€å°å¯ç”¨åŸåˆ™ï¼Œå®¹é‡è¶…è¿‡ä¸€å®šé˜ˆå€¼ä¾¿è‡ªåŠ¨è¿›è¡Œæ‰©å®¹ã€‚</p></blockquote><p>æ‰©å®¹æ˜¯é€šè¿‡<code>resize()</code>æ–¹æ³•å®ç°çš„ã€‚æ‰©å®¹æ”¾ç”Ÿåœ¨putValæ–¹æ³•çš„æœ€åï¼Œå³å†™å…¥å…ƒç´ ä¹‹åæ‰ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå½“è‡ªå¢åæ•°ç»„çš„sizeå¤§äºä¹‹å‰æ‰€è®¡ç®—å¥½çš„<code>threshold</code>ï¼Œå³æ‰§è¡Œ<code>resize</code>æ“ä½œã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/hashmap1.PNG"></p><p>æ‰©å®¹(resize)å°±æ˜¯é‡æ–°è®¡ç®—å®¹é‡ï¼Œå‘HashMapå¯¹è±¡é‡Œä¸åœçš„æ·»åŠ å…ƒç´ ï¼Œè€ŒHashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦æ‰©å¤§æ•°ç»„çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½è£…å…¥æ›´å¤šçš„å…ƒç´ ã€‚å½“ç„¶Javaé‡Œçš„æ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ•°ç»„ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œå°±åƒæˆ‘ä»¬ç”¨ä¸€ä¸ªå°æ¡¶è£…æ°´ï¼Œå¦‚æœæƒ³è£…æ›´å¤šçš„æ°´ï¼Œå°±å¾—æ¢å¤§æ°´æ¡¶ã€‚</p><p>æˆ‘ä»¬åˆ†æä¸‹resizeçš„æºç ï¼Œé‰´äºJDK1.8èå…¥äº†çº¢é»‘æ ‘ï¼Œè¾ƒå¤æ‚ï¼Œä¸ºäº†ä¾¿äºç†è§£ä½¿ç”¨JDK1.7çš„ä»£ç ï¼Œå¥½ç†è§£ä¸€äº›ï¼Œæœ¬è´¨ä¸ŠåŒºåˆ«ä¸å¤§ï¼Œå…·ä½“åŒºåˆ«åæ–‡å†è¯´ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token number">1</span> <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> newCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//ä¼ å…¥æ–°çš„å®¹é‡</span> <span class="token number">2</span>     <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTable <span class="token operator">=</span> table<span class="token punctuation">;</span>    <span class="token comment">//å¼•ç”¨æ‰©å®¹å‰çš„Entryæ•°ç»„</span> <span class="token number">3</span>     <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> oldTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>          <span class="token number">4</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">==</span> MAXIMUM_CAPACITY<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§(2^30)äº†</span> <span class="token number">5</span>         threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span> <span class="token comment">//ä¿®æ”¹é˜ˆå€¼ä¸ºintçš„æœ€å¤§å€¼(2^31-1)ï¼Œè¿™æ ·ä»¥åå°±ä¸ä¼šæ‰©å®¹äº†</span> <span class="token number">6</span>         <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token number">7</span>     <span class="token punctuation">}</span> <span class="token number">8</span>   <span class="token number">9</span>     <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>newCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Entryæ•°ç»„</span><span class="token number">10</span>     <span class="token function">transfer</span><span class="token punctuation">(</span>newTable<span class="token punctuation">)</span><span class="token punctuation">;</span>                         <span class="token comment">//ï¼ï¼å°†æ•°æ®è½¬ç§»åˆ°æ–°çš„Entryæ•°ç»„é‡Œ</span><span class="token number">11</span>     table <span class="token operator">=</span> newTable<span class="token punctuation">;</span>                           <span class="token comment">//HashMapçš„tableå±æ€§å¼•ç”¨æ–°çš„Entryæ•°ç»„</span><span class="token number">12</span>     threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>newCapacity <span class="token operator">*</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¿®æ”¹é˜ˆå€¼</span><span class="token number">13</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„æ¥ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œtransfer()æ–¹æ³•å°†åŸæœ‰Entryæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„é‡Œã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token number">1</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">2</span>     <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> src <span class="token operator">=</span> table<span class="token punctuation">;</span>                   <span class="token comment">//srcå¼•ç”¨äº†æ—§çš„Entryæ•°ç»„</span> <span class="token number">3</span>     <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> newTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token number">4</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//éå†æ—§çš„Entryæ•°ç»„</span> <span class="token number">5</span>         <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> src<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>             <span class="token comment">//å–å¾—æ—§Entryæ•°ç»„çš„æ¯ä¸ªå…ƒç´ </span> <span class="token number">6</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">7</span>             src<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//é‡Šæ”¾æ—§Entryæ•°ç»„çš„å¯¹è±¡å¼•ç”¨ï¼ˆforå¾ªç¯åï¼Œæ—§çš„Entryæ•°ç»„ä¸å†å¼•ç”¨ä»»ä½•å¯¹è±¡ï¼‰</span> <span class="token number">8</span>             <span class="token keyword">do</span> <span class="token punctuation">{</span> <span class="token number">9</span>                 <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span><span class="token number">10</span>                 <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ï¼ï¼é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®</span><span class="token number">11</span>                 e<span class="token punctuation">.</span>next <span class="token operator">=</span> newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//æ ‡è®°[1]</span><span class="token number">12</span>                 newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>      <span class="token comment">//å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Š</span><span class="token number">13</span>                 e <span class="token operator">=</span> next<span class="token punctuation">;</span>             <span class="token comment">//è®¿é—®ä¸‹ä¸€ä¸ªEntryé“¾ä¸Šçš„å…ƒç´ </span><span class="token number">14</span>             <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">15</span>         <span class="token punctuation">}</span><span class="token number">16</span>     <span class="token punctuation">}</span><span class="token number">17</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>newTable[i]çš„å¼•ç”¨èµ‹ç»™äº†e.nextï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ï¼ŒåŒä¸€ä½ç½®ä¸Šæ–°å…ƒç´ æ€»ä¼šè¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ä½ç½®ï¼›è¿™æ ·å…ˆæ”¾åœ¨ä¸€ä¸ªç´¢å¼•ä¸Šçš„å…ƒç´ ç»ˆä¼šè¢«æ”¾åˆ°Entryé“¾çš„å°¾éƒ¨(å¦‚æœå‘ç”Ÿäº†hashå†²çªçš„è¯ï¼‰ï¼Œè¿™ä¸€ç‚¹å’ŒJdk1.8æœ‰åŒºåˆ«ï¼Œä¸‹æ–‡è¯¦è§£ã€‚åœ¨æ—§æ•°ç»„ä¸­åŒä¸€æ¡Entryé“¾ä¸Šçš„å…ƒç´ ï¼Œé€šè¿‡é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®åï¼Œæœ‰å¯èƒ½è¢«æ”¾åˆ°äº†æ–°æ•°ç»„çš„ä¸åŒä½ç½®ä¸Šã€‚</p><p>ä¸‹é¢ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸‹æ‰©å®¹è¿‡ç¨‹ã€‚å‡è®¾äº†æˆ‘ä»¬çš„hashç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨key mod ä¸€ä¸‹è¡¨çš„å¤§å°ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ã€‚å…¶ä¸­çš„å“ˆå¸Œæ¡¶æ•°ç»„tableçš„size=2ï¼Œ æ‰€ä»¥key = 3ã€7ã€5ï¼Œputé¡ºåºä¾æ¬¡ä¸º 5ã€7ã€3ã€‚åœ¨mod 2ä»¥åéƒ½å†²çªåœ¨table[1]è¿™é‡Œäº†ã€‚è¿™é‡Œå‡è®¾è´Ÿè½½å› å­ loadFactor=1ï¼Œå³å½“é”®å€¼å¯¹çš„å®é™…å¤§å°size å¤§äº tableçš„å®é™…å¤§å°æ—¶è¿›è¡Œæ‰©å®¹ã€‚æ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯å“ˆå¸Œæ¡¶æ•°ç»„ resizeæˆ4ï¼Œç„¶åæ‰€æœ‰çš„Nodeé‡æ–°rehashçš„è¿‡ç¨‹ã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/e5aa99e811d1814e010afa7779b759d4_b-1617780223521.png" alt="img"></p><p>ä¸‹é¢æˆ‘ä»¬è®²è§£ä¸‹JDK1.8åšäº†å“ªäº›ä¼˜åŒ–ã€‚ç»è¿‡è§‚æµ‹å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚çœ‹ä¸‹å›¾å¯ä»¥æ˜ç™½è¿™å¥è¯çš„æ„æ€ï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸é«˜ä½è¿ç®—ç»“æœã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/a285d9b2da279a18b052fe5eed69afe9_b.png" alt="img"></p><p>å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/b2cb057773e3d67976c535d6ef547d51_b.png" alt="img"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦åƒJDK1.7çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/544caeb82a329fa49cc99842818ed1ba_b.png" alt="img"></p><p>è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚è¿™ä¸€å—å°±æ˜¯JDK1.8æ–°å¢çš„ä¼˜åŒ–ç‚¹ã€‚æœ‰ä¸€ç‚¹æ³¨æ„åŒºåˆ«ï¼ŒJDK1.7ä¸­rehashçš„æ—¶å€™ï¼Œæ—§é“¾è¡¨è¿ç§»æ–°é“¾è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåœ¨æ–°è¡¨çš„æ•°ç»„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™é“¾è¡¨å…ƒç´ ä¼šå€’ç½®ï¼Œä½†æ˜¯ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒJDK1.8ä¸ä¼šå€’ç½®ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token number">1</span> <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">2</span>     <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span> <span class="token number">3</span>     <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token number">4</span>     <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span> <span class="token number">5</span>     <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">6</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">7</span>         <span class="token comment">// è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§</span> <span class="token number">8</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&gt;=</span> MAXIMUM_CAPACITY<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">9</span>             threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span><span class="token number">10</span>             <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span><span class="token number">11</span>         <span class="token punctuation">}</span><span class="token number">12</span>         <span class="token comment">// æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€</span><span class="token number">13</span>         <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token generics"><span class="token punctuation">&lt;</span> MAXIMUM_CAPACITY <span class="token operator">&amp;</span><span class="token operator">&amp;</span>14                  oldCap <span class="token punctuation">&gt;</span></span><span class="token operator">=</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span><span class="token number">15</span>             newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// double threshold</span><span class="token number">16</span>     <span class="token punctuation">}</span><span class="token number">17</span>     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// initial capacity was placed in threshold</span><span class="token number">18</span>         newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span><span class="token number">19</span>     <span class="token keyword">else</span> <span class="token punctuation">{</span>               <span class="token comment">// zero initial threshold signifies using defaults</span><span class="token number">20</span>         newCap <span class="token operator">=</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">;</span><span class="token number">21</span>         newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DEFAULT_LOAD_FACTOR <span class="token operator">*</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">22</span>     <span class="token punctuation">}</span><span class="token number">23</span>     <span class="token comment">// è®¡ç®—æ–°çš„resizeä¸Šé™</span><span class="token number">24</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">25</span> <span class="token number">26</span>         <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span><span class="token number">27</span>         newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> MAXIMUM_CAPACITY <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>MAXIMUM_CAPACITY <span class="token operator">?</span><span class="token number">28</span>                   <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">29</span>     <span class="token punctuation">}</span><span class="token number">30</span>     threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span><span class="token number">31</span>     <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"rawtypes"</span>ï¼Œ<span class="token string">"unchecked"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token number">32</span>         <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token number">33</span>     table <span class="token operator">=</span> newTab<span class="token punctuation">;</span><span class="token number">34</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">35</span>         <span class="token comment">// æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­</span><span class="token number">36</span>         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">37</span>             <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span><span class="token number">38</span>             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">39</span>                 oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token number">40</span>                 <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token number">41</span>                     newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span><span class="token number">42</span>                 <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span><span class="token number">43</span>                     <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">44</span>                 <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// é“¾è¡¨ä¼˜åŒ–é‡hashçš„ä»£ç å—</span><span class="token number">45</span>                     <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token number">46</span>                     <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token number">47</span>                     <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span><span class="token number">48</span>                     <span class="token keyword">do</span> <span class="token punctuation">{</span><span class="token number">49</span>                         next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span><span class="token number">50</span>                         <span class="token comment">// åŸç´¢å¼•</span><span class="token number">51</span>                         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">52</span>                             <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token number">53</span>                                 loHead <span class="token operator">=</span> e<span class="token punctuation">;</span><span class="token number">54</span>                             <span class="token keyword">else</span><span class="token number">55</span>                                 loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span><span class="token number">56</span>                             loTail <span class="token operator">=</span> e<span class="token punctuation">;</span><span class="token number">57</span>                         <span class="token punctuation">}</span><span class="token number">58</span>                         <span class="token comment">// åŸç´¢å¼•+oldCap</span><span class="token number">59</span>                         <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token number">60</span>                             <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token number">61</span>                                 hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span><span class="token number">62</span>                             <span class="token keyword">else</span><span class="token number">63</span>                                 hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span><span class="token number">64</span>                             hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span><span class="token number">65</span>                         <span class="token punctuation">}</span><span class="token number">66</span>                     <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">67</span>                     <span class="token comment">// åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ</span><span class="token number">68</span>                     <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">69</span>                         loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token number">70</span>                         newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span><span class="token number">71</span>                     <span class="token punctuation">}</span><span class="token number">72</span>                     <span class="token comment">// åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ</span><span class="token number">73</span>                     <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">74</span>                         hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token number">75</span>                         newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span><span class="token number">76</span>                     <span class="token punctuation">}</span><span class="token number">77</span>                 <span class="token punctuation">}</span><span class="token number">78</span>             <span class="token punctuation">}</span><span class="token number">79</span>         <span class="token punctuation">}</span><span class="token number">80</span>     <span class="token punctuation">}</span><span class="token number">81</span>     <span class="token keyword">return</span> newTab<span class="token punctuation">;</span><span class="token number">82</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šå›¾ä¸­çš„putvalæ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœtableè¿˜æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆæ‰©å®¹æ•°ç»„å¤§å°ã€‚</p><p>å¦‚æœtableçš„åœ¨ï¼ˆn-1ï¼‰&amp;hashçš„å€¼æ˜¯ç©ºï¼Œå°±æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹æ’å…¥åœ¨è¯¥ä½ç½®ï¼Œå¦åˆ™è¡¨ç¤ºæœ‰å†²çª,å¼€å§‹å¤„ç†å†²çªã€‚æ£€æŸ¥ç¬¬ä¸€ä¸ªnodeæ˜¯ä¸æ˜¯è¦æ‰¾çš„å€¼ï¼Œå¦åˆ™éœ€è¦éå†é“¾è¡¨ã€‚å¦‚æœå†²çªçš„èŠ‚ç‚¹æ•°å·²ç»å¤§äº8ä¸ªï¼Œéœ€è¦å°†å­˜å‚¨ç»“æ„å˜ä¸ºçº¢é»‘æ ‘(treeifyBin(tab, hash));</p><h3 id="2-çº¿ç¨‹å®‰å…¨æ€§"><a href="#2-çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="2. çº¿ç¨‹å®‰å…¨æ€§"></a>2. çº¿ç¨‹å®‰å…¨æ€§</h3><p>åœ¨å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨çº¿ç¨‹ä¸å®‰å…¨çš„HashMapï¼Œè€Œä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¯´HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¸‹é¢ä¸¾ä¾‹å­è¯´æ˜åœ¨å¹¶å‘çš„å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­ä½¿ç”¨HashMapå¯èƒ½é€ æˆæ­»å¾ªç¯ã€‚ä»£ç ä¾‹å­å¦‚ä¸‹(ä¾¿äºç†è§£ï¼Œä»ç„¶ä½¿ç”¨JDK1.7çš„ç¯å¢ƒ)ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMapInfiniteLoop</span> <span class="token punctuation">{</span>      <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span>ï¼Œ<span class="token number">0.75f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">5</span>ï¼Œ <span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token string">"Thread1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token string">"Thread2"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> "<span class="token class-name">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ï¼Œmapåˆå§‹åŒ–ä¸ºä¸€ä¸ªé•¿åº¦ä¸º2çš„æ•°ç»„ï¼ŒloadFactor=0.75ï¼Œthreshold=2*0.75=1ï¼Œä¹Ÿå°±æ˜¯è¯´å½“putç¬¬äºŒä¸ªkeyçš„æ—¶å€™ï¼Œmapå°±éœ€è¦è¿›è¡Œresizeã€‚</p><p>é€šè¿‡è®¾ç½®æ–­ç‚¹è®©çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶debugåˆ°transferæ–¹æ³•(3.3å°èŠ‚ä»£ç å—)çš„é¦–è¡Œã€‚æ³¨æ„æ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹å·²ç»æˆåŠŸæ·»åŠ æ•°æ®ã€‚æ”¾å¼€thread1çš„æ–­ç‚¹è‡³transferæ–¹æ³•çš„â€œEntry next = e.next;â€ è¿™ä¸€è¡Œï¼›ç„¶åæ”¾å¼€çº¿ç¨‹2çš„çš„æ–­ç‚¹ï¼Œè®©çº¿ç¨‹2è¿›è¡Œresizeã€‚ç»“æœå¦‚ä¸‹å›¾ã€‚</p><p><img src="https://pic4.zhimg.com/fa10635a66de637fe3cbd894882ff0c7_b.png" alt="img"></p><p>æ³¨æ„ï¼ŒThread1çš„ e æŒ‡å‘äº†key(3)ï¼Œè€ŒnextæŒ‡å‘äº†key(7)ï¼Œå…¶åœ¨çº¿ç¨‹äºŒrehashåï¼ŒæŒ‡å‘äº†çº¿ç¨‹äºŒé‡ç»„åçš„é“¾è¡¨ã€‚</p><p>çº¿ç¨‹ä¸€è¢«è°ƒåº¦å›æ¥æ‰§è¡Œï¼Œå…ˆæ˜¯æ‰§è¡Œ newTalbe[i] = eï¼Œ ç„¶åæ˜¯e = nextï¼Œå¯¼è‡´äº†eæŒ‡å‘äº†key(7)ï¼Œè€Œä¸‹ä¸€æ¬¡å¾ªç¯çš„next = e.nextå¯¼è‡´äº†nextæŒ‡å‘äº†key(3)ã€‚</p><p><img src="https://pic4.zhimg.com/d39d7eff6e8e04f98f5b53bebe2d4d7f_b.png" alt="img"></p><p>e.next = newTable[i] å¯¼è‡´ key(3).next æŒ‡å‘äº† key(7)ã€‚æ³¨æ„ï¼šæ­¤æ—¶çš„key(7).next å·²ç»æŒ‡å‘äº†key(3)ï¼Œ ç¯å½¢é“¾è¡¨å°±è¿™æ ·å‡ºç°äº†ã€‚</p><p><img src="https://pic2.zhimg.com/5f3cf5300f041c771a736b40590fd7b1_b.png" alt="img"></p><p>äºæ˜¯ï¼Œå½“æˆ‘ä»¬ç”¨çº¿ç¨‹ä¸€è°ƒç”¨map.get(11)æ—¶ï¼Œæ‚²å‰§å°±å‡ºç°äº†â€”â€”Infinite Loopã€‚</p><h4 id="2-1-æ­»é“¾"><a href="#2-1-æ­»é“¾" class="headerlink" title="2.1 æ­»é“¾"></a>2.1 æ­»é“¾</h4><p>åœ¨JDK1.8ä¹‹å‰ï¼ŒHashMapåœ¨å¹¶å‘åœºæ™¯ä¸‹æ‰©å®¹æ—¶å­˜åœ¨ä¸€ä¸ªbugï¼Œå½¢æˆæ­»é“¾ï¼Œå¯¼è‡´getè¯¥ä½ç½®å…ƒç´ çš„æ—¶å€™ï¼Œä¼šæ­»å¾ªç¯ï¼Œä½¿CPUåˆ©ç”¨ç‡é«˜å±…ä¸ä¸‹ã€‚è¿™ä¹Ÿè¯´æ˜äº†HashMapä¸é€‚äºç”¨åœ¨é«˜å¹¶å‘çš„åœºæ™¯ï¼Œé«˜å¹¶å‘åº”è¯¥ä¼˜å…ˆè€ƒè™‘JUCä¸­çš„ConcurrentHashMapã€‚ç„¶è€Œï¼Œç²¾ç›Šæ±‚ç²¾çš„JDKå¼€å‘è€…ä»¬å¹¶æ²¡æœ‰é€‰æ‹©ç»•è¿‡é—®é¢˜ï¼Œè€Œæ˜¯é€‰æ‹©ç›´é¢é—®é¢˜å¹¶è§£å†³å®ƒã€‚åœ¨JDK1.8ä¹‹ä¸­ï¼Œå¼•å…¥äº†é«˜ä½ä½é“¾è¡¨ï¼ˆåŒç«¯é“¾è¡¨ï¼‰ã€‚</p><p>ä»€ä¹ˆæ˜¯é«˜ä½ä½é“¾è¡¨å‘¢ï¼Ÿåœ¨æ‰©å®¹æ—¶ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„bucketsä¼šæ‰©å®¹ä¸€å€ï¼Œä»¥å®¹é‡ä¸º8çš„HashMapä¸ºä¾‹ï¼ŒåŸæœ‰å®¹é‡8æ‰©å®¹è‡³16ï¼Œå°†[0, 7]ç§°ä¸ºä½ä½ï¼Œ[8, 15]ç§°ä¸ºé«˜ä½ï¼Œä½ä½å¯¹åº”loHeadã€loTailï¼Œé«˜ä½å¯¹åº”hiHeadã€hiTailã€‚</p><p>æ‰©å®¹æ—¶ä¼šä¾æ¬¡éå†æ—§bucketsæ•°ç»„çš„æ¯ä¸€ä¸ªä½ç½®ä¸Šé¢çš„å…ƒç´ ï¼š</p><ul><li>è‹¥ä¸å­˜åœ¨å†²çªï¼Œåˆ™é‡æ–°è¿›è¡Œhashå–æ¨¡ï¼Œå¹¶copyåˆ°æ–°bucketsæ•°ç»„ä¸­çš„å¯¹åº”ä½ç½®ã€‚</li><li>è‹¥å­˜åœ¨å†²çªå…ƒç´ ï¼Œåˆ™é‡‡ç”¨é«˜ä½ä½é“¾è¡¨è¿›è¡Œå¤„ç†ã€‚é€šè¿‡e.hash &amp; oldCapæ¥åˆ¤æ–­å–æ¨¡åæ˜¯è½åœ¨é«˜ä½è¿˜æ˜¯ä½ä½ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾å½“å‰å…ƒç´ hashCodeä¸º0001ï¼ˆå¿½ç•¥é«˜ä½ï¼‰ï¼Œå…¶è¿ç®—ç»“æœç­‰äº0ï¼Œè¯´æ˜æ‰©å®¹åç»“æœä¸å˜ï¼Œå–æ¨¡åè¿˜æ˜¯è½åœ¨ä½ä½[0, 7]ï¼Œå³0001 &amp; 1000 = 0000ï¼Œè¿˜æ˜¯åŸä½ç½®ï¼Œå†ç”¨ä½ä½é“¾è¡¨å°†è¿™ç±»çš„å…ƒç´ é“¾æ¥èµ·æ¥ã€‚å‡è®¾å½“å‰å…ƒç´ çš„hashCodeä¸º1001ï¼Œ å…¶è¿ç®—ç»“æœä¸ä¸º0ï¼Œå³1001 &amp; 1000 = 1000 ï¼Œæ‰©å®¹åä¼šè½åœ¨é«˜ä½ï¼Œæ–°çš„ä½ç½®åˆšå¥½æ˜¯æ—§æ•°ç»„ç´¢å¼•ï¼ˆ1ï¼‰ + æ—§æ•°æ®é•¿åº¦ï¼ˆ8ï¼‰ = 9ï¼Œå†ç”¨é«˜ä½é“¾è¡¨å°†è¿™äº›å…ƒç´ é“¾æ¥èµ·æ¥ã€‚æœ€åï¼Œå°†é«˜ä½ä½é“¾è¡¨çš„å¤´èŠ‚ç‚¹åˆ†åˆ«æ”¾åœ¨æ‰©å®¹åæ•°ç»„newTabçš„æŒ‡å®šä½ç½®ä¸Šï¼Œå³å®Œæˆäº†æ‰©å®¹æ“ä½œã€‚è¿™ç§å®ç°é™ä½äº†å¯¹å…±äº«èµ„æºnewTabçš„è®¿é—®é¢‘æ¬¡ï¼Œå…ˆç»„ç»‡å†²çªèŠ‚ç‚¹ï¼Œæœ€åå†æ”¾å…¥newTabçš„æŒ‡å®šä½ç½®ã€‚é¿å…äº†JDK1.8ä¹‹å‰æ¯éå†ä¸€ä¸ªå…ƒç´ å°±æ”¾å…¥newTabä¸­ï¼Œä»è€Œå¯¼è‡´å¹¶å‘æ‰©å®¹ä¸‹çš„æ­»é“¾é—®é¢˜ã€‚</li></ul><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-3b9a5de58b2275fa0f4b090471a6b598_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-3b9a5de58b2275fa0f4b090471a6b598_1440w.jpg" alt="img"></p><h3 id="3-åˆå§‹åŒ–ä¸æ‡’åŠ è½½"><a href="#3-åˆå§‹åŒ–ä¸æ‡’åŠ è½½" class="headerlink" title="3. åˆå§‹åŒ–ä¸æ‡’åŠ è½½"></a>3. åˆå§‹åŒ–ä¸æ‡’åŠ è½½</h3><blockquote><p>åˆå§‹åŒ–çš„æ—¶å€™åªä¼šè®¾ç½®é»˜è®¤çš„è´Ÿè½½å› å­ï¼Œå¹¶ä¸ä¼šè¿›è¡Œå…¶ä»–åˆå§‹åŒ–çš„æ“ä½œï¼Œåœ¨é¦–æ¬¡ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚</p></blockquote><p>å½“newä¸€ä¸ªæ–°çš„HashMapçš„æ—¶å€™ï¼Œä¸ä¼šç«‹å³å¯¹å“ˆå¸Œæ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œæ˜¯åœ¨é¦–æ¬¡putå…ƒç´ çš„æ—¶å€™ï¼Œé€šè¿‡resize()æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-52dd5001cc4f80503f1b2c644bd55863_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-52dd5001cc4f80503f1b2c644bd55863_1440w.jpg" alt="img"></p><p>resize()ä¸­ä¼šè®¾ç½®é»˜è®¤çš„åˆå§‹åŒ–å®¹é‡DEFAULT_INITIAL_CAPACITYä¸º16ï¼Œæ‰©å®¹çš„é˜ˆå€¼ä¸º0.75*16 = 12ï¼Œå³å“ˆå¸Œæ¡¶æ•°ç»„ä¸­å…ƒç´ è¾¾åˆ°12ä¸ªä¾¿è¿›è¡Œæ‰©å®¹æ“ä½œã€‚</p><p>æœ€ååˆ›å»ºå®¹é‡ä¸º16çš„Nodeæ•°ç»„ï¼Œå¹¶èµ‹å€¼ç»™æˆå‘˜å˜é‡å“ˆå¸Œæ¡¶tableï¼Œå³å®Œæˆäº†HashMapçš„åˆå§‹åŒ–æ“ä½œã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-167705cc7c0f7dacede4345e5b38a838_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-167705cc7c0f7dacede4345e5b38a838_1440w.jpg" alt="img"></p><h3 id="4-ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„å¤§å°"><a href="#4-ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„å¤§å°" class="headerlink" title="4 ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„å¤§å°"></a>4 ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„å¤§å°</h3><blockquote><p>æ‰¾åˆ°å¤§äºç­‰äºç»™å®šå€¼çš„æœ€å°2çš„æ•´æ•°æ¬¡å¹‚ã€‚</p></blockquote><p>tableSizeForæ ¹æ®è¾“å…¥å®¹é‡å¤§å°capæ¥è®¡ç®—æœ€ç»ˆå“ˆå¸Œæ¡¶æ•°ç»„çš„å®¹é‡å¤§å°ï¼Œæ‰¾åˆ°å¤§äºç­‰äºç»™å®šå€¼capçš„æœ€å°2çš„æ•´æ•°æ¬¡å¹‚ã€‚ä¹çœ¼ä¸€çœ‹ï¼Œè¿™ä¸€è¡Œä¸€è¡Œçš„ä½è¿ç®—è®©äººäº‘é‡Œé›¾é‡Œï¼Œè«ä¸å¦‚é‡‡ç”¨ç±»ä¼¼æ‰¾è§„å¾‹çš„æ–¹å¼æ¥æ¢ç´¢å…¶ä¸­çš„å¥¥ç§˜ã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-f2301f2430f3ae06db4e72ff4f018e74_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-f2301f2430f3ae06db4e72ff4f018e74_1440w.jpg" alt="img"></p><p>å½“capä¸º3æ—¶ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">cap <span class="token operator">=</span> <span class="token number">3</span>n <span class="token operator">=</span> <span class="token number">2</span>n <span class="token operator">|=</span> n <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span>       <span class="token number">010</span>  <span class="token operator">|</span> <span class="token number">001</span> <span class="token operator">=</span> <span class="token number">011</span>   n <span class="token operator">=</span> <span class="token number">3</span>n <span class="token operator">|=</span> n <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span>       <span class="token number">011</span>  <span class="token operator">|</span> <span class="token number">000</span> <span class="token operator">=</span> <span class="token number">011</span>   n <span class="token operator">=</span> <span class="token number">3</span>n <span class="token operator">|=</span> n <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span>       <span class="token number">011</span>  <span class="token operator">|</span> <span class="token number">000</span> <span class="token operator">=</span> <span class="token number">011</span>   n <span class="token operator">=</span> <span class="token number">3</span>â€¦<span class="token punctuation">.</span>n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“capä¸º5æ—¶ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">cap <span class="token operator">=</span> <span class="token number">5</span>n <span class="token operator">=</span> <span class="token number">4</span>n <span class="token operator">|=</span> n <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span>    <span class="token number">0100</span> <span class="token operator">|</span> <span class="token number">0010</span> <span class="token operator">=</span> <span class="token number">0110</span>  n <span class="token operator">=</span> <span class="token number">6</span>n <span class="token operator">|=</span> n <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span>    <span class="token number">0110</span> <span class="token operator">|</span> <span class="token number">0001</span> <span class="token operator">=</span> <span class="token number">0111</span>  n <span class="token operator">=</span> <span class="token number">7</span>â€¦<span class="token punctuation">.</span>n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤ï¼Œè®¡ç®—çš„æ„ä¹‰åœ¨äºæ‰¾åˆ°å¤§äºç­‰äºcapçš„æœ€å°2çš„æ•´æ•°æ¬¡å¹‚ã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯æ‰¾åˆ°capå¯¹åº”äºŒè¿›åˆ¶ä¸­æœ€é«˜ä½çš„1ï¼Œç„¶åæ¯æ¬¡ä»¥2å€çš„æ­¥é•¿ï¼ˆä¾æ¬¡ç§»ä½1ã€2ã€4ã€8ã€16ï¼‰å¤åˆ¶æœ€é«˜ä½1åˆ°åé¢çš„æ‰€æœ‰ä½ä½ï¼ŒæŠŠæœ€é«˜ä½1åé¢çš„æ‰€æœ‰ä½å…¨éƒ¨ç½®ä¸º1ï¼Œæœ€åè¿›è¡Œ+1ï¼Œå³å®Œæˆäº†è¿›ä½ã€‚</p><p>ç±»ä¼¼äºŒè¿›åˆ¶ä½çš„å˜åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">0100</span> <span class="token number">1010</span><span class="token number">0111</span> <span class="token number">1111</span><span class="token number">1000</span> <span class="token number">0000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ‰¾åˆ°è¾“å…¥capçš„æœ€å°2çš„æ•´æ•°æ¬¡å¹‚ä½œä¸ºæœ€ç»ˆå®¹é‡å¯ä»¥ç†è§£ä¸ºæœ€å°å¯ç”¨åŸåˆ™ï¼Œå°½å¯èƒ½åœ°å°‘å ç”¨ç©ºé—´ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå¿…é¡»è¦2çš„æ•´æ•°æ¬¡å¹‚å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä¸ºäº†æé«˜è®¡ç®—ä¸å­˜å‚¨æ•ˆç‡ï¼Œä½¿æ¯ä¸ªå…ƒç´ å¯¹åº”hashå€¼èƒ½å¤Ÿå‡†ç¡®è½å…¥å“ˆå¸Œæ¡¶æ•°ç»„ç»™å®šçš„èŒƒå›´åŒºé—´å†…ã€‚ç¡®å®šæ•°ç»„ä¸‹æ ‡é‡‡ç”¨çš„ç®—æ³•æ˜¯ hash &amp; (n - 1)ï¼Œnå³ä¸ºå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ã€‚ç”±äºå…¶æ€»æ˜¯2çš„æ•´æ•°æ¬¡å¹‚ï¼Œè¿™æ„å‘³ç€n-1çš„äºŒè¿›åˆ¶å½¢å¼æ°¸è¿œéƒ½æ˜¯0000111111çš„å½¢å¼ï¼Œå³ä»æœ€ä½ä½å¼€å§‹ï¼Œè¿ç»­å‡ºç°å¤šä¸ª1ï¼Œè¯¥äºŒè¿›åˆ¶ä¸ä»»ä½•å€¼è¿›è¡Œ&amp;è¿ç®—éƒ½ä¼šä½¿è¯¥å€¼æ˜ å°„åˆ°æŒ‡å®šåŒºé—´[0, n-1]ã€‚æ¯”å¦‚ï¼šå½“n=8æ—¶ï¼Œn-1å¯¹åº”çš„äºŒè¿›åˆ¶ä¸º0111ï¼Œä»»ä½•ä¸0111è¿›è¡Œ&amp;è¿ç®—éƒ½ä¼šè½å…¥[0,7]çš„èŒƒå›´å†…ï¼Œå³è½å…¥ç»™å®šçš„8ä¸ªå“ˆå¸Œæ¡¶ä¸­ï¼Œå­˜å‚¨ç©ºé—´åˆ©ç”¨ç‡100%ã€‚ä¸¾ä¸ªåä¾‹ï¼Œå½“n=7ï¼Œn-1å¯¹åº”çš„äºŒè¿›åˆ¶ä¸º0110ï¼Œä»»ä½•ä¸0110è¿›è¡Œ&amp;è¿ç®—ä¼šè½å…¥åˆ°ç¬¬0ã€6ã€4ã€2ä¸ªå“ˆå¸Œæ¡¶ï¼Œè€Œä¸æ˜¯[0,6]çš„åŒºé—´èŒƒå›´å†…ï¼Œå°‘äº†1ã€3ã€5ä¸‰ä¸ªå“ˆå¸Œæ¡¶ï¼Œè¿™å¯¼è‡´å­˜å‚¨ç©ºé—´åˆ©ç”¨ç‡åªæœ‰ä¸åˆ°60%ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†å“ˆå¸Œç¢°æ’çš„å‡ ç‡ã€‚</p><h2 id="2-ConcurrentHashMapå¹¶å‘"><a href="#2-ConcurrentHashMapå¹¶å‘" class="headerlink" title="2. ConcurrentHashMapå¹¶å‘"></a>2. ConcurrentHashMapå¹¶å‘</h2><h3 id="1-ASHIFTåç§»é‡è®¡ç®—"><a href="#1-ASHIFTåç§»é‡è®¡ç®—" class="headerlink" title="1 ASHIFTåç§»é‡è®¡ç®—"></a>1 ASHIFTåç§»é‡è®¡ç®—</h3><blockquote><p>è·å–ç»™å®šå€¼çš„æœ€é«˜æœ‰æ•ˆä½æ•°ï¼ˆç§»ä½é™¤äº†èƒ½å¤Ÿè¿›è¡Œä¹˜é™¤è¿ç®—ï¼Œè¿˜èƒ½ç”¨äºä¿ç•™é«˜ã€ä½ä½æ“ä½œï¼Œå³ç§»ä¿ç•™é«˜ä½ï¼Œå·¦ç§»ä¿ç•™ä½ä½ï¼‰ã€‚</p></blockquote><p>ConcurrentHashMapä¸­çš„ABASE+ASHIFTæ˜¯ç”¨æ¥è®¡ç®—å“ˆå¸Œæ•°ç»„ä¸­æŸä¸ªå…ƒç´ åœ¨å®é™…å†…å­˜ä¸­çš„åˆå§‹ä½ç½®ï¼ŒASHIFTé‡‡å–çš„è®¡ç®—æ–¹å¼æ˜¯31ä¸scaleå‰å¯¼0çš„æ•°é‡åšå·®ï¼Œä¹Ÿå°±æ˜¯scaleçš„å®é™…ä½æ•°-1ã€‚scaleå°±æ˜¯å“ˆå¸Œæ¡¶æ•°ç»„Node[]ä¸­æ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼Œé€šè¿‡((long)i &lt;&lt; ASHIFT) + ABASE)è¿›è¡Œè®¡ç®—ï¼Œä¾¿å¯å¾—åˆ°æ•°ç»„ä¸­ç¬¬iä¸ªå…ƒç´ çš„èµ·å§‹å†…å­˜åœ°å€ã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-2c72e1ccc0fd703d7bc67db2b70f27e7_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-2c72e1ccc0fd703d7bc67db2b70f27e7_1440w.jpg" alt="img"></p><p>æˆ‘ä»¬ç»§ç»­çœ‹ä¸‹å‰å¯¼0çš„æ•°é‡æ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥çš„ï¼ŒnumberOfLeadingZerosæ˜¯Integerçš„é™æ€æ–¹æ³•ï¼Œè¿˜æ˜¯æ²¿ç”¨æ‰¾è§„å¾‹çš„æ–¹å¼ä¸€æ¢ç©¶ç«Ÿã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-1b63144ec844fbae7c5de08abbdafb17_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-1b63144ec844fbae7c5de08abbdafb17_1440w.jpg" alt="img"></p><p>å‡è®¾ i = 0000 0000 0000 0100 0000 0000 0000 0000ï¼Œn = 1</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">i <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span>  <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0100</span>   ä¸ä¸º<span class="token number">0</span>i <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span>  <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span>   ç­‰äº<span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å³ç§»äº†24ä½ç­‰äº0ï¼Œè¯´æ˜24ä½åˆ°31ä½ä¹‹é—´è‚¯å®šå…¨ä¸º0ï¼Œå³n = 1 + 8 = 9ï¼Œç”±äºé«˜8ä½å…¨ä¸º0ï¼Œå¹¶ä¸”å·²ç»å°†ä¿¡æ¯è®°å½•è‡³nä¸­ï¼Œå› æ­¤å¯ä»¥èˆå¼ƒé«˜8ä½ï¼Œå³ i &lt;&lt;= 8ã€‚æ­¤æ—¶ï¼Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">i <span class="token operator">=</span> <span class="token number">0000</span> <span class="token number">0100</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç±»ä¼¼åœ°ï¼Œi &gt;&gt;&gt; 28 ä¹Ÿç­‰äº0ï¼Œè¯´æ˜28ä½åˆ°31ä½å…¨ä¸º0ï¼Œn = 9 + 4 = 13ï¼Œèˆå¼ƒé«˜4ä½ã€‚æ­¤æ—¶ï¼Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">i <span class="token operator">=</span> <span class="token number">0100</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»§ç»­è¿ç®—ï¼Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">i <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">30</span>  <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0001</span>   ä¸ä¸º<span class="token number">0</span>i <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">31</span>  <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span> <span class="token number">0000</span>   ç­‰äº<span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æœ€ç»ˆå¯å¾—å‡ºn = 13ï¼Œå³æœ‰13ä¸ªå‰å¯¼0ã€‚n -= i &gt;&gt;&gt; 31æ˜¯æ£€æŸ¥æœ€é«˜ä½31ä½æ˜¯å¦æ˜¯1ï¼Œå› ä¸ºnåˆå§‹åŒ–ä¸º1ï¼Œå¦‚æœæœ€é«˜ä½æ˜¯1ï¼Œåˆ™ä¸å­˜åœ¨å‰ç½®0ï¼Œå³n = n - 1 = 0ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œä»¥ä¸Šçš„æ“ä½œå…¶å®æ˜¯åŸºäºäºŒåˆ†æ³•çš„æ€æƒ³æ¥å®šä½äºŒè¿›åˆ¶ä¸­1çš„æœ€é«˜ä½ï¼Œå…ˆçœ‹é«˜16ä½ï¼Œè‹¥ä¸º0ï¼Œè¯´æ˜1å­˜åœ¨äºä½16ä½ï¼›åä¹‹å­˜åœ¨é«˜16ä½ã€‚ç”±æ­¤å°†æœç´¢èŒƒå›´ç”±32ä½ï¼ˆç¡®åˆ‡çš„è¯´æ˜¯31ä½ï¼‰å‡å°‘è‡³16ä½ï¼Œè¿›è€Œå†ä¸€åˆ†ä¸ºäºŒï¼Œæ ¡éªŒé«˜8ä½ä¸ä½8ä½ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>è®¡ç®—è¿‡ç¨‹ä¸­æ ¡éªŒçš„ä½æ•°ä¾æ¬¡ä¸º16ã€8ã€4ã€2ã€1ï¼ŒåŠ èµ·æ¥åˆšå¥½ä¸º31ã€‚ä¸ºä»€ä¹ˆæ˜¯31ä¸æ˜¯32å‘¢ï¼Ÿå› ä¸ºå‰ç½®0çš„æ•°é‡ä¸º32çš„æƒ…å†µä¸‹iåªèƒ½ä¸º0ï¼Œåœ¨å‰é¢çš„ifæ¡ä»¶ä¸­å·²ç»è¿›è¡Œè¿‡æ»¤ã€‚è¿™æ ·ä¸€æ¥ï¼Œé0å€¼çš„æƒ…å†µä¸‹ï¼Œå‰ç½®0åªèƒ½å‡ºç°åœ¨é«˜31ä½ï¼Œå› æ­¤åªéœ€è¦æ ¡éªŒé«˜31ä½å³å¯ã€‚æœ€ç»ˆï¼Œç”¨æ€»ä½æ•°å‡å»è®¡ç®—å‡ºæ¥çš„å‰å¯¼0çš„æ•°é‡ï¼Œå³å¯å¾—å‡ºäºŒè¿›åˆ¶çš„æœ€é«˜æœ‰æ•ˆä½æ•°ã€‚ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯31 - Integer.numberOfLeadingZeros(scale)ï¼Œè€Œä¸æ˜¯æ€»ä½æ•°32ï¼Œè¿™æ˜¯ä¸ºäº†èƒ½å¤Ÿå¾—åˆ°å“ˆå¸Œæ¡¶æ•°ç»„ä¸­ç¬¬iä¸ªå…ƒç´ çš„èµ·å§‹å†…å­˜åœ°å€ï¼Œæ–¹ä¾¿è¿›è¡ŒCASç­‰æ“ä½œã€‚</p><h3 id="åˆ†æ®µé”"><a href="#åˆ†æ®µé”" class="headerlink" title="åˆ†æ®µé”"></a>åˆ†æ®µé”</h3><p>é’ˆå¯¹HashTableä¸­é”ç²’åº¦è¿‡ç²—çš„é—®é¢˜ï¼Œåœ¨JDK1.8ä¹‹å‰ï¼ŒConcurrentHashMapå¼•å…¥äº†åˆ†æ®µé”æœºåˆ¶ã€‚æ•´ä½“çš„å­˜å‚¨ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨åŸæœ‰ç»“æ„çš„åŸºç¡€ä¸Šæ‹†åˆ†å‡ºå¤šä¸ªsegmentï¼Œæ¯ä¸ªsegmentä¸‹å†æŒ‚è½½åŸæ¥çš„entryï¼ˆä¸Šæ–‡ä¸­ç»å¸¸æåˆ°çš„å“ˆå¸Œæ¡¶æ•°ç»„ï¼‰ï¼Œæ¯æ¬¡æ“ä½œåªéœ€è¦é”å®šå…ƒç´ æ‰€åœ¨çš„segmentï¼Œä¸éœ€è¦é”å®šæ•´ä¸ªè¡¨ã€‚å› æ­¤ï¼Œé”å®šçš„èŒƒå›´æ›´å°ï¼Œå¹¶å‘åº¦ä¹Ÿä¼šå¾—åˆ°æå‡ã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-ca34f88b24acf2a89af7341790d2ecc0_b.jpg" alt="img"><img src="https://pic1.zhimg.com/80/v2-ca34f88b24acf2a89af7341790d2ecc0_1440w.jpg" alt="img"></p><h3 id="2-ä¹è§‚é”"><a href="#2-ä¹è§‚é”" class="headerlink" title="2 ä¹è§‚é”"></a>2 ä¹è§‚é”</h3><h3 id="Synchronized-CAS"><a href="#Synchronized-CAS" class="headerlink" title="Synchronized+CAS"></a>Synchronized+CAS</h3><p>è™½ç„¶å¼•å…¥äº†åˆ†æ®µé”çš„æœºåˆ¶ï¼Œå³å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆå¯ä»¥è§£å†³é”ç²’åº¦è¿‡ç²—å¯¼è‡´çš„æ€§èƒ½ä½ä¸‹é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºè¿½æ±‚æè‡´æ€§èƒ½çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™è¿˜ä¸æ˜¯æ€§èƒ½çš„å¤©èŠ±æ¿ã€‚å› æ­¤ï¼Œåœ¨JDK1.8ä¸­ï¼ŒConcurrentHashMapæ‘’å¼ƒäº†åˆ†æ®µé”ï¼Œä½¿ç”¨äº†ä¹è§‚é”çš„å®ç°æ–¹å¼ã€‚æ”¾å¼ƒåˆ†æ®µé”çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>ä½¿ç”¨segmentä¹‹åï¼Œä¼šå¢åŠ ConcurrentHashMapçš„å­˜å‚¨ç©ºé—´ã€‚</li><li>å½“å•ä¸ªsegmentè¿‡å¤§æ—¶ï¼Œå¹¶å‘æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚</li></ul><p>ConcurrentHashMapåœ¨JDK1.8ä¸­çš„å®ç°åºŸå¼ƒäº†ä¹‹å‰çš„segmentç»“æ„ï¼Œæ²¿ç”¨äº†ä¸HashMapä¸­çš„ç±»ä¼¼çš„Nodeæ•°ç»„ç»“æ„ã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-13cb919604808ab8ddebf3f0f6449123_b.jpg" alt="img"><img src="https://pic4.zhimg.com/80/v2-13cb919604808ab8ddebf3f0f6449123_1440w.jpg" alt="img"></p><p>ConcurrentHashMapä¸­çš„ä¹è§‚é”æ˜¯é‡‡ç”¨synchronized+CASè¿›è¡Œå®ç°çš„ã€‚è¿™é‡Œä¸»è¦çœ‹ä¸‹putçš„ç›¸å…³ä»£ç ã€‚</p><p>å½“putçš„å…ƒç´ åœ¨å“ˆå¸Œæ¡¶æ•°ç»„ä¸­ä¸å­˜åœ¨æ—¶ï¼Œåˆ™ç›´æ¥CASè¿›è¡Œå†™æ“ä½œã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-3d06f86c261b997aa3eb0f0f33162df1_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-3d06f86c261b997aa3eb0f0f33162df1_1440w.jpg" alt="img"></p><p>è¿™é‡Œæ¶‰åŠåˆ°äº†ä¸¤ä¸ªé‡è¦çš„æ“ä½œï¼ŒtabAtä¸casTabAtã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œé¢éƒ½ä½¿ç”¨äº†Unsafeç±»çš„æ–¹æ³•ã€‚Unsafeè¿™ä¸ªç±»åœ¨æ—¥å¸¸çš„å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒç½•è§ã€‚æˆ‘ä»¬é€šå¸¸å¯¹Javaè¯­è¨€çš„è®¤çŸ¥æ˜¯ï¼šJavaè¯­è¨€æ˜¯å®‰å…¨çš„ï¼Œæ‰€æœ‰æ“ä½œéƒ½åŸºäºJVMï¼Œåœ¨å®‰å…¨å¯æ§çš„èŒƒå›´å†…è¿›è¡Œã€‚ç„¶è€Œï¼ŒUnsafeè¿™ä¸ªç±»ä¼šæ‰“ç ´è¿™ä¸ªè¾¹ç•Œï¼Œä½¿Javaæ‹¥æœ‰Cçš„èƒ½åŠ›ï¼Œå¯ä»¥æ“ä½œä»»æ„å†…å­˜åœ°å€ï¼Œæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚è¿™é‡Œä½¿ç”¨åˆ°äº†å‰æ–‡ä¸­æ‰€æåˆ°çš„ASHIFTï¼Œæ¥è®¡ç®—å‡ºæŒ‡å®šå…ƒç´ çš„èµ·å§‹å†…å­˜åœ°å€ï¼Œå†é€šè¿‡getObjectVolatileä¸compareAndSwapObjectåˆ†åˆ«è¿›è¡Œå–å€¼ä¸CASæ“ä½œã€‚</p><p>åœ¨è·å–å“ˆå¸Œæ¡¶æ•°ç»„ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ æ—¶ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥getè€Œæ˜¯è¦ä½¿ç”¨getObjectVolatileå‘¢ï¼Ÿå› ä¸ºåœ¨JVMçš„å†…å­˜æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œä¹Ÿå°±æ˜¯æ ˆä¸­çš„å±€éƒ¨å˜é‡è¡¨ï¼Œå®ƒæ˜¯ä¸»å­˜çš„ä¸€ä»½copyã€‚å› æ­¤ï¼Œçº¿ç¨‹1å¯¹æŸä¸ªå…±äº«èµ„æºè¿›è¡Œäº†æ›´æ–°æ“ä½œï¼Œå¹¶å†™å…¥åˆ°ä¸»å­˜ï¼Œè€Œçº¿ç¨‹2çš„å·¥ä½œå†…å­˜ä¹‹ä¸­å¯èƒ½è¿˜æ˜¯æ—§å€¼ï¼Œè„æ•°æ®ä¾¿äº§ç”Ÿäº†ã€‚Javaä¸­çš„volatileæ˜¯ç”¨æ¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä¿è¯å¯è§æ€§ï¼Œä»»æ„çº¿ç¨‹å¯¹volatileå…³é”®å­—ä¿®é¥°çš„å˜é‡è¿›è¡Œæ›´æ–°æ—¶ï¼Œä¼šä½¿å…¶å®ƒçº¿ç¨‹ä¸­è¯¥å˜é‡çš„å‰¯æœ¬å¤±æ•ˆï¼Œéœ€è¦ä»ä¸»å­˜ä¸­è·å–æœ€æ–°å€¼ã€‚è™½ç„¶ConcurrentHashMapä¸­çš„Nodeæ•°ç»„æ˜¯ç”±volatileä¿®é¥°çš„ï¼Œå¯ä»¥ä¿è¯å¯è§æ€§ï¼Œä½†æ˜¯Nodeæ•°ç»„ä¸­å…ƒç´ æ˜¯ä¸å…·å¤‡å¯è§æ€§çš„ã€‚å› æ­¤ï¼Œåœ¨è·å–æ•°æ®æ—¶é€šè¿‡Unsafeçš„æ–¹æ³•ç›´æ¥åˆ°ä¸»å­˜ä¸­æ‹¿ï¼Œä¿è¯è·å–çš„æ•°æ®æ˜¯æœ€æ–°çš„ã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-2a0ec6f2403fbf7235bb39d0bb24ae70_b.jpg" alt="img"><img src="https://pic1.zhimg.com/80/v2-2a0ec6f2403fbf7235bb39d0bb24ae70_1440w.jpg" alt="img"></p><p>ç»§ç»­å¾€ä¸‹çœ‹putæ–¹æ³•çš„é€»è¾‘ï¼Œå½“putçš„å…ƒç´ åœ¨å“ˆå¸Œæ¡¶æ•°ç»„ä¸­å­˜åœ¨ï¼Œå¹¶ä¸”ä¸å¤„äºæ‰©å®¹çŠ¶æ€æ—¶ï¼Œåˆ™ä½¿ç”¨synchronizedé”å®šå“ˆå¸Œæ¡¶æ•°ç»„ä¸­ç¬¬iä¸ªä½ç½®ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ fï¼ˆå¤´èŠ‚ç‚¹2ï¼‰ï¼Œæ¥ç€è¿›è¡Œdouble checkï¼Œç±»ä¼¼äºDCLå•ä¾‹æ¨¡å¼çš„æ€æƒ³ã€‚æ ¡éªŒé€šè¿‡åï¼Œä¼šéå†å½“å‰å†²çªé“¾ä¸Šçš„å…ƒç´ ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ä½ç½®è¿›è¡Œputæ“ä½œã€‚æ­¤å¤–ï¼ŒConcurrentHashMapä¹Ÿæ²¿ç”¨äº†HashMapä¸­è§£å†³å“ˆå¸Œå†²çªçš„æ–¹æ¡ˆï¼Œé“¾è¡¨+çº¢é»‘æ ‘ã€‚è¿™é‡Œåªæœ‰åœ¨å‘ç”Ÿå“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹æ‰ä½¿ç”¨synchronizedé”å®šå¤´èŠ‚ç‚¹ï¼Œå…¶å®æ˜¯æ¯”åˆ†æ®µé”æ›´ç»†ç²’åº¦çš„é”å®ç°ï¼Œåªåœ¨ç‰¹å®šåœºæ™¯ä¸‹é”å®šå…¶ä¸­ä¸€ä¸ªå“ˆå¸Œæ¡¶ï¼Œé™ä½é”çš„å½±å“èŒƒå›´ã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-9a575ca767b29e41f94fa6665ac89b9c_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-9a575ca767b29e41f94fa6665ac89b9c_1440w.jpg" alt="img"></p><p>Java Mapé’ˆå¯¹å¹¶å‘åœºæ™¯è§£å†³æ–¹æ¡ˆçš„æ¼”è¿›æ–¹å‘å¯ä»¥å½’ç»“ä¸ºï¼Œä»æ‚²è§‚é”åˆ°ä¹è§‚é”ï¼Œä»ç²—ç²’åº¦é”åˆ°ç»†ç²’åº¦é”ï¼Œè¿™ä¹Ÿå¯ä»¥ä½œä¸ºæˆ‘ä»¬åœ¨æ—¥å¸¸å¹¶å‘ç¼–ç¨‹ä¸­çš„æŒ‡å¯¼æ–¹é’ˆã€‚</p><h3 id="3-å¹¶å‘æ±‚å’Œ"><a href="#3-å¹¶å‘æ±‚å’Œ" class="headerlink" title="3 å¹¶å‘æ±‚å’Œ"></a>3 å¹¶å‘æ±‚å’Œ</h3><p>CounterCellæ˜¯JDK1.8ä¸­å¼•å…¥ç”¨æ¥å¹¶å‘æ±‚å’Œçš„åˆ©å™¨ï¼Œè€Œåœ¨è¿™ä¹‹å‰é‡‡ç”¨çš„æ˜¯ã€å°è¯•æ— é”æ±‚å’Œã€‘+ã€å†²çªæ—¶åŠ é”é‡è¯•ã€‘çš„ç­–ç•¥ã€‚çœ‹ä¸‹CounterCellçš„æ³¨é‡Šï¼Œå®ƒæ˜¯æ”¹ç¼–è‡ªLongAdderå’ŒStriped64ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸‹æ±‚å’Œæ“ä½œï¼Œå…¶å®å°±æ˜¯å–baseCountä½œä¸ºåˆå§‹å€¼ï¼Œç„¶åéå†CounterCellæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªcellï¼Œå°†å„ä¸ªcellçš„å€¼è¿›è¡Œç´¯åŠ ã€‚è¿™é‡Œé¢å¤–è¯´æ˜ä¸‹@sun.misc.Contenderæ³¨è§£çš„ä½œç”¨ï¼Œå®ƒæ˜¯Java8ä¸­å¼•å…¥ç”¨æ¥è§£å†³ç¼“å­˜è¡Œä¼ªå…±äº«é—®é¢˜çš„ã€‚ä»€ä¹ˆæ˜¯ä¼ªå…±äº«å‘¢ï¼Ÿç®€å•è¯´ä¸‹ï¼Œè€ƒè™‘åˆ°CPUä¸ä¸»å­˜ä¹‹é—´é€Ÿåº¦çš„å·¨å¤§å·®å¼‚ï¼Œåœ¨CPUä¸­å¼•å…¥äº†L1ã€L2ã€L3å¤šçº§ç¼“å­˜ï¼Œç¼“å­˜ä¸­çš„å­˜å‚¨å•ä½æ˜¯ç¼“å­˜è¡Œï¼Œç¼“å­˜è¡Œå¤§å°ä¸º2çš„æ•´æ•°æ¬¡å¹‚å­—èŠ‚ï¼Œ32-256ä¸ªå­—èŠ‚ä¸ç­‰ï¼Œæœ€å¸¸è§çš„æ˜¯64å­—èŠ‚ã€‚å› æ­¤ï¼Œè¿™å°†å¯¼è‡´ä¸è¶³64å­—èŠ‚çš„å˜é‡ä¼šå…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå…¶ä¸­ä¸€ä¸ªå˜é‡å¤±æ•ˆä¼šå½±å“åˆ°åŒä¸€ä¸ªç¼“å­˜è¡Œä¸­çš„å…¶ä»–å˜é‡ï¼Œè‡´ä½¿æ€§èƒ½ä¸‹é™ï¼Œè¿™å°±æ˜¯ä¼ªå…±äº«é—®é¢˜ã€‚è€ƒè™‘åˆ°ä¸åŒCPUçš„ç¼“å­˜è¡Œå•ä½çš„å·®å¼‚æ€§ï¼ŒJava8ä¸­ä¾¿é€šè¿‡è¯¥æ³¨è§£å°†è¿™ç§å·®å¼‚æ€§å±è”½ï¼Œæ ¹æ®å®é™…ç¼“å­˜è¡Œå¤§å°æ¥è¿›è¡Œå¡«å……ï¼Œä½¿è¢«ä¿®é¥°çš„å˜é‡èƒ½å¤Ÿç‹¬å ä¸€ä¸ªç¼“å­˜è¡Œã€‚</p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-54641c589fa421ad31337f0508dbb9a0_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-54641c589fa421ad31337f0508dbb9a0_1440w.jpg" alt="img"></p><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-b0653f6fa4cbfef65e7e118acf2ed6fd_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-b0653f6fa4cbfef65e7e118acf2ed6fd_1440w.jpg" alt="img"></p><p>å†æ¥çœ‹ä¸‹CounterCellæ˜¯å¦‚ä½•å®ç°è®¡æ•°çš„ï¼Œæ¯å½“mapä¸­çš„å®¹é‡æœ‰å˜åŒ–æ—¶ä¼šè°ƒç”¨addCountè¿›è¡Œè®¡æ•°ï¼Œæ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼š</p><ul><li>å½“counterCellsä¸ä¸ºç©ºï¼Œæˆ–counterCellsä¸ºç©ºä¸”å¯¹baseCountè¿›è¡ŒCASæ“ä½œå¤±è´¥æ—¶è¿›å…¥åˆ°åç»­è®¡æ•°å¤„ç†é€»è¾‘ï¼Œå¦åˆ™å¯¹baseCountè¿›è¡ŒCASæ“ä½œæˆåŠŸï¼Œç›´æ¥è¿”å›ã€‚</li><li>åç»­è®¡æ•°å¤„ç†é€»è¾‘ä¸­ä¼šè°ƒç”¨æ ¸å¿ƒè®¡æ•°æ–¹æ³•fullAddCountï¼Œä½†éœ€è¦æ»¡è¶³ä»¥ä¸‹4ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªï¼š1ã€counterCellsä¸ºç©ºï¼›2ã€counterCellsçš„sizeä¸º0ï¼›3ã€counterCellså¯¹åº”ä½ç½®ä¸Šçš„counterCellä¸ºç©ºï¼›4ã€CASæ›´æ–°counterCellså¯¹åº”ä½ç½®ä¸Šçš„counterCellå¤±è´¥ã€‚è¿™äº›æ¡ä»¶èƒŒåçš„è¯­ä¹‰æ˜¯ï¼Œå½“å‰æƒ…å†µä¸‹ï¼Œè®¡æ•°å·²ç»æˆ–æ›¾ç»å‡ºç°è¿‡å¹¶å‘å†²çªï¼Œéœ€è¦ä¼˜å…ˆå€ŸåŠ©äºCounterCellæ¥è§£å†³ã€‚è‹¥counterCellsä¸å¯¹åº”ä½ç½®ä¸Šçš„å…ƒç´ å·²ç»åˆå§‹åŒ–ï¼ˆæ¡ä»¶4ï¼‰ï¼Œåˆ™å…ˆå°è¯•CASè¿›è¡Œæ›´æ–°ï¼Œè‹¥å¤±è´¥åˆ™è°ƒç”¨fullAddCountç»§ç»­å¤„ç†ã€‚è‹¥counterCellsä¸å¯¹åº”ä½ç½®ä¸Šçš„å…ƒç´ æœªåˆå§‹åŒ–å®Œæˆï¼ˆæ¡ä»¶1ã€2ã€3ï¼‰ï¼Œä¹Ÿè¦è°ƒç”¨AddCountè¿›è¡Œåç»­å¤„ç†ã€‚</li><li>è¿™é‡Œç¡®å®šcellä¸‹æ ‡æ—¶é‡‡ç”¨äº†ThreadLocalRandom.getProbe()ä½œä¸ºå“ˆå¸Œå€¼ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯å½“å‰Threadä¸­threadLocalRandomProbeå­—æ®µçš„å€¼ã€‚è€Œä¸”å½“å“ˆå¸Œå€¼å†²çªæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡advanceProbeæ–¹æ³•æ¥æ›´æ¢å“ˆå¸Œå€¼ã€‚è¿™ä¸HashMapä¸­çš„å“ˆå¸Œå€¼è®¡ç®—é€»è¾‘ä¸åŒï¼Œå› ä¸ºHashMapä¸­è¦ä¿è¯åŒä¸€ä¸ªkeyè¿›è¡Œå¤šæ¬¡å“ˆå¸Œè®¡ç®—çš„å“ˆå¸Œå€¼ç›¸åŒå¹¶ä¸”èƒ½å®šä½åˆ°å¯¹åº”çš„valueï¼Œå³ä¾¿ä¸¤ä¸ªkeyçš„å“ˆå¸Œå€¼å†²çªä¹Ÿä¸èƒ½éšä¾¿æ›´æ¢å“ˆå¸Œå€¼ï¼Œåªèƒ½é‡‡ç”¨é“¾è¡¨æˆ–çº¢é»‘æ ‘å¤„ç†å†²çªã€‚ç„¶è€Œåœ¨è®¡æ•°åœºæ™¯ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç»´æŠ¤key-valueçš„å…³ç³»ï¼Œåªéœ€è¦åœ¨counterCellsä¸­æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ä½ç½®æ”¾å…¥è®¡æ•°cellï¼Œä½ç½®çš„å·®å¼‚å¯¹æœ€ç»ˆçš„æ±‚å’Œç»“æœæ˜¯æ²¡æœ‰å½±å“çš„ï¼Œå› æ­¤å½“å†²çªæ—¶å¯ä»¥åŸºäºéšæœºç­–ç•¥æ›´æ¢ä¸€ä¸ªå“ˆå¸Œå€¼æ¥é¿å…å†²çªã€‚</li></ul><p><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-9f37662ab4a160c5058d778adeaefab2_b.jpg" alt="img"><img src="/2021/04/01/java-zhong-hash-yuan-li/v2-9f37662ab4a160c5058d778adeaefab2_1440w.jpg" alt="img"></p><p>æ¥ç€ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ ¸å¿ƒè®¡ç®—é€»è¾‘fullAddCountï¼Œä»£ç è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œæ ¸å¿ƒæµç¨‹æ˜¯é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯æ¥å®ç°çš„ï¼Œå¾ªç¯ä½“ä¸­åŒ…å«äº†3ä¸ªå¤„ç†åˆ†æ”¯ï¼Œä¸ºäº†æ–¹ä¾¿è®²è§£æˆ‘å°†å®ƒä»¬ä¾æ¬¡å®šä¹‰Aã€Bã€Cã€‚</p><ul><li>Aï¼šè¡¨ç¤ºcounterCellså·²ç»åˆå§‹åŒ–å®Œæˆï¼Œå› æ­¤å¯ä»¥å°è¯•æ›´æ–°æˆ–åˆ›å»ºå¯¹åº”ä½ç½®çš„CounterCellã€‚</li><li>Bï¼šè¡¨ç¤ºcounterCellsæœªåˆå§‹åŒ–å®Œæˆï¼Œä¸”æ— å†²çªï¼ˆæ‹¿åˆ°cellsBusyé”ï¼‰ï¼Œåˆ™åŠ é”åˆå§‹åŒ–counterCellsï¼Œåˆå§‹å®¹é‡ä¸º2ã€‚</li><li>Cï¼šè¡¨ç¤ºcounterCellsæœªåˆå§‹åŒ–å®Œæˆï¼Œä¸”æœ‰å†²çªï¼ˆæœªèƒ½æ‹¿åˆ°cellsBusyé”ï¼‰ï¼Œåˆ™CASæ›´æ–°baseCountï¼ŒbaseCountåœ¨æ±‚å’Œæ—¶ä¹Ÿä¼šè¢«ç®—å…¥åˆ°æœ€ç»ˆç»“æœä¸­ï¼Œè¿™ä¹Ÿç›¸å½“äºæ˜¯ä¸€ç§å…œåº•ç­–ç•¥ï¼Œæ—¢ç„¶counterCellsæ­£åœ¨è¢«å…¶ä»–çº¿ç¨‹é”å®šï¼Œé‚£å½“å‰çº¿ç¨‹ä¹Ÿæ²¡å¿…è¦å†ç­‰å¾…äº†ï¼Œç›´æ¥å°è¯•ä½¿ç”¨baseCountè¿›è¡Œç´¯åŠ ã€‚</li></ul><p>å…¶ä¸­ï¼ŒAåˆ†æ”¯ä¸­æ¶‰åŠåˆ°çš„æ“ä½œåˆå¯ä»¥æ‹†åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p>a1ï¼šå¯¹åº”ä½ç½®çš„CounterCellæœªåˆ›å»ºï¼Œé‡‡ç”¨é”+Double Checkçš„ç­–ç•¥å°è¯•åˆ›å»ºCounterCellï¼Œå¤±è´¥çš„è¯åˆ™continueè¿›è¡Œé‡è¯•ã€‚è¿™é‡Œé¢é‡‡ç”¨çš„é”æ˜¯cellsBusyï¼Œå®ƒä¿è¯åˆ›å»ºCounterCellå¹¶æ”¾å…¥counterCellsæ—¶ä¸€å®šæ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œé¿å…é‡å¤åˆ›å»ºï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨äº†DCLå•ä¾‹æ¨¡å¼çš„ç­–ç•¥ã€‚åœ¨CounterCellsçš„åˆ›å»ºã€æ‰©å®¹ä¸­éƒ½éœ€è¦ä½¿ç”¨è¯¥é”ã€‚</p></li><li><p>a2ï¼šå†²çªæ£€æµ‹ï¼Œå˜é‡wasUncontendedæ˜¯è°ƒç”¨æ–¹addCountä¸­ä¼ å…¥çš„ï¼Œè¡¨ç¤ºå‰ç½®çš„CASæ›´æ–°cellå¤±è´¥ï¼Œæœ‰å†²çªï¼Œéœ€è¦æ›´æ¢å“ˆå¸Œå€¼ã€a7ã€‘åç»§ç»­é‡è¯•ã€‚</p></li><li><p>a3ï¼šå¯¹åº”ä½ç½®çš„CounterCellä¸ä¸ºç©ºï¼Œç›´æ¥CASè¿›è¡Œæ›´æ–°ã€‚</p></li><li><p>a4ï¼š</p></li><li><ul><li>å†²çªæ£€æµ‹ï¼Œå½“counterCellsçš„å¼•ç”¨å€¼ä¸ç­‰äºå½“å‰çº¿ç¨‹å¯¹åº”çš„å¼•ç”¨å€¼æ—¶ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹æ›´æ”¹äº†counterCellsçš„å¼•ç”¨ï¼Œå‡ºç°å†²çªï¼Œåˆ™å°†collideè®¾ä¸ºfalseï¼Œä¸‹æ¬¡è¿­ä»£æ—¶å¯è¿›è¡Œæ‰©å®¹ã€‚</li><li>å®¹é‡é™åˆ¶ï¼ŒcounterCellså®¹é‡çš„æœ€å¤§å€¼ä¸ºå¤§äºç­‰äºNCPUï¼ˆå®é™…æœºå™¨CPUæ ¸å¿ƒçš„æ•°é‡ï¼‰çš„æœ€å°2çš„æ•´æ•°æ¬¡å¹‚ï¼Œå½“è¾¾åˆ°å®¹é‡é™åˆ¶æ—¶åé¢çš„æ‰©å®¹åˆ†æ”¯ä¾¿æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚è¿™é‡Œé™åˆ¶çš„æ„ä¹‰åœ¨äºï¼ŒçœŸå®å¹¶å‘åº¦æ˜¯ç”±CPUæ ¸å¿ƒæ¥å†³å®šï¼Œå½“counterCellså®¹é‡ä¸CPUæ ¸å¿ƒæ•°é‡ç›¸ç­‰æ—¶ï¼Œç†æƒ³æƒ…å†µä¸‹å°±ç®—æ‰€æœ‰CPUæ ¸å¿ƒåœ¨åŒæ—¶è¿è¡Œä¸åŒçš„è®¡æ•°çº¿ç¨‹æ—¶ï¼Œéƒ½ä¸åº”è¯¥å‡ºç°å†²çªï¼Œæ¯ä¸ªçº¿ç¨‹é€‰æ‹©å„è‡ªçš„cellè¿›è¡Œå¤„ç†å³å¯ã€‚å¦‚æœå‡ºç°å†²çªï¼Œä¸€å®šæ˜¯å“ˆå¸Œå€¼çš„é—®é¢˜ï¼Œå› æ­¤é‡‡å–çš„æªæ–½æ˜¯é‡æ–°è®¡ç®—å“ˆå¸Œå€¼a7ï¼Œè€Œä¸æ˜¯é€šè¿‡æ‰©å®¹æ¥è§£å†³ã€‚æ—¶é—´æ¢ç©ºé—´ï¼Œé¿å…ä¸å¿…è¦çš„å­˜å‚¨ç©ºé—´æµªè´¹ï¼Œéå¸¸èµçš„æƒ³æ³•~</li></ul></li></ul><ul><li>a5ï¼šæ›´æ–°æ‰©å®¹æ ‡å¿—ä½ï¼Œä¸‹æ¬¡è¿­ä»£æ—¶å°†ä¼šè¿›è¡Œæ‰©å®¹ã€‚</li><li>a6ï¼šè¿›è¡ŒåŠ é”æ‰©å®¹ï¼Œæ¯æ¬¡æ‰©å®¹1å€ã€‚</li><li>a7ï¼šæ›´æ¢å“ˆå¸Œå€¼ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">fullAddCount</span><span class="token punctuation">(</span><span class="token keyword">long</span> x<span class="token punctuation">,</span> <span class="token keyword">boolean</span> wasUncontended<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> h<span class="token punctuation">;</span>        <span class="token comment">// åˆå§‹åŒ–probe</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">getProbe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">localInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// force initialization</span>            h <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">getProbe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            wasUncontended <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// ç”¨æ¥æ§åˆ¶æ‰©å®¹æ“ä½œ</span>        <span class="token keyword">boolean</span> collide <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token comment">// True if last slot nonempty</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">CounterCell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> as<span class="token punctuation">;</span> <span class="token class-name">CounterCell</span> a<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span> <span class="token keyword">long</span> v<span class="token punctuation">;</span>            <span class="token comment">// ã€Aã€‘counterCellså·²ç»åˆå§‹åŒ–å®Œæ¯•</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>as <span class="token operator">=</span> counterCells<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> as<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// ã€a1ã€‘å¯¹åº”ä½ç½®çš„CounterCellæœªåˆ›å»º</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">=</span> as<span class="token punctuation">[</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> h<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">// cellsBusyå…¶å®æ˜¯ä¸€ä¸ªé”ï¼ŒcellsBusy=0æ—¶è¡¨ç¤ºæ— å†²çª</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cellsBusy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// Try to attach new Cell</span>                        <span class="token comment">// åˆ›å»ºæ–°çš„CounterCell</span>                        <span class="token class-name">CounterCell</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterCell</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Optimistic create</span>                        <span class="token comment">// Double Checkï¼ŒåŠ é”ï¼ˆé€šè¿‡CASå°†cellsBusyè®¾ç½®1ï¼‰</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cellsBusy <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>                            <span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> CELLSBUSY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token keyword">boolean</span> created <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                            <span class="token keyword">try</span> <span class="token punctuation">{</span>               <span class="token comment">// Recheck under lock</span>                                <span class="token class-name">CounterCell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rs<span class="token punctuation">;</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> j<span class="token punctuation">;</span>                                <span class="token comment">// Double Check</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>rs <span class="token operator">=</span> counterCells<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>                                    <span class="token punctuation">(</span>m <span class="token operator">=</span> rs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>                                    rs<span class="token punctuation">[</span>j <span class="token operator">=</span> <span class="token punctuation">(</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> h<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                    <span class="token comment">// å°†æ–°åˆ›å»ºçš„CounterCellæ”¾å…¥counterCellsä¸­</span>                                    rs<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">;</span>                                    created <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                                <span class="token punctuation">}</span>                            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>                                <span class="token comment">// è§£é”ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆä¸ç”¨CASï¼Ÿå› ä¸ºå½“å‰æµç¨‹ä¸­éœ€è¦åœ¨è·å–é”çš„å‰æä¸‹è¿›è¡Œï¼Œå³ä¸²è¡Œæ‰§è¡Œï¼Œå› æ­¤ä¸å­˜åœ¨å¹¶å‘æ›´æ–°é—®é¢˜ï¼Œåªéœ€è¦æ­£å¸¸æ›´æ–°å³å¯</span>                                cellsBusy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>created<span class="token punctuation">)</span>                                <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token comment">// åˆ›å»ºå¤±è´¥åˆ™é‡è¯•</span>                            <span class="token keyword">continue</span><span class="token punctuation">;</span>           <span class="token comment">// Slot is now non-empty</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token comment">// cellsBusyä¸ä¸º0ï¼Œè¯´æ˜è¢«å…¶ä»–çº¿ç¨‹äº‰æŠ¢åˆ°äº†é”ï¼Œè¿˜ä¸èƒ½è€ƒè™‘æ‰©å®¹</span>                    collide <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment">//ã€a2ã€‘å†²çªæ£€æµ‹</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>wasUncontended<span class="token punctuation">)</span>       <span class="token comment">// CAS already known to fail</span>                    <span class="token comment">// è°ƒç”¨æ–¹addCountä¸­CASæ›´æ–°cellå¤±è´¥ï¼Œæœ‰å†²çªï¼Œåˆ™ç»§ç»­å°è¯•CAS</span>                    wasUncontended <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>      <span class="token comment">// Continue after rehash</span>                <span class="token comment">//ã€a3ã€‘å¯¹åº”ä½ç½®çš„CounterCellä¸ä¸ºç©ºï¼Œç›´æ¥CASè¿›è¡Œæ›´æ–°</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapLong</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> CELLVALUE<span class="token punctuation">,</span> v <span class="token operator">=</span> a<span class="token punctuation">.</span>value<span class="token punctuation">,</span> v <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token comment">//ã€a4ã€‘å®¹é‡é™åˆ¶</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>counterCells <span class="token operator">!=</span> as <span class="token operator">||</span> n <span class="token operator">&gt;=</span> NCPU<span class="token punctuation">)</span>                    <span class="token comment">// è¯´æ˜counterCellså®¹é‡çš„æœ€å¤§å€¼ä¸ºå¤§äºNCPUï¼ˆå®é™…æœºå™¨CPUæ ¸å¿ƒçš„æ•°é‡ï¼‰æœ€å°2çš„æ•´æ•°æ¬¡å¹‚ã€‚</span>                    <span class="token comment">// è¿™é‡Œé™åˆ¶çš„æ„ä¹‰åœ¨äºï¼Œå¹¶å‘åº¦æ˜¯ç”±CPUæ ¸å¿ƒæ¥å†³å®šï¼Œå½“counterCellså®¹é‡ä¸CPUæ ¸å¿ƒæ•°é‡ç›¸ç­‰æ—¶ï¼Œç†è®ºä¸Šè®²å°±ç®—æ‰€æœ‰CPUæ ¸å¿ƒéƒ½åœ¨åŒæ—¶è¿è¡Œä¸åŒçš„è®¡æ•°çº¿ç¨‹æ—¶ï¼Œéƒ½ä¸åº”è¯¥å‡ºç°å†²çªï¼Œæ¯ä¸ªçº¿ç¨‹é€‰æ‹©å„è‡ªçš„cellè¿›è¡Œå¤„ç†å³å¯ã€‚å¦‚æœå‡ºç°å†²çªï¼Œä¸€å®šæ˜¯å“ˆå¸Œå€¼çš„é—®é¢˜ï¼Œå› æ­¤é‡‡å–çš„æªæ–½æ˜¯é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼ˆh = ThreadLocalRandom.advanceProbe(h)ï¼‰ï¼Œè€Œä¸æ˜¯é€šè¿‡æ‰©å®¹æ¥è§£å†³</span>                    <span class="token comment">// å½“nå¤§äºNCPUæ—¶åé¢çš„åˆ†æ”¯å°±ä¸ä¼šèµ°åˆ°äº†</span>                    collide <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token comment">// At max size or stale</span>                <span class="token comment">// ã€a5ã€‘æ›´æ–°æ‰©å®¹æ ‡å¿—ä½</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>collide<span class="token punctuation">)</span>                    <span class="token comment">// è¯´æ˜æ˜ å°„åˆ°cellä½ç½®ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å°è¯•è¿›è¡ŒCASæ›´æ–°æ—¶å¤±è´¥äº†ï¼Œåˆ™è¯´æ˜æœ‰ç«äº‰ï¼Œå°†collideè®¾ç½®ä¸ºtrueï¼Œä¸‹æ¬¡è¿­ä»£æ—¶æ‰§è¡Œåé¢çš„æ‰©å®¹æ“ä½œï¼Œé™ä½ç«äº‰åº¦</span>                    <span class="token comment">// æœ‰ç«äº‰æ—¶ï¼Œæ‰§è¡Œrehash+æ‰©å®¹ï¼Œå½“å®¹é‡å¤§äºCPUæ ¸å¿ƒæ—¶åˆ™åœæ­¢æ‰©å®¹åªè¿›è¡Œrehash</span>                    collide <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token comment">// ã€a6ã€‘åŠ é”æ‰©å®¹</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cellsBusy <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>                         <span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> CELLSBUSY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">// åŠ é”æ‰©å®¹</span>                    <span class="token keyword">try</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>counterCells <span class="token operator">==</span> as<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// Expand table unless stale</span>                            <span class="token comment">// æ‰©å®¹1å€</span>                            <span class="token class-name">CounterCell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterCell</span><span class="token punctuation">[</span>n <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>                                rs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> as<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                            counterCells <span class="token operator">=</span> rs<span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>                        cellsBusy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    collide <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                   <span class="token comment">// Retry with expanded table</span>                <span class="token punctuation">}</span>                <span class="token comment">//ã€a7ã€‘æ›´æ¢å“ˆå¸Œå€¼</span>                h <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">advanceProbe</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">// ã€Bã€‘counterCellsæœªåˆå§‹åŒ–å®Œæˆï¼Œä¸”æ— å†²çªï¼Œåˆ™åŠ é”åˆå§‹åŒ–counterCells</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cellsBusy <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> counterCells <span class="token operator">==</span> as <span class="token operator">&amp;&amp;</span>                     <span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> CELLSBUSY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">boolean</span> init <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                           <span class="token comment">// Initialize table</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>counterCells <span class="token operator">==</span> as<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token class-name">CounterCell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterCell</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        rs<span class="token punctuation">[</span>h <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterCell</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                        counterCells <span class="token operator">=</span> rs<span class="token punctuation">;</span>                        init <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>                    cellsBusy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>init<span class="token punctuation">)</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">// ã€Cã€‘counterCellsæœªåˆå§‹åŒ–å®Œæˆï¼Œä¸”æœ‰å†²çªï¼Œåˆ™CASæ›´æ–°baseCount</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapLong</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> BASECOUNT<span class="token punctuation">,</span> v <span class="token operator">=</span> baseCount<span class="token punctuation">,</span> v <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>                          <span class="token comment">// Fall back on using base</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>CounterCellçš„è®¾è®¡å¾ˆå·§å¦™ï¼Œå®ƒçš„èƒŒåå…¶å®å°±æ˜¯JDK1.8ä¸­çš„LongAdderã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨å¹¶å‘è¾ƒä½çš„åœºæ™¯ä¸‹ç›´æ¥é‡‡ç”¨baseCountç´¯åŠ ï¼Œå¦åˆ™ç»“åˆcounterCellsï¼Œå°†ä¸åŒçš„çº¿ç¨‹æ•£åˆ—åˆ°ä¸åŒçš„cellä¸­è¿›è¡Œè®¡ç®—ï¼Œå°½å¯èƒ½åœ°ç¡®ä¿è®¿é—®èµ„æºçš„éš”ç¦»ï¼Œå‡å°‘å†²çªã€‚LongAdderç›¸æ¯”è¾ƒäºAtomicLongä¸­æ— è„‘CASçš„ç­–ç•¥ï¼Œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œèƒ½å¤Ÿå‡å°‘CASé‡è¯•çš„æ¬¡æ•°ï¼Œæé«˜è®¡ç®—æ•ˆç‡ã€‚</p><h2 id="2-hashæ–¹æ³•"><a href="#2-hashæ–¹æ³•" class="headerlink" title="2. hashæ–¹æ³•"></a>2. hashæ–¹æ³•</h2><p>æˆ‘ä»¬æ‹¿JDK 1.7çš„HashMapä¸ºä¾‹ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªfinal int hash(Object k) æ–¹æ³•ï¼Œå…¶ä¸»è¦è¢«ä»¥ä¸‹æ–¹æ³•å¼•ç”¨ã€‚</p><p><a href="http://www.hollischuang.com/wp-content/uploads/2018/03/hash-use.png"><img src="/2021/04/01/java-zhong-hash-yuan-li/hash-use.png" alt="hash-use"></a></p><p>ä¸Šé¢çš„æ–¹æ³•ä¸»è¦éƒ½æ˜¯å¢åŠ å’Œåˆ é™¤æ–¹æ³•ï¼Œè¿™ä¸éš¾ç†è§£ï¼Œå½“æˆ‘ä»¬è¦å¯¹ä¸€ä¸ªé“¾è¡¨æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ è¿›è¡Œå¢åˆ çš„æ—¶å€™ï¼Œé¦–å…ˆè¦çŸ¥é“ä»–åº”è¯¥ä¿å­˜åœ¨è¿™ä¸ªé“¾è¡¨æ•°ç»„ä¸­çš„å“ªä¸ªä½ç½®ï¼Œå³ä»–åœ¨è¿™ä¸ªæ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚è€Œhash()æ–¹æ³•çš„åŠŸèƒ½å°±æ˜¯æ ¹æ®Keyæ¥å®šä½å…¶åœ¨HashMapä¸­çš„ä½ç½®ã€‚HashTableã€ConcurrentHashMapåŒç†ã€‚</p><p>é¦–å…ˆï¼Œåœ¨åŒä¸€ä¸ªç‰ˆæœ¬çš„Jdkä¸­ï¼ŒHashMapã€HashTableä»¥åŠConcurrentHashMapé‡Œé¢çš„hashæ–¹æ³•çš„å®ç°æ˜¯ä¸åŒçš„ã€‚å†ä¸åŒçš„ç‰ˆæœ¬çš„JDKä¸­ï¼ˆJava7 å’Œ Java8ï¼‰ä¸­ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚æˆ‘ä¼šå°½é‡å…¨éƒ¨ä»‹ç»åˆ°ã€‚ç›¸ä¿¡ï¼Œçœ‹æ–‡è¿™ç¯‡æ–‡ç« ï¼Œä½ ä¼šå½»åº•ç†è§£hashæ–¹æ³•ã€‚</p><p>åœ¨ä¸Šä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åšä¸ªç®€å•åˆ†æã€‚æˆ‘ä»¬çŸ¥é“ï¼Œhashæ–¹æ³•çš„åŠŸèƒ½æ˜¯æ ¹æ®Keyæ¥å®šä½è¿™ä¸ªK-Våœ¨é“¾è¡¨æ•°ç»„ä¸­çš„ä½ç½®çš„ã€‚ä¹Ÿå°±æ˜¯hashæ–¹æ³•çš„è¾“å…¥åº”è¯¥æ˜¯ä¸ªObjectç±»å‹çš„Keyï¼Œè¾“å‡ºåº”è¯¥æ˜¯ä¸ªintç±»å‹çš„æ•°ç»„ä¸‹æ ‡ã€‚å¦‚æœè®©ä½ è®¾è®¡è¿™ä¸ªæ–¹æ³•ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p><p>å…¶å®ç®€å•ï¼Œæˆ‘ä»¬åªè¦è°ƒç”¨Objectå¯¹è±¡çš„hashCode()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œç„¶åç”¨è¿™ä¸ªæ•°å¯¹HashMapæˆ–è€…HashTableçš„å®¹é‡è¿›è¡Œå–æ¨¡å°±è¡Œäº†ã€‚æ²¡é”™ï¼Œå…¶å®åŸºæœ¬åŸç†å°±æ˜¯è¿™ä¸ªï¼Œåªä¸è¿‡ï¼Œåœ¨å…·ä½“å®ç°ä¸Šï¼Œç”±ä¸¤ä¸ªæ–¹æ³•<code>int hash(Object k)</code>å’Œ<code>int indexFor(int h, int length)</code>æ¥å®ç°ã€‚ä½†æ˜¯è€ƒè™‘åˆ°æ•ˆç‡ç­‰é—®é¢˜ï¼ŒHashMapçš„å®ç°ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚</p><blockquote><p>hash ï¼šè¯¥æ–¹æ³•ä¸»è¦æ˜¯å°†Objectè½¬æ¢æˆä¸€ä¸ªæ•´å‹ã€‚</p><p>indexFor ï¼šè¯¥æ–¹æ³•ä¸»è¦æ˜¯å°†hashç”Ÿæˆçš„æ•´å‹è½¬æ¢æˆé“¾è¡¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚</p></blockquote><h4 id="HashMap-In-Java-7"><a href="#HashMap-In-Java-7" class="headerlink" title="HashMap In Java 7"></a>HashMap In Java 7</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> h <span class="token operator">=</span> hashSeed<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> h <span class="token operator">&amp;&amp;</span> k <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Hashing</span><span class="token punctuation">.</span><span class="token function">stringHash32</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    h <span class="token operator">^=</span> k<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">indexFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> h <span class="token operator">&amp;</span> <span class="token punctuation">(</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‰é¢æˆ‘è¯´è¿‡ï¼Œ<code>indexFor</code>æ–¹æ³•å…¶å®ä¸»è¦æ˜¯å°†hashç”Ÿæˆçš„æ•´å‹è½¬æ¢æˆé“¾è¡¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚é‚£ä¹ˆ<code>return h &amp; (length-1);</code>æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå…¶å®ï¼Œä»–å°±æ˜¯å–æ¨¡ã€‚Javaä¹‹æ‰€æœ‰ä½¿ç”¨ä½è¿ç®—(&amp;)æ¥ä»£æ›¿å–æ¨¡è¿ç®—(%)ï¼Œæœ€ä¸»è¦çš„è€ƒè™‘å°±æ˜¯æ•ˆç‡ã€‚<strong>ä½è¿ç®—(&amp;)æ•ˆç‡è¦æ¯”ä»£æ›¿å–æ¨¡è¿ç®—(%)é«˜å¾ˆå¤šï¼Œä¸»è¦åŸå› æ˜¯ä½è¿ç®—ç›´æ¥å¯¹å†…å­˜æ•°æ®è¿›è¡Œæ“ä½œï¼Œä¸éœ€è¦è½¬æˆåè¿›åˆ¶ï¼Œå› æ­¤å¤„ç†é€Ÿåº¦éå¸¸å¿«ã€‚</strong></p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨ä½è¿ç®—(&amp;)æ¥å®ç°å–æ¨¡è¿ç®—(%)å‘¢ï¼Ÿè¿™å®ç°çš„åŸç†å¦‚ä¸‹ï¼š</p><blockquote><p>X % 2^n = X &amp; (2^n â€“ 1)</p><p>2^nè¡¨ç¤º2çš„næ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ•°å¯¹2^nå–æ¨¡ == ä¸€ä¸ªæ•°å’Œ(2^n â€“ 1)åšæŒ‰ä½ä¸è¿ç®— ã€‚</p><p>å‡è®¾nä¸º3ï¼Œåˆ™2^3 = 8ï¼Œè¡¨ç¤ºæˆ2è¿›åˆ¶å°±æ˜¯1000ã€‚2^3 = 7 ï¼Œå³0111ã€‚</p><p>æ­¤æ—¶X &amp; (2^3 â€“ 1) å°±ç›¸å½“äºå–Xçš„2è¿›åˆ¶çš„æœ€åä¸‰ä½æ•°ã€‚</p><p>ä»2è¿›åˆ¶è§’åº¦æ¥çœ‹ï¼ŒX / 8ç›¸å½“äº X &gt;&gt; 3ï¼Œå³æŠŠXå³ç§»3ä½ï¼Œæ­¤æ—¶å¾—åˆ°äº†X / 8çš„å•†ï¼Œè€Œè¢«ç§»æ‰çš„éƒ¨åˆ†(åä¸‰ä½)ï¼Œåˆ™æ˜¯X % 8ï¼Œä¹Ÿå°±æ˜¯ä½™æ•°ã€‚</p></blockquote><p>ä¸Šé¢çš„è§£é‡Šä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰çœ‹æ‡‚ï¼Œæ²¡çœ‹æ‡‚çš„è¯å…¶å®ä¹Ÿæ²¡å…³ç³»ï¼Œä½ åªéœ€è¦è®°ä½è¿™ä¸ªæŠ€å·§å°±å¯ä»¥äº†ã€‚æˆ–è€…ä½ å¯ä»¥æ‰¾å‡ ä¸ªä¾‹å­è¯•ä¸€ä¸‹ã€‚</p><blockquote><p>6 % 8 = 6 ï¼Œ6 &amp; 7 = 6</p><p>10 &amp; 8 = 2 ï¼Œ10 &amp; 7 = 2</p></blockquote><p><a href="http://www.hollischuang.com/wp-content/uploads/2018/03/640-1.png"><img src="/2021/04/01/java-zhong-hash-yuan-li/640-1.png" alt="640 (1)"></a></p><p>æ‰€ä»¥ï¼Œ<code>return h &amp; (length-1);</code>åªè¦ä¿è¯lengthçš„é•¿åº¦æ˜¯<code>2^n</code>çš„è¯ï¼Œå°±å¯ä»¥å®ç°å–æ¨¡è¿ç®—äº†ã€‚è€ŒHashMapä¸­çš„lengthä¹Ÿç¡®å®æ˜¯2çš„å€æ•°ï¼Œåˆå§‹å€¼æ˜¯16ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ä¸ºåŸæ¥çš„2å€ã€‚</p><p>åˆ†æå®Œ<code>indexFor</code>æ–¹æ³•åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å‡†å¤‡åˆ†æ<code>hash</code>æ–¹æ³•çš„å…·ä½“åŸç†å’Œå®ç°ã€‚åœ¨æ·±å…¥åˆ†æä¹‹å‰ï¼Œè‡³æ­¤ï¼Œå…ˆåšä¸ªæ€»ç»“ã€‚</p><p>HashMapçš„æ•°æ®æ˜¯å­˜å‚¨åœ¨é“¾è¡¨æ•°ç»„é‡Œé¢çš„ã€‚åœ¨å¯¹HashMapè¿›è¡Œæ’å…¥/åˆ é™¤ç­‰æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦æ ¹æ®K-Vå¯¹çš„é”®å€¼å®šä½åˆ°ä»–åº”è¯¥ä¿å­˜åœ¨æ•°ç»„çš„å“ªä¸ªä¸‹æ ‡ä¸­ã€‚è€Œè¿™ä¸ªé€šè¿‡é”®å€¼æ±‚å–ä¸‹æ ‡çš„æ“ä½œå°±å«åšå“ˆå¸Œã€‚HashMapçš„æ•°ç»„æ˜¯æœ‰é•¿åº¦çš„ï¼ŒJavaä¸­è§„å®šè¿™ä¸ªé•¿åº¦åªèƒ½æ˜¯2çš„å€æ•°ï¼Œåˆå§‹å€¼ä¸º16ã€‚ç®€å•çš„åšæ³•æ˜¯å…ˆæ±‚å–å‡ºé”®å€¼çš„hashcodeï¼Œç„¶ååœ¨å°†hashcodeå¾—åˆ°çš„intå€¼å¯¹æ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡ã€‚ä¸ºäº†è€ƒè™‘æ€§èƒ½ï¼ŒJavaæ€»é‡‡ç”¨æŒ‰ä½ä¸æ“ä½œå®ç°å–æ¨¡æ“ä½œã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ— è®ºæ˜¯ç”¨å–æ¨¡è¿ç®—è¿˜æ˜¯ä½è¿ç®—éƒ½æ— æ³•ç›´æ¥è§£å†³å†²çªè¾ƒå¤§çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼š<code>CA11 0000</code>å’Œ<code>0001 0000</code>åœ¨å¯¹<code>0000 1111</code>è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—åçš„å€¼æ˜¯ç›¸ç­‰çš„ã€‚<a href="http://www.hollischuang.com/wp-content/uploads/2018/03/640-2.png"><img src="/2021/04/01/java-zhong-hash-yuan-li/640-2.png" alt="640 (2)"></a></p><p>ä¸¤ä¸ªä¸åŒçš„é”®å€¼ï¼Œåœ¨å¯¹æ•°ç»„é•¿åº¦è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—åå¾—åˆ°çš„ç»“æœç›¸åŒï¼Œè¿™ä¸å°±å‘ç”Ÿäº†å†²çªå—ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ç§å†²çªå‘¢ï¼Œæ¥çœ‹ä¸‹Javaæ˜¯å¦‚ä½•åšçš„ã€‚</p><p>å…¶ä¸­çš„ä¸»è¦ä»£ç éƒ¨åˆ†å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">h <span class="token operator">^=</span> k<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™æ®µä»£ç æ˜¯ä¸ºäº†å¯¹keyçš„hashCodeè¿›è¡Œæ‰°åŠ¨è®¡ç®—ï¼Œé˜²æ­¢ä¸åŒhashCodeçš„é«˜ä½ä¸åŒä½†ä½ä½ç›¸åŒå¯¼è‡´çš„hashå†²çªã€‚ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯ä¸ºäº†æŠŠé«˜ä½çš„ç‰¹å¾å’Œä½ä½çš„ç‰¹å¾ç»„åˆèµ·æ¥ï¼Œé™ä½å“ˆå¸Œå†²çªçš„æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°½é‡åšåˆ°ä»»ä½•ä¸€ä½çš„å˜åŒ–éƒ½èƒ½å¯¹æœ€ç»ˆå¾—åˆ°çš„ç»“æœäº§ç”Ÿå½±å“ã€‚</p><p>ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œæˆ‘ä»¬ç°åœ¨æƒ³å‘ä¸€ä¸ªHashMapä¸­putä¸€ä¸ªK-Vå¯¹ï¼ŒKeyçš„å€¼ä¸ºâ€œhollischuangâ€ï¼Œç»è¿‡ç®€å•çš„è·å–hashcodeåï¼Œå¾—åˆ°çš„å€¼ä¸ºâ€œ1011000110101110011111010011011â€ï¼Œå¦‚æœå½“å‰HashTableçš„å¤§å°ä¸º16ï¼Œå³åœ¨ä¸è¿›è¡Œæ‰°åŠ¨è®¡ç®—çš„æƒ…å†µä¸‹ï¼Œä»–æœ€ç»ˆå¾—åˆ°çš„indexç»“æœå€¼ä¸º11ã€‚ç”±äº15çš„äºŒè¿›åˆ¶æ‰©å±•åˆ°32ä½ä¸ºâ€œ00000000000000000000000000001111â€ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªæ•°å­—åœ¨å’Œä»–è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œçš„æ—¶å€™ï¼Œå‰28ä½æ— è®ºæ˜¯ä»€ä¹ˆï¼Œè®¡ç®—ç»“æœéƒ½ä¸€æ ·ï¼ˆå› ä¸º0å’Œä»»ä½•æ•°åšä¸ï¼Œç»“æœéƒ½ä¸º0ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><a href="http://www.hollischuang.com/wp-content/uploads/2018/03/640-3.png"><img src="http://www.hollischuang.com/wp-content/uploads/2018/03/640-3.png" alt="640 (3)"></a></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåé¢çš„ä¸¤ä¸ªhashcodeç»è¿‡ä½è¿ç®—ä¹‹åå¾—åˆ°çš„å€¼ä¹Ÿæ˜¯11 ï¼Œè™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“å“ªä¸ªkeyçš„hashcodeæ˜¯ä¸Šé¢ä¾‹å­ä¸­çš„é‚£ä¸¤ä¸ªï¼Œä½†æ˜¯è‚¯å®šå­˜åœ¨è¿™æ ·çš„keyï¼Œè¿™å°±äº§ç”Ÿäº†å†²çªã€‚</p><p>é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘çœ‹çœ‹ä¸€ä¸‹ç»è¿‡æ‰°åŠ¨çš„ç®—æ³•æœ€ç»ˆçš„è®¡ç®—ç»“æœä¼šå¦‚ä½•ã€‚</p><p><a href="http://www.hollischuang.com/wp-content/uploads/2018/03/640-4.png"><img src="/2021/04/01/java-zhong-hash-yuan-li/640-4.png" alt="640 (4)"></a></p><p>ä»ä¸Šé¢å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¹‹å‰ä¼šäº§ç”Ÿå†²çªçš„ä¸¤ä¸ªhashcodeï¼Œç»è¿‡æ‰°åŠ¨è®¡ç®—ä¹‹åï¼Œæœ€ç»ˆå¾—åˆ°çš„indexçš„å€¼ä¸ä¸€æ ·äº†ï¼Œè¿™å°±å¾ˆå¥½çš„é¿å…äº†å†²çªã€‚</p><blockquote><p>å…¶å®ï¼Œä½¿ç”¨ä½è¿ç®—ä»£æ›¿å–æ¨¡è¿ç®—ï¼Œé™¤äº†æ€§èƒ½ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥å¾ˆå¥½çš„è§£å†³è´Ÿæ•°çš„é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œhashcodeçš„ç»“æœæ˜¯intç±»å‹ï¼Œè€Œintçš„å–å€¼èŒƒå›´æ˜¯-2^31 ~ 2^31 â€“ 1ï¼Œå³[ -2147483648, 2147483647]ï¼›è¿™é‡Œé¢æ˜¯åŒ…å«è´Ÿæ•°çš„ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºä¸€ä¸ªè´Ÿæ•°å–æ¨¡è¿˜æ˜¯æœ‰äº›éº»çƒ¦çš„ã€‚å¦‚æœä½¿ç”¨äºŒè¿›åˆ¶çš„ä½è¿ç®—çš„è¯å°±å¯ä»¥å¾ˆå¥½çš„é¿å…è¿™ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œä¸ç®¡hashcodeçš„å€¼æ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ã€‚length-1è¿™ä¸ªå€¼ä¸€å®šæ˜¯ä¸ªæ­£æ•°ã€‚é‚£ä¹ˆï¼Œä»–çš„äºŒè¿›åˆ¶çš„ç¬¬ä¸€ä½ä¸€å®šæ˜¯0ï¼ˆæœ‰ç¬¦å·æ•°ç”¨æœ€é«˜ä½ä½œä¸ºç¬¦å·ä½ï¼Œâ€œ0â€ä»£è¡¨â€œ+â€ï¼Œâ€œ1â€ä»£è¡¨â€œ-â€ï¼‰ï¼Œè¿™æ ·é‡Œä¸¤ä¸ªæ•°åšæŒ‰ä½ä¸è¿ç®—ä¹‹åï¼Œç¬¬ä¸€ä½ä¸€å®šæ˜¯ä¸ª0ï¼Œä¹Ÿå°±æ˜¯ï¼Œå¾—åˆ°çš„ç»“æœä¸€å®šæ˜¯ä¸ªæ­£æ•°ã€‚</p></blockquote><h3 id="3-HashTable-In-Java-7"><a href="#3-HashTable-In-Java-7" class="headerlink" title="3.HashTable In Java 7"></a>3.HashTable In Java 7</h3><p>ä¸Šé¢æ˜¯Java 7ä¸­HashMapçš„<code>hash</code>æ–¹æ³•ä»¥åŠ<code>indexOf</code>æ–¹æ³•çš„å®ç°ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¦çœ‹ä¸‹ï¼Œçº¿ç¨‹å®‰å…¨çš„HashTableæ˜¯å¦‚ä½•å®ç°çš„ï¼Œå’ŒHashMapæœ‰ä½•ä¸åŒï¼Œå¹¶è¯•ç€åˆ†æä¸‹ä¸åŒçš„åŸå› ã€‚ä»¥ä¸‹æ˜¯Java 7ä¸­HashTableçš„hashæ–¹æ³•çš„å®ç°ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// hashSeed will be zero if alternative hashing is disabled.</span>    <span class="token keyword">return</span> hashSeed <span class="token operator">^</span> k<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¾ˆç®€å•ï¼Œç›¸å½“äºåªæ˜¯å¯¹kåšäº†ä¸ªç®€å•çš„hashï¼Œå–äº†ä¸€ä¸‹å…¶hashCodeã€‚è€ŒHashTableä¸­ä¹Ÿæ²¡æœ‰<code>indexOf</code>æ–¹æ³•ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯è¿™æ®µä»£ç ï¼š<code>int index = (hash &amp; 0x7FFFFFFF) % tab.length;</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒHashMapå’ŒHashTableå¯¹äºè®¡ç®—æ•°ç»„ä¸‹æ ‡è¿™ä»¶äº‹ï¼Œé‡‡ç”¨äº†ä¸¤ç§æ–¹æ³•ã€‚HashMapé‡‡ç”¨çš„æ˜¯ä½è¿ç®—ï¼Œè€ŒHashTableé‡‡ç”¨çš„æ˜¯ç›´æ¥å–æ¨¡ã€‚</p><blockquote><p>ä¸ºå•¥è¦æŠŠhashå€¼å’Œ0x7FFFFFFFåšä¸€æ¬¡æŒ‰ä½ä¸æ“ä½œå‘¢ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯å¾—åˆ°çš„indexçš„ç¬¬ä¸€ä½ä¸º0ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº†å¾—åˆ°ä¸€ä¸ªæ­£æ•°ã€‚å› ä¸ºæœ‰ç¬¦å·æ•°ç¬¬ä¸€ä½0ä»£è¡¨æ­£æ•°ï¼Œ1ä»£è¡¨è´Ÿæ•°ã€‚</p></blockquote><p>æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼ŒHashMapä¹‹æ‰€ä»¥ä¸ç”¨å–æ¨¡çš„åŸå› æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ã€‚æœ‰äººè®¤ä¸ºï¼Œå› ä¸ºHashTableæ˜¯ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œæœ¬æ¥å°±æ…¢ï¼Œæ‰€ä»¥Javaå¹¶æ²¡æœ‰è€ƒè™‘æ•ˆç‡é—®é¢˜ï¼Œå°±ç›´æ¥ä½¿ç”¨å–æ¨¡ç®—æ³•äº†å‘¢ï¼Ÿä½†æ˜¯å…¶å®å¹¶ä¸å®Œå…¨æ˜¯ï¼ŒJavaè¿™æ ·è®¾è®¡è¿˜æ˜¯æœ‰ä¸€å®šçš„è€ƒè™‘åœ¨çš„ï¼Œè™½ç„¶è¿™æ ·æ•ˆç‡ç¡®å®æ˜¯ä¼šæ¯”HashMapæ…¢ä¸€äº›ã€‚</p><p>å…¶å®ï¼ŒHashTableé‡‡ç”¨ç®€å•çš„å–æ¨¡æ˜¯æœ‰ä¸€å®šçš„è€ƒè™‘åœ¨çš„ã€‚è¿™å°±è¦æ¶‰åŠåˆ°HashTableçš„æ„é€ å‡½æ•°å’Œæ‰©å®¹å‡½æ•°äº†ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ï¼Œç›´æ¥ç»™å‡ºç»“è®ºï¼š</p><blockquote><p>HashTableé»˜è®¤çš„åˆå§‹å¤§å°ä¸º11ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ä¸ºåŸæ¥çš„2n+1ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒHashTableçš„é“¾è¡¨æ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯ä¸€ä¸ªç´ æ•°ã€å¥‡æ•°ã€‚ä¹‹åçš„æ¯æ¬¡æ‰©å……ç»“æœä¹Ÿéƒ½æ˜¯å¥‡æ•°ã€‚</p><p>ç”±äºHashTableä¼šå°½é‡ä½¿ç”¨ç´ æ•°ã€å¥‡æ•°ä½œä¸ºå®¹é‡çš„å¤§å°ã€‚å½“å“ˆå¸Œè¡¨çš„å¤§å°ä¸ºç´ æ•°æ—¶ï¼Œç®€å•çš„å–æ¨¡å“ˆå¸Œçš„ç»“æœä¼šæ›´åŠ å‡åŒ€ã€‚ï¼ˆè¿™ä¸ªæ˜¯å¯ä»¥è¯æ˜å‡ºæ¥çš„ï¼Œç”±äºä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œæš‚ä¸è¯¦ç»†ä»‹ç»ï¼Œå¯å‚è€ƒï¼š<a href="http://zhaox.github.io/algorithm/2015/06/29/hash%EF%BC%89">http://zhaox.github.io/algorithm/2015/06/29/hashï¼‰</a></p></blockquote><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çœ‹å®Œäº†Java 7ä¸­HashMapå’ŒHashTableä¸­å¯¹äºhashçš„å®ç°ï¼Œæˆ‘ä»¬æ¥åšä¸ªç®€å•çš„æ€»ç»“ã€‚</p><ul><li>HashMapé»˜è®¤çš„åˆå§‹åŒ–å¤§å°ä¸º16ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ä¸ºåŸæ¥çš„2å€ã€‚</li><li>HashTableé»˜è®¤çš„åˆå§‹å¤§å°ä¸º11ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ä¸ºåŸæ¥çš„2n+1ã€‚</li><li>å½“å“ˆå¸Œè¡¨çš„å¤§å°ä¸ºç´ æ•°æ—¶ï¼Œç®€å•çš„å–æ¨¡å“ˆå¸Œçš„ç»“æœä¼šæ›´åŠ å‡åŒ€ï¼Œæ‰€ä»¥å•ä»è¿™ä¸€ç‚¹ä¸Šçœ‹ï¼ŒHashTableçš„å“ˆå¸Œè¡¨å¤§å°é€‰æ‹©ï¼Œä¼¼ä¹æ›´é«˜æ˜äº›ã€‚å› ä¸ºhashç»“æœè¶Šåˆ†æ•£æ•ˆæœè¶Šå¥½ã€‚</li><li>åœ¨å–æ¨¡è®¡ç®—æ—¶ï¼Œå¦‚æœæ¨¡æ•°æ˜¯2çš„å¹‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä½è¿ç®—æ¥å¾—åˆ°ç»“æœï¼Œæ•ˆç‡è¦å¤§å¤§é«˜äºåšé™¤æ³•ã€‚æ‰€ä»¥ä»hashè®¡ç®—çš„æ•ˆç‡ä¸Šï¼Œåˆæ˜¯HashMapæ›´èƒœä¸€ç­¹ã€‚</li><li>ä½†æ˜¯ï¼ŒHashMapä¸ºäº†æé«˜æ•ˆç‡ä½¿ç”¨ä½è¿ç®—ä»£æ›¿å“ˆå¸Œï¼Œè¿™åˆå¼•å…¥äº†å“ˆå¸Œåˆ†å¸ƒä¸å‡åŒ€çš„é—®é¢˜ï¼Œæ‰€ä»¥HashMapä¸ºè§£å†³è¿™é—®é¢˜ï¼Œåˆå¯¹hashç®—æ³•åšäº†ä¸€äº›æ”¹è¿›ï¼Œè¿›è¡Œäº†æ‰°åŠ¨è®¡ç®—ã€‚</li></ul><h3 id="4-ConcurrentHashMap-In-Java-7"><a href="#4-ConcurrentHashMap-In-Java-7" class="headerlink" title="4.ConcurrentHashMap In Java 7"></a>4.ConcurrentHashMap In Java 7</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> h <span class="token operator">=</span> hashSeed<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> h<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>k <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Hashing</span><span class="token punctuation">.</span><span class="token function">stringHash32</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    h <span class="token operator">^=</span> k<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Spread bits to regularize both segment and index locations,</span>    <span class="token comment">// using variant of single-word Wang/Jenkins hash.</span>    h <span class="token operator">+=</span> <span class="token punctuation">(</span>h <span class="token operator">&lt;&lt;</span>  <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xffffcd7d</span><span class="token punctuation">;</span>    h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    h <span class="token operator">+=</span> <span class="token punctuation">(</span>h <span class="token operator">&lt;&lt;</span>   <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span>  <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    h <span class="token operator">+=</span> <span class="token punctuation">(</span>h <span class="token operator">&lt;&lt;</span>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>h <span class="token operator">&lt;&lt;</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>hash <span class="token operator">&gt;&gt;&gt;</span> segmentShift<span class="token punctuation">)</span> <span class="token operator">&amp;</span> segmentMask<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢è¿™æ®µå…³äºConcurrentHashMapçš„hashå®ç°å…¶å®å’ŒHashMapå¦‚å‡ºä¸€è¾™ã€‚éƒ½æ˜¯é€šè¿‡ä½è¿ç®—ä»£æ›¿å–æ¨¡ï¼Œç„¶åå†å¯¹hashcodeè¿›è¡Œæ‰°åŠ¨ã€‚åŒºåˆ«åœ¨äºï¼ŒConcurrentHashMap ä½¿ç”¨äº†ä¸€ç§å˜ç§çš„Wang/Jenkins å“ˆå¸Œç®—æ³•ï¼Œå…¶ä¸»è¦æ¯çš„ä¹Ÿæ˜¯ä¸ºäº†æŠŠé«˜ä½å’Œä½ä½ç»„åˆåœ¨ä¸€èµ·ï¼Œé¿å…å‘ç”Ÿå†²çªã€‚è‡³äºä¸ºå•¥ä¸å’ŒHashMapé‡‡ç”¨åŒæ ·çš„ç®—æ³•è¿›è¡Œæ‰°åŠ¨ï¼Œæˆ‘çŒœè¿™åªæ˜¯ç¨‹åºå‘˜è‡ªç”±æ„å¿—çš„é€‰æ‹©å§ã€‚è‡³å°‘æˆ‘ç›®å‰æ²¡æœ‰åŠæ³•è¯æ˜å“ªä¸ªæ›´ä¼˜ã€‚</p><h3 id="5-HashMap-In-Java-8"><a href="#5-HashMap-In-Java-8" class="headerlink" title="5.HashMap In Java 8"></a>5.HashMap In Java 8</h3><p>åœ¨Java 8 ä¹‹å‰ï¼ŒHashMapå’Œå…¶ä»–åŸºäºmapçš„ç±»éƒ½æ˜¯é€šè¿‡é“¾åœ°å€æ³•è§£å†³å†²çªï¼Œå®ƒä»¬ä½¿ç”¨å•å‘é“¾è¡¨æ¥å­˜å‚¨ç›¸åŒç´¢å¼•å€¼çš„å…ƒç´ ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹å¼ä¼šå°†HashMapçš„getæ–¹æ³•çš„æ€§èƒ½ä»<code>O(1)</code>é™ä½åˆ°<code>O(n)</code>ã€‚ä¸ºäº†è§£å†³åœ¨é¢‘ç¹å†²çªæ—¶hashmapæ€§èƒ½é™ä½çš„é—®é¢˜ï¼ŒJava 8ä¸­ä½¿ç”¨å¹³è¡¡æ ‘æ¥æ›¿ä»£é“¾è¡¨å­˜å‚¨å†²çªçš„å…ƒç´ ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†æœ€åæƒ…å†µä¸‹çš„æ€§èƒ½ä»<code>O(n)</code>æé«˜åˆ°<code>O(logn)</code>ã€‚å…³äºHashMapåœ¨Java 8ä¸­çš„ä¼˜åŒ–ï¼Œæˆ‘åé¢ä¼šæœ‰æ–‡ç« ç»§ç»­æ·±å…¥ä»‹ç»ã€‚</p><p>å¦‚æœæ¶æ„ç¨‹åºçŸ¥é“æˆ‘ä»¬ç”¨çš„æ˜¯Hashç®—æ³•ï¼Œåˆ™åœ¨çº¯é“¾è¡¨æƒ…å†µä¸‹ï¼Œå®ƒèƒ½å¤Ÿå‘é€å¤§é‡è¯·æ±‚å¯¼è‡´å“ˆå¸Œç¢°æ’ï¼Œç„¶åä¸åœè®¿é—®è¿™äº›keyå¯¼è‡´HashMapå¿™äºè¿›è¡Œçº¿æ€§æŸ¥æ‰¾ï¼Œæœ€ç»ˆé™·å…¥ç˜«ç—ªï¼Œå³å½¢æˆäº†æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDoSï¼‰ã€‚</p><p>å…³äºJava 8ä¸­çš„hashå‡½æ•°ï¼ŒåŸç†å’ŒJava 7ä¸­åŸºæœ¬ç±»ä¼¼ã€‚Java 8ä¸­è¿™ä¸€æ­¥åšäº†ä¼˜åŒ–ï¼Œåªåšä¸€æ¬¡16ä½å³ä½ç§»å¼‚æˆ–æ··åˆï¼Œè€Œä¸æ˜¯å››æ¬¡ï¼Œä½†åŸç†æ˜¯ä¸å˜çš„ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> h<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ã€‚ä»¥ä¸Šæ–¹æ³•å¾—åˆ°çš„intçš„hashå€¼ï¼Œç„¶åå†é€šè¿‡<code>h &amp; (table.length -1)</code>æ¥å¾—åˆ°è¯¥å¯¹è±¡åœ¨æ•°æ®ä¸­ä¿å­˜çš„ä½ç½®ã€‚</p><p>HashTable In Java 8</p><p>åœ¨Java 8çš„HashTableä¸­ï¼Œå·²ç»ä¸åœ¨æœ‰hashæ–¹æ³•äº†ã€‚ä½†æ˜¯å“ˆå¸Œçš„æ“ä½œè¿˜æ˜¯åœ¨çš„ï¼Œæ¯”å¦‚åœ¨putæ–¹æ³•ä¸­å°±æœ‰å¦‚ä¸‹å®ç°ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> hash <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token punctuation">(</span>hash <span class="token operator">&amp;</span> <span class="token number">0x7FFFFFFF</span><span class="token punctuation">)</span> <span class="token operator">%</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™å…¶å®å’ŒJava 7ä¸­çš„å®ç°å‡ ä¹æ— å·®åˆ«ï¼Œå°±ä¸åšè¿‡å¤šçš„ä»‹ç»äº†ã€‚</p><h3 id="6-ConcurrentHashMap-In-Java-8"><a href="#6-ConcurrentHashMap-In-Java-8" class="headerlink" title="6.ConcurrentHashMap In Java 8"></a>6.ConcurrentHashMap In Java 8</h3><p>Java 8 é‡Œé¢çš„æ±‚hashçš„æ–¹æ³•ä»hashæ”¹ä¸ºäº†spreadã€‚å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">spread</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> HASH_BITS<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Java 8çš„ConcurrentHashMapåŒæ ·æ˜¯é€šè¿‡Keyçš„å“ˆå¸Œå€¼ä¸æ•°ç»„é•¿åº¦å–æ¨¡ç¡®å®šè¯¥Keyåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ã€‚åŒæ ·ä¸ºäº†é¿å…ä¸å¤ªå¥½çš„Keyçš„hashCodeè®¾è®¡ï¼Œå®ƒé€šè¿‡å¦‚ä¸‹æ–¹æ³•è®¡ç®—å¾—åˆ°Keyçš„æœ€ç»ˆå“ˆå¸Œå€¼ã€‚ä¸åŒçš„æ˜¯ï¼ŒJava 8çš„ConcurrentHashMapä½œè€…è®¤ä¸ºå¼•å…¥çº¢é»‘æ ‘åï¼Œå³ä½¿å“ˆå¸Œå†²çªæ¯”è¾ƒä¸¥é‡ï¼Œå¯»å€æ•ˆç‡ä¹Ÿè¶³å¤Ÿé«˜ï¼Œæ‰€ä»¥ä½œè€…å¹¶æœªåœ¨å“ˆå¸Œå€¼çš„è®¡ç®—ä¸Šåšè¿‡å¤šè®¾è®¡ï¼Œåªæ˜¯å°†Keyçš„hashCodeå€¼ä¸å…¶é«˜16ä½ä½œå¼‚æˆ–å¹¶ä¿è¯æœ€é«˜ä½ä¸º0ï¼ˆä»è€Œä¿è¯æœ€ç»ˆç»“æœä¸ºæ­£æ•´æ•°ï¼‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Arrays.sortåº•å±‚æºç </title>
      <link href="2021/04/01/arrays-sort-di-ceng-yuan-ma/"/>
      <url>2021/04/01/arrays-sort-di-ceng-yuan-ma/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaçš„Arrays-sort-æ–¹æ³•åˆ°åº•ç”¨çš„ä»€ä¹ˆæ’åºç®—æ³•"><a href="#Javaçš„Arrays-sort-æ–¹æ³•åˆ°åº•ç”¨çš„ä»€ä¹ˆæ’åºç®—æ³•" class="headerlink" title="Javaçš„Arrays.sort()æ–¹æ³•åˆ°åº•ç”¨çš„ä»€ä¹ˆæ’åºç®—æ³•"></a>Javaçš„Arrays.sort()æ–¹æ³•åˆ°åº•ç”¨çš„ä»€ä¹ˆæ’åºç®—æ³•</h1><p>æ•°ç»„ä¸€è¿›æ¥ï¼Œä¼šç¢°åˆ°ç¬¬ä¸€ä¸ªé˜€å€¼QUICKSORT_THRESHOLDï¼ˆ286ï¼‰ï¼Œæ³¨è§£ä¸Šè¯´ï¼Œå°è¿‡è¿™ä¸ªé˜€å€¼çš„è¿›å…¥Quicksort ï¼ˆå¿«é€Ÿæ’åºï¼‰ï¼Œå…¶å®å¹¶ä¸å…¨æ˜¯ï¼Œç‚¹è¿›å»sort(a, left, right, true);æ–¹æ³•ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Use Quicksort on small arrays</span><span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left <span class="token operator">&lt;</span> QUICKSORT_THRESHOLD<span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token comment">//QUICKSORT_THRESHOLD = 286</span>        <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-å…ƒç´ å°‘äº47ç”¨æ’å…¥æ’åº"><a href="#1-å…ƒç´ å°‘äº47ç”¨æ’å…¥æ’åº" class="headerlink" title="1. å…ƒç´ å°‘äº47ç”¨æ’å…¥æ’åº"></a>1. å…ƒç´ å°‘äº47ç”¨æ’å…¥æ’åº</h2><p>ç‚¹è¿›å»åæˆ‘ä»¬çœ‹åˆ°ç¬¬äºŒä¸ªé˜€å€¼INSERTION_SORT_THRESHOLDï¼ˆ47ï¼‰ï¼Œå¦‚æœå…ƒç´ å°‘äº47è¿™ä¸ªé˜€å€¼ï¼Œå°±ç”¨æ’å…¥æ’åºï¼Œå¾€ä¸‹çœ‹ç¡®å®å¦‚æ­¤ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Use insertion sort on tiny arrays</span><span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">&lt;</span> INSERTION_SORT_THRESHOLD<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>leftmost<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* * Traditional (without sentinel) insertion sort, * optimized for server VM, is used in case of * the leftmost part. */</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> left<span class="token punctuation">,</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> right<span class="token punctuation">;</span> j <span class="token operator">=</span> <span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">int</span> ai <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token keyword">while</span> <span class="token punctuation">(</span>ai <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>     <span class="token punctuation">{</span>          a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token operator">--</span> <span class="token operator">==</span> left<span class="token punctuation">)</span>          <span class="token punctuation">{</span>               <span class="token keyword">break</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> ai<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-å¿«é€Ÿæ’åºï¼ˆQuick-Sortï¼‰47-286"><a href="#2-å¿«é€Ÿæ’åºï¼ˆQuick-Sortï¼‰47-286" class="headerlink" title="2. å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰47-286"></a>2. å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰47-286</h2><p>ã€€ã€€è‡³äºå¤§è¿‡INSERTION_SORT_THRESHOLDï¼ˆ47ï¼‰çš„ï¼Œç”¨ä¸€ç§å¿«é€Ÿæ’åºçš„æ–¹æ³•ï¼š</p><p>ã€€ã€€1.ä»æ•°åˆ—ä¸­æŒ‘å‡ºäº”ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰ï¼›</p><p>ã€€ã€€2.é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œï¼›</p><p>ã€€ã€€3.é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚</p><p>è¿™æ˜¯å°‘äºé˜€å€¼QUICKSORT_THRESHOLDï¼ˆ286ï¼‰çš„ä¸¤ç§æƒ…å†µï¼Œè‡³äºå¤§äº286çš„ï¼Œå®ƒä¼šè¿›å…¥å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œå®ƒæœ‰ä¸ªå°åŠ¨ä½œï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Check if the array is nearly sorted</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> left<span class="token punctuation">;</span> k <span class="token operator">&lt;</span> right<span class="token punctuation">;</span> run<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ascending</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&gt;</span> a<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// descending</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> lo <span class="token operator">=</span> run<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> hi <span class="token operator">=</span> k<span class="token punctuation">;</span> <span class="token operator">++</span>lo <span class="token operator">&lt;</span> <span class="token operator">--</span>hi<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> t <span class="token operator">=</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>hi<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>hi<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// equal</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> MAX_RUN_LENGTH<span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>m <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">/*         * The array is not highly structured,         * use Quicksort instead of merge sort.         */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count <span class="token operator">==</span> MAX_RUN_COUNT<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä¸»è¦ä½œç”¨æ˜¯çœ‹ä»–æ•°ç»„å…·ä¸å…·å¤‡ç»“æ„ï¼šå®é™…é€»è¾‘æ˜¯åˆ†ç»„æ’åºï¼Œæ¯é™åºä¸ºä¸€ä¸ªç»„ï¼Œåƒ1,9,8,7,6,8ã€‚9åˆ°6æ˜¯é™åºï¼Œä¸ºä¸€ä¸ªç»„ï¼Œç„¶åæŠŠé™åºçš„ä¸€ç»„æ’æˆå‡åºï¼š1,6,7,8,9,8ã€‚ç„¶åæœ€åçš„8åé¢ç»§ç»­å¾€åé¢æ‰¾ã€‚</p><p>ã€€ã€€æ¯é‡åˆ°è¿™æ ·ä¸€ä¸ªé™åºç»„ï¼Œ++countï¼Œå½“countå¤§äºMAX_RUN_COUNTï¼ˆ67ï¼‰ï¼Œè¢«åˆ¤æ–­ä¸ºè¿™ä¸ªæ•°ç»„ä¸å…·å¤‡ç»“æ„ï¼ˆä¹Ÿå°±æ˜¯è¿™æ•°æ®æ—¶è€Œå‡æ—¶è€Œé™ï¼‰ï¼Œç„¶åé€ç»™ä¹‹å‰çš„sort(é‡Œé¢çš„å¿«é€Ÿæ’åº)çš„æ–¹æ³•ï¼ˆThe array is not highly structured,use Quicksort instead of merge sort.ï¼‰</p><p>ã€€ã€€å¦‚æœcountå°‘äºMAX_RUN_COUNTï¼ˆ67ï¼‰çš„ï¼Œè¯´æ˜è¿™ä¸ªæ•°ç»„è¿˜æœ‰ç‚¹ç»“æ„ï¼Œå°±ç»§ç»­å¾€ä¸‹èµ°ä¸‹é¢çš„å½’å¹¶æ’åºã€‚</p><p>æ€»ç»“ï¼š</p><p>ã€€ã€€ä»ä¸Šé¢åˆ†æï¼ŒArrays.sortå¹¶ä¸æ˜¯å•ä¸€çš„æ’åºï¼Œè€Œæ˜¯æ’å…¥æ’åºï¼Œå¿«é€Ÿæ’åºï¼Œå½’å¹¶æ’åºä¸‰ç§æ’åºçš„ç»„åˆï¼Œä¸ºæ­¤æˆ‘ç”»äº†ä¸ªæµç¨‹å›¾ï¼š</p><p><img src="/2021/04/01/arrays-sort-di-ceng-yuan-ma/1701765-20191126153931611-191817306.png" alt="img"></p><h2 id="3-å½’å¹¶æ’åº-gt-286"><a href="#3-å½’å¹¶æ’åº-gt-286" class="headerlink" title="3. å½’å¹¶æ’åº >286"></a>3. å½’å¹¶æ’åº &gt;286</h2><p>O(nlogn)åªä»£è¡¨å¢é•¿é‡çº§ï¼ŒåŒä¸€ä¸ªé‡çº§å‰é¢çš„å¸¸æ•°ä¹Ÿå¯ä»¥ä¸ä¸€æ ·ï¼Œä¸åŒæ•°é‡ä¸‹é¢çš„å®é™…è¿ç®—æ—¶é—´ä¹Ÿå¯ä»¥ä¸ä¸€æ ·ã€‚</p><p>ã€€ã€€æ•°é‡éå¸¸å°çš„æƒ…å†µä¸‹ï¼ˆå°±åƒä¸Šé¢è¯´åˆ°çš„ï¼Œå°‘äº47çš„ï¼‰ï¼Œæ’å…¥æ’åºç­‰å¯èƒ½ä¼šæ¯”å¿«é€Ÿæ’åºæ›´å¿«ã€‚ æ‰€ä»¥æ•°ç»„å°‘äº47çš„ä¼šè¿›å…¥æ’å…¥æ’åºã€‚  </p><p>ã€€ã€€å¿«æ’æ•°æ®è¶Šæ— åºè¶Šå¿«ï¼ˆåŠ å…¥éšæœºåŒ–ååŸºæœ¬ä¸ä¼šé€€åŒ–ï¼‰ï¼Œå¹³å‡å¸¸æ•°æœ€å°ï¼Œä¸éœ€è¦é¢å¤–ç©ºé—´ï¼Œä¸ç¨³å®šæ’åºã€‚</p><p>ã€€ã€€å½’æ’é€Ÿåº¦ç¨³å®šï¼Œå¸¸æ•°æ¯”å¿«æ’ç•¥å¤§ï¼Œéœ€è¦é¢å¤–ç©ºé—´ï¼Œç¨³å®šæ’åºã€‚</p><p>ã€€ã€€æ‰€ä»¥å¤§äºæˆ–ç­‰äº47æˆ–å°‘äº286ä¼šè¿›å…¥å¿«æ’ï¼Œè€Œåœ¨å¤§äºæˆ–ç­‰äº286åï¼Œä¼šæœ‰ä¸ªå°åŠ¨ä½œï¼šâ€œ// Check if the array is nearly sortedâ€ã€‚è¿™é‡Œç¬¬ä¸€ä¸ªä½œç”¨æ˜¯å…ˆæ¢³ç†ä¸€ä¸‹æ•°æ®æ–¹ä¾¿åç»­çš„å½’å¹¶æ’åºï¼Œç¬¬äºŒä¸ªä½œç”¨å°±æ˜¯å³ä¾¿å¤§äº286ï¼Œä½†åœ¨é™åºç»„å¤ªå¤šçš„æ—¶å€™ï¼ˆè¢«åˆ¤æ–­ä¸ºæ²¡æœ‰ç»“æ„çš„æ•°æ®ï¼ŒThe array is not highly structured,use Quicksort instead of merge sort.ï¼‰ï¼Œè¦è½¬å›å¿«é€Ÿæ’åºã€‚</p><blockquote><p>åœ¨JDK 1.7ä¸­ï¼Œ<code>DualQuickSort</code>è¢«é¦–æ¬¡å¼•å…¥ï¼Œåœ¨1.8ä¸­åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå…·ä½“çš„å˜åŒ–æˆ‘è¿™é‡Œå°±ä¸å†å¯¹æ¯”äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»è‡ªå·±å¯¹æ¯”ä¸€ä¸‹ã€‚æ¥ä¸‹æ¥çš„åˆ†æåŸºäºJDK 1.8.1 u121çš„ä»£ç </p></blockquote><h4 id="3-1åŒè½´å¿«æ’-DualQuickSort"><a href="#3-1åŒè½´å¿«æ’-DualQuickSort" class="headerlink" title="3.1åŒè½´å¿«æ’ - DualQuickSort"></a>3.1åŒè½´å¿«æ’ - <code>DualQuickSort</code></h4><blockquote><p>å…¥å£å‡½æ•°æ˜¯<code>+Arrays.sort(int[] a)</code>ï¼Œæ¶‰åŠåˆ°çš„å‡½æ•°æœ‰</p><ul><li><code>~DualPivotQuicksort.sort(int[] a, int left, int right, int[] work, int workBase, int workLen)</code></li><li><code>-DualPivotQuicksort.sort(int[] a, int left, int right, boolean leftmost)</code></li></ul></blockquote><p>å®é™…çš„æ‰§è¡Œå‡½æ•°æœ‰ä¸¤ä¸ªï¼Œæˆ‘ä»¬ä¾æ¬¡æ¥çœ‹ã€‚</p><p>åŒè½´å¿«æ’å¯¹å¤–å…¥å£ - <code>~DualPivotQuicksort.sort(int[] a, int left, int right, int[] work, int workBase, int workLen)</code></p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å®ƒçš„è°ƒç”¨æµç¨‹</p><p><img src="/2021/04/01/arrays-sort-di-ceng-yuan-ma/1.PNG"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶æœ¬èº«çš„ç±»åæ˜¯åŒè½´å¿«æ’(<code>DualPivotQuicksort</code>)ã€‚ä½†æ˜¯è¿˜ä¼šç»¼åˆå…¶å®ƒæ’åºæ–¹æ³•ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­ï¼Œå¦‚æœæ£€æµ‹å‡ºæ•°ç»„æ¯”è¾ƒæœ‰åºçš„æƒ…å†µä¸‹ï¼Œåˆ™ä¼šä½¿ç”¨<code>merge sort</code>çš„æ€è·¯æ¥è¿›è¡Œå¤„ç†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å›¾ä¸­<code>E</code>, <code>J</code>æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><p>æˆ‘ä»¬å…ˆå‚è€ƒä¸€ä¸‹è¿™éƒ¨åˆ†çš„åŸå§‹ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* * Index run[i] is the start of i-th run * (ascending or descending sequence). */</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> run <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>MAX_RUN_COUNT <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// MAX_RUN_COUNT = 67</span><span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> run<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> left<span class="token punctuation">;</span><span class="token comment">// Check if the array is nearly sorted</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> left<span class="token punctuation">;</span> k <span class="token operator">&lt;</span> right<span class="token punctuation">;</span> run<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ascending</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&gt;</span> a<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// descending</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> lo <span class="token operator">=</span> run<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> hi <span class="token operator">=</span> k<span class="token punctuation">;</span> <span class="token operator">++</span>lo <span class="token operator">&lt;</span> <span class="token operator">--</span>hi<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> t <span class="token operator">=</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>hi<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>hi<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// equal</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> MAX_RUN_LENGTH<span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// MAX_RUN_LENGTH = 33</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>m <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/*     * The array is not highly structured,     * use Quicksort instead of merge sort.     */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count <span class="token operator">==</span> MAX_RUN_COUNT<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// Check special cases</span><span class="token comment">// Implementation note: variable "right" is increased by 1.</span><span class="token keyword">if</span> <span class="token punctuation">(</span>run<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">==</span> right<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// The last run contains one element</span>    run<span class="token punctuation">[</span><span class="token operator">++</span>count<span class="token punctuation">]</span> <span class="token operator">=</span> right<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// The array is already sorted</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œææ¸…æ¥šå˜é‡<code>run</code>, <code>count</code>, <code>k</code>, <code>m</code>è¿™4ä¸ªå˜é‡çš„å«ä¹‰å°±æ¯”è¾ƒå®¹æ˜“ç†è§£ä»£ç çš„å®ç°äº†ã€‚</p><p>æˆ‘ç†è§£ä¸‹æ¥ï¼Œå®ƒä»¬åˆ†åˆ«çš„å«ä¹‰å¦‚ä¸‹</p><ul><li><code>run</code> - è®°å½•æ¯ä¸€ä¸ªè¿ç»­åŒºé—´ï¼Œå¯¹åº”çš„å¼€å§‹å…ƒç´ çš„ä¸‹æ ‡</li><li><code>count</code> - è®°å½•åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»æ£€æµ‹åˆ°æœ‰å¤šå°‘ä¸ªé€’å¢çš„åŒºé—´ï¼ŒåŒæ—¶ä¹Ÿæ˜¯forå¾ªç¯çš„æ¬¡æ•°ã€‚æ³¨æ„å…¶å€¼ä»0å¼€å§‹ï¼Œæ‰€ä»¥ç¬¬1ä¸ªåŒºé—´çš„èŒƒå›´æ˜¯<code>[run[0], run[1])</code>ï¼Œä»¥æ­¤ç±»æ¨</li><li><code>k</code> - æ¸¸æ ‡ï¼Œæ•´ä¸ªforå¾ªç¯ä¸­ï¼ŒæŒ‡å‘å½“å‰æ‰€éå†åˆ°çš„å…ƒç´ </li><li><code>m</code> - ç”¨äºè¾…åŠ©åˆ¤æ–­ä¸€æ®µè¿ç»­ç›¸ç­‰çš„å…ƒç´ åŒºé—´çš„çš„é•¿åº¦æ˜¯å¦å·²ç»è¾¾åˆ°æŒ‡å®šçš„ä¸Šé™</li></ul><p>ä¸Šé¢å‡ ä¸ªå˜é‡è™½ç„¶ç”¨æ–‡å­—è§£é‡Šäº†ä¸€ä¸‹ï¼Œä¾ç„¶æ¯”è¾ƒæ™¦æ¶©ã€‚è¿™é‡Œæˆ‘ç”»ä¸€ä¸ªç®€å•çš„ç¤ºæ„å›¾ï¼Œä½ å°±æ˜ç™½åˆ°åº•æ˜¯å¦‚ä½•æ£€æµ‹æ˜¯å¦æœ‰åºï¼Œä»¥åŠæ‰€è°“æœ‰åºçš„æ ‡å‡†æ˜¯ä»€ä¹ˆäº†ã€‚</p><p><img src="/2021/04/01/arrays-sort-di-ceng-yuan-ma/2.PNG"></p><blockquote><p>è‡³äºä¸¤ä¸ªå¸¸é‡<code>MAX_RUN_COUNT</code>ä¸<code>MAX_RUN_LENGTH</code>çš„å€¼æ˜¯æ€ä¹ˆæ¥çš„ï¼ŒçŒœæµ‹ä¾ç„¶æ˜¯ç»éªŒå€¼å§ã€‚æœ‰æ¸…æ¥šçš„åŒå­¦å¯ä»¥å‘Šè¯‰æˆ‘ã€‚</p></blockquote><p>forå¾ªç¯å¼€å§‹æœ‰<code>if-elseif-else</code>çš„è¯­å¥ã€‚æ˜¯æŠŠå½“å‰å…ƒç´ ä¸ä¸‹ä¸€ä¸ªå…ƒç´ åšæ¯”è¾ƒï¼Œå°†ç»“æœåˆ†æˆäº†3ç§æƒ…å†µ</p><ul><li>å½“å‰å…ƒç´  &lt; ä¸‹ä¸€ä¸ªå…ƒç´ </li><li>å½“å‰å…ƒç´  &gt; ä¸‹ä¸€ä¸ªå…ƒç´ </li><li>å½“å‰å…ƒç´  = ä¸‹ä¸€ä¸ªå…ƒç´ </li></ul><p>å…¶ä¸­<code>&lt;</code>è¿™ç§æƒ…å†µæœ€ç®€å•ï¼Œå·²ç»æ˜¯æœŸæœ›çš„å‡åºåŒºé—´ã€‚è¯¥blocké‡Œè¾¹çš„<code>while</code>å¾ªç¯åˆ™ç”¨äºå‘å³ç§»åŠ¨æ¸¸æ ‡ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªé™åºçš„å…ƒç´ ã€‚å³</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>&gt;</code>è¿™ç§æƒ…å†µç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œè¿™ä¸ªblocké‡Œè¾¹æ˜¯æ‰¾ä¸€ä¸ªè¿ç»­çš„é™åºåŒºé—´ã€‚ç„¶åå°†è¯¥åŒºé—´ä»ä¸¤ç«¯åˆ°ä¸­é—´çš„æ–¹å‘é¦–å°¾äº¤æ¢å…ƒç´ ï¼Œä»è€Œå°†åŸæœ¬çš„é™åºåŒºé—´è½¬å˜æˆä¸€ä¸ªå‡åºåŒºé—´ã€‚å³</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> lo <span class="token operator">=</span> run<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> hi <span class="token operator">=</span> k<span class="token punctuation">;</span> <span class="token operator">++</span>lo <span class="token operator">&lt;</span> <span class="token operator">--</span>hi<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> t <span class="token operator">=</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>hi<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>hi<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>=</code>è¿™ç§æƒ…å†µä¸‹æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å¤„ç†ï¼Œå½“ä¾¦æµ‹åˆ°è¿ç»­ç›¸ç­‰åŒºé—´çš„é•¿åº¦<code>&gt;=33</code>çš„æ—¶å€™ï¼Œå³ä¸Šå›¾ä¸­çš„æŸä¸ªåŒºé—´<code>æœ‰å¤§é‡è¿ç»­ç›¸ç­‰å…ƒç´ </code>çš„æ—¶å€™ï¼Œåœæ­¢åç»­çš„ä¾¦æµ‹ï¼Œç›´æ¥è½¬ç”¨<code>åŒè½´å¿«æ’</code>ã€‚ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> MAX_RUN_LENGTH<span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token operator">&lt;=</span> right <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>m <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨forå¾ªç¯æ¥ä¸‹æ¥çš„é€»è¾‘é‡Œï¼Œåˆ¤æ–­<code>count</code>çš„å€¼æ˜¯å¦å·²ç»è¾¾åˆ°<code>67</code>è¿™ä¸ªä¸Šé™ã€‚å³æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢å·²ç»æ‰¾å‡ºäº†<code>67</code>ä¸ªé€’å¢çš„åŒºé—´ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰éå†ç»“æŸï¼Œé‚£ä¹ˆå°±è®¤ä¸ºå½“å‰æ•°ç»„<code>ä¸æ˜¯å¾ˆæœ‰åº</code>ï¼Œé‚£ä¹ˆå°±ä¼šè½¬ç”¨<code>åŒè½´å¿«æ’</code>è¿›è¡Œå¤„ç†ã€‚ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* * The array is not highly structured, * use Quicksort instead of merge sort. */</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count <span class="token operator">==</span> MAX_RUN_COUNT<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>forå¾ªç¯ç»“æŸåï¼Œå¦‚æœæ²¡æœ‰returnï¼Œé‚£è¯´æ˜é€’å¢åŒºé—´åˆ’åˆ†å®Œæˆã€‚æ¥ä¸‹æ¥çš„ä»£ç æ¯”è¾ƒç®€å•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Check special cases</span><span class="token comment">// Implementation note: variable "right" is increased by 1.</span><span class="token keyword">if</span> <span class="token punctuation">(</span>run<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">==</span> right<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// The last run contains one element</span>    run<span class="token punctuation">[</span><span class="token operator">++</span>count<span class="token punctuation">]</span> <span class="token operator">=</span> right<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// The array is already sorted</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>else-if</code> çš„æ¡ä»¶åˆ¤æ–­ <code>count == 1</code>è¯´æ˜åªæœ‰ä¸€ä¸ªé€’å¢åŒºé—´ï¼Œå³æ•°ç»„å·²ç»å®Œå…¨æœ‰åºï¼Œç›´æ¥returnï¼Œæ¯”è¾ƒå¾ˆå®¹æ˜“ç†è§£ã€‚</p><p>ä½†æ˜¯ä¸å…¶å¯¹åº”çš„<code>if</code>é€»è¾‘ä¸å¤ªå®¹æ˜“ç†è§£ï¼Œæœ‰äº›æ–‡ç« è§£è¯»ä¸ºæ·»åŠ ä¸€ä¸ªå“¨å…µå…ƒç´ ï¼Œä½†æ˜¯ä»”ç»†é˜…è¯»ä¸‹æ¥å…¶å®å¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚å°±åƒæ³¨é‡Šé‡Œè¾¹è¯´çš„ï¼Œå®ƒæ˜¯ç”¨äºå¤„ç†ç‰¹æ®Šæƒ…å†µ - æœ€åä¸€ä¸ªåŒºé—´åªåŒ…æ‹¬ä¸€ä¸ªå…ƒç´ ã€‚</p><p>æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿæ•´ä¸ªforå¾ªç¯å¯ä»¥å‘ç°ï¼Œæ¯æ‰§è¡Œå®Œ1æ¬¡å¾ªç¯ï¼Œcountè®¡æ•°åŠ 1ï¼Œrun[count]åˆ™è®°å½•çš„æ˜¯åˆšåˆšæµ‹é‡è¿‡çš„åŒºé—´çš„ç»“æŸä½ç½®(ä¸åŒ…å«)ã€‚å½“æœ€åä¸€ä¸ªåŒºé—´åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œrun[count]å…¶å®è®°å½•çš„æ˜¯æœ€åä¸€ä¸ªåŒºé—´çš„å¼€å§‹çš„ä½ç½®(åŒ…å«)ï¼Œæ²¡æœ‰è®°å½•å…¶å¯¹åº”çš„ç»“æŸä½ç½®ï¼Œå³<code>right+1</code>ã€‚æ‰€ä»¥è¿™é‡Œçš„é€»è¾‘æ˜¯å¯¹ç§æƒ…å†µçš„è¡¥å……å¤„ç†ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆå“¨å…µã€‚</p><h4 id="3-2-J"><a href="#3-2-J" class="headerlink" title="3.2 J"></a>3.2 J</h4><p>è¿™éƒ¨åˆ†ä»£ç æ˜¯å°†å‰è¾¹æ£€æµ‹å‡ºæ¥çš„å‡åºåŒºé—´ï¼Œå³ä¸€ä¸ªä¸€ä¸ªæœ‰åºå°æ•°ç»„ï¼Œåˆå¹¶æœ€ç»ˆæˆä¸ºä¸€ä¸ªæœ‰åºçš„å¤§æ•°ç»„ã€‚æ‰€ä»¥å…¶å®å®ƒæ˜¯<code>merge sort</code>ä¸­åˆå¹¶å‡½æ•°çš„<code>è¿­ä»£ç‰ˆæœ¬</code>ã€‚</p><p>å®ƒç®€å•å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†é€»è¾‘ï¼š</p><ul><li>ç¡®å®šå¹¶åˆ›å»ºä¸´æ—¶æ•°ç»„<code>b</code>ï¼Œä»¥ä¾›åˆå¹¶æ—¶ä½¿ç”¨</li><li>è¿­ä»£è€Œéé€’å½’è¿›è¡Œåˆå¹¶</li></ul><p>åœ¨å†™æ–‡ç« çš„æ—¶å€™æˆ‘ä¹Ÿå‚è€ƒè¿‡å…¶ä»–äººçš„åˆ†æï¼Œä½†å¾ˆå¤šéƒ½æ˜¯ä¸€ç¬”å¸¦è¿‡æˆ–è€…è¯­ç„‰ä¸è¯¦ï¼Œå¹¶æ²¡æœ‰è®²å¾—å¾ˆæ¸…æ¥šï¼Œæ‰€ä»¥æˆ‘å‡†å¤‡è‡ªå·±æŠŠå®ƒææ˜ç™½ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€éƒ¨åˆ† - ç¡®å®šå¹¶åˆ›å»ºä¸´æ—¶æ•°ç»„<code>b</code>ï¼Œä»¥ä¾›åˆå¹¶æ—¶ä½¿ç”¨</p><p>è¿™é‡Œæ˜¯åŸå§‹ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Determine alternation base for merge</span><span class="token keyword">byte</span> odd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> odd <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment">// Use or create temporary array b for merging</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b<span class="token punctuation">;</span>                 <span class="token comment">// temp array; alternates with a</span><span class="token keyword">int</span> ao<span class="token punctuation">,</span> bo<span class="token punctuation">;</span>              <span class="token comment">// array offsets from 'left'</span><span class="token keyword">int</span> blen <span class="token operator">=</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span> <span class="token comment">// space needed for b</span><span class="token keyword">if</span> <span class="token punctuation">(</span>work <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> workLen <span class="token operator">&lt;</span> blen <span class="token operator">||</span> workBase <span class="token operator">+</span> blen <span class="token operator">&gt;</span> work<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>    work <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>blen<span class="token punctuation">]</span><span class="token punctuation">;</span>    workBase <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span>odd <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> work<span class="token punctuation">,</span> workBase<span class="token punctuation">,</span> blen<span class="token punctuation">)</span><span class="token punctuation">;</span>    b <span class="token operator">=</span> a<span class="token punctuation">;</span>    bo <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    a <span class="token operator">=</span> work<span class="token punctuation">;</span>    ao <span class="token operator">=</span> workBase <span class="token operator">-</span> left<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    b <span class="token operator">=</span> work<span class="token punctuation">;</span>    ao <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    bo <span class="token operator">=</span> workBase <span class="token operator">-</span> left<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¾¹çš„ä»£ç ä¸­æœ€è®©äººå›°æƒ‘çš„å¯èƒ½å°±æ˜¯å˜é‡<code>odd</code>çš„å«ä¹‰äº†ã€‚</p><p>ç»è¿‡å¤šæ¬¡è°ƒè¯•ï¼Œæ˜ç™½äº†ä½œè€…çš„æ„å›¾æ˜¯æƒ³è®¡ç®—å‡ºé’ˆå¯¹<code>count</code>ä¸ªæœ‰åºçš„å­æ•°ç»„ï¼Œéœ€è¦å¾ªç¯åˆå¹¶å¤šå°‘æ¬¡æ‰èƒ½å˜ä¸º1ä¸ªå¤§æ•°ç»„ï¼Œæ˜¯å¥‡æ•°æ¬¡è¿˜æ˜¯å¶æ•°æ¬¡ã€‚</p><p>ä¸ºä»€ä¹ˆåªå…³å¿ƒå¥‡å¶å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹åˆå¹¶çš„å®ç°é€»è¾‘ï¼Œå†å›è¿‡æ¥æ€è€ƒè¿™ä¸ªé—®é¢˜ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Merging</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> last<span class="token punctuation">;</span> count <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span> count <span class="token operator">=</span> last<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token punctuation">(</span>last <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span> k <span class="token operator">&lt;=</span> count<span class="token punctuation">;</span> k <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> hi <span class="token operator">=</span> run<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> mi <span class="token operator">=</span> run<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> run<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p <span class="token operator">=</span> i<span class="token punctuation">,</span> q <span class="token operator">=</span> mi<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hi<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>q <span class="token operator">&gt;=</span> hi <span class="token operator">||</span> p <span class="token operator">&lt;</span> mi <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>p <span class="token operator">+</span> ao<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> a<span class="token punctuation">[</span>q <span class="token operator">+</span> ao<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                b<span class="token punctuation">[</span>i <span class="token operator">+</span> bo<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>p<span class="token operator">++</span> <span class="token operator">+</span> ao<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                b<span class="token punctuation">[</span>i <span class="token operator">+</span> bo<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>q<span class="token operator">++</span> <span class="token operator">+</span> ao<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        run<span class="token punctuation">[</span><span class="token operator">++</span>last<span class="token punctuation">]</span> <span class="token operator">=</span> hi<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>count <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> right<span class="token punctuation">,</span> lo <span class="token operator">=</span> run<span class="token punctuation">[</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">--</span>i <span class="token operator">&gt;=</span> lo<span class="token punctuation">;</span>             b<span class="token punctuation">[</span>i <span class="token operator">+</span> bo<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> ao<span class="token punctuation">]</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        run<span class="token punctuation">[</span><span class="token operator">++</span>last<span class="token punctuation">]</span> <span class="token operator">=</span> right<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> t <span class="token operator">=</span> a<span class="token punctuation">;</span> a <span class="token operator">=</span> b<span class="token punctuation">;</span> b <span class="token operator">=</span> t<span class="token punctuation">;</span>    <span class="token keyword">int</span> o <span class="token operator">=</span> ao<span class="token punctuation">;</span> ao <span class="token operator">=</span> bo<span class="token punctuation">;</span> bo <span class="token operator">=</span> o<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä»å¤–åˆ°å†…å…±æœ‰3å±‚å¾ªç¯ï¼Œå…¶ä¸­</p><ul><li>æœ€å†…å±‚å¾ªç¯ - æ˜¯å°†ä¸¤ä¸ªæœ‰åºçš„å­æ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„æ•°ç»„ï¼Œç»“æœä¼šè¢«å†™å…¥åˆ°ä¸´æ—¶æ•°ç»„<code>b</code>ä¸­</li><li>ä¸­é—´å±‚å¾ªç¯ - å°†ç›®å‰çš„å­æ•°ç»„åºåˆ—ä¸¤ä¸¤åˆå¹¶</li><li>æœ€å¤–å±‚å¾ªç¯ - ä¸­é—´å±‚å¾ªç¯æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœæœ‰<code>è½å•</code>çš„å­æ•°ç»„ï¼Œåˆ™ç›´æ¥å°†å…¶å¤åˆ¶è¿‡æ¥(å‚è€ƒ<code>(count &amp; 1) != 0</code>å¤„çš„é€»è¾‘)ï¼Œç„¶åäº¤æ¢<code>a</code>/<code>b</code>æ•°ç»„çš„å¼•ç”¨ã€‚<strong>æ³¨æ„ï¼Œè¿™æ˜¯æ‰§è¡Œè¿‡ä¸€æ¬¡<code>å¾ªç¯åˆå¹¶</code>çš„æ•ˆæœ - å³å°†åŸå§‹çš„<code>count</code>ä¸ªå­æ•°ç»„â€œå‹ç¼©åˆå¹¶â€ä¸º<code>(count+1)/2</code>ä¸ªæ•°ç»„</strong>ã€‚å½“æœ€å<code>count</code>å˜ä¸º<code>1</code>çš„æ—¶å€™ï¼Œæ•´ä¸ªå¾ªç¯ç»“æŸï¼Œå®Œæˆæ’åºã€‚</li></ul><p>ä»ä¸Šé¢çš„åˆ†æä¸­å¯ä»¥å‘ç°ï¼Œæ¯æ‰§è¡Œ1æ¬¡<code>å¾ªç¯åˆå¹¶</code>ï¼Œ<code>a</code>/<code>b</code>æ•°ç»„çš„å¼•ç”¨ä¼šäº¤æ¢1æ¬¡ã€‚æˆ‘ä»¬æŠŠä¸Šè¾¹çš„æ•´ä¸ªåˆå¹¶è¿‡ç¨‹å½“ä¸­<code>å¾ªç¯åˆå¹¶</code>çš„æ¬¡æ•°è®°ä¸º<code>loop_merge_times</code>ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­<code>a</code>/<code>b</code>æ•°ç»„çš„å¼•ç”¨å…±äº¤æ¢äº†<code>loop_merge_times</code>æ¬¡ã€‚</p><p>å¼•ç”¨äº¤æ¢1æ¬¡æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><p>ä¸»è¦æ˜¯ä¸ºä¸‹ä¸€æ¬¡<code>å¾ªç¯åˆå¹¶</code>åšå‡†å¤‡ï¼Œå› ä¸ºæœ¬æ¬¡<code>å¾ªç¯åˆå¹¶</code>æ˜¯æŠŠç»“æœå†™å…¥äº†ä¸´æ—¶æ•°ç»„<code>b</code>ä¸­ï¼Œé‚£ä¹ˆäº¤æ¢<code>a</code>/<code>b</code>çš„å¼•ç”¨ä¹‹åï¼Œä¸‹æ¬¡<code>å¾ªç¯åˆå¹¶</code>å°±ä¼šæŠŠç»“æœå†™å…¥çœŸæ­£çš„æ•°ç»„<code>a</code>ä¸­ã€‚è¿™é‡Œçš„â€œçœŸæ­£â€æŒ‡çš„æ˜¯å½¢å‚<code>a</code>æ‰€å¯¹åº”çš„å®å‚ã€‚(è¿™é‡Œæœ‰ç‚¹ç»•ï¼Œå¯ä»¥ä»”ç»†ä½“ä¼šä¸€ä¸‹)</p><p>æ‰€ä»¥ï¼Œäº¤æ¢å¶æ•°æ¬¡å¼•ç”¨åï¼Œåˆå¹¶åçš„ç»“æœæ˜¯å†™å…¥åˆ°äº†åŸå§‹çš„<code>a</code>ä¸­ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚</p></blockquote><p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å°±æ˜ç™½äº†åˆå¹¶ä¹‹å‰è®¡ç®—<code>odd</code>çš„ä½œç”¨äº†ã€‚<code>loop_merge_times</code>çš„å€¼æ˜¯ä¸€ä¸ª<code>&gt;=1</code>çš„æ­£æ•´æ•°ï¼Œå½“å®ƒä¸ºå¶æ•°æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åšä»€ä¹ˆé¢å¤–å¤„ç†ã€‚ä½†æ˜¯ä¸ºå¥‡æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ€ä¹ˆå¤„ç†æ‰èƒ½ä¿è¯æœ€ååˆå¹¶å®Œæˆä¹‹å<code>a</code>å­˜å‚¨çš„æ˜¯æœ€ç»ˆåˆå¹¶çš„ç»“æœå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨åˆå¹¶ä¹‹å‰åšä¸€æ¬¡é¢„å¤„ç†ï¼Œå…ˆå°†<code>a</code>/<code>b</code>çš„å¼•ç”¨äº¤æ¢1æ¬¡å°±å¯ä»¥æ»¡è¶³éœ€æ±‚äº†ã€‚</p><p>ä½†æ˜¯åˆå¹¶ä¹‹å‰çš„ä»£ç ä¸­çš„<code>odd</code>å…¶å®è®°å½•çš„æ˜¯æ¯”å®é™…çš„<code>å¾ªç¯åˆå¹¶</code>å°‘1æ¬¡çš„ç»“æœã€‚å› ä¸ºç»ˆæ­¢æ¡ä»¶<code>(n &lt;&lt;= 1) &lt; count</code>ç»ˆæ­¢åï¼Œä»éœ€è¦å†è¿›è¡Œ1æ¬¡<code>å¾ªç¯åˆå¹¶</code>ï¼Œæ‰ä¼šå®Œæˆå…¨éƒ¨åˆå¹¶ã€‚æ‰€ä»¥åœ¨ä»£ç é‡Œè¾¹å½“<code>odd == 0</code>æ—¶æ‰æ‰§è¡Œ<code>a</code>/<code>b</code>çš„å¼•ç”¨äº¤æ¢ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†æ­¤å¤„çš„é€»è¾‘æ”¹å†™ä¸€ä¸‹ï¼Œæ›´åŠ ä¾¿äºç†è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Determine alternation base for merge</span><span class="token keyword">byte</span> odd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> loop_merge_times <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> odd <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">++</span>loop_merge_times<span class="token punctuation">)</span> <span class="token punctuation">;</span>loop_merge_times <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>loop_merge_times <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// swap a and b</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// ...</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³äº<code>loop_merge_times</code>çš„è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•°å­¦å…¬å¼ç›´æ¥è®¡ç®—å‡ºæ¥ - å°†<code>log2(count)</code>çš„ç»“æœå‘ä¸Šå–æ•´ã€‚</p><p>ä¸ºä»€ä¹ˆä½œè€…ä½¿ç”¨ä½è¿ç®—è€Œä¸æ˜¯ç›´æ¥æ±‚è§£æ•°å€¼çš„æ–¹æ³•ï¼ŸåŸå› è¿˜æ˜¯æºè‡ªå¯¹é€Ÿåº¦çš„è¿½æ±‚ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„è¿è¡Œæ—¶é—´ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">compareCalcSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">66</span><span class="token punctuation">;</span>    <span class="token keyword">byte</span> odd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// Approach 1</span>    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> odd <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>    odd <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> period <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"loop time: %d ns\n"</span><span class="token punctuation">,</span> period<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Approach 2</span>    start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> logValue <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> mergeLoopTimes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>logValue<span class="token punctuation">)</span><span class="token punctuation">;</span>    period <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"calc time: %d ns\n"</span><span class="token punctuation">,</span> period<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒè½´å¿«æ’å‡½æ•° - <code>-DualPivotQuicksort.sort(int[] a, int left, int right, boolean leftmost)</code></p><p>å‡½æ•°<code>~DualPivotQuicksort.sort(int[] a, int left, int right, boolean leftmost)</code>çš„è°ƒç”¨æµç¨‹</p><p><img src="/2021/04/01/arrays-sort-di-ceng-yuan-ma/3.PNG"></p><p>å‰è¾¹åˆ†æäº†é‚£ä¹ˆå¤šï¼Œå…¶å®è¿˜æ²¡æœ‰çœŸæ­£åˆ°<code>åŒè½´å¿«æ’</code>ï¼Œä¸Šå›¾æ‰æ˜¯<code>åŒè½´å¿«æ’</code>ä»£ç æ‰€åœ¨çš„åœ°æ–¹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«çœ‹çœ‹<code>C</code>, <code>D</code>, <code>H</code>, <code>G</code>æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><h3 id="3-3-ä»£ç å®ç°"><a href="#3-3-ä»£ç å®ç°" class="headerlink" title="3.3 ä»£ç å®ç°"></a>3.3 ä»£ç å®ç°</h3><p>è¿™é‡Œçš„æ’å…¥æ’åºä¼šåˆ†æˆä¸¤ç§æƒ…å†µ</p><ul><li>è¦æ’åºçš„<code>[left, right]</code>åŒºé—´æ˜¯æ•°ç»„<code>a</code>çš„æœ€å·¦ä¾§éƒ¨åˆ†ï¼Œå³<code>left==0</code></li><li>å¦ä¸€ç§å°±æ˜¯è¦æ’åºçš„<code>[left, right]</code>åŒºé—´åœ¨æ•°ç»„<code>a</code>çš„éæœ€å·¦ä¾§éƒ¨åˆ†ï¼Œå³<code>left&gt;0</code></li></ul><p>ç¬¬ä¸€ç§æƒ…å†µçš„ä»£ç æ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* * Traditional (without sentinel) insertion sort, * optimized for server VM, is used in case of * the leftmost part. */</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> left<span class="token punctuation">,</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> right<span class="token punctuation">;</span> j <span class="token operator">=</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> ai <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>ai <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token operator">--</span> <span class="token operator">==</span> left<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> ai<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­£å¦‚æ³¨é‡Šä¸­æ‰€è¯´çš„ï¼Œä½¿ç”¨<code>ä¼ ç»Ÿ</code>çš„æ’å…¥æ’åºï¼Œå³ä¸ä½¿ç”¨<code>å“¨å…µ</code>ã€‚</p><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ææ˜ç™½å˜é‡<code>i</code>å’Œ<code>j</code>çš„ä½œç”¨ä¹‹åä»£ç å°±éå¸¸å®¹æ˜“ç†è§£ã€‚</p><ul><li><code>i</code> - è¯¥å˜é‡å°†<code>[left, right]</code>åŒºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ† - å·²æ’åºåŒºé—´<code>[left, i]</code>ä¸æœªæ’åºåŒºé—´<code>(i, right]</code></li><li><code>j</code> - æ¸¸æ ‡ï¼Œä»å·²æ’åºåŒºé—´<code>[left, i]</code>çš„æœ€å³ä¾§å¼€å§‹ï¼Œå‘å·¦æŸ¥æ‰¾å…ƒç´ <code>a[i+1]</code>åˆé€‚çš„ä½ç½®ï¼›å¹¶ä¸”åœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¾æ¬¡å°†å…ƒç´ å‘å³ç§»åŠ¨1ä½</li></ul><p>ç¬¬äºŒç§æƒ…å†µçš„ä»£ç ç›¸æ¯”å°±å¤æ‚å¾ˆå¤šï¼Œå¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* * Skip the longest ascending sequence. */</span><span class="token keyword">do</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&gt;=</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">++</span>left<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> a<span class="token punctuation">[</span>left <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* * Every element from adjoining part plays the role * of sentinel, therefore this allows us to avoid the * left range check on each iteration. Moreover, we use * the more optimized algorithm, so called pair insertion * sort, which is faster (in the context of Quicksort) * than traditional implementation of insertion sort. */</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> left<span class="token punctuation">;</span> <span class="token operator">++</span>left <span class="token operator">&lt;=</span> right<span class="token punctuation">;</span> k <span class="token operator">=</span> <span class="token operator">++</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> a1 <span class="token operator">=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> a2 <span class="token operator">=</span> a<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a1 <span class="token operator">&lt;</span> a2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        a2 <span class="token operator">=</span> a1<span class="token punctuation">;</span> a1 <span class="token operator">=</span> a<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>a1 <span class="token operator">&lt;</span> a<span class="token punctuation">[</span><span class="token operator">--</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        a<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    a<span class="token punctuation">[</span><span class="token operator">++</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a1<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>a2 <span class="token operator">&lt;</span> a<span class="token punctuation">[</span><span class="token operator">--</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        a<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    a<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a2<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> last <span class="token operator">=</span> a<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>last <span class="token operator">&lt;</span> a<span class="token punctuation">[</span><span class="token operator">--</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    a<span class="token punctuation">[</span>right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span>a<span class="token punctuation">[</span>right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> last<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä½¿ç”¨ä¸€ç§æ”¹è¿›çš„æ’å…¥æ’åº - <code>æˆå¯¹æ’å…¥æ’åº(pair insertion sort)</code>çš„æ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨æ™®é€šæ’å…¥æ’åºçš„åŸºç¡€ä¸Š</p><ol><li>1æ¬¡ä»æœªæ’åºåŒºé—´å–å‡º2ä¸ªå…ƒç´  - <code>a1</code>å’Œ<code>a2</code>ï¼Œå¹¶ä¸”ä¿è¯<code>a1&gt;=a2</code>ï¼ˆå³å¦‚æœ<code>a1&lt;a2</code>ï¼Œåˆ™äº¤æ¢ä¸¤è€…çš„å€¼ï¼‰</li><li>ä»å³å‘å·¦æ‰¾åˆ°<code>a1</code>çš„åˆé€‚ä½ç½®ï¼›å¹¶ä¸”åœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¾æ¬¡å°†å…ƒç´ å‘å³ç§»åŠ¨1ä½</li><li>ç„¶åä»<code>a1</code>å¼€å§‹ï¼Œç»§ç»­å‘å·¦æ‰¾åˆ°<code>a2</code>çš„åˆé€‚ä½ç½®ï¼›åŒæ ·ï¼Œåœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¾æ¬¡å°†å…ƒç´ å‘å³ç§»åŠ¨1ä½</li></ol><p>è¿™é‡Œè¾¹çš„å…³é”®ç‚¹åœ¨äº(â€¦, left)åŒºé—´çš„å€¼éƒ½æ˜¯<code>&lt;a[left]</code>çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯æ³¨é‡Šä¸­æ‰€è¯´çš„è¿æ¥éƒ¨åˆ†çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¤©ç„¶æ‰®æ¼”ç€å“¨å…µçš„è§’è‰²ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦é¢å¤–çš„å»æ˜¾å¼åˆ¤æ–­æ¸¸æ ‡<code>k</code>æ˜¯å¦å·²ç»ç§»å‡ºäº†å·¦è¾¹ç•Œã€‚</p><h4 id="3-3-1-D"><a href="#3-3-1-D" class="headerlink" title="3.3.1 D"></a>3.3.1 D</h4><p>è¿™éƒ¨åˆ†çš„ä»£ç ç›¸å¯¹æ¯”è¾ƒç›´è§‚ï¼Œå¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Inexpensive approximation of length / 7</span><span class="token keyword">int</span> seventh <span class="token operator">=</span> <span class="token punctuation">(</span>length <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>length <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">/* * Sort five evenly spaced elements around (and including) the * center element in the range. These elements will be used for * pivot selection as described below. The choice for spacing * these elements was empirically determined to work well on * a wide variety of inputs. */</span><span class="token keyword">int</span> e3 <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// The midpoint</span><span class="token keyword">int</span> e2 <span class="token operator">=</span> e3 <span class="token operator">-</span> seventh<span class="token punctuation">;</span><span class="token keyword">int</span> e1 <span class="token operator">=</span> e2 <span class="token operator">-</span> seventh<span class="token punctuation">;</span><span class="token keyword">int</span> e4 <span class="token operator">=</span> e3 <span class="token operator">+</span> seventh<span class="token punctuation">;</span><span class="token keyword">int</span> e5 <span class="token operator">=</span> e4 <span class="token operator">+</span> seventh<span class="token punctuation">;</span><span class="token comment">// Sort these elements using insertion sort</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">int</span> t <span class="token operator">=</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span> <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">int</span> t <span class="token operator">=</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span> <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">int</span> t <span class="token operator">=</span> a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>e5<span class="token punctuation">]</span> <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">int</span> t <span class="token operator">=</span> a<span class="token punctuation">[</span>e5<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e5<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>e1<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­è®¡ç®—<code>1/7</code>çš„è¿‘ä¼¼å€¼çš„æ–¹æ³•æ¯”è¾ƒå·§å¦™ï¼Œä½¿ç”¨ä½è¿ç®—ç„¶åç›¸åŠ ï¼Œæ¯”å•çº¯çš„é™¤æ³•ä¼šå¿«ä¸å°‘ <code>int seventh = (length &gt;&gt; 3) + (length &gt;&gt; 6) + 1</code></p><p>éšåä»¥ä¸­é—´ç‚¹ä¸ºä¸­å¿ƒï¼Œå‘å·¦å³ä¾æ¬¡å„å–2ä¸ªç‚¹ï¼Œå…±5ä¸ªç‚¹ã€‚ç„¶åæ‰‹åŠ¨åœ°ä½¿ç”¨æ’å…¥æ’åºå¯¹ä¸Šè¾¹çš„5ä¸ªç‚¹è¿›è¡Œæ’åºã€‚</p><h4 id="3-3-2H"><a href="#3-3-2H" class="headerlink" title="3.3.2H"></a>3.3.2H</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•é‡Œè¾¹çš„<code>å•è½´å¿«æ’</code>çš„å®ç°ï¼Œä¸<code>JDK 1.6</code>ä¸­çš„å®ç°åˆä¸ä¸€æ ·ï¼Œè¿™é‡Œè¾¹çš„å®ç°æ•´ä½“è¾ƒä¸ºç®€å•ï¼Œä¹Ÿå’Œæˆ‘ä»¬åœ¨å¸¸è§ä¹¦ç±/æ–‡ç« ä¸­çš„å®ç°æ–¹æ³•ä¸€è‡´ã€‚</p><blockquote><p>å…³äº<code>JDK 1.6</code>ä¸­çš„<code>å•è½´å¿«æ’</code>çš„å®ç°ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„åˆ†ææ–‡ç«  - <a href="https://www.imooc.com/article/296820">Java SDKä¸­çš„æ’åºç®—æ³•å°è®® - 02 å•è½´å¿«æ’</a></p></blockquote><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•´ä½“çš„å®ç°ä»£ç ï¼Œå¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Pointers</span><span class="token keyword">int</span> less  <span class="token operator">=</span> left<span class="token punctuation">;</span>  <span class="token comment">// The index of the first element of center part</span><span class="token keyword">int</span> great <span class="token operator">=</span> right<span class="token punctuation">;</span> <span class="token comment">// The index before the first element of right part</span><span class="token comment">/* * Use the third of the five sorted elements as pivot. * This value is inexpensive approximation of the median. */</span><span class="token keyword">int</span> pivot <span class="token operator">=</span> a<span class="token punctuation">[</span>e3<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/* * Partitioning degenerates to the traditional 3-way * (or "Dutch National Flag") schema: * *   left part    center part              right part * +-------------------------------------------------+ * |  &lt; pivot  |   == pivot   |     ?    |  &gt; pivot  | * +-------------------------------------------------+ *              ^              ^        ^ *              |              |        | *             less            k      great * * Invariants: * *   all in (left, less)   &lt; pivot *   all in [less, k)     == pivot *   all in (great, right) &gt; pivot * * Pointer k is the first index of ?-part. */</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> less<span class="token punctuation">;</span> k <span class="token operator">&lt;=</span> great<span class="token punctuation">;</span> <span class="token operator">++</span>k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> pivot<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">continue</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> ak <span class="token operator">=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ak <span class="token operator">&lt;</span> pivot<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Move a[k] to left part</span>        a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>less<span class="token punctuation">]</span><span class="token punctuation">;</span>        a<span class="token punctuation">[</span>less<span class="token punctuation">]</span> <span class="token operator">=</span> ak<span class="token punctuation">;</span>        <span class="token operator">++</span>less<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// a[k] &gt; pivot - Move a[k] to right part</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">&gt;</span> pivot<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token operator">--</span>great<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivot<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// a[great] &lt;= pivot</span>            a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>less<span class="token punctuation">]</span><span class="token punctuation">;</span>            a<span class="token punctuation">[</span>less<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>great<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token operator">++</span>less<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// a[great] == pivot</span>            <span class="token comment">/*             * Even though a[great] equals to pivot, the             * assignment a[k] = pivot may be incorrect,             * if a[great] and pivot are floating-point             * zeros of different signs. Therefore in float             * and double sorting methods we have to use             * more accurate assignment a[k] = a[great].             */</span>            a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> pivot<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">=</span> ak<span class="token punctuation">;</span>        <span class="token operator">--</span>great<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/* * Sort left and right parts recursively. * All elements from center part are equal * and, therefore, already sorted. */</span><span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> less <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> leftmost<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> great <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œçš„è½´ç‚¹ç›´æ¥ä½¿ç”¨å‰è¾¹è®¡ç®—å¹¶ä¸”æ’åºåçš„ä¸­é—´ç‚¹<code>a[e3]</code>ï¼Œè¿™éƒ¨åˆ†ä»£ç é‡Œè¾¹å‡ºç°äº†å‡ ä¸ªå˜é‡ï¼Œæˆ‘ä»¬åˆ†åˆ«çœ‹ä¸‹å®ƒä»¬çš„å«ä¹‰æ˜¯ä»€ä¹ˆ</p><ul><li><code>less</code> - åˆå§‹å€¼æ˜¯å¾…æ’åºåŒºé—´çš„å·¦ç«¯ç‚¹<code>left</code>ï¼Œå®ƒæ˜¯<code>&lt;pivot</code>ä¸<code>=pivot</code>çš„è¿æ¥ç‚¹</li><li><code>great</code> - åˆå§‹å€¼æ˜¯å¾…æ’åºåŒºé—´çš„å³ç«¯ç‚¹<code>right</code>ï¼Œå®ƒæ˜¯<code>=pivot</code>ä¸<code>&gt;pivot</code>çš„è¿æ¥ç‚¹</li><li><code>k</code> - æ¸¸æ ‡ï¼Œåœ¨<code>[less, great]</code>åŒºé—´å†…ç§»åŠ¨</li><li><code>pivot</code> - è½´å¿ƒç‚¹ï¼Œå€¼ä¸º<code>a[e3]</code></li></ul><p>å‰è¾¹çš„<code>for</code>å¾ªç¯ä¼šå°†æ•°æ®åˆ†æˆ3ä¸ªåŒºé—´ï¼Œæ­£å¦‚æ³¨é‡Šä¸­æ‰€è¯´çš„</p><ul><li><code>[left, less) &lt; pivot</code></li><li><code>[less, k) == pivot</code></li><li><code>(great, right] &gt; pivot</code></li></ul><p>åœ¨ç§»åŠ¨æ¸¸æ ‡<code>k</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†<code>a[k]</code>ä¸<code>pivot</code>ä½œæ¯”è¾ƒï¼Œé‚£ä¹ˆå°±æœ‰3ç§æƒ…å†µ</p><ol><li><code>a[k]==pivot</code></li><li><code>a[k]&lt;pivot</code></li><li><code>a[k]&gt;pivot</code></li></ol><p>ç¬¬1ç§æƒ…å†µæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚</p><p>ç¬¬2ç§æƒ…å†µä¼šå°†<code>a[k]</code>çš„å€¼ç§»åŠ¨åˆ°å·¦è¾¹ï¼Œå³å°†<code>a[k]</code>ä¸<code>a[less]</code>è¿›è¡Œäº¤æ¢ï¼Œç„¶å<code>++less</code>ã€‚</p><p>ç¬¬3ç§æƒ…å†µä¼šå°†<code>a[k]</code>çš„å€¼ç§»åŠ¨åˆ°å³è¾¹ï¼Œå³å°†<code>a[k]</code>ä¸<code>a[great]</code>è¿›è¡Œäº¤æ¢ï¼Œç„¶å<code>--great</code>ã€‚ä½†æ˜¯äº¤æ¢è¿‡æ¥çš„<code>a[great]</code>æˆ‘ä»¬éœ€è¦è€ƒè™‘å®ƒå’Œ<code>pivot</code>çš„å¤§å°å…³ç³»ï¼Œæ‰€ä»¥åŒæ ·åˆæœ‰äº†3ç§å­æƒ…å†µ</p><ol><li><code>a[great]&gt;pivot</code></li><li><code>a[great]&lt;pivot</code></li><li><code>a[great]=pivot</code></li></ol><p>é’ˆå¯¹å­æƒ…å†µ1ï¼Œæˆ‘ä»¬å‰è¾¹å°†<code>a[great]</code>ç›´æ¥äº¤æ¢è¿‡æ¥æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚æ‰€ä»¥è¿™é‡Œè¾¹æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œæˆ‘ä»¬å…ˆæ‰¾åˆ°ç¬¬1ä¸ª<code>&lt;=pivot</code>çš„<code>a[great]</code>ï¼Œå†è¿›è¡Œäº¤æ¢ï¼Œå°±é¿å…äº†è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">&gt;</span> pivot<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">--</span>great<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é’ˆå¯¹å­æƒ…å†µ2ï¼Œæˆ‘ä»¬éœ€è¦å°†äº¤æ¢è¿‡æ¥çš„<code>a[great]</code>(<code>a[k]</code>)ä¸<code>a[less]</code>è¿›è¡Œäº¤æ¢ï¼Œç„¶å<code>++less</code>ã€‚å…¶å®ç›¸å½“äºå‰è¾¹çš„æƒ…å†µ2ã€‚</p><p>é’ˆå¯¹å­æƒ…å†µ3ï¼Œæˆ‘ä»¬ä¸éœ€è¦åšä»€ä¹ˆç‰¹åˆ«çš„ã€‚å³åªæ˜¯äº¤æ¢<code>a[k]</code>å’Œ<code>a[great]</code>å³å¯ã€‚</p><p>å› ä¸ºå­æƒ…å†µ2, 3éƒ½éœ€è¦å°†<code>a[k]</code>å’Œ<code>a[great]</code>è¿›è¡Œäº¤æ¢ï¼Œæ‰€æœ‰æ‰ä¼šå†™æˆå‰è¾¹å‚è€ƒä»£ç é‡Œçš„æ ·å­ã€‚</p><p>å‰è¾¹åˆ†åŒºå®Œæˆä¹‹åï¼Œåˆ†åˆ«å¯¹å·¦å³ä¸¤ä¸ªå­åŒºé—´è¿›è¡Œé€’å½’è°ƒç”¨å³å¯ã€‚</p><h4 id="3-3-3G"><a href="#3-3-3G" class="headerlink" title="3.3.3G"></a>3.3.3G</h4><p>ç»ˆäºåˆ°äº†çœŸæ­£çš„<code>åŒè½´å¿«æ’</code>çš„ä»£ç äº†ã€‚è¿™éƒ¨åˆ†çš„ä»£ç ç›¸å¯¹è¾ƒé•¿ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥çœ‹ã€‚</p><p>é¦–å…ˆï¼Œé€‰å–2ä¸ªè½´å¿ƒç‚¹ï¼Œç„¶åé€šè¿‡<code>for</code>å¾ªç¯å»ºç«‹3ä¸ªåŒºé—´ï¼Œå³</p><table><thead><tr><th align="left">åŒºé—´</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">[left, less)</td><td align="left">&lt;pivot1</td></tr><tr><td align="left">[less, great]</td><td align="left">pivot1&lt;=x&lt;=pivot2</td></tr><tr><td align="left">(great, right]</td><td align="left">&gt;pivot2</td></tr></tbody></table><p>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™éƒ¨åˆ†çš„ä»£ç ï¼Œå¦‚ä¸‹</p><blockquote><p>ä»£ç æœ¬èº«å…¶å®ä¸ç®—å¤ªå¤šï¼Œä¸­é—´çš„æ³¨é‡Šæ¯”è¾ƒè¯¦ç»†ï¼Œå äº†ä¸å°çš„ç¯‡å¹…</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> less  <span class="token operator">=</span> left<span class="token punctuation">;</span>  <span class="token comment">// The index of the first element of center part</span><span class="token keyword">int</span> great <span class="token operator">=</span> right<span class="token punctuation">;</span> <span class="token comment">// The index before the first element of right part</span><span class="token comment">/* * Use the second and fourth of the five sorted elements as pivots. * These values are inexpensive approximations of the first and * second terciles of the array. Note that pivot1 &lt;= pivot2. */</span><span class="token keyword">int</span> pivot1 <span class="token operator">=</span> a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> pivot2 <span class="token operator">=</span> a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/* * The first and the last elements to be sorted are moved to the * locations formerly occupied by the pivots. When partitioning * is complete, the pivots are swapped back into their final * positions, and excluded from subsequent sorting. */</span>a<span class="token punctuation">[</span>e2<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>a<span class="token punctuation">[</span>e4<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/* * Skip elements, which are less or greater than pivot values. */</span><span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">++</span>less<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivot1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">--</span>great<span class="token punctuation">]</span> <span class="token operator">&gt;</span> pivot2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* * Partitioning: * *   left part           center part                   right part * +--------------------------------------------------------------+ * |  &lt; pivot1  |  pivot1 &lt;= &amp;&amp; &lt;= pivot2  |    ?    |  &gt; pivot2  | * +--------------------------------------------------------------+ *               ^                          ^       ^ *               |                          |       | *              less                        k     great * * Invariants: * *              all in (left, less)   &lt; pivot1 *    pivot1 &lt;= all in [less, k)     &lt;= pivot2 *              all in (great, right) &gt; pivot2 * * Pointer k is the first index of ?-part. */</span>outer<span class="token operator">:</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> less <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token operator">&lt;=</span> great<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> ak <span class="token operator">=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ak <span class="token operator">&lt;</span> pivot1<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Move a[k] to left part</span>        a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>less<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">/*         * Here and below we use "a[i] = b; i++;" instead         * of "a[i++] = b;" due to performance issue.         */</span>        a<span class="token punctuation">[</span>less<span class="token punctuation">]</span> <span class="token operator">=</span> ak<span class="token punctuation">;</span>        <span class="token operator">++</span>less<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ak <span class="token operator">&gt;</span> pivot2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Move a[k] to right part</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">&gt;</span> pivot2<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>great<span class="token operator">--</span> <span class="token operator">==</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">break</span> outer<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivot1<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// a[great] &lt;= pivot2</span>            a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>less<span class="token punctuation">]</span><span class="token punctuation">;</span>            a<span class="token punctuation">[</span>less<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>great<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token operator">++</span>less<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// pivot1 &lt;= a[great] &lt;= pivot2</span>            a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>great<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">/*         * Here and below we use "a[i] = b; i--;" instead         * of "a[i--] = b;" due to performance issue.         */</span>        a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">=</span> ak<span class="token punctuation">;</span>        <span class="token operator">--</span>great<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå˜é‡<code>less</code>ï¼Œ<code>great</code>çš„ä½œç”¨</p><ul><li><code>less</code> - æŒ‡å‘ç¬¬1ä¸ª<code>&gt;=pivot1</code>çš„å€¼çš„å…ƒç´ </li><li><code>great</code> - æŒ‡å‘æœ€å1ä¸ª<code>&lt;=pivot2</code>çš„å€¼çš„å…ƒç´ </li></ul><p>å¼€å§‹çš„2ä¸ª<code>while</code>å¾ªç¯æ˜¯ä¸ºäº†ç¼©å°æˆ‘ä»¬éœ€è¦éå†çš„åŒºé—´<code>[less, great]</code>ï¼Œå³</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">++</span>less<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivot1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">--</span>great<span class="token punctuation">]</span> <span class="token operator">&gt;</span> pivot2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åæˆ‘ä»¬å°±åœ¨<code>label</code>ä¸º<code>outer</code>çš„<code>for</code>å¾ªç¯é‡Œä½¿ç”¨å˜é‡<code>k</code>æ¥éå†åŒºé—´<code>[less, great]</code>ã€‚è¿™ä¸ªéå†çš„è¿‡ç¨‹å…¶å®å’Œå‰è¾¹<code>å•è½´å¿«æ’</code>é‡Œè¾¹çš„åˆ†åŒºå¾ˆåƒã€‚åœ¨æ¯ä¸€æ­¥çš„æ—¶å€™ï¼Œ<code>a[k]</code>éœ€è¦å’Œä¸¤ä¸ª<code>è½´å¿ƒç‚¹</code>æ¯”è¾ƒä»¥ç¡®å®šç§»åŠ¨åˆ°å“ªä¸ªåŒºé—´å†…ã€‚æˆ‘ä»¬å¯ä»¥å…ˆåˆ†æä¸‹æ‰€æœ‰çš„å¯èƒ½æƒ…å†µï¼Œç„¶åå¯¹æ¯”ä»£ç å°±éå¸¸å®¹æ˜“ç†è§£äº†ã€‚</p><p><img src="/2021/04/01/arrays-sort-di-ceng-yuan-ma/4.PNG"><br>æŒ‰ç…§å°†<code>a[k]</code>åˆ’åˆ†åˆ°å‰è¾¹è¯´çš„3ä¸ªåŒºé—´çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ—ä¸¾å‡ºæ‰€æœ‰çš„æƒ…å†µï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å›¾ä¸­çš„5ä¸ªå¶å­ç»“ç‚¹ - <code>C</code>, <code>E</code>, <code>G</code>, <code>I</code>, <code>J</code></p><ul><li><code>E</code>èŠ‚ç‚¹ä»€ä¹ˆä¹Ÿä¸éœ€è¦åšï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶<code>å‰ªæ</code>å‰ªæ‰ã€‚</li><li><code>I</code>èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¦é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå¯ä»¥åœ¨äº¤æ¢ä¹‹å‰ç§»åŠ¨<code>great</code>ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª<code>&lt;=pivot2</code>çš„<code>a[great]</code></li><li><code>J</code>èŠ‚ç‚¹è™½ç„¶ä»€ä¹ˆä¹Ÿä¸éœ€è¦åšï¼Œä½†æ˜¯å…¶çˆ¶èŠ‚ç‚¹éœ€è¦å°†<code>a[k]</code>ä¸<code>a[great]</code>è¿›è¡Œäº¤æ¢ï¼Œæ‰€ä»¥å¯ä»¥å°†ä¸¤è€…åˆå¹¶åˆ°ä¸€èµ·ã€‚</li><li><code>C</code>èŠ‚ç‚¹å’Œ<code>G</code>èŠ‚ç‚¹çš„å¤„ç†æ–¹å¼å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡<code>G</code>èŠ‚ç‚¹ç”±äºéœ€è¦åˆå¹¶çˆ¶èŠ‚ç‚¹çš„æ“ä½œï¼Œæ‰€ä»¥ä»£ç ä¸Šç¨æœ‰ä¸åŒã€‚</li></ul><p>æ­¤æ—¶å†çœ‹ä¸Šè¾¹çš„<code>for</code>å¾ªç¯é‡Œè¾¹çš„ä»£ç ï¼Œå°±æ¯”è¾ƒæ˜æœ—äº†ã€‚</p><p>å®Œæˆåˆ†åŒºä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†<code>pivot1</code>, <code>pivot2</code>æ”¾åˆ°ä»–ä»¬åº”è¯¥åœ¨çš„ä½ç½®ï¼Œå³åŒºé—´<code>[less, great]</code>çš„å·¦å³ç«¯ç‚¹å¤–ä¾§ç›¸é‚»çš„1ä¸ªå…ƒç´ ã€‚ä¸ºäº†è…¾å‡ºæ¥è¿™ä¸¤ä¸ªä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†è¿™ä¸¤ä¸ªä½ç½®åŸæ¥çš„å€¼æ”¾åˆ°<code>a[left]</code>, <code>a[right]</code>è¿™ä¸¤ä¸ªâ€œç©ºä½â€ä¸Šã€‚</p><p>ç„¶åå¯¹å·¦å³ä¸¤ä¸ªå­åŒºé—´åˆ†åˆ«è¿›è¡Œé€’å½’è°ƒç”¨ï¼Œè¿™éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Swap pivots into their final positions</span>a<span class="token punctuation">[</span>left<span class="token punctuation">]</span>  <span class="token operator">=</span> a<span class="token punctuation">[</span>less  <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>less  <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> pivot1<span class="token punctuation">;</span>a<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>great <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> a<span class="token punctuation">[</span>great <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> pivot2<span class="token punctuation">;</span><span class="token comment">// Sort left and right parts recursively, excluding known pivots</span><span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> left<span class="token punctuation">,</span> less <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> leftmost<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> great <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªä¼˜åŒ–ï¼Œå¦‚æœä¸­é—´åŒºé—´<code>[less, great]</code>(å³<code>pivot1&lt;=x&lt;=pivot2</code>)æ¯”è¾ƒå¤§çš„è¯(è¶…è¿‡<code>4/7</code>çš„å¾…æ’åºåŒºé—´é•¿åº¦)ï¼Œå°±æ‰§è¡Œé‡Œè¾¹çš„ä»£ç ã€‚ä»è€Œå°†è¿™ä¸ªåŒºé—´ç»§ç»­åˆ’åˆ†ä¸º3éƒ¨åˆ†</p><table><thead><tr><th align="left">åŒºé—´</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">ï¼ˆ, less)</td><td align="left">=pivot1</td></tr><tr><td align="left">[less, great]</td><td align="left">pivot1&lt;x&lt;pivot2</td></tr><tr><td align="left">(great, )</td><td align="left">=pivot2</td></tr></tbody></table><p>è¿™éƒ¨åˆ†å…·ä½“çš„å®ç°ä¹ŸåŒæ ·å¯ä»¥ä½¿ç”¨ä¸Šé¢ç”»å›¾çš„æ–¹æ³•æ¥è¿›è¡Œåˆ†æï¼Œè€Œä¸”å®é™…å®ç°ä¹Ÿä¸å‰è¾¹çš„éå¸¸ç›¸ä¼¼ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤äº†ã€‚è¿™éƒ¨åˆ†ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* * If center part is too large (comprises &gt; 4/7 of the array), * swap internal pivot values to ends. */</span><span class="token keyword">if</span> <span class="token punctuation">(</span>less <span class="token operator">&lt;</span> e1 <span class="token operator">&amp;&amp;</span> e5 <span class="token operator">&lt;</span> great<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/*     * Skip elements, which are equal to pivot values.     */</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>less<span class="token punctuation">]</span> <span class="token operator">==</span> pivot1<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token operator">++</span>less<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">==</span> pivot2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token operator">--</span>great<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/*     * Partitioning:     *     *   left part         center part                  right part     * +----------------------------------------------------------+     * | == pivot1 |  pivot1 &lt; &amp;&amp; &lt; pivot2  |    ?    | == pivot2 |     * +----------------------------------------------------------+     *              ^                        ^       ^     *              |                        |       |     *             less                      k     great     *     * Invariants:     *     *              all in (*,  less) == pivot1     *     pivot1 &lt; all in [less,  k)  &lt; pivot2     *              all in (great, *) == pivot2     *     * Pointer k is the first index of ?-part.     */</span>    outer<span class="token operator">:</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> less <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token operator">&lt;=</span> great<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> ak <span class="token operator">=</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ak <span class="token operator">==</span> pivot1<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Move a[k] to left part</span>            a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>less<span class="token punctuation">]</span><span class="token punctuation">;</span>            a<span class="token punctuation">[</span>less<span class="token punctuation">]</span> <span class="token operator">=</span> ak<span class="token punctuation">;</span>            <span class="token operator">++</span>less<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ak <span class="token operator">==</span> pivot2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Move a[k] to right part</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">==</span> pivot2<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>great<span class="token operator">--</span> <span class="token operator">==</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">break</span> outer<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">==</span> pivot1<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// a[great] &lt; pivot2</span>                a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>less<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">/*                 * Even though a[great] equals to pivot1, the                 * assignment a[less] = pivot1 may be incorrect,                 * if a[great] and pivot1 are floating-point zeros                 * of different signs. Therefore in float and                 * double sorting methods we have to use more                 * accurate assignment a[less] = a[great].                 */</span>                a<span class="token punctuation">[</span>less<span class="token punctuation">]</span> <span class="token operator">=</span> pivot1<span class="token punctuation">;</span>                <span class="token operator">++</span>less<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// pivot1 &lt; a[great] &lt; pivot2</span>                a<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>great<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            a<span class="token punctuation">[</span>great<span class="token punctuation">]</span> <span class="token operator">=</span> ak<span class="token punctuation">;</span>            <span class="token operator">--</span>great<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åå°±æ˜¯é’ˆå¯¹æˆ‘ä»¬çš„ä¸­é—´åŒºé—´(å¯èƒ½å·²ç»è¢«ä¸Šè¾¹çš„ä»£ç ä¼˜åŒ–è€Œå°†åŒºé—´<code>[less, great]</code>è¿›ä¸€æ­¥ç¼©å°)è¿›è¡Œé€’å½’è°ƒç”¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Sort center part recursively</span><span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> less<span class="token punctuation">,</span> great<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è‡³æ­¤ï¼Œæ•´ä¸ª<code>åŒè½´å¿«æ’</code>åˆ†æå°±ç»“æŸäº†ã€‚</p><p>``</p><h3 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4. å°ç»“"></a>4. å°ç»“</h3><p>æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬é¦–å…ˆä»åŒè½´å¿«æ’çš„å…¥å£å‡½æ•°å¼€å§‹ï¼Œå­¦ä¹ äº†é’ˆå¯¹å¤§æ•°ç»„çš„ä¸€ç§ä¼˜åŒ–å¤„ç†æ€è·¯ - æ£€æµ‹æ•°ç»„æ˜¯å¦æœ‰åºä»¥åŠä½¿ç”¨è¿­ä»£ç‰ˆæœ¬çš„<code>merge sort</code>è¿›è¡Œæ’åºã€‚</p><p>é‚£ä¹ˆå¦‚æœæ•°ç»„æ²¡æœ‰è¾¾åˆ°è®¾å®šçš„æœ‰åºçš„æ ‡å‡†çš„è¯ï¼Œå°±è½¬åˆ°çœŸæ­£çš„<code>åŒè½´å¿«æ’äº†</code>ã€‚ä½†æ˜¯åœ¨åŒè½´å¿«æ’é‡Œè¾¹åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¹Ÿä¼šâ€œé€€åŒ–â€æˆ<code>å•è½´å¿«æ’</code>ã€‚</p><p>åœ¨åˆ†æçš„è¿‡ç¨‹å½“ä¸­ï¼Œé‡‡ç”¨äº†ç”»æµç¨‹å›¾æˆ–è€…å…·ä½“çš„ç¤ºæ„å›¾çš„æ–¹å¼æ–¹ä¾¿å¯¹åŸå§‹ä»£ç çš„ç†è§£ã€‚</p><p>åœ¨æ­¤ä¹Ÿæ·±æ·±åœ°æ„Ÿå—åˆ°ä»»ä½•ä¸€ç§æ’åºç®—æ³•éƒ½ä¸æ˜¯å­¤ç«‹å­˜åœ¨çš„ã€‚åœ¨å®é™…çš„é—®é¢˜å½“ä¸­ï¼Œæ›´å¤šçš„æ˜¯å¯¹è¿™äº›ç®—æ³•ç»¼åˆåº”ç”¨ï¼Œé’ˆå¯¹ä¸åŒçš„åˆ†æ”¯æƒ…å†µé€‰å–å¯¹åº”æ¯”è¾ƒä¼˜çš„ç®—æ³•è¿›è¡Œå¤„ç†ã€‚</p><p>ä½†æ˜¯è¿™å¹¶ä¸æ˜¯ç»ˆç‚¹ï¼Œ2018å¹´ï¼Œ<code>åŒè½´å¿«æ’</code>çš„ä½œè€…<code>Vladimir Yaroslavskiy</code>åœ¨JDK 1.8çš„åŸºç¡€ä¹‹ä¸Šï¼Œåˆåšäº†å¾ˆå¤šä¼˜åŒ–ã€‚æ®ä½œè€…è‡ªå·±è¯´ï¼Œä¼˜åŒ–è¿‡çš„ç‰ˆæœ¬å¯ä»¥ä¿è¯åœ¨ä»»æ„è¾“å…¥çš„æƒ…å†µä¸‹è¾¾åˆ°<code>nlog(n)</code>çš„æ—¶é—´å¤æ‚åº¦ã€‚æ„Ÿå…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥é˜…è¯» <a href="https://mail.openjdk.java.net/pipermail/core-libs-dev/2018-January/051000.html">The new optimized version of Dual-Pivot Quicksort</a> ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://www.imooc.com/article/297781">https://www.imooc.com/article/297781</a></li><li><a href="https://www.cnblogs.com/baichunyu/p/11935995.html">https://www.cnblogs.com/baichunyu/p/11935995.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ArrayListæ‰©å®¹æœºåˆ¶</title>
      <link href="2021/04/01/arraylist-kuo-rong-ji-zhi/"/>
      <url>2021/04/01/arraylist-kuo-rong-ji-zhi/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/baichunyu/p/12965241.html">ArrayListæ‰©å®¹æœºåˆ¶</a></p><h1 id="ä¸€ã€å…ˆä»-ArrayList-çš„æ„é€ å‡½æ•°è¯´èµ·"><a href="#ä¸€ã€å…ˆä»-ArrayList-çš„æ„é€ å‡½æ•°è¯´èµ·" class="headerlink" title="ä¸€ã€å…ˆä» ArrayList çš„æ„é€ å‡½æ•°è¯´èµ·"></a>ä¸€ã€å…ˆä» ArrayList çš„æ„é€ å‡½æ•°è¯´èµ·</h1><p>ã€€ã€€ArrayListæœ‰ä¸‰ç§æ–¹å¼æ¥åˆå§‹åŒ–ï¼Œæ„é€ æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**     * é»˜è®¤åˆå§‹å®¹é‡å¤§å°     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_CAPACITY <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">/**     *é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½¿ç”¨åˆå§‹å®¹é‡10æ„é€ ä¸€ä¸ªç©ºåˆ—è¡¨(æ— å‚æ•°æ„é€ )     */</span>    <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ï¼ˆç”¨æˆ·è‡ªå·±æŒ‡å®šå®¹é‡ï¼‰     */</span>    <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//åˆå§‹å®¹é‡å¤§äº0</span>            <span class="token comment">//åˆ›å»ºinitialCapacityå¤§å°çš„æ•°ç»„</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>initialCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//åˆå§‹å®¹é‡ç­‰äº0</span>            <span class="token comment">//åˆ›å»ºç©ºæ•°ç»„</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> EMPTY_ELEMENTDATA<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">//åˆå§‹å®¹é‡å°äº0ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal Capacity: "</span><span class="token operator">+</span>                                               initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>   <span class="token comment">/**    *æ„é€ åŒ…å«æŒ‡å®šcollectionå…ƒç´ çš„åˆ—è¡¨ï¼Œè¿™äº›å…ƒç´ åˆ©ç”¨è¯¥é›†åˆçš„è¿­ä»£å™¨æŒ‰é¡ºåºè¿”å›    *å¦‚æœæŒ‡å®šçš„é›†åˆä¸ºnullï¼Œthrows NullPointerExceptionã€‚    */</span>     <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>        elementData <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>                elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment">// replace with empty array.</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> EMPTY_ELEMENTDATA<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥æ— å‚æ•°æ„é€ æ–¹æ³•åˆ›å»º ArrayList æ—¶ï¼Œå®é™…ä¸Šåˆå§‹åŒ–èµ‹å€¼çš„æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ã€‚å½“çœŸæ­£å¯¹æ•°ç»„è¿›è¡Œæ·»åŠ å…ƒç´ æ“ä½œæ—¶ï¼Œæ‰çœŸæ­£åˆ†é…å®¹é‡ã€‚å³å‘æ•°ç»„ä¸­æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæ•°ç»„å®¹é‡æ‰©ä¸º10ã€‚ ä¸‹é¢åœ¨æˆ‘ä»¬åˆ†æ ArrayList æ‰©å®¹æ—¶ä¼šè®²åˆ°è¿™ä¸€ç‚¹å†…å®¹ï¼</p><h1 id="äºŒã€ä¸€æ­¥ä¸€æ­¥åˆ†æ-ArrayList-æ‰©å®¹æœºåˆ¶"><a href="#äºŒã€ä¸€æ­¥ä¸€æ­¥åˆ†æ-ArrayList-æ‰©å®¹æœºåˆ¶" class="headerlink" title="äºŒã€ä¸€æ­¥ä¸€æ­¥åˆ†æ ArrayList æ‰©å®¹æœºåˆ¶"></a>äºŒã€ä¸€æ­¥ä¸€æ­¥åˆ†æ ArrayList æ‰©å®¹æœºåˆ¶</h1><p>ã€€ã€€è¿™é‡Œä»¥æ— å‚æ„é€ å‡½æ•°åˆ›å»ºçš„ ArrayList ä¸ºä¾‹åˆ†æï¼š</p><h2 id="1ã€å…ˆæ¥çœ‹-add-æ–¹æ³•"><a href="#1ã€å…ˆæ¥çœ‹-add-æ–¹æ³•" class="headerlink" title="1ã€å…ˆæ¥çœ‹ add æ–¹æ³•"></a>1ã€å…ˆæ¥çœ‹ add æ–¹æ³•</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¾—åˆ°æœ€å°æ‰©å®¹é‡</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData <span class="token operator">==</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å–é»˜è®¤çš„å®¹é‡å’Œä¼ å…¥å‚æ•°çš„è¾ƒå¤§å€¼</span>        minCapacity <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>DEFAULT_CAPACITY<span class="token punctuation">,</span> minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ è¦ add è¿›ç¬¬1ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacityä¸º1ï¼Œåœ¨Math.max()æ–¹æ³•æ¯”è¾ƒåï¼ŒminCapacity ä¸º10ã€‚</p><h2 id="2ã€å†æ¥çœ‹çœ‹-ensureCapacityInternal-æ–¹æ³•"><a href="#2ã€å†æ¥çœ‹çœ‹-ensureCapacityInternal-æ–¹æ³•" class="headerlink" title="2ã€å†æ¥çœ‹çœ‹ ensureCapacityInternal() æ–¹æ³•"></a>2ã€å†æ¥çœ‹çœ‹ ensureCapacityInternal() æ–¹æ³•</h2><p>ã€€ã€€å¯ä»¥çœ‹åˆ° add æ–¹æ³• é¦–å…ˆè°ƒç”¨äº†ensureCapacityInternal(size + 1)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¾—åˆ°æœ€å°æ‰©å®¹é‡</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData <span class="token operator">==</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å–é»˜è®¤çš„å®¹é‡å’Œä¼ å…¥å‚æ•°çš„è¾ƒå¤§å€¼</span>        minCapacity <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>DEFAULT_CAPACITY<span class="token punctuation">,</span> minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ è¦ add è¿›ç¬¬1ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacityä¸º1ï¼Œåœ¨Math.max()æ–¹æ³•æ¯”è¾ƒåï¼ŒminCapacity ä¸º10ã€‚</p><h2 id="3ã€ensureExplicitCapacity-æ–¹æ³•"><a href="#3ã€ensureExplicitCapacity-æ–¹æ³•" class="headerlink" title="3ã€ensureExplicitCapacity() æ–¹æ³•"></a>3ã€ensureExplicitCapacity() æ–¹æ³•</h2><p>ã€€ã€€å¦‚æœè°ƒç”¨ ensureCapacityInternal() æ–¹æ³•å°±ä¸€å®šä¼šè¿›è¿‡ï¼ˆæ‰§è¡Œï¼‰è¿™ä¸ªæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    modCount<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token comment">// overflow-conscious code</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">-</span> elementData<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment">//è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä»£è¡¨å·²ç»å¼€å§‹æ‰©å®¹äº†</span>        <span class="token function">grow</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬æ¥ä»”ç»†åˆ†æä¸€ä¸‹ï¼š</p><ul><li>å½“æˆ‘ä»¬è¦ add è¿›ç¬¬1ä¸ªå…ƒç´ åˆ° ArrayList æ—¶ï¼ŒelementData.length ä¸º0 ï¼ˆå› ä¸ºè¿˜æ˜¯ä¸€ä¸ªç©ºçš„ listï¼‰ï¼Œå› ä¸ºæ‰§è¡Œäº† ensureCapacityInternal() æ–¹æ³• ï¼Œæ‰€ä»¥ minCapacity æ­¤æ—¶ä¸º10ã€‚æ­¤æ—¶ï¼ŒminCapacity - elementData.length &gt; 0 æˆç«‹ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ grow(minCapacity) æ–¹æ³•ã€‚</li><li>å½“addç¬¬2ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacity ä¸º2ï¼Œæ­¤æ—¶e lementData.length(å®¹é‡)åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ åæ‰©å®¹æˆ 10 äº†ã€‚æ­¤æ—¶ï¼ŒminCapacity - elementData.length &gt; 0 ä¸æˆç«‹ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ ï¼ˆæ‰§è¡Œï¼‰grow(minCapacity) æ–¹æ³•ã€‚</li><li>æ·»åŠ ç¬¬3ã€4Â·Â·Â·åˆ°ç¬¬10ä¸ªå…ƒç´ æ—¶ï¼Œä¾ç„¶ä¸ä¼šæ‰§è¡Œgrowæ–¹æ³•ï¼Œæ•°ç»„å®¹é‡éƒ½ä¸º10ã€‚</li></ul><p>ã€€ã€€ç›´åˆ°æ·»åŠ ç¬¬11ä¸ªå…ƒç´ ï¼ŒminCapacity(ä¸º11)æ¯”elementData.lengthï¼ˆä¸º10ï¼‰è¦å¤§ã€‚è¿›å…¥growæ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚</p><h2 id="4ã€grow-æ–¹æ³•"><a href="#4ã€grow-æ–¹æ³•" class="headerlink" title="4ã€grow() æ–¹æ³•"></a>4ã€grow() æ–¹æ³•</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**     * è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å°     */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX_ARRAY_SIZE <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token comment">/**     * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚     */</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡</span>    <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token comment">//å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ</span>    <span class="token comment">//æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ</span>    <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> oldCapacity <span class="token operator">+</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ï¼Œ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>        newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span>    <span class="token comment">// å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) `hugeCapacity()` æ–¹æ³•æ¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZEï¼Œ</span>    <span class="token comment">//å¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º`Integer.MAX_VALUE`ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º `Integer.MAX_VALUE - 8`ã€‚</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> MAX_ARRAY_SIZE <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>        newCapacity <span class="token operator">=</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// minCapacity is usually close to size, so this is a win:</span>    elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1),æ‰€ä»¥ ArrayList æ¯æ¬¡æ‰©å®¹ä¹‹åå®¹é‡éƒ½ä¼šå˜ä¸ºåŸæ¥çš„ 1.5 å€å·¦å³ï¼ˆoldCapacityä¸ºå¶æ•°å°±æ˜¯1.5å€ï¼Œå¦åˆ™æ˜¯1.5å€å·¦å³ï¼‰ï¼ å¥‡å¶ä¸åŒï¼Œæ¯”å¦‚ ï¼š10+10/2 = 15, 33+33/2=49ã€‚å¦‚æœæ˜¯å¥‡æ•°çš„è¯ä¼šä¸¢æ‰å°æ•°.</p><p>ã€€ã€€æˆ‘ä»¬å†æ¥é€šè¿‡ä¾‹å­æ¢ç©¶ä¸€ä¸‹grow() æ–¹æ³• ï¼š</p><ul><li>å½“addç¬¬1ä¸ªå…ƒç´ æ—¶ï¼ŒoldCapacity ä¸º0ï¼Œç»æ¯”è¾ƒåç¬¬ä¸€ä¸ªifåˆ¤æ–­æˆç«‹ï¼ŒnewCapacity = minCapacity(ä¸º10)ã€‚ä½†æ˜¯ç¬¬äºŒä¸ªifåˆ¤æ–­ä¸ä¼šæˆç«‹ï¼Œå³newCapacity ä¸æ¯” MAX_ARRAY_SIZEå¤§ï¼Œåˆ™ä¸ä¼šè¿›å…¥ hugeCapacity æ–¹æ³•ã€‚æ•°ç»„å®¹é‡ä¸º10ï¼Œaddæ–¹æ³•ä¸­ return true,sizeå¢ä¸º1ã€‚</li><li>å½“addç¬¬11ä¸ªå…ƒç´ è¿›å…¥growæ–¹æ³•æ—¶ï¼ŒnewCapacityä¸º15ï¼Œæ¯”minCapacityï¼ˆä¸º11ï¼‰å¤§ï¼Œç¬¬ä¸€ä¸ªifåˆ¤æ–­ä¸æˆç«‹ã€‚æ–°å®¹é‡æ²¡æœ‰å¤§äºæ•°ç»„æœ€å¤§sizeï¼Œä¸ä¼šè¿›å…¥hugeCapacityæ–¹æ³•ã€‚æ•°ç»„å®¹é‡æ‰©ä¸º15ï¼Œaddæ–¹æ³•ä¸­return true,sizeå¢ä¸º11ã€‚</li><li>ä»¥æ­¤ç±»æ¨Â·Â·Â·Â·Â·Â·</li></ul><p>ã€€ã€€è¿™é‡Œè¡¥å……ä¸€ç‚¹æ¯”è¾ƒé‡è¦ï¼Œä½†æ˜¯å®¹æ˜“è¢«å¿½è§†æ‰çš„çŸ¥è¯†ç‚¹ï¼š</p><p>ã€€ã€€â‘ java ä¸­çš„ length å±æ€§æ˜¯é’ˆå¯¹æ•°ç»„è¯´çš„,æ¯”å¦‚è¯´ä½ å£°æ˜äº†ä¸€ä¸ªæ•°ç»„,æƒ³çŸ¥é“è¿™ä¸ªæ•°ç»„çš„é•¿åº¦åˆ™ç”¨åˆ°äº† length è¿™ä¸ªå±æ€§.</p><p>ã€€ã€€â‘¡java ä¸­çš„ length() æ–¹æ³•æ˜¯é’ˆå¯¹å­—ç¬¦ä¸²è¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦åˆ™ç”¨åˆ° length() è¿™ä¸ªæ–¹æ³•.</p><p>ã€€ã€€â‘¢java ä¸­çš„ size() æ–¹æ³•æ˜¯é’ˆå¯¹æ³›å‹é›†åˆè¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªæ³›å‹æœ‰å¤šå°‘ä¸ªå…ƒç´ ,å°±è°ƒç”¨æ­¤æ–¹æ³•æ¥æŸ¥çœ‹!</p><h2 id="5ã€hugeCapacity-æ–¹æ³•"><a href="#5ã€hugeCapacity-æ–¹æ³•" class="headerlink" title="5ã€hugeCapacity() æ–¹æ³•"></a>5ã€hugeCapacity() æ–¹æ³•</h2><p>ã€€ã€€ä»ä¸Šé¢ grow() æ–¹æ³•æºç æˆ‘ä»¬çŸ¥é“ï¼š å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) hugeCapacity() æ–¹æ³•æ¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZEï¼Œå¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸ºInteger.MAX_VALUEï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º Integer.MAX_VALUE - 8ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// overflow</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OutOfMemoryError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å¯¹minCapacityå’ŒMAX_ARRAY_SIZEè¿›è¡Œæ¯”è¾ƒ</span>    <span class="token comment">//è‹¥minCapacityå¤§ï¼Œå°†Integer.MAX_VALUEä½œä¸ºæ–°æ•°ç»„çš„å¤§å°</span>    <span class="token comment">//è‹¥MAX_ARRAY_SIZEå¤§ï¼Œå°†MAX_ARRAY_SIZEä½œä¸ºæ–°æ•°ç»„çš„å¤§å°</span>    <span class="token comment">//MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">&gt;</span> MAX_ARRAY_SIZE<span class="token punctuation">)</span> <span class="token operator">?</span>        <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE <span class="token operator">:</span>    MAX_ARRAY_SIZE<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ä¸‰ã€System-arraycopy-å’Œ-Arrays-copyOf-æ–¹æ³•"><a href="#ä¸‰ã€System-arraycopy-å’Œ-Arrays-copyOf-æ–¹æ³•" class="headerlink" title="ä¸‰ã€System.arraycopy() å’Œ Arrays.copyOf()æ–¹æ³•"></a>ä¸‰ã€System.arraycopy() å’Œ Arrays.copyOf()æ–¹æ³•</h1><p>ã€€ã€€é˜…è¯»æºç çš„è¯ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç° ArrayList ä¸­å¤§é‡è°ƒç”¨äº†è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬ä¸Šé¢è®²çš„æ‰©å®¹æ“ä½œä»¥åŠadd(int index, E element)ã€toArray() ç­‰æ–¹æ³•ä¸­éƒ½ç”¨åˆ°äº†è¯¥æ–¹æ³•ï¼</p><h2 id="1ã€System-arraycopy-æ–¹æ³•"><a href="#1ã€System-arraycopy-æ–¹æ³•" class="headerlink" title="1ã€System.arraycopy() æ–¹æ³•"></a>1ã€System.arraycopy() æ–¹æ³•</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**     * åœ¨æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚     *å…ˆè°ƒç”¨ rangeCheckForAdd å¯¹indexè¿›è¡Œç•Œé™æ£€æŸ¥ï¼›ç„¶åè°ƒç”¨ ensureCapacityInternal æ–¹æ³•ä¿è¯capacityè¶³å¤Ÿå¤§ï¼›     *å†å°†ä»indexå¼€å§‹ä¹‹åçš„æ‰€æœ‰æˆå‘˜åç§»ä¸€ä¸ªä½ç½®ï¼›å°†elementæ’å…¥indexä½ç½®ï¼›æœ€åsizeåŠ 1ã€‚     */</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">rangeCheckForAdd</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount!!</span>    <span class="token comment">//arraycopy()æ–¹æ³•å®ç°æ•°ç»„è‡ªå·±å¤åˆ¶è‡ªå·±</span>    <span class="token comment">//elementData:æºæ•°ç»„;index:æºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®;elementDataï¼šç›®æ ‡æ•°ç»„ï¼›index + 1ï¼šç›®æ ‡æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®ï¼› size - indexï¼šè¦å¤åˆ¶çš„æ•°ç»„å…ƒç´ çš„æ•°é‡ï¼›</span>    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> size <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>    elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>    size<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è”ç³»ï¼š çœ‹ä¸¤è€…æºä»£ç å¯ä»¥å‘ç° copyOf() å†…éƒ¨å®é™…è°ƒç”¨äº† System.arraycopy() æ–¹æ³• </p><p>ã€€ã€€åŒºåˆ«ï¼š arraycopy() éœ€è¦ç›®æ ‡æ•°ç»„ï¼Œå°†åŸæ•°ç»„æ‹·è´åˆ°ä½ è‡ªå·±å®šä¹‰çš„æ•°ç»„é‡Œæˆ–è€…åŸæ•°ç»„ï¼Œè€Œä¸”å¯ä»¥é€‰æ‹©æ‹·è´çš„èµ·ç‚¹å’Œé•¿åº¦ä»¥åŠæ”¾å…¥æ–°æ•°ç»„ä¸­çš„ä½ç½® copyOf() æ˜¯ç³»ç»Ÿè‡ªåŠ¨åœ¨å†…éƒ¨æ–°å»ºä¸€ä¸ªæ•°ç»„ï¼Œå¹¶è¿”å›è¯¥æ•°ç»„ã€‚</p><h1 id="å››ã€ensureCapacityæ–¹æ³•"><a href="#å››ã€ensureCapacityæ–¹æ³•" class="headerlink" title="å››ã€ensureCapacityæ–¹æ³•"></a>å››ã€ensureCapacityæ–¹æ³•</h1><p>ã€€ã€€ArrayList æºç ä¸­æœ‰ä¸€ä¸ª ensureCapacity æ–¹æ³•ä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°æ²¡æœ‰ï¼Œè¿™ä¸ªæ–¹æ³• ArrayList å†…éƒ¨æ²¡æœ‰è¢«è°ƒç”¨è¿‡ï¼Œæ‰€ä»¥å¾ˆæ˜¾ç„¶æ˜¯æä¾›ç»™ç”¨æˆ·è°ƒç”¨çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**    å¦‚æœ‰å¿…è¦ï¼Œå¢åŠ æ­¤ ArrayList å®ä¾‹çš„å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒè‡³å°‘å¯ä»¥å®¹çº³ç”±minimum capacityå‚æ•°æŒ‡å®šçš„å…ƒç´ æ•°ã€‚     *     * @param   minCapacity   æ‰€éœ€çš„æœ€å°å®¹é‡     */</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ensureCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> minExpand <span class="token operator">=</span> <span class="token punctuation">(</span>elementData <span class="token operator">!=</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA<span class="token punctuation">)</span>        <span class="token comment">// any size if not default element table</span>        <span class="token operator">?</span> <span class="token number">0</span>        <span class="token comment">// larger than default for default empty table. It's already</span>        <span class="token comment">// supposed to be at default size.</span>        <span class="token operator">:</span> DEFAULT_CAPACITY<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">&gt;</span> minExpand<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cookieså’Œsession</title>
      <link href="2021/03/31/cookies-he-session/"/>
      <url>2021/03/31/cookies-he-session/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h2><p> (referentce to <a href="https://segmentfault.com/a/1190000017831088">https://segmentfault.com/a/1190000017831088</a>)</p><h2 id="httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®"><a href="#httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®" class="headerlink" title="httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®"></a>httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®</h2><p>ä»€ä¹ˆæ˜¯æ— çŠ¶æ€å‘¢ï¼Ÿå°±æ˜¯è¯´è¿™ä¸€æ¬¡è¯·æ±‚å’Œä¸Šä¸€æ¬¡è¯·æ±‚æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œäº’ä¸è®¤è¯†çš„ï¼Œæ²¡æœ‰å…³è”çš„ã€‚è¿™ç§æ— çŠ¶æ€çš„çš„å¥½å¤„æ˜¯å¿«é€Ÿã€‚åå¤„æ˜¯å‡å¦‚æˆ‘ä»¬æƒ³è¦æŠŠ<code>www.zhihu.com/login.html</code>å’Œ<code>www.zhihu.com/index.html</code>å…³è”èµ·æ¥ï¼Œå¿…é¡»ä½¿ç”¨æŸäº›æ‰‹æ®µå’Œå·¥å…·</p><h2 id="cookieå’Œsession"><a href="#cookieå’Œsession" class="headerlink" title="cookieå’Œsession"></a>cookieå’Œsession</h2><p>ç”±äºhttpçš„æ— çŠ¶æ€æ€§ï¼Œä¸ºäº†ä½¿æŸä¸ªåŸŸåä¸‹çš„æ‰€æœ‰ç½‘é¡µèƒ½å¤Ÿå…±äº«æŸäº›æ•°æ®ï¼Œsessionå’Œcookieå‡ºç°äº†ã€‚å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨çš„æµç¨‹å¦‚ä¸‹</p><ul><li>é¦–å…ˆï¼Œå®¢æˆ·ç«¯ä¼šå‘é€ä¸€ä¸ªhttpè¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯ã€‚</li><li>æœåŠ¡å™¨ç«¯æ¥å—å®¢æˆ·ç«¯è¯·æ±‚åï¼Œå»ºç«‹ä¸€ä¸ªsessionï¼Œå¹¶å‘é€ä¸€ä¸ªhttpå“åº”åˆ°å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªå“åº”å¤´ï¼Œå…¶ä¸­å°±åŒ…å«Set-Cookieå¤´éƒ¨ã€‚è¯¥å¤´éƒ¨åŒ…å«äº†sessionIdã€‚Set-Cookieæ ¼å¼å¦‚ä¸‹ï¼Œå…·ä½“è¯·çœ‹<a href="http://bubkoo.com/2014/04/21/http-cookies-explained/">Cookieè¯¦è§£</a><br><code>Set-Cookie: value[; expires=date][; domain=domain][; path=path][; secure]</code></li><li>åœ¨å®¢æˆ·ç«¯å‘èµ·çš„ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œå‡å¦‚æœåŠ¡å™¨ç»™äº†set-Cookieï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ cookie</li><li>æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œåˆ†è§£cookieï¼ŒéªŒè¯ä¿¡æ¯ï¼Œæ ¸å¯¹æˆåŠŸåè¿”å›responseç»™å®¢æˆ·ç«¯</li></ul><p><img src="/2021/03/31/cookies-he-session/bVbmYbQ" alt="è¯·æ±‚æµç¨‹"></p><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><ul><li>cookieåªæ˜¯å®ç°sessionçš„å…¶ä¸­ä¸€ç§æ–¹æ¡ˆã€‚è™½ç„¶æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä½†å¹¶ä¸æ˜¯å”¯ä¸€çš„æ–¹æ³•ã€‚ç¦ç”¨cookieåè¿˜æœ‰å…¶ä»–æ–¹æ³•å­˜å‚¨ï¼Œæ¯”å¦‚æ”¾åœ¨urlä¸­</li><li>ç°åœ¨å¤§å¤šéƒ½æ˜¯Session + Cookieï¼Œä½†æ˜¯åªç”¨sessionä¸ç”¨cookieï¼Œæˆ–æ˜¯åªç”¨cookieï¼Œä¸ç”¨sessionåœ¨ç†è®ºä¸Šéƒ½å¯ä»¥ä¿æŒä¼šè¯çŠ¶æ€ã€‚å¯æ˜¯å®é™…ä¸­å› ä¸ºå¤šç§åŸå› ï¼Œä¸€èˆ¬ä¸ä¼šå•ç‹¬ä½¿ç”¨</li><li>ç”¨sessionåªéœ€è¦åœ¨å®¢æˆ·ç«¯ä¿å­˜ä¸€ä¸ªidï¼Œå®é™…ä¸Šå¤§é‡æ•°æ®éƒ½æ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯ã€‚å¦‚æœå…¨éƒ¨ç”¨cookieï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™å®¢æˆ·ç«¯æ˜¯æ²¡æœ‰é‚£ä¹ˆå¤šç©ºé—´çš„ã€‚</li><li>å¦‚æœåªç”¨cookieä¸ç”¨sessionï¼Œé‚£ä¹ˆè´¦æˆ·ä¿¡æ¯å…¨éƒ¨ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œä¸€æ—¦è¢«åŠ«æŒï¼Œå…¨éƒ¨ä¿¡æ¯éƒ½ä¼šæ³„éœ²ã€‚å¹¶ä¸”å®¢æˆ·ç«¯æ•°æ®é‡å˜å¤§ï¼Œç½‘ç»œä¼ è¾“çš„æ•°æ®é‡ä¹Ÿä¼šå˜å¤§</li></ul><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><strong>ç®€è€Œè¨€ä¹‹, session æœ‰å¦‚ç”¨æˆ·ä¿¡æ¯æ¡£æ¡ˆè¡¨, é‡Œé¢åŒ…å«äº†ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯å’Œç™»å½•çŠ¶æ€ç­‰ä¿¡æ¯. è€Œ cookie å°±æ˜¯ç”¨æˆ·é€šè¡Œè¯</strong></p><h2 id="token"><a href="#token" class="headerlink" title="token"></a>token</h2><p>token ä¹Ÿç§°ä½œä»¤ç‰Œï¼Œç”±uid+time+sign[+å›ºå®šå‚æ•°]<br>token çš„è®¤è¯æ–¹å¼ç±»ä¼¼äº<strong>ä¸´æ—¶çš„è¯ä¹¦ç­¾å</strong>, å¹¶ä¸”æ˜¯ä¸€ç§æœåŠ¡ç«¯æ— çŠ¶æ€çš„è®¤è¯æ–¹å¼, éå¸¸é€‚åˆäº REST API çš„åœºæ™¯. æ‰€è°“æ— çŠ¶æ€å°±æ˜¯æœåŠ¡ç«¯å¹¶ä¸ä¼šä¿å­˜èº«ä»½è®¤è¯ç›¸å…³çš„æ•°æ®ã€‚</p><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><ul><li>uid: ç”¨æˆ·å”¯ä¸€èº«ä»½æ ‡è¯†</li><li>time: å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</li><li>sign: ç­¾å, ä½¿ç”¨ hash/encrypt å‹ç¼©æˆå®šé•¿çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä»¥é˜²æ­¢ç¬¬ä¸‰æ–¹æ¶æ„æ‹¼æ¥</li><li>å›ºå®šå‚æ•°(å¯é€‰): å°†ä¸€äº›å¸¸ç”¨çš„å›ºå®šå‚æ•°åŠ å…¥åˆ° token ä¸­æ˜¯ä¸ºäº†é¿å…é‡å¤æŸ¥åº“</li></ul><h3 id="å­˜æ”¾"><a href="#å­˜æ”¾" class="headerlink" title="å­˜æ”¾"></a>å­˜æ”¾</h3><p>tokenåœ¨å®¢æˆ·ç«¯ä¸€èˆ¬å­˜æ”¾äºlocalStorageï¼Œcookieï¼Œæˆ–sessionStorageä¸­ã€‚åœ¨æœåŠ¡å™¨ä¸€èˆ¬å­˜äºæ•°æ®åº“ä¸­</p><h3 id="tokenè®¤è¯æµç¨‹"><a href="#tokenè®¤è¯æµç¨‹" class="headerlink" title="tokenè®¤è¯æµç¨‹"></a>tokenè®¤è¯æµç¨‹</h3><p>token çš„è®¤è¯æµç¨‹ä¸cookieå¾ˆç›¸ä¼¼</p><ul><li>ç”¨æˆ·ç™»å½•ï¼ŒæˆåŠŸåæœåŠ¡å™¨è¿”å›Tokenç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®åä¿å­˜åœ¨å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯å†æ¬¡è®¿é—®æœåŠ¡å™¨ï¼Œå°†tokenæ”¾å…¥headersä¸­</li><li>æœåŠ¡å™¨ç«¯é‡‡ç”¨filterè¿‡æ»¤å™¨æ ¡éªŒã€‚æ ¡éªŒæˆåŠŸåˆ™è¿”å›è¯·æ±‚æ•°æ®ï¼Œæ ¡éªŒå¤±è´¥åˆ™è¿”å›é”™è¯¯ç </li></ul><h2 id="tokenå¯ä»¥æŠµæŠ—csrfï¼Œcookie-sessionä¸è¡Œ"><a href="#tokenå¯ä»¥æŠµæŠ—csrfï¼Œcookie-sessionä¸è¡Œ" class="headerlink" title="tokenå¯ä»¥æŠµæŠ—csrfï¼Œcookie+sessionä¸è¡Œ"></a>tokenå¯ä»¥æŠµæŠ—csrfï¼Œcookie+sessionä¸è¡Œ</h2><p>å‡å¦‚ç”¨æˆ·æ­£åœ¨ç™»é™†é“¶è¡Œç½‘é¡µï¼ŒåŒæ—¶ç™»é™†äº†æ”»å‡»è€…çš„ç½‘é¡µï¼Œå¹¶ä¸”é“¶è¡Œç½‘é¡µæœªå¯¹csrfæ”»å‡»è¿›è¡Œé˜²æŠ¤ã€‚æ”»å‡»è€…å°±å¯ä»¥åœ¨ç½‘é¡µæ”¾ä¸€ä¸ªè¡¨å•ï¼Œè¯¥è¡¨å•æäº¤srcä¸º<code>http://www.bank.com/api/transfer</code>ï¼Œbodyä¸º<code>count=1000&amp;to=Tom</code>ã€‚å€˜è‹¥æ˜¯session+cookieï¼Œç”¨æˆ·æ‰“å¼€ç½‘é¡µçš„æ—¶å€™å°±å·²ç»è½¬ç»™Tom1000å…ƒäº†.å› ä¸ºform å‘èµ·çš„ POST è¯·æ±‚å¹¶ä¸å—åˆ°æµè§ˆå™¨åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œå› æ­¤å¯ä»¥ä»»æ„åœ°ä½¿ç”¨å…¶ä»–åŸŸçš„ Cookie å‘å…¶ä»–åŸŸå‘é€ POST è¯·æ±‚ï¼Œå½¢æˆ CSRF æ”»å‡»ã€‚åœ¨postè¯·æ±‚çš„ç¬é—´ï¼Œcookieä¼šè¢«æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­ã€‚ä½†tokenä¸åŒï¼Œtokenæ˜¯å¼€å‘è€…ä¸ºäº†é˜²èŒƒcsrfè€Œç‰¹åˆ«è®¾è®¡çš„ä»¤ç‰Œï¼Œæµè§ˆå™¨ä¸ä¼šè‡ªåŠ¨æ·»åŠ åˆ°headersé‡Œï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•è®¿é—®ç”¨æˆ·çš„tokenï¼Œæ‰€ä»¥æäº¤çš„è¡¨å•æ— æ³•é€šè¿‡æœåŠ¡å™¨è¿‡æ»¤ï¼Œä¹Ÿå°±æ— æ³•å½¢æˆæ”»å‡»ã€‚</p><h2 id="åˆ†å¸ƒå¼æƒ…å†µä¸‹çš„sessionå’Œtoken"><a href="#åˆ†å¸ƒå¼æƒ…å†µä¸‹çš„sessionå’Œtoken" class="headerlink" title="åˆ†å¸ƒå¼æƒ…å†µä¸‹çš„sessionå’Œtoken"></a>åˆ†å¸ƒå¼æƒ…å†µä¸‹çš„sessionå’Œtoken</h2><p>æˆ‘ä»¬å·²ç»çŸ¥é“sessionæ—¶æœ‰çŠ¶æ€çš„ï¼Œä¸€èˆ¬å­˜äºæœåŠ¡å™¨å†…å­˜æˆ–ç¡¬ç›˜ä¸­ï¼Œå½“æœåŠ¡å™¨é‡‡ç”¨åˆ†å¸ƒå¼æˆ–é›†ç¾¤æ—¶ï¼Œsessionå°±ä¼šé¢å¯¹è´Ÿè½½å‡è¡¡é—®é¢˜ã€‚</p><ul><li>è´Ÿè½½å‡è¡¡å¤šæœåŠ¡å™¨çš„æƒ…å†µï¼Œä¸å¥½ç¡®è®¤å½“å‰ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå› ä¸ºå¤šæœåŠ¡å™¨ä¸å…±äº«sessionã€‚è¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥å°†sessionå­˜åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸­æ¥è§£å†³ï¼Œä½†æ˜¯å°±ä¸èƒ½å®Œå…¨è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚å½“ä»Šçš„å‡ ç§<a href="http://blog.51cto.com/zhibeiwang/1965018">è§£å†³sessionè´Ÿè½½å‡è¡¡</a>çš„æ–¹æ³•ã€‚</li></ul><p>è€Œtokenæ˜¯æ— çŠ¶æ€çš„ï¼Œtokenå­—ç¬¦ä¸²é‡Œå°±ä¿å­˜äº†æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯</p><ul><li>å®¢æˆ·ç«¯ç™»é™†ä¼ é€’ä¿¡æ¯ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åæŠŠç”¨æˆ·ä¿¡æ¯åŠ å¯†ï¼ˆtokenï¼‰ä¼ ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†tokenå­˜æ”¾äºlocalStroageç­‰å®¹å™¨ä¸­ã€‚å®¢æˆ·ç«¯æ¯æ¬¡è®¿é—®éƒ½ä¼ é€’tokenï¼ŒæœåŠ¡ç«¯è§£å¯†tokenï¼Œå°±çŸ¥é“è¿™ä¸ªç”¨æˆ·æ˜¯è°äº†ã€‚é€šè¿‡cpuåŠ è§£å¯†ï¼ŒæœåŠ¡ç«¯å°±ä¸éœ€è¦å­˜å‚¨sessionå ç”¨å­˜å‚¨ç©ºé—´ï¼Œå°±å¾ˆå¥½çš„è§£å†³è´Ÿè½½å‡è¡¡å¤šæœåŠ¡å™¨çš„é—®é¢˜äº†ã€‚è¿™ä¸ªæ–¹æ³•å«åš[JWT(Json Web Token)](<a href="https://huanqiang.wang/2017/12/28/JWT">https://huanqiang.wang/2017/12/28/JWT</a> ä»‹ç»/)</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>sessionå­˜å‚¨äºæœåŠ¡å™¨ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªçŠ¶æ€åˆ—è¡¨ï¼Œæ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€è¯†åˆ«ç¬¦å·sessionIdï¼Œé€šå¸¸å­˜æ”¾äºcookieä¸­ã€‚æœåŠ¡å™¨æ”¶åˆ°cookieåè§£æå‡ºsessionIdï¼Œå†å»sessionåˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œæ‰èƒ½æ‰¾åˆ°ç›¸åº”sessionã€‚ä¾èµ–cookie</li><li>cookieç±»ä¼¼ä¸€ä¸ªä»¤ç‰Œï¼Œè£…æœ‰sessionIdï¼Œå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨é€šå¸¸ä¼šè‡ªåŠ¨æ·»åŠ ã€‚</li><li>tokenä¹Ÿç±»ä¼¼ä¸€ä¸ªä»¤ç‰Œï¼Œæ— çŠ¶æ€ï¼Œç”¨æˆ·ä¿¡æ¯éƒ½è¢«åŠ å¯†åˆ°tokenä¸­ï¼ŒæœåŠ¡å™¨æ”¶åˆ°tokenåè§£å¯†å°±å¯çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·ã€‚éœ€è¦å¼€å‘è€…æ‰‹åŠ¨æ·»åŠ ã€‚</li><li>jwtåªæ˜¯ä¸€ä¸ªè·¨åŸŸè®¤è¯çš„æ–¹æ¡ˆ</li></ul><p>Cookieæ˜¯ä¿å­˜åœ¨æµè§ˆå™¨ä¸Šçš„ä¸€äº›æ•°æ®ï¼Œä¸€èˆ¬é€šè¿‡HTTPå“åº”å¤´set cookieæ¥è®¾ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡JSè„šæœ¬æ¥ç›´æ¥è®¾ç½®ï¼ŒCookieæ˜¯æŒ‰ç…§ç½‘ç«™æ¥è¿›è¡Œç»„ç»‡å’Œä¿å­˜çš„ï¼Œæ¯ä¸€ä¸ªç½‘ç«™éƒ½å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä¿å­˜ä¸€äº›Cookieï¼Œä¿å­˜å¥½äº†ä¹‹åï¼Œæµè§ˆå™¨å‘è¿™ä¸ªç½‘ç«™å‘å‡ºçš„è¯·æ±‚éƒ½ä¼šæºå¸¦è¿™äº›Cookieï¼Œç„¶ååå°å°±å¯ä»¥åˆ†æè¿™äº›Cookieã€‚Sessionè¿™ä¸ªå•è¯åœ¨ä¸åŒçš„è¯­å¢ƒä¸‹å¯ä»¥æœ‰ä¸åŒçš„å«ä¹‰ã€‚å®ƒå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå³ä¼šè¯ï¼Œä¼šè¯ç”¨äºè®°å½•ä¸€ä¸ªç”¨æˆ·åœ¨æˆ‘ä»¬ç½‘ç«™ä¸Šçš„ä¸€äº›è¡Œä¸ºã€ä¸€äº›çŠ¶æ€ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼ŒContextã€‚è¿™äº›ç”¨æˆ·çŠ¶æ€å¯ä»¥åˆ©ç”¨Cookieç›´æ¥ä¿å­˜åœ¨å‰ç«¯ï¼Œä¹Ÿå¯ä»¥ä¿å­˜åœ¨åå°ï¼Œç„¶ååˆ©ç”¨Cookieä¸­çš„Session IDæ¥æ ‡è¯†ã€‚åœ¨å¦å¤–çš„ä¸€äº›è¯­å¢ƒä¸‹ï¼ŒSessionåˆå¯ä»¥æŒ‡åœ¨åå°ä¿å­˜ç”¨æˆ·çŠ¶æ€æ¥å®ç°ä¼šè¯çš„æ–¹å¼ï¼Œå®ƒæŠŠç”¨æˆ·çŠ¶æ€å­˜å‚¨åœ¨åå°çš„å†…å­˜ã€æ•°æ®åº“ç­‰ä»‹è´¨ä¸­ï¼Œç„¶åæˆ‘ä»¬åˆ©ç”¨è¯·æ±‚çš„Cookieä¸­ä¿å­˜çš„Session IDæ¥ä¸ºè¿™ä¸ªè¯·æ±‚æ‰¾åˆ°å®ƒå¯¹åº”çš„ä¼šè¯ã€‚</p><p>Sessionåœ¨ä¸€äº›è¯­å¢ƒä¸‹è¿˜å¯èƒ½ä¸“æŒ‡åå°ä¿å­˜çš„ç”¨æˆ·çŠ¶æ€</p><ol><li>ç”±äºHTTPåè®®æ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦è®°å½•ç”¨æˆ·çš„çŠ¶æ€æ—¶ï¼Œå°±éœ€è¦ç”¨æŸç§æœºåˆ¶æ¥è¯†å…·ä½“çš„ç”¨æˆ·ï¼Œè¿™ä¸ªæœºåˆ¶å°±æ˜¯Session.å…¸å‹çš„åœºæ™¯æ¯”å¦‚è´­ç‰©è½¦ï¼Œå½“ä½ ç‚¹å‡»ä¸‹å•æŒ‰é’®æ—¶ï¼Œç”±äºHTTPåè®®æ— çŠ¶æ€ï¼Œæ‰€ä»¥å¹¶ä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œæ‰€ä»¥æœåŠ¡ç«¯è¦ä¸ºç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºäº†ç‰¹å®šçš„Sessionï¼Œç”¨ç”¨äºæ ‡è¯†è¿™ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”è·Ÿè¸ªç”¨æˆ·ï¼Œè¿™æ ·æ‰çŸ¥é“è´­ç‰©è½¦é‡Œé¢æœ‰å‡ æœ¬ä¹¦ã€‚è¿™ä¸ªSessionæ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ï¼Œæœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚åœ¨æœåŠ¡ç«¯ä¿å­˜Sessionçš„æ–¹æ³•å¾ˆå¤šï¼Œå†…å­˜ã€æ•°æ®åº“ã€æ–‡ä»¶éƒ½æœ‰ã€‚é›†ç¾¤çš„æ—¶å€™ä¹Ÿè¦è€ƒè™‘Sessionçš„è½¬ç§»ï¼Œåœ¨å¤§å‹çš„ç½‘ç«™ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸“é—¨çš„SessionæœåŠ¡å™¨é›†ç¾¤ï¼Œç”¨æ¥ä¿å­˜ç”¨æˆ·ä¼šè¯ï¼Œè¿™ä¸ªæ—¶å€™ Session ä¿¡æ¯éƒ½æ˜¯æ”¾åœ¨å†…å­˜çš„ï¼Œä½¿ç”¨ä¸€äº›ç¼“å­˜æœåŠ¡æ¯”å¦‚Memcachedä¹‹ç±»çš„æ¥æ”¾ Sessionã€‚</li><li>æ€è€ƒä¸€ä¸‹æœåŠ¡ç«¯å¦‚ä½•è¯†åˆ«ç‰¹å®šçš„å®¢æˆ·ï¼Ÿè¿™ä¸ªæ—¶å€™Cookieå°±ç™»åœºäº†ã€‚æ¯æ¬¡HTTPè¯·æ±‚çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šå‘é€ç›¸åº”çš„Cookieä¿¡æ¯åˆ°æœåŠ¡ç«¯ã€‚å®é™…ä¸Šå¤§å¤šæ•°çš„åº”ç”¨éƒ½æ˜¯ç”¨ Cookie æ¥å®ç°Sessionè·Ÿè¸ªçš„ï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºSessionçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šåœ¨HTTPåè®®ä¸­å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œéœ€è¦åœ¨ Cookie é‡Œé¢è®°å½•ä¸€ä¸ªSession IDï¼Œä»¥åæ¯æ¬¡è¯·æ±‚æŠŠè¿™ä¸ªä¼šè¯IDå‘é€åˆ°æœåŠ¡å™¨ï¼Œæˆ‘å°±çŸ¥é“ä½ æ˜¯è°äº†ã€‚æœ‰äººé—®ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„æµè§ˆå™¨ç¦ç”¨äº† Cookie æ€ä¹ˆåŠï¼Ÿä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ä¸€ç§å«åšURLé‡å†™çš„æŠ€æœ¯æ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼Œå³æ¯æ¬¡HTTPäº¤äº’ï¼ŒURLåé¢éƒ½ä¼šè¢«é™„åŠ ä¸Šä¸€ä¸ªè¯¸å¦‚ sid=xxxxx è¿™æ ·çš„å‚æ•°ï¼ŒæœåŠ¡ç«¯æ®æ­¤æ¥è¯†åˆ«ç”¨æˆ·ã€‚</li><li>Cookieå…¶å®è¿˜å¯ä»¥ç”¨åœ¨ä¸€äº›æ–¹ä¾¿ç”¨æˆ·çš„åœºæ™¯ä¸‹ï¼Œè®¾æƒ³ä½ æŸæ¬¡ç™»é™†è¿‡ä¸€ä¸ªç½‘ç«™ï¼Œä¸‹æ¬¡ç™»å½•çš„æ—¶å€™ä¸æƒ³å†æ¬¡è¾“å…¥è´¦å·äº†ï¼Œæ€ä¹ˆåŠï¼Ÿè¿™ä¸ªä¿¡æ¯å¯ä»¥å†™åˆ°Cookieé‡Œé¢ï¼Œè®¿é—®ç½‘ç«™çš„æ—¶å€™ï¼Œç½‘ç«™é¡µé¢çš„è„šæœ¬å¯ä»¥è¯»å–è¿™ä¸ªä¿¡æ¯ï¼Œå°±è‡ªåŠ¨å¸®ä½ æŠŠç”¨æˆ·åç»™å¡«äº†ï¼Œèƒ½å¤Ÿæ–¹ä¾¿ä¸€ä¸‹ç”¨æˆ·ã€‚è¿™ä¹Ÿæ˜¯Cookieåç§°çš„ç”±æ¥ï¼Œç»™ç”¨æˆ·çš„ä¸€ç‚¹ç”œå¤´ã€‚<br>æ‰€ä»¥ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š<br>Sessionæ˜¯åœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥ä¿å­˜åœ¨é›†ç¾¤ã€æ•°æ®åº“ã€æ–‡ä»¶ä¸­ï¼›<br>Cookieæ˜¯å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å®ç°Sessionçš„ä¸€ç§æ–¹å¼ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>springæ³¨è§£åŸç†</title>
      <link href="2021/03/31/spring-zhu-jie-yuan-li/"/>
      <url>2021/03/31/spring-zhu-jie-yuan-li/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-æ³¨è§£é©±åŠ¨å¼€å‘"><a href="#Spring-æ³¨è§£é©±åŠ¨å¼€å‘" class="headerlink" title="Spring æ³¨è§£é©±åŠ¨å¼€å‘"></a>Spring æ³¨è§£é©±åŠ¨å¼€å‘</h1><h2 id="1-é…ç½®æ–‡ä»¶"><a href="#1-é…ç½®æ–‡ä»¶" class="headerlink" title="1. é…ç½®æ–‡ä»¶"></a>1. é…ç½®æ–‡ä»¶</h2><p>1ã€é…ç½®æ–‡ä»¶çš„å½¢å¼ä¸­ï¼Œæ ‡æ³¨äº†<code>@component-scan</code>,<code>@Controller</code>,<code>@Service</code>,<code>@Repository</code>,<code>@Component</code>å°±ä¼šè‡ªåŠ¨æ‰«æåŒ…ã€‚</p><p>2ã€<code>@ComponentScan(value="com.atguigu")</code>,</p><h3 id="1-1-é…ç½®"><a href="#1-1-é…ç½®" class="headerlink" title="1.1 é…ç½®"></a>1.1 é…ç½®</h3><h2 id="2-å¸¸ç”¨æ³¨è§£"><a href="#2-å¸¸ç”¨æ³¨è§£" class="headerlink" title="2. å¸¸ç”¨æ³¨è§£"></a>2. å¸¸ç”¨æ³¨è§£</h2><p><code>@Controller</code> æ³¨è§£çš„beanä¼šè¢«spring-mvcæ¡†æ¶æ‰€ä½¿ç”¨ã€‚<br><code>@Repository</code> ä¼šè¢«ä½œä¸ºæŒä¹…å±‚æ“ä½œï¼ˆæ•°æ®åº“ï¼‰çš„beanæ¥ä½¿ç”¨<br>å¦‚æœæƒ³ä½¿ç”¨è‡ªå®šä¹‰çš„ç»„ä»¶æ³¨è§£ï¼Œé‚£ä¹ˆåªè¦åœ¨ä½ å®šä¹‰çš„æ–°æ³¨è§£ä¸­åŠ ä¸Š@Componentå³å¯ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span> <span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">"prototype"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ScheduleJob</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token number">123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·ï¼Œæ‰€æœ‰è¢«<code>@ScheduleJob</code>æ³¨è§£çš„ç±»å°±éƒ½å¯ä»¥æ³¨å…¥åˆ°springå®¹å™¨æ¥è¿›è¡Œç®¡ç†ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„ï¼Œå°±æ˜¯å†™ä¸€äº›æ–°çš„ä»£ç æ¥å¤„ç†è¿™ä¸ªè‡ªå®šä¹‰æ³¨è§£ï¼ˆè¯‘è€…æ³¨ï¼šå¯ä»¥ç”¨åå°„çš„æ–¹æ³•ï¼‰ï¼Œè¿›è€Œæ‰§è¡Œæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å·¥ä½œã€‚</p><p><code>@Component</code>å°±æ˜¯è·Ÿ<code>&lt;bean&gt;</code>ä¸€æ ·ï¼Œå¯ä»¥æ‰˜ç®¡åˆ°Springå®¹å™¨è¿›è¡Œç®¡ç†ã€‚</p><p><code>@Service</code>, <code>@Controller</code> , <code>@Repository</code> = {<code>@Component</code> + ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½}ã€‚è¿™ä¸ªå°±æ„å‘³ç€è¿™äº›æ³¨è§£åœ¨éƒ¨åˆ†åŠŸèƒ½ä¸Šæ˜¯ä¸€æ ·çš„ã€‚</p><p>å½“ç„¶ï¼Œä¸‹é¢ä¸‰ä¸ªæ³¨è§£è¢«ç”¨äºä¸ºæˆ‘ä»¬çš„åº”ç”¨è¿›è¡Œåˆ†å±‚ï¼š</p><p><code>@Controller</code>æ³¨è§£ç±»è¿›è¡Œå‰ç«¯è¯·æ±‚çš„å¤„ç†ï¼Œè½¬å‘ï¼Œé‡å®šå‘ã€‚åŒ…æ‹¬è°ƒç”¨Serviceå±‚çš„æ–¹æ³• ï¼ˆrequestMapping + componnet)<br><code>@Service</code>æ³¨è§£ç±»å¤„ç†ä¸šåŠ¡é€»è¾‘<br><code>@Repository</code>æ³¨è§£ç±»ä½œä¸ºDAOå¯¹è±¡ï¼ˆæ•°æ®è®¿é—®å¯¹è±¡ï¼ŒData Access Objectsï¼‰ï¼Œè¿™äº›ç±»å¯ä»¥ç›´æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ<br>æœ‰è¿™äº›åˆ†å±‚æ“ä½œçš„è¯ï¼Œä»£ç ä¹‹é—´å°±å®ç°äº†æ¾è€¦åˆï¼Œä»£ç ä¹‹é—´çš„è°ƒç”¨ä¹Ÿæ¸…æ™°æ˜æœ—ï¼Œä¾¿äºé¡¹ç›®çš„ç®¡ç†ï¼›å‡æƒ³ä¸€ä¸‹ï¼Œå¦‚æœåªç”¨<code>@Controller</code>æ³¨è§£ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯·æ±‚è½¬å‘ï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ®åº“æ“ä½œä»£ç éƒ½ç³…åˆåœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œé‚£è¿™æ ·çš„ä»£ç è¯¥æœ‰å¤šéš¾æ‹“å±•å’Œç»´æŠ¤ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>@Component</code>, <code>@Service</code>, <code>@Controller</code>, <code>@Repository</code>æ˜¯springæ³¨è§£ï¼Œæ³¨è§£åå¯ä»¥è¢«springæ¡†æ¶æ‰€æ‰«æå¹¶æ³¨å…¥åˆ°springå®¹å™¨æ¥è¿›è¡Œç®¡ç†<br><code>@Component</code>æ˜¯é€šç”¨æ³¨è§£ï¼Œå…¶ä»–ä¸‰ä¸ªæ³¨è§£æ˜¯è¿™ä¸ªæ³¨è§£çš„æ‹“å±•ï¼Œå¹¶ä¸”å…·æœ‰äº†ç‰¹å®šçš„åŠŸèƒ½<br><code>@Repository</code>æ³¨è§£åœ¨æŒä¹…å±‚ä¸­ï¼Œå…·æœ‰å°†æ•°æ®åº“æ“ä½œæŠ›å‡ºçš„åŸç”Ÿå¼‚å¸¸ç¿»è¯‘è½¬åŒ–ä¸ºspringçš„æŒä¹…å±‚å¼‚å¸¸çš„åŠŸèƒ½ã€‚<br><code>@Controller</code>å±‚æ˜¯spring-mvcçš„æ³¨è§£ï¼Œå…·æœ‰å°†è¯·æ±‚è¿›è¡Œè½¬å‘ï¼Œé‡å®šå‘çš„åŠŸèƒ½ã€‚<br><code>@Service</code>å±‚æ˜¯ä¸šåŠ¡é€»è¾‘å±‚æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£åªæ˜¯æ ‡æ³¨è¯¥ç±»å¤„äºä¸šåŠ¡é€»è¾‘å±‚ã€‚<br>ç”¨è¿™äº›æ³¨è§£å¯¹åº”ç”¨è¿›è¡Œåˆ†å±‚ä¹‹åï¼Œå°±èƒ½å°†è¯·æ±‚å¤„ç†ï¼Œä¹‰åŠ¡é€»è¾‘å¤„ç†ï¼Œæ•°æ®åº“æ“ä½œå¤„ç†åˆ†ç¦»å‡ºæ¥ï¼Œä¸ºä»£ç è§£è€¦ï¼Œä¹Ÿæ–¹ä¾¿äº†ä»¥åé¡¹ç›®çš„ç»´æŠ¤å’Œå¼€å‘ã€‚</p><h3 id="1-RequestMapping"><a href="#1-RequestMapping" class="headerlink" title="1.@RequestMapping"></a>1.@RequestMapping</h3><p>1ï¼‰éå†Handlerä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰¾å‡ºå…¶ä¸­è¢«@RequestMappingæ³¨è§£æ ‡è®°çš„æ–¹æ³•ã€‚</p><p>2ï¼‰éå†è¿™äº›æ–¹æ³•ï¼Œç”ŸæˆRequestMappingInfoå®ä¾‹ã€‚</p><p>3ï¼‰å°†RequestMappingInfoå®ä¾‹ä»¥åŠå¤„ç†å™¨æ–¹æ³•æ³¨å†Œåˆ°ç¼“å­˜ä¸­ã€‚</p><p>å½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå»urlMapä¸­æ‰¾åŒ¹é…çš„urlï¼Œä»¥åŠè·å–å¯¹åº”çš„mappingå®ä¾‹ï¼Œç„¶åå»handlerMethodsä¸­è·å–åŒ¹é…HandlerMethodå®ä¾‹ã€‚</p><h3 id="2-Autowired"><a href="#2-Autowired" class="headerlink" title="2. @Autowired"></a>2. @Autowired</h3><p>autowiredæ˜¯ç”¨æ¥è£…é…beançš„ï¼Œå’Œbeançš„åˆå§‹åŒ–æœ‰å…³ã€‚å½“æ‰§è¡Œrefreshæ–¹æ³•åï¼Œåœ¨è§¦å‘äº†beançš„åˆå§‹åŒ–åï¼Œåˆ›å»ºBeanWrapperï¼Œå®ƒçš„å†…éƒ¨æˆå‘˜å˜é‡wrappedObjectå­˜æ”¾çš„å°±æ˜¯å®ä¾‹åŒ–çš„MyServiceå¯¹è±¡ï¼Œç„¶åè¿›è¡Œå±æ€§æ³¨å…¥ã€‚</p><p>è·å–éœ€è¦å¤„ç†çš„ç›®æ ‡ç±»ï¼Œä¼ å…¥ç›®æ ‡ç±»å‚æ•°ï¼Œé€šè¿‡åå°„è·å–è¯¥ç±»çš„æ‰€æœ‰å­—æ®µï¼Œéå†æ¯è¡Œä¸€ä¸ªå­—æ®µï¼Œåˆ¤æ–­æ˜¯å¦è¢«autowiredä¿®é¥°ï¼Œè¿”å›æ‰€æœ‰å¸¦æœ‰autowiredæ³¨è§£ä¿®é¥°çš„ä¸€ä¸ªé›†åˆã€‚æœ‰äº†ç›®æ ‡ç±»å’Œåˆšæ‰è¿”å›çš„è¿™ä¸ªéœ€è¦æ³¨å…¥çš„é›†åˆã€‚</p><p>æ³¨å…¥ï¼š</p><ul><li><p>å…ˆä½¿ç”¨åå°„æŠ€æœ¯å¯¹å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–å’Œèµ‹å€¼ï¼Œç„¶åè¿™ä¸ªbeanå°±ç”Ÿæˆäº†ã€‚</p></li><li><p>æ ¹æ®beançš„åå­—å»æ‹¿åˆ°beanè¿›è¡Œæ³¨å…¥ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Systemç±»æºç åˆ†æ</title>
      <link href="2021/03/31/system-lei-yuan-ma-fen-xi/"/>
      <url>2021/03/31/system-lei-yuan-ma-fen-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="The-Security-Manager"><a href="#The-Security-Manager" class="headerlink" title="The Security Manager"></a>The Security Manager</h2><ol><li>å®šä¹‰</li></ol><p>å®˜æ–¹ï¼š</p><p>A security manager is an object that defines a security policy for an application. This policy specifies actions that are unsafe or sensitive. Any actions not allowed by the security policy cause a <code>SecurityException</code> to be thrown. An application can also query its security manager to discover which actions are allowed.</p><p>ç†è§£ï¼š</p><p>å®ƒæ˜¯ä¸€ä¸ªåº”ç”¨çš„å®‰å…¨ç­–ç•¥ã€‚è¿™ä¸ªç­–ç•¥æŒ‡å®šå½“å‰çš„åŠ¨ä½œæ˜¯å®‰å…¨orä¸å®‰å…¨oræ•æ„Ÿã€‚</p><ol start="2"><li>ç¤ºä¾‹</li></ol><p>å®˜æ–¹ï¼š</p><p>Typically, a web applet runs with a security manager provided by the browser or Java Web Start plugin. Other kinds of applications normally run without a security manager, unless the application itself defines one. If no security manager is present, the application has no security policy and acts without restrictions.</p><p>ç†è§£ï¼š</p><p>web ç¨‹åºä¸­çš„å®‰å…¨ç®¡ç†ç±»æ˜¯ç”±æµè§ˆå™¨æˆ–è€…å¯åŠ¨æ’ä»¶æä¾›çš„ã€‚å…¶ä»–åº”ç”¨ç¨‹åºé€šå¸¸æ²¡æœ‰å®‰å…¨ç®¡ç†ç±»ï¼Œé™¤éæˆ‘ä»¬è‡ªå·±å»å®šä¹‰ã€‚</p><p>åœ¨</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>javaunderlying</title>
      <link href="2021/03/31/javaunderlying/"/>
      <url>2021/03/31/javaunderlying/</url>
      
        <content type="html"><![CDATA[<h3 id="1-æ ˆå¸§ä¸­çš„å˜é‡ä½œç”¨åŸŸ"><a href="#1-æ ˆå¸§ä¸­çš„å˜é‡ä½œç”¨åŸŸ" class="headerlink" title="1. æ ˆå¸§ä¸­çš„å˜é‡ä½œç”¨åŸŸ"></a><font color="green">1. æ ˆå¸§ä¸­çš„å˜é‡ä½œç”¨åŸŸ</font></h3><ol><li>æ²¡æœ‰ä½œç”¨åŸŸçš„å±€éƒ¨å˜é‡ä¸ä¼šè¿›å…¥å±€éƒ¨å˜é‡è¡¨ã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">{</span>        <span class="token keyword">int</span> val1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> val2 <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>val1</code>æ²¡æœ‰ä½œç”¨åŸŸï¼ˆé‚£ä¸ªä»£ç å—åªæœ‰å®ƒä¸€ä¸ªï¼Œè·‘å®Œå°±å’©æœ‰äº†ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥å±€éƒ¨å˜é‡è¡¨ä¸­ã€‚val2ä¼šè¿›å…¥å˜é‡è¡¨ï¼Œå› ä¸ºval2ä½œç”¨äºtestå‡½æ•°ã€‚</p><ol start="2"><li>éé™æ€æ–¹æ³•ï¼Œå±€éƒ¨å˜é‡è¡¨ index=0çš„ä½ç½®æ°¸è¿œæ˜¯thisæŒ‡é’ˆã€‚é™æ€æ–¹æ³•æ²¡æœ‰thisæŒ‡é’ˆã€‚</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å°é™ˆå’Œæˆ‘</title>
      <link href="2021/03/30/love/"/>
      <url>2021/03/30/love/</url>
      
        <content type="html"><![CDATA[<h1 id="å°é™ˆå’Œæˆ‘çš„ç”Ÿæ´»è®°å½•"><a href="#å°é™ˆå’Œæˆ‘çš„ç”Ÿæ´»è®°å½•" class="headerlink" title="å°é™ˆå’Œæˆ‘çš„ç”Ÿæ´»è®°å½•"></a>å°é™ˆå’Œæˆ‘çš„ç”Ÿæ´»è®°å½•</h1><p>èº«ä»½ä»‹ç»ï¼š</p><table><thead><tr><th align="center">ç”·</th><th align="center">å¥³</th></tr></thead><tbody><tr><td align="center">èº«é«˜ï¼š180</td><td align="center">èº«é«˜ï¼š164</td></tr><tr><td align="center">ä½“é‡ï¼š140</td><td align="center">ä½“é‡ï¼šä¿å¯†</td></tr><tr><td align="center">æ€§æ ¼ï¼šæ²™é›•</td><td align="center">æ€§æ ¼ï¼šç¨³é‡å’Œéšè—</td></tr><tr><td align="center">æŠ€èƒ½ï¼šjavaå¼€å‘ã€ä¿®ç”µè„‘ã€æ°”äººè¾¾äºº</td><td align="center">æŠ€èƒ½ï¼šè‹±è¯­ã€æ¸©æŸ”</td></tr><tr><td align="center">èŒä¸šï¼šç¨‹åºçŒ¿</td><td align="center">èŒä¸šï¼šæ•™å¸ˆorï¼Ÿ</td></tr></tbody></table><h2 id="1-åƒè¿‡çš„å¥½åƒçš„"><a href="#1-åƒè¿‡çš„å¥½åƒçš„" class="headerlink" title="1. åƒè¿‡çš„å¥½åƒçš„"></a>1. åƒè¿‡çš„å¥½åƒçš„</h2><ol><li>ä¸‰ä¸ç‰›è…©</li><li>æ£æœ¨çƒ¤é¸­</li><li>èƒ¡å—²å•è½¦çƒ§çƒ¤ï¼ˆè¶…å¥½åƒï¼‰</li><li>èŠ±é“å¯¿å¸ï¼ˆæ—¥æ–™ï¼‰</li><li>XXç‰›æ‚ç²‰</li><li>é…±å¤§éª¨ï¼ˆåƒåäº†è‚šå­ï¼Œæ¹–å—å¤§å­¦å¤©é©¬å…¬å¯“é‚£ä¸ªåœ°æ–¹ï¼Œåƒä¸‡ä¸è¦å»ï¼‰</li><li>é…¸è¾£ç²‰ï¼ˆåè¡—ï¼Œå‘³é“ä¸é”™ï¼‰</li><li>æ¹–å—å¤§å­¦ç‰›è‚‰é¥¼ï¼ˆå°é™ˆè¯´å¥½åƒï¼Œæˆ‘è§‰å¾—ä¸€èˆ¬ï¼‰</li><li>ä¸­å—å¤§å­¦éº“å±±å—è·¯æ–°å¼€çš„çƒ¤é±¼çƒ¤ç‰›è›™ï¼Œç‚¹çš„é²ˆé±¼ï¼ŒæŒºå¥½åƒ</li><li>æ¡‚æ—å¤ç²‰ï¼ˆæŒºå¥½åƒï¼Œæ¹–å—å¤§å­¦éº“å±±å—è·¯ä¸€å®¶å°åº—ï¼Œå¤§æ¦‚åœ¨æ¸”æ¹¾å¸‚é‚£é‡Œï¼‰</li></ol><h2 id="2-å»è¿‡çš„åœ°æ–¹"><a href="#2-å»è¿‡çš„åœ°æ–¹" class="headerlink" title="2.å»è¿‡çš„åœ°æ–¹"></a>2.å»è¿‡çš„åœ°æ–¹</h2><ol><li>é•¿æ²™æµ·åº•ä¸–ç•Œ</li><li>é•¿æ²™äº”ä¸€å¹¿åœº</li><li>å²³éº“å±±</li><li>ä¸­å—å¤§å­¦</li><li>æ¹–å—å¤§å­¦</li><li>æ©˜å­æ´²</li></ol><h2 id="3-çœ‹çš„ç”µå½±"><a href="#3-çœ‹çš„ç”µå½±" class="headerlink" title="3.çœ‹çš„ç”µå½±"></a>3.çœ‹çš„ç”µå½±</h2><ol><li>é€ä½ ä¸€æœµå°çº¢èŠ±</li><li>é˜¿å‡¡è¾¾</li><li>äººæ½®æ±¹æ¶Œ</li><li>åˆ©åˆƒå‡ºé˜</li></ol><p><img src="/2021/03/30/love/%E5%B0%8F%E9%99%88.jpg"></p><p><img src="/2021/03/30/love/xxh.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> life </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿æ•™è‚²é¡¹ç›®å®æˆ˜</title>
      <link href="2021/03/23/project/"/>
      <url>2021/03/23/project/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨çº¿æ•™è‚²å¹³å°"><a href="#åœ¨çº¿æ•™è‚²å¹³å°" class="headerlink" title="åœ¨çº¿æ•™è‚²å¹³å°"></a>åœ¨çº¿æ•™è‚²å¹³å°</h1><h2 id="1-ç»“æ„"><a href="#1-ç»“æ„" class="headerlink" title="1.ç»“æ„"></a>1.ç»“æ„</h2><p>æœ¬å¹³å°å•†ä¸šæ¨¡å¼æ˜¯B2B2Cæ¨¡å¼ã€‚</p><p>æ‹¥æœ‰ç³»ç»Ÿåå°ï¼ˆç®¡ç†å‘˜ä½¿ç”¨ï¼‰ã€ç³»ç»Ÿå‰å°ï¼ˆæ™®é€šç”¨æˆ·ä½¿ç”¨ï¼‰ã€‚</p><table><thead><tr><th align="center">åå°ï¼ˆ7å¤§æ¨¡å—ï¼‰</th><th align="center">å‰å°</th></tr></thead><tbody><tr><td align="center">è®²å¸ˆç®¡ç†æ¨¡å—</td><td align="center">é¦–é¡µæ•°æ®æ˜¾ç¤º</td></tr><tr><td align="center">è¯¾ç¨‹åˆ†ç±»ç®¡ç†æ¨¡å—</td><td align="center">è®²å¸ˆåˆ—è¡¨å’Œè¯¦æƒ…</td></tr><tr><td align="center">è¯¾ç¨‹ç®¡ç†æ¨¡å—ï¼ˆ1ï¼‰è§†é¢‘</td><td align="center">è¯¾ç¨‹åˆ—è¡¨å’Œè¯¾ç¨‹è¯¦æƒ…ï¼ˆ1ï¼‰è§†é¢‘çš„åœ¨çº¿æ’­æ”¾</td></tr><tr><td align="center">ç»Ÿè®¡åˆ†ææ¨¡å—</td><td align="center">ç™»å½•å’Œæ³¨å†Œ</td></tr><tr><td align="center">è®¢å•ç®¡ç†</td><td align="center">å¾®ä¿¡æ‰«ç ç™»å½•</td></tr><tr><td align="center">bannerç®¡ç†ï¼ˆå¹»ç¯ç‰‡åˆ‡æ¢ï¼‰</td><td align="center">å¾®ä¿¡æ‰«ç æ”¯ä»˜</td></tr><tr><td align="center">æƒé™ç®¡ç†</td><td align="center"></td></tr></tbody></table><h3 id="1-1-ä½¿ç”¨æŠ€æœ¯"><a href="#1-1-ä½¿ç”¨æŠ€æœ¯" class="headerlink" title="1.1 ä½¿ç”¨æŠ€æœ¯"></a>1.1 ä½¿ç”¨æŠ€æœ¯</h3><p>é¡¹ç›®ä½¿ç”¨ å‰åç«¯åˆ†ç¦»å¼€å‘</p><p><img src="/2021/03/23/project/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.PNG"></p><table><thead><tr><th>åç«¯</th><th>å‰ç«¯</th></tr></thead><tbody><tr><td>springboot</td><td>vue</td></tr><tr><td>springcloud</td><td>element-ui</td></tr><tr><td>MybatisPlus</td><td>axios</td></tr><tr><td>spring security</td><td>node.js</td></tr><tr><td>redis</td><td></td></tr><tr><td>maven</td><td></td></tr><tr><td>easyExcel</td><td></td></tr><tr><td>jwt</td><td></td></tr><tr><td>OAuth2</td><td></td></tr></tbody></table><p>å…¶ä»–æŠ€æœ¯ï¼šé˜¿é‡Œäº‘ossã€é˜¿é‡Œäº‘è§†é¢‘ç‚¹æ’­æœåŠ¡ã€é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ã€å¾®ä¿¡æ”¯ä»˜å’Œç™»å½•ã€dockerã€gitã€jenkins</p><h2 id="2-MybatisPlus"><a href="#2-MybatisPlus" class="headerlink" title="2.MybatisPlus"></a>2.MybatisPlus</h2><p>å®˜ç½‘ï¼š<a href="http://mp.baomidou.com/">http://mp.baomidou.com/</a></p><p>å‚è€ƒæ•™ç¨‹ï¼š<a href="http://mp.baomidou.com/guide/">http://mp.baomidou.com/guide/</a></p><p>MPæ˜¯ä¸€ä¸ªMyBatisçš„å¢å¼ºå·¥å…·ï¼Œåœ¨Mybatisçš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p><h3 id="2-1-å¼€å‘æ­¥éª¤"><a href="#2-1-å¼€å‘æ­¥éª¤" class="headerlink" title="2.1 å¼€å‘æ­¥éª¤"></a>2.1 å¼€å‘æ­¥éª¤</h3><h4 id="2-1-1-åˆ›å»ºæ•°æ®åº“"><a href="#2-1-1-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="2.1.1 åˆ›å»ºæ•°æ®åº“"></a>2.1.1 åˆ›å»ºæ•°æ®åº“</h4><p>åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œæ·»åŠ æ•°æ®ï¼Œç”¨äºmpæ“ä½œã€‚</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">USE `mybatis_plus`;CREATE TABLE `user`(`id` BIGINT(20) NOT NULL COMMENT 'ä¸»é”®id',`name` VARCHAR(30) NULL DEFAULT NULL COMMENT 'å§“å',`age` INT(11) NULL DEFAULT NULL COMMENT 'å¹´é¾„',`email` VARCHAR(50) NULL DEFAULT NULL COMMENT 'é‚®ç®±',PRIMARY KEY (id));INSERT INTO `user` (id,`name`,age,email) VALUES (1, 'Jone',18,'test1@baomidou.com'),(2, 'Jack', 20, 'test2@baomidou.com'),(3, 'Tom', 28, 'test3@baomidou.com'),(4, 'Sandy', 21, 'test4@baomidou.com'),(5, 'Billie', 24, 'test5@baomidou.com');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-2-åˆ›å»ºspringbootå·¥ç¨‹"><a href="#2-1-2-åˆ›å»ºspringbootå·¥ç¨‹" class="headerlink" title="2.1.2 åˆ›å»ºspringbootå·¥ç¨‹"></a>2.1.2 åˆ›å»ºspringbootå·¥ç¨‹</h4><p>ä¸»è¦å°±æ˜¯æ“ä½œideaï¼Œspringbootç‰ˆæœ¬ä½¿ç”¨2.2.1.RELEASE</p><h4 id="2-1-3-å¼•å…¥ä¾èµ–"><a href="#2-1-3-å¼•å…¥ä¾èµ–" class="headerlink" title="2.1.3 å¼•å…¥ä¾èµ–"></a>2.1.3 å¼•å…¥ä¾èµ–</h4><p>springbootå’Œmpçš„ä¾èµ–ã€‚</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-4-é…ç½®application-properties"><a href="#2-1-4-é…ç½®application-properties" class="headerlink" title="2.1.4 é…ç½®application.properties"></a>2.1.4 é…ç½®application.properties</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver #å¦‚æœæ˜¯mysql 8+ éœ€è¦åŠ cjå’Œä¸‹é¢çš„æ—¶åŒºspring.datasource.url=jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8spring.datasource.username=rootspring.datasource.password=000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦ä¸€ç§é…ç½®æ–‡ä»¶æ˜¯ymlï¼Œä¹Ÿå¯ä»¥ã€‚</p><h4 id="2-1-5-å†™ä»£ç "><a href="#2-1-5-å†™ä»£ç " class="headerlink" title="2.1.5 å†™ä»£ç "></a>2.1.5 å†™ä»£ç </h4><ul><li>å®ä½“ç±»</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨ç±»</li></ul><p>å¯åŠ¨ç±»åŠ mapperscanï¼Œè‡ªåŠ¨æ‰«æå¯¹åº”çš„mapper</p><h4 id="2-1-6-æ€§èƒ½åˆ†ææ’ä»¶"><a href="#2-1-6-æ€§èƒ½åˆ†ææ’ä»¶" class="headerlink" title="2.1.6 æ€§èƒ½åˆ†ææ’ä»¶"></a>2.1.6 æ€§èƒ½åˆ†ææ’ä»¶</h4><p>æ€§èƒ½åˆ†ææ‹¦æˆªå™¨ï¼š</p><ol><li>åœ¨é…ç½®ç±»ä¸­åŠ ä¸Šæ€§èƒ½åˆ†ææ’ä»¶ï¼š</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"dev"</span><span class="token punctuation">,</span><span class="token string">"test"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//æœ‰ä¸‰ç§ç¯å¢ƒï¼šdev : å¼€å‘ç¯å¢ƒï¼Œtest : æµ‹è¯•ç¯å¢ƒï¼Œ prod : ç”Ÿäº§ç¯å¢ƒ</span><span class="token keyword">public</span> <span class="token class-name">PerformanceInterceptor</span> <span class="token function">performanceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">PerformanceInterceptor</span> performanceInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    performanceInterceptor<span class="token punctuation">.</span><span class="token function">setMaxTime</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ms,è¶…è¿‡æ­¤å¤„è®¾ç½®çš„msåˆ™sqlä¸æ‰§è¡Œ</span>    performanceInterceptor<span class="token punctuation">.</span><span class="token function">setFormat</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> performanceInterceptor<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>Springbootä¸­è®¾ç½®devç¯å¢ƒ</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">spring.profiles.active=dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-æ­å»ºé¡¹ç›®"><a href="#3-æ­å»ºé¡¹ç›®" class="headerlink" title="3. æ­å»ºé¡¹ç›®"></a>3. æ­å»ºé¡¹ç›®</h2><h3 id="3-1æ¨¡å—è¯´æ˜"><a href="#3-1æ¨¡å—è¯´æ˜" class="headerlink" title="3.1æ¨¡å—è¯´æ˜"></a>3.1æ¨¡å—è¯´æ˜</h3><p><strong>guli-parentï¼šåœ¨çº¿æ•™å­¦æ ¹ç›®å½•ï¼ˆçˆ¶å·¥ç¨‹ï¼‰ï¼Œç®¡ç†å››ä¸ªå­æ¨¡å—ï¼š</strong></p><p>  <strong>canal-client</strong>ï¼šcanalæ•°æ®åº“è¡¨åŒæ­¥æ¨¡å—ï¼ˆç»Ÿè®¡åŒæ­¥æ•°æ®ï¼‰**</p><p>  <strong>common</strong>ï¼šå…¬å…±æ¨¡å—çˆ¶èŠ‚ç‚¹**</p><p>â€‹    common-utilï¼šå·¥å…·ç±»æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—éƒ½å¯ä»¥ä¾èµ–äºå®ƒ</p><p>â€‹    service-baseï¼šserviceæœåŠ¡çš„baseåŒ…ï¼ŒåŒ…å«serviceæœåŠ¡çš„å…¬å…±é…ç½®ç±»ï¼Œæ‰€æœ‰serviceæ¨¡å—ä¾èµ–äºå®ƒ</p><p>â€‹    spring-securityï¼šè®¤è¯ä¸æˆæƒæ¨¡å—ï¼Œéœ€è¦è®¤è¯æˆæƒçš„serviceæœåŠ¡ä¾èµ–äºå®ƒ</p><p>  <strong>infrastructure</strong>ï¼šåŸºç¡€æœåŠ¡æ¨¡å—çˆ¶èŠ‚ç‚¹**</p><p>â€‹    api-gatewayï¼šapiç½‘å…³æœåŠ¡</p><p>  <strong>service</strong>ï¼šapiæ¥å£æœåŠ¡çˆ¶èŠ‚ç‚¹**</p><blockquote><blockquote><blockquote><p>service-aclï¼šç”¨æˆ·æƒé™ç®¡ç†apiæ¥å£æœåŠ¡ï¼ˆç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†å’Œæƒé™ç®¡ç†ç­‰ï¼‰</p></blockquote></blockquote><blockquote><blockquote><p>service-cmsï¼šcms apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-eduï¼šæ•™å­¦ç›¸å…³apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-msmï¼šçŸ­ä¿¡apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-orderï¼šè®¢å•ç›¸å…³apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-ossï¼šé˜¿é‡Œäº‘oss apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-statisticsï¼šç»Ÿè®¡æŠ¥è¡¨apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-ucenterï¼šä¼šå‘˜apiæ¥å£æœåŠ¡</p></blockquote></blockquote><blockquote><blockquote><p>service-vodï¼šè§†é¢‘ç‚¹æ’­apiæ¥å£æœåŠ¡</p></blockquote></blockquote></blockquote><h3 id="3-2-çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–"><a href="#3-2-çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–" class="headerlink" title="3.2 çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–"></a>3.2 çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¾èµ–</h3><p>åœ¨<artifactid>èŠ‚ç‚¹åé¢æ·»åŠ pomç±»å‹</artifactid></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>guli-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ·»åŠ propertiesç¡®å®šä¾èµ–ç‰ˆæœ¬</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>guli.version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>guli.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis-plus.version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis-plus.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>velocity.version</span><span class="token punctuation">&gt;</span></span>2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>velocity.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swagger.version</span><span class="token punctuation">&gt;</span></span>2.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swagger.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun.oss.version</span><span class="token punctuation">&gt;</span></span>2.8.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun.oss.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jodatime.version</span><span class="token punctuation">&gt;</span></span>2.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jodatime.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>poi.version</span><span class="token punctuation">&gt;</span></span>3.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>poi.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-fileupload.version</span><span class="token punctuation">&gt;</span></span>1.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-fileupload.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-io.version</span><span class="token punctuation">&gt;</span></span>2.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-io.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>httpclient.version</span><span class="token punctuation">&gt;</span></span>4.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>httpclient.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jwt.version</span><span class="token punctuation">&gt;</span></span>0.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jwt.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-java-sdk-core.version</span><span class="token punctuation">&gt;</span></span>4.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-java-sdk-core.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-sdk-oss.version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-sdk-oss.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-java-sdk-vod.version</span><span class="token punctuation">&gt;</span></span>2.15.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-java-sdk-vod.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-java-vod-upload.version</span><span class="token punctuation">&gt;</span></span>1.4.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-java-vod-upload.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-sdk-vod-upload.version</span><span class="token punctuation">&gt;</span></span>1.4.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-sdk-vod-upload.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fastjson.version</span><span class="token punctuation">&gt;</span></span>1.2.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fastjson.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gson.version</span><span class="token punctuation">&gt;</span></span>2.8.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gson.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>json.version</span><span class="token punctuation">&gt;</span></span>20170516<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>json.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-dbutils.version</span><span class="token punctuation">&gt;</span></span>1.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-dbutils.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canal.client.version</span><span class="token punctuation">&gt;</span></span>1.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canal.client.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>docker.image.prefix</span><span class="token punctuation">&gt;</span></span>zx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>docker.image.prefix</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>0.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®<code>dependencyManagement</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--Spring Cloud--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>Hoxton.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${cloud-alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--mybatis-plus æŒä¹…å±‚--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mybatis-plus.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- velocity æ¨¡æ¿å¼•æ“, Mybatis Plus ä»£ç ç”Ÿæˆå™¨éœ€è¦ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>velocity-engine-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${velocity.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--swagger--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--swagger ui--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--aliyunOSS--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun.oss.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥æœŸæ—¶é—´å·¥å…·--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${jodatime.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--xls--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${poi.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--xlsx--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi-ooxml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${poi.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ–‡ä»¶ä¸Šä¼ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-fileupload.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--commons-io--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-io.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--httpclient--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${httpclient.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.code.gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${gson.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- JWT --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${jwt.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--aliyun--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-java-sdk-core.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-sdk-oss.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-vod<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-java-sdk-vod.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-vod-upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-java-vod-upload.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-vod-upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-sdk-vod-upload.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${fastjson.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${json.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-dbutils<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-dbutils<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-dbutils.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.otter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>canal.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${canal.client.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-å­æ¨¡å—service"><a href="#3-3-å­æ¨¡å—service" class="headerlink" title="3.3 å­æ¨¡å—service"></a>3.3 å­æ¨¡å—service</h3><ol><li>æ·»åŠ æ¨¡å—ç±»å‹æ˜¯pom</li></ol><p>artifactIdèŠ‚ç‚¹åé¢æ·»åŠ pomç±»å‹</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>service<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>æ·»åŠ ä¾èµ–</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-ribbon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--hystrixä¾èµ–ï¼Œä¸»è¦æ˜¯ç”¨  @HystrixCommand --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-hystrix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--æœåŠ¡æ³¨å†Œ--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--æœåŠ¡è°ƒç”¨--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--mybatis-plus--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--mysql--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- velocity æ¨¡æ¿å¼•æ“, Mybatis Plus ä»£ç ç”Ÿæˆå™¨éœ€è¦ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>velocity-engine-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--swagger--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--xls--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi-ooxml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--httpclient--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--commons-io--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--gson--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.code.gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4å¼€å‘è®²å¸ˆç®¡ç†æ¨¡å—"><a href="#3-4å¼€å‘è®²å¸ˆç®¡ç†æ¨¡å—" class="headerlink" title="3.4å¼€å‘è®²å¸ˆç®¡ç†æ¨¡å—"></a>3.4å¼€å‘è®²å¸ˆç®¡ç†æ¨¡å—</h3><ol><li><p>åˆ›å»ºapplication.propertiesæ–‡ä»¶</p></li><li><p>ç¼–å†™controllerã€ service ã€ mapper å†…å®¹</p></li></ol><p>mpæä¾›äº†ä»£ç ç”Ÿæˆå™¨ï¼Œç”Ÿæˆç›¸å…³ä»£ç </p><p><strong>resourcesç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ application.properties</strong></p><pre class="line-numbers language-none"><code class="language-none"># æœåŠ¡ç«¯å£server.port=8001# æœåŠ¡åspring.application.name=service-edu# ç¯å¢ƒè®¾ç½®ï¼šdevã€testã€prodspring.profiles.active=dev# mysqlæ•°æ®åº“è¿æ¥spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driverspring.datasource.url=jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8spring.datasource.username=rootspring.datasource.password=root#mybatisæ—¥å¿—mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><strong>æˆ–è€…åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ application.yml</strong></p> <pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># æœåŠ¡ç«¯å£</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8001</span><span class="token comment"># æœåŠ¡å</span><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">service-edu</span><span class="token comment"># ç¯å¢ƒè®¾ç½®ï¼šdevã€testã€prod</span><span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span><span class="token comment"># mysqlæ•°æ®åº“è¿æ¥</span><span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.cj.jdbc.Driver</span><span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span><span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">000</span><span class="token comment">#è¿”å›jsonçš„å…¨å±€æ—¶é—´æ ¼å¼</span><span class="token attr-name">spring.jackson.date-format</span><span class="token punctuation">=</span><span class="token attr-value">yyyy-MM-dd HH:mm:ss</span><span class="token attr-name">spring.jackson.time-zone</span><span class="token punctuation">=</span><span class="token attr-value">GMT+8</span><span class="token comment">#mybatisæ—¥å¿—</span><span class="token attr-name">mybatis-plus.configuration.log-impl</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.ibatis.logging.stdout.StdOutImpl</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#### application.yml</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> service<span class="token punctuation">-</span>edu<span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev<span class="token comment">####  application-dev.yml</span><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl<span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>com/atguigu/service/<span class="token important">*/mapper/*.xml</span><span class="token key atrule">global-config</span><span class="token punctuation">:</span>    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>      <span class="token key atrule">logic-delete-value</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token key atrule">spring</span><span class="token punctuation">:</span><span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource<span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver<span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/guli<span class="token punctuation">?</span>serverTimezone=GMT%2B8<span class="token key atrule">username</span><span class="token punctuation">:</span> root<span class="token key atrule">password</span><span class="token punctuation">:</span> root<span class="token key atrule">hikari</span><span class="token punctuation">:</span>      <span class="token key atrule">connection-test-query</span><span class="token punctuation">:</span> SELECT 1<span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">60000</span><span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">500000</span><span class="token key atrule">max-lifetime</span><span class="token punctuation">:</span> <span class="token number">540000</span><span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token key atrule">pool-name</span><span class="token punctuation">:</span> GuliHikariPool<span class="token key atrule">jackson</span><span class="token punctuation">:</span>    <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss<span class="token key atrule">time-zone</span><span class="token punctuation">:</span> GMT+8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-1-åˆ›å»ºMPä»£ç ç”Ÿæˆå™¨"><a href="#3-4-1-åˆ›å»ºMPä»£ç ç”Ÿæˆå™¨" class="headerlink" title="3.4.1 åˆ›å»ºMPä»£ç ç”Ÿæˆå™¨"></a>3.4.1 åˆ›å»ºMPä»£ç ç”Ÿæˆå™¨</h4><p>åœ¨test/javaç›®å½•ä¸‹åˆ›å»ºåŒ…<code>com.atguigu.eduservice</code>ï¼Œåˆ›å»ºä»£ç ç”Ÿæˆå™¨ï¼š<code>CodeGenerator.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> getCode <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">main1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 1ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨</span>        <span class="token class-name">AutoGenerator</span> mpg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutoGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2ã€å…¨å±€é…ç½®</span>        <span class="token class-name">GlobalConfig</span> gc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span><span class="token function">setOutputDir</span><span class="token punctuation">(</span>projectPath <span class="token operator">+</span> <span class="token string">"/src/main/java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span><span class="token function">setAuthor</span><span class="token punctuation">(</span><span class="token string">"atguigu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span><span class="token function">setOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç”Ÿæˆåæ˜¯å¦æ‰“å¼€èµ„æºç®¡ç†å™¨</span>        gc<span class="token punctuation">.</span><span class="token function">setFileOverride</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//é‡æ–°ç”Ÿæˆæ—¶æ–‡ä»¶æ˜¯å¦è¦†ç›–</span>        <span class="token comment">/*         * mpç”Ÿæˆserviceå±‚ä»£ç ï¼Œé»˜è®¤æ¥å£åç§°ç¬¬ä¸€ä¸ªå­—æ¯æœ‰ I         * UcenterService         * */</span>        gc<span class="token punctuation">.</span><span class="token function">setServiceName</span><span class="token punctuation">(</span><span class="token string">"%sService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å»æ‰Serviceæ¥å£çš„é¦–å­—æ¯I</span>        gc<span class="token punctuation">.</span><span class="token function">setIdType</span><span class="token punctuation">(</span><span class="token class-name">IdType</span><span class="token punctuation">.</span>ID_WORKER<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸»é”®ç­–ç•¥</span>        gc<span class="token punctuation">.</span><span class="token function">setDateType</span><span class="token punctuation">(</span><span class="token class-name">DateType</span><span class="token punctuation">.</span>ONLY_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å®šä¹‰ç”Ÿæˆçš„å®ä½“ç±»ä¸­æ—¥æœŸç±»å‹</span>        gc<span class="token punctuation">.</span><span class="token function">setSwagger2</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯Swagger2æ¨¡å¼</span>        mpg<span class="token punctuation">.</span><span class="token function">setGlobalConfig</span><span class="token punctuation">(</span>gc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3ã€æ•°æ®æºé…ç½®</span>        <span class="token class-name">DataSourceConfig</span> dsc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setDriverName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span><span class="token function">setDbType</span><span class="token punctuation">(</span><span class="token class-name">DbType</span><span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">;</span>        mpg<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dsc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4ã€åŒ…é…ç½®</span>        <span class="token class-name">PackageConfig</span> pc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PackageConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setModuleName</span><span class="token punctuation">(</span><span class="token string">"serviceedu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ¨¡å—å</span>        pc<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span><span class="token string">"com.atguigu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setController</span><span class="token punctuation">(</span><span class="token string">"controller"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span><span class="token string">"entity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setService</span><span class="token punctuation">(</span><span class="token string">"service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span><span class="token function">setMapper</span><span class="token punctuation">(</span><span class="token string">"mapper"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mpg<span class="token punctuation">.</span><span class="token function">setPackageInfo</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5ã€ç­–ç•¥é…ç½®</span>        <span class="token class-name">StrategyConfig</span> strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StrategyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        strategy<span class="token punctuation">.</span><span class="token function">setInclude</span><span class="token punctuation">(</span><span class="token string">"edu_teacher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        strategy<span class="token punctuation">.</span><span class="token function">setNaming</span><span class="token punctuation">(</span><span class="token class-name">NamingStrategy</span><span class="token punctuation">.</span>underline_to_camel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span>        strategy<span class="token punctuation">.</span><span class="token function">setTablePrefix</span><span class="token punctuation">(</span>pc<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç”Ÿæˆå®ä½“æ—¶å»æ‰è¡¨å‰ç¼€</span>        strategy<span class="token punctuation">.</span><span class="token function">setColumnNaming</span><span class="token punctuation">(</span><span class="token class-name">NamingStrategy</span><span class="token punctuation">.</span>underline_to_camel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span>        strategy<span class="token punctuation">.</span><span class="token function">setEntityLombokModel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lombok æ¨¡å‹ @Accessors(chain = true) setteré“¾å¼æ“ä½œ</span>        strategy<span class="token punctuation">.</span><span class="token function">setRestControllerStyle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//restful apié£æ ¼æ§åˆ¶å™¨</span>        strategy<span class="token punctuation">.</span><span class="token function">setControllerMappingHyphenStyle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//urlä¸­é©¼å³°è½¬è¿å­—ç¬¦</span>        mpg<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6ã€æ‰§è¡Œ</span>        mpg<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-2-ç¼–å†™åå°ç®¡ç†apiæ¥å£"><a href="#3-4-2-ç¼–å†™åå°ç®¡ç†apiæ¥å£" class="headerlink" title="3.4.2 ç¼–å†™åå°ç®¡ç†apiæ¥å£"></a>3.4.2 ç¼–å†™åå°ç®¡ç†apiæ¥å£</h4><p><strong>1ã€ç¼–å†™controllerä»£ç </strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> <span class="token class-name">TeacherService</span> teacherService<span class="token punctuation">;</span><span class="token annotation punctuation">@GetMapping</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2. åˆ›å»ºSpringBooté…ç½®ç±»</strong></p><p>åœ¨eduåŒ…ä¸‹åˆ›å»ºconfigåŒ…ï¼Œåˆ›å»ºMyBatisPlusConfig.java</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableTransactionManagement</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.atguigu.eduservice.mapper"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisPlusConfig</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>3ã€é…ç½®SQLæ‰§è¡Œæ€§èƒ½åˆ†ææ’ä»¶</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**     * SQL æ‰§è¡Œæ€§èƒ½åˆ†ææ’ä»¶     * å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼Œçº¿ä¸Šä¸æ¨èã€‚ maxTime æŒ‡çš„æ˜¯ sql æœ€å¤§æ‰§è¡Œæ—¶é•¿     */</span><span class="token annotation punctuation">@Bean</span><span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"dev"</span><span class="token punctuation">,</span><span class="token string">"test"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// è®¾ç½® dev test ç¯å¢ƒå¼€å¯</span><span class="token keyword">public</span> <span class="token class-name">PerformanceInterceptor</span> <span class="token function">performanceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">PerformanceInterceptor</span> performanceInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    performanceInterceptor<span class="token punctuation">.</span><span class="token function">setMaxTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//msï¼Œè¶…è¿‡æ­¤å¤„è®¾ç½®çš„msåˆ™sqlä¸æ‰§è¡Œ</span>    performanceInterceptor<span class="token punctuation">.</span><span class="token function">setFormat</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> performanceInterceptor<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-3-åˆ›å»ºSpringBootå¯åŠ¨ç±»"><a href="#3-4-3-åˆ›å»ºSpringBootå¯åŠ¨ç±»" class="headerlink" title="3.4.3 åˆ›å»ºSpringBootå¯åŠ¨ç±»**"></a>3.4.3 åˆ›å»ºSpringBootå¯åŠ¨ç±»**</h4><p>åˆ›å»ºå¯åŠ¨ç±» EduApplication.javaï¼Œæ³¨æ„å¯åŠ¨ç±»çš„åˆ›å»ºä½ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EduApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EduApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-4-è¿è¡Œå¯åŠ¨ç±»"><a href="#3-4-4-è¿è¡Œå¯åŠ¨ç±»" class="headerlink" title="3.4.4 è¿è¡Œå¯åŠ¨ç±»"></a>3.4.4 è¿è¡Œå¯åŠ¨ç±»</h4><p>è®¿é—®<a href="http://localhost:8001/eduservice/teacher">http://localhost:8001/eduservice/teacher</a></p><p>å¾—åˆ°jsonæ•°æ®</p><h4 id="3-4-5-ç»Ÿä¸€è¿”å›çš„jsonæ—¶é—´æ ¼å¼"><a href="#3-4-5-ç»Ÿä¸€è¿”å›çš„jsonæ—¶é—´æ ¼å¼" class="headerlink" title="3.4.5 ç»Ÿä¸€è¿”å›çš„jsonæ—¶é—´æ ¼å¼"></a>3.4.5 ç»Ÿä¸€è¿”å›çš„jsonæ—¶é—´æ ¼å¼</h4><p>é»˜è®¤æƒ…å†µä¸‹jsonæ—¶é—´æ ¼å¼å¸¦æœ‰æ—¶åŒºï¼Œå¹¶ä¸”æ˜¯ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œå’Œæˆ‘ä»¬çš„æ—¶é—´å·®äº†å…«ä¸ªå°æ—¶</p><p>åœ¨application.propertiesä¸­è®¾ç½®</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">#è¿”å›jsonçš„å…¨å±€æ—¶é—´æ ¼å¼spring.jackson.date-format=yyyy-MM-dd HH:mm:ssspring.jackson.time-zone=GMT+8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3-5-è®²å¸ˆé€»è¾‘åˆ é™¤"><a href="#3-5-è®²å¸ˆé€»è¾‘åˆ é™¤" class="headerlink" title="3.5 è®²å¸ˆé€»è¾‘åˆ é™¤"></a>3.5 è®²å¸ˆé€»è¾‘åˆ é™¤</h3><h4 id="3-5-1-EduTeacherControlleræ·»åŠ åˆ é™¤æ–¹æ³•"><a href="#3-5-1-EduTeacherControlleræ·»åŠ åˆ é™¤æ–¹æ³•" class="headerlink" title="3.5.1 EduTeacherControlleræ·»åŠ åˆ é™¤æ–¹æ³•"></a>3.5.1 EduTeacherControlleræ·»åŠ åˆ é™¤æ–¹æ³•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">removeById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-5-2-é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶"><a href="#3-5-2-é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶" class="headerlink" title="3.5.2 é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶"></a>3.5.2 é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶</h4><pre class="line-numbers language-none"><code class="language-none">MyBatisPlusConfigä¸­é…ç½®<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**      * é€»è¾‘åˆ é™¤æ’ä»¶      */</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">ISqlInjector</span> <span class="token function">sqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogicSqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-6-Swagger2ä»‹ç»"><a href="#3-6-Swagger2ä»‹ç»" class="headerlink" title="3.6 Swagger2ä»‹ç»"></a>3.6 Swagger2ä»‹ç»</h3><p>å‰åç«¯åˆ†ç¦»å¼€å‘æ¨¡å¼ä¸­ï¼Œapiæ–‡æ¡£æ˜¯æœ€å¥½çš„æ²Ÿé€šæ–¹å¼ã€‚</p><p>Swagger æ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼çš„ Web æœåŠ¡ã€‚</p><p>åŠæ—¶æ€§ (æ¥å£å˜æ›´åï¼Œèƒ½å¤ŸåŠæ—¶å‡†ç¡®åœ°é€šçŸ¥ç›¸å…³å‰åç«¯å¼€å‘äººå‘˜)è§„èŒƒæ€§ (å¹¶ä¸”ä¿è¯æ¥å£çš„è§„èŒƒæ€§ï¼Œå¦‚æ¥å£çš„åœ°å€ï¼Œè¯·æ±‚æ–¹å¼ï¼Œå‚æ•°åŠå“åº”æ ¼å¼å’Œé”™è¯¯ä¿¡æ¯)ä¸€è‡´æ€§ (æ¥å£ä¿¡æ¯ä¸€è‡´ï¼Œä¸ä¼šå‡ºç°å› å¼€å‘äººå‘˜æ‹¿åˆ°çš„æ–‡æ¡£ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œè€Œå‡ºç°åˆ†æ­§)å¯æµ‹æ€§ (ç›´æ¥åœ¨æ¥å£æ–‡æ¡£ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä»¥æ–¹ä¾¿ç†è§£ä¸šåŠ¡)</p><h4 id="3-6-1-é…ç½®Swagger2"><a href="#3-6-1-é…ç½®Swagger2" class="headerlink" title="3.6.1 é…ç½®Swagger2"></a>3.6.1 é…ç½®Swagger2</h4><p><strong>1ã€åˆ›å»ºcommonæ¨¡å—</strong></p><p><strong>åœ¨guli-parentä¸‹åˆ›å»ºæ¨¡å—common</strong></p><p>é…ç½®ï¼š</p><p><code>groupIdï¼šcom.atguigu</code></p><p><code>artifactIdï¼šcommon</code></p><p><img src="/2021/03/23/project/9a40d77c-6b22-4f24-a288-c76d1082f98d.png" alt="img"></p><p><strong>2ã€åœ¨commonä¸­å¼•å…¥ç›¸å…³ä¾èµ–</strong></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!--mybatis-plus--&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶--&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!--swagger--&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!-- redis --&gt;</span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2       &lt;dependency&gt;           &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;           &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;           &lt;version&gt;2.6.0&lt;/version&gt;       &lt;/dependency&gt;--&gt;</span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>3.åœ¨æ¨¡å—service-baseä¸­ï¼Œåˆ›å»ºswaggerçš„é…ç½®ç±»</strong></p><p>åˆ›å»ºåŒ…<code>com.atguigu.servicebase.config</code>ï¼Œåˆ›å»ºç±»<code>SwaggerConfig</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableSwagger2</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">webApiConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">groupName</span><span class="token punctuation">(</span><span class="token string">"webApi"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">webApiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">Predicates</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">"/admin/.*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">Predicates</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span><span class="token string">"/error.*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token keyword">private</span> <span class="token class-name">ApiInfo</span> <span class="token function">webApiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"ç½‘ç«™-è¯¾ç¨‹ä¸­å¿ƒAPIæ–‡æ¡£"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"æœ¬æ–‡æ¡£æè¿°äº†è¯¾ç¨‹ä¸­å¿ƒå¾®æœåŠ¡æ¥å£å®šä¹‰"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">contact</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token string">"Helen"</span><span class="token punctuation">,</span> <span class="token string">"http://atguigu.com"</span><span class="token punctuation">,</span> <span class="token string">"55317332@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>4ã€åœ¨æ¨¡å—serviceæ¨¡å—ä¸­å¼•å…¥service-base</strong></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>service-base<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>5ã€åœ¨service-eduå¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œè¿›è¡Œæµ‹è¯•</strong></p><p><img src="/2021/03/23/project/ef45a37b-8f5b-480e-9d85-e25bf5bdd3ce.png" alt="img"></p><h4 id="3-6-2-APIæ¨¡å‹"><a href="#3-6-2-APIæ¨¡å‹" class="headerlink" title="3.6.2 APIæ¨¡å‹"></a>3.6.2 APIæ¨¡å‹</h4><p>å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå®šä¹‰è®¾ç½®ï¼Œä¾‹å¦‚ï¼š</p><p>å®šä¹‰æ ·ä¾‹æ•°æ®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ›å»ºæ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-01-01 8:00:00"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> gmtCreate<span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ›´æ–°æ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-01-01 8:00:00"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT_UPDATE<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> gmtModified<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/03/23/project/9c17851c-8e7e-4161-968c-18b36faf148a.png" alt="img"></p><h4 id="3-6-3-å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜"><a href="#3-6-3-å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜" class="headerlink" title="3.6.3 å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜"></a>3.6.3 å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜</h4><p>å®šä¹‰åœ¨ç±»ä¸Šï¼š@Api</p><p>å®šä¹‰åœ¨æ–¹æ³•ä¸Šï¼š@ApiOperation</p><p>å®šä¹‰åœ¨å‚æ•°ä¸Šï¼š@ApiParam</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"è®²å¸ˆç®¡ç†"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/admin/edu/teacher"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherAdminController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">TeacherService</span> teacherService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ‰€æœ‰è®²å¸ˆåˆ—è¡¨"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@GetMapping</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®IDåˆ é™¤è®²å¸ˆ"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">removeById</span><span class="token punctuation">(</span>            <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>            <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-7-ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼"><a href="#3-7-ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼" class="headerlink" title="3.7 ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼"></a>3.7 ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼</h3><p>é¡¹ç›®ä¸­æˆ‘ä»¬ä¼šå°†å“åº”å°è£…æˆ<code>json</code>è¿”å›ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°†æ‰€æœ‰æ¥å£çš„æ•°æ®æ ¼å¼ç»Ÿä¸€ï¼Œ ä½¿å‰ç«¯(iOS Android, Web)å¯¹æ•°æ®çš„æ“ä½œæ›´ä¸€è‡´ã€è½»æ¾ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼æ²¡æœ‰å›ºå®šçš„æ ¼å¼ï¼Œåªè¦èƒ½æè¿°æ¸…æ¥šè¿”å›çš„æ•°æ®çŠ¶æ€ä»¥åŠè¦è¿”å›çš„å…·ä½“æ•°æ®å°±å¯ä»¥ã€‚ä½†æ˜¯ä¸€èˆ¬ä¼šåŒ…å«çŠ¶æ€ç ã€è¿”å›æ¶ˆæ¯ã€æ•°æ®è¿™å‡ éƒ¨åˆ†å†…å®¹</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¦æ±‚è¿”å›çš„åŸºæœ¬æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p><p><strong>åˆ—è¡¨ï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"åˆ˜å¾·å"</span><span class="token punctuation">,</span>        <span class="token property">"intro"</span><span class="token operator">:</span> <span class="token string">"æ¯•ä¸šäºå¸ˆèŒƒå¤§å­¦æ•°å­¦ç³»ï¼Œçƒ­çˆ±æ•™è‚²äº‹ä¸šï¼Œæ‰§æ•™æ•°å­¦æ€ç»´6å¹´æœ‰ä½™"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>åˆ†é¡µï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span>    <span class="token property">"rows"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"åˆ˜å¾·å"</span><span class="token punctuation">,</span>        <span class="token property">"intro"</span><span class="token operator">:</span> <span class="token string">"æ¯•ä¸šäºå¸ˆèŒƒå¤§å­¦æ•°å­¦ç³»ï¼Œçƒ­çˆ±æ•™è‚²äº‹ä¸šï¼Œæ‰§æ•™æ•°å­¦æ€ç»´6å¹´æœ‰ä½™"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ²¡æœ‰è¿”å›æ•°æ®ï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¤±è´¥ï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">20001</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"å¤±è´¥"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ç»Ÿä¸€ç»“æœ</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"success"</span><span class="token operator">:</span> å¸ƒå°”<span class="token punctuation">,</span> <span class="token comment">//å“åº”æ˜¯å¦æˆåŠŸ</span>  <span class="token property">"code"</span><span class="token operator">:</span> æ•°å­—<span class="token punctuation">,</span> <span class="token comment">//å“åº”ç </span>  <span class="token property">"message"</span><span class="token operator">:</span> å­—ç¬¦ä¸²<span class="token punctuation">,</span> <span class="token comment">//è¿”å›æ¶ˆæ¯</span>  <span class="token property">"data"</span><span class="token operator">:</span> HashMap <span class="token comment">//è¿”å›æ•°æ®ï¼Œæ”¾åœ¨é”®å€¼å¯¹ä¸­</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-7-2-åˆ›å»ºç»Ÿä¸€ç»“æœè¿”å›ç±»"><a href="#3-7-2-åˆ›å»ºç»Ÿä¸€ç»“æœè¿”å›ç±»" class="headerlink" title="3.7.2 åˆ›å»ºç»Ÿä¸€ç»“æœè¿”å›ç±»"></a>3.7.2 åˆ›å»ºç»Ÿä¸€ç»“æœè¿”å›ç±»</h4><p><strong>1ã€åœ¨commonæ¨¡å—ä¸‹åˆ›å»ºå­æ¨¡å—common-utils</strong></p><p><img src="/2021/03/23/project/3f2fb002-8f7c-47aa-aaf0-71da156e1b20.png" alt="img"></p><p><strong>2ã€åˆ›å»ºæ¥å£å®šä¹‰è¿”å›ç </strong></p><p><strong>åˆ›å»ºåŒ…com.atguigu.commonutilsï¼Œåˆ›å»ºæ¥å£ ResultCode.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>commonutils</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResultCode</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> SUCCESS <span class="token operator">=</span> <span class="token number">20000</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> ERROR <span class="token operator">=</span> <span class="token number">20001</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>3ã€åˆ›å»ºç»“æœç±»</strong></p><p><strong>åˆ›å»ºç±» R.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">R</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ˜¯å¦æˆåŠŸ"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> success<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è¿”å›ç "</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è¿”å›æ¶ˆæ¯"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è¿”å›æ•°æ®"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">R</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResultCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> r<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResultCode</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">"å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> r<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span> success<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">code</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>äºŒã€ç»Ÿä¸€è¿”å›ç»“æœä½¿ç”¨</p><p>1ã€åœ¨serviceæ¨¡å—ä¸­æ·»åŠ ä¾èµ–</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>common_utils<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€ä¿®æ”¹Controllerä¸­çš„è¿”å›ç»“æœ</p><p>åˆ—è¡¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ‰€æœ‰è®²å¸ˆåˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"items"</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®IDåˆ é™¤è®²å¸ˆ"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">removeById</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>    teacherService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-8-åˆ†é¡µ"><a href="#3-8-åˆ†é¡µ" class="headerlink" title="3.8 åˆ†é¡µ"></a>3.8 åˆ†é¡µ</h3><h4 id="3-8-1-MyBatisPlusConfigä¸­é…ç½®åˆ†é¡µæ’ä»¶"><a href="#3-8-1-MyBatisPlusConfigä¸­é…ç½®åˆ†é¡µæ’ä»¶" class="headerlink" title="3.8.1 MyBatisPlusConfigä¸­é…ç½®åˆ†é¡µæ’ä»¶"></a>3.8.1 MyBatisPlusConfigä¸­é…ç½®åˆ†é¡µæ’ä»¶</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * åˆ†é¡µæ’ä»¶ */</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">PaginationInterceptor</span> <span class="token function">paginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-8-2-åˆ†é¡µControlleræ–¹æ³•"><a href="#3-8-2-åˆ†é¡µControlleræ–¹æ³•" class="headerlink" title="3.8.2 åˆ†é¡µControlleræ–¹æ³•"></a>3.8.2 åˆ†é¡µControlleræ–¹æ³•</h4><p><code>TeacherAdminController</code>ä¸­æ·»åŠ åˆ†é¡µæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ†é¡µè®²å¸ˆåˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{page}/{limit}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">pageList</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"å½“å‰é¡µç "</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> page<span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"limit"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"æ¯é¡µè®°å½•æ•°"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> limit<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> pageParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">;</span>    teacherService<span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> total <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span>  <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"total"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"rows"</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€Swaggerä¸­æµ‹è¯•</p><h3 id="3-9-æ¡ä»¶æŸ¥è¯¢"><a href="#3-9-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="3.9 æ¡ä»¶æŸ¥è¯¢"></a>3.9 æ¡ä»¶æŸ¥è¯¢</h3><p>æ ¹æ®è®²å¸ˆåç§°nameï¼Œè®²å¸ˆå¤´è¡”levelã€è®²å¸ˆå…¥é©»æ—¶é—´gmt_createï¼ˆæ—¶é—´æ®µï¼‰æŸ¥è¯¢</p><h4 id="3-9-1-åˆ›å»ºæŸ¥è¯¢å¯¹è±¡"><a href="#3-9-1-åˆ›å»ºæŸ¥è¯¢å¯¹è±¡" class="headerlink" title="3.9.1 åˆ›å»ºæŸ¥è¯¢å¯¹è±¡"></a>3.9.1 åˆ›å»ºæŸ¥è¯¢å¯¹è±¡</h4><p>åˆ›å»º<code>com.guli.edu.query</code>åŒ…ï¼Œåˆ›å»º<code>TeacherQuery.java</code>æŸ¥è¯¢å¯¹è±¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>query</span><span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"TeacheræŸ¥è¯¢å¯¹è±¡"</span><span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">"è®²å¸ˆæŸ¥è¯¢å¯¹è±¡å°è£…"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherQuery</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ•™å¸ˆåç§°,æ¨¡ç³ŠæŸ¥è¯¢"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"å¤´è¡” 1é«˜çº§è®²å¸ˆ 2é¦–å¸­è®²å¸ˆ"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> level<span class="token punctuation">;</span>        <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æŸ¥è¯¢å¼€å§‹æ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-01-01 10:10:10"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> begin<span class="token punctuation">;</span><span class="token comment">//æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯Stringç±»å‹ï¼Œå‰ç«¯ä¼ è¿‡æ¥çš„æ•°æ®æ— éœ€è¿›è¡Œç±»å‹è½¬æ¢</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æŸ¥è¯¢ç»“æŸæ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-12-01 10:10:10"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> end<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-9-2-service"><a href="#3-9-2-service" class="headerlink" title="3.9.2 service"></a>3.9.2 service</h4><p>æ¥å£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TeacherService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">pageQuery</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> pageParam<span class="token punctuation">,</span> <span class="token class-name">TeacherQuery</span> teacherQuery<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TeacherMapper</span><span class="token punctuation">,</span> <span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">TeacherService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pageQuery</span><span class="token punctuation">(</span><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> pageParam<span class="token punctuation">,</span> <span class="token class-name">TeacherQuery</span> teacherQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        queryWrapper<span class="token punctuation">.</span><span class="token function">orderByAsc</span><span class="token punctuation">(</span><span class="token string">"sort"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>teacherQuery <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            baseMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> teacherQuery<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> level <span class="token operator">=</span> teacherQuery<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> begin <span class="token operator">=</span> teacherQuery<span class="token punctuation">.</span><span class="token function">getBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> end <span class="token operator">=</span> teacherQuery<span class="token punctuation">.</span><span class="token function">getEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            queryWrapper<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"level"</span><span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            queryWrapper<span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span><span class="token string">"gmt_create"</span><span class="token punctuation">,</span> begin<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            queryWrapper<span class="token punctuation">.</span><span class="token function">le</span><span class="token punctuation">(</span><span class="token string">"gmt_create"</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        baseMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-9-3-controller"><a href="#3-9-3-controller" class="headerlink" title="3.9.3 controller"></a>3.9.3 controller</h4><p>TeacherAdminControllerä¸­ä¿®æ”¹ pageListæ–¹æ³•ï¼š</p><p>å¢åŠ å‚æ•°TeacherQuery teacherQueryï¼Œéå¿…é€‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ†é¡µè®²å¸ˆåˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{page}/{limit}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">pageQuery</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"å½“å‰é¡µç "</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> page<span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"limit"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"æ¯é¡µè®°å½•æ•°"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> limit<span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacherQuery"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"æŸ¥è¯¢å¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token class-name">TeacherQuery</span> teacherQuery<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> pageParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">;</span>    teacherService<span class="token punctuation">.</span><span class="token function">pageQuery</span><span class="token punctuation">(</span>pageParam<span class="token punctuation">,</span> teacherQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Teacher</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> total <span class="token operator">=</span> pageParam<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span>  <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"total"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"rows"</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-9-4-Swaggerä¸­æµ‹è¯•"><a href="#3-9-4-Swaggerä¸­æµ‹è¯•" class="headerlink" title="3.9.4 Swaggerä¸­æµ‹è¯•"></a>3.9.4 Swaggerä¸­æµ‹è¯•</h4><p>ä¸€ã€è‡ªåŠ¨å¡«å……å°è£…</p><p>1ã€åœ¨service-baseæ¨¡å—ä¸­æ·»åŠ </p><p><strong>åˆ›å»ºåŒ…handlerï¼Œåˆ›å»ºè‡ªåŠ¨å¡«å……ç±» MyMetaObjectHandler</strong> </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMetaObjectHandler</span> <span class="token keyword">implements</span> <span class="token class-name">MetaObjectHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtCreate"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtModified"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"gmtModified"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€åœ¨å®ä½“ç±»æ·»åŠ è‡ªåŠ¨å¡«å……æ³¨è§£</p><p><img src="/2021/03/23/project/91054b5b-c478-4ba3-86f5-95f465210b39.png" alt="img"></p><p><strong>äºŒã€controlleræ–¹æ³•å®šä¹‰</strong></p><p>1ã€æ–°å¢ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ–°å¢è®²å¸ˆ"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PostMapping</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacher"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆå¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span><span class="token punctuation">{</span>    teacherService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€æ ¹æ®idæŸ¥è¯¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®IDæŸ¥è¯¢è®²å¸ˆ"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getById</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">Teacher</span> teacher <span class="token operator">=</span> teacherService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"item"</span><span class="token punctuation">,</span> teacher<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€æ ¹æ®idä¿®æ”¹ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®IDä¿®æ”¹è®²å¸ˆ"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">updateById</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆID"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"teacher"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"è®²å¸ˆå¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span><span class="token punctuation">{</span>    teacher<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    teacherService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-10-ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#3-10-ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="3.10 ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>3.10 ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h3><p><strong>1ã€åˆ¶é€ å¼‚å¸¸</strong></p><p>é™¤ä»¥0 </p><pre class="line-numbers language-none"><code class="language-none">int a = 10/0;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/03/23/project/42cfc6ab-afaf-4516-8b67-d1e198277567.png" alt="img"></p><p>æˆ‘ä»¬æƒ³è®©å¼‚å¸¸ç»“æœä¹Ÿæ˜¾ç¤ºä¸ºç»Ÿä¸€çš„è¿”å›ç»“æœå¯¹è±¡ï¼Œå¹¶ä¸”ç»Ÿä¸€å¤„ç†ç³»ç»Ÿçš„å¼‚å¸¸ä¿¡æ¯ï¼Œé‚£ä¹ˆéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†</p><p><strong>1ã€åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨</strong></p><p>åœ¨service-baseä¸­åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»GlobalExceptionHandler.javaï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±» */</span><span class="token annotation punctuation">@ControllerAdvice</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2ã€æµ‹è¯•</strong> </p><p>è¿”å›ç»Ÿä¸€é”™è¯¯ç»“æœ</p><p><img src="/2021/03/23/project/c54eac64-d736-4dc4-9923-fb85f87d31a2.png" alt="img"></p><p>å¤„ç†ç‰¹å®šå¼‚å¸¸</p><p><strong>1ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•</strong> </p><p>GlobalExceptionHandler.javaä¸­æ·»åŠ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†è‡ªå®šä¹‰å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2ã€æµ‹è¯•</strong></p><p><img src="/2021/03/23/project/2b02cb8f-53fd-4847-a5ad-10e134c44f28.png" alt="img"></p><p><strong>å››ã€è‡ªå®šä¹‰å¼‚å¸¸</strong></p><p>1ã€åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GuliException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"çŠ¶æ€ç "</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€ä¸šåŠ¡ä¸­éœ€è¦çš„ä½ç½®æŠ›å‡ºGuliException</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GuliException</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token string">"å‡ºç°è‡ªå®šä¹‰å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•</p><p>GlobalExceptionHandler.javaä¸­æ·»åŠ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">GuliException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">GuliException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4ã€æµ‹è¯• </p><p><img src="/2021/03/23/project/f3c5a449-4984-4d35-9f25-35d43197a3e8.png" alt="img"></p><h3 id="3-11-ç»Ÿä¸€æ—¥å¿—å¤„ç†"><a href="#3-11-ç»Ÿä¸€æ—¥å¿—å¤„ç†" class="headerlink" title="3.11 ç»Ÿä¸€æ—¥å¿—å¤„ç†"></a>3.11 ç»Ÿä¸€æ—¥å¿—å¤„ç†</h3><p>1ã€é…ç½®æ—¥å¿—çº§åˆ«</p><p>æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰çš„è¡Œä¸ºæ˜¯åˆ†ç­‰çº§çš„ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p>åˆ†ä¸ºï¼šOFFã€FATALã€ERRORã€WARNã€INFOã€DEBUGã€ALL</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œspring bootä»æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ—¥å¿—çº§åˆ«åªæœ‰INFOåŠä»¥ä¸Šçº§åˆ«ï¼Œå¯ä»¥é…ç½®æ—¥å¿—çº§åˆ« </p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"># è®¾ç½®æ—¥å¿—çº§åˆ«logging.level.root=WARN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹å¼åªèƒ½å°†æ—¥å¿—æ‰“å°åœ¨æ§åˆ¶å°ä¸Š</p><p>äºŒã€Logbackæ—¥å¿—</p><p>spring bootå†…éƒ¨ä½¿ç”¨Logbackä½œä¸ºæ—¥å¿—å®ç°çš„æ¡†æ¶ã€‚</p><p>Logbackå’Œlog4jéå¸¸ç›¸ä¼¼ï¼Œå¦‚æœä½ å¯¹log4jå¾ˆç†Ÿæ‚‰ï¼Œé‚£å¯¹logbackå¾ˆå¿«å°±ä¼šå¾—å¿ƒåº”æ‰‹ã€‚</p><p>logbackç›¸å¯¹äºlog4jçš„ä¸€äº›ä¼˜ç‚¹ï¼š<a href="https://blog.csdn.net/caisini_vc/article/details/48551287">https://blog.csdn.net/caisini_vc/article/details/48551287</a></p><p>1ã€é…ç½®logbackæ—¥å¿—</p><p>åˆ é™¤application.propertiesä¸­çš„æ—¥å¿—é…ç½®</p><p>å®‰è£…ideaå½©è‰²æ—¥å¿—æ’ä»¶ï¼šgrep-console</p><p>resources ä¸­åˆ›å»º logback-spring.xml  </p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span>  <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10 seconds<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜åˆ†ä¸ºTRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATALï¼Œå¦‚æœè®¾ç½®ä¸ºWARNï¼Œåˆ™ä½äºWARNçš„ä¿¡æ¯éƒ½ä¸ä¼šè¾“å‡º --&gt;</span>    <span class="token comment">&lt;!-- scan:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrue --&gt;</span>    <span class="token comment">&lt;!-- scanPeriod:è®¾ç½®ç›‘æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚ --&gt;</span>    <span class="token comment">&lt;!-- debug:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextName</span><span class="token punctuation">&gt;</span></span>logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextName</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- nameçš„å€¼æ˜¯å˜é‡çš„åç§°ï¼Œvalueçš„å€¼æ—¶å˜é‡å®šä¹‰çš„å€¼ã€‚é€šè¿‡å®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ã€‚å®šä¹‰å˜é‡åï¼Œå¯ä»¥ä½¿â€œ${}â€æ¥ä½¿ç”¨å˜é‡ã€‚ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log.path<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>D:/guli_log/edu<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- å½©è‰²æ—¥å¿— --&gt;</span>    <span class="token comment">&lt;!-- é…ç½®æ ¼å¼å˜é‡ï¼šCONSOLE_LOG_PATTERN å½©è‰²æ—¥å¿—æ ¼å¼ --&gt;</span>    <span class="token comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span>    <span class="token comment">&lt;!-- boldMagenta:ç²—çº¢--&gt;</span>    <span class="token comment">&lt;!-- cyan:é’è‰² --&gt;</span>    <span class="token comment">&lt;!-- white:ç™½è‰² --&gt;</span>    <span class="token comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE_LOG_PATTERN<span class="token punctuation">"</span></span>              <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%yellow(%date{yyyy-MM-dd HH:mm:ss}) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ­¤æ—¥å¿—appenderæ˜¯ä¸ºå¼€å‘ä½¿ç”¨ï¼Œåªé…ç½®æœ€åº•çº§åˆ«ï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çº§åˆ«æ˜¯å¤§äºæˆ–ç­‰äºæ­¤çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯--&gt;</span>        <span class="token comment">&lt;!-- ä¾‹å¦‚ï¼šå¦‚æœæ­¤å¤„é…ç½®äº†INFOçº§åˆ«ï¼Œåˆ™åé¢å…¶ä»–ä½ç½®å³ä½¿é…ç½®äº†DEBUGçº§åˆ«çš„æ—¥å¿—ï¼Œä¹Ÿä¸ä¼šè¢«è¾“å‡º --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pattern</span><span class="token punctuation">&gt;</span></span>${CONSOLE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- è®¾ç½®å­—ç¬¦é›† --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span>    <span class="token comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º INFO æ—¥å¿— --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log_info.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- æ¯å¤©æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log.path}/info/log-info-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•infoçº§åˆ«çš„ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º WARN æ—¥å¿— --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log_warn.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log.path}/warn/log-warn-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•warnçº§åˆ«çš„ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>warn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º ERROR æ—¥å¿— --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log_error.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log.path}/error/log-error-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•ERRORçº§åˆ«çš„ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--        &lt;logger&gt;ç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ã€ä»¥åŠæŒ‡å®š&lt;appender&gt;ã€‚        &lt;logger&gt;ä»…æœ‰ä¸€ä¸ªnameå±æ€§ï¼Œ        ä¸€ä¸ªå¯é€‰çš„levelå’Œä¸€ä¸ªå¯é€‰çš„addtivityå±æ€§ã€‚        name:ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»ã€‚        level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œ              å¦‚æœæœªè®¾ç½®æ­¤å±æ€§ï¼Œé‚£ä¹ˆå½“å‰loggerå°†ä¼šç»§æ‰¿ä¸Šçº§çš„çº§åˆ«ã€‚    --&gt;</span>    <span class="token comment">&lt;!--        ä½¿ç”¨mybatisçš„æ—¶å€™ï¼Œsqlè¯­å¥æ˜¯debugä¸‹æ‰ä¼šæ‰“å°ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬åªé…ç½®äº†infoï¼Œæ‰€ä»¥æƒ³è¦æŸ¥çœ‹sqlè¯­å¥çš„è¯ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š        ç¬¬ä¸€ç§æŠŠ&lt;root level="INFO"&gt;æ”¹æˆ&lt;root level="DEBUG"&gt;è¿™æ ·å°±ä¼šæ‰“å°sqlï¼Œä¸è¿‡è¿™æ ·æ—¥å¿—é‚£è¾¹ä¼šå‡ºç°å¾ˆå¤šå…¶ä»–æ¶ˆæ¯        ç¬¬äºŒç§å°±æ˜¯å•ç‹¬ç»™mapperä¸‹ç›®å½•é…ç½®DEBUGæ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹ï¼Œè¿™æ ·é…ç½®sqlè¯­å¥ä¼šæ‰“å°ï¼Œå…¶ä»–è¿˜æ˜¯æ­£å¸¸DEBUGçº§åˆ«ï¼š     --&gt;</span>    <span class="token comment">&lt;!--å¼€å‘ç¯å¢ƒ:æ‰“å°æ§åˆ¶å°--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dev<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--å¯ä»¥è¾“å‡ºé¡¹ç›®ä¸­çš„debugæ—¥å¿—ï¼ŒåŒ…æ‹¬mybatisçš„sqlæ—¥å¿—--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.guli<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>        <span class="token comment">&lt;!--            rootèŠ‚ç‚¹æ˜¯å¿…é€‰èŠ‚ç‚¹ï¼Œç”¨æ¥æŒ‡å®šæœ€åŸºç¡€çš„æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œåªæœ‰ä¸€ä¸ªlevelå±æ€§            level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œé»˜è®¤æ˜¯DEBUG            å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªappenderå…ƒç´ ã€‚        --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--ç”Ÿäº§ç¯å¢ƒ:è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pro<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DEBUG_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>å°†é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶</li></ol><p>GlobalExceptionHandler.java ä¸­</p><p>ç±»ä¸Šæ·»åŠ æ³¨è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼‚å¸¸è¾“å‡ºè¯­å¥</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>å°†æ—¥å¿—å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶</li></ol><p>å®šä¹‰å·¥å…·ç±»</p><p>guli-framework-commonä¸‹åˆ›å»ºutilåŒ…ï¼Œåˆ›å»ºExceptionUtil.javaå·¥å…·ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>guli<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionUtil</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">StringWriter</span> sw <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">PrintWriter</span> pw <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            sw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            pw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>sw<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å°†å‡ºé”™çš„æ ˆä¿¡æ¯è¾“å‡ºåˆ°printWriterä¸­</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span>pw<span class="token punctuation">)</span><span class="token punctuation">;</span>            pw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>sw <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    sw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>pw <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                pw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> sw<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>GuliExceptionä¸­åˆ›å»ºtoStringæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"GuliException{"</span> <span class="token operator">+</span>        <span class="token string">"message="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>        <span class="token string">", code="</span> <span class="token operator">+</span> code <span class="token operator">+</span>        <span class="token string">'}'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-å‰ç«¯"><a href="#4-å‰ç«¯" class="headerlink" title="4. å‰ç«¯"></a>4. å‰ç«¯</h2><h2 id="å…¶ä»–çŸ¥è¯†"><a href="#å…¶ä»–çŸ¥è¯†" class="headerlink" title="å…¶ä»–çŸ¥è¯†"></a>å…¶ä»–çŸ¥è¯†</h2><h3 id="1-ä¸»é”®çš„ç”Ÿæˆç­–ç•¥"><a href="#1-ä¸»é”®çš„ç”Ÿæˆç­–ç•¥" class="headerlink" title="1.ä¸»é”®çš„ç”Ÿæˆç­–ç•¥"></a>1.ä¸»é”®çš„ç”Ÿæˆç­–ç•¥</h3><ol><li>è‡ªåŠ¨å¢é•¿ </li></ol><p>åœ¨MYSQLä¸­æ˜¯AUTO_INCREMENTã€‚åœ¨åˆ†è¡¨ä¸­ï¼Œæ¯”å¦‚å°†ç”¨æˆ·æ•°æ®æ”¾å…¥3å¼ è¡¨ä¸­ï¼Œä¸‹ä¸€å¼ è¡¨éœ€è¦å¾—åˆ°ä¸Šä¸€å¼ è¡¨çš„æœ€åä¸€ä¸ªå€¼åŠ 1æ‰èƒ½è‡ªåŠ¨å¢é•¿ã€‚</p><ol start="2"><li>UUID </li></ol><p>æ¯æ¬¡ç”Ÿæˆéšæœºå”¯ä¸€çš„ä¸€ä¸ªå€¼ã€‚ä½†æ˜¯æ’åºä¸æ–¹ä¾¿ï¼Œä¸å¥½ç´¢å¼•ã€‚</p><ol start="3"><li>Redisç”ŸæˆIDã€‚</li><li>mpä¸­è‡ªå¸¦ç­–ç•¥</li></ol><p>ä½¿ç”¨snowflakeç®—æ³•ç”Ÿæˆã€‚19ä½idã€‚10bitä½œä¸ºæœºå™¨çš„IDï¼ˆ5bitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5bitæ˜¯æœºå™¨IDï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’å†…çš„æµæ°´å·ï¼Œæœ€åè¿˜æœ‰ç¬¦å·ä½ï¼Œæ°¸è¿œæ˜¯0ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type<span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>IdType</code>çš„ç±»å‹<code>AUTO</code>â€”â€”è‡ªåŠ¨å¢é•¿ã€<code>ID_WORKER</code>â€”â€”ç”Ÿæˆ19ä½å€¼ï¼Œæ•°å­—ç±»å‹ä½¿ç”¨è¿™ç§ç±»å‹ï¼Œæ¯”å¦‚longã€<code>ID_WORKER_STR</code>â€”â€”ç”Ÿæˆ19ä½å€¼ï¼Œå­—ç¬¦ä¸²ç±»å‹ä½¿ç”¨è¿™ç§ç±»å‹ï¼Œæ¯”å¦‚Stringã€<code>INPUTâ€”â€”è®¾ç½®idå€¼</code>ã€<code>NONEï¼šè¾“å…¥</code>ã€<code>UUID</code>â€”â€”éšæœºå”¯ä¸€å€¼ã€‚</p><h3 id="2-è‡ªåŠ¨å¡«å……"><a href="#2-è‡ªåŠ¨å¡«å……" class="headerlink" title="2.è‡ªåŠ¨å¡«å……"></a>2.è‡ªåŠ¨å¡«å……</h3><p>ä¸éœ€è¦setåˆ°å¯¹è±¡é‡Œé¢çš„å€¼ï¼Œä½¿ç”¨mqæ–¹å¼å®ç°æ•°æ®æ·»åŠ ã€‚</p><ol><li>åœ¨å®ä½“ç±»è‡ªåŠ¨å¡«å……å±æ€§ä¸Šæ·»åŠ æ³¨è§£ï¼š</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill<span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span>INSERT_UPDATE<span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>è‡ªå®šä¹‰å®ç°ç±»ï¼Œå®ç°æ¥å£<code>MetaObjectHandler</code>å’Œæ¥å£çš„æ–¹æ³•</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMetaObjectHandler</span> <span class="token keyword">implements</span> <span class="token class-name">MetaObjectHandler</span> <span class="token punctuation">{</span>    <span class="token comment">//ä½¿ç”¨mqå®ç°æ·»åŠ æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œ</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"createTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//ä½¿ç”¨mqå®ç°ä¿®æ”¹æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œ</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateFill</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFieldValByName</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metaObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-ä¹è§‚é”"><a href="#3-ä¹è§‚é”" class="headerlink" title="3.ä¹è§‚é”"></a>3.ä¹è§‚é”</h3><p>è§£å†³ä¸¢å¤±æ›´æ–°é—®é¢˜ï¼ˆå¤šä¸ªäººåŒæ—¶ä¿®æ”¹åŒä¸€æ¡è®°å½•ï¼Œæœ€åæäº¤çš„æŠŠä¹‹å‰æäº¤çš„æ•°æ®è¦†ç›–ï¼‰ã€‚</p><p>ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼š</p><ol><li>å–å‡ºè®°å½•æ—¶ï¼Œè·å–å½“å‰çš„versionã€‚</li><li>æ›´æ–°æ—¶ï¼Œå¸¦ä¸Šè¿™ä¸ªversionã€‚</li><li>æ‰§è¡Œæ›´æ–°æ—¶ï¼Œ<code>set version = newVersion where version = oldVersion</code></li><li>å¦‚æœversionä¸å¯¹ï¼Œå°±æ›´æ–°å¤±è´¥ã€‚</li></ol><p>ä»£ç ä¸­çš„å®ç°ï¼š</p><ol><li>è¡¨ä¸­åŠ å­—æ®µversion</li></ol><ol start="2"><li>ç±»ä¸­åŠ å±æ€§versionï¼Œå¹¶ä¸”æ·»åŠ <code>@Version</code>æ³¨è§£</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Version</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> version<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>é…ç½®ä¹è§‚é”æ’ä»¶</li></ol><h3 id="4-åˆ†é¡µæŸ¥è¯¢"><a href="#4-åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="4.åˆ†é¡µæŸ¥è¯¢"></a>4.åˆ†é¡µæŸ¥è¯¢</h3><ol><li>é…ç½®åˆ†é¡µæ’ä»¶</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//åˆ†é¡µæ’ä»¶</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">PaginationInterceptor</span> <span class="token function">paginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ç¼–å†™åˆ†é¡µä»£ç </li></ol><p>ç›´æ¥new pageå¯¹è±¡ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•°ã€‚è°ƒå…¥mpæ–¹æ³•å®ç°åˆ†é¡µæŸ¥è¯¢ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//ç¬¬ä¸€ä¸ªå‚æ•° å½“å‰é¡µ ç¬¬äºŒä¸ª æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</span>    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è°ƒç”¨mpåˆ†é¡µæŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œåº•å±‚å°è£…æŠŠåˆ†é¡µæ‰€æœ‰æ•°æ®å°è£…åˆ°pageå¯¹è±¡é‡Œé¢ã€‚</span>    userMaper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//é€šè¿‡pageå¯¹è±¡è·å–æ‰€æœ‰æ•°æ®</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-é€»è¾‘åˆ é™¤"><a href="#5-é€»è¾‘åˆ é™¤" class="headerlink" title="5. é€»è¾‘åˆ é™¤"></a>5. é€»è¾‘åˆ é™¤</h3><p>æ•°æ®åº“è¡¨ä¸­åŠ ä¸Šä¸€åˆ—<code>deleted</code></p><ul><li>ç‰©ç†åˆ é™¤ï¼šæ•°æ®çœŸçš„ä¸åœ¨äº†ï¼Œåœ¨ç¡¬ä»¶ä¸Šåˆ é™¤ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> userMaper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç‰©ç†åˆ é™¤</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteBatchIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> userMaper<span class="token punctuation">.</span><span class="token function">deleteBatchIds</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰¹é‡åˆ é™¤</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é€»è¾‘åˆ é™¤ï¼šé€»è¾‘ä¸Šåˆ é™¤ï¼Œä½†æ•°æ®å®é™…è¿˜å­˜åœ¨ã€‚</li></ul><ol><li>è¡¨ä¸­æ·»åŠ é€»è¾‘åˆ é™¤å­—æ®µï¼Œå¯¹åº”å®ä½“ç±»æ·»åŠ å±æ€§ã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableLogic</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> deleted<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>é…ç½®é€»è¾‘æ’ä»¶</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">ISqlInjector</span> <span class="token function">sqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogicSqlInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å†è°ƒç”¨åˆ é™¤è¯­å¥ï¼Œå°±ä¼šå°†deletedå­—æ®µç½®ä¸º1ã€‚ï¼ˆå‡è£…åˆ é™¤ï¼‰</li></ol><p>å…¶åº•å±‚çš„sqlè¯­å¥æ˜¯<code>UPDATE user SET deleted=1 WHERE id=? AND deleted=0 </code></p>]]></content>
      
      
      <categories>
          
          <category> project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MYSQL</title>
      <link href="2021/03/15/database/"/>
      <url>2021/03/15/database/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h1><h2 id="ä¸€ã€ç»ªè®º"><a href="#ä¸€ã€ç»ªè®º" class="headerlink" title="ä¸€ã€ç»ªè®º"></a>ä¸€ã€ç»ªè®º</h2><p>æ•°æ®ã€æ•°æ®åº“ã€æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå’Œæ•°æ®åº“ç³»ç»Ÿæ˜¯4ä¸ªåŸºæœ¬æ¦‚å¿µã€‚</p><ol><li>æ•°æ®ï¼ˆdataï¼‰</li></ol><p>æ•°æ®æ˜¯æ•°æ®åº“ç§å­˜å‚¨çš„åŸºæœ¬å¯¹è±¡ã€‚ï¼ˆæ•°å­—ã€å­—ç¬¦ã€éŸ³è§†é¢‘ç­‰ç­‰ï¼‰</p><p><font color="green">æè¿°äº‹ç‰©çš„ç¬¦å·è®°å½•ç§°ä¸ºæ•°æ®ã€‚</font></p><ol start="2"><li>æ•°æ®åº“ï¼ˆData Base,DB)</li></ol><p>æ•°æ®åº“æ˜¯å­˜æ”¾æ•°æ®çš„ä»“åº“ã€‚<font color="green">æ•°æ®åº“æ˜¯é•¿æœŸå­˜å‚¨åœ¨è®¡ç®—æœºå†…ã€æœ‰ç»„ç»‡çš„ã€å¯å…±äº«çš„å¤§é‡æ•°æ®çš„é›†åˆã€‚æ•°æ®åº“ä¸­çš„æ•°æ®æŒ‰ä¸€å®šçš„æ•°æ®æ¨¡å‹ç»„ç»‡ã€æè¿°å’Œå­˜å‚¨ï¼Œå…·æœ‰è¾ƒå°çš„å†—ä½™åº¦ã€è¾ƒé«˜çš„æ•°æ®ç‹¬ç«‹æ€§å’Œæ˜“æ‰©å±•æ€§ï¼Œå¹¶å¯ä¸ºå„ç§ç”¨æˆ·å…±äº«</font></p><ol start="3"><li>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ</li></ol><p>å®ƒæœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><p>1ï¼‰æ•°æ®å®šä¹‰åŠŸèƒ½ã€‚</p><p>2ï¼‰æ•°æ®ç»„ç»‡ã€å­˜å‚¨å’Œç®¡ç†</p><p>3ï¼‰æ•°æ®æ“çºµåŠŸèƒ½</p><p>4ï¼‰æ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†å’Œè¿è¡Œç®¡ç†</p><p>5ï¼‰æ•°æ®åº“çš„å»ºç«‹å’Œç»´æŠ¤åŠŸèƒ½</p><p>6ï¼‰å…¶ä»–åŠŸèƒ½</p><ol start="4"><li>æ•°æ®åº“ç³»ç»Ÿ</li></ol><p>æ•°æ®åº“ç³»ç»Ÿæ˜¯ç”±æ•°æ®åº“ã€æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ç®¡ç†å‘˜ç»„æˆçš„å­˜å‚¨ã€ç®¡ç†ã€å¤„ç†å’Œç»´æŠ¤æ•°æ®çš„ç³»ç»Ÿã€‚</p><h3 id="1-ä¸¤ç±»æ•°æ®æ¨¡å‹"><a href="#1-ä¸¤ç±»æ•°æ®æ¨¡å‹" class="headerlink" title="1. ä¸¤ç±»æ•°æ®æ¨¡å‹"></a>1. ä¸¤ç±»æ•°æ®æ¨¡å‹</h3><p>ç¬¬ä¸€ç±»æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œç¬¬äºŒç±»æ˜¯é€»è¾‘æ¨¡å‹å’Œç‰©ç†æ¨¡å‹ã€‚</p><p><img src="/2021/03/15/database/%E6%A6%82%E5%BF%B5%E6%A8%A1%E5%9E%8B.PNG"></p><ul><li><strong>æ¦‚å¿µæ¨¡å‹</strong></li></ul><p>ä¹Ÿå«ä¿¡æ¯æ¨¡å‹,æ˜¯ç°å®ä¸–ç•Œåˆ°æœºå™¨ä¸–ç•Œçš„ä¸€ä¸ªä¸­é—´å±‚æ¬¡ã€‚</p><p>ä¿¡æ¯ä¸–ç•Œä¸­åŸºæœ¬æ¦‚å¿µï¼š</p><p>1ï¼‰ å®ä½“ã€‚ å®¢è§‚å­˜åœ¨å¹¶å¯ç›¸äº’åŒºåˆ«çš„äº‹ç‰©ç§°ä¸ºå®ä½“ã€‚</p><p>2ï¼‰ å±æ€§ã€‚ å®ä½“æ‰€å…·æœ‰çš„æŸä¸€ç‰¹æ€§ç§°ä¸ºå±æ€§ã€‚</p><p>3ï¼‰ ç ã€‚ å”¯ä¸€æ ‡è¯†å®ä½“çš„å±æ€§é›†æˆä¸ºç ã€‚</p><p>4ï¼‰å®ä½“æ€§ã€‚ ç”¨å®ä½“ååŠå…¶å±æ€§åé›†åˆæ¥æŠ½è±¡å’Œåˆ»ç”»åŒç±»å®ä½“ï¼Œç§°ä¸ºå®ä½“æ€§ã€‚</p><p>5ï¼‰ å®ä½“é›†ã€‚ åŒä¸€ç±»å‹å®ä½“çš„é›†åˆç§°ä¸ºå®ä½“é›†ã€‚</p><p>6ï¼‰ è”ç³»ã€‚ å®ä½“ä¹‹é—´çš„è”ç³»é€šå¸¸æ˜¯æŒ‡ä¸åŒå®ä½“é›†ä¹‹é—´çš„è”ç³»ã€‚</p><p>å®ä½“ä¹‹é—´çš„è”ç³»æœ‰ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šç­‰å¤šç§ç±»å‹ã€‚</p><p>æ¦‚å¿µæ¨¡å‹çš„ä¸€ç§è¡¨ç¤ºæ–¹æ³•ï¼šå®ä½“-è”ç³»æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨<strong>ERå›¾</strong>ï¼ŒE-Ræ–¹æ³•ä¹Ÿç§°ä¸ºE-Ræ¨¡å‹ã€‚</p><ul><li><strong>æ•°æ®æ¨¡å‹</strong></li></ul><p>é€šå¸¸ç”±æ•°æ®ç»“æ„ã€æ•°æ®æ“ä½œå’Œæ•°æ®çš„å®Œæ•´æ€§çº¦æŸæ¡ä»¶ä¸‰éƒ¨åˆ†ç»„æˆã€‚</p><p>1ï¼‰ æ•°æ®ç»“æ„ã€‚æè¿°æ•°æ®åº“çš„ç»„æˆå¯¹è±¡ä»¥åŠå¯¹è±¡ä¹‹é—´çš„è”ç³»ã€‚</p><p>2ï¼‰ æ•°æ®æ“ä½œã€‚å¯¹æ•°æ®åº“ä¸­çš„å„ç§å¯¹è±¡çš„å®ä¾‹å…è®¸æ‰§è¡Œçš„æ“ä½œçš„é›†åˆï¼ŒåŒ…æ‹¬æ“ä½œåŠæœ‰å…³çš„æ“ä½œè§„åˆ™ã€‚</p><p>3ï¼‰æ•°æ®çš„å®Œæ•´æ€§çº¦æŸã€‚</p><p>å¸¸ç”¨çš„æ•°æ®æ¨¡å‹ï¼š</p><p>1ï¼‰ å±‚æ¬¡æ¨¡å‹ ï¼ˆæ ‘ï¼‰</p><ul><li><p>æœ‰ä¸”åªæœ‰ä¸€ä¸ªç»“ç‚¹æ²¡æœ‰åŒäº²ç»“ç‚¹ï¼Œè¿™ä¸ªç»“ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ã€‚</p></li><li><p>æ ¹ä»¥å¤–çš„å…¶ä»–ç»“ç‚¹æ²¡æœ‰åŒäº²ç»“ç‚¹ã€‚</p></li></ul><p>2ï¼‰ç½‘çŠ¶æ¨¡å‹</p><ul><li>å…è®¸ä¸€ä¸ªä»¥ä¸Šçš„ç»“ç‚¹æ— åŒäº²ã€‚</li><li>ä¸€ä¸ªç»“ç‚¹å¯ä»¥æœ‰å¤šäºä¸€ä¸ªçš„åŒäº²ã€‚</li></ul><p><img src="/2021/03/15/database/%E7%BD%91%E7%8A%B6%E6%A8%A1%E5%9E%8B.PNG"></p><ul><li>å…³ç³»æ¨¡å‹</li></ul><p><img src="/2021/03/15/database/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B.PNG"></p><p>å…³ç³»ï¼šä¸€ä¸ªå…³ç³»å¯¹åº”é€šå¸¸è¯´çš„ä¸€å¼ è¡¨ã€‚</p><p>å…ƒç»„ï¼šè¡¨ä¸­çš„ä¸€è¡Œã€‚</p><p>å±æ€§ï¼šè¡¨ä¸­çš„ä¸€åˆ—ã€‚</p><p>ç ï¼šä¹Ÿç§°ä¸ºç é”®ã€‚è¡¨ä¸­çš„æŸä¸ªå±æ€§ç»„ï¼Œå®ƒå¯ä»¥å”¯ä¸€ç¡®å®šä¸€ä¸ªå…ƒç»„ã€‚</p><p>åŸŸï¼šåŸŸæ˜¯ä¸€ç»„å…·æœ‰ç›¸åŒæ•°æ®ç±»å‹çš„å€¼çš„é›†åˆã€‚å±æ€§çš„å–å€¼èŒƒå›´æ¥è‡ªæŸä¸ªåŸŸã€‚</p><p>åˆ†é‡ï¼šå…ƒç»„ä¸­çš„ä¸€ä¸ªå±æ€§å€¼ã€‚</p><p>å…³ç³»æ¨¡å¼ï¼šå¯¹å…³ç³»çš„æè¿°ï¼Œä¸€èˆ¬è¡¨ç¤ºä¸ºï¼šå…³ç³»åï¼ˆå±æ€§1ï¼Œå±æ€§2ï¼Œâ€¦ï¼Œå±æ€§nï¼‰</p><p>å…³ç³»æ¨¡å‹è¦æ±‚å…³ç³»å¿…é¡»æ˜¯è§„èŒƒåŒ–çš„ï¼Œ<font color="green">å…³ç³»çš„æ¯ä¸€ä¸ªåˆ†é‡å¿…é¡»æ˜¯ä¸€ä¸ªä¸å¯åˆ†çš„æ•°æ®é¡¹</font>ã€‚</p><p><img src="/2021/03/15/database/%E8%A1%A8%E4%B8%AD%E6%9C%89%E8%A1%A8.PNG"></p><h3 id="2-æ•°æ®åº“ç³»ç»Ÿçš„ç»“æ„"><a href="#2-æ•°æ®åº“ç³»ç»Ÿçš„ç»“æ„" class="headerlink" title="2.æ•°æ®åº“ç³»ç»Ÿçš„ç»“æ„"></a>2.æ•°æ®åº“ç³»ç»Ÿçš„ç»“æ„</h3><p>åœ¨æ•°æ®æ¨¡å‹ä¸­æœ‰â€œå‹(type)â€å’Œâ€œå€¼â€çš„æ¦‚å¿µã€‚å‹æ˜¯æŒ‡å¯¹æŸä¸€ç±»æ•°æ®çš„ç»“æ„å’Œå±æ€§çš„è¯´æ˜ï¼Œå€¼æ˜¯å‹çš„ä¸€ä¸ªå…·ä½“èµ‹å€¼ã€‚æ¨¡å¼æ˜¯æ•°æ®åº“ä¸­å…¨ä½“æ•°æ®çš„é€»è¾‘ç»“æ„å’Œç‰¹å¾çš„æè¿°ï¼Œå®ƒä»…ä»…æ¶‰åŠå‹çš„æè¿°ï¼Œä¸æ¶‰åŠå…·ä½“çš„å€¼ã€‚</p><ul><li>æ•°æ®åº“ç³»ç»Ÿçš„ä¸‰çº§æ¨¡å¼ç»“æ„</li></ul><p>å¤–æ¨¡å¼ã€æ¨¡å¼å’Œå†…æ¨¡å¼ä¸‰çº§æ„æˆã€‚</p><p><img src="/2021/03/15/database/%E4%B8%89%E7%BA%A7%E6%A8%A1%E5%BC%8F.PNG"></p><ol><li>æ¨¡å¼</li></ol><p>æ¨¡å¼ä¹Ÿæˆä¸ºé€»è¾‘æ¨¡å¼ï¼Œæ˜¯æ•°æ®åº“ä¸­å…¨ä½“æ•°æ®çš„é€»è¾‘ç»“æ„å’Œç‰¹å¾çš„æè¿°ï¼Œæ˜¯æ‰€æœ‰ç”¨æˆ·çš„å…¬å…±æ•°æ®è§†å›¾ã€‚ä¸€ä¸ªæ•°æ®åº“åªæœ‰ä¸€ä¸ªæ¨¡å¼ã€‚æ•°æ®åº“æ¨¡å¼ä»¥æŸä¸€ç§æ•°æ®æ¨¡å‹ä¸ºåŸºç¡€ï¼ŒåŒæ„ç»¼åˆåœ°è€ƒè™‘äº†æ‰€æœ‰ç”¨æˆ·çš„éœ€æ±‚ã€‚</p><ol start="2"><li>å¤–æ¨¡å¼</li></ol><p>å¤–æ¨¡å¼ä¹Ÿç§°ä¸ºå­æ¨¡å¼æˆ–ç”¨æˆ·æ¨¡å¼ï¼Œå®ƒæ˜¯æ•°æ®åº“ç”¨æˆ·èƒ½å¤Ÿçœ‹è§å’Œä½¿ç”¨çš„å±€éƒ¨æ•°æ®çš„é€»è¾‘ç»“æ„å’Œç‰¹å¾çš„æè¿°ï¼Œæ˜¯æ•°æ®åº“ç”¨æˆ·çš„æ•°æ®è§†å›¾ï¼Œæ˜¯ä¸æŸä¸€åº”ç”¨æœ‰å…³çš„æ•°æ®çš„é€»è¾‘è¡¨ç¤ºã€‚</p><p>å¤–æ¨¡å¼æ˜¯æ¨¡å¼çš„å­é›†ã€‚</p><ol start="3"><li>å†…æ¨¡å¼</li></ol><p>å†…æ¨¡å¼ä¹Ÿç§°ä¸ºå­˜å‚¨æ¨¡å¼ï¼Œä¸€ä¸ªæ•°æ®åº“åªæœ‰ä¸€ä¸ªå†…æ¨¡å¼ã€‚å®ƒæ˜¯æ•°æ®ç‰©ç†ç»“æ„å’Œå­˜å‚¨æ–¹å¼çš„æè¿°ï¼Œæ˜¯æ•°æ®åœ¨æ•°æ®åº“å†…éƒ¨çš„ç»„ç»‡æ–¹å¼ã€‚</p><p> <font color="green">å¤–æ¨¡å¼/æ¨¡å¼æ˜ åƒ</font></p><p>æ¨¡å¼æè¿°çš„æ˜¯æ•°æ®çš„å…¨å±€é€»è¾‘ç»“æ„ï¼Œå¤–æ¨¡å¼æè¿°çš„æ˜¯æ•°æ®çš„å±€éƒ¨é€»è¾‘ç»“æ„ã€‚æ¯ä¸€ä¸ªå¤–æ¨¡å¼ï¼Œéƒ½æœ‰ä¸€ä¸ªå¤–æ¨¡å¼/æ¨¡å¼æ˜ åƒï¼Œå®ƒå®šä¹‰äº†å¤–æ¨¡å¼å’Œæ¨¡å¼ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚è¿™äº›æ˜ åƒå®šä¹‰é€šå¸¸åŒ…å«å„è‡ªå¤–æ¨¡å¼çš„æè¿°ã€‚</p><p><font color="green">æ¨¡å¼/å†…æ¨¡å¼æ˜ åƒ</font></p><p>æ¨¡å¼å†…æ¨¡å¼æ˜ åƒæ˜¯å”¯ä¸€çš„ï¼Œå®ƒå®šä¹‰äº†æ•°æ®å…¨å±€é€»è¾‘ç»“æ„ä¸å­˜å‚¨ç»“æ„ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p><h2 id="äºŒã€å…³ç³»æ•°æ®åº“"><a href="#äºŒã€å…³ç³»æ•°æ®åº“" class="headerlink" title="äºŒã€å…³ç³»æ•°æ®åº“"></a>äºŒã€å…³ç³»æ•°æ®åº“</h2><h3 id="1-å…³ç³»æ•°æ®ç»“æ„åŠå…¶å½¢å¼åŒ–å®šä¹‰"><a href="#1-å…³ç³»æ•°æ®ç»“æ„åŠå…¶å½¢å¼åŒ–å®šä¹‰" class="headerlink" title="1.å…³ç³»æ•°æ®ç»“æ„åŠå…¶å½¢å¼åŒ–å®šä¹‰"></a>1.å…³ç³»æ•°æ®ç»“æ„åŠå…¶å½¢å¼åŒ–å®šä¹‰</h3><p>å…³ç³»æ¨¡å‹æ˜¯å»ºç«‹åœ¨é›†åˆä»£æ•°çš„åŸºç¡€ä¸Šçš„ã€‚</p><p>ç¬›å¡å°”ç§¯ï¼š</p><p><img src="/2021/03/15/database/%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF.PNG"></p><ul><li><font color="red" size="5">å…³ç³»</font></li></ul><p>$D_1 \times D_2 \times â€¦. \times D_n$ çš„å­é›†å«åšåœ¨åŸŸ$D_1, D_2, â€¦,D_n$ä¸Šçš„å…³ç³»ã€‚è¡¨ç¤ºä¸º$R(D_1,D_2,â€¦,D_n)$</p><p>è¿™é‡Œçš„Rè¡¨ç¤ºå…³ç³»çš„åå­—ï¼Œnæ˜¯å…³ç³»çš„ç›®æˆ–åº¦ï¼ˆdegree)ã€‚</p><p>n = 1ï¼Œè¡¨ç¤ºæ˜¯å•å…ƒå…³ç³»ã€‚</p><p>n = 2ï¼Œè¡¨ç¤ºæ˜¯äºŒå…ƒå…³ç³»ã€‚</p><p><font color="green">è‹¥å…³ç³»ä¸­æŸä¸€ä¸ªå±æ€§ç»„çš„å€¼èƒ½å”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªå…ƒç»„ï¼Œè€Œå…¶å­é›†ä¸èƒ½ï¼Œåˆ™ç§°è¯¥å±æ€§ç»„ä¸º<strong>å€™é€‰ç </strong></font></p><p>è‹¥ä¸€ä¸ªå…³ç³»æœ‰å¤šä¸ªå€™é€‰ç ï¼Œåˆ™é€‰å®šå…¶ä¸­ä¸€ä¸ªä¸º<strong>ä¸»ç </strong>ã€‚å€™é€‰ç çš„è¯¸å±æ€§ç§°ä¸º<strong>ä¸»å±æ€§</strong>ã€‚</p><ul><li><font color="red" size="5">å…³ç³»æ¨¡å¼</font> </li></ul><p>å…³ç³»æ•°æ®åº“ä¸­ï¼Œå…³ç³»æ¨¡å¼æ˜¯å‹ï¼Œå…³ç³»æ˜¯å€¼ã€‚å…³ç³»æ¨¡å¼æ˜¯å¯¹å…³ç³»çš„æè¿°ã€‚</p><p>å…³ç³»æ¨¡å¼å¯ä»¥å½¢å¼åŒ–åœ°è¡¨ç¤ºä¸º$R(U,D,DOM,F)$ï¼Œå…¶ä¸­Rä¸ºå…³ç³»åï¼ŒUä¸ºç»„æˆè¯¥å…³ç³»çš„å±æ€§åé›†åˆï¼ŒDä¸ºUä¸­å±æ€§æ‰€æ¥è‡ªçš„åŸŸï¼ŒDOMä¸ºå±æ€§å‘åŸŸçš„æ˜ åƒé›†åˆï¼ŒFä¸ºå±æ€§é—´æ•°æ®çš„ä¾èµ–å…³ç³»é›†åˆã€‚</p><p>å…³ç³»æ•°æ®åº“ï¼šæ‰€æœ‰å…³ç³»çš„é›†åˆã€‚</p><p>å…³ç³»æ“ä½œï¼šæŸ¥è¯¢å’Œæ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹ã€‚</p><p>æŸ¥è¯¢æ“ä½œå¯ä»¥åˆ†ä¸ºé€‰æ‹©ã€æŠ•å½±ã€è¿æ¥ã€é™¤ã€å¹¶ã€å·®ã€äº¤ã€ç¬›å¡å°”ç§¯ç­‰ã€‚å…¶ä¸­é€‰æ‹©ã€æŠ•å½±ã€å¹¶ã€å·®ã€ç¬›å¡å°”ç§¯æ˜¯5ä¸­åŸºæœ¬æ“ä½œã€‚æ“ä½œçš„å¯¹è±¡å’Œç»“æœéƒ½æ˜¯é›†åˆã€‚éå…³ç³»æ•°æ®æ¨¡å‹çš„æ•°æ®æ“ä½œæ–¹å¼åˆ™ä¸ºä¸€æ¬¡ä¸€è®°å½•çš„æ–¹å¼ã€‚</p><h1 id="InnoDB-æŠ€æœ¯å†…å¹•"><a href="#InnoDB-æŠ€æœ¯å†…å¹•" class="headerlink" title="InnoDB æŠ€æœ¯å†…å¹•"></a>InnoDB æŠ€æœ¯å†…å¹•</h1><p>è¿æ¥MySQLæ“ä½œæ˜¯ä¸€ä¸ªè¿æ¥è¿›ç¨‹å’ŒMySQLæ•°æ®åº“å®ä¾‹è¿›è¡Œé€šä¿¡ã€‚æ¯”å¦‚é€šè¿‡TCP/IPè¿æ¥åˆ°MySQLå®ä¾‹ï¼Œæ•°æ®åº“ä¼šå…ˆæ£€æŸ¥ä¸€å¼ æƒé™è§†å›¾ï¼Œç”¨æ¥åˆ¤æ–­å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯IPæ˜¯å¦å…è®¸è¿æ¥åˆ°Mysqlå®ä¾‹ã€‚</p><h3 id="1-InnoDBä½“ç³»æ¶æ„"><a href="#1-InnoDBä½“ç³»æ¶æ„" class="headerlink" title="1. InnoDBä½“ç³»æ¶æ„"></a>1. InnoDBä½“ç³»æ¶æ„</h3><ol><li>Master Thread</li></ol><p>æ ¸å¿ƒçš„åå°çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£å°†ç¼“å†²æ± ä¸­çš„æ•°æ®å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ŒåŒ…æ‹¬è„é¡µçš„åˆ·æ–°ã€åˆå¹¶æ’å…¥ç¼“å†²ã€UNDOé¡µçš„å›æ”¶ã€‚</p><ol start="2"><li>IO Thread</li></ol><p>InnoDBå­˜å‚¨å¼•æ“å¤§é‡ä½¿ç”¨AIOï¼ˆAsync IOï¼‰æ¥å¤„ç†å†™IOè¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æé«˜æ•°æ®åº“çš„æ€§èƒ½ã€‚InnoDB 1.0 ç‰ˆæœ¬ä¹‹å‰å…±æœ‰4ä¸ªIO Treadã€‚writeã€readã€insert bufferã€log IO threadã€‚</p><ol start="3"><li>Purge Thread</li></ol><p>PurgeThreadæ¥å›æ”¶å·²ç»ä½¿ç”¨å¹¶åˆ†é…çš„undoé¡µã€‚</p><h2 id="åŸºç¡€æŸ¥è¯¢"><a href="#åŸºç¡€æŸ¥è¯¢" class="headerlink" title="åŸºç¡€æŸ¥è¯¢"></a>åŸºç¡€æŸ¥è¯¢</h2><h3 id="1ã€Select"><a href="#1ã€Select" class="headerlink" title="1ã€Select"></a>1ã€<code>Select</code></h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">Select æŸ¥è¯¢åˆ—è¡¨ from è¡¨å;SELECT last_name,email,salary from employees; #æŸ¥è¯¢å¤šä¸ªå­—æ®µSELECT 100*98;#æŸ¥è¯¢è¡¨è¾¾å¼SELECT VERSION();#æŸ¥è¯¢å‡½æ•°SELECT DISTINCT department_id FROM employees;#å»é‡å¤SELECT 100+90;SELECT '123'+90;#çœ‹3ç‚¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p>æŸ¥è¯¢åˆ—è¡¨å¯ä»¥æ˜¯å­—æ®µã€å¸¸é‡å€¼ã€å‡½æ•°å’Œè¡¨è¾¾å¼ã€‚</p></li><li><p>æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„è¡¨æ ¼ã€‚</p></li><li><p><code>+</code>çš„ä½œç”¨ï¼š</p><p>a. ä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸ºæ•°å€¼å‹ï¼Œåˆ™åšåŠ æ³•è¿ç®—ã€‚</p><p>b.å…¶ä¸­ä¸€æ–¹ä¸ºå­—ç¬¦å‹ï¼Œè¯•å›¾å°†å­—ç¬¦å‹æ•°å€¼è½¬æ¢ä¸ºæ•°å€¼å‹ã€‚å¦‚æœè½¬æ¢æˆåŠŸï¼Œåˆ™ç»§ç»­åšåŠ æ³•è¿ç®—ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™å­—ç¬¦å‹è½¬æ¢ä¸º0</p><p>c. åªè¦å…¶ä¸­ä¸€æ–¹ä¸º<code>null</code>ï¼Œåˆ™ç»“æœè‚¯å®šä¸º<code>null</code>ã€‚</p></li><li><p><code>CONCAT</code> è¿æ¥</p></li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT CONCAT('a','b','c') As ç»“æœ;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å•è¡Œå‡½æ•°"><a href="#å•è¡Œå‡½æ•°" class="headerlink" title="å•è¡Œå‡½æ•°"></a>å•è¡Œå‡½æ•°</h3><ol><li>å­—ç¬¦å‡½æ•°</li></ol><p><code>length</code> </p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT LENGTH('john');<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>concat</code> æ‹¼æ¥å­—ç¬¦ä¸²</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT CONCAT(last_name,'_',first_name) å§“å FROM employees;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>upper</code> <code>lower</code></p><pre class="line-numbers language-none"><code class="language-none">SELECT UPPER('john');SELECT LOWER('joHn');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>substr</code> <code>substring</code></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT SUBSTR('æè«æ„çˆ±ä¸Šäº†é™†å±•å…ƒ',6) out_put;// é™†å±•å…ƒSELECT SUBSTR("æè«æ„çˆ±ä¸Šäº†é™†å±•å…ƒ"ï¼Œ1ï¼Œ3) output //æè«æ„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>instr</code></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT INSTR('æ¨ä¸æ‚”çˆ±ä¸Šäº†æ®·å…­ä¾ ','æ®·å…­ä¾ ') AS out_put; è¿”å›å­ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿”å›0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>trim</code></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT TRIM('      å¼ ç¿ å±±    ') AS out_put;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>lpad</code></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT LPAD('æ®·ç´ ç´ ',10,'*') AS out_put;//å·¦ä¾§å¡«å……<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>rpad</code></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT RPAD('æ®·ç´ ç´ ',10,'*') AS out_put;//å³ä¾§å¡«å……<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>replace</code></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT REPLACE ('å¼ æ— å¿Œçˆ±ä¸Šäº†å‘¨èŠ·è‹¥å‘¨èŠ·è‹¥çˆ±ä¸Šäº†å¼ æ— å¿Œ','å‘¨èŠ·è‹¥'ï¼Œ'èµµæ•') AS out_put;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>æ•°å­¦å‡½æ•°</li></ol><p><code>round</code> å››èˆäº”å…¥</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ROUND(1.65);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>ceil</code> å‘ä¸Šå–æ•´</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT CEIL(1.00); # è¿”å›è¯¥å‚æ•°çš„æœ€å°æ•´æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>floor</code> å‘ä¸‹å–æ•´</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT FLOOR(-9.99)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>truncate</code> æˆªæ–­</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT TRUNCATE(1.6999,1);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>mod</code></p><pre class="line-numbers language-none"><code class="language-none">SELECT MOD(-10,3);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>æ—¥æœŸå‡½æ•°</li><li>å…¶ä»–å‡½æ•°</li><li>æµç¨‹æ§åˆ¶å‡½æ•°</li></ol><h4 id="Union-è”åˆæŸ¥è¯¢"><a href="#Union-è”åˆæŸ¥è¯¢" class="headerlink" title="Union è”åˆæŸ¥è¯¢"></a>Union è”åˆæŸ¥è¯¢</h4><p>å¤šå¼ è¡¨åˆå¹¶æˆä¸€ä¸ªç»“æœã€‚ï¼ˆè¦æŸ¥è¯¢çš„ç»“æœæ¥è‡ªäºå¤šä¸ªè¡¨ï¼Œä¸”å¤šä¸ªè¡¨æ²¡æœ‰ç›´æ¥çš„å…³ç³»ï¼Œä½†æŸ¥è¯¢çš„ä¿¡æ¯ä¸€èˆ¬æ˜¯ä¸€è‡´çš„ï¼‰ã€‚</p><h1 id="é«˜çº§éƒ¨åˆ†"><a href="#é«˜çº§éƒ¨åˆ†" class="headerlink" title="é«˜çº§éƒ¨åˆ†"></a>é«˜çº§éƒ¨åˆ†</h1><p><img src="/2021/03/15/database/%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.PNG"></p><p><img src="/2021/03/15/database/limit%E5%85%AC%E5%BC%8F.PNG"></p><h3 id="Explain-SQL-è¯­å¥ä¼˜åŒ–"><a href="#Explain-SQL-è¯­å¥ä¼˜åŒ–" class="headerlink" title="Explain + SQL è¯­å¥ä¼˜åŒ–"></a>Explain + SQL è¯­å¥ä¼˜åŒ–</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p><img src="/2021/03/15/database/explainID.PNG"></p><h4 id="TYPE"><a href="#TYPE" class="headerlink" title="TYPE"></a>TYPE</h4><p><img src="/2021/03/15/database/explainTYPE.PNG"></p><h3 id="2-å…­å¤§çº¦æŸ"><a href="#2-å…­å¤§çº¦æŸ" class="headerlink" title="2.å…­å¤§çº¦æŸ"></a>2.å…­å¤§çº¦æŸ</h3><h4 id="2-1-äº‹åŠ¡"><a href="#2-1-äº‹åŠ¡" class="headerlink" title="2.1 äº‹åŠ¡"></a>2.1 äº‹åŠ¡</h4><h3 id="2-1-1-æ˜¯ä»€ä¹ˆ"><a href="#2-1-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="2.1.1 æ˜¯ä»€ä¹ˆ"></a>2.1.1 æ˜¯ä»€ä¹ˆ</h3><p>ä¸€ç»„åŸå­æ€§çš„SQLæŸ¥è¯¢ï¼Œåè€…è¯´æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œå•å…ƒã€‚</p><h3 id="2-1-2-ä¸ºä»€ä¹ˆ"><a href="#2-1-2-ä¸ºä»€ä¹ˆ" class="headerlink" title="2.1.2 ä¸ºä»€ä¹ˆ"></a>2.1.2 ä¸ºä»€ä¹ˆ</h3><p>æ¯”å¦‚ç°å®ç”Ÿæ´»ä¸­é“¶è¡Œçš„è½¬è´¦æ“ä½œï¼Œå¿…é¡»æ‰“åŒ…åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ˆä»è½¬è´¦æ–¹å‡å»ï¼Œæ”¶æ¬¾æ–¹åŠ ä¸Šï¼‰ã€‚</p><h3 id="2-1-3-æ€ä¹ˆåš"><a href="#2-1-3-æ€ä¹ˆåš" class="headerlink" title="2.1.3 æ€ä¹ˆåš"></a>2.1.3 æ€ä¹ˆåš</h3><p>é€šè¿‡æ»¡è¶³ACIDçš„è¦æ±‚ã€‚</p><p>æ•°æ®åº“ä¸­æœ‰å››ç§éš”ç¦»çº§åˆ«ï¼š</p><ol><li>READ UNCOMMITED ï¼ˆæœªæäº¤è¯»ï¼‰</li><li>READ COMMMITTED ï¼ˆæäº¤è¯»ï¼‰</li><li>REPEATABLE READ ï¼ˆå¯é‡å¤è¯»ï¼‰MYSQLé»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚</li><li>SERIALIZABLE ï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰</li></ol><p>è®¾ç½®å›æ»šç‚¹</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">savepoint å›æ»šç‚¹årollback to å›æ»šç‚¹å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¹¶å‘äº‹åŠ¡</p><p>å¤šä¸ªäº‹åŠ¡ åŒæ—¶æ“ä½œ  åŒä¸€ä¸ªæ•°æ®åº“çš„ç›¸åŒæ•°æ®æ—¶ã€‚</p><p>å¹¶å‘é—®é¢˜éƒ½æœ‰å“ªäº›ï¼š</p><p>è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å…¶ä»–äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®</p><p>ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡è¯»å–ï¼Œç»“æœä¸ä¸€æ ·ã€‚</p><p>å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å…¶ä»–äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œåªæ˜¯è¯»åˆ°çš„æ˜¯å…¶ä»–äº‹åŠ¡â€œæ’å…¥â€çš„æ•°æ®ã€‚</p><p>é€šè¿‡è®¾ç½®éš”ç¦»çº§åˆ«æ¥è§£å†³å¹¶å‘é—®é¢˜ã€‚</p><p><img src="/2021/03/15/database/%E7%BA%A6%E6%9D%9F.PNG"></p><p>tips: </p><ul><li>åˆ›å»ºè¡¨æ—¶æ·»åŠ </li><li>ä¿®æ”¹è¡¨æ—¶æ·»åŠ </li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE TEST{å­—æ®µå å­—æ®µç±»å‹ åˆ—çº§çº¦æŸè¡¨çº§çº¦æŸ}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-çº¦æŸåˆ†ç±»"><a href="#2-1-çº¦æŸåˆ†ç±»" class="headerlink" title="2.1 çº¦æŸåˆ†ç±»"></a>2.1 çº¦æŸåˆ†ç±»</h4><p>NOT NULL éç©ºï¼Œè¯¥å­—æ®µ</p><p>UNIQUE å”¯ä¸€ï¼Œè¯¥å­—æ®µçš„å€¼ä¸å¯é‡å¤</p><p>DEFAULT é»˜è®¤ï¼Œè¯¥å­—æ®µçš„å€¼ä¸ç”¨æ‰‹åŠ¨æ’å…¥æœ‰é»˜è®¤å€¼ã€‚</p><p>CHECK æ£€æŸ¥ï¼Œmysqlä¸æ”¯æŒã€‚</p><p>PRIMARY KEY</p><p>FOREIGN KEY</p><p>ä¸»é”®å’Œå”¯ä¸€çš„åŒºåˆ«ï¼š</p><p>ä¸»é”®ä¸å…è®¸ä¸ºç©ºï¼Œå”¯ä¸€å…è®¸ä¸ºç©º</p><p>ä¸€ä¸ªè¡¨è‡³å¤šä¸€ä¸ªä¸»é”®ï¼Œå”¯ä¸€å¯ä»¥å¤šä¸ªã€‚</p><p>ç›¸åŒç‚¹ï¼šéƒ½å…·æœ‰å”¯ä¸€æ€§ã€‚</p><ul><li><p>åˆ—çº§çº¦æŸ</p><p>å…­å¤§çº¦æŸéƒ½æ”¯æŒï¼Œä½†å¤–é”®çº¦æŸå’©æœ‰æ•ˆæœã€‚ ä¸å¯ä»¥èµ·çº¦æŸåå­—ã€‚</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE stuinfo{id INT PRIMARY KEY,stuName VARCHAR(20) NOT NULL,gender CHAR(1) CHECK(gender = 'ç”·' OR gender = 'å¥³',seat INT UNIQUE,    age INT DEFAULT 18,    majorId INT FOREIGN KEY REFERENCE major(id)}CREATE TABLE major{    id INT PRIMARY KEY,                 }                               <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¡¨çº§çº¦æŸ</p><p>é™¤äº†éç©ºã€é»˜è®¤ï¼Œå…¶ä»–éƒ½æ”¯æŒã€‚ å¯ä»¥èµ·çº¦æŸåå­—ï¼Œä½†å¯¹ä¸»é”®æ— æ•ˆã€‚</p></li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE stuinfo{id INT,stuName VARCHAR(20) NOT NULL,gender CHAR(1) CHECK(gender = 'ç”·' OR gender = 'å¥³',seat INT UNIQUE,    age INT DEFAULT 18,    majorId INT,    CONSTRAINT pk PRIMARY KEY(id),    CONSTRAINT ue UNIQUE(seat),    CONSTRAINT fp_stuinfo_major FOREIGN KEY(majorID) REFERENCE major(id)                     }CREATE TABLE major{    id INT PRIMARY KEY,                 }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šç”¨å†™æ³•ï¼š</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE stuinfo{id INT PRIMARY KEY,stuName VARCHAR(20) NOT NULL,gender CHAR(1) CHECK(gender = 'ç”·' OR gender = 'å¥³',seat INT UNIQUE,    age INT DEFAULT 18,    CONSTRAINT fp_stuinfo_major FOREIGN KEY(majorID) REFERENCE major(id) ## åªå†™å¤–é”®                         }CREATE TABLE major{    id INT PRIMARY KEY,                 }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-2-ä¸»é”®å’Œå”¯ä¸€é”®åŒºåˆ«"><a href="#2-2-ä¸»é”®å’Œå”¯ä¸€é”®åŒºåˆ«" class="headerlink" title="2.2 ä¸»é”®å’Œå”¯ä¸€é”®åŒºåˆ«"></a>2.2 ä¸»é”®å’Œå”¯ä¸€é”®åŒºåˆ«</h4><table><thead><tr><th>name</th><th>å”¯ä¸€æ€§</th><th>å…è®¸ç©º</th><th>ä¸€ä¸ªè¡¨ä¸­å¤šå°‘ä¸ª</th><th>å…è®¸ç»„åˆ</th></tr></thead><tbody><tr><td>ä¸»é”®</td><td>æ˜¯</td><td>ä¸å…è®¸</td><td>æœ€å¤šä¸€ä¸ª</td><td>å…è®¸</td></tr><tr><td>å”¯ä¸€é”®</td><td>æ˜¯</td><td>å…è®¸</td><td>å¯ä»¥å¤šä¸ªunique</td><td>å…è®¸</td></tr></tbody></table><p>å”¯ä¸€é”®<code>null</code>åªèƒ½æœ‰ä¸€ä¸ª</p><h3 id="2-3-å¤–é”®çš„ç‰¹ç‚¹"><a href="#2-3-å¤–é”®çš„ç‰¹ç‚¹" class="headerlink" title="2.3 å¤–é”®çš„ç‰¹ç‚¹"></a>2.3 å¤–é”®çš„ç‰¹ç‚¹</h3><ol><li>è¦æ±‚ä»è¡¨è®¾ç½®å¤–é”®å…³ç³»ã€‚</li><li>ä»è¡¨å¤–é”®åˆ—ç±»å‹å’Œä¸»è¡¨ç±»å‹ä¸€è‡´æˆ–å…¼å®¹ï¼Œåç§°æ— æ‰€è°“ã€‚</li><li>ä¸»è¡¨çš„å…³è”åˆ—å¿…é¡»æ˜¯keyï¼ˆä¸€èˆ¬æ˜¯ä¸»é”®æˆ–å”¯ä¸€ï¼‰</li><li>æ’å…¥æ•°æ®å…ˆæ’å…¥ä¸»è¡¨å†ä»è¡¨ï¼Œåˆ é™¤é¡ºåºç›¸åã€‚</li></ol><h4 id="2-4-ä¿®æ”¹è¡¨æ·»åŠ çº¦æŸ"><a href="#2-4-ä¿®æ”¹è¡¨æ·»åŠ çº¦æŸ" class="headerlink" title="2.4 ä¿®æ”¹è¡¨æ·»åŠ çº¦æŸ"></a>2.4 ä¿®æ”¹è¡¨æ·»åŠ çº¦æŸ</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">ALTER TABLE stuInfo MODIFY COLUMN stuname VARCHAR(20) NOT NULL # éç©ºçº¦æŸ# åˆ—çº§çº¦æŸALTER TABLE stuInfo MODIFY COLUMN id INT PRIMARY KEY;# è¡¨çº§çº¦æŸALTER TABLE stuInfo ADD PRIMARY KEY(id);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-5-ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ"><a href="#2-5-ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ" class="headerlink" title="2.5 ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ"></a>2.5 ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># åˆ é™¤å”¯ä¸€é”®ALTER TABLE stuInfo DROP INDEX seat;# åˆ é™¤ä¸»é”®ALTER TABLE stuInfo DROP PRIMARY KEY;# åˆ é™¤å¤–é”®ALTER TABLE stuInfo DROP FOREIGN KEY majorid;# æˆ–è€…å¯ä»¥ç›´æ¥æ›´æ”¹åŸæ¥çš„å½¢å¼ not null ---&gt; nullALTER TABLE stuInfo MODIFY stuname VARCHAR(20) NULL;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-æ ‡è¯†åˆ—"><a href="#3-æ ‡è¯†åˆ—" class="headerlink" title="3. æ ‡è¯†åˆ—"></a>3. æ ‡è¯†åˆ—</h3><ul><li>è‡ªå¢é•¿åˆ—ï¼Œç³»ç»Ÿæä¾›é»˜è®¤çš„åºåˆ—å€¼ï¼ˆ1å¼€å§‹ï¼‰</li><li>ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªæ ‡è¯†åˆ—</li><li>åªèƒ½æ˜¯æ•°å€¼å‹ ï¼ˆINT FLOAT DOUBLE)</li><li>mysql å¯ä»¥è®¾ç½®æ­¥é•¿</li></ul><h4 id="3-1-åˆ›å»ºè¡¨æ—¶"><a href="#3-1-åˆ›å»ºè¡¨æ—¶" class="headerlink" title="3.1 åˆ›å»ºè¡¨æ—¶"></a>3.1 åˆ›å»ºè¡¨æ—¶</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CRATE TABLE test{id INT PRIMARY KEY AUTO_INCREMENT,NAME VARCHAR(20)}set auto_increment_increment=3 #æ­¥é•¿æ¯æ¬¡åŠ 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-2-ä¿®æ”¹è¡¨æ—¶"><a href="#3-2-ä¿®æ”¹è¡¨æ—¶" class="headerlink" title="3.2 ä¿®æ”¹è¡¨æ—¶"></a>3.2 ä¿®æ”¹è¡¨æ—¶</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">ALTER TABLE tab_identity MODIFY COLUMN id PRIMARY KEY AUTO_INCREMENT;# åˆ é™¤è‡ªå¢ALTER TABLE tab_identity MODIFY COLUMN id PRIMARY KEY;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="3-3-éš”ç¦»çº§åˆ«"><a href="#3-3-éš”ç¦»çº§åˆ«" class="headerlink" title="3.3 éš”ç¦»çº§åˆ«"></a>3.3 éš”ç¦»çº§åˆ«</h4><p>4ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</p><p>MYSQLå››ç§éƒ½æ”¯æŒï¼Œé»˜è®¤REPEATEBLE READã€‚ </p><p>READ UNCOMMITTED</p><p>READ COMMITED é¿å…è„è¯»</p><p>REPEATABLE READ è„è¯»å’Œä¸å¯é‡å¤è¯»éƒ½é¿å…</p><p>SERIALIZABLE ä¸²è¡ŒåŒ–ï¼Œæ•ˆç‡ååˆ†ä½ä¸‹ã€‚</p><h3 id="4-è§†å›¾"><a href="#4-è§†å›¾" class="headerlink" title="4. è§†å›¾"></a>4. è§†å›¾</h3><h4 id="4-1-è§†å›¾"><a href="#4-1-è§†å›¾" class="headerlink" title="4.1 è§†å›¾"></a>4.1 è§†å›¾</h4><p>æ¦‚å¿µï¼šè™šæ‹Ÿè¡¨ï¼Œå’Œæ™®é€šè¡¨ä¸€æ ·ä½¿ç”¨ã€‚é€šè¿‡è¡¨åŠ¨æ€ç”Ÿæˆçš„æ•°æ®ã€‚<font color="red">åªä¿å­˜sqlé€»è¾‘ã€‚</font></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE VIEW name AS...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¤šä¸ªåœ°æ–¹ç”¨åˆ°åŒæ ·çš„æŸ¥è¯¢ç»“æœï¼Œæˆ–sqlè¯­å¥è¾ƒä¸ºå¤æ‚ã€‚</p><h4 id="4-2-è§†å›¾ä¿®æ”¹"><a href="#4-2-è§†å›¾ä¿®æ”¹" class="headerlink" title="4.2 è§†å›¾ä¿®æ”¹"></a>4.2 è§†å›¾ä¿®æ”¹</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">create or replace veiw è§†å›¾å  #æ–¹å¼ä¸€as æŸ¥è¯¢è¯­å¥alter view è§†å›¾åas æŸ¥è¯¢è¯­å¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-3-è§†å›¾åˆ é™¤"><a href="#4-3-è§†å›¾åˆ é™¤" class="headerlink" title="4.3 è§†å›¾åˆ é™¤"></a>4.3 è§†å›¾åˆ é™¤</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DROP VIEW è§†å›¾åï¼Œè§†å›¾å...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4-4-æ˜¾ç¤ºè§†å›¾"><a href="#4-4-æ˜¾ç¤ºè§†å›¾" class="headerlink" title="4.4 æ˜¾ç¤ºè§†å›¾"></a>4.4 æ˜¾ç¤ºè§†å›¾</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">show create view è§†å›¾å<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4-5-è§†å›¾æ›´æ–°"><a href="#4-5-è§†å›¾æ›´æ–°" class="headerlink" title="4.5 è§†å›¾æ›´æ–°"></a>4.5 è§†å›¾æ›´æ–°</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO è§†å›¾å VALUES(â€˜zhangfeiâ€™,'1940')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ‰ä¸€äº›è¯­å¥æ˜¯ä¸èƒ½æ›´æ–°çš„ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹çš„æ˜¯ä¸èƒ½æ›´æ–°çš„</p><p>1:</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT è¯­å¥ä¸­åŒ…å«å­æŸ¥è¯¢JOINGROUP BYJOINï¼ˆæŸ¥è¯¢æ—¶ä½¿ç”¨åˆ°äº†JOINï¼‰from ä¸€ä¸ªä¸èƒ½æ›´æ–°çš„è§†å›¾WHERE å­å¥çš„å­æŸ¥è¯¢å¼•ç”¨äº†fromå­å¥ä¸­çš„è¡¨DISTINCTunion union all<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-6-delete-å’Œ-truncate-åœ¨äº‹åŠ¡ä½¿ç”¨æ—¶çš„åŒºåˆ«"><a href="#4-6-delete-å’Œ-truncate-åœ¨äº‹åŠ¡ä½¿ç”¨æ—¶çš„åŒºåˆ«" class="headerlink" title="4.6 delete å’Œ truncate åœ¨äº‹åŠ¡ä½¿ç”¨æ—¶çš„åŒºåˆ«"></a>4.6 delete å’Œ truncate åœ¨äº‹åŠ¡ä½¿ç”¨æ—¶çš„åŒºåˆ«</h4><p><code>trancate</code>ä¸æ”¯æŒå›æ»š</p><p>deleteæ¯æ¬¡åˆ é™¤ä¸€è¡Œã€‚</p><p>trancate tableä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰æ•°æ®ä¸”ä¸è®°å½•æ—¥å¿—ä¿å­˜ï¼Œæ‰§è¡Œé€Ÿåº¦å¿«ã€‚</p><p>æ‰§è¡Œé€Ÿåº¦ä¸Šï¼šdrop &gt; trancate &gt; delete</p><h3 id="5-å˜é‡"><a href="#5-å˜é‡" class="headerlink" title="5. å˜é‡"></a>5. å˜é‡</h3><h4 id="5-1-ç³»ç»Ÿå˜é‡"><a href="#5-1-ç³»ç»Ÿå˜é‡" class="headerlink" title="5.1 ç³»ç»Ÿå˜é‡"></a>5.1 ç³»ç»Ÿå˜é‡</h4><p>å˜é‡æœ‰ç³»ç»Ÿæä¾›ï¼Œä¸æ˜¯ç”¨æˆ·å®šä¹‰ï¼Œå±äºæœåŠ¡å™¨å±‚é¢ã€‚</p><ol><li>æŸ¥çœ‹æ‰€æœ‰çš„ç³»ç»Ÿå˜é‡ã€‚</li></ol><p><code>SHOW GLOBAL | ã€SESSIONã€‘ VARIABLES</code></p><ol start="2"><li>æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ç³»ç»Ÿå˜é‡</li></ol><p><code>SHOW GLOBAL | ã€SESSIONã€‘ variables like '%char%'</code></p><ol start="3"><li><p>æŸ¥çœ‹æŒ‡å®šçš„æŸä¸ªç³»ç»Ÿå˜é‡çš„å€¼ã€‚</p><p><code>select @@global | ã€sessionã€‘.ç³»ç»Ÿå˜é‡å</code></p></li><li><p>ä¸ºæŸä¸ªç³»ç»Ÿå˜é‡èµ‹å€¼</p></li></ol><p><code>set @@global | session.ç³»ç»Ÿå˜é‡å = å€¼</code></p><h4 id="5-2-è‡ªå®šä¹‰å˜é‡"><a href="#5-2-è‡ªå®šä¹‰å˜é‡" class="headerlink" title="5.2 è‡ªå®šä¹‰å˜é‡"></a>5.2 è‡ªå®šä¹‰å˜é‡</h4><p>ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œä¸æ˜¯ç”±ç³»ç»Ÿæä¾›çš„ã€‚</p><p>å£°æ˜ èµ‹å€¼ ä½¿ç”¨</p><ol><li>ç”¨æˆ·å˜é‡</li></ol><p>ä½œç”¨åŸŸï¼šé’ˆå¯¹å½“å‰ä¼šè¯è¿æ¥æœ‰æ•ˆï¼ŒåŒäºä¼šè¯å˜é‡çš„ä½œç”¨åŸŸã€‚</p><p><code>SET @ç”¨æˆ·å˜é‡å=å€¼</code> æˆ–</p><p><code>set @ç”¨æˆ·å˜é‡å:=å€¼ï¼›</code>æˆ–</p><p><code>select @ç”¨æˆ·å˜é‡å:=å€¼</code></p><ol start="2"><li>å±€éƒ¨å˜é‡</li></ol><p>a å£°æ˜</p><p><code>declare å˜é‡å ç±»å‹</code></p><p><code>declare å˜é‡å ç±»å‹ default  å€¼</code></p><p>b èµ‹å€¼</p><p>é€šè¿‡SET æˆ– SELECT</p><p><code>SET @å±€éƒ¨å˜é‡å=å€¼</code> æˆ–</p><p><code>set @å±€éƒ¨å˜é‡å:=å€¼ï¼›</code>æˆ–</p><p><code>select @å±€éƒ¨å˜é‡å:=å€¼</code></p><p>c ä½¿ç”¨</p><p><code>select å±€éƒ¨å˜é‡å</code></p><h4 id="5-3-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#5-3-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="5.3 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>5.3 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h4><p>ç±»ä¼¼äºjavaä¸­çš„æ–¹æ³•ã€‚</p><ol><li><p>æé«˜ä»£ç çš„é‡ç”¨æ€§ã€‚</p></li><li><p>ç®€åŒ–æ“ä½œã€‚</p></li><li><p>å‡å°‘äº†ç¼–è¯‘æ¬¡æ•°ï¼Œå‡å°‘äº†å’Œæ•°æ®åº“çš„è¿æ¥æ¬¡æ•°ã€‚</p></li></ol><ul><li><p>æ¦‚å¿µï¼šä¸€ç»„é¢„å…ˆç¼–è¯‘å¥½çš„SQLè¯­å¥çš„é›†åˆï¼Œç†è§£æˆæ‰¹å¤„ç†è¯­å¥ã€‚</p></li><li><p>åˆ›å»º</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">create procedure å­˜å‚¨è¿‡ç¨‹å(å‚æ•°åˆ—è¡¨)BEGINå­˜å‚¨è¿‡ç¨‹ä½“ï¼ˆä¸€ç»„åˆæ³•çš„SQLè¯­å¥ï¼‰END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼š</p><ol><li><p>å‚æ•°åˆ—è¡¨åŒ…æ‹¬ä¸‰éƒ¨åˆ†</p><p>å‚æ•°æ¨¡å¼ å‚æ•°å å‚æ•°ç±»å‹</p><p>ä¸¾ä¾‹ï¼š</p><p>IN stuname VARCHAR(20)</p><p>å‚æ•°æ¨¡å¼ï¼š</p><p>IN ï¼šè¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å…¥ï¼Œè¯¥å‚æ•°éœ€è¦è°ƒç”¨æ–¹æ³•ä¼ å…¥å€¼</p><p>OUT:è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼</p><p>INOUT:è¯¥å‚æ•°æ—¢å¯ä»¥ä½œä¸ºè¾“å…¥åˆå¯ä»¥ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°æ—¢éœ€è¦ä¼ å…¥å€¼åˆå¯ä»¥è¿”å›å€¼ã€‚</p></li><li><p>å¦‚æœå­˜å‚¨è¿‡ç¨‹ä½“ä»…ä»…åªæœ‰ä¸€å¥è¯ï¼ŒBEGIN ENDå¯ä»¥çœç•¥</p></li></ol></li><li><p>è°ƒç”¨</p></li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CALL å­˜å‚¨è¿‡ç¨‹å(å®å‚åˆ—è¡¨)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DELIMITER $CREATE PROCEDURE myp1(IN beautyName VARCHAR(20), IN newName VARCHAR(20), OUT boyName VARCHAR(20),OUT userCP INT) # è¿˜æœ‰ä¸€ä¸ªINOUTBEGININSERT INTO admin(username, 'password') values('','')END $CALL myp1('æŸ³å²©')$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-4-å­˜å‚¨è¿‡ç¨‹çš„åˆ é™¤å’ŒæŸ¥çœ‹"><a href="#5-4-å­˜å‚¨è¿‡ç¨‹çš„åˆ é™¤å’ŒæŸ¥çœ‹" class="headerlink" title="5.4 å­˜å‚¨è¿‡ç¨‹çš„åˆ é™¤å’ŒæŸ¥çœ‹"></a>5.4 å­˜å‚¨è¿‡ç¨‹çš„åˆ é™¤å’ŒæŸ¥çœ‹</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DROP PROCEDURE P1;SHOW CREATE PROCEDURE P1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="6-å‡½æ•°"><a href="#6-å‡½æ•°" class="headerlink" title="6. å‡½æ•°"></a>6. å‡½æ•°</h2><ul><li>æ¦‚å¿µ</li></ul><p>é€‚åˆåšå¤„ç†æ•°æ®è¿”å›ä¸€ä¸ªç»“æœã€‚ï¼ˆå¢åˆ æ”¹æ˜¯é€‚åˆå­˜å‚¨è¿‡ç¨‹ï¼‰</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE FUNCTION å‡½æ•°åï¼ˆå‚æ•°åˆ—è¡¨ï¼‰RETURNS è¿”å›ç±»å‹beginå‡½æ•°ä½“end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-1-è°ƒç”¨è¯­æ³•"><a href="#6-1-è°ƒç”¨è¯­æ³•" class="headerlink" title="6.1 è°ƒç”¨è¯­æ³•"></a>6.1 è°ƒç”¨è¯­æ³•</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select å‡½æ•°å(å‚æ•°åˆ—è¡¨)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">è¿”å›å…¬å¸çš„å‘˜å·¥ä¸ªæ•°CREATE FUNCTION myf1() RETURNS INTBEGINDECLARE c INT DEFAULT 0;SELECT COUNT(*)FROM employees;RETURN c;END $SELECT myf1() $DROP FUNCTION P1;SHOW CREATE FUNCTION P1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-åˆ†æ”¯ç»“æ„"><a href="#7-åˆ†æ”¯ç»“æ„" class="headerlink" title="7. åˆ†æ”¯ç»“æ„"></a>7. åˆ†æ”¯ç»“æ„</h2><h3 id="7-2-case"><a href="#7-2-case" class="headerlink" title="7.2 case"></a>7.2 case</h3><p>æƒ…å†µä¸€ï¼šï¼ˆä½œä¸ºç‹¬ç«‹è¯­å¥æ‰å¯è¿”å›è¯­å¥ï¼Œå¹¶ä¸”åªèƒ½æ”¾åœ¨BEGIN ENDä¸­ï¼‰</p><p> case å˜é‡|è¡¨è¾¾å¼|å­—æ®µ</p><p>when è¦åˆ¤æ–­çš„å€¼ THEN è¿”å›çš„å€¼æˆ–è¯­å¥1ï¼›</p><p>â€¦</p><p>else è¦è¿”å›çš„å€¼æˆ–è¯­å¥</p><p>END CASE;</p><p>æƒ…å†µäºŒï¼š</p><p> case å˜é‡|è¡¨è¾¾å¼|å­—æ®µ</p><p>when è¦åˆ¤æ–­çš„å€¼ THEN è¿”å›çš„å€¼æˆ–è¯­å¥ï¼›</p><p>â€¦</p><p>else è¦è¿”å›çš„å€¼</p><p>END CASE;</p><h3 id="7-3-IFç»“æ„"><a href="#7-3-IFç»“æ„" class="headerlink" title="7.3 IFç»“æ„"></a>7.3 IFç»“æ„</h3><p>å®ç°å¤šé‡åˆ†æ”¯ã€‚</p><h2 id="8-å¾ªç¯ç»“æ„"><a href="#8-å¾ªç¯ç»“æ„" class="headerlink" title="8. å¾ªç¯ç»“æ„"></a>8. å¾ªç¯ç»“æ„</h2><h3 id="8-1-WHILE"><a href="#8-1-WHILE" class="headerlink" title="8.1 WHILE"></a>8.1 WHILE</h3><p>while å¾ªç¯æ¡ä»¶ do</p><p>å¾ªç¯ä½“</p><p>end while;</p><h3 id="8-2-loop"><a href="#8-2-loop" class="headerlink" title="8.2 loop"></a>8.2 loop</h3><p>loop</p><p>å¾ªç¯ä½“ï¼›//è¦æ­é…leaveã€‚</p><p>end loop;</p><h3 id="8-3-repeat"><a href="#8-3-repeat" class="headerlink" title="8.3 repeat"></a>8.3 repeat</h3><p>ç±»ä¼¼äºdo while</p><p>repeat</p><p>å¾ªç¯ä½“</p><p>until ç»“æŸå¾ªç¯æ¡ä»¶</p><p>end repeatã€‚</p><h2 id="1-MYSQL-æ¶æ„"><a href="#1-MYSQL-æ¶æ„" class="headerlink" title="1. MYSQL æ¶æ„"></a>1. MYSQL æ¶æ„</h2><p><img src="/2021/03/15/database/sqlstructure.PNG"></p><ol><li>è¿æ¥å±‚</li><li>æœåŠ¡å±‚</li><li>å¼•æ“å±‚</li><li>å­˜å‚¨å±‚</li></ol><h2 id="1-ç´¢å¼•"><a href="#1-ç´¢å¼•" class="headerlink" title="1. ç´¢å¼•"></a>1. ç´¢å¼•</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE [UNIQUE] INDEX indexname ON mytable(columnname(length));#æˆ–ALTER mytable ADD [UNIQUE] INDEX [indexname] ON (columnname(length))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-1-åˆ é™¤ç´¢å¼•"><a href="#1-1-åˆ é™¤ç´¢å¼•" class="headerlink" title="1.1 åˆ é™¤ç´¢å¼•"></a>1.1 åˆ é™¤ç´¢å¼•</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DROP INDEX [indexname] ON mytable;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-2-æŸ¥çœ‹ç´¢å¼•"><a href="#1-2-æŸ¥çœ‹ç´¢å¼•" class="headerlink" title="1.2 æŸ¥çœ‹ç´¢å¼•"></a>1.2 æŸ¥çœ‹ç´¢å¼•</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SHOW INDEX FROM tablename;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-3-å»ºç«‹ç´¢å¼•æ¡ä»¶"><a href="#1-3-å»ºç«‹ç´¢å¼•æ¡ä»¶" class="headerlink" title="1.3 å»ºç«‹ç´¢å¼•æ¡ä»¶"></a>1.3 å»ºç«‹ç´¢å¼•æ¡ä»¶</h3><p><img src="/2021/03/15/database/%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95%E6%9D%A1%E4%BB%B6.PNG"></p><h3 id="1-4-ä¸å»ºç«‹ç´¢å¼•æ¡ä»¶"><a href="#1-4-ä¸å»ºç«‹ç´¢å¼•æ¡ä»¶" class="headerlink" title="1.4 ä¸å»ºç«‹ç´¢å¼•æ¡ä»¶"></a>1.4 ä¸å»ºç«‹ç´¢å¼•æ¡ä»¶</h3><ol><li>è¡¨çš„è®°å½•å¤ªå°‘</li><li>ç»å¸¸å¢åˆ æ”¹çš„è¡¨</li><li>æŸä¸ªåˆ—åŒ…å«å¾ˆå¤šé‡å¤çš„æ•°æ®ï¼Œå»ºç«‹ç´¢å¼•æ²¡æœ‰å¤ªå¤§çš„å®é™…æ•ˆæœã€‚</li></ol><h3 id="1-5-ç´¢å¼•å¤±æ•ˆåœºæ™¯"><a href="#1-5-ç´¢å¼•å¤±æ•ˆåœºæ™¯" class="headerlink" title="1.5 ç´¢å¼•å¤±æ•ˆåœºæ™¯"></a>1.5 ç´¢å¼•å¤±æ•ˆåœºæ™¯</h3><ol><li>ç»„åˆç´¢å¼•æœªä½¿ç”¨æœ€å·¦å‰ç¼€ï¼Œä¾‹å¦‚ç»„åˆç´¢å¼•ï¼ˆAï¼ŒBï¼‰ï¼Œwhere B=bä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼›</li><li>likeæœªä½¿ç”¨æœ€å·¦å‰ç¼€ï¼Œwhere A like â€˜%Chinaâ€™ï¼›</li><li>æœç´¢ä¸€ä¸ªç´¢å¼•è€Œåœ¨å¦ä¸€ä¸ªç´¢å¼•ä¸Šåšorder byï¼Œwhere A=a order by Bï¼Œåªä½¿ç”¨Aä¸Šçš„ç´¢å¼•ï¼Œå› ä¸ºæŸ¥è¯¢åªä½¿ç”¨ä¸€ä¸ªç´¢å¼• ï¼›</li><li>orä¼šä½¿ç´¢å¼•å¤±æ•ˆã€‚å¦‚æœæŸ¥è¯¢å­—æ®µç›¸åŒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚ä¾‹å¦‚where A=a1 or A=a2ï¼ˆç”Ÿæ•ˆï¼‰ï¼Œwhere A=a or B=bï¼ˆå¤±æ•ˆï¼‰</li><li>å¦‚æœåˆ—ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œè¦ä½¿ç”¨å¼•å·ã€‚ä¾‹å¦‚where A=â€™Chinaâ€™ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆï¼ˆä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼‰ï¼›</li><li>åœ¨ç´¢å¼•åˆ—ä¸Šçš„æ“ä½œï¼Œå‡½æ•°ï¼ˆupper()ç­‰ï¼‰ã€orã€ï¼=(&lt;&gt;)ã€not inç­‰ï¼›</li></ol><p><img src="/2021/03/15/database/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88.PNG"></p><h3 id="1-6-æ€§èƒ½ä¸‹é™"><a href="#1-6-æ€§èƒ½ä¸‹é™" class="headerlink" title="1.6 æ€§èƒ½ä¸‹é™"></a>1.6 æ€§èƒ½ä¸‹é™</h3><ol><li>æŸ¥è¯¢è¯­å¥å†™çš„çƒ‚</li><li>ç´¢å¼•å¤±æ•ˆ</li><li>å…³è”æŸ¥è¯¢å¤ªå¤šjoin</li><li>æœåŠ¡å™¨è°ƒä¼˜åŠå„ä¸ªå‚æ•°çš„è®¾ç½®ã€‚</li></ol><h3 id="1-7-row-gap-lock-next-key-lock"><a href="#1-7-row-gap-lock-next-key-lock" class="headerlink" title="1.7 row\gap lock\next_key lock"></a>1.7 row\gap lock\next_key lock</h3><p>é¦–å…ˆï¼Œè¦æ˜ç™½é”æ˜¯å»ºç«‹åœ¨ç´¢å¼•ä¸Šçš„ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯ç´¢å¼•ï¼Œé‚£ä¹ˆå°±ä¼šé”ä½æ•´å¼ è¡¨ã€‚</p><p>å…¶æ¬¡ï¼Œåˆ†æƒ…å†µè®¨è®ºç´¢å¼•ç±»å‹ï¼š</p><p>æ¯”å¦‚æˆ‘æ•°æ®åº“ä¸­æœ‰è¿™ä¹ˆä¸€å¼ è¡¨user2ï¼š</p><p><img src="/2021/03/15/database/rowlock.PNG"></p><ol><li><p>UNIQUE ï¼ˆå”¯ä¸€é”®ç´¢å¼• idï¼‰</p><p>æ‰§è¡Œ <code>select * from user2 where id = 5 for update</code>ï¼›</p><ol><li>é”æœ‰æ­¤çºªå½•ï¼ˆ5ï¼‰ï¼Œnext_key locké€€åŒ–æˆè¡Œé”ï¼Œåªé”å®šè¿™ä¸€è¡Œã€‚</li><li>é”æ— æ­¤è®°å½•ï¼ˆæ¯”å¦‚å°†ä¸Šé¢çš„è¯­å¥æ”¹ä¸ºid=6ï¼‰ï¼Œå”¯ä¸€ç´¢å¼•éƒ½æ˜¯ç¡®å®šçš„ä¸ç”¨è¾¹ç•Œï¼Œé€€åŒ–æˆgap é”ï¼Œé”å®šè¿™ä¸ªèŒƒå›´ï¼ˆå¼€åŒºé—´ ï¼ˆ5ï¼Œ7ï¼‰ï¼‰ã€‚</li></ol></li><li><p>æ™®é€šç´¢å¼• ï¼ˆvalï¼‰</p><p>æ‰§è¡Œ <code>select * from user2 where val = 3 for update</code>ï¼›</p><ol><li>é”æœ‰è®°å½•(val = 3)ï¼Œé”å®šèŒƒå›´æ˜¯(1,3] [3,6]</li><li>é”æ— è®°å½•(ä¸Šé¢è¯­å¥ val = 4) ,é”å®šèŒƒå›´æ˜¯(3,6]ã€‚</li></ol><p>æ™®é€šç´¢å¼•é”å®šèŒƒå›´+ä¸‹è¾¹ç•Œã€‚</p></li></ol><p>è¿™å¥è¯æ˜¯åˆ«äººçš„æ€»ç»“ï¼š<br>1ï¼ŒRecord Lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”<br>2ï¼ŒGap Lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚GAPé”çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åŒä¸€äº‹åŠ¡çš„ä¸¤æ¬¡å½“å‰è¯»ï¼Œå‡ºç°å¹»è¯»çš„æƒ…å†µ<br>3ï¼ŒNext-Key Lockï¼š1+2ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚å¯¹äºè¡Œçš„æŸ¥è¯¢ï¼Œéƒ½æ˜¯é‡‡ç”¨è¯¥æ–¹æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯è§£å†³å¹»è¯»çš„é—®é¢˜ã€‚</p><h2 id="2-7ç§JOIN"><a href="#2-7ç§JOIN" class="headerlink" title="2. 7ç§JOIN"></a>2. 7ç§JOIN</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT DISTINCT &lt;select_list&gt;FROM&lt; left_table&gt; &lt;join_type &gt;JOIN &lt; right_table&gt; ON &lt;join_condition&gt;where&lt; where_condition &gt;GROUP BY&lt; group_by_list &gt;HAVING&lt; having_condition &gt;ORDER BY&lt; order_by_condition &gt;LIMIT &lt; limit_number &gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/03/15/database/%E6%9C%BA%E8%AF%BB%E9%A1%BA%E5%BA%8F.PNG"></p><p><img src="/2021/03/15/database/JOIN7%E7%A7%8D.PNG"></p><h3 id="7-1-SQL-ä¼˜åŒ–å™¨"><a href="#7-1-SQL-ä¼˜åŒ–å™¨" class="headerlink" title="7.1 SQL ä¼˜åŒ–å™¨"></a>7.1 SQL ä¼˜åŒ–å™¨</h3><ul><li>æ¦‚å¿µ</li></ul><p>å®ƒæŒ‰ç…§è‡ªå·±æœé›†çš„ç»Ÿè®¡ä¿¡æ¯ç»™å‡ºå®ƒè®¤ä¸ºæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚</p><h3 id="7-2-EXPLAIN"><a href="#7-2-EXPLAIN" class="headerlink" title="7.2 EXPLAIN"></a>7.2 EXPLAIN</h3><ol><li>æ…¢æŸ¥è¯¢çš„å¼€å¯å¹¶æ•è·ã€‚</li><li>explain + æ…¢SQLåˆ†æ</li><li>show profileæŸ¥è¯¢SQLåœ¨MysqlæœåŠ¡å™¨é‡Œé¢çš„æ‰§è¡Œç»†èŠ‚å’Œç”Ÿå‘½å‘¨æœŸæƒ…å†µã€‚</li><li>SQLæ•°æ®åº“æœåŠ¡å™¨çš„å‚æ•°è°ƒä¼˜ã€‚</li></ol><table><thead><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr></thead><tbody><tr><td>selectæŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«çš„ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–æ“ä½œè¡¨çš„é¡ºåºã€‚</td><td>SIMPLEã€PRIMARYã€SUBQUERYã€DERIVEDã€UNIONã€UNION RESULT æŸ¥è¯¢çš„ç±»å‹ï¼Œæ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢</td><td>è¡ç”Ÿ = derived (ç»™è¿™ä¸ªè¡¨é‡æ–°èµ·äº†ä¸€ä¸ªåå­—)</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>idç›¸åŒï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šåˆ°ä¸‹</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>id ä¸ç›¸åŒï¼Œidçš„åºå·ä¼šé€’å¢ï¼Œidå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œã€‚</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>id ç›¸åŒä¸åŒï¼ŒåŒæ—¶å­˜åœ¨</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><ul><li>id è¡¨çš„è¯»å–é¡ºåº</li></ul><ul><li><p>select_type æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹</p><ul><li><p>ç®€å•çš„selectæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…UNION</p></li><li><p>PRIMARY é¸¡è›‹å£³ï¼Œæœ€ååŠ è½½çš„é‚£ä¸ª</p></li><li><p>SUBQUERY æ‹¬å·é‡Œçš„å­æŸ¥è¯¢</p></li><li><p>DERIVED ä¸´æ—¶è¡¨ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œçš„ã€‚FROM åˆ—è¡¨åŒ…å«å­æŸ¥è¯¢è¡¨è®°derivedã€‚</p></li><li><p>UNION è‹¥ç¬¬äºŒä¸ªSELECTå‡ºç°åœ¨UNIONä¹‹åï¼Œåˆ™è¢«æ ‡è®°ä¸ºUNIONã€‚è‹¥UNIONå‡ºç°åœ¨FROMçš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚SELECTè¢«æ ‡è®°ä¸ºDERIVEDã€‚</p></li><li><p>UNION RESULT ä»unionè¡¨ä¸­è·å–unionç»“æœã€‚</p></li></ul></li><li><p>type è®¿é—®ç±»å‹</p><ul><li><p> |ALL|index|range|ref|eq_ref|const| system|null|</p></li><li><p> ä»æœ€å¥½åˆ°æœ€å·®ä¾æ¬¡å¦‚ä¸‹ï¼š system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</p></li><li><p> åªè¦è¾¾åˆ°rangeçº§åˆ«ï¼Œå°±å¤Ÿå¥½äº†ã€‚</p></li><li><p> system è¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ã€‚è¿™æ˜¯ç±»å‹çš„ç‰¹ä¾‹ï¼Œå¹³æ—¶ä¸ä¼šå‡ºç°ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p></li><li><p> const è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconstç”¨äºæ¯”è¾ƒprimary keyæˆ–è€…uniqueç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äº<code>where</code>ä¸­ï¼ŒMYSQLå°±åªèƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚</p></li><li><p> eq_ref å”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æã€‚</p></li><li><p> ref éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼å¾—æ‰€æœ‰è¡Œã€‚æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œã€‚å®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥å®ƒå±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ã€‚</p></li><li><p> range åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚keyåˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ã€‚ where é‡Œé¢ç”¨äº†betweenå•¥çš„</p></li><li><p> index åªéå†ç´¢å¼•æ ‘ã€‚ select id from table1.</p></li><li><p> ALL å…¨è¡¨æ‰«æã€‚</p></li></ul></li></ul><ul><li>pobbible_keys</li></ul><p>æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚</p><p>æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨ã€‚</p><ul><li>key</li></ul><p>å®é™…ç”¨åˆ°çš„ç´¢å¼•ã€‚å¦‚æœä¸ºNULL ï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºç°åœ¨keyåˆ—è¡¨ä¸­ã€‚</p><ul><li>key_len</li></ul><p>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚ken_lenæ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³key_lenæ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å¾—å‡ºçš„ã€‚</p><ul><li>ref</li></ul><p>æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ã€‚</p><ul><li>rows ï¼ˆæ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«æŸ¥è¯¢ä¼˜åŒ–å™¨æŸ¥è¯¢ï¼‰</li></ul><p>æ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°ã€‚</p><ul><li>Extra</li></ul><p>åŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„ä¿¡æ¯ã€‚</p><p>â€‹    * Using filesort </p><p>â€‹    æ–‡ä»¶å†…æ’åºã€‚è¯´æ˜mysqlä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚MYSQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºç§°ä¹‹ä¸ºâ€œæ–‡ä»¶å†…æ’åºâ€ã€‚ï¼ˆå¤åˆç´¢å¼•ï¼Œæ’åºæ²¡æœ‰ç”¨å»ºç«‹ç´¢å¼•æ—¶çš„é¡ºåºï¼‰</p><p>â€‹    * using temporary</p><p>ä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœã€‚MYSQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äºæ’åºorder by å’Œ åˆ†å¸ƒæŸ¥è¯¢ group byã€‚group by è¯­å¥ä¸€èˆ¬ä¼šäº§ç”Ÿä¸´æ—¶è¡¨ã€‚</p><p>â€‹    * using Index</p><p>è¡¨ç¤ºç›¸åº”çš„selectæ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•(Covering Index)ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡ä¸é”™ï¼ï¼ï¼ï¼ˆè¦†ç›–ç´¢å¼•æŒ‡çš„å°±æ˜¯ç°åœ¨ç´¢å¼•é‡Œé¢å·²ç»è¦†ç›–äº†ä½ è¦æŸ¥çš„ä¸œè¥¿äº†ï¼Œä½ ä¸ç”¨å†è¯»å–æ•°æ®æ–‡ä»¶äº†ã€‚ï¼‰</p><p>å¦‚æœåŒæ—¶å‡ºç°using whereï¼Œ è¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ã€‚</p><p>å¦‚æœæ²¡æœ‰å‡ºç°using whereï¼Œ è¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚</p><ul><li><p>using where </p><p>ä½¿ç”¨whereè¿‡æ»¤</p></li><li><p>using join buffer ä½¿ç”¨è¿æ¥ç¼“å†²</p></li><li><p>impossible where whereå­å¥æ€»æ˜¯falseï¼Œä¸èƒ½ç”¨æ¥è·å–å…ƒç´ </p></li><li><p>select tables optimized away æ²¡æœ‰groupbyå­—å¥çš„æƒ…å†µä¸‹ï¼ŒåŸºäºç´¢å¼•ä¼˜åŒ–MIN/MAXæ“ä½œæˆ–è€…å¯¹äºmyisamå­˜å‚¨å¼•æ“ä¼˜åŒ–count(*)æ“ä½œï¼Œä¸å¿…ç­‰åˆ°æ‰§è¡Œé˜¶æ®µå†è¿›è¡Œè®¡ç®—ï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ç”Ÿæˆé˜¶æ®µå³å®Œæˆä¼˜åŒ–ã€‚</p></li><li><p>distinct ä¼˜åŒ–distinctæ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œã€‚</p></li></ul><ol><li>è¡¨çš„è¯»å–é¡ºåº</li></ol><ol start="2"><li>æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹</li></ol><ol start="3"><li>å“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨</li></ol><ol start="4"><li>å“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨</li></ol><ol start="5"><li>è¡¨ä¹‹é—´çš„å¼•ç”¨</li></ol><ol start="6"><li>æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢</li></ol><h3 id="7-3-å°è¡¨é©±åŠ¨å¤§è¡¨"><a href="#7-3-å°è¡¨é©±åŠ¨å¤§è¡¨" class="headerlink" title="7.3 å°è¡¨é©±åŠ¨å¤§è¡¨"></a>7.3 å°è¡¨é©±åŠ¨å¤§è¡¨</h3><p>å½“Bè¡¨çš„æ•°æ®é›†å¿…é¡»å°äºAè¡¨æ•°æ®é›†æ—¶ï¼Œç”¨inä¼˜äºexistsã€‚</p><p>existså­æŸ¥è¯¢åªè¿”å›<code>true</code>æˆ–<code>false</code>ã€‚</p><h3 id="7-4-ORDER-BY-ä½¿ç”¨indexæ’åº"><a href="#7-4-ORDER-BY-ä½¿ç”¨indexæ’åº" class="headerlink" title="7.4 ORDER BY  ä½¿ç”¨indexæ’åº"></a>7.4 ORDER BY  ä½¿ç”¨indexæ’åº</h3><ol><li>ORDER BY è¯­å¥ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰åˆ—ã€‚</li><li>ä½¿ç”¨whereå­å¥ä¸Order BY å­å¥æ¡ä»¶åˆ—ç»„åˆæ»¡è¶³ç´¢å¼•æœ€å·¦å‰åˆ—ã€‚</li></ol><h3 id="7-5-filesort"><a href="#7-5-filesort" class="headerlink" title="7.5 filesort"></a>7.5 filesort</h3><ol><li>åŒè·¯æ’åº</li></ol><p>MYSQL 4.1ä¹‹å‰ä½¿ç”¨åŒè·¯æ’åºï¼Œæ„æ€æ˜¯ä¸¤æ¬¡æ‰«æç£ç›˜ï¼Œæœ€ç»ˆå¾—åˆ°æ•°æ®ã€‚ï¼ˆä»ç£ç›˜è¯»å–æ’åºå­—æ®µï¼Œåœ¨bufferè¿›è¡Œæ’åºï¼Œå†ä»ç£ç›˜è¯»å–å…¶ä»–å­—æ®µï¼‰ã€‚</p><p>è¯»å–è¡ŒæŒ‡é’ˆå’Œ<code>orderby</code>åˆ—ï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«æå·²ç»æ’åºå¥½çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§åˆ—è¡¨ä¸­çš„å€¼é‡æ–°ä»åˆ—è¡¨ä¸­</p><ol start="2"><li>å•è·¯æ’åº</li></ol><p>ä»ç£ç›˜è¯»å–æŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰åˆ—ï¼ŒæŒ‰ç…§orderbyåˆ—åœ¨bufferå¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºï¼Œå®ƒçš„æ•ˆç‡æ›´å¿«ä¸€äº›ï¼Œé¿å…å‡ºç°äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚å¹¶ä¸”æŠŠéšæœºIOå˜æˆäº†é¡ºåºIOï¼Œä½†æ˜¯å®ƒä¼šä½¿ç”¨æ›´å¤šç©ºé—´ï¼Œå› ä¸ºæŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ã€‚</p><p><font color="red">MYSQLä¸¤ç§æ’åºï¼šæ–‡ä»¶æ’åºå’Œæ‰«ææœ‰åºç´¢å¼•æ’åºã€‚</font></p><h3 id="7-6-æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#7-6-æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="7.6 æ…¢æŸ¥è¯¢æ—¥å¿—"></a>7.6 æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>mysqlé»˜è®¤æ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®ã€‚å¦‚æœä¸æ˜¯è°ƒä¼˜ï¼Œä¸€èˆ¬ä¸å¼€å¯ã€‚</p><p><code>SHOW VARIABLES LIKE '%slow_query_log%'</code></p><p>ç”±<code>long_query_time</code>æ§åˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹<code>long_query_time</code>çš„å€¼ä¸º10ç§’ã€‚</p><p><code>mysqldumpslow -s r -t 10 XXX.log</code> å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQLã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œå‘ç°é—®é¢˜</p><p>ç¬¬äºŒæ­¥ï¼Œ å¼€å¯æ…¢æŸ¥è¯¢ æŠ“å–å’Œæˆªå–</p><p>ç¬¬ä¸‰æ­¥ï¼Œexplain </p><p>ç¬¬å››æ­¥ï¼Œ show profile æ›´æ”¹é…ç½®</p><h3 id="7-7-Show-Profile"><a href="#7-7-Show-Profile" class="headerlink" title="7.7 Show Profile"></a>7.7 Show Profile</h3><p><code>Show Profile</code>æ˜¯mysqlæä¾›å¯ä»¥ç”¨æ¥åˆ†æå½“å‰ä¼šè¯ä¸­è¯­å¥æ‰§è¡Œçš„èµ„æºæ¶ˆè€—æƒ…å†µã€‚å¯ä»¥ç”¨äºSQLçš„è°ƒä¼˜çš„æµ‹é‡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°å¤„äºå…³é—­çŠ¶æ€ï¼Œå¹¶ä¿å­˜æœ€è¿‘15æ¬¡çš„è¿è¡Œç»“æœã€‚</p><p>ä½¿ç”¨æ­¥éª¤ï¼š</p><ol><li><p><code>Show variables like 'prifiling'</code> æŸ¥çœ‹æ˜¯å¦å…³é—­ï¼Œå‡†å¤‡å°†å…¶æ‰“å¼€</p></li><li><p><code>set profiling=on</code></p></li><li><p>æŸ¥çœ‹ç»“æœ <code>show profiles</code></p></li><li><p><code>show profile cpu,block io for query 2;</code> 2è¡¨ç¤ºæŸ¥è¯¢è¯­å¥çš„id</p><p>è¿™é‡Œè¯­å¥ä¸­åªå†™äº†cpuå’Œioï¼Œè¿˜æœ‰å…¶ä»–ä¿¡æ¯ï¼Œå‚æ•°æœ‰ï¼š</p><p><img src="/2021/03/15/database/showprofiles.PNG"></p></li><li></li></ol><p><img src="/2021/03/15/database/showprofilep.PNG"></p><h3 id="7-8-å…¨å±€æŸ¥è¯¢æ—¥å¿—"><a href="#7-8-å…¨å±€æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="7.8 å…¨å±€æŸ¥è¯¢æ—¥å¿—"></a>7.8 å…¨å±€æŸ¥è¯¢æ—¥å¿—</h3><p>ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¼€å¯è¿™ä¸ªåŠŸèƒ½ã€‚æµ‹è¯•ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚</p><p><code>set global general_log=1</code></p><p><code>set global log_output='TABLE'</code>æ­¤åï¼Œæ‰€ç¼–å†™çš„sqlè¯­å¥ï¼Œå°†ä¼šè®°å½•åˆ°mysqlåº“é‡Œçš„general_logè¡¨é‡Œï¼Œå¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼š</p><p><code>select * from mysql.general_log</code></p><h2 id="3-é”æœºåˆ¶"><a href="#3-é”æœºåˆ¶" class="headerlink" title="3. é”æœºåˆ¶"></a>3. é”æœºåˆ¶</h2><h3 id="3-1-è¡¨é”"><a href="#3-1-è¡¨é”" class="headerlink" title="3.1 è¡¨é”"></a>3.1 è¡¨é”</h3><ul><li><code>show open tables</code></li><li>æ‰‹åŠ¨ä¸Šé”</li></ul><p><code>lock table è¡¨åå­— read(write)ï¼Œ è¡¨åå­—2 read(write)ï¼Œ å…¶ä»–</code></p><ul><li>é‡Šæ”¾é”</li></ul><p><code>unlock tables</code></p><p>è¯»é”çš„ä½¿ç”¨ï¼š</p><p>åŠ äº†è¯»é”ï¼Œå¯ä»¥è¯»ï¼Œä½†æ˜¯ä¸èƒ½å†™è¿™ä¸ªè¡¨äº†ï¼Œè¿™ä¸ªæ•°æ®åº“ä¸­çš„å…¶ä»–è¡¨ä¹Ÿä¸èƒ½è¯»äº†ã€‚ï¼ˆè¯»å†™å¤åˆ¶çš„åŸå› ï¼‰</p><p>ç¬¬äºŒä¸ªsessionå†æ¥æ­¤æ•°æ®åº“ä¸­çš„æ›´æ”¹å…¶ä»–è¡¨ä¹Ÿåªèƒ½é˜»å¡ã€‚</p><p>å†™é”çš„ä½¿ç”¨ï¼š</p><p>åŠ äº†å†™é”ï¼Œå¯ä»¥æ›´æ”¹æ­¤è¡¨ï¼Œä¸èƒ½æŸ¥è¯¢å…¶ä»–è¡¨ã€‚</p><p>ç¬¬äºŒä¸ªsessionå¯ä»¥æŸ¥å…¶ä»–è¡¨ï¼Œä½†æ˜¯ä¸èƒ½æŸ¥æ­¤è¡¨ã€‚</p><h4 id="3-1-1-MYISAM"><a href="#3-1-1-MYISAM" class="headerlink" title="3.1.1 MYISAM"></a>3.1.1 MYISAM</h4><p>åè¯»é”ã€‚åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥(select)å‰ï¼Œä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æ“ä½œå‰ï¼Œä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ã€‚</p><ul><li>è¡¨çº§é”æœ‰ä¸¤ç§æ¨¡å¼</li></ul><p>è¡¨å…±äº«è¯»é”ï¼ˆTable Read Lock)</p><p>è¡¨ç‹¬å å†™é”ï¼ˆTable Write Lockï¼‰</p><table><thead><tr><th align="center">é”ç±»å‹</th><th align="center">å¯å¦å…¼å®¹</th><th align="center">è¯»é”</th><th align="center">å†™é”</th></tr></thead><tbody><tr><td align="center">è¯»é”</td><td align="center">æ˜¯</td><td align="center">æ˜¯</td><td align="center">å¦</td></tr><tr><td align="center">å†™é”</td><td align="center">æ˜¯</td><td align="center">å¦</td><td align="center">å¦</td></tr></tbody></table><ol><li>å¯¹Myisamè¡¨çš„è¯»æ“ä½œï¼ˆåŠ è¯»é”ï¼‰ï¼Œä¸ä¼šé˜»å¡å…¶ä»–è¿›ç¨‹å¯¹åŒä¸€è¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡å¯¹åŒä¸€è¡¨çš„å†™è¯·æ±‚ã€‚åªæœ‰å½“è¯»é”é‡Šæ”¾åï¼Œæ‰ä¼šæ‰§è¡Œå…¶ä»–è¿›ç¨‹çš„å†™æ“ä½œã€‚</li><li>å¯¹MyISAMè¡¨çš„å†™æ“ä½œï¼ˆåŠ å†™é”ï¼‰ï¼Œä¼šé˜»å¡å…¶ä»–è¿›ç¨‹å¯¹åŒä¸€è¡¨çš„è¯»å’Œå†™æ“ä½œï¼Œåªæœ‰å½“å†™é”é‡Šæ”¾åï¼Œæ‰ä¼šæ‰§è¡Œå…¶ä»–è¿›ç¨‹çš„è¯»å†™æ“ä½œã€‚</li></ol><h4 id="3-2-1-åˆ†æè¡¨çš„é”å®š"><a href="#3-2-1-åˆ†æè¡¨çš„é”å®š" class="headerlink" title="3.2.1 åˆ†æè¡¨çš„é”å®š"></a>3.2.1 åˆ†æè¡¨çš„é”å®š</h4><p><code>show status like 'table%'</code></p><h3 id="3-2-è¡Œçº§é”"><a href="#3-2-è¡Œçº§é”" class="headerlink" title="3.2 è¡Œçº§é”"></a>3.2 è¡Œçº§é”</h3><p>æŸ¥çœ‹å‘½ä»¤ï¼š</p><p><code>show status like 'innodb_row_lock%'</code>;</p><p><img src="/2021/03/15/database/%E8%A1%8C%E9%94%81%E6%9F%A5%E7%9C%8B.PNG"></p><p><img src="/2021/03/15/database/%E8%A1%8C%E9%94%81%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A.PNG"></p><p>Innodbæ”¯æŒï¼Œmyisamä¸æ”¯æŒã€‚</p><p>ç´¢å¼•å¤±æ•ˆï¼Œå°†ä¼šä½¿å¾—è¡Œé”å˜è¡¨é”ã€‚</p><h4 id="3-2-1-é—´éš™é”"><a href="#3-2-1-é—´éš™é”" class="headerlink" title="3.2.1 é—´éš™é”"></a>3.2.1 é—´éš™é”</h4><p>å½“ä½¿ç”¨èŒƒå›´æ¡ä»¶è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”ã€‚å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åšâ€é—´éš™é”â€œã€‚InnoDBä¹Ÿä¼šç»™è¿™ä¸ªâ€é—´éš™â€œåŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”ã€‚</p><h4 id="3-2-2-é”å®šæŸä¸€è¡Œ"><a href="#3-2-2-é”å®šæŸä¸€è¡Œ" class="headerlink" title="3.2.2 é”å®šæŸä¸€è¡Œ"></a>3.2.2 é”å®šæŸä¸€è¡Œ</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">begin;select * from test_innodb_lock where a = 8 for update;#é”å®šä¸€è¡Œåï¼Œå…¶ä»–æ“ä½œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°commitï¼›commit;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="4-ä¸»ä»å¤åˆ¶"><a href="#4-ä¸»ä»å¤åˆ¶" class="headerlink" title="4. ä¸»ä»å¤åˆ¶"></a>4. ä¸»ä»å¤åˆ¶</h2><p><img src="/2021/03/15/database/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.PNG"></p><p>å¤åˆ¶åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol><li>masterå°†æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—(binary log)ã€‚è¿™äº›è®°å½•è¿‡ç¨‹å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼Œbinary log eventsã€‚</li><li>slaveå°†masterçš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—ï¼ˆrelay log);</li><li>slaveé‡åšä¸­ç»§æ—¥å¿—çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­ã€‚mysqlå¤åˆ¶æ˜¯å¼‚æ­¥ä¸”ä¸²è¡ŒåŒ–ã€‚</li></ol><h4 id="4-1-é…ç½®"><a href="#4-1-é…ç½®" class="headerlink" title="4.1 é…ç½®"></a>4.1 é…ç½®</h4><ol><li>ä¸»æœåŠ¡å”¯ä¸€ID</li><li>å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—<ol><li><code>log-bin = è‡ªå·±æœ¬åœ°çš„è·¯å¾„/mysqlbin</code></li></ol></li><li>[å¯é€‰]å¯ç”¨é”™è¯¯æ—¥å¿—<ol><li><code>log-err = è‡ªå·±æœ¬åœ°è·¯å¾„/mysqlerr</code></li></ol></li><li>[å¯é€‰]æ ¹ç›®å½•<ol><li><code>basedir = "è‡ªå·±æœ¬åœ°è·¯å¾„"</code></li></ol></li><li>[å¯é€‰]ä¸´æ—¶ç›®å½•<ol><li><code>tmpdir = "è‡ªå·±æœ¬åœ°è·¯å¾„"</code></li></ol></li><li>[å¯é€‰]æ•°æ®ç›®å½•<ol><li><code>datadir = "è‡ªå·±æœ¬åœ°è·¯å¾„/Data/"</code></li></ol></li><li>[å¯é€‰]è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“<ol><li><code>binlog-ignore-db = mysql</code></li></ol></li></ol><p>é…ç½®æ–‡ä»¶æ›´æ”¹åï¼Œé‡å¯æ•°æ®åº“æœåŠ¡ã€‚</p><h1 id="MYSQL-é¢è¯•é¢˜"><a href="#MYSQL-é¢è¯•é¢˜" class="headerlink" title="MYSQL é¢è¯•é¢˜"></a>MYSQL é¢è¯•é¢˜</h1><h3 id="0-SQL-è¯­å¥ä¸»è¦å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹-3-ä¸ªç±»åˆ«ã€‚-DDL-DML-DCL"><a href="#0-SQL-è¯­å¥ä¸»è¦å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹-3-ä¸ªç±»åˆ«ã€‚-DDL-DML-DCL" class="headerlink" title="0. SQL è¯­å¥ä¸»è¦å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹ 3 ä¸ªç±»åˆ«ã€‚ DDL DML DCL"></a>0. <strong>SQL è¯­å¥ä¸»è¦å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹ 3 ä¸ªç±»åˆ«ã€‚</strong> DDL DML DCL</h3><p><strong>DDLï¼ˆData Definition Languagesï¼‰è¯­å¥ï¼š</strong>æ•°æ®å®šä¹‰è¯­è¨€ï¼Œè¿™äº›è¯­å¥å®šä¹‰äº†ä¸åŒçš„æ•°æ®æ®µã€æ•°æ®åº“ã€è¡¨ã€åˆ—ã€ç´¢å¼•ç­‰æ•°æ®åº“å¯¹è±¡çš„å®šä¹‰ã€‚å¸¸ç”¨çš„è¯­å¥å…³é”®å­—ä¸»è¦åŒ…æ‹¬ createã€dropã€alterç­‰ã€‚</p><p><strong>DMLï¼ˆData Manipulation Languageï¼‰è¯­å¥ï¼š</strong>æ•°æ®æ“çºµè¯­å¥ï¼Œç”¨äºæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°å’ŒæŸ¥è¯¢æ•°æ®åº“è®°å½•ï¼Œå¹¶æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼Œå¸¸ç”¨çš„è¯­å¥å…³é”®å­—ä¸»è¦åŒ…æ‹¬ insertã€deleteã€udpate å’Œselect ç­‰ã€‚(å¢æ·»æ”¹æŸ¥ï¼‰</p><p><strong>DCLï¼ˆData Control Languageï¼‰è¯­å¥ï¼š</strong>æ•°æ®æ§åˆ¶è¯­å¥ï¼Œç”¨äºæ§åˆ¶ä¸åŒæ•°æ®æ®µç›´æ¥çš„è®¸å¯å’Œè®¿é—®çº§åˆ«çš„è¯­å¥ã€‚è¿™äº›è¯­å¥å®šä¹‰äº†æ•°æ®åº“ã€è¡¨ã€å­—æ®µã€ç”¨æˆ·çš„è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«ã€‚ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬ grantã€revoke ç­‰ã€‚</p><h3 id="1-æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ"><a href="#1-æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ" class="headerlink" title="1. æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ"></a>1. æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ</h3><p>ç¬¬ä¸€èŒƒå¼ï¼šæ¯ä¸ªåˆ—éƒ½ä¸å¯ä»¥å†æ‹†åˆ†ã€‚</p><p>ç¬¬äºŒèŒƒå¼ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œæ¶ˆé™¤éä¸»é”®å †ç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚ï¼ˆæ¯”å¦‚é€šè¿‡ç ï¼Œå¿…é¡»å¯ä»¥ç¡®å®šè¡¨ä¸­çš„å…¶ä»–æ‰€æœ‰å±æ€§ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–å±æ€§æ— æ³•æ¨æµ‹ï¼Œåˆ™ä¸ç¬¦åˆç¬¬äºŒèŒƒå¼ï¼‰</p><p><img src="/2021/03/15/database/%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F%E5%AE%9E%E4%BE%8B.PNG"></p><p>å›¾ä¸­é€šè¿‡id å’Œå§“åç»„æˆäº†ç ï¼Œå¯ä»¥æ¨æ–­ç³»åå’Œç³»ä¸»ä»»ï¼Œä½†æ˜¯è¯¾åæ— æ³•æ¨æµ‹ï¼Œæ‰€ä»¥ä¸æ˜¯ç¬¬äºŒèŒƒå¼ã€‚</p><p><img src="/2021/03/15/database/%E4%BA%8C%E8%8C%83%E5%BC%8F%E9%97%AE%E9%A2%98.PNG"></p><p>æ’å…¥å¼‚å¸¸ï¼šå¾€è¿™å¼ è¡¨æ–°æ’å…¥ä¸€ä¸ªç³»idç©ºçš„ï¼Œæ’ä¸è¿›å»ã€‚</p><p>åˆ é™¤å¼‚å¸¸ï¼šåˆ é™¤idç³»ä¹Ÿåˆ é™¤äº†ã€‚</p><p>ç¬¬ä¸‰èŒƒå¼ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œæ¶ˆé™¤ä¼ é€’å‡½æ•°ä¾èµ–ã€‚éä¸»é”®åˆ—åªä¾èµ–äºä¸»é”®ï¼Œä¸ä¾èµ–äºå…¶ä»–éä¸»é”®ã€‚ </p><p><img src="/2021/03/15/database/%E4%B8%89%E8%8C%83%E5%BC%8F%E5%AE%9E%E4%BE%8B.PNG"></p><p>ç³»ä¸»ä»»ä¾èµ–äºç³»åï¼Œç³»ååˆä¾èµ–äºidï¼Œç³»ä¸»ä»»åˆä¾èµ–äºidï¼ˆä¼ é€’äº†ï¼‰ã€‚</p><p>è¿˜æœ‰BCNFèŒƒå¼ 4èŒƒå¼ 5èŒƒå¼ï¼Œè¿™å‡ ä¸ªå¾ˆå°‘è¯´äº†</p><h3 id="2-æ•°æ®åº“çš„æƒé™è¡¨"><a href="#2-æ•°æ®åº“çš„æƒé™è¡¨" class="headerlink" title="2. æ•°æ®åº“çš„æƒé™è¡¨"></a>2. æ•°æ®åº“çš„æƒé™è¡¨</h3><p>MySQLæœåŠ¡å™¨é€šè¿‡æƒé™è¡¨æ¥æ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œæƒé™è¡¨å­˜æ”¾åœ¨<code>mysql</code>æ•°æ®åº“é‡Œï¼Œç”±mysql_install_dbè„šæœ¬åˆå§‹åŒ–ã€‚è¿™äº›æƒé™è¡¨åˆ†åˆ«userï¼Œdbï¼Œtable_privï¼Œcolumns_privå’Œhostã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™äº›è¡¨çš„ç»“æ„å’Œå†…å®¹ï¼š</p><ul><li>useræƒé™è¡¨ï¼šè®°å½•å…è®¸è¿æ¥åˆ°æœåŠ¡å™¨çš„ç”¨æˆ·å¸å·ä¿¡æ¯ï¼Œé‡Œé¢çš„æƒé™æ˜¯å…¨å±€çº§çš„ã€‚</li><li>dbæƒé™è¡¨ï¼šè®°å½•å„ä¸ªå¸å·åœ¨å„ä¸ªæ•°æ®åº“ä¸Šçš„æ“ä½œæƒé™ã€‚</li><li>table_privæƒé™è¡¨ï¼šè®°å½•æ•°æ®è¡¨çº§çš„æ“ä½œæƒé™ã€‚</li><li>columns_privæƒé™è¡¨ï¼šè®°å½•æ•°æ®åˆ—çº§çš„æ“ä½œæƒé™ã€‚</li><li>hostæƒé™è¡¨ï¼šé…åˆdbæƒé™è¡¨å¯¹ç»™å®šä¸»æœºä¸Šæ•°æ®åº“çº§æ“ä½œæƒé™ä½œæ›´ç»†è‡´çš„æ§åˆ¶ã€‚è¿™ä¸ªæƒé™è¡¨ä¸å—GRANTå’ŒREVOKEè¯­å¥çš„å½±å“ã€‚</li></ul><h3 id="3-innodb-myisam"><a href="#3-innodb-myisam" class="headerlink" title="3. innodb myisam"></a>3. innodb myisam</h3><p>   1.æ”¯æŒäº‹åŠ¡ä¸ä¸æ”¯æŒã€‚</p><ol start="2"><li>æ”¯æŒå¤–é”®ä¸å¦ã€‚</li><li>èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•ã€‚</li><li>innodbè¡¨çº§æŸ¥è¯¢ï¼Œä¸ä¿å­˜å…·ä½“è¡Œæ•°ã€‚myisamç”¨ä¸€ä¸ªå˜é‡ä¿å­˜äº†æ•´ä¸ªè¡¨çš„è¡Œæ•°ã€‚ï¼ˆæŸ¥è¡Œæ•°ã€‚å…¶ä»–innodbå¿«ï¼‰</li><li>Innodbæ”¯æŒè¡¨é”å’Œè¡Œé”ï¼Œmyisamåªæœ‰è¡¨é”ã€‚ä¸”Innobdbæ”¯æŒå…¨æ–‡æ£€ç´¢ã€‚</li></ol><p>å¶å­ç»“ç‚¹ä¿å­˜å®Œæ•´çš„æ•°æ®ã€‚ </p><p>éèšé›† ç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜å‚¨ã€‚å¶å­èŠ‚ç‚¹åªä¿å­˜</p><h3 id="1-ä¸ºä»€ä¹ˆè®¾è®¡ç´¢å¼•"><a href="#1-ä¸ºä»€ä¹ˆè®¾è®¡ç´¢å¼•" class="headerlink" title="1. ä¸ºä»€ä¹ˆè®¾è®¡ç´¢å¼•"></a>1. ä¸ºä»€ä¹ˆè®¾è®¡ç´¢å¼•</h3><p>ç´¢å¼•å¯ä»¥åŠ å¿«æ•°æ®è®¿é—®ï¼Œå¿«é€Ÿå®šä½æ•°æ®ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¹³æ—¶å†™ä»£ç ï¼Œä¸€ä¸ªæ•°ç»„å­˜äº†å¾ˆå¤šæ•°æ®ã€‚æˆ‘ä»¬ä¸å°±æ˜¯é€šè¿‡é‚£ä¸ªæŒ‡é’ˆç›´æ¥è®¿é—®é‚£ä¸ªæ•°æ®å—ï¼Ÿ</p><p>MYSQL ä½¿ç”¨B+æ•°å’Œå“ˆå¸Œï¼ˆå•å€¼ç´¢å¼•ï¼‰ã€‚</p><h3 id="2-ä¸ºä»€ä¹ˆè®¾è®¡æˆB-æ ‘"><a href="#2-ä¸ºä»€ä¹ˆè®¾è®¡æˆB-æ ‘" class="headerlink" title="2. ä¸ºä»€ä¹ˆè®¾è®¡æˆB+æ ‘"></a>2. ä¸ºä»€ä¹ˆè®¾è®¡æˆB+æ ‘</h3><p>å“ˆå¸Œä¼šç¢°æ’å’Œå†²çªã€‚å› ä¸ºè¦æŸ¥è¯¢ï¼Œè¿™ç§æ–¹å¼éœ€è¦æŠŠæ‰€æœ‰æ•°æ®å…¨éƒ¨æ”¾åˆ°å†…å­˜é‡Œï¼Œè€—è´¹å†…å­˜ç©ºé—´ã€‚</p><p>å®é™…å·¥ç¨‹ä¸­å¤§éƒ¨åˆ†æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚</p><p>äºŒå‰æ ‘å’Œçº¢é»‘æ ‘å¤ªæ·±äº†ï¼ˆåªå­˜å‚¨ä¸€ä¸ªå€¼ï¼‰ï¼Œioæ¬¡æ•°è¿‡å¤šå½±å“è¯»å–æ•ˆç‡ã€‚</p><p>Bæ ‘æ¯ä¸ªèŠ‚ç‚¹mä¸ªå­æ ‘ ï¼ˆm - 1ï¼‰ä¸ªç»“ç‚¹ã€‚</p><h3 id="4-é¢è¯•ä¸­å¸¸é—®çš„å­˜å‚¨å¼•æ“"><a href="#4-é¢è¯•ä¸­å¸¸é—®çš„å­˜å‚¨å¼•æ“" class="headerlink" title="4. é¢è¯•ä¸­å¸¸é—®çš„å­˜å‚¨å¼•æ“"></a>4. é¢è¯•ä¸­å¸¸é—®çš„å­˜å‚¨å¼•æ“</h3><p>MEMORY ä½¿ç”¨å“ˆå¸Œå­˜å‚¨ã€‚ï¼ˆè¿˜æœ‰ InnoDB å’Œ MyIsamï¼‰ã€‚</p><p>å­˜å‚¨å¼•æ“çš„åŒºåˆ«å°±iæ˜¯ä¸åŒçš„æ•°æ®å­˜å‚¨æ–¹å¼ã€‚æ¯”å¦‚MyISAMæ˜¯æ•°æ®ç´¢å¼•åˆ†å¼€æ”¾ï¼ŒInnoDBæ˜¯ç´¢å¼•æ•°æ®ä¸€èµ·æ”¾ã€‚ï¼ˆèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼‰</p><h3 id="5-å±€éƒ¨æ€§åŸç†"><a href="#5-å±€éƒ¨æ€§åŸç†" class="headerlink" title="5. å±€éƒ¨æ€§åŸç†"></a>5. å±€éƒ¨æ€§åŸç†</h3><ol><li>æ—¶é—´å±€éƒ¨æ€§ æ”¾è¿‡çš„æ•°æ®åœ¨æœ€è¿‘å¾ˆå¤§å¯èƒ½è¿˜ä¼šè¢«è®¿é—®</li><li>ç©ºé—´å±€éƒ¨æ€§ è®¿é—®è¿‡çš„ä½ç½®çš„é™„è¿‘å¾ˆå¤§å¯èƒ½ä¼šè¢«è®¿é—®</li></ol><h3 id="6-InnoDB-æ¯æ¬¡è§„å®šï¼Œé¢„è¯»4-4K-16K-çš„æ•°æ®"><a href="#6-InnoDB-æ¯æ¬¡è§„å®šï¼Œé¢„è¯»4-4K-16K-çš„æ•°æ®" class="headerlink" title="6. InnoDB æ¯æ¬¡è§„å®šï¼Œé¢„è¯»4*4K = 16K çš„æ•°æ®"></a>6. InnoDB æ¯æ¬¡è§„å®šï¼Œé¢„è¯»4*4K = 16K çš„æ•°æ®</h3><h3 id="7-B-æ ‘çš„é«˜åº¦å–å†³äºä½ çš„ç´¢å¼•æ˜¯ç”¨ä»€ä¹ˆç±»å‹å­˜å‚¨çš„ï¼Œä¸€èˆ¬ä½¿ç”¨intç±»å‹å»ºç«‹ç´¢å¼•ã€‚ï¼ˆæ•°å€¼è¶Šå°è¶Šå¥½ï¼‰ã€‚"><a href="#7-B-æ ‘çš„é«˜åº¦å–å†³äºä½ çš„ç´¢å¼•æ˜¯ç”¨ä»€ä¹ˆç±»å‹å­˜å‚¨çš„ï¼Œä¸€èˆ¬ä½¿ç”¨intç±»å‹å»ºç«‹ç´¢å¼•ã€‚ï¼ˆæ•°å€¼è¶Šå°è¶Šå¥½ï¼‰ã€‚" class="headerlink" title="7. B+æ ‘çš„é«˜åº¦å–å†³äºä½ çš„ç´¢å¼•æ˜¯ç”¨ä»€ä¹ˆç±»å‹å­˜å‚¨çš„ï¼Œä¸€èˆ¬ä½¿ç”¨intç±»å‹å»ºç«‹ç´¢å¼•ã€‚ï¼ˆæ•°å€¼è¶Šå°è¶Šå¥½ï¼‰ã€‚"></a>7. B+æ ‘çš„é«˜åº¦å–å†³äºä½ çš„ç´¢å¼•æ˜¯ç”¨ä»€ä¹ˆç±»å‹å­˜å‚¨çš„ï¼Œä¸€èˆ¬ä½¿ç”¨intç±»å‹å»ºç«‹ç´¢å¼•ã€‚ï¼ˆæ•°å€¼è¶Šå°è¶Šå¥½ï¼‰ã€‚</h3><h3 id="8-B-æ ‘ä¸¤ç§æŸ¥æ‰¾è¿ç®—"><a href="#8-B-æ ‘ä¸¤ç§æŸ¥æ‰¾è¿ç®—" class="headerlink" title="8. B+æ ‘ä¸¤ç§æŸ¥æ‰¾è¿ç®—"></a>8. B+æ ‘ä¸¤ç§æŸ¥æ‰¾è¿ç®—</h3><ol><li>ä¸»é”®çš„èŒƒå›´æŸ¥æ‰¾å’Œåˆ†é¡µæŸ¥æ‰¾ã€‚</li><li>æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œè¿›è¡ŒéšæœºæŸ¥æ‰¾ã€‚</li></ol><p>InnoDBå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨è®°å½•ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆé€‰æ‹©å”¯ä¸€é”®ã€‚å¦‚æœæ²¡æœ‰å”¯ä¸€é”®ï¼Œé‚£ä¹ˆä¼šç”Ÿæˆä¸€ä¸ª6å­—èŠ‚çš„row_idæ¥ä½œä¸ºä¸»é”®ã€‚</p><p>å¦‚æœåˆ›å»ºç´¢å¼•çš„é”®æ˜¯å…¶ä»–å­—æ®µï¼Œé‚£ä¹ˆå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ˜¯è¯¥è®°å½•çš„ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œå«åšå›è¡¨ã€‚</p><h3 id="9-ä¸ºä»€ä¹ˆæ¨èä¸»é”®è‡ªå¢"><a href="#9-ä¸ºä»€ä¹ˆæ¨èä¸»é”®è‡ªå¢" class="headerlink" title="9. ä¸ºä»€ä¹ˆæ¨èä¸»é”®è‡ªå¢"></a>9. ä¸ºä»€ä¹ˆæ¨èä¸»é”®è‡ªå¢</h3><p>åˆ†å¸ƒå¼ï¼Œä¸å»ºè®®ã€‚</p><p>å•æœºï¼Œå»ºè®®è‡ªå¢ã€‚ï¼ˆè·Ÿä¸šåŠ¡åœºæ™¯ç›¸å…³ï¼‰ã€‚å¦‚æœæ˜¯ä¹±åºæ’å…¥ï¼Œæ’åˆ°ä¸­é—´ï¼ˆB+æ ‘å¼€å§‹åˆ†è£‚ï¼‰ï¼Œåˆ†è£‚å®Œäº†è¿˜å¾—åˆå¹¶ï¼Œè¿˜å½±å“åˆ°äº†ç´¢å¼•åˆ—ã€‚</p><h3 id="10-å›è¡¨-ç´¢å¼•è¦†ç›–-ç´¢å¼•ä¸‹æ¨-æœ€å·¦åŒ¹é…"><a href="#10-å›è¡¨-ç´¢å¼•è¦†ç›–-ç´¢å¼•ä¸‹æ¨-æœ€å·¦åŒ¹é…" class="headerlink" title="10. å›è¡¨ ç´¢å¼•è¦†ç›– ç´¢å¼•ä¸‹æ¨ æœ€å·¦åŒ¹é…"></a>10. å›è¡¨ ç´¢å¼•è¦†ç›– ç´¢å¼•ä¸‹æ¨ æœ€å·¦åŒ¹é…</h3><p>å¦‚æœåˆ›å»ºç´¢å¼•çš„é”®æ˜¯å…¶ä»–å­—æ®µï¼Œé‚£ä¹ˆå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ˜¯è¯¥è®°å½•çš„ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œå«åšå›è¡¨ã€‚ï¼ˆä½¿ç”¨äº†è¾…åŠ©ç´¢å¼•ï¼‰</p><p>ç›´æ¥ä»ç´¢å¼•å…¨éƒ¨å‘½ä¸­æ•°æ®â€”â€”ç´¢å¼•è¦†ç›–ã€‚</p><p>ç»„åˆç´¢å¼•ä¸­ï¼Œå…ˆä»å·¦ä¾§çš„é¡ºåºåŒ¹é…ã€‚</p><p>æ¯”å¦‚(select * from table where name = ? and age = ? )æ²¡æœ‰ç´¢å¼•ä¸‹æ¨æ—¶ï¼ŒMYSQLä¼šå…ˆä»å­˜å‚¨å¼•æ“ä¸­æ‹‰å–æ•°æ®ï¼ˆæ ¹æ®nameç­›é€‰çš„æ•°æ®ï¼‰ï¼Œå†ä»musql server æ ¹æ®ageè¿›è¡Œæ•°æ®çš„ç­›é€‰ã€‚</p><p>æœ‰ç´¢å¼•ä¸‹æ¨æ—¶ï¼Œæ‹‰å–æ•°æ®ç›´æ¥æ ¹æ®nameï¼Œageè·å–æ•°æ®ï¼Œä¸éœ€è¦serveråšä»»ä½•çš„æ•°æ®ç­›é€‰ã€‚ï¼ˆç¼ºç‚¹ï¼šéœ€è¦åœ¨ç£ç›˜ä¸Šå¤šåšæ•°æ®ç­›é€‰ï¼‰ã€‚</p><p>ï¼ˆä¸¾ä¾‹ï¼šç´¢å¼•ä¸‹æ¨æ˜¯å…ˆæŠŠæ‰€æœ‰å­—æ®µæ‹¿å‡ºæ¥å†åšå…³è”ï¼ŒåŸæ¥æ˜¯å…ˆæŠŠè¡¨æ‰€æœ‰å†…å®¹æ‹¿å‡ºæ¥ï¼ŒæŸ¥è¯¢å­—æ®µï¼‰ã€‚</p><h3 id="11-ä¼˜åŒ–å™¨ä¸¤ç§æ–¹å¼"><a href="#11-ä¼˜åŒ–å™¨ä¸¤ç§æ–¹å¼" class="headerlink" title="11. ä¼˜åŒ–å™¨ä¸¤ç§æ–¹å¼"></a>11. ä¼˜åŒ–å™¨ä¸¤ç§æ–¹å¼</h3><ol><li><p>CBO åŸºäºæˆæœ¬ä¼˜åŒ–ã€‚ï¼ˆå¤§éƒ¨åˆ†é‡‡ç”¨ï¼‰</p></li><li><p>RBO åŸºäºè§„åˆ™ä¼˜åŒ–</p></li></ol><h3 id="12-MRR"><a href="#12-MRR" class="headerlink" title="12. MRR"></a>12. MRR</h3><p>mult_range readã€‚ç´¢å¼•æ’åºå¥½äº†ï¼ŒåŠ äº†ä¸€ä¸ªæ’åºçš„ç¯èŠ‚ã€‚æŠŠéšæœºç£ç›˜è¯»å–è½¬åŒ–ä¸ºé¡ºåºç£ç›˜è¯»ï¼Œæé«˜äº†ç´¢å¼•æŸ¥è¯¢çš„æ€§èƒ½ã€‚</p><h3 id="13-FIC"><a href="#13-FIC" class="headerlink" title="13. FIC"></a>13. FIC</h3><p>fast index createã€‚åªä½œç”¨äºè¾…åŠ©ç´¢å¼•ï¼Œå¯¹äºä¸»é”®çš„åˆ›å»ºå’Œåˆ é™¤åŒæ ·éœ€è¦é‡å»ºä¸€å¼ è¡¨ã€‚</p><p>æ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œå…ˆåˆ›å»ºä¸´æ—¶è¡¨ï¼Œå°†æ•°æ®å¯¼å…¥åˆ°ä¸´æ—¶è¡¨ä¸­ã€‚æŠŠåŸå§‹è¡¨åˆ é™¤ã€‚ä¿®æ”¹ä¸´æ—¶è¡¨çš„åå­—æ›¿æ¢åŸå§‹è¡¨ã€‚</p><p>æœ‰äº†FICï¼Œç»™å½“å‰è¡¨æ·»åŠ ä¸€ä¸ªShareé”ï¼Œä¸ä¼šæœ‰åˆ›å»ºä¸´æ—¶æ–‡ä»¶çš„èµ„æºæ¶ˆè€—ï¼Œè¿˜æ˜¯åœ¨æºæ–‡ä»¶åšã€‚ä½†æ˜¯æ­¤æ—¶å¦‚æœæœ‰äººå‘èµ·DMLæ“ä½œï¼Œå¾ˆæ˜æ˜¾æ•°æ®ä¼šä¸ä¸€è‡´ï¼Œæ‰€ä»¥æ·»åŠ shareé”ã€‚</p><h3 id="14-ç´¢å¼•åˆ†ç±»"><a href="#14-ç´¢å¼•åˆ†ç±»" class="headerlink" title="14. ç´¢å¼•åˆ†ç±»"></a>14. ç´¢å¼•åˆ†ç±»</h3><p>ä¸»é”®ç´¢å¼• å”¯ä¸€ç´¢å¼• æ™®é€šç´¢å¼• ç»„åˆç´¢å¼• å…¨æ–‡ç´¢å¼•</p><h3 id="15-ç´¢å¼•çš„åŒ¹é…æ–¹å¼"><a href="#15-ç´¢å¼•çš„åŒ¹é…æ–¹å¼" class="headerlink" title="15. ç´¢å¼•çš„åŒ¹é…æ–¹å¼"></a>15. ç´¢å¼•çš„åŒ¹é…æ–¹å¼</h3><ol><li><p>å…¨å€¼åŒ¹é… </p><p>å’Œç´¢å¼•ä¸­æ‰€æœ‰çš„åˆ—è¿›è¡ŒåŒ¹é…ã€‚</p></li><li><p>åŒ¹é…æœ€å·¦å‰ç¼€</p></li></ol><ol start="3"><li>åŒ¹é…åˆ—å‰ç¼€</li></ol><p>åŒ¹é…å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œåˆ—å‰ç¼€ã€‚æ¯”å¦‚ like%ã€‚</p><ol start="4"><li>åŒ¹é…èŒƒå›´å€¼</li></ol><ol start="5"><li>ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—</li></ol><ol start="6"><li>åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢</li></ol><h3 id="16-å“ˆå¸Œç´¢å¼•"><a href="#16-å“ˆå¸Œç´¢å¼•" class="headerlink" title="16. å“ˆå¸Œç´¢å¼•"></a>16. å“ˆå¸Œç´¢å¼•</h3><p>ç²¾ç¡®åŒ¹é…ã€‚åªæœ‰memoryå­˜å‚¨å¼•æ“æ˜¾ç¤ºæ”¯æŒå“ˆå¸Œç´¢å¼•ã€‚</p><p>é™åˆ¶ï¼š</p><ol><li>åªåŒ…å«å“ˆå¸Œå€¼å’Œè¡ŒæŒ‡é’ˆï¼Œä¸å­˜å‚¨å­—æ®µå€¼ã€‚</li><li>æ— æ³•æ’åºã€‚ä¸æ˜¯æŒ‰ç…§ç´¢å¼•é¡ºåºå­˜å‚¨çš„ã€‚</li><li>å“ˆå¸Œä½¿ç”¨ç´¢å¼•åˆ—çš„å…¨éƒ¨å†…å®¹æŸ¥æ‰¾ï¼Œä¸æ”¯æŒåˆ—éƒ¨åˆ†åŒ¹é…ã€‚</li><li>æ”¯æŒç­‰å€¼æ¯”è¾ƒæŸ¥è¯¢ï¼Œä¹Ÿä¸æ”¯æŒä»»ä½•èŒƒå›´æŸ¥è¯¢ã€‚</li><li>è®¿é—®å“ˆå¸Œç´¢å¼•é€Ÿåº¦å¿«ï¼Œå½“å‡ºç°å“ˆå¸Œå†²çªæ—¶ï¼Œå¿…é¡»éå†é“¾è¡¨ä¸­æ‰€æ‰€æœ‰è¡ŒæŒ‡é’ˆç›´åˆ°æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è¡Œã€‚</li><li>å“ˆå¸Œå†²çªæ¯”è¾ƒå¤šçš„è¯ï¼Œç»´æŠ¤çš„ä»£ä»·å¾ˆé«˜ã€‚</li></ol><p>CRC32 å¾ªç¯å†—ä½™åŠ å¯†è§„åˆ™ã€‚</p><h3 id="17-ç´¢å¼•ä¼˜åŒ–"><a href="#17-ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="17. ç´¢å¼•ä¼˜åŒ–"></a>17. ç´¢å¼•ä¼˜åŒ–</h3><ol><li>ä½¿ç”¨ç´¢å¼•åˆ—æŸ¥è¯¢ä¸è¦ä½¿ç”¨è¡¨è¾¾å¼ï¼ŒæŠŠè®¡ç®—é€»è¾‘æ”¾åœ¨ä¸šåŠ¡å±‚ã€‚å¦åˆ™å°±ä¸èµ°ç´¢å¼•äº†ã€‚</li><li>å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢ï¼Œä¸ä¼šè§¦å‘å›è¡¨æŸ¥è¯¢ã€‚è‡ªç„¶ä¸»é”®å’Œä»£ç†ä¸»é”®ï¼ˆè·Ÿä¸šåŠ¡æ— å…³æ€§ï¼‰ã€‚</li><li>å‰ç¼€ç´¢å¼•ã€‚æ¯”å¦‚å­—ç¬¦ä¸²çš„å‰7ä¸ªå­—ç¬¦ã€‚</li><li>ä½¿ç”¨ç´¢å¼•æ‰«ææ¥æ’åºã€‚ é˜²æ­¢å‡ºç° using filesortã€‚</li><li>union allï¼Œinï¼Œoréƒ½èƒ½å¤Ÿä½¿ç”¨ç´¢å¼•ï¼Œä½†æ˜¯æ¨èä½¿ç”¨inã€‚å¦‚æœæ˜¯å•åˆ—ç´¢å¼•ï¼Œorä¼šä½¿ç”¨ç´¢å¼•ã€‚å¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼šå¦‚æœå…¨éƒ¨æ˜¯ç»„åˆç´¢å¼•ï¼Œä½¿ç”¨è¡¨ä¸­å…¨éƒ¨åˆ—æ‰€å¯¹åº”çš„ç´¢å¼•ï¼Œå¦‚æœéƒ¨åˆ†åˆ—æ˜¯ç»„åˆç´¢å¼•ï¼Œä¸ä¼šèµ°ç´¢å¼•ã€‚</li><li>èŒƒå›´åˆ—å¯ä»¥ç”¨åˆ°ç´¢å¼•ã€‚&lt; &lt;= &gt; &gt;= betweenã€‚å¦‚æœæŸç´¢å¼•ä½¿ç”¨åˆ°äº†èŒƒå›´ï¼Œé‚£ä¹ˆå…¶åé¢çš„ç´¢å¼•åˆ—ä¸ä¼šå†èµ°ç´¢å¼•ã€‚</li><li>å¼ºåˆ¶ç±»å‹è½¬æ¢ä¼šè§¦å‘å…¨è¡¨æ‰«æã€‚</li><li>æ›´æ–°é¢‘ç¹çš„ç´¢å¼•ä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚typeloglogï¼Œdistinct valueã€‚</li><li>åˆ›å»ºç´¢å¼•çš„åˆ—ï¼Œä¸å…è®¸ä¸ºnullï¼Œå¯èƒ½ä¼šå¾—åˆ°ä¸ç¬¦åˆé¢„æœŸçš„ç»“æœã€‚</li><li>è¿›è¡Œè¡¨è¿æ¥æ—¶ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡ä¸‰ä¸ªè¡¨ï¼Œå› ä¸ºjoinå­—æ®µæ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´ã€‚</li><li>èƒ½ä½¿ç”¨limitçš„æ—¶å€™å°½é‡ä½¿ç”¨limitã€‚limitä¸»è¦ç›®çš„æ—¶é™åˆ¶è¾“å‡ºã€‚</li><li>å•è¡¨ç´¢å¼•æ§åˆ¶åœ¨5ä¸ªä»¥å†…ï¼ˆç°åœ¨æ²¡æœ‰å¤ªå¤šçš„é™åˆ¶ï¼‰ã€‚</li><li>å•ç´¢å¼•å­—æ®µæ•°ä¸å…è®¸è¶…è¿‡5ä¸ªï¼ˆç»„åˆç´¢å¼•ï¼‰ã€‚</li><li>åˆ›å»ºç´¢å¼•åº”è¯¥é¿å…ä»¥ä¸‹é”™è¯¯è§‚å¿µï¼ˆ1.ç´¢å¼•è¶Šå¤šè¶Šå¥½2. è¿‡æ—©ä¼˜åŒ–ï¼Œä¸äº†è§£ç³»ç»Ÿçš„æƒ…å†µä¸‹è¿›è¡Œä¼˜åŒ–ï¼‰ã€‚</li></ol><p>â€”â€”â€”â€”â€”â€”â€”â€”</p><p>ç›‘æ§SQLã€æ•°æ®åº“è¿æ¥ä¸è¦è¿‡å¤šã€æ•°æ®åº“è®¾è®¡ä¹‹åˆã€ç´¢å¼•ã€SQLè¯­å¥çš„ä¼˜åŒ–ã€è®¾ç½®MYSQLå‚æ•°ã€åˆ†å¸ƒå¼é›†ç¾¤å¦‚ä½•è®¾è®¡ã€‚</p><h3 id="18-ç´¢å¼•ç›‘æ§"><a href="#18-ç´¢å¼•ç›‘æ§" class="headerlink" title="18.ç´¢å¼•ç›‘æ§"></a>18.ç´¢å¼•ç›‘æ§</h3><p><img src="/2021/03/15/database/%E7%B4%A2%E5%BC%95%E7%9B%91%E6%8E%A7.PNG"></p><h3 id="19-Count-1-COUNT"><a href="#19-Count-1-COUNT" class="headerlink" title="19. Count(1) COUNT(*)"></a>19. Count(1) COUNT(*)</h3><p><strong>countè¯¦è§£ï¼š</strong></p><p><code>count(1)</code>è·Ÿ<code>count(ä¸»é”®)</code>ä¸€æ ·ï¼Œåªæ‰«æä¸»é”®ã€‚</p><p><code>count(*)</code>è·Ÿ<code>count(éä¸»é”®)</code>ï¼š</p><p>ã€€ã€€count(*)å°†è¿”å›è¡¨æ ¼ä¸­æ‰€æœ‰å­˜åœ¨çš„è¡Œçš„æ€»æ•°åŒ…æ‹¬å€¼ä¸ºnullçš„è¡Œï¼Œç„¶è€Œcount(åˆ—å)å°†è¿”å›è¡¨æ ¼ä¸­é™¤å»nullä»¥å¤–çš„æ‰€æœ‰è¡Œçš„æ€»æ•°(æœ‰é»˜è®¤å€¼çš„åˆ—ä¹Ÿä¼šè¢«è®¡å…¥ï¼‰.<br>ã€€ã€€distinct åˆ—å,å¾—åˆ°çš„ç»“æœå°†æ˜¯é™¤å»å€¼ä¸ºnullå’Œé‡å¤æ•°æ®åçš„ç»“æœ</p><p>1.ä¼˜å…ˆè€ƒè™‘count(*)ï¼Œå› ä¸ºæ•°æ®åº“åšäº†ç‰¹åˆ«çš„ä¼˜åŒ–å¤„ç†ã€‚</p><p>æœ‰ä¸»é”®æˆ–è”åˆä¸»é”®çš„æƒ…å†µä¸‹ï¼Œcount(*)ç•¥æ¯”count(1)å¿«ä¸€äº›ã€‚<br>æ²¡æœ‰ä¸»é”®çš„æƒ…å†µä¸‹count(1)æ¯”count(*)å¿«ä¸€äº›ã€‚<br>å¦‚æœè¡¨åªæœ‰ä¸€ä¸ªå­—æ®µï¼Œåˆ™count(*)æ˜¯æœ€å¿«çš„ã€‚<br>2.ä½¿ç”¨count()èšåˆå‡½æ•°åï¼Œæœ€å¥½ä¸è¦è·Ÿwhere age = 1ï¼›è¿™æ ·çš„æ¡ä»¶ï¼Œä¼šå¯¼è‡´ä¸èµ°ç´¢å¼•ï¼Œé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚é™¤éè¯¥å­—æ®µå·²ç»å»ºç«‹äº†ç´¢å¼•ã€‚ä½¿ç”¨count()èšåˆå‡½æ•°åï¼Œè‹¥æœ‰whereæ¡ä»¶ï¼Œä¸”whereæ¡ä»¶çš„å­—æ®µæœªå»ºç«‹ç´¢å¼•ï¼Œåˆ™æŸ¥è¯¢ä¸ä¼šèµ°ç´¢å¼•ï¼Œç›´æ¥æ‰«æäº†å…¨è¡¨ã€‚<br>3.count(å­—æ®µ),éä¸»é”®å­—æ®µï¼Œè¿™æ ·çš„ä½¿ç”¨æ–¹å¼æœ€å¥½ä¸è¦å‡ºç°ã€‚å› ä¸ºå®ƒä¸ä¼šèµ°ç´¢å¼•.</p><p><a href="https://blog.csdn.net/youcijibi/article/details/99633252">(3æ¡æ¶ˆæ¯) mysql countï¼ˆ*ï¼‰ä¼˜åŒ–_youcijibiçš„åšå®¢-CSDNåšå®¢</a></p><h3 id="20-ä¸»ä»å¤åˆ¶"><a href="#20-ä¸»ä»å¤åˆ¶" class="headerlink" title="20. ä¸»ä»å¤åˆ¶"></a>20. ä¸»ä»å¤åˆ¶</h3><p>å®¢æˆ·å‘è¯·æ±‚ç»™ä»£ç†ï¼Œä»£ç†ç»™æ¯ä¸ªåˆ†åº“è¯»æˆ–è€…å†™ã€‚è¦ä¿è¯æ¯ä¸ªåˆ†åº“æ•°æ®ä¸€è‡´ï¼Œbinlogè¿›è¡Œä¸»ä»å¤åˆ¶ã€‚master  å’Œ slave åº“ï¼Œå®¢æˆ·ç«¯æ“ä½œmasterè¿›è¡ŒDMLæ“ä½œï¼Œ</p><p><img src="/2021/03/15/database/1\blog\source_posts\database\image-20211014150946880.png" alt="image-20211014150946880"></p><h3 id="21-è¯»å†™åˆ†ç¦»"><a href="#21-è¯»å†™åˆ†ç¦»" class="headerlink" title="21 è¯»å†™åˆ†ç¦»"></a>21 è¯»å†™åˆ†ç¦»</h3><p>å®¢æˆ·å‘è¯·æ±‚ç»™ä»£ç†ï¼Œä»£ç†ç»™æ¯ä¸ªåˆ†åº“è¯»æˆ–è€…å†™ã€‚è¦ä¿è¯æ¯ä¸ªåˆ†åº“æ•°æ®ä¸€è‡´ï¼Œbinlogè¿›è¡Œä¸»ä»å¤åˆ¶ã€‚master  å’Œ slave åº“ï¼Œå®¢æˆ·ç«¯æ“ä½œmasterï¼Œ</p><h3 id="22-åˆ†åº“åˆ†è¡¨"><a href="#22-åˆ†åº“åˆ†è¡¨" class="headerlink" title="22. åˆ†åº“åˆ†è¡¨"></a>22. åˆ†åº“åˆ†è¡¨</h3><p>æ°´å¹³åˆ‡åˆ†å’Œå‚ç›´åˆ‡åˆ†</p><h4 id="22-1-æ°´å¹³åˆ‡åˆ†"><a href="#22-1-æ°´å¹³åˆ‡åˆ†" class="headerlink" title="22.1 æ°´å¹³åˆ‡åˆ†"></a>22.1 æ°´å¹³åˆ‡åˆ†</h4><p>åˆ†ä¸ºæ°´å¹³åˆ†è¡¨ å’Œ æ°´å¹³åˆ†åº“ã€‚</p><p>æ°´å¹³åˆ†è¡¨ï¼š </p><p>å°±æ˜¯ä¸¤ä¸ªè¡¨å­—æ®µæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ•°æ®ä¸ä¸€æ ·ã€‚æ¯”å¦‚idä¸€ä¸ªè¡¨å­˜å‚¨å¥‡æ•°idçš„æ•°æ®ï¼Œä¸€ä¸ªè¡¨å­˜å‚¨å¶æ•°idçš„æ•°æ®ã€‚</p><p>æ°´å¹³åˆ†åº“ï¼š</p><p>åˆ†æˆå¥½å‡ ä¸ªåº“ï¼Œå‡ ä¸ªåº“é‡Œçš„è¡¨æ˜¯ä¸€æ ·çš„ã€‚æŒ‰ç…§æ•°æ®å¯¹åº”åˆ°ä¸åŒçš„åº“é‡Œå»å­˜æ”¾ã€‚</p><p>å‚ç›´åˆ†è¡¨ï¼š</p><p>å°†ä¸€å¼ è¡¨é‡Œçš„å­—æ®µåˆ‡æˆä¸¤éƒ¨åˆ†æˆ–è€…å¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”¨å•ç‹¬çš„ä¸€å¼ è¡¨å­˜æ”¾ã€‚</p><p>å‚ç›´åˆ†åº“ï¼š</p><p>å°†ä¸åŒçš„è¡¨æ”¾åˆ°ä¸åŒçš„æ•°æ®åº“é‡Œã€‚</p><p><strong>åº”ç”¨</strong></p><ol><li>åœ¨æ•°æ®åº“è®¾è®¡æ—¶å€™è€ƒè™‘å‚ç›´åˆ†åº“å’Œå‚ç›´åˆ†è¡¨ã€‚</li><li>éšç€æ•°æ®åº“æ•°æ®é‡å¢åŠ ï¼Œä¸è¦é©¬ä¸Šè€ƒè™‘åšæ°´å¹³åˆ‡åˆ†ï¼Œé¦–å…ˆè€ƒè™‘ç¼“å­˜å¤„ç†ï¼Œè¯»å†™åˆ†ç¦»ï¼Œä½¿ç”¨ç´¢å¼•ç­‰ç­‰æ–¹å¼ï¼Œå¦‚æœè¿™äº›æ–¹å¼ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå†è€ƒè™‘æ°´å¹³åˆ†åº“å’Œæ°´å¹³åˆ†è¡¨ã€‚</li></ol><p><strong>é—®é¢˜</strong></p><ol><li>è·¨èŠ‚ç‚¹è¿æ¥æŸ¥è¯¢é—®é¢˜ï¼ˆåˆ†é¡µã€æ’åºï¼‰ã€‚æ¯”å¦‚å‚ç›´åˆ‡åˆ†ï¼Œä½†æ˜¯æˆ‘éœ€è¦å…¨éƒ¨çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦æŠŠæ¯å¼ è¡¨çš„æ•°æ®æŸ¥å‡ºæ¥ç„¶åmysqlåˆå¹¶å†åˆ†é¡µå’Œæ’åºï¼Œæ‰€ä»¥æ€§èƒ½ä¸Šå‡ºç°äº†é—®é¢˜ã€‚</li><li>å¤šæ•°æ®æºç®¡ç†çš„é—®é¢˜ï¼ˆæ“ä½œç®¡ç†æ¯”è¾ƒæ…¢ï¼‰ã€‚</li></ol><h3 id="23-MVCC"><a href="#23-MVCC" class="headerlink" title="23 MVCC"></a>23 MVCC</h3><h3 id="24-é”"><a href="#24-é”" class="headerlink" title="24. é”"></a>24. é”</h3><p>è¡¨é”ã€è¡Œé”ã€é¡µé”ã€‚</p><p>è¡¨é”ï¼ˆåå‘MYISAMå¼•æ“ã€‚</p><h3 id="25-æ—¥å¿—ç³»ç»Ÿ"><a href="#25-æ—¥å¿—ç³»ç»Ÿ" class="headerlink" title="25. æ—¥å¿—ç³»ç»Ÿ"></a>25. æ—¥å¿—ç³»ç»Ÿ</h3><p><code>binlog</code> â€”â€”ã€‹ MYSQLæœåŠ¡çš„   <code>undo log</code> å’Œ  <code>redo log</code> â€”â€”ã€‹innodbå­˜å‚¨å¼•æ“çš„</p><h3 id="26-MYSQL-ç»“æ„"><a href="#26-MYSQL-ç»“æ„" class="headerlink" title="26. MYSQL ç»“æ„"></a>26. MYSQL ç»“æ„</h3><p><img src="/2021/03/15/database/MYSQL%E7%BB%93%E6%9E%84.PNG"></p>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>java</title>
      <link href="2021/03/15/java/"/>
      <url>2021/03/15/java/</url>
      
        <content type="html"><![CDATA[<h1 id="JAVA-å¸¸é—®çŸ¥è¯†ç‚¹"><a href="#JAVA-å¸¸é—®çŸ¥è¯†ç‚¹" class="headerlink" title="JAVA å¸¸é—®çŸ¥è¯†ç‚¹"></a>JAVA å¸¸é—®çŸ¥è¯†ç‚¹</h1><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>é¦–å…ˆä¸‹è½½jdkè¿›å®˜ç½‘ä¸‹è½½jdk</p><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p><p>æœ¬ç¯‡æ–‡ç« ä¸‹è½½1.8çš„</p><p><img src="https://images2018.cnblogs.com/blog/1313907/201805/1313907-20180505150858787-1466797424.png" alt="img"></p><p>é€‰æ‹©ç›¸åº”çš„ç³»ç»Ÿã€‚</p><p>ä¸€é”®å®‰è£…å³å¯ã€‚</p><p>å®‰è£…åä¼šæœ‰ä¸¤ä¸ªjreï¼Œä¸€ä¸ªjdkå†…éƒ¨çš„ï¼Œå’Œjdkå¤–éƒ¨çš„</p><p>å…³äºä¸¤å¥—jreçš„è§£é‡Š</p><p>ä¸€ä¸ªjreæ–‡ä»¶åœ¨JDKçš„å¤–éƒ¨ï¼Œä¸€ä¸ªjreæ–‡ä»¶åœ¨JDKå†…éƒ¨ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ä¸“ç”¨JREå’Œå…¬ç”¨JRE</p><ul><li><ul><li>ä¸“ç”¨ JRE<br>å®‰è£… JDK æ—¶ï¼Œä¼šå®‰è£…ä¸€ä¸ªä¸“ç”¨ JREï¼Œå¹¶ä¸”æ‚¨å¯ä»¥é€‰æ‹©å®‰è£…ä¸€ä¸ªå…¬å…±å‰¯æœ¬ã€‚éœ€è¦ä¸“ç”¨ JRE æ‰èƒ½è¿è¡Œ JDK ä¸­åŒ…å«çš„å·¥å…·ã€‚ä¸“ç”¨ JRE æ²¡æœ‰æ³¨å†Œè¡¨è®¾ç½®ï¼Œå¹¶ä¸”å®Œå…¨åŒ…å«åœ¨ä»…å¯¹ JDK å·²çŸ¥çš„ Java ç›®å½•ä½ç½®ï¼ˆé€šå¸¸ä½äº C:\Program Files\Java\jdk1.8.0_162\jreï¼‰ä¸­ã€‚</li><li>å…¬å…± JRE<br>å¯ç”±å…¶ä»– Java åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œå¹¶ä¸”åŒ…å«åœ¨ JDK å¤–éƒ¨ï¼ˆé€šå¸¸ä½äºC:\Program Files\Java\jre1.8.0_162ï¼‰ã€‚å…¬å…± JRE ä¼šæ³¨å†Œåˆ° Windows æ³¨å†Œè¡¨ï¼ˆä½äº HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoftï¼‰ä¸­ã€‚å…¬å…± JRE å¯ä»¥ä½¿ç”¨â€œæ·»åŠ /åˆ é™¤ç¨‹åºâ€è¿›è¡Œåˆ é™¤ï¼Œå¹¶ä¸”è¿˜ä¼šæ³¨å†Œåˆ°æµè§ˆå™¨ã€‚</li></ul></li></ul><h3 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h3><p>å¯¹æˆ‘çš„ç”µè„‘ç‚¹å³é”®ï¼Œç„¶åé€‰æ‹©å±æ€§</p><p><img src="https://images2018.cnblogs.com/blog/1313907/201805/1313907-20180505151708817-878049841.png" alt="img"></p><p> è¿›å…¥ä¹‹åé€‰æ‹©é«˜çº§ç³»ç»Ÿè®¾ç½®ï¼Œç„¶åé€‰æ‹©ç¯å¢ƒå˜é‡</p><p>åœ¨æ‰“å¼€çš„ç¯å¢ƒå˜é‡å¯¹è¯æ¡†åï¼Œå•å‡»ä¸‹æ–¹ã€ç³»ç»Ÿå˜é‡ã€‘ä¸‹çš„ã€æ–°å»ºã€‘æŒ‰é’®ï¼›</p><p> ç„¶åè¾“å…¥JAVA_HOME,å¯¹åº”çš„å˜é‡å€¼ä¸ºä½ jdkå®‰è£…çš„ç›®å½•ã€‚</p><p><img src="https://images2018.cnblogs.com/blog/1313907/201805/1313907-20180505151930953-913534876.png" alt="img"></p><p>ç‚¹å‡»ç¡®å®šã€‚</p><p>ç„¶åæ–°å»ºå˜é‡åï¼šclasspath     å˜é‡å€¼ï¼š.;%JAVA_HOME%\lib;%JAVA_HOME%\lib\tools.jarç‚¹ç¡®å®š</p><p><img src="https://images2018.cnblogs.com/blog/1313907/201805/1313907-20180505160714794-1912853159.png" alt="img"></p><p>ç„¶ååœ¨ç³»ç»Ÿå˜é‡ä¸­æ‰¾åˆ°åä¸ºâ€œPathâ€çš„å˜é‡å¹¶åŒå‡»ï¼Œæ–°å»ºå˜é‡ä¸º %JAVA_HOME%\bin</p><p> <img src="https://images2018.cnblogs.com/blog/1313907/201805/1313907-20180505152115707-154528137.png" alt="img"></p><p>ç¡®å®šä»¥åï¼Œåˆ†åˆ«è¾“å…¥â€œjavaâ€ã€â€œjava -versionâ€ï¼ˆjava -versionä»£è¡¨ä½ å®‰è£…çš„javaçš„ç‰ˆæœ¬ï¼‰å’Œjavacï¼Œè‹¥éƒ½æ­£å¸¸è¿è¡Œåˆ™ä»£è¡¨javaå·²ç»æ­£ç¡®å®‰è£…ã€‚</p><h2 id="ubuntu18-04-å®‰è£…"><a href="#ubuntu18-04-å®‰è£…" class="headerlink" title="ubuntu18.04 å®‰è£…"></a>ubuntu18.04 å®‰è£…</h2><p>javaä¸‹è½½</p><p>1.è¿›å…¥å®˜ç½‘ä¸‹è½½é¡µé¢<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p><p>2.é€‰æ‹©éœ€è¦çš„ç‰ˆæœ¬ï¼Œè¿›å…¥ä¸‹è½½é¡µé¢</p><p>é€‰ä¸­çº¢æ¡†æ‰å¯ä»¥ä¸‹è½½</p><p>3.ä¸‹è½½å®Œæˆè§£å‹</p><p>æœ¬äººå®‰è£…ç›®å½•æ˜¯/usr/javaä¸‹ï¼Œéœ€è¦cd /usrè¿›å…¥usrç›®å½•</p><p>åˆ›å»ºjavaæ–‡ä»¶å¤¹ï¼Œå‘½ä»¤sudo mkdir java</p><p>ä¸ºäº†åç»­æ–¹ä¾¿ï¼Œå°†javaç›®å½•èµ‹äºˆæœ€é«˜æƒé™ï¼Œå‘½ä»¤sudo chmod 777 java</p><p>å°†ä¸‹è½½çš„æ–‡ä»¶ç§»åŠ¨åˆ°javaç›®å½•ä¸‹ï¼Œå…·ä½“æ ¹æ®ä½ çš„æ˜¯æ¡Œé¢ç‰ˆè¿˜æ˜¯æœåŠ¡å™¨ç‰ˆæœ¬è‡ªè¡Œç§»åŠ¨ã€‚</p><p>è§£å‹javaåŒ… tar -zxvf jdkæ–‡ä»¶å</p><p>æœ¬äººçš„æ˜¯tar -zxvf jdk-8u144-linux-x64.gz</p><p>è§£å‹å®Œæˆ</p><p>ä¸‰ã€é…ç½®java</p><p>è¾“å…¥sudo vim /etc/profile</p><p>å¦‚æœæ²¡æœ‰vimï¼Œä½¿ç”¨viä¹Ÿå¯ä»¥ï¼Œæˆ–è€…å…¶ä»–ç¼–è¾‘å™¨ï¼Œéƒ½å¯ä»¥</p><p>åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ï¼Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µå¡«å†™</p><p>#å®‰è£…ç›®å½•<br>export   JAVA_HOME=/usr/java/jdk1.8.0_144<br>#ä¸‹é¢éƒ½ä¸€æ ·å•¦<br>export   CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH<br>export  PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH<br>export   JRE_HOME=$JAVA_HOME/jre</p><h2 id="è¿œç¨‹å¼€å‘-IDEA"><a href="#è¿œç¨‹å¼€å‘-IDEA" class="headerlink" title="è¿œç¨‹å¼€å‘ IDEA"></a>è¿œç¨‹å¼€å‘ IDEA</h2><p>å®˜ç½‘ <a href="https://www.jetbrains.com/help/idea/run-targets.html">Run targets | IntelliJ IDEA (jetbrains.com)</a></p><h3 id="æ±‚æ—¶é—´å¤æ‚åº¦"><a href="#æ±‚æ—¶é—´å¤æ‚åº¦" class="headerlink" title=" æ±‚æ—¶é—´å¤æ‚åº¦ "></a><font color="green"> æ±‚æ—¶é—´å¤æ‚åº¦ </font></h3><ol><li>é€’å½’æ ‘æ³•</li></ol><p>$T(n) = 2 * T(\frac{n}{2}) + n $</p><p><img src="/2021/03/15/java/%E9%80%92%E5%BD%92%E6%B1%82%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6.PNG"></p><p><img src="/2021/03/15/java/%E9%80%92%E5%BD%92%E6%B1%82%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A61.PNG"></p><ol start="2"><li>ä¸»å®šç†åˆ†ææ³•</li></ol><p>$T(n) = a * T(\frac{n}{b}) + f(n)$</p><p><img src="/2021/03/15/java/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%90.PNG"></p><p><img src="/2021/03/15/java/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%901.PNG"></p><h2 id="1-JVMè™šæ‹Ÿæœº"><a href="#1-JVMè™šæ‹Ÿæœº" class="headerlink" title="1. JVMè™šæ‹Ÿæœº"></a>1. JVMè™šæ‹Ÿæœº</h2><p>è™šæ‹Ÿæœºçš„å¯åŠ¨æ˜¯é€šè¿‡å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆbootstrap class loaderï¼‰åˆ›å»ºä¸€ä¸ªåˆå§‹ç±»ï¼ˆinitial classï¼‰æ¥å®Œæˆçš„ï¼Œè¿™ä¸ªç±»æ˜¯ç”±è™šæ‹Ÿæœºçš„å…·ä½“å®ç°æŒ‡å®šçš„ã€‚</p><p>æ‰§è¡Œå¼•æ“ï¼š</p><p><img src="/2021/03/15/java/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E.PNG"></p><p><img src="/2021/03/15/java/image-20210814220124329.png" alt="image-20210814220124329"></p><p><img src="/2021/03/15/java/image-20210815153306305.png" alt="image-20210815153306305"></p><h3 id="gt-ç±»åŠ è½½å­ç³»ç»Ÿ"><a href="#gt-ç±»åŠ è½½å­ç³»ç»Ÿ" class="headerlink" title="> ç±»åŠ è½½å­ç³»ç»Ÿ"></a>&gt; ç±»åŠ è½½å­ç³»ç»Ÿ</h3><ol><li>åŠ è½½ å¼•å¯¼ç±»åŠ è½½å™¨ã€æ‰©å±•ç±»åŠ è½½å™¨ã€ç³»ç»Ÿç±»åŠ è½½å™¨</li><li>é“¾æ¥ éªŒè¯ã€å‡†å¤‡ã€è§£æ</li><li>åˆå§‹åŒ–é˜¶æ®µ åˆå§‹åŒ–</li></ol><p>åŠ è½½ï¼š</p><p>ç±»åŠ è½½å­ç³»ç»Ÿè´Ÿè´£ä»æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç½‘ç»œä¸­åŠ è½½Classæ–‡ä»¶ï¼Œclassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´æœ‰ç‰¹å®šçš„æ ‡è¯†ã€‚</p><p>ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œç”±Execution Engineå†³å®šã€‚</p><p>åŠ è½½çš„ç±»ä¿¡æ¯å­˜æ”¾äºä¸€å—è¢«ç§°ä¸ºæ–¹æ³•åŒºçš„å†…å­˜ç©ºé—´ã€‚</p><p>é“¾æ¥ï¼š</p><ol><li>éªŒè¯ ç¡®ä¿classæ–‡ä»¶çš„å­—èŠ‚æµä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ã€‚æ–‡ä»¶æ ¼å¼ã€å…ƒæ•°æ®ã€å­—èŠ‚ç å’Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚</li><li>å‡†å¤‡ã€‚ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®è¯¥ç±»é»˜è®¤åˆå§‹å€¼ã€‚è¿™é‡Œä¸åŒ…æ‹¬finalï¼Œfinalåœ¨ç¼–è¯‘å°±åˆ†é…äº†ï¼Œå‡†å¤‡é˜¶æ®µå›æ˜¾å¼åˆå§‹åŒ–ã€‚è¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­ã€‚</li><li>è§£æã€‚å°†å¸¸é‡æ± å†…ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ã€‚ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½ã€‚</li></ol><p>åˆå§‹åŒ–ï¼š</p><p>cinit()æ–¹æ³•ä¼šæŠŠæ˜¾ç¤ºåˆå§‹åŒ–å’Œé™æ€ä»£ç å—ä¸­çš„åˆå§‹åŒ–æ”¾åˆ°ä¸€èµ·çš„æ–¹æ³•ã€‚ç±»æ„é€ å™¨ä¼šç”Ÿæˆæ–¹æ³•cinitï¼ˆï¼‰è¿‡ç¨‹ã€‚JVMè‡ªåŠ¨æ‰‹æœºæ‰€æœ‰ç±»å˜é‡å’Œèµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶è€Œæ¥ã€‚</p><p>è™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„<cinit>()æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¢«åŒæ­¥åŠ é”ã€‚</cinit></p><p>å¸¸è§çš„è™šæ‹Ÿæœºæœ‰ï¼š</p><ol><li>Sun Classic VMã€‚</li><li>Exact VMã€‚</li><li>Sum HotSpot VM</li><li>BEA JRockit</li><li>IBM J9</li></ol><p>æ¶æ„ï¼šåŸºäºæ ˆå¼æ¶æ„çš„ã€‚</p><ol><li><p>è®¾è®¡å’Œå®ç°æ›´ç®€å•ï¼Œé€‚ç”¨äºèµ„æºå—é™çš„ç³»ç»Ÿã€‚</p></li><li><p>é¿å¼€äº†å¯„å­˜å™¨çš„åˆ†é…éš¾é¢˜ï¼šä½¿ç”¨é›¶åœ°å€æŒ‡ä»¤æ–¹å¼åˆ†é…ã€‚</p></li><li><p>æŒ‡ä»¤æµä¸­çš„æŒ‡ä»¤å¤§éƒ¨åˆ†æ˜¯é›¶åœ°å€æŒ‡ä»¤ï¼Œå…¶æ‰§è¡Œæµç¨‹ä¾èµ–äºæ“ä½œæ ˆã€‚</p></li><li><p>æŒ‡ä»¤æ›´å¤šã€‚</p></li></ol><h3 id="gt-JVMç”Ÿå‘½å‘¨æœŸ"><a href="#gt-JVMç”Ÿå‘½å‘¨æœŸ" class="headerlink" title=">JVMç”Ÿå‘½å‘¨æœŸ"></a>&gt;JVMç”Ÿå‘½å‘¨æœŸ</h3><ol><li><p>å¯åŠ¨é€šè¿‡å¼•å¯¼ç±»åŠ è½½å™¨bootstrap class loaderåˆ›å»ºä¸€ä¸ªåˆå§‹ç±» initial class æ¥å®Œæˆçš„ã€‚</p></li><li><p>æ‰§è¡Œã€‚</p></li><li><p>é€€å‡ºã€‚æ­£å¸¸æ‰§è¡Œç»“æŸã€è¿è¡Œæ—¶å¼‚å¸¸ã€‚</p></li></ol><h3 id="gt-é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"><a href="#gt-é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«" class="headerlink" title="&nbsp;> é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"></a><font color="green">&nbsp;&gt; é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«</font></h3><ul><li>é¢å‘è¿‡ç¨‹ ï¼š é¢å‘è¿‡ç¨‹æ€§èƒ½å¾ˆå¥½ã€‚ç±»è°ƒç”¨æ—¶éœ€è¦å®ä¾‹åŒ–ï¼Œå¼€é”€å¤§æ¶ˆè€—èµ„æºã€‚ä½†æ˜¯é¢å‘è¿‡ç¨‹æ²¡æœ‰é¢å‘å¯¹è±¡æ˜“äºç»´æŠ¤ã€å¤æ‰©å±•ã€‚</li><li>é¢å‘å¯¹è±¡ï¼šæ˜“ç»´æŠ¤ã€å¤ç”¨ã€æ‰©å±•ã€‚å› ä¸ºé¢å‘å¯¹è±¡æœ‰å°è£…ã€ç»§æ‰¿ã€å¤šæ€çš„ç‰¹æ€§ï¼Œä½è€¦åˆç³»ç»Ÿã€‚</li></ul><p>ç±»åŠ è½½å­ç³»ç»Ÿ</p><p><img src="/2021/03/15/java/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F.PNG"></p><h3 id="gt-å¯¹è±¡åŠ è½½çš„5ä¸ªæ­¥éª¤"><a href="#gt-å¯¹è±¡åŠ è½½çš„5ä¸ªæ­¥éª¤" class="headerlink" title="> å¯¹è±¡åŠ è½½çš„5ä¸ªæ­¥éª¤"></a><font color="green">&gt; å¯¹è±¡åŠ è½½çš„5ä¸ªæ­¥éª¤</font></h3><ol><li><strong>ç±»åŠ è½½æ£€æŸ¥</strong>ã€‚å½“ä½¿ç”¨new ç”Ÿæˆä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šé¦–å…ˆå»æ£€æŸ¥å¸¸é‡æ± ä¸­æœ‰æ²¡æœ‰å¯¹è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œå†æ£€æŸ¥è¿™ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»<font color="purple">åŠ è½½ã€è§£æã€åˆå§‹åŒ–</font>è¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šè¿›è¡Œç±»åŠ è½½ã€‚</li><li><strong>åˆ†é…å†…å­˜</strong>ã€‚åœ¨JAVAå †ä¸­ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚å†…å­˜åˆ†é…æœºåˆ¶æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯<strong>æŒ‡é’ˆç¢°æ’</strong>ï¼Œç¬¬äºŒç§æ˜¯<strong>ç©ºé—²åˆ—è¡¨</strong>ã€‚åˆ†é…æ–¹å¼ç”±JAVAå †æ˜¯å¦è§„æ•´å†³å®šï¼ŒJAVAå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾å›æ”¶å™¨æ˜¯å¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šã€‚</li><li><strong>åˆå§‹åŒ–é›¶å€¼</strong>ã€‚ä¸ºå†…å­˜ä¸­å·²ç»åˆ†é…çš„å¯¹è±¡æ•°æ®åˆå§‹åŒ–é›¶å€¼ï¼Œè¿™æ ·å¯¹è±¡å¯ä»¥ä¸èµ‹åˆå§‹å€¼ç›´æ¥ä½¿ç”¨ã€‚</li><li><strong>åˆ†é…å¯¹è±¡å¤´</strong>ã€‚å¯¹è±¡å¤´åŒ…æ‹¬ç±»å…ƒæ•°æ®ã€å¯¹è±¡çš„å“ˆå¸Œç ä»¥åŠå¯¹è±¡çš„GCåˆ†ä»£å¹´é¾„ç­‰ã€‚</li><li><strong>initåˆå§‹åŒ–</strong>ã€‚æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿å¯¹ç±»ä¸­çš„æ•°æ®è¿›è¡Œåˆå§‹åŒ–ã€‚</li></ol><h3 id="gt-å¯¹è±¡çš„å†…å­˜å¸ƒå±€"><a href="#gt-å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="headerlink" title=">å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></a><font color="green">&gt;å¯¹è±¡çš„å†…å­˜å¸ƒå±€</font></h3><ol><li><strong>å¯¹è±¡å¤´</strong>ã€‚åŒ…æ‹¬å¯¹è±¡çš„å“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ç­‰ã€‚</li><li><strong>å®ä¾‹æ•°æ®</strong>ã€‚ç¨‹åºä¸­æ‰€så®šä¹‰çš„å„ç§å­—æ®µå†…å®¹ã€‚</li><li><strong>å¯¹é½å¡«å……</strong>ã€‚ç”±äºå¯¹è±¡å ä½å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ‰€ä»¥å½“å¯¹è±¡å®ä¾‹éƒ¨åˆ†ç©ºé—´æœªå æ»¡æ—¶ï¼ˆå¯¹è±¡å¤´æœ¬èº«æ˜¯8å­—èŠ‚çš„1å€æˆ–2å€ï¼‰ï¼Œä¼šå¯¹å‰©ä½™ç©ºé—´è¿›è¡Œå¡«å……ã€‚</li></ol><h3 id="gt-å¥æŸ„å’Œç›´æ¥å¼•ç”¨"><a href="#gt-å¥æŸ„å’Œç›´æ¥å¼•ç”¨" class="headerlink" title="> å¥æŸ„å’Œç›´æ¥å¼•ç”¨"></a><font color="green">&gt; å¥æŸ„å’Œç›´æ¥å¼•ç”¨</font></h3><ol><li><strong>å¥æŸ„</strong>ã€‚æŒ‡é’ˆçš„æŒ‡é’ˆã€‚JAVAå †ä¸­åˆ†é…å¥æŸ„æ± ï¼Œå­˜å‚¨å®ä¾‹å¯¹è±¡çš„åœ°å€ã€‚</li></ol><p><img src="/2021/03/15/java/%E5%8F%A5%E6%9F%84.png" alt="å¥æŸ„"></p><p><strong>ä¼˜ç‚¹</strong>ï¼šä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªå˜é‡å¼•ç”¨ï¼Œé‚£ä¹ˆåªéœ€è¦æ›´æ”¹å¥æŸ„æ± ä¸€ä¸ªã€‚å½“å¯¹è±¡åœ°å€æ”¹å˜æ—¶ï¼Œåªéœ€æ”¹å˜å¥æŸ„æ± å†…å®¹å³å¯ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šé€Ÿåº¦æ…¢ã€‚</p><ol start="2"><li><strong>ç›´æ¥æŒ‡é’ˆ</strong>ã€‚æŒ‡é’ˆï¼Œç›´æ¥ä¿å­˜å¯¹è±¡åœ°å€ã€‚é€Ÿåº¦å¿«ï¼Œçœå»äº†å¥æŸ„æ± è¿˜å¾—å†æ¬¡å¯»æ‰¾åœ°å€ã€‚</li></ol><p><strong>ä¼˜ç‚¹</strong>ï¼šé€Ÿåº¦å¿«ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šå¯¹è±¡è¢«ç§»åŠ¨æ—¶ï¼Œæ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„referenceéƒ½éœ€è¦è¢«æ”¹å˜ï¼Œè€—æ—¶ã€‚</p><h3 id="gt-åŒäº²å§”æ´¾æœºåˆ¶"><a href="#gt-åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="> åŒäº²å§”æ´¾æœºåˆ¶"></a>&gt; <font color="green">åŒäº²å§”æ´¾æœºåˆ¶</font></h3><p>å½“è¦åŠ è½½æŸä¸ªç±»æ—¶ï¼Œéœ€è¦æŠŠä»»åŠ¡å§”æ‰˜ç»™ä¸Šçº§ç±»åŠ è½½å™¨ï¼Œé€’å½’è¯¢é—®æ˜¯å¦å·²ç»åŠ è½½æ­¤ç±»ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè‡ªå·±æ‰ä¼šåŠ è½½ã€‚</p><p><img src="/2021/03/15/java/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6.png" alt="å¥æŸ„"></p><ol><li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrapClassLoaderï¼‰<code>C++</code> ç¼–å†™</li></ol><p>åŠ è½½<code>java</code>æ ¸å¿ƒåº“ <code>java.*</code>,æ„é€ <code>ExtClassLoader</code>å’Œ<code>AppClassLoader</code>ã€‚æ¶‰åŠåˆ°è™šæ‹Ÿæœºæœ¬åœ°å®ç°ç»†èŠ‚ï¼Œå¼€å‘è€…æ— æ³•è·å–åˆ°å¯åŠ¨ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œä¸å…è®¸ç›´æ¥é€šè¿‡å¼•ç”¨è¿›è¡Œæ“ä½œã€‚</p><ol start="2"><li>æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtClassLoaderï¼‰<code>java</code> ç¼–å†™ (javaå®˜æ–¹å…¶å®ä»è¿™é‡Œå°±å¼€å§‹å«åšè‡ªå®šä¹‰åŠ è½½å™¨äº†ï¼Œæ‰€æœ‰ç»§æ‰¿è‡ªclassloaderçš„ç±»éƒ½æ˜¯è‡ªå®šä¹‰åŠ è½½å™¨)</li></ol><p>åŠ è½½æ‰©å±•åº“å¦‚<code>classpath</code>ä¸­çš„<code>jre</code> ï¼Œ<code>javax.*</code>æˆ–è€…<br><code>java.ext.dir</code> æŒ‡å®šä½ç½®ä¸­çš„ç±»ï¼Œå¼€å‘è€…å¯ä½¿ç”¨æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ã€‚</p><ol start="3"><li>ç³»ç»Ÿç±»åŠ è½½å™¨ ï¼ˆAppClassLoaderï¼‰<code>java</code> ç¼–å†™</li></ol><p>åŠ è½½ç¨‹åºæ‰€åœ¨çš„ç›®å½•ï¼Œå¦‚<code>user.dir</code>æ‰€åœ¨çš„ä½ç½®çš„<code>class</code>ã€‚</p><ol start="4"><li>ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustomClassLoaderï¼‰<code>java</code> ç¼–å†™</li></ol><p>ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨,å¯åŠ è½½æŒ‡å®šè·¯å¾„çš„<code>class</code>æ–‡ä»¶ã€‚ éœ€è¦éš”ç¦»åŠ è½½ç±»ã€ä¿®æ”¹ç±»åŠ è½½æ–¹å¼ã€æ‰©å±•åŠ è½½æºã€é˜²æ­¢æºç æ³„éœ²ç­‰éœ€è¦è‡ªå®šä¹‰åŠ è½½å™¨ã€‚</p><p>ä½œç”¨ï¼š</p><p>1.é˜²æ­¢é‡å¤åŠ è½½åŒä¸€ä¸ªç±»ã€‚</p><p>2.é˜²æ­¢ä»£ç è¢«ç¯¡æ”¹ã€‚ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªè¢«åŠ è½½çš„ç±»ï¼Œå·²ç»åŠ è½½çš„ç±»ä¸èƒ½è¢«ç¯¡æ”¹ï¼‰ã€‚</p><p>æ³¨æ„ï¼Œè¿™4ç§æ˜¯åŒ…å«å…³ç³»ï¼Œä¸æ˜¯ä¸Šä¸‹çº§å…³ç³»ã€‚</p><p>åŒäº²å§”æ´¾æœºåˆ¶ä¿è¯äº†Javaçš„æ²™ç®±å®‰å…¨æœºåˆ¶ã€‚æ¯”å¦‚ä½ è‡ªå®šä¹‰Stringç±»ï¼Œä½†æ˜¯åœ¨åŠ è½½è‡ªå®šä¹‰Stringç±»çš„æ—¶å€™ä¼šç‡å…ˆä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œå¼•å¯¼ç±»åŠ è½½å™¨åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¼šå…ˆåŠ è½½jdkè‡ªå¸¦çš„æ–‡ä»¶ã€‚</p><h3 id="lt-JVMç»“æ„"><a href="#lt-JVMç»“æ„" class="headerlink" title="< JVMç»“æ„"></a><font color="green">&lt; JVMç»“æ„</font></h3><p>HotSpotæ˜¯ä½¿ç”¨æŒ‡é’ˆçš„æ–¹å¼æ¥è®¿é—®å¯¹è±¡ï¼šjavaå †ä¸­å­˜æ”¾è®¿é—®ç±»å…ƒæ•°æ®ï¼ˆæè¿°æ•°æ®çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ¨¡æ¿ï¼‰çš„åœ°å€ï¼Œreferenceå­˜å‚¨çš„å°±ç›´æ¥æ˜¯å¯¹è±¡çš„åœ°å€ã€‚</p><p><img src="/2021/03/15/java/JVM1.7.png" alt="å¥æŸ„"></p><p><img src="/2021/03/15/java/JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.png" alt="å¥æŸ„"></p><pre class="line-numbers language-none"><code class="language-none">ç¨‹åºè®¡æ•°å™¨<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>ç¨‹åºè®¡æ•°å™¨ <strong>çº¿ç¨‹ç§æœ‰</strong></li></ol><ul><li><p>æ¦‚å¿µï¼šè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„<strong>æŒ‡ä»¤å­—èŠ‚ç åœ°å€</strong>ã€‚</p></li><li><p>åŠŸèƒ½ï¼šæ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡ŒæŒ‡ä»¤çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è®¡æ•°å™¨å®Œæˆã€‚</p></li><li><p><strong>å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° <code>OutOfMemoryError </code>çš„å†…å­˜åŒºåŸŸ</strong>ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚</p></li></ul><pre class="line-numbers language-none"><code class="language-none">è™šæ‹Ÿæœºæ ˆ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>è™šæ‹Ÿæœºæ ˆ <strong>çº¿ç¨‹ç§æœ‰</strong></li></ol><p><img src="/2021/03/15/java/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.png" alt="å¥æŸ„"></p><p><img src="/2021/03/15/java/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%882.png" alt="å¥æŸ„"></p><ul><li><p>æ ˆå­˜å‚¨çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨å˜é‡ã€8ç§åŸºæœ¬ç±»å‹å’Œå®ä¾‹æ–¹æ³•ã€‚</p></li><li><p>æ ˆå¸§ç†è§£æˆjavaä¸­çš„æ–¹æ³•ã€‚stackoverflowerroræ˜¯ä¸ªé”™è¯¯ã€‚</p></li><li><p>Javaè™šæ‹Ÿæœºæ ˆæ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆï¼Œè€Œæ¯ä¸ªæ ˆå¸§ä¸­éƒ½æ‹¥æœ‰ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ä¿¡æ¯ã€‚</p></li><li><p><strong>å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹</strong>ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€<strong>å¯¹è±¡å¼•ç”¨</strong>ï¼ˆreferenceç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ã€‚</p></li><li><p>Java è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§å¼‚å¸¸ï¼šStackOverFlowError å’Œ OutOfMemoryErrorã€‚</p><p><strong>StackOverFlowErrorï¼š</strong> è‹¥Javaè™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰Javaè™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡ºStackOverFlowErrorå¼‚å¸¸ã€‚</p><p><strong>OutOfMemoryErrorï¼š</strong> è‹¥ Java è™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°å…è®¸åŠ¨æ€æ‰©å±•ï¼Œä¸”å½“çº¿ç¨‹è¯·æ±‚æ ˆæ—¶å†…å­˜ç”¨å®Œäº†ï¼Œæ— æ³•å†åŠ¨æ€æ‰©å±•äº†ï¼Œæ­¤æ—¶æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p></li><li><p>Javaæ–¹æ³•æœ‰ä¸¤ç§è¿”å›æ–¹å¼ï¼š</p></li></ul><ol><li><p>return è¯­å¥ã€‚</p></li><li><p>æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ä¸ç®¡å“ªç§è¿”å›æ–¹å¼éƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚</p></li></ol><ul><li><strong>i++ å’Œ ++i çš„åŒºåˆ«ï¼š</strong><ol><li>i++ï¼šä»å±€éƒ¨å˜é‡è¡¨å–å‡º i å¹¶å‹å…¥æ“ä½œæ ˆ(load memory)ï¼Œç„¶åå¯¹å±€éƒ¨å˜é‡è¡¨ä¸­çš„ i è‡ªå¢ 1(add&amp;store memory)ï¼Œå°†æ“ä½œæ ˆæ ˆé¡¶å€¼å–å‡ºä½¿ç”¨ï¼Œå¦‚æ­¤çº¿ç¨‹ä»æ“ä½œæ ˆè¯»åˆ°çš„æ˜¯è‡ªå¢ä¹‹å‰çš„å€¼ã€‚</li><li>++iï¼šå…ˆå¯¹å±€éƒ¨å˜é‡è¡¨çš„ i è‡ªå¢ 1(load memory&amp;add&amp;store memory)ï¼Œç„¶åå–å‡ºå¹¶å‹å…¥æ“ä½œæ ˆ(load memory)ï¼Œå†å°†æ“ä½œæ ˆæ ˆé¡¶å€¼å–å‡ºä½¿ç”¨ï¼Œçº¿ç¨‹ä»æ“ä½œæ ˆè¯»åˆ°çš„æ˜¯è‡ªå¢ä¹‹åçš„å€¼ã€‚</li></ol></li></ul><pre class="line-numbers language-none"><code class="language-none">æœ¬åœ°æ–¹æ³•æ ˆ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>æœ¬åœ°æ–¹æ³•æ ˆ <strong>çº¿ç¨‹ç§æœ‰</strong></li></ol><ul><li><p> <strong>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚</strong> åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚ï¼ˆæœ¬åœ°æ–¹æ³•=android é‡Œé¢çš„JNI ç”¨å…¶ä»–è¯­è¨€ä¾‹å¦‚C++)</p></li><li><p> æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚</p></li><li><p> ä¹Ÿä¼šå‡ºç° StackOverFlowError å’Œ OutOfMemoryError ä¸¤ç§å¼‚å¸¸ã€‚</p></li></ul><pre class="line-numbers language-none"><code class="language-none">javaå †<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>å † çº¿ç¨‹<strong>å…±äº«</strong></li></ol><ul><li><p>å­˜æ”¾<strong>å¯¹è±¡å®ä¾‹</strong>ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠ<strong>æ•°ç»„</strong>éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</p></li><li><p>ä¸»è¦è®°<strong>åƒåœ¾å›æ”¶æœºåˆ¶</strong>ã€‚</p></li></ul><pre class="line-numbers language-none"><code class="language-none">æ–¹æ³•åŒº<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>æ–¹æ³•åŒº çº¿ç¨‹<strong>å…±äº«</strong> JDK1.8æ›¿æ¢ä¸ºå…ƒç©ºé—´</li></ol><ul><li>å­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</li><li>åˆ«åå«åš Non-Heapï¼ˆéå †ï¼‰ã€‚æ°¸ä¹…ä»£ä¹Ÿå«æ–¹æ³•åŒºã€‚</li></ul><pre class="line-numbers language-none"><code class="language-none">è¿è¡Œæ—¶å¸¸é‡æ± <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="6"><li>è¿è¡Œæ—¶å¸¸é‡æ±  çº¿ç¨‹<strong>å…±äº«</strong></li></ol><ul><li><p>æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚</p></li><li><p>è¿è¡ŒæœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼Œä¾‹å¦‚ String ç±»çš„ intern() æ–¹æ³•ã€‚</p></li></ul><pre class="line-numbers language-none"><code class="language-none">ç›´æ¥å†…å­˜<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="7"><li>ç›´æ¥å†…å­˜ çº¿ç¨‹<strong>å…±äº«</strong></li></ol><ul><li><p>ä¸æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚</p></li><li><p>å—åˆ°æœ¬æœºæ€»å†…å­˜ï¼ˆåŒ…æ‹¬ RAM ä»¥åŠ SWAP åŒºæˆ–è€…åˆ†é¡µæ–‡ä»¶ï¼‰å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚</p></li></ul><pre class="line-numbers language-none"><code class="language-none">å…ƒç©ºé—´<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="8"><li>å…ƒç©ºé—´ çº¿ç¨‹<strong>å…±äº«</strong></li></ol><ul><li>ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼ˆç›´æ¥å†…å­˜ï¼‰æ¥å­˜å‚¨ç±»å…ƒæ•°æ®ä¿¡æ¯å¹¶ç§°ä¹‹ä¸ºï¼šå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</li><li>java8ä¸­ç§»é™¤äº†æ°¸ä¹…ä»£ï¼ˆå°±æ˜¯<strong>æ–¹æ³•åŒº</strong>ï¼‰ï¼Œæ–°å¢å…ƒç©ºé—´ï¼Œè¿™ä¸¤è€…ä¹‹é—´å­˜å‚¨çš„å†…å®¹ï¼ˆå¸¸é‡æ± ï¼Œç±»ä¿¡æ¯ï¼Œè¿˜æœ‰classçš„staticå˜é‡ï¼‰å‡ ä¹æ²¡æ€ä¹ˆå˜åŒ–ï¼Œè€Œæ˜¯åœ¨å†…å­˜é™åˆ¶ã€åƒåœ¾å›æ”¶ç­‰æœºåˆ¶ä¸Šæ”¹å˜è¾ƒå¤§ã€‚å…ƒç©ºé—´çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³çªå‡ºçš„ç±»å’Œç±»åŠ è½½å™¨å…ƒæ•°æ®è¿‡å¤šå¯¼è‡´çš„å†…å­˜æº¢å‡ºé—®é¢˜ã€‚</li></ul><ol><li>ä½¿ç”¨JDK1.7è¿è¡ŒJavaç¨‹åºï¼Œç›‘æ§å¹¶è€—å°½é»˜è®¤è®¾å®šçš„85MBå¤§å°çš„PermGenï¼ˆ1.7ä¹‹å‰æ˜¯PermGenï¼Œ1.8æ”¹ä¸ºå…ƒç©ºé—´ï¼‰å†…å­˜ç©ºé—´ã€‚</li><li>ä½¿ç”¨JDK1.8è¿è¡ŒJavaç¨‹åºï¼Œç›‘æ§æ–°Metaspaceå†…å­˜ç©ºé—´çš„åŠ¨æ€å¢é•¿å’Œåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚</li><li>ä½¿ç”¨JDK1.8è¿è¡ŒJavaç¨‹åºï¼Œæ¨¡æ‹Ÿè€—å°½é€šè¿‡â€œMaxMetaspaceSizeâ€å‚æ•°è®¾å®šçš„128MBå¤§å°çš„Metaspaceå†…å­˜ç©ºé—´ã€‚</li></ol><p><img src="/2021/03/15/java/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA3.png" alt="å¥æŸ„"></p><ol start="9"><li>å †å‚æ•°è°ƒä¼˜</li></ol><table><thead><tr><th>-Xms</th><th>è®¾ç½®åˆå§‹åˆ†é…å¤§å°ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„â€œ1/64â€</th></tr></thead><tbody><tr><td>-Xmx</td><td>æœ€å¤§åˆ†é…å†…å­˜ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„â€1/4â€</td></tr><tr><td>-XX:+PrintGCDetails</td><td>è¾“å‡ºè¯¦ç»†çš„GCå¤„ç†æ—¥å¿—</td></tr><tr><td>-XX:MaxTenuringThreshold</td><td>è®¾ç½®å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­çš„å­˜æ´»çš„æ¬¡æ•°</td></tr></tbody></table><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token punctuation">{</span>    <span class="token class-name">Runtime<span class="token punctuation">.</span>GetRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Runtime<span class="token punctuation">.</span>GetRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Runtime<span class="token punctuation">.</span>GetRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æœ€å¥½åˆå§‹å†…å­˜å’Œæœ€å¤§å†…å­˜è®¾ç½®æˆä¸€æ ·çš„ã€‚é¿å…å†…å­˜å¿½é«˜å¿½ä½ã€‚</li></ul><h3 id="lt-åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#lt-åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="< åƒåœ¾å›æ”¶æœºåˆ¶"></a><font color="green">&lt; åƒåœ¾å›æ”¶æœºåˆ¶</font></h3><p>GC = YGC = è½»é‡çº§GC</p><p>å…»è€åŒºæ»¡äº† FULL GC = FGC é‡é‡çº§GCï¼Œå¦‚æœæ²¡åŠæ³•è…¾ç©ºé—´ï¼Œåˆ™OOM</p><ol><li><strong>åˆ¤å®š</strong>å“ªäº›å¯¹è±¡æ˜¯åƒåœ¾</li></ol><ul><li>å¼•ç”¨è®¡æ•°æ³•</li></ul><p>æ¯ä¸ªå¯¹è±¡éƒ½åˆ†é…ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨æ¥å­˜å‚¨è¯¥å¯¹è±¡è¢«å¼•ç”¨çš„ä¸ªæ•°ã€‚å½“æœ‰åœ°æ–¹å¼•ç”¨å®ƒï¼Œè®¡æ•°å™¨åŠ 1ã€‚å½“ä¸ªæ•°ä¸º0ï¼Œåˆ™å¯ä»¥å›æ”¶ã€‚</p><p>æ­¤æ–¹æ³•æœ‰ä¸€ä¸ª<strong>ç¼ºé™·</strong>ï¼šä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œè®¡æ•°å™¨æ°¸è¿œä¸ä¸º0ã€‚æ‰€ä»¥JAVAæ²¡é‡‡ç”¨æ­¤æ–¹æ³•ã€‚</p><ul><li>å¯è¾¾æ€§åˆ†æ</li></ul><p>æŠŠæ‰€æœ‰å¼•ç”¨å¯¹è±¡æŠ½è±¡æˆä¸€æ£µæ ‘ï¼Œä»æ ‘<strong>GC Roots</strong>æ ¹ç»“ç‚¹å‡ºå‘ï¼Œéå†æ‰€æœ‰æ ‘æã€‚æ‰¾åˆ°çš„å°±æ˜¯å¯è¾¾ï¼Œåˆ¤å®šå­˜æ´»ï¼Œä¸èƒ½æ‰¾åˆ°çš„å°±æ˜¯å¯å›æ”¶å¯¹è±¡ã€‚</p><p><img src="/2021/03/15/java/%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90.png" alt="å¥æŸ„"></p><ul><li>GC Rootsçš„ç§ç±»ï¼š</li></ul><p>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p>æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡ã€‚</p><p><img src="/2021/03/15/java/gc.PNG"></p><ol start="2"><li><strong>å›æ”¶åƒåœ¾ç®—æ³•</strong> ï¼ˆ4ä¸ªï¼‰</li></ol><ul><li>æ ‡è®°-æ¸…ç†</li></ul><p>1ï¼‰æ ‡è®°ï¼Œåˆ©ç”¨å¯è¾¾æ€§åˆ†æï¼Œæ‰¾åˆ°åƒåœ¾å¯¹è±¡ã€‚</p><p>ä¼˜ç‚¹ï¼šç®€å•å¿«æ·ã€‚</p><p>ç¼ºç‚¹ï¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p><p><img src="/2021/03/15/java/%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95.png" alt="å¥æŸ„"></p><ul><li>æ ‡è®°-æ•´ç†</li></ul><p>æ ‡è®°æ¸…ç†ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡æ‰€ä»¥ï¼š</p><p>1ï¼‰å¯è¾¾æ€§åˆ†ææ‰¾åˆ°åƒåœ¾å¯¹è±¡å’Œå­˜æ´»å¯¹è±¡ã€‚</p><p>2ï¼‰æŠŠæ‰€æœ‰å­˜æ´»å¯¹è±¡å †åˆ°åŒä¸€ä¸ªåœ°æ–¹ï¼Œæ²¡æœ‰å†…å­˜ç¢ç‰‡ã€‚</p><p>é€‚åˆå­˜æ´»å¯¹è±¡å¤šï¼Œåƒåœ¾å°‘çš„æƒ…å†µã€‚</p><p><img src="/2021/03/15/java/%E6%A0%87%E8%AE%B0%E6%95%B4%E7%90%86.png" alt="å¥æŸ„"></p><ul><li>å¤åˆ¶</li></ul><p>å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡ä½¿ç”¨å…¶ä¸­ä¸€å—ã€‚è¿™ä¸€å—ç”¨å®Œäº†ï¼Œå°†æ´»ç€çš„é˜Ÿå½¢å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åæŠŠä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ€§æ¸…ç†æ‰ã€‚</p><p><img src="/2021/03/15/java/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95.png" alt="å¥æŸ„"></p><p>ä¼˜ç‚¹ï¼šç®€å•å¿«é€Ÿã€ä¸ä¼šäº§ç”Ÿç¢ç‰‡</p><p>ç¼ºç‚¹ï¼šå†…å­˜åˆ©ç”¨ç‡å¾ˆä½ï¼Œåªç”¨äº†ä¸€åŠã€‚</p><ul><li><strong>åˆ†ä»£å›æ”¶ç®—æ³•</strong></li></ul><p>javaå †åˆ†ä¸ºåˆšåˆšåˆ›å»ºçš„å¯¹è±¡ã€å­˜æ´»äº†ä¸€æ®µæ—¶é—´çš„å¯¹è±¡å’Œæ°¸ä¹…å­˜åœ¨çš„å¯¹è±¡ã€‚</p><p>æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹ä¸º1ï¼š2ã€‚</p><p><img src="/2021/03/15/java/java%E6%96%B0%E7%94%9F%E4%BB%A3.png" alt="å¥æŸ„"></p><p><strong>è®¾ç½®ä¸¤ä¸ª Survivor åŒºè§£å†³å†…å­˜ç¢ç‰‡åŒ–</strong>ã€‚Survivor å¦‚æœåªæœ‰ä¸€ä¸ªåŒºåŸŸï¼ŒMinor GC æ‰§è¡Œåï¼ŒEden åŒºè¢«æ¸…ç©ºäº†ï¼Œå­˜æ´»çš„å¯¹è±¡æ”¾åˆ°äº† S1ï¼ˆfromï¼‰ åŒºï¼Œè€Œä¹‹å‰ S1 åŒºä¸­çš„å¯¹è±¡ï¼Œå¯èƒ½ä¹Ÿæœ‰ä¸€äº›æ˜¯éœ€è¦è¢«æ¸…é™¤çš„ã€‚è¿™æ—¶å€™æˆ‘ä»¬æ€ä¹ˆæ¸…é™¤å®ƒä»¬ï¼Ÿåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æ ‡è®°æ¸…é™¤ï¼Œæ ‡è®°æ¸…é™¤æœ€å¤§çš„é—®é¢˜å°±æ˜¯å†…å­˜ç¢ç‰‡ã€‚æœ‰äº†s2ï¼ˆtoï¼‰ï¼Œå°†ä¹‹å‰ Eden åŒºå’Œ From åŒºï¼ˆs1)ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ° To åŒºåŸŸ(s2)ã€‚ç¬¬äºŒæ¬¡ Minor GC æ—¶ï¼ŒFrom ä¸ To èŒè´£æ¢ä¸€ä¸‹ï¼Œè¿™æ—¶å€™ä¼šå°† Eden åŒºå’Œ s2 åŒºä¸­çš„å­˜æ´»å¯¹è±¡å†å¤åˆ¶åˆ° s1 åŒºåŸŸï¼Œä»¥æ­¤åå¤ã€‚</p><p><strong>æ–°ç”Ÿä»£-å¤åˆ¶ å›æ”¶æœºåˆ¶</strong>ï¼š</p><p>åŒºåŸŸå¤§å°æ¯”ä¾‹Eden:s1:s2= 8: 1:1ï¼ˆHotspotè™šæ‹Ÿæœºè¿™æ ·åˆ’åˆ†ï¼‰ã€‚æ–°ç”Ÿä»£æ¯æ¬¡éƒ½æœ‰å¤§é‡å¯¹è±¡æ­»äº¡ï¼Œåªæœ‰å°‘é‡å­˜æ´»ã€‚å› æ­¤é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå›æ”¶æ—¶GCæŠŠå°‘é‡å­˜æ´»å¯¹è±¡å¤åˆ¶è¿‡å»å³å¯ã€‚</p><p><strong>åªæœ‰ç»å†16æ¬¡ Minor GC è¿˜èƒ½åœ¨æ–°ç”Ÿä»£ä¸­å­˜æ´»çš„å¯¹è±¡ï¼Œæ‰ä¼šè¢«é€åˆ°è€å¹´ä»£ã€‚</strong></p><p><img src="/2021/03/15/java/java%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.png" alt="å¥æŸ„"></p><p>å·¥ä½œåŸç†ï¼š</p><p>1ï¼‰EdenåŒºåŸŸå¿«æ»¡äº†ï¼Œ**è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆYoung GC)**ã€‚æ­¤è½®å­˜æ´»å¯¹è±¡æ”¾å…¥From(s1)ã€‚</p><p>2ï¼‰Edenå†æ¬¡æ»¡ï¼Œ<strong>è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆYoung GC)<strong>ï¼Œå›æ”¶Edenå’ŒFromï¼ˆs1ï¼‰ï¼Œå­˜æ´»æ”¾å…¥Toï¼ˆs2ï¼‰ã€‚æ­¤æ—¶s1ç©ºäº†ï¼Œä¸‹ä¸€æ¬¡å›æ”¶æ—¶</strong>s1å’Œs2èŒè´£å¯¹æ¢</strong>ï¼Œä¸‹ä¸€æ¬¡Edenæ»¡æ—¶å°†Edenå’ŒToï¼ˆs2ï¼‰çš„å­˜æ´»å¯¹è±¡æ”¾å…¥Fromï¼ˆs1ï¼‰ï¼Œ å¦‚æ­¤å¾€å¤ã€‚å¤šæ¬¡åä¸€äº›å¯¹è±¡åœ¨s1å’Œs2ä¹‹é—´å¤šæ¬¡å¤åˆ¶ï¼Œå¤åˆ¶æ¬¡æ•°è¶…è¿‡æŸä¸ªé˜ˆå€¼<strong>ï¼ˆ16ï¼‰</strong>åï¼ŒæŠŠå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°OldåŒºåŸŸã€‚</p><p>3ï¼‰å½“æŸä¸ªsåŒºåŸŸä¸è¶³ä»¥å­˜æ”¾å­˜æ´»å¯¹è±¡ï¼Œå°†å¤šä½™å¯¹è±¡æ”¾åˆ°OldåŒºåŸŸã€‚</p><p>4ï¼‰OldåŒºåŸŸæ»¡äº†ï¼Œ<strong>è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆFull GCï¼‰</strong>ï¼Œè¿›è¡Œæ•´ä¸ªå †çš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ä¹Ÿè¦å›æ”¶äº†ï¼Œç”¨è€å¹´ä»£è‡ªå·±çš„å›æ”¶ç®—æ³•ï¼‰ï¼Œè·³åˆ°1ï¼‰è¿›è¡Œæ–°ä¸€è½®åƒåœ¾å›æ”¶ç®—æ³•ã€‚</p><p><strong>è€å¹´ä»£-æ ‡è®°æ•´ç† å›æ”¶æœºåˆ¶</strong>ï¼š</p><p>è€å¹´ä»£å­˜æ´»å¯¹è±¡å¤šã€åƒåœ¾å°‘ã€‚è€å¹´ä»£ä»…ä»…é€šè¿‡å°‘é‡åœ°ç§»åŠ¨å­˜æ´»å¯¹è±¡å°±èƒ½æ¸…ç†åƒåœ¾ã€‚</p><p><strong>Full GC</strong> è§¦å‘æƒ…å†µï¼š</p><p>ã€€ã€€1ï¼‰å¹´è€ä»£ï¼ˆTenuredï¼‰è¢«å†™æ»¡</p><p>ã€€ã€€2ï¼‰æŒä¹…ä»£ï¼ˆPermï¼‰è¢«å†™æ»¡ </p><p>ã€€ã€€3ï¼‰System.gc()è¢«æ˜¾ç¤ºè°ƒç”¨ </p><p>ã€€ã€€4ï¼‰ä¸Šä¸€æ¬¡GCä¹‹åHeapçš„å„åŸŸåˆ†é…ç­–ç•¥åŠ¨æ€å˜åŒ–</p><ol start="3"><li><strong>åƒåœ¾å›æ”¶å™¨</strong> ï¼ˆhotspotè™šæ‹Ÿæœºï¼‰</li></ol><ul><li>ååé‡</li></ul><p>CPU ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ã€‚æ¯”å¦‚è¯´è™šæ‹Ÿæœºæ€»è¿è¡Œäº† 100 åˆ†é’Ÿï¼Œç”¨æˆ·ä»£ç æ—¶é—´ 99 åˆ†é’Ÿï¼Œåƒåœ¾å›æ”¶ æ—¶é—´ 1 åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯ 99%ã€‚</p><ul><li>åœé¡¿æ—¶é—´</li></ul><p>åœé¡¿æ—¶é—´ æŒ‡åƒåœ¾å›æ”¶å™¨æ­£åœ¨è¿è¡Œæ—¶ï¼Œåº”ç”¨ç¨‹åº çš„ æš‚åœæ—¶é—´ã€‚</p><ul><li>GCçš„åè¯</li></ul><p>æ–°ç”Ÿä»£GCï¼šMinor GC </p><p>è€å¹´ä»£GCï¼šMajor GC</p><ul><li>å¹¶å‘ä¸å¹¶è¡Œ</li></ul><p>ï¼ˆ1ï¼‰ä¸²è¡Œï¼ˆParallelï¼‰</p><p>åƒåœ¾å›æ”¶çº¿ç¨‹ è¿›è¡Œåƒåœ¾å›æ”¶å·¥ä½œï¼Œä½†æ­¤æ—¶ ç”¨æˆ·çº¿ç¨‹ ä»ç„¶å¤„äº ç­‰å¾…çŠ¶æ€ã€‚</p><p>ï¼ˆ2ï¼‰å¹¶å‘ï¼ˆConcurrentï¼‰</p><p>è¿™é‡Œçš„å¹¶å‘æŒ‡ ç”¨æˆ·çº¿ç¨‹ ä¸ åƒåœ¾å›æ”¶çº¿ç¨‹ äº¤æ›¿æ‰§è¡Œã€‚</p><p>ï¼ˆ3ï¼‰å¹¶è¡Œï¼ˆParallelï¼‰</p><p>è¿™é‡Œçš„å¹¶è¡ŒæŒ‡ ç”¨æˆ·çº¿ç¨‹ å’Œå¤šæ¡ åƒåœ¾å›æ”¶çº¿ç¨‹ åˆ†åˆ«åœ¨ä¸åŒ CPU ä¸ŠåŒæ—¶å·¥ä½œã€‚</p><p><img src="/2021/03/15/java/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.png" alt="å¥æŸ„"></p><p>å›æ”¶å™¨ç§ç±»ï¼š</p><p><strong>1ï¼‰Serialï¼ˆå•çº¿ç¨‹ï¼‰</strong></p><p>Serial å›æ”¶å™¨æ˜¯æœ€åŸºæœ¬çš„ æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œæ˜¯å•çº¿ç¨‹çš„åƒåœ¾å›æ”¶å™¨ã€‚é‡‡ç”¨çš„æ˜¯ <strong>å¤åˆ¶</strong>ç®—æ³•ã€‚åƒåœ¾æ¸…ç†æ—¶ï¼ŒSerialå›æ”¶å™¨ä¸å­˜åœ¨çº¿ç¨‹é—´çš„åˆ‡æ¢ï¼Œå› æ­¤ï¼Œåœ¨å• CPUçš„ç¯å¢ƒä¸‹ï¼Œåƒåœ¾æ¸…é™¤æ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p><p><strong>2ï¼‰Serial Oldï¼ˆå•çº¿ç¨‹ï¼‰</strong></p><p>Serial Oldå›æ”¶å™¨æ˜¯ Serialå›æ”¶å™¨çš„è€ç”Ÿä»£ç‰ˆæœ¬ï¼Œå•çº¿ç¨‹å›æ”¶å™¨ï¼Œä½¿ç”¨ <strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ã€‚åœ¨ JDK1.5 åŠå…¶ä»¥å‰ï¼Œå®ƒå¸¸ä¸Parallel Scavengeå›æ”¶å™¨é…åˆä½¿ç”¨ï¼Œè¾¾åˆ°è¾ƒå¥½çš„ååé‡ï¼Œå¦å¤–å®ƒä¹Ÿæ˜¯ CMS å›æ”¶å™¨åœ¨Concurrent Mode Failureæ—¶çš„åå¤‡æ–¹æ¡ˆã€‚</p><p><strong>3ï¼‰ParNewï¼ˆå¤šçº¿ç¨‹ï¼‰</strong></p><p>ParNewå›æ”¶å™¨æ˜¯åœ¨Serialå›æ”¶å™¨çš„åŸºç¡€ä¸Šæ¼”åŒ–è€Œæ¥çš„ï¼Œå±äºSerialå›æ”¶å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé‡‡ç”¨<strong>å¤åˆ¶</strong>ç®—æ³•ã€‚è¿è¡Œåœ¨æ–°ç”Ÿä»£åŒºåŸŸã€‚åœ¨å®ç°ä¸Šï¼Œä¸¤è€…å…±ç”¨å¾ˆå¤šä»£ç ã€‚åœ¨ä¸åŒè¿è¡Œç¯å¢ƒä¸‹ï¼Œæ ¹æ®CPUæ ¸æ•°ï¼Œå¼€å¯ä¸åŒçš„çº¿ç¨‹æ•°ï¼Œä»è€Œè¾¾åˆ°æœ€ä¼˜çš„åƒåœ¾å›æ”¶æ•ˆæœã€‚</p><p><img src="/2021/03/15/java/parnew%E5%92%8Cserial%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.png" alt="å¥æŸ„"></p><p><strong>4ï¼‰Parallel Scavengeï¼ˆå¤šçº¿ç¨‹ï¼‰</strong></p><p>è¿è¡Œåœ¨æ–°ç”Ÿä»£åŒºåŸŸï¼Œå±äºå¤šçº¿ç¨‹çš„å›æ”¶å™¨ï¼Œé‡‡ç”¨<strong>å¤åˆ¶</strong>ç®—æ³•ã€‚ä¸ParNewä¸åŒçš„æ˜¯ï¼ŒParNewå›æ”¶å™¨æ˜¯é€šè¿‡æ§åˆ¶åƒåœ¾å›æ”¶çš„çº¿ç¨‹æ•°æ¥è¿›è¡Œå‚æ•°è°ƒæ•´ï¼Œè€ŒParallel Scavengeå›æ”¶å™¨æ›´å…³å¿ƒçš„æ˜¯ç¨‹åºè¿è¡Œçš„ååé‡ã€‚å³ä¸€æ®µæ—¶é—´å†…ç”¨æˆ·ä»£ç è¿è¡Œæ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</p><p><strong>5ï¼‰Parallel Oldï¼ˆå¤šçº¿ç¨‹ï¼‰</strong></p><p>Parallel Oldå›æ”¶å™¨æ˜¯Parallel Scavengeå›æ”¶å™¨çš„è€ç”Ÿä»£ç‰ˆæœ¬ï¼Œå±äºå¤šçº¿ç¨‹å›æ”¶å™¨ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ã€‚Parallel Oldå›æ”¶å™¨å’ŒParallel Scavengeå›æ”¶å™¨åŒæ ·è€ƒè™‘äº†ååé‡ä¼˜å…ˆè¿™ä¸€æŒ‡æ ‡ï¼Œéå¸¸é€‚åˆé‚£äº›æ³¨é‡ååé‡å’ŒCPUèµ„æºæ•æ„Ÿçš„åœºåˆã€‚</p><p><img src="/2021/03/15/java/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6parallelold.png" alt="å¥æŸ„"></p><p><strong>6ï¼‰CMSï¼ˆå¤šçº¿ç¨‹å›æ”¶ï¼‰</strong></p><p>CMSå›æ”¶å™¨æ˜¯å›æ”¶è€å¹´ä»£æ”¶é›†å™¨ã€‚åœ¨æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºå‰æçš„å›æ”¶å™¨ï¼Œå±äºå¤šçº¿ç¨‹å›æ”¶å™¨ï¼Œé‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ã€‚</p><p><img src="/2021/03/15/java/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6CMS.png" alt="å¥æŸ„"></p><p>åˆå§‹æ ‡è®° ï¼šæ ‡è®°GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨safepointä½ç½®æš‚åœæ‰€æœ‰æ‰§è¡Œçº¿ç¨‹ã€‚</p><p>å¹¶å‘æ ‡è®° ï¼šè¿›è¡ŒGC Roots Tracingï¼Œéå†å®Œä»rootå¯è¾¾çš„æ‰€æœ‰å¯¹è±¡ã€‚è¯¥é˜¶æ®µä¸å·¥ä½œçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚</p><p>é‡æ–°æ ‡è®° ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿè¡¨åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚éœ€è¦åœ¨safepointä½ç½®æš‚åœæ‰€æœ‰æ‰§è¡Œçº¿ç¨‹ã€‚</p><p>å¹¶å‘æ¸…ç† ï¼šå†…å­˜å›æ”¶é˜¶æ®µï¼Œå°†æ­»äº¡çš„å†…å­˜å¯¹è±¡å ç”¨çš„ç©ºé—´å¢åŠ åˆ°ä¸€ä¸ªç©ºé—²åˆ—è¡¨(free list),ä¾›ä»¥åçš„åˆ†é…ä½¿ç”¨ã€‚</p><p>é‡ç½® ï¼šæ¸…ç†æ•°æ®ç»“æ„,ä¸ºä¸‹ä¸€ä¸ªå¹¶å‘æ”¶é›†åšå‡†å¤‡ã€‚</p><p><strong>7ï¼‰G1å›æ”¶å™¨</strong></p><p>ä»¥å‰çš„å›æ”¶å™¨ï¼Œéƒ½éœ€è¦å®Œå…¨å›æ”¶æ•´ä¸ªå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œåƒåœ¾è¶Šæ¥è¶Šå¤§ï¼Œå¤„ç†åƒåœ¾éœ€è¦å¾ˆå¤§å»¶è¿Ÿã€‚G1æ˜¯ JDK 1.7ä¸­æ­£å¼æŠ•å…¥ä½¿ç”¨çš„ç”¨äºå–ä»£CMSçš„å‹ç¼©å›æ”¶å™¨ã€‚<strong>åŸºäºæ ‡è®°æ•´ç†</strong>çš„åƒåœ¾å›æ”¶å™¨ã€‚å¹´è½»ä»£åˆ†ä¸ºEdenå’ŒSurvivorä¸¤ä¸ªåŒºï¼Œè€å¹´ä»£åˆ†ä¸ºOldå’ŒHumongousï¼ˆå¤§å¯¹è±¡ï¼Œå ç”¨çš„ç©ºé—´è¶…è¿‡äº†åˆ†åŒºå®¹é‡50%ï¼‰ä¸¤ä¸ªåŒºã€‚</p><ul><li><p>æ— éœ€å›æ”¶æ•´ä¸ªå †ï¼Œè€Œæ˜¯é€‰æ‹©ä¸€ä¸ªCollection Set(CS)ã€‚</p></li><li><p>ä¸¤ç§GCï¼š Full yong GC Mixed GC</p></li><li><p>ä¼°è®¡æ¯ä¸ªregionä¸­çš„åƒåœ¾æ¯”ä¾‹ï¼Œä¼˜å…ˆå›æ”¶åƒåœ¾å¤šçš„Regionã€‚</p></li></ul><p>ä¸ºäº†è§£å†³è·¨ä»£å¼•ç”¨ï¼Œå‘æ˜äº†Card Table å’Œ Remember Setï¼ˆç”¨cè¯­è¨€å†™çš„HashTableï¼‰ã€‚Card Table æŒ‡ï¼Œ æ¯”å¦‚æˆ‘å°†æŸä¸ªå†…å­˜åŒºåŸŸå¤§å°åˆ’åˆ†ä¸º512ä¸ªï¼ŒRemembersetä¿å­˜æ˜¯æŒ‡å‘Card Tableä¸­çš„entryã€‚ åœ¨å®é™…å†™ä»£ç æ—¶ï¼Œæ¯æ¬¡=è¿™ç§èµ‹å€¼ä»£ç ï¼ŒJVMå…¶å®ä¼šä½¿ç”¨write barrierï¼Œå®ƒæ³¨å…¥ä¸€å°æ®µä»£ç ï¼Œç”¨äºè®°å½•è¿™ç§å˜åŒ–ä»è€Œæ›´æ–°remembersetã€‚å› ä¸ºæˆ‘ä»¬ç¨‹åºç»å¸¸æ˜¯å¤šçº¿ç¨‹çš„ ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ›´æ–°RSçš„æœºåˆ¶ï¼š</p><p>è¿™ç§æ›´æ–°RSçš„çº¿ç¨‹è¢«å®šä¹‰ä¸ºRefinementçº¿ç¨‹ã€‚</p><p><img src="/2021/03/15/java/image-20210815150945568.png" alt="image-20210815150945568"></p><p>G1çš„åŸºæœ¬æµç¨‹ï¼š</p><ol><li><p>YOUG GC</p><p>STWï¼ˆstop the world æ”¶é›†ï¼‰</p><ul><li><p>æ„å»ºCS ï¼ˆEden + Survivor)</p></li><li><p>æ‰«æGC Roots</p></li><li><p>Update RSï¼šæ’ç©ºDirty Card Queue</p></li><li><p>Process RSï¼šæ‰¾åˆ°è¢«è€å¹´ä»£å¯¹è±¡å¼•ç”¨</p></li><li><p>Object copy</p></li><li><p>reference processing</p><p>G1è®°å½•æ¯ä¸ªé˜¶æ®µçš„æ—¶é—´ï¼Œç”¨äºè‡ªåŠ¨è°ƒä¼˜ã€‚è®°å½•Edenã€Survivorçš„æ•°é‡å’ŒGCæ—¶é—´ï¼Œæ ¹æ®æš‚åœç›®æ ‡è‡ªåŠ¨è°ƒæ•´Regionçš„æ•°é‡ã€‚</p><p>æš‚åœç›®æ ‡è¶ŠçŸ­ï¼ŒEdenæ•°é‡è¶Šå°‘ï¼ˆå›æ”¶çš„æ¬¡æ•°å¤šäº†ï¼‰ã€‚</p></li></ul></li><li><p>MIXED GC</p><p>å½“å †çš„ç”¨é‡è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶è§¦å‘ï¼š</p><p>å¦‚ä½•åœ¨ä¸åœæ­¢åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹èƒ½å¤Ÿæ ‡è®°æ‰€æœ‰æ´»å¯¹è±¡ã€‚ä½¿ç”¨<strong>ä¸‰è‰²æ ‡è®°ç®—æ³•</strong>ï¼ˆé»‘è‰²ã€ç°è‰²å’Œç™½è‰²ï¼‰ï¼Œä¸æš‚åœåº”ç”¨çº¿ç¨‹çš„æƒ…å†µä¸‹è¿›è¡Œæ ‡è®°ã€‚æ¯”å¦‚ï¼š</p><p>ä¸€å¼€å§‹éƒ½æ˜¯ç™½è‰²ï¼Œç„¶åGC ROOTå˜æˆé»‘è‰²ï¼Œä»–ä»¬æ‰€å¼•ç”¨çš„å¯¹è±¡å˜æˆç°è‰²ï¼Œè¿™äº›ç°è‰²çš„å˜æˆé˜Ÿåˆ—ï¼Œæ¥ä¸‹æ¥ä»ç°è‰²é˜Ÿåˆ—é‡Œæ‹¿å‡ºæ¥æ´»çš„å¯¹è±¡ï¼Œç„¶åæŠŠå®ƒå¼•ç”¨çš„å¯¹è±¡æ ‡è®°æˆç°è‰²ã€‚ æœ‰æ—¶ä¼šå‘ç”ŸLost Objecté—®é¢˜ï¼Œæ´»å¯¹è±¡æ²¡æœ‰è¢«æ ‡è®°å‡ºæ¥ï¼š</p><p><img src="/2021/03/15/java/image-20210815152507837.png" alt="image-20210815152507837"></p></li></ol><p>æ¯å½“Cè¢«ä»Båˆ é™¤ï¼ˆB=nullï¼‰ï¼ŒæŠŠå®ƒè®°å½•ä¸‹æ¥ï¼ˆwrite barrierï¼‰ï¼Œä¹Ÿè®¤ä¸ºæ˜¯æ´»å¯¹è±¡ï¼Œæœ€åä¼šSTWè¿›è¡Œåˆ¤æ–­æ˜¯å¦çœŸçš„æ˜¯æ´»çš„è¿˜æ˜¯æ¸…é™¤ã€‚</p><ul><li>åˆ©ç”¨å¹´è½»ä»£ä¿¡æ¯ï¼ˆä¼šè¿›è¡Œä¸€æ¬¡yong gcï¼‰STW</li><li>æ¢å¤çº¿ç¨‹ï¼Œå¹¶å‘æ ‡è®°</li><li>STW é‡æ–°æ ‡è®°ï¼Œè¿›è¡Œå›æ”¶å…¨ç©ºçš„åŒºã€‚</li><li>æ¢å¤åº”ç”¨çº¿ç¨‹ã€‚</li></ul><ol><li><p>G1é¦–å…ˆå°†å †åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ Regionï¼Œé¿å…å…¨åŒºåŸŸçš„åƒåœ¾å›æ”¶ã€‚</p><ul><li><p><code>-XX:G1HeapRegionSize=N</code> é»˜è®¤2048ä¸ªåŒºåŸŸå¤§å°</p></li><li><p>G1çš„åˆ†åŒºç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆæ–°ç”Ÿä»£ã€å¹¸å­˜åŒºã€è€å¹´ä»£å’Œå¤§å¯¹è±¡(humongous)</p></li></ul></li></ol><p><img src="/2021/03/15/java/G1%E5%9B%9E%E6%94%B6%E5%99%A8.png" alt="å¥æŸ„"></p><p>G1æŠŠå †å†…å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„å†…å­˜åˆ†æ®µï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæŠŠå†…å­˜åˆ†ä¸º2048ä¸ªå†…å­˜åˆ†æ®µã€‚æ¯”å¦‚32Gå †å†…å­˜ï¼Œ2048ä¸ªå†…å­˜åˆ†æ®µæ¯æ®µçš„å¤§å°ä¸º16Mã€‚è¿™ç›¸å½“äºæŠŠå†…å­˜åŒ–æ•´ä¸ºé›¶ã€‚å†…å­˜åˆ†æ®µæ˜¯ç‰©ç†æ¦‚å¿µï¼Œä»£è¡¨å®é™…çš„ç‰©ç†å†…å­˜ç©ºé—´ã€‚æ¯ä¸ªå†…å­˜åˆ†æ®µéƒ½å¯ä»¥è¢«æ ‡è®°ä¸ºEdenåŒºï¼ŒSurvivoråŒºï¼ŒOldåŒºï¼Œæˆ–è€…HumongousåŒºã€‚</p><p>è¿™æ ·åˆ’åˆ†æœ‰é—®é¢˜ï¼Œä¸åŒçš„åŒºåŸŸä¹‹é—´å­˜åœ¨äº’ç›¸å¼•ç”¨ï¼Œé€ æˆè·¨ä»£å¼•ç”¨çš„é—®é¢˜ã€‚å¦‚ä½•å»æ ‡è®°å¦å¤–ä¸€ä¸ªåŒºåŸŸå¼•ç”¨äº†å½“å‰è¿™ä¸ªå¯¹è±¡ï¼Œå¼•å…¥äº†å¡è¡¨å’ŒRSã€‚æ¯ä¸ªåŒºåŸŸå†…æ¯ä¸ªå¡è¡¨å 512byteï¼Œå½“æ­¤å¡è¡¨å¯¹åº”çš„å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ ‡è®°ä¸ºdirtyã€‚æ¯ä¸ªå¯¹è±¡çš„RSï¼ˆRememberSet)è®°å½•è°å¼•ç”¨äº†æ­¤å¯¹è±¡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå¡è¡¨å¼•ç”¨Region1å¼•ç”¨Region2åŒºåŸŸçš„å¯¹è±¡ï¼ŒRegion2åŒºåŸŸçš„RSè®°å½•Region1å¼•ç”¨äº†å®ƒæœ¬èº«ã€‚</p><p><img src="/2021/03/15/java/G1RS.png" alt="å¥æŸ„"></p><p><img src="/2021/03/15/java/G1.PNG"></p><p>å¦‚ä½•å»å®ç°è¿™ä¸ªRSè®°å½•çš„è¿‡ç¨‹ï¼ŸG1ä¸­æœ‰<code>Write Barrier</code>æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ç”±ç¼–è¯‘å™¨åŠ¨æ€ç”Ÿæˆä¸€å°æ®µä»£ç ã€‚</p><p><strong>Write Barrieræœºåˆ¶</strong></p><p>æ¯å½“æ‰§è¡Œ<code>object.field = &lt;reference&gt;(putfield)</code>èµ‹å€¼æ“ä½œæ—¶ï¼ŒJVMä¼šæ³¨å…¥ä¸€å°æ®µä»£ç ã€‚</p><p>å½“èµ‹å€¼æ“ä½œéœ€è¦è®©RSæ›´æ–°æ—¶ï¼ŒæŠŠå³å°†æ”¹å˜çš„å¡è¡¨æ¯”å¦‚ä¸Šå›¾ä¸­çš„Region 1 å¡è¡¨æ–°æŒ‡å‘äº† Region 2ï¼Œéœ€è¦å°†Region 1ä¸­çš„è¿™ä¸ªå¡è¡¨æ ‡è®°ä¸º dirtyã€‚ç„¶åå°†æ­¤cardæ”¾å…¥é˜Ÿåˆ—(Dirty Card Queue)ï¼Œè¿™ä¸ªé˜Ÿåˆ—æœ‰ç™½ã€ç»¿ã€é»„ã€çº¢å››ä¸ªé¢œè‰²ã€‚æ ¹æ®æ›´æ–°çš„é¢‘ç‡G1è‡ªåŠ¨è®¾å®šç­‰çº§ï¼Œæ¯”å¦‚æ›´æ–°çš„éå¸¸å‰§çƒˆï¼Œçº¢è‰²ã€‚</p><ol><li><p>ç™½è‰²</p><p>å¤©ä¸‹å¤ªå¹³ï¼Œæ— äº‹å‘ç”Ÿ</p></li><li><p>ç»¿è‰² (-XX:G1ConcRefinementGreenZone = N)</p><p>Refinementçº¿ç¨‹å¼€å§‹è¢«æ¿€æ´»ï¼Œå¼€å§‹æ›´æ–°RS</p></li><li><p>é»„è‰² ï¼ˆ-XXï¼šG1ConcRefinementYellowZone=N)</p><p>å…¨éƒ¨Refinementçº¿ç¨‹æ¿€æ´»</p></li><li><p>çº¢è‰² (-XX:G1ConcRefinementRedZone=N)</p><p>åº”ç”¨çº¿ç¨‹ä¹Ÿå‚ä¸æ’ç©ºé˜Ÿåˆ—çš„å·¥ä½œã€‚ï¼ˆæŠŠåº”ç”¨çº¿ç¨‹æ‹–æ…¢ï¼‰</p></li></ol><ul><li>æ— éœ€å›æ”¶æ•´ä¸ªå †ï¼Œè€Œæ˜¯é€‰æ‹©ä¸€ä¸ª<code>Collection Set(CS)</code></li></ul><p>å½“ä¸€ä¸ªåœ°å€ç©ºé—´è¢«å¼•ç”¨æ—¶ï¼Œè¿™ä¸ªåœ°å€ç©ºé—´å¯¹åº”çš„æ•°ç»„ç´¢å¼•çš„å€¼è¢«æ ‡è®°ä¸ºâ€0â€³ï¼Œå³æ ‡è®°ä¸ºè„è¢«å¼•ç”¨ï¼Œæ­¤å¤–RSetä¹Ÿå°†è¿™ä¸ªæ•°ç»„ä¸‹æ ‡è®°å½•ä¸‹æ¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªRSetå…¶å®æ˜¯ä¸€ä¸ªHash Tableï¼ŒKeyæ˜¯åˆ«çš„Regionçš„èµ·å§‹åœ°å€ï¼ŒValueæ˜¯ä¸€ä¸ªé›†åˆï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯Card Tableçš„Indexã€‚</p><p>Mixed GC ï¼ˆè€å¹´ä»£å’Œå¹´è½»ä»£ä¸€èµ·å›æ”¶ï¼‰ ä¸ä¸€å®šç«‹å³å‘ç”Ÿï¼Œé€‰æ‹©è‹¥å¹²ä¸ªRegionè¿›è¡Œï¼Œé»˜è®¤1/8çš„Old Regionï¼ˆé€‰æ‹©åƒåœ¾æœ€å¤šçš„è€å¹´ä»£ä¼˜å…ˆè¿›è¡Œï¼‰ã€‚STW,Parallel,Copyingå›æ”¶ï¼Œå®ƒå’Œå¹´è½»ä»£æ˜¯å®Œå…¨ç›¸åŒçš„åšæ³•ã€‚</p><p>æ€»ç»“ï¼š</p><p>G1åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªï¼š</p><ul><li>å¹´è½»ä»£å›æ”¶ï¼ˆyoung gcï¼‰è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯<code>stop the world</code>æ–¹æ³•ï¼Œéœ€è¦æš‚åœåº”ç”¨ç¨‹åºï¼Œé€šè¿‡ä¸Šè¿°çš„å¡è¡¨å’ŒRSæ›´æ–°å¼•ç”¨å¯¹è±¡ã€‚</li><li>è€å¹´ä»£å¹¶å‘æ ‡è®°ï¼ˆconcurrent markingï¼‰è¿‡ç¨‹ï¼Œè¿™ä¸ªæ˜¯å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ï¼Œä½¿ç”¨ä¸‰è‰²æ ‡è®°æ³•æ ‡è®°ï¼ˆç™½è‰²ï¼Œé»‘è‰²ï¼Œç°è‰²ï¼‰ã€‚</li><li>æ··åˆå›æ”¶è¿‡ç¨‹ï¼ˆmixed gcï¼‰ã€‚</li></ul><p>1ï¼‰Young GC</p><ul><li>é˜¶æ®µ1ï¼šæ ¹æ‰«æ<br>é™æ€å’Œæœ¬åœ°å¯¹è±¡è¢«æ‰«æ</li><li>é˜¶æ®µ2ï¼šæ›´æ–°RS<br>å¤„ç†dirty cardé˜Ÿåˆ—æ›´æ–°RS</li><li>é˜¶æ®µ3ï¼šå¤„ç†RS<br>æ£€æµ‹ä»å¹´è½»ä»£æŒ‡å‘å¹´è€ä»£çš„å¯¹è±¡</li><li>é˜¶æ®µ4ï¼šå¯¹è±¡æ‹·è´<br>æ‹·è´å­˜æ´»çš„å¯¹è±¡åˆ°survivor/oldåŒºåŸŸ</li><li>é˜¶æ®µ5ï¼šå¤„ç†å¼•ç”¨é˜Ÿåˆ—<br>è½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ï¼Œè™šå¼•ç”¨å¤„ç†</li></ul><p>2ï¼‰å¹¶å‘æ ‡è®°+åƒåœ¾å›æ”¶</p><ul><li>åˆå§‹æ ‡è®°ï¼ˆinitial markï¼ŒSTWï¼‰<br>åœ¨æ­¤é˜¶æ®µï¼ŒG1 GC å¯¹æ ¹è¿›è¡Œæ ‡è®°ã€‚è¯¥é˜¶æ®µä¸å¸¸è§„çš„ (STW) å¹´è½»ä»£åƒåœ¾å›æ”¶å¯†åˆ‡ç›¸å…³ã€‚</li><li>æ ¹åŒºåŸŸæ‰«æï¼ˆroot region scanï¼‰<br>G1 GC åœ¨åˆå§‹æ ‡è®°çš„å­˜æ´»åŒºæ‰«æå¯¹è€å¹´ä»£çš„å¼•ç”¨ï¼Œå¹¶æ ‡è®°è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚è¯¥é˜¶æ®µä¸åº”ç”¨ç¨‹åºï¼ˆé STWï¼‰åŒæ—¶è¿è¡Œï¼Œå¹¶ä¸”åªæœ‰å®Œæˆè¯¥é˜¶æ®µåï¼Œæ‰èƒ½å¼€å§‹ä¸‹ä¸€æ¬¡ STW å¹´è½»ä»£åƒåœ¾å›æ”¶ã€‚</li><li>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰<br>G1 GC åœ¨æ•´ä¸ªå †ä¸­æŸ¥æ‰¾å¯è®¿é—®çš„ï¼ˆå­˜æ´»çš„ï¼‰å¯¹è±¡ã€‚è¯¥é˜¶æ®µä¸åº”ç”¨ç¨‹åºåŒæ—¶è¿è¡Œï¼Œå¯ä»¥è¢« STW å¹´è½»ä»£åƒåœ¾å›æ”¶ä¸­æ–­</li><li>æœ€ç»ˆæ ‡è®°ï¼ˆRemarkï¼ŒSTWï¼‰<br>è¯¥é˜¶æ®µæ˜¯ STW å›æ”¶ï¼Œå¸®åŠ©å®Œæˆæ ‡è®°å‘¨æœŸã€‚G1 GC æ¸…ç©º SATB ç¼“å†²åŒºï¼Œè·Ÿè¸ªæœªè¢«è®¿é—®çš„å­˜æ´»å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œå¼•ç”¨å¤„ç†ã€‚</li><li>æ¸…é™¤åƒåœ¾ï¼ˆCleanupï¼ŒSTWï¼‰<br>åœ¨è¿™ä¸ªæœ€åé˜¶æ®µï¼ŒG1 GC æ‰§è¡Œç»Ÿè®¡å’Œ RSet å‡€åŒ–çš„ STW æ“ä½œã€‚åœ¨ç»Ÿè®¡æœŸé—´ï¼ŒG1 GC ä¼šè¯†åˆ«å®Œå…¨ç©ºé—²çš„åŒºåŸŸå’Œå¯ä¾›è¿›è¡Œæ··åˆåƒåœ¾å›æ”¶çš„åŒºåŸŸã€‚æ¸…ç†é˜¶æ®µåœ¨å°†ç©ºç™½åŒºåŸŸé‡ç½®å¹¶è¿”å›åˆ°ç©ºé—²åˆ—è¡¨æ—¶ä¸ºéƒ¨åˆ†å¹¶å‘ã€‚</li></ul><p>äº†è§£å¹¶å‘æ ‡è®°çš„<strong>ä¸‰è‰²æ ‡è®°ç®—æ³•</strong>ã€‚</p><p><img src="/2021/03/15/java/G1%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95.PNG"></p><p>æ”¶é›†å™¨æ€»ç»“ï¼š</p><table><thead><tr><th align="center">æ”¶é›†å™¨</th><th align="center">æ‰§è¡Œæ–¹å¼</th><th align="center">åˆ†ä»£</th><th align="center">ç®—æ³•</th><th align="center">ç›®æ ‡</th><th align="center">åœºæ™¯</th></tr></thead><tbody><tr><td align="center">Serial</td><td align="center">ä¸²è¡Œ</td><td align="center">æ–°ç”Ÿä»£</td><td align="center">å¤åˆ¶</td><td align="center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td align="center">å•CPUä¸‹çš„å®¢æˆ·ç«¯æ¨¡å¼</td></tr><tr><td align="center">Serial Old</td><td align="center">ä¸²è¡Œ</td><td align="center">è€å¹´ä»£</td><td align="center">æ ‡è®°-æ•´ç†</td><td align="center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td align="center">å•CPUä¸‹çš„å®¢æˆ·ç«¯å’ŒCMSåå¤‡æ–¹æ¡ˆ</td></tr><tr><td align="center">ParNew</td><td align="center">å¹¶è¡Œ</td><td align="center">æ–°ç”Ÿä»£</td><td align="center">å¤åˆ¶</td><td align="center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td align="center">å¤šCPUåœ¨æœåŠ¡å™¨æ¨¡å¼ä¸‹ä¸CMSé…åˆ</td></tr><tr><td align="center">Parallel Scavenge</td><td align="center">å¹¶è¡Œ</td><td align="center">æ–°ç”Ÿä»£</td><td align="center">å¤åˆ¶</td><td align="center">ååé‡ä¼˜å…ˆ</td><td align="center">åå°è®¡ç®—ä¸éœ€è¦å¤ªå¤šäº¤äº’ä»»åŠ¡</td></tr><tr><td align="center">Parallel Old</td><td align="center">å¹¶è¡Œ</td><td align="center">è€å¹´ä»£</td><td align="center">æ ‡è®°-æ•´ç†</td><td align="center">ååé‡ä¼˜å…ˆ</td><td align="center">åå°è®¡ç®—ä¸éœ€è¦å¤ªå¤šäº¤äº’ä»»åŠ¡</td></tr><tr><td align="center">CMS</td><td align="center">å¹¶å‘</td><td align="center">è€å¹´ä»£</td><td align="center">æ ‡è®°-æ¸…é™¤</td><td align="center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td align="center">é›†ä¸­åœ¨ç½‘ç«™æˆ–B/Sç³»ç»ŸæœåŠ¡</td></tr><tr><td align="center">G1</td><td align="center">å¹¶å‘</td><td align="center">ä¸¤è€…éƒ½æœ‰</td><td align="center">æ ‡è®°æ•´ç†+å¤åˆ¶</td><td align="center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td align="center">é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œæ›¿æ¢CMS</td></tr></tbody></table><ul><li>4.æ–¹æ³•åŒºå›æ”¶æ¡ä»¶ï¼š</li></ul><p>åªæœ‰åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶æ‰ä¼šè¢«å›æ”¶ï¼</p><p>1ï¼‰æ‰€æœ‰å®ä¾‹è¢«å›æ”¶</p><p>2ï¼‰åŠ è½½è¯¥ç±»çš„ClassLoaderè¢«å›æ”¶</p><p>3ï¼‰Classå¯¹è±¡æ— æ³•é€šè¿‡ä»»ä½•é€”å¾„è®¿é—®(åŒ…æ‹¬åå°„)</p><h2 id="2-JavaåŸºç¡€"><a href="#2-JavaåŸºç¡€" class="headerlink" title="2. JavaåŸºç¡€"></a>2. JavaåŸºç¡€</h2><h3 id="lt-static-å…³é”®å­—"><a href="#lt-static-å…³é”®å­—" class="headerlink" title="<static å…³é”®å­—"></a><font color="green">&lt;static å…³é”®å­—</font></h3><blockquote><p>static å…³é”®å­—</p></blockquote><p>javaä¸­ä¸å­˜åœ¨â€œå…¨å±€å˜é‡â€æ¦‚å¿µï¼Œå¯ä»¥ç”¨staticè¡¨ç¤ºâ€œä¼ªå…¨å±€â€æ¦‚å¿µã€‚</p><p>è¢«staticä¿®é¥°å°±æ˜¯é™æ€å˜é‡ï¼Œæ‰€ä»¥JVMè‚¯å®šå°†å…¶æ”¾åœ¨å•ç‹¬çš„å¸¸é‡æ± é‡Œã€‚JVMå¯ä»¥æ–¹ä¾¿è®¿é—®å®ƒä»¬ã€‚</p><p>è¦ç‚¹ï¼š</p><ol><li><p>è¢« static ä¿®é¥°çš„æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•æ˜¯ç‹¬ç«‹äºè¯¥ç±»çš„ã€‚</p><p>é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ˜¯éšç€ç±»åŠ è½½æ—¶è¢«å®Œæˆåˆå§‹åŒ–çš„ï¼ˆç±»åŠ è½½æ—¶å·²ç»å­˜åœ¨ï¼‰ï¼Œå®ƒåœ¨å†…å­˜ä¸­ä»…æœ‰ä¸€ä¸ªï¼Œä¸” JVM ä¹Ÿåªä¼šä¸ºå®ƒåˆ†é…ä¸€æ¬¡å†…å­˜ï¼ŒåŒæ—¶ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®å®ƒã€‚</p><p>å¯å¦‚ä¸‹ç›´æ¥ä½¿ç”¨ï¼š</p></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ClassName</span><span class="token punctuation">.</span>propertyName<span class="token class-name">ClassName</span><span class="token punctuation">.</span><span class="token function">methodName</span><span class="token punctuation">(</span>â€¦â€¦<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>å®ƒåªèƒ½è°ƒç”¨ static å˜é‡å’Œæ–¹æ³•ã€‚</li><li>ä¸èƒ½ä»¥ä»»ä½•å½¢å¼å¼•ç”¨ thisã€superã€‚</li><li>static å˜é‡åœ¨å®šä¹‰æ—¶å¿…é¡»è¦è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸”åˆå§‹åŒ–æ—¶é—´è¦æ—©äºéé™æ€å˜é‡ã€‚</li></ol><p>é™æ€æ–¹æ³•é‡Œé¢ä¸ºä»€ä¹ˆä¸èƒ½ç”¨thisæŒ‡é’ˆï¼Œä»åº•å±‚ä¸Šæ¥è¯´ï¼Œæ“ä½œæ•°æ ˆä¸­çš„æ²¡æœ‰thisæŒ‡é’ˆï¼Œè€Œæ™®é€šæ–¹æ³•index=0æ°¸è¿œæ˜¯thisã€‚</p><h3 id="lt-finalå…³é”®å­—"><a href="#lt-finalå…³é”®å­—" class="headerlink" title="<finalå…³é”®å­—"></a><font color="green">&lt;finalå…³é”®å­—</font></h3><p>æŸäº›æ•°æ®ä¸å¯æ›´æ”¹ã€‚finalä¿®é¥°çš„å«å¸¸é‡ã€‚â€œå¸¸é‡â€çš„ä½¿ç”¨æœ‰ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹ï¼š</p><ol><li>ç¼–è¯‘æœŸå¸¸é‡ï¼Œæ°¸è¿œä¸å¯æ”¹å˜ã€‚</li><li>è¿è¡ŒæœŸåˆå§‹åŒ–æ—¶ï¼Œä¸å¯æ”¹å˜ã€‚æ ¹æ®å¯¹è±¡çš„ä¸åŒè€Œè¡¨ç°ä¸åŒï¼Œä½†åŒæ—¶åˆä¸å¸Œæœ›å®ƒè¢«æ”¹å˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿è¡ŒæœŸå¸¸é‡ã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> final_01 <span class="token operator">=</span> <span class="token string">"demo"</span><span class="token punctuation">;</span><span class="token comment">//ç¼–è¯‘æœŸå¸¸é‡ï¼Œå¿…é¡»è¦è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸”ä¸å¯æ›´æ”¹</span><span class="token keyword">public</span> <span class="token keyword">class</span> test<span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> str<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> final_03 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//ä½¿ç”¨éšæœºæ•°æ¥è¿›è¡Œåˆå§‹åŒ–,è¿è¡ŒæœŸåˆå§‹åŒ–ï¼Œæ¯æ¬¡newæ–°çš„ç±»éƒ½ä¼šæ”¹å˜å†…å®¹ï¼ˆrandomï¼‰ã€‚</span>    <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>str<span class="token operator">=</span>s<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ç‚¹ï¼š</p><ol><li>finalä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«ä¿®æ”¹é‡å†™ï¼Œå¯ä»¥è¢«ç»§æ‰¿ã€‚</li><li>finalä¿®é¥°çš„ç±»ä¸èƒ½ä¿®æ”¹ä¸èƒ½ç»§æ‰¿ï¼Œæœ€ç»ˆç±»ã€‚</li><li>åŒ¿åå†…éƒ¨ç±»ä¸­å‚æ•°å¿…é¡»ä¸ºfinalã€‚</li></ol><blockquote><h3 id="java-compator"><a href="#java-compator" class="headerlink" title="java compator"></a><font color="green">java compator</font></h3></blockquote><ul><li>ä¿æŒè¿™ä¸ªé¡ºåºå°±è¿”å›-1 (&gt; è¿˜æ˜¯ &lt;)</li><li>äº¤æ¢é¡ºåºå°±è¿”å›1</li><li>ä»€ä¹ˆéƒ½ä¸åšå°±è¿”å›0ï¼›æ‰€ä»¥ å‡åºçš„è¯ å¦‚æœ1&lt;2,è¿”å›-1,ä¿æŒé¡ºåº[1,2],å¦‚æœ3&gt;2,è¿”å›-1,äº¤æ¢é¡ºåº[2,3]</li></ul><pre class="line-numbers language-none"><code class="language-none">if (a &gt; b) return -1; ä¿æŒa&gt; bçš„é¡ºåºif (a &gt; b) return 1; äº¤æ¢ab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="lt-javaå¼‚å¸¸"><a href="#lt-javaå¼‚å¸¸" class="headerlink" title="<javaå¼‚å¸¸"></a><font color="green">&lt;javaå¼‚å¸¸</font></h3><ol><li>å¼‚å¸¸çš„ä½“ç³»ç»“æ„</li></ol><p>ä»€ä¹ˆæ˜¯å¼‚å¸¸ï¼Ÿ</p><p>å¼‚å¸¸æŒ‡çš„å°±æ˜¯ç¨‹åºçš„ä¸æ­£å¸¸ï¼Œç®€å•ç†è§£å°±æ˜¯ç¨‹åºæ‰€å‘ç”Ÿçš„é”™è¯¯ã€‚</p><ul><li>åˆ†ç±»</li></ul><p>a ç¼–è¯‘æ—¶å¼‚å¸¸ï¼š ç¼–è¯‘æœŸé—´ï¼Œç¼–è¯‘å™¨æ£€æµ‹åˆ°æŸæ®µä»£ç å¯èƒ½ä¼šå‘ç”ŸæŸäº›é—®é¢˜ï¼Œéœ€è¦ç¨‹åºå‘˜æå‰ç»™ä»£ç åšå‡ºé”™è¯¯çš„è§£å†³æ–¹æ¡ˆï¼Œå¦åˆ™ç¼–è¯‘æ— æ³•é€šè¿‡ã€‚</p><p>b è¿è¡Œæ—¶å¼‚å¸¸ ç¼–è¯‘æ­£å¸¸ï¼Œè¿è¡Œæ—¶å‡ºç°äº†é”™è¯¯ã€‚</p><ul><li>ä½“ç³»ç»“æ„</li></ul><p>a throwable</p><p>â€‹    Error:ä¸¥é‡é”™è¯¯</p><p>â€‹    Exception:</p><p>â€‹        RuntimeException</p><p>â€‹        IRuntimeException</p><ul><li><p>å¼‚å¸¸å‡ºç°çš„åŸç†</p><p>javaå¯¹å¼‚å¸¸çš„é»˜è®¤å¤„ç†æ–¹å¼æ˜¯æŠ›å‡ºé—®é¢˜ç»™ä¸Šä¸€çº§ï¼Œå¦‚æœå‡ºç°äº†é—®é¢˜ï¼Œjavaä¼šæ ¹æ®é—®é¢˜æ‰€æè¿°çš„å¼‚å¸¸ç±»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œåº•å±‚é€šè¿‡throwå…³é”®å­—å°†è¯¥å¯¹è±¡æŠ›å‡ºç»™ä¸Šä¸€çº§ã€‚ï¼ˆmehtod -&gt; main -&gt; jvm -&gt; å°†å¼‚å¸¸ä½ç½®å’Œé”™è¯¯åŸå› æ‰“å°ï¼‰</p></li><li><p>å¼‚å¸¸çš„å¤„ç†æ–¹å¼</p><ul><li><p>é—®é¢˜å¯ä»¥è‡ªå·±å¤„ç†çš„</p><p>try catchå¤„ç†æ–¹å¼ (åé¢çš„ä»£ç è¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œ)</p></li><li><p>é—®é¢˜å¤„ç†ä¸æ‰çš„</p><p>throwå¤„ç†æ–¹å¼ã€‚ å¦‚æœæ˜¯RuntimeExceptionå¼‚å¸¸ï¼Œåˆ™æ–¹æ³•ä¸Šé¢æ— éœ€throwså£°æ˜ã€‚</p></li></ul></li></ul><p>throws å’Œ throw throwsæ˜¯ä»…ä»…å¯¹æ–¹æ³•è¿›è¡Œå£°æ˜ï¼Œå‘ŠçŸ¥è°ƒç”¨è€…æ­¤æ–¹æ³•å­˜åœ¨å¼‚å¸¸ã€‚</p><p>throwæ˜¯æŠ›å‡ºã€‚</p><ul><li><p>Springæ¡†æ¶çš„äº‹åŠ¡é»˜è®¤æ˜¯RuntimeExceptionæ‰è¿›è¡Œå›æ»š</p><ul><li>è§£å†³æ–¹æ¡ˆ </li></ul><p>ä¿®æ”¹Transactionalæ³¨è§£ä¸­çš„rollbackForå±æ€§å¯ä»¥æŒ‡å®šä¸ºexceptionå¼‚å¸¸å›æ»šã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>è‡ªå·±å®šä¹‰å¼‚å¸¸ ï¼ˆè§„èŒƒçš„å¼‚å¸¸ç±»åï¼Œæ‰¾ä¸€ä¸ªç±»ç»§æ‰¿exceptionï¼‰ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">MyPersonAgeException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeExceptoin</span><span class="token punctuation">(</span>æˆ– <span class="token class-name">Exception</span><span class="token punctuation">)</span>        è®°å¾—åŠ å…¥å­—ç¬¦ä¸²çš„æ„é€ å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="lt-JAVA-é›†åˆ"><a href="#lt-JAVA-é›†åˆ" class="headerlink" title="<JAVA é›†åˆ"></a><font color="green">&lt;JAVA é›†åˆ</font></h3><p><img src="/2021/03/15/java/java%E9%9B%86%E5%90%88%E7%B1%BB.png" alt="å¥æŸ„"></p><ol><li><strong>Collection</strong></li></ol><p>æœ€åŸºæœ¬çš„é›†åˆæ¥å£ï¼Œå®ƒä¸æä¾›ç›´æ¥çš„å®ç°ï¼ŒJAVA SDKæä¾›çš„ç±»éƒ½æ˜¯ç»§æ‰¿è‡ªCollectionçš„<strong>å­æ¥å£</strong>ã€‚æ‰€æœ‰å®ç°Collectionçš„æ¥å£ç±»å¿…é¡»å®ç°ä¸¤ç±»æ„é€ å‡½æ•°</p><p>a) æ— å‚æ„é€ å‡½æ•°ã€‚åˆ›å»ºç©ºçš„Collectionã€‚</p><p>b) æœ‰å‚æ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºæ–°çš„Collectionã€‚</p><p>è§£å†³ArrayLlistçš„çº¿ç¨‹ä¸å®‰å…¨(<code>concurrentModificationException</code>)ã€‚</p><ol><li>æ¢æˆ<code>vector</code>ã€‚</li><li>æ¢æˆ`Collections.synchronizeList(new ArrayList());</li><li>new copyOnWriteArrayList();å†™æ—¶èµ‹å€¼ã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">1.L</span>ista<span class="token punctuation">)</span> <span class="token class-name">ArrayList</span> åˆå§‹å®¹é‡<span class="token number">10</span>ã€‚åŸºäºæ•°ç»„å®ç°ã€‚æ¯æ¬¡æ‰©å®¹<span class="token number">1.5</span>å€ã€‚b<span class="token punctuation">)</span> <span class="token class-name">LinkedList</span>åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œè¿‘å¼€å¤´æˆ–ç»“å°¾ï¼ˆé è¿‘ç´¢å¼•ï¼‰éå†é“¾è¡¨ã€‚c<span class="token punctuation">)</span> <span class="token class-name">Vector</span>ä¸<span class="token class-name">ArrayList</span>ä¸€æ ·ï¼Œä¸åŒåœ¨äºå®ƒæ˜¯çº¿ç¨‹å®‰å…¨ã€‚d<span class="token punctuation">)</span> <span class="token class-name">Stack</span>ç»§æ‰¿è‡ª<span class="token class-name">Vector</span>ï¼Œåè¿›å…ˆå‡ºçš„æ ˆã€‚æä¾›push pop peek empty searchã€‚<span class="token number">2.</span>Setä¸liståŒºåˆ«æ˜¯ä¸åŒ…å«é‡å¤å…ƒç´ ã€‚aï¼‰<span class="token class-name">EnumSet</span>æšä¸¾ä¸“ç”¨<span class="token class-name">Set</span>ï¼Œæ‰€æœ‰å…ƒç´ éƒ½æ˜¯æšä¸¾ç±»å‹ã€‚bï¼‰<span class="token class-name">HashSet</span>æŸ¥è¯¢é€Ÿåº¦æœ€å¿«çš„é›†åˆï¼Œå†…éƒ¨ä»¥<span class="token class-name">Hashcode</span>å®ç°ï¼Œé¡ºåºä¹Ÿä»¥å“ˆå¸Œç æ’åºã€‚cï¼‰<span class="token class-name">TreeSet</span>æ’åºçŠ¶æ€çš„<span class="token class-name">Set</span>ï¼Œä»¥<span class="token class-name">TreeMap</span>å®ç°ï¼Œä»¥è‡ªç„¶å…ƒç´ é¡ºåºæˆ–ç”¨æˆ·è‡ªå®šä¹‰`<span class="token class-name">Comparator</span>`æ’åºã€‚<span class="token number">3.</span>Queueï¼ˆ<span class="token number">1</span>ï¼‰ä¸é˜»å¡çš„ï¼š <span class="token class-name">PriorityQueue</span> å’Œ <span class="token class-name">ConcurrentLinkedQueue</span>ã€€ã€€<span class="token class-name">PriorityQueue</span> å’Œ <span class="token class-name">ConcurrentLinkedQueue</span> ç±»åœ¨ <span class="token class-name">Collection</span> <span class="token class-name">Framework</span> ä¸­åŠ å…¥ä¸¤ä¸ªå…·ä½“é›†åˆå®ç°ã€‚ ã€€ã€€<span class="token class-name">PriorityQueue</span> ç±»å®è´¨ä¸Šç»´æŠ¤äº†ä¸€ä¸ªæœ‰åºåˆ—è¡¨ã€‚åŠ å…¥åˆ° <span class="token class-name">Queue</span> ä¸­çš„å…ƒç´ æ ¹æ®å®ƒä»¬çš„å¤©ç„¶æ’åºï¼ˆé€šè¿‡å…¶ <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Comparable</span> å®ç°ï¼‰æˆ–è€…æ ¹æ®ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Comparator</span> å®ç°æ¥å®šä½ã€‚ã€€ã€€<span class="token class-name">ConcurrentLinkedQueue</span> æ˜¯åŸºäºé“¾æ¥èŠ‚ç‚¹çš„ã€çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ã€‚å¹¶å‘è®¿é—®ä¸éœ€è¦åŒæ­¥ã€‚å› ä¸ºå®ƒåœ¨é˜Ÿåˆ—çš„å°¾éƒ¨æ·»åŠ å…ƒç´ å¹¶ä»å¤´éƒ¨åˆ é™¤å®ƒä»¬ï¼Œæ‰€ä»¥åªè¦ä¸éœ€è¦çŸ¥é“é˜Ÿåˆ—çš„å¤§ å°ï¼Œ<span class="token class-name">ConcurrentLinkedQueue</span> å¯¹å…¬å…±é›†åˆçš„å…±äº«è®¿é—®å°±å¯ä»¥å·¥ä½œå¾—å¾ˆå¥½ã€‚æ”¶é›†å…³äºé˜Ÿåˆ—å¤§å°çš„ä¿¡æ¯ä¼šå¾ˆæ…¢ï¼Œéœ€è¦éå†é˜Ÿåˆ—ã€‚ï¼ˆ<span class="token number">2</span>ï¼‰é˜»å¡çš„ï¼šã€€ã€€äº”ä¸ªé˜»å¡é˜Ÿåˆ—ç±»ã€‚å®ƒå®è´¨ä¸Šå°±æ˜¯ä¸€ç§å¸¦æœ‰ä¸€ç‚¹æ‰­æ›²çš„ FIFO æ•°æ®ç»“æ„ã€‚ä¸æ˜¯ç«‹å³ä»é˜Ÿåˆ—ä¸­æ·»åŠ æˆ–è€…åˆ é™¤å…ƒç´ ï¼Œçº¿ç¨‹æ‰§è¡Œæ“ä½œé˜»å¡ï¼Œç›´åˆ°æœ‰ç©ºé—´æˆ–è€…å…ƒç´ å¯ç”¨ã€‚äº”ä¸ªé˜Ÿåˆ—æ‰€æä¾›çš„å„æœ‰ä¸åŒï¼šã€€ã€€ <span class="token class-name">ArrayBlockingQueue</span> ï¼šä¸€ä¸ªç”±æ•°ç»„æ”¯æŒçš„æœ‰ç•Œé˜Ÿåˆ—ã€‚ã€€ã€€ <span class="token class-name">LinkedBlockingQueue</span> ï¼šä¸€ä¸ªç”±é“¾æ¥èŠ‚ç‚¹æ”¯æŒçš„å¯é€‰æœ‰ç•Œé˜Ÿåˆ—ã€‚ã€€ã€€ <span class="token class-name">PriorityBlockingQueue</span> ï¼šä¸€ä¸ªç”±ä¼˜å…ˆçº§å †æ”¯æŒçš„æ— ç•Œä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ã€€ã€€ <span class="token class-name">DelayQueue</span> ï¼šä¸€ä¸ªç”±ä¼˜å…ˆçº§å †æ”¯æŒçš„ã€åŸºäºæ—¶é—´çš„è°ƒåº¦é˜Ÿåˆ—ã€‚ã€€ã€€ <span class="token class-name">SynchronousQueue</span> ï¼šä¸€ä¸ªåˆ©ç”¨ <span class="token class-name">BlockingQueue</span> æ¥å£çš„ç®€å•èšé›†ï¼ˆrendezvousï¼‰æœºåˆ¶ã€‚      <span class="token number">3.1</span> <span class="token class-name">ArrayDeque</span>    é»˜è®¤<span class="token number">16</span>ï¼Œæœ€å°<span class="token number">8</span>ã€‚ object<span class="token punctuation">[</span><span class="token punctuation">]</span>æ•°ç»„å­˜å‚¨ã€‚    æ ˆæ“ä½œï¼špush pop peek é˜Ÿåˆ—ï¼šoffer poll peek    ä¸€èˆ¬æ“ä½œï¼šadd<span class="token comment">//å°¾ </span>    remove <span class="token comment">//é¦–</span>    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/03/15/java/%E9%98%9F%E5%88%97.png" alt="å¥æŸ„"></p><ol start="2"><li><strong>Map</strong></li></ol><p>ä¸Listå’Œsetä¸åŒï¼Œç”±ä¸€å¯¹é”®å€¼å¯¹ç»„æˆçš„é›†åˆï¼Œkeyåˆ°valueçš„æ˜ å°„ã€‚</p><p>a) HashMap</p><p><strong>é“¾è¡¨+æ•°ç»„</strong>.å†…éƒ¨å®šä¹‰hashè¡¨æ•°ç»„<code>Entry[] table</code>ï¼Œå…ƒç´ é€šè¿‡å“ˆå¸Œå‡½æ•°çš„åˆ°å“ˆå¸Œåœ°å€è½¬ä¸ºæ•°ç»„å­˜æ”¾ç´¢å¼•ï¼Œå½“æœ‰å†²çªåŒä¸€ä¸ªç´¢å¼•å¤„ä¿å­˜é“¾è¡¨ã€‚</p><p><img src="/2021/03/15/java/%E5%93%88%E5%B8%8C%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="å¥æŸ„"></p><p><strong>åˆå§‹å¤§å°16</strong>ï¼Œå®¹é‡å¿…é¡»ä¸º$2^{n}$ï¼ˆ<code>h &amp; (length-1)</code>è¿™æ¡è§„å¾‹æˆç«‹å‰æé•¿åº¦å¿…é¡»æ˜¯2çš„næ¬¡æ–¹ï¼‰ã€‚JDK1.8 é“¾è¡¨å‡çº§ä¸º<strong>çº¢é»‘æ ‘</strong>ç»“æ„ã€‚å½“æœ¬ç´¢å¼•å†²çª<strong>å¤§äº8</strong>é“¾è¡¨å°±è½¬ä¸ºçº¢é»‘æ ‘ï¼Œå½“å†²çªå€¼å°äº6å†è½¬ä¸ºæ™®é€šé“¾è¡¨ã€‚</p><p>é«˜ä½å³ç§»åŠ¨æ˜¯ä¸ºäº†æ‰°åŠ¨ï¼Œé˜²æ­¢å“ˆå¸Œå†²çª</p><p><img src="/2021/03/15/java/%E5%93%88%E5%B8%8C%E5%86%B2%E7%AA%81%E9%AB%98%E4%BD%8D%E6%89%B0%E5%8A%A8.png" alt="å¥æŸ„"></p><p>åœ¨å¯¹æ•°ç»„é•¿åº¦è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—åå¾—åˆ°çš„ç»“æœç›¸åŒï¼Œå°±å‘ç”Ÿäº†å†²çªã€‚</p><p><code>h &gt;&gt;&gt; 16</code>è¿‡æ‰°åŠ¨è®¡ç®—ä¹‹åï¼Œæœ€ç»ˆå¾—åˆ°çš„indexçš„å€¼ä¸ä¸€æ ·äº†.</p><p>æ›´å¤šç»†èŠ‚å‚è€ƒå…¶ä»–åšå®¢ï¼Œå†™çš„æ¯”è¾ƒè¯¦ç»†ï¼Œè®°ä½å¸¸é—®çš„å°±è¡Œã€‚<a href="https://blog.csdn.net/xu_dongdong/article/details/80251936">https://blog.csdn.net/xu_dongdong/article/details/80251936</a> <a href="https://blog.csdn.net/woshimaxiao1/article/details/83661464">https://blog.csdn.net/woshimaxiao1/article/details/83661464</a></p><p>b) HashTable</p><ul><li><p><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œ<code>(hash &amp; 0x7FFFFFFF) % tab.length</code>å®ƒæ˜¯é€šè¿‡è¿™å¥è¯ç›´æ¥å¯¹hashåœ°å€å–æ¨¡ï¼Œä¸æ˜¯åƒHashMapæŒ‰ä½ä¸ã€‚0x7FFFFFFFåšä¸€æ¬¡æŒ‰ä½ä¸æ“ä½œï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯å¾—åˆ°çš„indexçš„ç¬¬ä¸€ä½ä¸º0ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº†å¾—åˆ°ä¸€ä¸ªæ­£æ•°ã€‚å› ä¸ºæœ‰ç¬¦å·æ•°ç¬¬ä¸€ä½0ä»£è¡¨æ­£æ•°ï¼Œ1ä»£è¡¨è´Ÿæ•°ã€‚</p></li><li><p><strong>åˆå§‹å¤§å°ä¸º11</strong>ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ä¸º<strong>åŸæ¥çš„2n+1</strong>ã€‚HashTableçš„é“¾è¡¨æ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯ä¸€ä¸ªç´ æ•°ã€å¥‡æ•°ã€‚ä¹‹åçš„æ¯æ¬¡æ‰©å……ç»“æœä¹Ÿéƒ½æ˜¯å¥‡æ•°ã€‚</p></li><li><p>å½“å“ˆå¸Œè¡¨çš„å¤§å°ä¸ºç´ æ•°æ—¶ï¼Œç®€å•çš„å–æ¨¡å“ˆå¸Œçš„ç»“æœä¼šæ›´åŠ <strong>å‡åŒ€</strong>ã€‚</p></li><li><p>å’ŒHashMap<strong>åŒºåˆ«</strong></p></li></ul><p>1ã€ç»§æ‰¿çš„çˆ¶ç±»ä¸åŒ</p><p>   Hashtableç»§æ‰¿è‡ªDictionaryç±»ï¼Œè€ŒHashMapç»§æ‰¿è‡ªAbstractMapç±»ã€‚ä½†äºŒè€…éƒ½å®ç°äº†Mapæ¥å£ã€‚</p><p>2ã€çº¿ç¨‹å®‰å…¨æ€§ä¸åŒ</p><p> å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå“ˆå¸Œæ˜ å°„ï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä»ç»“æ„ä¸Šä¿®æ”¹äº†è¯¥æ˜ å°„ï¼Œåˆ™å®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚Hashtable ä¸­çš„æ–¹æ³•æ˜¯Synchronizeçš„ï¼Œè€ŒHashMapä¸­çš„æ–¹æ³•åœ¨ç¼ºçœæƒ…å†µä¸‹æ˜¯éSynchronizeçš„ã€‚åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Hashtableï¼Œä¸éœ€è¦è‡ªå·±ä¸ºå®ƒçš„æ–¹æ³•å®ç°åŒæ­¥ï¼Œä½†ä½¿ç”¨HashMapæ—¶å°±å¿…é¡»è¦è‡ªå·±å¢åŠ åŒæ­¥å¤„ç†ã€‚</p><p>3ã€åªæœ‰HashMapå¯ä»¥è®©ä½ å°†ç©ºå€¼ä½œä¸ºä¸€ä¸ªè¡¨çš„æ¡ç›®çš„keyæˆ–value</p><p>c) ConcurrentHashMap</p><ul><li>ConcurrentHashMapçš„hashå®ç°å’ŒHashMapä¸€æ ·ï¼Œä½†æ˜¯<strong>ç”¨äº†ä¸åŒçš„å“ˆå¸Œç®—æ³•</strong>ï¼ˆWang/Jenkins å“ˆå¸Œç®—æ³•ï¼‰ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong> <strong>â€œåˆ†æ®µé”â€çš„æ¦‚å¿µ</strong>ï¼Œå…·ä½“å¯ä»¥ç†è§£ä¸ºæŠŠä¸€ä¸ªå¤§çš„Mapæ‹†åˆ†æˆNä¸ªå°çš„HashTableï¼Œæ ¹æ®key.hashCode()æ¥å†³å®šæŠŠkeyæ”¾åˆ°å“ªä¸ªHashTableä¸­ã€‚</li></ul><p>ConcurrentHashMapä¸­ï¼Œå°±æ˜¯æŠŠMapåˆ†æˆäº†Nä¸ªSegmentï¼Œputå’Œgetçš„æ—¶å€™ï¼Œéƒ½æ˜¯ç°æ ¹æ®key.hashCode()ç®—å‡ºæ”¾åˆ°å“ªä¸ªSegmentä¸­ã€‚</p><ul><li>é€šè¿‡æŠŠæ•´ä¸ªMapåˆ†ä¸ºNä¸ªSegmentï¼ˆç±»ä¼¼HashTableï¼‰ï¼Œå¯ä»¥æä¾›ç›¸åŒçš„çº¿ç¨‹å®‰å…¨ï¼Œ<strong>ä½†æ˜¯æ•ˆç‡æå‡Nå€ï¼Œé»˜è®¤æå‡16å€</strong>ã€‚</li></ul><p>ConcurrentHashMapåŸç†å¯å‚è€ƒ<a href="https://blog.csdn.net/xuefeng0707/article/details/40834595">https://blog.csdn.net/xuefeng0707/article/details/40834595</a></p><h3 id="gt-hashset-æ·»åŠ å…ƒç´ æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦é‡å¤çš„ï¼Ÿ"><a href="#gt-hashset-æ·»åŠ å…ƒç´ æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦é‡å¤çš„ï¼Ÿ" class="headerlink" title="> hashset æ·»åŠ å…ƒç´ æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦é‡å¤çš„ï¼Ÿ"></a><font color="green">&gt; hashset æ·»åŠ å…ƒç´ æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦é‡å¤çš„ï¼Ÿ</font></h3><p>1.ç¬¬ä¸€ï¼Œä»»ä½•ç±»éƒ½ç»§æ‰¿äº†Objectç±»çš„hashcodeï¼ˆï¼‰æ–¹æ³•ï¼Œå¦‚æœæœªé‡å†™hashcodeï¼Œhashsetä¼šä½¿ç”¨é»˜è®¤hashcodeè½¬åŒ–å¯¹è±¡å±æ€§å­—æ®µä¸ºæ•£åˆ—ç ã€‚<br>2.ç¬¬äºŒï¼Œå½“å¾—åˆ°æ•£åˆ—ç ç¡®å®šæ’å…¥çš„ä½ç½®åï¼Œæ¥ä¸‹æ¥hashsetä¼šè°ƒç”¨ è¦æ·»åŠ å¯¹è±¡çš„equals()æ–¹æ³• ä¸å·²ç»åœ¨è¯¥ä½ç½®ä¸Šçš„æ‰€æœ‰å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸ºtrueï¼Œåˆ™ä¸æ’å…¥ï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™æ’å…¥ã€‚<br>æ³¨æ„ï¼Œæ˜¯è°ƒç”¨çš„æ’å…¥å¯¹è±¡çš„equalsæ–¹æ³•ï¼Œä¸æ˜¯å·²ç»åœ¨hashsetä¸­çš„å¯¹è±¡ã€‚</p><h3 id="gt-è¿­ä»£å™¨Iterator"><a href="#gt-è¿­ä»£å™¨Iterator" class="headerlink" title=">è¿­ä»£å™¨Iterator"></a>&gt;<font color="green">è¿­ä»£å™¨Iterator</font></h3><p>è¿­ä»£å™¨æ˜¯ä¸€ç§æ¨¡å¼ï¼Œå¯ä»¥ä½¿å¾—åºåˆ—ç±»å‹çš„ç»“æ„æ•°æ®çš„éå†è¡Œä¸ºä¸è¢«éå†çš„å¯¹è±¡åˆ†ç¦»ã€‚æ— éœ€å…³å¿ƒå¯¹è±¡åº•å±‚çš„å®ç°ï¼Œåªè¦æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨éå†è¿™ä¸ªå¯¹è±¡çš„å†…éƒ¨ã€‚</p><ul><li>Iterable å®ç°è¿™ä¸ªæ¥å£çš„é›†åˆå¯¹è±¡æ”¯æŒè¿­ä»£ã€‚å®ç°Iterableåå¯ä»¥é…åˆforeachä½¿ç”¨ã€‚</li><li>Iterator è¿­ä»£å™¨ï¼Œæä¾›è¿­ä»£æœºåˆ¶çš„å¯¹è±¡ã€‚</li></ul><p>Iteratorä¸‰ä¸ªæ–¹æ³•ç»å¸¸ä½¿ç”¨<code>hasnext()</code> <code>next()</code> <code>remove()</code>ã€‚å…¶ä¸­<code>remove()</code>çš„ä½¿ç”¨éœ€è¦å…ˆè°ƒç”¨<code>next()</code>ã€‚</p><p>è¿­ä»£å‡ºçš„å¯¹è±¡ä¹Ÿæ˜¯å¼•ç”¨çš„æ‹·è´ï¼Œç»“æœè¿˜æ˜¯å¼•ç”¨ã€‚å¯ä»¥æ ¹æ®è¿­ä»£å‡ºçš„å…ƒç´ ç›´æ¥ä¿®æ”¹å¯¹è±¡ã€‚</p><p>Iteratorçš„removeæ–¹æ³•å¯ä»¥ä¿è¯ä¸è·‘å‡ºModificationExceptionå¼‚å¸¸å³<code>Fail-fast</code>æœºåˆ¶ã€‚</p><ul><li>for å’Œ Iteratorçš„åŒºåˆ«</li></ul><ol><li>ArrayListå¯¹éšæœºè®¿é—®å¿«é€Ÿï¼Œè€Œforå¾ªç¯ä¸­çš„<code>get()</code>æ–¹æ³•é‡‡ç”¨çš„æ˜¯éšæœºè®¿é—®çš„æ–¹æ³•ï¼Œå› æ­¤åœ¨ArrayListé‡Œï¼Œforå¾ªç¯è¾ƒå¿«ã€‚</li><li>LinkedListé¡ºåºè®¿é—®è¾ƒå¿«ï¼ŒIteratorä¸­çš„<code>next()</code>æ–¹æ³•ä½¿ç”¨é¡ºåºè®¿é—®ï¼Œå› æ­¤åœ¨LinkedListé‡Œï¼Œä½¿ç”¨iteratoræ›´å¿«ã€‚</li><li>forå¾ªç¯é€‚åˆå¿«é€ŸæŒ‡å®šå…ƒç´ æ‹¿å–æ•°æ®ã€‚Iteratoré€‚åˆé“¾å¼ç»“æ„ã€‚</li></ol><h3 id="lt-æœ‰æ²¡æœ‰gotoè¯­å¥"><a href="#lt-æœ‰æ²¡æœ‰gotoè¯­å¥" class="headerlink" title="<æœ‰æ²¡æœ‰gotoè¯­å¥"></a><font color="green">&lt;æœ‰æ²¡æœ‰<code>goto</code>è¯­å¥</font></h3><p>æœ‰ï¼Œä¹Ÿæœ‰<code>const</code>ã€‚JAVAåªä¿ç•™ä½†åŸºæœ¬ä¸ç”¨äº†ã€‚</p><blockquote><p>ä¸€ä¸ª<code>.class</code>æ–‡ä»¶å¯ä¸å¯ä»¥æœ‰å¤šä¸ªç±»</p></blockquote><p>å¯ä»¥æœ‰å¤šä¸ªï¼Œä½†æ˜¯publicåªæœ‰ä¸€ä¸ªã€‚ä¸¤ä¸ªä»¥ä¸Špublicå°±ä¸çŸ¥é“åŠ è½½å“ªä¸ªç±»ï¼Œä¼šæŠ¥é”™ã€‚</p><h3 id="lt-String-å¸¸é‡æ± "><a href="#lt-String-å¸¸é‡æ± " class="headerlink" title="< String å¸¸é‡æ± "></a><font color="green">&lt; String å¸¸é‡æ± </font></h3><p>å­—ç¬¦ä¸²å¸¸é‡æ± åº•å±‚æ˜¯ç”¨<strong>HashTable</strong>å®ç°çš„ã€‚</p><ol><li>åˆ›å»ºå¯¹è±¡çš„ä¸¤ç§æ–¹å¼ã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>     <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token operator">==</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span><span class="token comment">//ç¬¬ä¸€ç§æ–¹å¼æ˜¯åœ¨å¸¸é‡æ± ä¸­æ‹¿å¯¹è±¡ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯ç›´æ¥åœ¨å †å†…å­˜ç©ºé—´åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>JDKç‰ˆæœ¬ä¸­(1.7å), å­—ç¬¦ä¸²å¸¸é‡æ± è¢«å®ç°åœ¨Javaå †å†…å­˜ä¸­ã€‚</li></ol><pre class="line-numbers language-none"><code class="language-none">String str1 = "abc"; String str2 = "abc"; String str3 = "abc"; String str4 = new String("abc");String str5 = new String("abc");System.out.println(str4==str5);//false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/03/15/java/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%86%85%E5%AD%98.png" alt="å¥æŸ„"></p><ol start="3"><li><p><strong>â€œåŒå¼•å·â€â€å£°æ˜å­—ç¬¦ä¸²çš„æ–¹å¼</strong>, </p><p>JVMé¦–å…ˆä¼šå»<strong>å­—ç¬¦ä¸²æ± </strong>ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨â€abcâ€è¿™ä¸ªå¯¹è±¡ï¼š</p></li></ol><ul><li>ä¸å­˜åœ¨ï¼Œåœ¨å­—ç¬¦ä¸²æ± ä¸­åˆ›å»ºâ€abcâ€è¿™ä¸ªå¯¹è±¡ï¼Œå°†â€abcâ€è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨åœ°å€è¿”å›ç»™å­—ç¬¦ä¸²å¸¸é‡s1ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼Œç›´æ¥å°†æ± ä¸­â€abcâ€è¿™ä¸ªå¯¹è±¡çš„åœ°å€è¿”å›ï¼Œèµ‹ç»™å­—ç¬¦ä¸²å¸¸é‡ã€‚</li></ul><ol start="4"><li><p><strong>newå­—ç¬¦ä¸²</strong></p><p>JVMé¦–å…ˆåœ¨å­—ç¬¦ä¸²æ± ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰â€abcâ€è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼š</p></li></ol><ul><li>å­˜åœ¨ï¼Œ<strong>ç›´æ¥åœ¨å †</strong>ä¸­åˆ›å»ºä¸€ä¸ªâ€abcâ€å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†å †ä¸­çš„â€abcâ€å¯¹è±¡çš„åœ°å€è¿”å›èµ‹ç»™å¼•ç”¨str4ã€‚</li><li>ä¸å­˜åœ¨ï¼Œ<strong>å­—ç¬¦ä¸²æ± </strong>ä¸­åˆ›å»ºä¸€ä¸ªâ€abcâ€å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå†åœ¨<strong>å †</strong>ä¸­åˆ›å»ºä¸€ä¸ªâ€abcâ€å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå°†å †ä¸­â€abcâ€å­—ç¬¦ä¸²å¯¹è±¡çš„åœ°å€è¿”å›èµ‹ç»™s3å¼•ç”¨ã€‚</li></ul><ol start="5"><li><strong>intern()</strong> </li></ol><p>è°ƒç”¨ internæ–¹æ³•æ—¶ï¼ŒæŸ¥å­—ç¬¦ä¸²æ± ä¸­ï¼š</p><ul><li><p>ä¸æ­¤å¯¹è±¡å­—ç¬¦ä¸²<strong>å†…å®¹ç›¸åŒ</strong>ï¼Œå¦‚æœæ± å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤Stringå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼ˆç”¨**equals(object)**æ–¹æ³•ç¡®å®šï¼‰ï¼Œåˆ™è¿”å›æ± ä¸­çš„å­—ç¬¦ä¸²ã€‚</p></li><li><p>ä¸ç›¸åŒï¼Œå°†æ­¤Stringå¯¹è±¡æ·»åŠ åˆ°æ± ä¸­ï¼Œå¹¶è¿”å›æ­¤Stringå¯¹è±¡åœ¨å¸¸é‡æ± ä¸­çš„å¼•ç”¨ã€‚ å¯¹äºä»»æ„ä¸¤ä¸ªå­—ç¬¦ä¸²så’Œtï¼Œæ‰€æœ‰å­—é¢å€¼å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²èµ‹å€¼å¸¸é‡è¡¨è¾¾å¼éƒ½ä½¿ç”¨ intern()è¿›è¡Œæ“ä½œã€‚</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span> <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apend</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> str3 <span class="token operator">=</span> str2<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1<span class="token operator">==</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1<span class="token operator">==</span>str3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹é¢˜ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span><span class="token class-name">String</span> s2 <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token string">"b"</span><span class="token punctuation">;</span><span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">"a"</span> <span class="token operator">+</span> <span class="token string">"b"</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2 <span class="token operator">==</span> <span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> <span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸€æ¡è¯­å¥æ‰“å°çš„ç»“æœä¸ºfalseï¼Œç¬¬äºŒæ¡è¯­å¥æ‰“å°çš„ç»“æœä¸ºtrueï¼Œè¿™è¯´æ˜javacç¼–è¯‘å¯ä»¥å¯¹å­—ç¬¦ä¸²å¸¸é‡ç›´æ¥ç›¸åŠ çš„è¡¨è¾¾å¼è¿›è¡Œä¼˜åŒ–ï¼Œä¸å¿…è¦ç­‰åˆ°è¿è¡ŒæœŸå†å»è¿›è¡ŒåŠ æ³•è¿ç®—å¤„ç†ï¼Œè€Œæ˜¯åœ¨ç¼–è¯‘æ—¶å»æ‰å…¶ä¸­çš„åŠ å·ï¼Œç›´æ¥å°†å…¶ç¼–è¯‘æˆä¸€ä¸ªè¿™äº›å¸¸é‡ç›¸è¿çš„ç»“æœã€‚ç”±äºs2åªèƒ½åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šï¼Œæ‰€ä»¥s2æŒ‡å‘çš„ä¸æ˜¯å¸¸é‡æ± ä¸­çš„â€œabâ€ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç¼–è¯‘æœŸç¡®å®š * å¯¹äºfinalä¿®é¥°çš„å˜é‡ï¼Œå®ƒåœ¨ç¼–è¯‘æ—¶è¢«è§£æä¸ºå¸¸é‡å€¼çš„ä¸€ä¸ªæœ¬åœ°æ‹·è´å­˜å‚¨åˆ°è‡ªå·±çš„å¸¸é‡æ± ä¸­æˆ–åµŒå…¥åˆ°å®ƒçš„å­—èŠ‚ç æµä¸­ã€‚ * æ‰€ä»¥æ­¤æ—¶çš„"a" + s1å’Œ"a" + "b"æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚æ•…ç»“æœä¸ºtrueã€‚ */</span><span class="token class-name">String</span> s0 <span class="token operator">=</span> <span class="token string">"ab"</span><span class="token punctuation">;</span> <span class="token keyword">final</span> <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"b"</span><span class="token punctuation">;</span> <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"a"</span> <span class="token operator">+</span> s1<span class="token punctuation">;</span>  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s0 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result = true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¢˜ç›®ä¸­çš„ç¬¬ä¸€è¡Œä»£ç è¢«ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼˜åŒ–åï¼Œç›¸å½“äºç›´æ¥å®šä¹‰äº†ä¸€ä¸ªâ€abcdâ€çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ï¼Œä¸Šé¢çš„ä»£ç åº”è¯¥åªåˆ›å»ºäº†ä¸€ä¸ªStringå¯¹è±¡ã€‚å†™å¦‚ä¸‹ä¸¤è¡Œä»£ç ï¼Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s <span class="token operator">=</span><span class="token string">"a"</span> <span class="token operator">+</span> <span class="token string">"b"</span> <span class="token operator">+</span><span class="token string">"c"</span> <span class="token operator">+</span> <span class="token string">"d"</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token operator">==</span> <span class="token string">"abcd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æœ€ç»ˆæ‰“å°çš„ç»“æœåº”è¯¥ä¸ºtrueã€‚</p><blockquote><p>java switch ä½œç”¨äºå“ªäº›ç±»å‹</p></blockquote><p>char byte short int Charator Byte Short Integer String Enumæšä¸¾ç±»å‹ã€‚</p><blockquote><p>short a=a+1; short a+=1;æ˜¯å¦æŠ¥é”™ï¼Ÿ</p></blockquote><p>short a =a+1ã€‚intè½¬shortå¼ºåˆ¶ç±»å‹ç¼–è¯‘æŠ¥é”™ã€‚</p><p>+=æ˜¯javaå†…ç½®ç¬¦å·ï¼Œä¸ä¼šæŠ¥é”™ã€‚</p><h3 id="lt-java-å†…å­˜æ¨¡å‹"><a href="#lt-java-å†…å­˜æ¨¡å‹" class="headerlink" title="< java å†…å­˜æ¨¡å‹"></a><font color="green">&lt; java å†…å­˜æ¨¡å‹</font></h3><p><img src="/2021/03/15/java/JAVA%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.png" alt="å¥æŸ„"></p><p>Javaå†…å­˜æ¨¡å‹çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­<strong>å˜é‡çš„è®¿é—®è§„åˆ™</strong>ã€‚å³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°ä¸»å†…å­˜æˆ–è€…å°†å˜é‡ä»ä¸»å†…å­˜å–å‡ºè¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„<strong>å˜é‡è·Ÿæˆ‘ä»¬å†™javaç¨‹åºä¸­çš„å˜é‡ä¸æ˜¯å®Œå…¨ç­‰åŒçš„</strong>ã€‚è¿™é‡Œçš„å˜é‡æ˜¯æŒ‡å®ä¾‹å­—æ®µï¼Œé™æ€å­—æ®µï¼Œæ„æˆæ•°ç»„å¯¹è±¡çš„å…ƒç´ ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡å’Œæ–¹æ³•å‚æ•°(å› ä¸ºè¿™æ˜¯çº¿ç¨‹ç§æœ‰çš„)ã€‚è¿™é‡Œå¯ä»¥ç®€å•çš„è®¤ä¸ºä¸»å†…å­˜æ˜¯javaè™šæ‹Ÿæœºå†…å­˜åŒºåŸŸä¸­çš„å †ï¼Œå±€éƒ¨å˜é‡å’Œæ–¹æ³•å‚æ•°æ˜¯åœ¨è™šæ‹Ÿæœºæ ˆä¸­å®šä¹‰çš„ã€‚ä½†æ˜¯åœ¨å †ä¸­çš„å˜é‡å¦‚æœåœ¨å¤šçº¿ç¨‹ä¸­éƒ½ä½¿ç”¨ï¼Œå°±æ¶‰åŠåˆ°äº†å †å’Œä¸åŒè™šæ‹Ÿæœºæ ˆä¸­å˜é‡çš„å€¼çš„ä¸€è‡´æ€§é—®é¢˜äº†ã€‚</p><ul><li><p>ä¸»å†…å­˜ï¼šjavaè™šæ‹Ÿæœºè§„å®šæ‰€æœ‰çš„å˜é‡(ä¸æ˜¯ç¨‹åºä¸­çš„å˜é‡)éƒ½å¿…é¡»åœ¨ä¸»å†…å­˜ä¸­äº§ç”Ÿï¼Œå¯ä»¥<strong>ç®€å•</strong>è®¤ä¸ºæ˜¯å †åŒºï¼ˆä»…ä»…åšè§£é‡Šï¼Œå®é™…ä¸æ˜¯ï¼‰ã€‚ä¸æ˜¯ç‰©ç†å†…å­˜ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯è™šæ‹Ÿæœºçš„ä¸»å†…å­˜ï¼Œå®ƒæ˜¯è™šæ‹Ÿæœºå†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</p></li><li><p>å·¥ä½œå†…å­˜ï¼šjavaè™šæ‹Ÿæœºä¸­æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œè¯¥å†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯è™šæ‹Ÿæœºæ ˆã€‚çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¿å­˜äº†çº¿ç¨‹éœ€è¦çš„å˜é‡åœ¨ä¸»å†…å­˜ä¸­çš„å‰¯æœ¬ã€‚<strong>çº¿ç¨‹å¯¹ä¸»å†…å­˜å˜é‡çš„ä¿®æ”¹å¿…é¡»åœ¨çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡</strong>ã€‚ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿä¸èƒ½ç›¸äº’è®¿é—®å¯¹æ–¹çš„å·¥ä½œå†…å­˜ã€‚å¦‚æœçº¿ç¨‹ä¹‹é—´éœ€è¦ä¼ é€’å˜é‡çš„å€¼ï¼Œå¿…é¡»é€šè¿‡ä¸»å†…å­˜æ¥ä½œä¸ºä¸­ä»‹è¿›è¡Œä¼ é€’ã€‚</p></li></ul><p>javaå†…å­˜ä¸­çº¿ç¨‹çš„å·¥ä½œå†…å­˜å’Œä¸»å†…å­˜çš„äº¤äº’æ˜¯ç”±javaè™šæ‹Ÿæœºå®šä¹‰äº†å¦‚ä¸‹çš„8ç§æ“ä½œæ¥å®Œæˆçš„ã€‚</p><ul><li><p><strong>lock(é”å®š)</strong>:ä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶é—´åªèƒ½ä¸€ä¸ªçº¿ç¨‹é”å®šï¼Œè¯¥æ“ä½œè¡¨ç¤ºè¿™æ¡çº¿æˆç‹¬å è¿™ä¸ªå˜é‡</p></li><li><p><strong>unlock(è§£é”)</strong>:ä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œè¡¨ç¤ºè¿™ä¸ªå˜é‡çš„çŠ¶æ€ç”±å¤„äºé”å®šçŠ¶æ€è¢«é‡Šæ”¾ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æ‰èƒ½å¯¹è¯¥å˜é‡è¿›è¡Œé”å®š</p></li><li><p><strong>read(è¯»å–)</strong>:ä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼Œè¡¨ç¤ºæŠŠä¸€ä¸ªä¸»å†…å­˜å˜é‡çš„å€¼ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ï¼Œä»¥ä¾¿éšåçš„loadæ“ä½œä½¿ç”¨</p></li><li><p><strong>load(è½½å…¥)</strong>:ä½œç”¨äºçº¿ç¨‹çš„å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œè¡¨ç¤ºæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­è¯»å–çš„å˜é‡çš„å€¼æ”¾åˆ°å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­(å‰¯æœ¬æ˜¯ç›¸å¯¹äºä¸»å†…å­˜çš„å˜é‡è€Œè¨€çš„)</p></li><li><p><strong>use(ä½¿ç”¨)</strong>:ä½œç”¨äºçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œè¡¨ç¤ºæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°±ä¼šæ‰§è¡Œè¯¥æ“ä½œ</p></li><li><p><strong>assign(èµ‹å€¼)</strong>:ä½œç”¨äºçº¿ç¨‹çš„å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œè¡¨ç¤ºæŠŠæ‰§è¡Œå¼•æ“è¿”å›çš„ç»“æœèµ‹å€¼ç»™å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°±ä¼šæ‰§è¡Œè¯¥æ“ä½œ</p></li><li><p><strong>store(å­˜å‚¨)</strong>:ä½œç”¨äºçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™ä¸»å†…å­˜ï¼Œä»¥ä¾¿éšåçš„writeæ“ä½œä½¿ç”¨</p></li><li><p><strong>write(å†™å…¥)</strong>:ä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­</p></li></ul><p>æ‰§è¡Œè¿™äº›æ“ä½œéœ€è¦éµå¾ªæ–‡ä¸­ä¸€å¼€å§‹è®°å½•çš„<strong>Happens-before</strong>åŸåˆ™ã€‚</p><h3 id="lt-å¼•ç”¨ç±»å‹"><a href="#lt-å¼•ç”¨ç±»å‹" class="headerlink" title="< å¼•ç”¨ç±»å‹"></a><font color="green">&lt; å¼•ç”¨ç±»å‹</font></h3><p>JAVA <strong>4ç§</strong>å¼•ç”¨ç±»å‹ã€‚</p><ol><li>å¼ºå¼•ç”¨</li></ol><p>javaé»˜è®¤çš„å£°æ˜å°±æ˜¯å¼ºå¼•ç”¨ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åªè¦objè¿˜æŒ‡å‘Objectå¯¹è±¡ï¼ŒObjectå¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶</span>obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">//æ‰‹åŠ¨ç½®null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œåƒåœ¾å›æ”¶å°±ä¸ä¼šå›æ”¶å®ƒã€‚é™¤éä½ æ‰‹åŠ¨ç½®ä¸ºç©ºï¼Œæˆ–è€…å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸç»“æŸï¼ˆå±€éƒ¨å¯¹è±¡ï¼Œå‡½æ•°è°ƒç”¨å®Œæ¯•ï¼‰ã€‚</p><ol start="2"><li>è½¯å¼•ç”¨</li></ol><p>JAVA 1.2ä¹‹åï¼Œç”¨<code>java.lang.ref.SoftReference</code>è¡¨ç¤ºè½¯å¼•ç”¨ã€‚</p><p>å½“å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œæ‰ä¼šå›æ”¶è½¯å¼•ç”¨å¯¹è±¡ã€‚å¦‚æœå›æ”¶åå†…å­˜è¿˜ä¸å¤Ÿç”¨ï¼Œæ‰ä¼šOOMï¼ˆOut Of  Memory)ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>sr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> rev <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> sr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// è¿˜æ²¡æœ‰è¢«å›æ”¶å™¨å›æ”¶ï¼Œç›´æ¥è·å–</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">// ç”±äºå†…å­˜åƒç´§ï¼Œæ‰€ä»¥å¯¹è½¯å¼•ç”¨çš„å¯¹è±¡å›æ”¶äº†</span>sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// é‡æ–°æ„å»º</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè®¾ç½®JVMå†…å­˜åªæœ‰<strong>2M</strong>ï¼Œä¸‹é¢è¿™ä¸ªä»£ç æ¯æ¬¡åˆ†é…1Mçš„å†…å­˜ï¼Œçœ‹çœ‹ä»€ä¹ˆç»“æœï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestOOM</span> <span class="token punctuation">{</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token function">testSoftReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testSoftReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸»åŠ¨é€šçŸ¥åƒåœ¾å›æ”¶</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SoftReference</span><span class="token punctuation">)</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/03/15/java/OOM%E6%B5%8B%E8%AF%95.png" alt="å¥æŸ„"></p><p>è°ƒç”¨äº†å¾ˆå¤šæ¬¡ï¼Œåªæœ‰ä¸€ä¸ªå¯¹è±¡æ—¶å­˜åœ¨çš„ï¼Œå…¶ä»–éƒ½æ˜¯<code>null</code>è¢«å›æ”¶äº†ã€‚</p><ol start="3"><li>å¼±å¼•ç”¨</li></ol><p>æ¯”è½¯å¼•ç”¨è¿˜å¼±ã€‚<strong>æ— è®ºå†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œåªè¦JVMå¼€å§‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé‚£äº›è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡éƒ½è¦å›æ”¶ã€‚</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testWeakReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">WeakReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸»åŠ¨é€šçŸ¥åƒåœ¾å›æ”¶</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">WeakReference</span><span class="token punctuation">)</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æ˜¯é™å®šå†…å­˜2Mï¼Œæ¯æ¬¡byteæ•°ç»„ä½¿ç”¨1Mï¼Œè®©å…¶å†…å­˜ä¸å¤Ÿç”¨ï¼Œçœ‹ç»“æœï¼š</p><p><img src="/2021/03/15/java/%E5%BC%B1%E5%BC%95%E7%94%A8.png" alt="å¥æŸ„"></p><p>æ‰€æœ‰å¯¹è±¡éƒ½å›æ”¶äº†ã€‚</p><ol start="4"><li>è™šå¼•ç”¨</li></ol><p><code>PhantomReference</code>è¡¨ç¤ºè™šå¼•ç”¨ï¼Œå®ƒæ˜¯æœ€å¼±çš„å¼•ç”¨ã€‚<strong>å¯¹è±¡ä»…æœ‰è™šå¼•ç”¨ï¼Œå’Œæ²¡æœ‰å¼•ç”¨ä¸€æ ·ï¼Œéšæ—¶å¯èƒ½è¢«å›æ”¶</strong>ã€‚<strong>å¿…é¡»è¦å’Œ<code>ReferenceQueue</code>å¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚</strong></p><p>çœ‹å®ƒçš„<code>PhantomReference</code>ç±»çš„æºä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Reference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token comment">/**     * Returns this reference object's referent.  Because the referent of a     * phantom reference is always inaccessible, this method always returns     * &lt;code&gt;null&lt;/code&gt;.     *     * @return  &lt;code&gt;null&lt;/code&gt;     */</span>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">PhantomReference</span><span class="token punctuation">(</span><span class="token class-name">T</span> referent<span class="token punctuation">,</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> q<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>referent<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®ƒçš„getæ°¸è¿œè¿”å›<code>null</code>ã€‚æ— æ³•é€šè¿‡è™šå¼•ç”¨å¼•ç”¨å¯¹è±¡ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ReferenceQueue</span> refQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> phantomReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>refQueue<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™æ²¡æ³•å¼•ç”¨å¯¹è±¡ï¼Œæœ‰<strong>ä»–å¦ˆçš„</strong>å•¥ç”¨å‘¢ï¼Ÿ</p><p><strong>å¯ä»¥ç”¨æ¥è·Ÿè¸ªå¯¹è±¡å‘—ã€‚</strong>å®ƒçš„ä½œç”¨åœ¨äºè·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ï¼Œåœ¨å¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚ å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨åƒåœ¾å›æ”¶åï¼Œå°†è¿™ä¸ªè™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œåœ¨å…¶å…³è”çš„è™šå¼•ç”¨å‡ºé˜Ÿå‰ï¼Œä¸ä¼šå½»åº•é”€æ¯è¯¥å¯¹è±¡ã€‚ æ‰€ä»¥å¯ä»¥é€šè¿‡æ£€æŸ¥å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç›¸åº”çš„è™šå¼•ç”¨æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»è¢«å›æ”¶äº†ã€‚</p><p>ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨ä¸åŒï¼Œæ˜¾å¼ä½¿ç”¨è™šå¼•ç”¨å¯ä»¥é˜»æ­¢å¯¹è±¡è¢«æ¸…é™¤ï¼Œåªæœ‰åœ¨ç¨‹åºä¸­æ˜¾å¼æˆ–è€…éšå¼ç§»é™¤è¿™ä¸ªè™šå¼•ç”¨æ—¶ï¼Œè¿™ä¸ªå·²ç»æ‰§è¡Œè¿‡finalizeæ–¹æ³•çš„å¯¹è±¡æ‰ä¼šè¢«æ¸…é™¤ã€‚æƒ³è¦æ˜¾å¼çš„ç§»é™¤è™šå¼•ç”¨çš„è¯ï¼Œåªéœ€è¦å°†å…¶ä»å¼•ç”¨é˜Ÿåˆ—ä¸­å–å‡ºç„¶åæ‰”æ‰ï¼ˆç½®ä¸ºnullï¼‰å³å¯ã€‚</p><p>æœ‰ä¸ªä¾‹å­ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhantomReferenceTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> TEST_DATA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TestClass</span><span class="token punctuation">&gt;</span></span> QUEUE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">TestClass</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestClass</span><span class="token punctuation">(</span><span class="token string">"Test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TestClass</span><span class="token punctuation">&gt;</span></span> phantomReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> QUEUE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¯¥çº¿ç¨‹ä¸æ–­è¯»å–è¿™ä¸ªè™šå¼•ç”¨ï¼Œå¹¶ä¸æ–­å¾€åˆ—è¡¨é‡Œæ’å…¥æ•°æ®ï¼Œä»¥ä¿ƒä½¿ç³»ç»Ÿæ—©ç‚¹è¿›è¡ŒGC</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                TEST_DATA<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phantomReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¿™ä¸ªçº¿ç¨‹ä¸æ–­è¯»å–å¼•ç”¨é˜Ÿåˆ—ï¼Œå½“å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œè¯¥å¼•ç”¨å°±ä¼šè¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">Reference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">TestClass</span><span class="token punctuation">&gt;</span></span> poll <span class="token operator">=</span> QUEUE<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>poll <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--- è™šå¼•ç”¨å¯¹è±¡è¢«jvmå›æ”¶äº† ---- "</span> <span class="token operator">+</span> poll<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--- å›æ”¶å¯¹è±¡ ---- "</span> <span class="token operator">+</span> poll<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">TestClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"TestClass - "</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¨‹åºè¾“å‡ºï¼š</p><p><img src="/2021/03/15/java/%E8%99%9A%E5%BC%95%E7%94%A8%E8%B7%9F%E8%B8%AA%E5%AF%B9%E8%B1%A1%E5%AD%98%E6%B4%BB%E7%8A%B6%E6%80%81.png" alt="å¥æŸ„"></p><h3 id="lt-å†…å­˜æ³„æ¼"><a href="#lt-å†…å­˜æ³„æ¼" class="headerlink" title="< å†…å­˜æ³„æ¼"></a><font color="green">&lt; å†…å­˜æ³„æ¼</font></h3><p>JAVA GCå›æ”¶æœ¬è´¨ä¸Šè¿˜æ˜¯åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨çš„æ–¹å¼ã€‚å¦‚æœï¼Œ<strong>JVMè¯¯ä»¥ä¸ºæ­¤å¯¹è±¡è¿˜åœ¨å¼•ç”¨ä¸­ï¼Œæ— æ³•å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</strong></p><p>8ç§å¸¸è§æƒ…å†µï¼š</p><p>1ï¼‰<strong>staticå­—æ®µå¤ªå¤š</strong></p><p>åŸå› ï¼šé™æ€å­—æ®µæ‹¥æœ‰å’Œæ•´ä¸ªåº”ç”¨ç¨‹åºä¸€æ ·çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>æƒ³ä¸€æƒ³å•ä¾‹æ¨¡å¼çš„staticï¼Œå¯¹è±¡å¦‚æœå¤ªå¤§å°±ggäº†</strong></p><p>è§£å†³åŠæ³•ï¼šæœ€å¤§é™åº¦çš„å‡å°‘é™æ€å˜é‡çš„ä½¿ç”¨ï¼›å•ä¾‹æ¨¡å¼æ—¶ï¼Œä¾èµ–äºå»¶è¿ŸåŠ è½½å¯¹è±¡è€Œä¸æ˜¯ç«‹å³åŠ è½½æ–¹å¼ã€‚</p><p>2ï¼‰<strong>æœªå…³é—­èµ„æº</strong></p><p>åŸå› ï¼šæ¯æ¬¡ä½¿ç”¨JAVA IOæµç­‰åˆ›å»ºè¯»å–æµæ—¶ï¼ŒJVMéƒ½ä¼šä¸ºè¿™äº›èµ„æºåˆ†é…å†…å­˜ã€‚</p><p>è§£å†³åŠæ³•ï¼šä½¿ç”¨finallyå—å…³é—­èµ„æºï¼›å…³é—­èµ„æºçš„ä»£ç ï¼Œä¸åº”è¯¥æœ‰å¼‚å¸¸ï¼›jdk1.7åï¼Œå¯ä»¥ä½¿ç”¨try-with-resourceå—ã€‚</p><p>3ï¼‰<strong>hashcode()å’Œä¸æ­£ç¡®çš„equals()</strong></p><p>åŸå› ï¼šåœ¨HashMapå’ŒHashSetè¿™ç§é›†åˆä¸­ï¼Œequal()å’ŒhashCode()æ¥æ¯”è¾ƒå¯¹è±¡ï¼Œå¦‚æœé‡å†™ä¸åˆç†ï¼Œå°†ä¼šæˆä¸ºæ½œåœ¨çš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚</p><p>æ¯”å¦‚ï¼šå½“ä¸€ä¸ªå¯¹è±¡è¢«å­˜å‚¨è¿›HashSeté›†åˆä¸­ï¼Œä¸èƒ½ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„é‚£äº›å‚ä¸è®¡ç®—å“ˆå¸Œå€¼çš„å­—æ®µäº†ï¼Œå¦åˆ™ï¼Œå¯¹è±¡ä¿®æ”¹åçš„å“ˆå¸Œå€¼ä¸æœ€åˆå­˜å‚¨è¿›HashSeté›†åˆä¸­æ—¶çš„å“ˆå¸Œå€¼å°±ä¸åŒï¼Œå§‹ç»ˆè®©GCä»¥ä¸ºå¯¹è±¡æœ‰å¼•ç”¨ï¼Œæ— æ³•å›æ”¶ã€‚</p><p>è§£å†³åŠæ³•ï¼šç”¨æœ€ä½³çš„æ–¹å¼é‡å†™equals()å’ŒhashCodeã€‚</p><ol start="4"><li><strong>å¼•ç”¨å¤–éƒ¨ç±»çš„å†…éƒ¨ç±»</strong></li></ol><p>åŸå› ï¼š <strong>éé™æ€å†…éƒ¨ç±»</strong>çš„åˆå§‹åŒ–ï¼Œéœ€è¦å¤–éƒ¨ç±»å®ä¾‹æ‰èƒ½ä½¿ç”¨ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªéé™æ€å†…éƒ¨ç±»æœ‰å¯¹å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå¼•ç”¨äº†è¿™ä¸ªå†…éƒ¨ç±»ï¼Œé‚£ä¹ˆå¤–éƒ¨ç±»å¯¹è±¡è¶…å‡ºèŒƒå›´åï¼Œå®ƒä¹Ÿä¸ä¼šè¢«åƒåœ¾æ”¶é›†ã€‚</p><p>è§£å†³åŠæ³•ï¼šå¦‚æœå†…éƒ¨ç±»ä¸éœ€è¦è®¿é—®åŒ…å«çš„ç±»æˆå‘˜ï¼Œè€ƒè™‘è½¬æ¢ä¸ºé™æ€ç±»ã€‚</p><p>5ï¼‰<strong>finalize()æ–¹æ³•é€ æˆçš„å†…å­˜æ³„éœ²</strong></p><p>åŸå› ï¼šé‡å†™finalize()æ–¹æ³•æ—¶ï¼Œè¯¥ç±»çš„å¯¹è±¡ä¸ä¼šç«‹å³è¢«åƒåœ¾æ”¶é›†å™¨æ”¶é›†ï¼Œå¦‚æœfinalize()æ–¹æ³•çš„ä»£ç æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆä¼šæ½œåœ¨çš„å¼•å‘OOMï¼›</p><p>è§£å†³åŠæ³•ï¼šé¿å…é‡å†™finalize()ã€‚</p><p>6ï¼‰<strong>ThreadLocal</strong></p><p>ä½¿ç”¨ThreadLocalæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹åªè¦å¤„äºå­˜æ´»çŠ¶æ€å°±å¯ä¿ç•™å¯¹ThreadLocalå˜é‡çš„è°ƒç”¨ã€‚ä½¿ç”¨ä¸å½“ï¼Œå°±ä¼šå¼•èµ·å†…å­˜æ³„éœ²ã€‚</p><p>ä¸€æ—¦çº¿ç¨‹ä¸åœ¨å­˜åœ¨ï¼ŒThreadLocalså°±åº”è¯¥è¢«åƒåœ¾æ”¶é›†ï¼Œè€Œç°åœ¨çº¿ç¨‹çš„åˆ›å»ºéƒ½æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± æœ‰çº¿ç¨‹é‡ç”¨çš„åŠŸèƒ½ï¼Œå› æ­¤çº¿ç¨‹å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚æ‰€ä»¥ä½¿ç”¨åˆ°ThreadLocalsæ¥ä¿ç•™çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„å˜é‡å‰¯æœ¬æ—¶ï¼ŒThreadLocalsæ²¡æœ‰æ˜¾ç¤ºçš„åˆ é™¤æ—¶ï¼Œå°±ä¼šä¸€ç›´ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</p><p>è§£å†³åŠæ³•ï¼šä¸åœ¨ä½¿ç”¨ThreadLocalæ—¶ï¼Œè°ƒç”¨remove()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ é™¤äº†æ­¤å˜é‡çš„å½“å‰çº¿ç¨‹å€¼ã€‚ä¸è¦ä½¿ç”¨ThreadLocal.set(null)ï¼Œå®ƒåªæ˜¯æŸ¥æ‰¾ä¸å½“å‰çº¿ç¨‹å…³è”çš„Mapå¹¶å°†é”®å€¼å¯¹è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ä¸ºnullã€‚</p><p>7ï¼‰<strong>å¸¸é‡å­—ç¬¦ä¸²</strong></p><p>åŸå› ï¼šè¯»å–ä¸€ä¸ªå¾ˆå¤§çš„Stringå¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†intern(ï¼‰ï¼Œå®ƒå°†æ”¾åˆ°å­—ç¬¦ä¸²æ± ä¸­ï¼Œåªè¦åº”ç”¨ç¨‹åºè¿è¡Œï¼Œè¯¥å­—ç¬¦ä¸²å°±ä¼šä¿ç•™ï¼Œè¿™å°±ä¼šå ç”¨å†…å­˜ï¼Œå¯èƒ½é€ æˆOOMã€‚</p><p>è§£å†³åŠæ³•ï¼šå¢åŠ PermGençš„å¤§å°ï¼Œ-XX:MaxPermSize=512mï¼ˆ1.7å‰ï¼‰ï¼›å‡çº§Javaç‰ˆæœ¬ï¼ŒJDK1.7åå­—ç¬¦ä¸²æ± è½¬ç§»åˆ°äº†å †ä¸­ã€‚</p><h3 id="gt-æ ˆæº¢å‡º"><a href="#gt-æ ˆæº¢å‡º" class="headerlink" title="> æ ˆæº¢å‡º"></a><font color="green">&gt; æ ˆæº¢å‡º</font></h3><h3 id="gt-æ ˆæ³„éœ²"><a href="#gt-æ ˆæ³„éœ²" class="headerlink" title="> æ ˆæ³„éœ²"></a><font color="green">&gt; æ ˆæ³„éœ²</font></h3><p>B+æ ‘ç¼ºç‚¹</p><h3 id="lt-Fail-Fastæœºåˆ¶"><a href="#lt-Fail-Fastæœºåˆ¶" class="headerlink" title="< Fail-Fastæœºåˆ¶"></a><font color="green">&lt; Fail-Fastæœºåˆ¶</font></h3><p>HashMap ä¸­æœ‰è¿™ç§æè¿°ï¼š</p><p>æ³¨æ„ï¼Œè¿­ä»£å™¨çš„<strong>å¿«é€Ÿå¤±è´¥</strong>è¡Œä¸ºä¸èƒ½å¾—åˆ°ä¿è¯ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå­˜åœ¨éåŒæ­¥çš„å¹¶å‘ä¿®æ”¹æ—¶ï¼Œä¸å¯èƒ½ä½œå‡ºä»»ä½•åšå†³çš„ä¿è¯ã€‚å¿«é€Ÿå¤±è´¥è¿­ä»£å™¨å°½æœ€å¤§åŠªåŠ›æŠ›å‡º <code>ConcurrentModificationException</code>ã€‚å› æ­¤ï¼Œç¼–å†™ä¾èµ–äºæ­¤å¼‚å¸¸çš„ç¨‹åºçš„åšæ³•æ˜¯é”™è¯¯çš„ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼šè¿­ä»£å™¨çš„å¿«é€Ÿå¤±è´¥è¡Œä¸ºåº”è¯¥ä»…ç”¨äºæ£€æµ‹ç¨‹åºé”™è¯¯ã€‚</p><p>â€œå¿«é€Ÿå¤±è´¥â€ä¹Ÿå°±æ˜¯ fail-fastï¼Œå®ƒæ˜¯ Java é›†åˆçš„ä¸€ç§<strong>é”™è¯¯æ£€æµ‹æœºåˆ¶ã€‚</strong></p><p>å½“å¤šä¸ªçº¿ç¨‹å¯¹é›†åˆè¿›è¡Œç»“æ„ä¸Šçš„æ”¹å˜çš„æ“ä½œæ—¶ï¼Œæœ‰å¯èƒ½ä¼šäº§ç”Ÿ fail-fast æœºåˆ¶ã€‚è®°ä½æ˜¯æœ‰å¯èƒ½ï¼Œè€Œä¸æ˜¯ä¸€å®šã€‚</p><ul><li>äº§ç”ŸåŸå› </li></ul><p> fail-fast äº§ç”Ÿçš„åŸå› å°±åœ¨äºç¨‹åºåœ¨å¯¹ collection è¿›è¡Œè¿­ä»£æ—¶ï¼ŒæŸä¸ªçº¿ç¨‹å¯¹è¯¥ collection åœ¨ç»“æ„ä¸Šå¯¹å…¶åšäº†ä¿®æ”¹ï¼Œè¿™æ—¶è¿­ä»£å™¨å°±ä¼šæŠ›å‡º <code>ConcurrentModificationException</code> å¼‚å¸¸ä¿¡æ¯ï¼Œä»è€Œäº§ç”Ÿ fail-fastã€‚</p><p>ä½ å¯ä»¥è‡ªå·±ç¿»ç¿»çœ‹<code>ArrayList</code>çš„æºä»£ç ï¼Œå‘ç°æœ‰å¦‚ä¸‹åˆ¤æ–­ï¼š</p><p><code>modCount != expectedModCount</code> ï¼Œå°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚</p><p>ä¸‹é¢æ˜¯<code>ArrayList</code>çš„è¿­ä»£å™¨ç¤ºä¾‹ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">Itr</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> cursor<span class="token punctuation">;</span>            <span class="token keyword">int</span> lastRet <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> expectedModCount <span class="token operator">=</span> <span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>modCount<span class="token punctuation">;</span><span class="token comment">//ä¼ è¿›æ¥æ—¶æ˜¯å¤–éƒ¨çš„modCountï¼Œarraylistçš„å®é™…å¤§å°</span>            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cursor <span class="token operator">!=</span> <span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">/** çœç•¥æ­¤å¤„ä»£ç  */</span>            <span class="token punctuation">}</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastRet <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">/** çœç•¥æ­¤å¤„ä»£ç  */</span>            <span class="token punctuation">}</span>            <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>modCount <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expectedModCount<span class="token punctuation">)</span>                    <span class="token keyword">return</span><span class="token punctuation">;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>int expectedModCount = ArrayList.this.modCount;</code>æ‰€ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•åå®ƒçš„å€¼æ˜¯ä¸å¯èƒ½ä¼šä¿®æ”¹çš„ï¼Œæ‰€ä»¥ä¼šå˜çš„å°±æ˜¯ <code>modCount</code>ã€‚<code>modCount</code> æ˜¯åœ¨ AbstractList ä¸­å®šä¹‰çš„ï¼Œä¸ºå…¨å±€å˜é‡ï¼Œè®°å½•é›†åˆçš„å®é™…å¤§å°ã€‚</p><p><code>ArrayList</code> ä¸­æ— è®º<code> addã€removeã€clear</code> æ–¹æ³•åªè¦æ˜¯æ¶‰åŠäº†æ”¹å˜<code>ArrayList</code>å…ƒç´ çš„ä¸ªæ•°çš„æ–¹æ³•éƒ½ä¼šå¯¼è‡´ <code>modCount </code>çš„æ”¹å˜ã€‚</p><p>ä¸¤ä¸ªçº¿ç¨‹ï¼ˆçº¿ç¨‹ Aï¼Œçº¿ç¨‹ Bï¼‰ï¼Œå…¶ä¸­çº¿ç¨‹ A è´Ÿè´£éå† listã€çº¿ç¨‹Bä¿®æ”¹ listã€‚çº¿ç¨‹ A åœ¨éå† list è¿‡ç¨‹çš„æŸä¸ªæ—¶å€™ï¼ˆæ­¤æ—¶ <code>expectedModCount = modCount=N</code>ï¼‰ï¼Œçº¿ç¨‹å¯åŠ¨ï¼ŒåŒæ—¶çº¿ç¨‹Bå¢åŠ ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ˜¯ modCount çš„å€¼å‘ç”Ÿæ”¹å˜ï¼ˆ<code>modCount + 1 = N + 1</code>ï¼‰ã€‚çº¿ç¨‹ A ç»§ç»­éå†æ‰§è¡Œ next æ–¹æ³•æ—¶ï¼Œé€šå‘Š <code>checkForComodification</code> æ–¹æ³•å‘ç° <code>expectedModCount = N </code>ï¼Œè€Œ <code>modCount = N + 1</code>ï¼Œä¸¤è€…ä¸ç­‰ï¼Œè¿™æ—¶å°±æŠ›å‡º<code>ConcurrentModificationException</code> å¼‚å¸¸ï¼Œä»è€Œäº§ç”Ÿ fail-fast æœºåˆ¶ã€‚</p><h3 id="lt-finalå…³é”®å­—ä¿®é¥°ä¸€ä¸ªå˜é‡"><a href="#lt-finalå…³é”®å­—ä¿®é¥°ä¸€ä¸ªå˜é‡" class="headerlink" title="< finalå…³é”®å­—ä¿®é¥°ä¸€ä¸ªå˜é‡"></a><font color="green">&lt; finalå…³é”®å­—ä¿®é¥°ä¸€ä¸ªå˜é‡</font></h3><p>finalå…³é”®å­—ä¿®é¥°ä¸€ä¸ªå˜é‡æ˜¯å¼•ç”¨ä¸èƒ½å˜ï¼Œè¿˜æ˜¯å¼•ç”¨çš„å¯¹è±¡ä¸èƒ½å˜ï¼Ÿ</p><p><strong>å¼•ç”¨ä¸èƒ½å˜ï¼Œå¯¹è±¡å†…å®¹å¯ä»¥å˜ã€‚</strong></p><h3 id="lt-finallyå…³é”®å­—"><a href="#lt-finallyå…³é”®å­—" class="headerlink" title="<finallyå…³é”®å­—"></a><font color="green">&lt;finallyå…³é”®å­—</font></h3><p>final : ä¿®é¥°ç±»æ—¶ï¼Œä¸èƒ½è¢«ç»§æ‰¿ã€‚</p><p>â€‹            ä¿®é¥°æ–¹æ³•æ—¶ï¼Œä¸èƒ½è¢«é‡å†™ã€‚</p><p>â€‹            ä¿®é¥°å˜é‡æ—¶ï¼Œåªèƒ½èµ‹å€¼ä¸€æ¬¡ã€‚</p><p>finally:æ˜¯tryè¯­å¥ä¸­çš„ä¸€ä¸ªè¯­å¥ä½“ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œç”¨æ¥é‡Šæ”¾èµ„æºã€‚</p><p>finalize:æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå½“åƒåœ¾å›æ”¶å™¨ç¡®å®šä¸å­˜åœ¨è¯¥å¯¹è±¡çš„æ›´å¤šå¼•ç”¨æ—¶ï¼Œç”±å¯¹è±¡çš„åƒåœ¾å›æ”¶å™¨è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p><p>finallyæ˜¯åœ¨<code>return</code>è¯­å¥ä¹‹åæ‰§è¡Œã€‚å¦‚æœcatché‡Œé¢æœ‰returnè¯­å¥ï¼Œæ­¤æ—¶ä¼šå…ˆæ‰§è¡Œreturnå°†è¿”å›å€¼æ‰“åŒ…å¹¶åˆ›å»ºä¸€ä¸ªè¿”å›è·¯å¾„ç­‰å¾…ï¼Œæ¥ç€å¾€ä¸‹æœå¯»æœ‰æ²¡æœ‰finallyè¯­å¥ï¼Œå¦‚æœæœ‰åˆ™éœ€å…ˆæ‰§è¡Œfinallyè¯­å¥ï¼Œå†æ ¹æ®åˆ›å»ºå¥½çš„è¿”å›è·¯å¾„è¿”å›ã€‚</p><p><font color="red">åŒ¿åå†…éƒ¨ç±»å‚æ•°å¿…é¡»æ˜¯finalçš„ã€‚è¿™æ˜¯å› ä¸ºå®ä¾‹å˜é‡æ˜¯åœ¨å †ä¸­çš„ï¼Œå±€éƒ¨å˜é‡åœ¨æ ˆä¸­ï¼ŒLambdaè¡¨è¾¾å¼ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœåœ¨çº¿ç¨‹ä¸­è¦è®¿é—®ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå¯èƒ½çº¿ç¨‹æ‰§è¡Œæ—¶è¯¥å±€éƒ¨å˜é‡è¢«é”€æ¯äº†ï¼Œè€Œfinalç±»å‹çš„å±€éƒ¨å˜é‡åœ¨Lamdaè¡¨è¾¾å¼ä¸­å…¶å®æ˜¯ä¸€ä¸ªæ‹·è´ã€‚</font></p><h3 id="lt-æ¥å£å’ŒæŠ½è±¡ç±»"><a href="#lt-æ¥å£å’ŒæŠ½è±¡ç±»" class="headerlink" title="< æ¥å£å’ŒæŠ½è±¡ç±»"></a><font color="green">&lt; æ¥å£å’ŒæŠ½è±¡ç±»</font></h3><p>æ¥å£æ˜¯å¦å¯ç»§æ‰¿æ¥å£?æŠ½è±¡ç±»æ˜¯å¦å¯å®ç°(implements)æ¥å£?æŠ½è±¡ç±»æ˜¯å¦å¯ç»§æ‰¿å…·ä½“ç±»(concreteclass)?æŠ½è±¡ç±»ä¸­æ˜¯å¦å¯ä»¥æœ‰é™æ€çš„mainæ–¹æ³•ï¼Ÿ</p><p>æ¥å£å¯ä»¥ç»§æ‰¿æ¥å£ã€‚æŠ½è±¡ç±»å¯ä»¥å®ç°(implements)æ¥å£ï¼ŒæŠ½è±¡ç±»å¯ä»¥ç»§æ‰¿å…·ä½“ç±»ã€‚æŠ½è±¡ç±»ä¸­å¯ä»¥æœ‰é™æ€çš„mainæ–¹æ³•ã€‚</p><p>å¤‡æ³¨ï¼šåªè¦æ˜ç™½äº†æ¥å£å’ŒæŠ½è±¡ç±»çš„æœ¬è´¨å’Œä½œç”¨ï¼Œè¿™äº›é—®é¢˜éƒ½å¾ˆå¥½å›ç­”ï¼Œä½ æƒ³æƒ³ï¼Œå¦‚æœä½ æ˜¯javaè¯­è¨€çš„è®¾è®¡è€…ï¼Œä½ æ˜¯å¦ä¼šæä¾›è¿™æ ·çš„æ”¯æŒï¼Œå¦‚æœä¸æä¾›çš„è¯ï¼Œæœ‰ä»€ä¹ˆç†ç”±å—ï¼Ÿå¦‚æœä½ æ²¡æœ‰é“ç†ä¸æä¾›ï¼Œé‚£ç­”æ¡ˆå°±æ˜¯è‚¯å®šçš„äº†ã€‚</p><p>åªè¦è®°ä½æŠ½è±¡ç±»ä¸æ™®é€šç±»çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ä¸èƒ½åˆ›å»ºå®ä¾‹å¯¹è±¡å’Œå…è®¸æœ‰abstractæ–¹æ³•ã€‚</p><p>æŠ½è±¡ç±»å’Œæ¥å£ä¸­éƒ½å¯ä»¥åŒ…å«é™æ€æˆå‘˜å˜é‡ï¼ŒæŠ½è±¡ç±»ä¸­çš„é™æ€æˆå‘˜å˜é‡çš„è®¿é—®ç±»å‹å¯ä»¥ä»»æ„ï¼Œä½†æ¥å£ä¸­å®šä¹‰çš„å˜é‡åªèƒ½æ˜¯<code>public static final</code>ç±»å‹ï¼Œå¹¶ä¸”é»˜è®¤å³ä¸º<code>public static final</code>ç±»å‹ã€‚</p><p><font color="red">æ¥å£å¼ºè°ƒç‰¹å®šåŠŸèƒ½çš„å®ç°ï¼Œè€ŒæŠ½è±¡ç±»å¼ºè°ƒæ‰€å±å…³ç³»ã€‚</font></p><h3 id="lt-8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± "><a href="#lt-8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± " class="headerlink" title="< 8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± "></a><font color="green">&lt; 8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± </font></h3><ul><li>Java åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»é™¤äº†Floatå’ŒDoubleï¼Œå³Byte,Short,Integer,Long,Characterï¼›è¿™å‡ ç§åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼**[-128ï¼Œ127]<strong>çš„ç›¸åº”ç±»å‹çš„</strong>ç¼“å­˜**æ•°æ®ï¼Œä½†æ˜¯è¶…å‡ºæ­¤èŒƒå›´ä»ç„¶ä¼šå»åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span><span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡ºtrue</span><span class="token class-name">Integer</span> i11 <span class="token operator">=</span> <span class="token number">333</span><span class="token punctuation">;</span><span class="token class-name">Integer</span> i22 <span class="token operator">=</span> <span class="token number">333</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i11 <span class="token operator">==</span> i22<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡ºfalse å› ä¸ºä¸¤ä¸ªå¯¹è±¡æ¯”è¾ƒ</span><span class="token class-name">Double</span> i3 <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span><span class="token class-name">Double</span> i4 <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i3 <span class="token operator">==</span> i4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡ºfalse</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Integer æºä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/***å§‹ç»ˆç¼“å­˜-128åˆ°127ï¼ˆåŒ…æ‹¬ç«¯ç‚¹ï¼‰èŒƒå›´å†…çš„å€¼ï¼Œå…¶ä»–å€¼æ˜¯åˆ›å»ºçš„å¯¹è±¡ã€‚*/</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Integer i1=40ï¼›Java åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç›´æ¥å°†ä»£ç å°è£…æˆInteger i1=Integer.valueOf(40);ï¼Œä»è€Œä½¿ç”¨å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚</p><p>Integer i1 = new Integer(40);è¿™ç§æƒ…å†µä¸‹ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p><p><strong>JAVA8çš„ConcurrentHashMapä¸ºä»€ä¹ˆæ”¾å¼ƒäº†åˆ†æ®µé”ï¼Ÿ</strong></p><p>åŸå› ï¼šé€šè¿‡ JDK çš„æºç å’Œå®˜æ–¹æ–‡æ¡£çœ‹æ¥ï¼Œ ä»–ä»¬è®¤ä¸ºçš„å¼ƒç”¨åˆ†æ®µé”çš„åŸå› ç”±ä»¥ä¸‹å‡ ç‚¹ï¼š 1ã€åŠ å…¥å¤šä¸ªåˆ†æ®µé”æµªè´¹å†…å­˜ç©ºé—´ã€‚ 2ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ map åœ¨æ”¾å…¥æ—¶ç«äº‰åŒä¸€ä¸ªé”çš„æ¦‚ç‡éå¸¸å°ï¼Œåˆ†æ®µé”åè€Œä¼šé€ æˆæ›´æ–°ç­‰æ“ä½œçš„é•¿æ—¶é—´ç­‰å¾…ã€‚ 3ã€ä¸ºäº†æé«˜ GC çš„æ•ˆç‡</p><p>æ—¢ç„¶å¼ƒç”¨äº†åˆ†æ®µé”ï¼Œ é‚£ä¹ˆä¸€å®šç”±æ–°çš„çº¿ç¨‹å®‰å…¨æ–¹æ¡ˆï¼Œ æˆ‘ä»¬æ¥çœ‹çœ‹æºç æ˜¯æ€ä¹ˆè§£å†³çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼ŸCAS</p><p>é¦–å…ˆé€šè¿‡ hash æ‰¾åˆ°å¯¹åº”é“¾è¡¨è¿‡åï¼Œ æŸ¥çœ‹æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªobjectï¼Œ å¦‚æœæ˜¯ï¼Œ ç›´æ¥ç”¨casåŸåˆ™æ’å…¥ï¼Œæ— éœ€åŠ é”ï¼Œç„¶åå¦‚æœä¸æ˜¯é“¾è¡¨ç¬¬ä¸€ä¸ªobjectï¼Œ åˆ™ç›´æ¥ç”¨é“¾è¡¨ç¬¬ä¸€ä¸ªobjectåŠ é”ï¼Œè¿™é‡ŒåŠ çš„é”æ˜¯synchronizedï¼Œè™½ç„¶æ•ˆç‡ä¸å¦‚ ReentrantLockï¼Œ ä½†èŠ‚çº¦äº†ç©ºé—´ï¼Œè¿™é‡Œä¼šä¸€ç›´ç”¨ç¬¬ä¸€ä¸ªobjectä¸ºé”ï¼Œ ç›´åˆ°é‡æ–°è®¡ç®—mapå¤§å°ï¼Œ æ¯”å¦‚æ‰©å®¹æˆ–è€…æ“ä½œäº†ç¬¬ä¸€ä¸ªobjectä¸ºæ­¢ã€‚</p><p><a href="https://blog.csdn.net/ddxd0406/article/details/81389583">https://blog.csdn.net/ddxd0406/article/details/81389583</a></p><p><a href="https://www.cnblogs.com/nullzx/p/8647220.html">https://www.cnblogs.com/nullzx/p/8647220.html</a></p><h3 id="lt-é™æ€ä»£ç å—ã€æ„é€ ä»£ç å—ã€æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåº"><a href="#lt-é™æ€ä»£ç å—ã€æ„é€ ä»£ç å—ã€æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåº" class="headerlink" title="< é™æ€ä»£ç å—ã€æ„é€ ä»£ç å—ã€æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåº"></a><font color="green">&lt; é™æ€ä»£ç å—ã€æ„é€ ä»£ç å—ã€æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåº</font></h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>        <span class="token comment">/**         * æ„é€ ä»£ç          */</span>        <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œæ„é€ ä»£ç å—..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">/**         * æ— å‚æ„é€ å‡½æ•°         */</span>        <span class="token keyword">public</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œæ— å‚æ„é€ å‡½æ•°..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">/**         * æœ‰å‚æ„é€ å‡½æ•°         * @param id  id         */</span>        <span class="token keyword">public</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œæœ‰å‚æ„é€ å‡½æ•°..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ç±»ï¼Œè¯¥ç±»åŒ…å«æ— å‚æ„é€ å‡½æ•°ã€æœ‰å‚æ„é€ å‡½æ•°ä»¥åŠæ„é€ ä»£ç å—ï¼ŒåŒæ—¶åœ¨ä¸Šé¢ä¹Ÿæè¿‡ä»£ç å—æ˜¯æ²¡æœ‰ç‹¬ç«‹è¿è¡Œçš„èƒ½åŠ›ï¼Œä»–å¿…é¡»è¦æœ‰ä¸€ä¸ªå¯ä»¥æ‰¿è½½çš„è½½ä½“ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šå¦‚ä½•æ¥å¤„ç†æ„é€ ä»£ç å—å‘¢ï¼Ÿç¼–è¯‘å™¨ä¼šå°†ä»£ç å—<strong>æŒ‰ç…§ä»–ä»¬çš„é¡ºåº(å‡å¦‚æœ‰å¤šä¸ªä»£ç å—)æ’å…¥åˆ°æ‰€æœ‰çš„æ„é€ å‡½æ•°çš„æœ€å‰ç«¯</strong>ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä¸ç®¡è°ƒç”¨å“ªä¸ªæ„é€ å‡½æ•°éƒ½ä¼šæ‰§è¡Œæ‰€æœ‰çš„æ„é€ ä»£ç å—ã€‚</p><p>é™æ€ä»£ç å—ï¼Œé™æ€ï¼Œå…¶ä½œç”¨çº§åˆ«ä¸ºç±»ï¼Œæ„é€ ä»£ç å—ã€æ„é€ å‡½æ•°ï¼Œæ„é€ ï¼Œå…¶ä½œç”¨çº§åˆ«ä¸ºå¯¹è±¡ã€‚</p><p>1ã€é™æ€ä»£ç å—ï¼Œå®ƒæ˜¯éšç€ç±»çš„åŠ è½½è€Œè¢«æ‰§è¡Œï¼Œåªè¦ç±»è¢«åŠ è½½äº†å°±ä¼šæ‰§è¡Œï¼Œè€Œä¸”åªä¼šåŠ è½½ä¸€æ¬¡ï¼Œä¸»è¦ç”¨äºç»™ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>2ã€æ„é€ ä»£ç å—ï¼Œæ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¸”ä¼˜å…ˆäºæ„é€ å‡½æ•°ï¼Œä¸»è¦ç”¨äºåˆå§‹åŒ–ä¸åŒå¯¹è±¡å…±æ€§çš„åˆå§‹åŒ–å†…å®¹å’Œåˆå§‹åŒ–å®ä¾‹ç¯å¢ƒã€‚</p><p>3ã€æ„é€ å‡½æ•°ï¼Œæ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶å°±ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚åŒæ—¶æ„é€ å‡½æ•°æ˜¯ç»™ç‰¹å®šå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œæ„é€ ä»£ç æ˜¯ç»™æ‰€æœ‰å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œä½œç”¨åŒºåŸŸä¸åŒã€‚</p><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œä»–ä»¬ä¸‰è€…çš„æ‰§è¡Œé¡ºåºåº”è¯¥ä¸ºï¼šé™æ€ä»£ç å— &gt; æ„é€ ä»£ç å— &gt; æ„é€ å‡½æ•°ã€‚</p><h3 id="java-åå°„"><a href="#java-åå°„" class="headerlink" title="java åå°„"></a><font color="green">java åå°„</font></h3><ul><li>æ¦‚å¿µ</li></ul><p>ç¨‹åºåœ¨è¿è¡Œæ—¶å¯ä»¥è·å–æŸä¸ªç±»çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><ul><li>ä¼˜ç‚¹</li></ul><p>é™æ€ç¼–è¯‘ï¼šåœ¨ç¼–è¯‘æ—¶ç¡®å®šç±»å‹ï¼Œç»‘å®šå¯¹è±¡ï¼Œå³é€šè¿‡ã€‚</p><p>åŠ¨æ€ç¼–è¯‘ï¼šåœ¨è¿è¡Œæ—¶ç¡®å®šç±»å‹ï¼Œç»‘å®šå¯¹è±¡ã€‚åŠ¨æ€ç¼–è¯‘æœ€å¤§é™åº¦å‘æŒ¥äº†javaçš„çµæ´»æ€§ï¼Œä½“ç°äº†å¤šæ€çš„åº”ç”¨ï¼Œé™ä½ç±»ä¹‹é—´çš„è€¦åˆæ€§ã€‚</p><p>ï¼ˆä¸»è¦æ˜¯ä½“ç°äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼‰</p><ul><li>ç¼ºç‚¹</li></ul><p>åå°„æ˜¯ä¸€ç§è§£é‡Šæ“ä½œï¼Œæˆ‘ä»¬å‘Šè¯‰JVMæŸä¸ªç±»è¦åšä»€ä¹ˆï¼Œè¿™ç§æ–¹å¼æ…¢äºç›´æ¥æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚</p><ul><li>ä¸‰ç§åˆ›å»ºæ–¹å¼</li></ul><ol><li>Class.forName()</li><li>.class</li><li>.getClass();</li></ol><ul><li>å’Œnewçš„åŒºåˆ«</li></ul><ol><li><p>newå‡ºæ¥çš„å¯¹è±¡æ— æ³•è®¿é—®å…¶ç§æœ‰å±æ€§ï¼Œä½†åå°„å¯ä»¥é€šè¿‡è®¾ç½®<code>setAccessible()</code>æ–¹æ³•è®¿é—®ç§æœ‰å±æ€§ã€‚</p></li><li><p>ä½¿ç”¨newåˆ›å»ºå®ä¾‹å¿…é¡»çŸ¥é“ç±»åï¼Œä½†æ˜¯åå°„æœºåˆ¶åˆ›å»ºå¯¹è±¡ä¸çŸ¥é“ç±»åä¹Ÿå¯ã€‚ï¼ˆæ¯”å¦‚è¯´æŸä¸ªå˜é‡varå·²ç»å®šä¹‰å¥½äº† var.class ä½ å°±å¯ä»¥è·å¾—å…¶ç±»åæ˜¯å•¥äº†,ç„¶åä½ å†è°ƒç”¨<code>newInstance()</code>ï¼‰ã€‚</p></li></ol><h3 id="lt-switchè¯­å¥èƒ½å¦ä½œç”¨åœ¨byteä¸Šï¼Œèƒ½å¦ä½œç”¨åœ¨longä¸Šï¼Œèƒ½å¦ä½œç”¨åœ¨Stringä¸Š"><a href="#lt-switchè¯­å¥èƒ½å¦ä½œç”¨åœ¨byteä¸Šï¼Œèƒ½å¦ä½œç”¨åœ¨longä¸Šï¼Œèƒ½å¦ä½œç”¨åœ¨Stringä¸Š" class="headerlink" title="< switchè¯­å¥èƒ½å¦ä½œç”¨åœ¨byteä¸Šï¼Œèƒ½å¦ä½œç”¨åœ¨longä¸Šï¼Œèƒ½å¦ä½œç”¨åœ¨Stringä¸Š?"></a><font color="green">&lt; switchè¯­å¥èƒ½å¦ä½œç”¨åœ¨byteä¸Šï¼Œèƒ½å¦ä½œç”¨åœ¨longä¸Šï¼Œèƒ½å¦ä½œç”¨åœ¨Stringä¸Š?</font></h3><p>åœ¨switchï¼ˆeï¼‰ä¸­ï¼Œeåªèƒ½æ˜¯ä¸€ä¸ªæ•´æ•°è¡¨è¾¾å¼æˆ–è€…æšä¸¾å¸¸é‡ï¼ˆæ›´å¤§å­—ä½“ï¼‰ï¼Œæ•´æ•°è¡¨è¾¾å¼å¯ä»¥æ˜¯intåŸºæœ¬ç±»å‹æˆ–IntegeråŒ…è£…ç±»å‹ï¼Œç”±äºbyte,short,charéƒ½å¯ä»¥éšå«è½¬æ¢ä¸ºintï¼Œæ‰€ä»¥ï¼Œè¿™äº›ç±»å‹ä»¥åŠè¿™äº›ç±»å‹çš„åŒ…è£…ç±»å‹ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ˜¾ç„¶ï¼Œlongå’ŒStringç±»å‹éƒ½ä¸ç¬¦åˆswitchçš„è¯­æ³•è§„å®šï¼Œå¹¶ä¸”ä¸èƒ½è¢«éšå¼è½¬æ¢æˆintç±»å‹ï¼Œæ‰€ä»¥ï¼Œå®ƒä»¬ä¸èƒ½ä½œç”¨äºswtichè¯­å¥ä¸­ã€‚</p><p><em>switchè¯­å¥èƒ½å¦ä½œç”¨åœ¨Stringä¸Šè¯´é”™äº†ï¼ŒJava1.7ä¹‹åå·²ç»æ”¯æŒè¿™ç§å†™æ³•äº†ï¼</em></p><h3 id="lt-a-hashCode-æœ‰ä»€ä¹ˆç”¨ï¼Ÿä¸-a-equals-b-æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#lt-a-hashCode-æœ‰ä»€ä¹ˆç”¨ï¼Ÿä¸-a-equals-b-æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="<&nbsp;**a.hashCode() æœ‰ä»€ä¹ˆç”¨ï¼Ÿä¸ a.equals(b) æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ**"></a><font color="green">&lt;&nbsp;**a.hashCode() æœ‰ä»€ä¹ˆç”¨ï¼Ÿä¸ a.equals(b) æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ**</font></h3><p>hashCode() æ–¹æ³•å¯¹åº”å¯¹è±¡æ•´å‹çš„ hash å€¼ã€‚å®ƒå¸¸ç”¨äºåŸºäº hash çš„é›†åˆç±»ï¼Œå¦‚ Hashtableã€HashMapã€LinkedHashMapç­‰ç­‰ã€‚å®ƒä¸ equals() æ–¹æ³•å…³ç³»ç‰¹åˆ«ç´§å¯†ã€‚æ ¹æ® Java è§„èŒƒï¼Œä¸¤ä¸ªä½¿ç”¨ equal() æ–¹æ³•æ¥åˆ¤æ–­ç›¸ç­‰çš„å¯¹è±¡ï¼Œå¿…é¡»å…·æœ‰ç›¸åŒçš„ hash codeã€‚</p><h3 id="3-å¤šçº¿ç¨‹"><a href="#3-å¤šçº¿ç¨‹" class="headerlink" title=" 3. å¤šçº¿ç¨‹"></a><font color="green"> 3. å¤šçº¿ç¨‹</font></h3><h3 id="gt-notifyå’Œwait"><a href="#gt-notifyå’Œwait" class="headerlink" title=">notifyå’Œwait"></a>&gt;notifyå’Œwait</h3><ol><li><p>è¿™ä¸¤ä¸ªçš„ä½¿ç”¨å¿…é¡»æ”¾åˆ°åŒä¸€ä¸ªä»£ç å—é‡Œé¢ï¼Œå¦åˆ™ä¼šæŠ¥IllegalMonitorStateExceptionå¼‚å¸¸ï¼Œå› ä¸ºå®ƒåº•å±‚æ˜¯æ ¹æ®monitorè¿›è¡Œåˆ¤æ–­çš„ã€‚</p></li><li><p>notifyä¸èƒ½æ”¾åœ¨waitï¼Œå¦åˆ™è°ƒç”¨waitçš„æ–¹æ³•ä¼šä¸åœçš„é˜»å¡ã€‚</p></li></ol><p>awaitå’Œnotifyæ–¹æ³•åŒç†</p><p>æ‰€ä»¥ï¼Œè¿™ä¸­é”çš„ç­‰å¾…å”¤é†’æœºåˆ¶ä¼šæœ‰é—®é¢˜ã€‚å‘æ˜äº†LockSupportç±»ã€‚</p><h3 id="gt-LockSupportç±»"><a href="#gt-LockSupportç±»" class="headerlink" title="> LockSupportç±»"></a>&gt; LockSupportç±»</h3><p>ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¡åŸè¯­ã€‚</p><p>ä¸»è¦æ˜¯park()å’Œunpart()æ–¹æ³•ã€‚</p><p>é˜»å¡ï¼šparkï¼ˆï¼‰</p><p>åº•å±‚æ˜¯UNSAFEç±»ã€‚å°†å½“å‰çš„permitè®¾ç½®ä¸º0ã€‚ç›´åˆ°åˆ«çš„çº¿ç¨‹å°†å½“å‰çº¿ç¨‹çš„permitè®¾ç½®ä¸º1ã€‚</p><p>å”¤é†’ï¼šunparkï¼ˆï¼‰</p><p>åº•å±‚æ˜¯UNSAFEç±»ã€‚å‘æ”¾è®¸å¯è¯ã€‚</p><p>unparkå¯ä»¥åœ¨parkä¹‹å‰æ‰§è¡Œï¼Œunparkä¹‹åï¼Œparkä¼šå¤±å»ä½œç”¨ï¼Œç›´æ¥ç»•è¿‡æ‰§è¡Œï¼Œå› ä¸ºæœ‰äº†è®¸å¯è¯ã€‚permitè®¸å¯è¯æ˜¯ä¸å¯ä»¥ç´¯è®¡çš„ï¼ŒThere is at most one.</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><p>LockSupport.park();</p><p>LockSupport.unpark(threadname);</p><h3 id="gt-volatileå…³é”®å­—"><a href="#gt-volatileå…³é”®å­—" class="headerlink" title="> volatileå…³é”®å­—"></a><font color="green">&gt; volatileå…³é”®å­—</font></h3><p>MESIç¼“å­˜ä¸€è‡´æ€§åè®®ã€‚</p><p>å¤šCPUä»ä¸»å­˜è¯»å–åŒä¸€æ•°æ®åˆ°å„è‡ªç¼“å­˜åŒºä¸­ï¼Œè¯¥æ•°æ®åœ¨lockå‰ç¼€æŒ‡ä»¤æ‰§è¡ŒæœŸé—´å·²ç»åœ¨å¤„ç†å™¨å†…å­˜çš„ç¼“å­˜ä¸­è¢«é”å®šï¼Œç¼“å­˜è¢«é”å®šæœŸé—´å…¶ä»–CPUæ— æ³•è¯»å†™è¯¥æ•°æ®ï¼Œç›´åˆ°è¯¥ç¼“å­˜æ•°æ®è¢«ä¿®æ”¹åŒæ­¥å›ä¸»å­˜åï¼Œå…¶ä»–CPUé€šè¿‡æ€»çº¿å—…æ¢æœºåˆ¶æ„ŸçŸ¥æ•°æ®å˜åŒ–åŠæ—¶å¤±æ•ˆè‡ªå·±ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œåœ¨ä¸‹ä¸€è½®æŒ‡ä»¤å‘¨æœŸä»ä¸»å­˜é‡æ–°loadæ•°æ®ã€‚</p><p>ç¼“å­˜ä¸€è‡´æ€§åè®®,ä¹Ÿå°±æ˜¯è¯´çš„MESIï¼Œç›®å‰å¤§å¤šæ•°cpuå°±æ˜¯é‡‡ç”¨çš„ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œäºæ˜¯å°±</p><p>æœ‰äº†ä»¥ä¸‹çš„æ¶æ„ã€‚</p><pre><code>M:ä¿®æ”¹ï¼Œè¯¥cache lineæœ‰æ•ˆï¼Œæ•°æ®è¢«ä¿®æ”¹äº†ï¼Œå’Œå†…å­˜ä¸­çš„æ•°æ®ä¸ä¸€æ ·ï¼Œæ•°æ®åªå­˜åœ¨äºæœ¬cacheä¸­E:ç‹¬äº«ã€äº’æ–¥ï¼Œè¯¥cache lineæœ‰æ•ˆï¼Œæ•°æ®å’Œå†…å­˜ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œæ•°æ®åªå­˜åœ¨äºæœ¬cacheä¸­'S:å…±äº«ï¼Œè¯¥cache lineæœ‰æ•ˆï¼Œæ•°æ®å’Œå†…å­˜ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œæ•°æ®å­˜åœ¨äºå¾ˆå¤šcacheä¸­I:æ— æ•ˆï¼Œè¯¥cacheæ— æ•ˆã€‚</code></pre><p>MESIæ˜¯æ€ä¹ˆä¿è¯ç¼“å­˜ä¸€ç›´æ€§çš„å‘¢ï¼Ÿä¸¾ä¸ªæ —å­ï¼š</p><pre><code>å‡è®¾ä¸»å†…å­˜ä¸­æœ‰ä¸€ä¸ªå˜é‡x=1ï¼Œå½“cpu1è¯»å–äº†ä¹‹åï¼Œcpu1ä¸­å°±ä¼šæœ‰ç¼“å­˜å˜é‡x(E)å°±ä¼šæœ‰ä¸€ä¸ªæ—¶åˆ»ç›‘å¬(æ€»çº¿å—…æ¢æœºåˆ¶)å»ç›‘å¬ä¸»å†…å­˜ï¼Œ,è¿™æ—¶å€™ï¼ŒåŠ å…¥cpu2ä¹Ÿè¯»å–äº†ï¼Œé‚£ä¹ˆcpu1ä¸­å°±ä¼šå˜æˆx(S),è€Œcpu2ä¸­ä¹Ÿä¼šå­˜åœ¨x(S)ï¼Œcpu2ä¹Ÿä¼šå¯¹ä¸»å†…å­˜ç›‘å¬ï¼Œè¿™æ—¶å€™ï¼Œå½“cpu1å¯¹xåšäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆcpu1ä¸­å°±å˜æˆäº†X(M),å½“cpué€šçŸ¥äº†ä¸»å†…å­˜ä¹‹åï¼Œcpu1ä¸­å°±å˜æˆäº†X(E),è€Œcpu2ä¸­åˆ™å˜æˆäº†X(I),äºæ˜¯cpu2ä¸­çš„xå°±è¢«æŠ›å¼ƒï¼Œè¿™æ—¶å€™ä¼šé‡æ–°è·å–ï¼Œé‡æ–°è·å–ä¹‹åï¼Œcpu1å’Œ2ä¸­éƒ½ä¼šå˜æˆX(S)ã€‚</code></pre><p>é‚£ä¹ˆå‡å¦‚ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹äº†Xï¼Œæ€ä¹ˆåŠï¼Ÿ</p><pre><code>åŠ å…¥åŒæ—¶ä¿®æ”¹ï¼Œå½“åœ¨ä¸€ä¸ªæŒ‡ä»¤å‘¨æœŸå†…ï¼Œä¼šè¿›è¡Œè£å†³ï¼Œè£å†³èƒœåˆ©çš„å°±å¯ä»¥ä¿®æ”¹ï¼Œå¤±è´¥çš„è¯ï¼Œæ€ä¹ˆå¤„ç†çœ‹cpuï¼Œä¸åŒçš„cpuæŒ‡ä»¤ä¸ä¸€æ ·ã€‚å–å†³äºæŒ‡ä»¤(åƒjavaä¸­ï¼Œå°±æœ‰unsafeæ¥å¤„ç†)ã€‚</code></pre><p>ä»ä¸»å†…å­˜ä¸­ï¼Œè¯»å–é”çš„æœ€å°å•ä½æ˜¯ç¼“å­˜è¡Œï¼ŒåŠ å…¥ä¸€ä¸ªæ•°æ®çš„é•¿åº¦å¤§äºä¸€ä¸ªç¼“å­˜è¡Œï¼Œè¿™æ—¶å€™å°±ä¼šå‡ºç°ç¼“å­˜è¡Œå¤±æ•ˆé—®é¢˜ï¼Œå½“ç¼“å­˜è¡Œå¤± æ•ˆï¼Œå°±ä¼šèµ°æ€»çº¿åŠ é”ã€‚</p><p>1.ä¿æŒå¯è§æ€§ã€‚</p><p>å¯è§æ€§æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼ã€‚ï¼ˆå¼ºåˆ¶é‡è¯»ï¼‰</p><p>å¯è§æ€§ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚çº¿ç¨‹å®‰å…¨çš„ä¸‰ä¸ªæ¡ä»¶ï¼šåŸå­æ€§ã€å¯è§æ€§ã€ç¦æ­¢é‡æ’åºã€‚ä¸‰è€…çš„è§£é‡Šå¯å‚è€ƒ<a href="https://www.cnblogs.com/dolphin0520/p/3920373.html">https://www.cnblogs.com/dolphin0520/p/3920373.html</a></p><p>2.ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚</p><pre class="line-numbers language-none"><code class="language-none">x = 10;         //è¯­å¥1y = x;         //è¯­å¥2x++;           //è¯­å¥3x = x + 1;     //è¯­å¥4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè¯­å¥3æ˜¯å¸¦æœ‰volatileå…³é”®å­—çš„ï¼Œä½äºè¯­å¥3å‰é¢çš„è¯­å¥ä¸èƒ½é‡æ’åºè‡³å…¶åé¢ï¼Œè¯­å¥3åé¢çš„è¯­å¥ä¸èƒ½é‡æ’åºåˆ°3å‰é¢ã€‚è¯­å¥3å‰é¢çš„è¯­å¥å¯ä»¥éšä¾¿é‡æ’åºï¼Œåªè¦è‡ªå·±ä¸è¦è¶Šè¿‡è¯­å¥3å°±è¡Œã€‚</p><p><strong>ç»å…¸é—®é¢˜</strong>ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> inc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>       <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token keyword">final</span> <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>           <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>               <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>                       test<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token punctuation">}</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       inc<span class="token operator">++</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œç»“æœå°äº10000ã€‚åŸå› ï¼š</p><p>å‡å¦‚æŸä¸ªæ—¶åˆ»å˜é‡incçš„å€¼ä¸º10ï¼Œ</p><p>ã€€ã€€çº¿ç¨‹1å¯¹å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œçº¿ç¨‹1å…ˆè¯»å–äº†å˜é‡incçš„åŸå§‹å€¼ï¼Œçº¿ç¨‹2å¯¹å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œç„¶åçº¿ç¨‹1è¢«é˜»å¡äº†ï¼›</p><p>ã€€ã€€ç”±äºçº¿ç¨‹1åªæ˜¯å¯¹å˜é‡incè¿›è¡Œè¯»å–æ“ä½œï¼Œè€Œæ²¡æœ‰å¯¹å˜é‡è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´çº¿ç¨‹2çš„å·¥ä½œå†…å­˜ä¸­ç¼“å­˜å˜é‡incçš„ç¼“å­˜è¡Œæ— æ•ˆï¼Œæ‰€ä»¥çº¿ç¨‹2ä¼šç›´æ¥å»ä¸»å­˜è¯»å–incçš„å€¼ï¼Œå‘ç°incçš„å€¼æ—¶10ï¼Œç„¶åè¿›è¡ŒåŠ 1æ“ä½œï¼Œå¹¶æŠŠ11å†™å…¥å·¥ä½œå†…å­˜ï¼Œæœ€åå†™å…¥ä¸»å­˜ã€‚</p><pre class="line-numbers language-none"><code class="language-none">i++æ“ä½œå¯ä»¥è¢«æ‹†åˆ†ä¸ºä¸‰æ­¥ï¼š     1ï¼Œçº¿ç¨‹è¯»å–içš„å€¼     2ã€iè¿›è¡Œè‡ªå¢è®¡ç®—     3ã€åˆ·æ–°å›içš„å€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ã€€ã€€ç„¶åçº¿ç¨‹1æ¥ç€è¿›è¡ŒåŠ 1æ“ä½œï¼Œæ³¨æ„æ­¤æ—¶åœ¨çº¿ç¨‹1çš„å·¥ä½œå†…å­˜ä¸­incçš„å€¼æ›´æ–°ä¸º11ï¼ˆvolatileå¼ºåˆ¶é‡è¯»ï¼‰ï¼Œä½†æ˜¯çº¿ç¨‹1ä¹‹å‰å¡åœ¨äº†è‡ªå¢è®¡ç®—ï¼ˆéåŸå­æ€§æ“ä½œï¼Œæ“ä½œçš„è¿˜æ˜¯10è‡ªå¢ï¼‰æ‰€ä»¥çº¿ç¨‹1å¯¹incè¿›è¡ŒåŠ 1æ“ä½œåincçš„å€¼ä¸º11ï¼Œç„¶åå°†11å†™å…¥å·¥ä½œå†…å­˜ï¼ˆ11æ›¿æ¢å¼ºåˆ¶æ›´æ–°çš„11ï¼‰ï¼Œæœ€åå†™å…¥ä¸»å­˜ã€‚</p><p>ã€€ã€€é‚£ä¹ˆä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è¿›è¡Œäº†ä¸€æ¬¡è‡ªå¢æ“ä½œåï¼Œincåªå¢åŠ äº†1ï¼Œç»“æœéƒ½ä¸º11ã€‚</p><ul><li><strong>å•ä¾‹æ¨¡å¼ä¸­çš„volatile</strong> åŒæ£€é”æœºåˆ¶</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DoubleCheckedLocking</span> <span class="token punctuation">{</span> <span class="token comment">// 1</span><span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> instance<span class="token punctuation">;</span> <span class="token comment">// 2</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 3</span><span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 4:ç¬¬ä¸€æ¬¡æ£€æŸ¥</span><span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">DoubleCheckedLocking</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 5:åŠ é”</span><span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 6:ç¬¬äºŒæ¬¡æ£€æŸ¥</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7:é—®é¢˜çš„æ ¹æºå‡ºåœ¨è¿™é‡Œ</span><span class="token punctuation">}</span> <span class="token comment">// 8</span><span class="token punctuation">}</span> <span class="token comment">// 9</span><span class="token keyword">return</span> instance<span class="token punctuation">;</span> <span class="token comment">// 10</span><span class="token punctuation">}</span> <span class="token comment">// 11</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬7è¡Œå®é™…ä¸Šç¼–è¯‘ååˆ†ä¸º3æ­¥ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">memory <span class="token operator">=</span> <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ã€€ã€€<span class="token comment">// 1ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</span><span class="token function">ctorInstance</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token punctuation">;</span>ã€€<span class="token comment">// 2ï¼šåˆå§‹åŒ–å¯¹è±¡</span>instance <span class="token operator">=</span> memory<span class="token punctuation">;</span>ã€€ã€€<span class="token comment">// 3ï¼šè®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç¼–è¯‘æœŸä¼šåšæŒ‡ä»¤é‡æ’åºï¼Œæ‰€ä»¥ä¼šæœ‰ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">memory <span class="token operator">=</span> <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ã€€ã€€<span class="token comment">// 1ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</span>instance <span class="token operator">=</span> memory<span class="token punctuation">;</span>ã€€ã€€<span class="token comment">// 3ï¼šè®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€</span><span class="token comment">// æ³¨æ„ï¼Œæ­¤æ—¶å¯¹è±¡è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼</span><span class="token function">ctorInstance</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token punctuation">;</span>ã€€<span class="token comment">// 2ï¼šåˆå§‹åŒ–å¯¹è±¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å½“Açº¿ç¨‹ä¸Šé¢132çš„é¡ºåºåˆ†é…äº†å¯¹è±¡ï¼Œä½†æ˜¯å½“Aåˆšåˆšæ‰§è¡Œå®Œæ¯•3ï¼ŒBçœ‹åˆ°äº†instanceå·²ç»ä¸ä¸º<code>null</code>ï¼ŒBæ­¤æ—¶è°ƒç”¨äº†ç©ºå¯¹è±¡ï¼Œå‘ç”Ÿ<font color="red">é”™è¯¯</font>ã€‚</p><h3 id="lt-happens-beforeåŸåˆ™"><a href="#lt-happens-beforeåŸåˆ™" class="headerlink" title="< happens-beforeåŸåˆ™"></a><font color="green">&lt; happens-beforeåŸåˆ™</font></h3><ul><li>ç¨‹åºæ¬¡åºæ³•åˆ™ï¼šçº¿ç¨‹ä¸­çš„æ¯ä¸ªåŠ¨ä½œAéƒ½happens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„æ¯ä¸€ä¸ªåŠ¨ä½œBï¼Œå…¶ä¸­ï¼Œåœ¨ç¨‹åºä¸­ï¼Œæ‰€æœ‰çš„åŠ¨ä½œBéƒ½èƒ½å‡ºç°åœ¨Aä¹‹åã€‚</li><li>ç›‘è§†å™¨é”æ³•åˆ™ï¼šå¯¹ä¸€ä¸ªç›‘è§†å™¨é”çš„è§£é” happens-beforeäºæ¯ä¸€ä¸ªåç»­å¯¹åŒä¸€ç›‘è§†å™¨é”çš„åŠ é”ã€‚</li><li>volatileå˜é‡æ³•åˆ™ï¼šå¯¹volatileåŸŸçš„å†™å…¥æ“ä½œhappens-beforeäºæ¯ä¸€ä¸ªåç»­å¯¹åŒä¸€ä¸ªåŸŸçš„è¯»å†™æ“ä½œã€‚</li><li>çº¿ç¨‹å¯åŠ¨æ³•åˆ™ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œå¯¹Thread.startçš„è°ƒç”¨ä¼šhappens-beforeäºæ¯ä¸ªå¯åŠ¨çº¿ç¨‹çš„åŠ¨ä½œã€‚</li><li>çº¿ç¨‹ç»ˆç»“æ³•åˆ™ï¼šçº¿ç¨‹ä¸­çš„ä»»ä½•åŠ¨ä½œéƒ½happens-beforeäºå…¶ä»–çº¿ç¨‹æ£€æµ‹åˆ°è¿™ä¸ªçº¿ç¨‹å·²ç»ç»ˆç»“ã€æˆ–è€…ä»Thread.joinè°ƒç”¨ä¸­æˆåŠŸè¿”å›ï¼Œæˆ–Thread.isAliveè¿”å›falseã€‚</li><li>ä¸­æ–­æ³•åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„interrupt happens-beforeäºè¢«ä¸­æ–­çš„çº¿ç¨‹å‘ç°ä¸­æ–­ã€‚</li><li>ç»ˆç»“æ³•åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„æ„é€ å‡½æ•°çš„ç»“æŸhappens-beforeäºè¿™ä¸ªå¯¹è±¡finalizerçš„å¼€å§‹ã€‚</li><li>ä¼ é€’æ€§ï¼šå¦‚æœA happens-beforeäºBï¼Œä¸”B happens-beforeäºCï¼Œåˆ™A happens-beforeäºC</li></ul><h3 id="lt-JAVA-å¹¶å‘"><a href="#lt-JAVA-å¹¶å‘" class="headerlink" title="< JAVA å¹¶å‘"></a><font color="green">&lt; JAVA å¹¶å‘</font></h3><p>æœ€åˆçš„è®¡ç®—æœºåªèƒ½æ¥å—ä¸€äº›ç‰¹å®šçš„æŒ‡ä»¤ï¼Œç”¨æˆ·æ¯è¾“å…¥ä¸€ä¸ªæŒ‡ä»¤ï¼Œè®¡ç®—æœºå°±åšå‡ºä¸€ä¸ªæ“ä½œã€‚å½“ç”¨æˆ·åœ¨æ€è€ƒæˆ–è€…è¾“å…¥æ—¶ï¼Œè®¡ç®—æœºå°±åœ¨ç­‰å¾…ã€‚è¿™æ ·æ•ˆç‡éå¸¸ä½ä¸‹ï¼Œåœ¨å¾ˆå¤šæ—¶å€™ï¼Œè®¡ç®—æœºéƒ½å¤„åœ¨ç­‰å¾…çŠ¶æ€ã€‚</p><p><strong>æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿ</strong></p><p>åæ¥æœ‰äº†<strong>æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿ</strong>,æŠŠä¸€ç³»åˆ—éœ€è¦æ“ä½œçš„æŒ‡ä»¤å†™ä¸‹æ¥ï¼Œå½¢æˆä¸€ä¸ª<strong>æ¸…å•</strong>ï¼Œä¸€æ¬¡æ€§äº¤ç»™è®¡ç®—æœºã€‚</p><p>æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†è®¡ç®—æœºçš„æ•ˆç‡ï¼Œä½†æ˜¯ç”±äº<strong>æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿçš„æŒ‡ä»¤è¿è¡Œæ–¹å¼ä»ç„¶æ˜¯ä¸²è¡Œçš„ï¼Œå†…å­˜ä¸­å§‹ç»ˆåªæœ‰ä¸€ä¸ªç¨‹åºåœ¨è¿è¡Œ</strong>ï¼Œåé¢çš„ç¨‹åºéœ€è¦ç­‰å¾…å‰é¢çš„ç¨‹åºæ‰§è¡Œå®Œæˆåæ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œè€Œå‰é¢çš„ç¨‹åºæœ‰æ—¶ä¼šç”±äºI/Oæ“ä½œã€ç½‘ç»œç­‰åŸå› é˜»å¡ï¼Œæ‰€ä»¥<strong>æ‰¹å¤„ç†æ“ä½œæ•ˆç‡ä¹Ÿä¸é«˜</strong>ã€‚</p><p><strong>è¿›ç¨‹çš„æå‡º</strong></p><p>æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿçš„ç“¶é¢ˆåœ¨äºå†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªç¨‹åºï¼Œé‚£ä¹ˆå†…å­˜ä¸­èƒ½ä¸èƒ½å­˜åœ¨å¤šä¸ªç¨‹åºå‘¢ï¼Ÿè¿›ç¨‹åº”è¿è€Œç”Ÿã€‚</p><p>è¿›ç¨‹å°±æ˜¯<strong>åº”ç”¨ç¨‹åºåœ¨å†…å­˜ä¸­åˆ†é…çš„ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œçš„ç¨‹åº</strong>ï¼Œå„ä¸ªè¿›ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚åŒæ—¶è¿›ç¨‹ä¿å­˜ç€ç¨‹åºæ¯ä¸€ä¸ªæ—¶åˆ»è¿è¡Œçš„çŠ¶æ€ã€‚</p><blockquote><p>ç¨‹åºï¼šç”¨æŸç§ç¼–ç¨‹è¯­è¨€(javaã€pythonç­‰)ç¼–å†™ï¼Œèƒ½å¤Ÿå®Œæˆä¸€å®šä»»åŠ¡æˆ–è€…åŠŸèƒ½çš„ä»£ç é›†åˆ,æ˜¯æŒ‡ä»¤å’Œæ•°æ®çš„æœ‰åºé›†åˆï¼Œæ˜¯<strong>ä¸€æ®µé™æ€ä»£ç </strong>ã€‚</p></blockquote><p>æ­¤æ—¶ï¼ŒCPUé‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼è¿è¡Œè¿›ç¨‹ï¼šCPUä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ã€‚å¦‚æœåœ¨æ—¶é—´ç‰‡ç»“æŸæ—¶è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œåˆ™æš‚åœè¿™ä¸ªè¿›ç¨‹çš„è¿è¡Œï¼Œå¹¶ä¸”CPUåˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆè¿™ä¸ªè¿‡ç¨‹å«åšä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ã€‚å¦‚æœè¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼Œåˆ™CPUç«‹å³è¿›è¡Œåˆ‡æ¢ï¼Œä¸ç”¨ç­‰å¾…æ—¶é—´ç‰‡ç”¨å®Œã€‚ </p><blockquote><p>å½“è¿›ç¨‹æš‚åœæ—¶ï¼Œå®ƒä¼šä¿å­˜å½“å‰è¿›ç¨‹çš„çŠ¶æ€ï¼ˆè¿›ç¨‹æ ‡è¯†ï¼Œè¿›ç¨‹ä½¿ç”¨çš„èµ„æºç­‰ï¼‰ï¼Œåœ¨ä¸‹ä¸€æ¬¡åˆ‡æ¢å›æ¥æ—¶æ ¹æ®ä¹‹å‰ä¿å­˜çš„çŠ¶æ€è¿›è¡Œæ¢å¤ï¼Œæ¥ç€ç»§ç»­æ‰§è¡Œã€‚</p></blockquote><p>ä½¿ç”¨è¿›ç¨‹+CPUæ—¶é—´ç‰‡è½®è½¬æ–¹å¼çš„æ“ä½œç³»ç»Ÿï¼Œåœ¨å®è§‚ä¸Šçœ‹èµ·æ¥åŒä¸€æ—¶é—´æ®µæ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œ<strong>è¿›ç¨‹è®©æ“ä½œç³»ç»Ÿçš„å¹¶å‘æˆä¸ºäº†å¯èƒ½</strong>ã€‚è™½ç„¶å¹¶å‘ä»å®è§‚ä¸Šçœ‹æœ‰å¤šä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œä½†åœ¨äº‹å®ä¸Šï¼Œå¯¹äº<strong>å•æ ¸CPU</strong>æ¥è¯´ï¼Œä»»æ„å…·ä½“æ—¶åˆ»éƒ½åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨å ç”¨CPUèµ„æºã€‚</p><p><strong>å¯¹æ“ä½œç³»ç»Ÿçš„è¦æ±‚è¿›ä¸€æ­¥æé«˜</strong></p><p>è™½ç„¶è¿›ç¨‹çš„å‡ºç°ï¼Œä½¿å¾—æ“ä½œç³»ç»Ÿçš„æ€§èƒ½å¤§å¤§æå‡ï¼Œä½†æ˜¯éšç€æ—¶é—´çš„æ¨ç§»ï¼Œäººä»¬å¹¶ä¸æ»¡è¶³ä¸€ä¸ªè¿›ç¨‹åœ¨ä¸€æ®µæ—¶é—´åªèƒ½åšä¸€ä»¶äº‹æƒ…ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹æœ‰å¤šä¸ªå­ä»»åŠ¡æ—¶ï¼Œåªèƒ½é€ä¸ªå¾—æ‰§è¡Œè¿™äº›å­ä»»åŠ¡ï¼Œå¾ˆå½±å“æ•ˆç‡ã€‚</p><blockquote><p>æ¯”å¦‚æ€æ¯’è½¯ä»¶åœ¨æ£€æµ‹ç”¨æˆ·ç”µè„‘æ—¶ï¼Œå¦‚æœåœ¨æŸä¸€é¡¹æ£€æµ‹ä¸­å¡ä½äº†ï¼Œé‚£ä¹ˆåé¢çš„æ£€æµ‹é¡¹ä¹Ÿä¼šå—åˆ°å½±å“ã€‚æˆ–è€…è¯´å½“ä½ ä½¿ç”¨æ€æ¯’è½¯ä»¶ä¸­çš„æ‰«æç—…æ¯’åŠŸèƒ½æ—¶ï¼Œåœ¨æ‰«æç—…æ¯’ç»“æŸä¹‹å‰ï¼Œæ— æ³•ä½¿ç”¨æ€æ¯’è½¯ä»¶ä¸­æ¸…ç†åƒåœ¾çš„åŠŸèƒ½ï¼Œè¿™æ˜¾ç„¶æ— æ³•æ»¡è¶³äººä»¬çš„è¦æ±‚ã€‚</p></blockquote><p><strong>çº¿ç¨‹çš„æå‡º</strong></p><p><strong>è®©ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå­ä»»åŠ¡ï¼Œè¿™æ ·ä¸€ä¸ªè¿›ç¨‹å°±åŒ…å«äº†å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£ä¸€ä¸ªå•ç‹¬çš„å­ä»»åŠ¡ã€‚</strong></p><blockquote><p>ä½¿ç”¨çº¿ç¨‹ä¹‹åï¼Œäº‹æƒ…å°±å˜å¾—ç®€å•å¤šäº†ã€‚å½“ç”¨æˆ·ä½¿ç”¨æ‰«æç—…æ¯’åŠŸèƒ½æ—¶ï¼Œå°±è®©æ‰«æç—…æ¯’è¿™ä¸ªçº¿ç¨‹å»æ‰§è¡Œã€‚åŒæ—¶ï¼Œå¦‚æœç”¨æˆ·åˆä½¿ç”¨æ¸…ç†åƒåœ¾åŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆæš‚åœæ‰«æç—…æ¯’çº¿ç¨‹ï¼Œå…ˆå“åº”ç”¨æˆ·çš„æ¸…ç†åƒåœ¾çš„æ“ä½œï¼Œè®©æ¸…ç†åƒåœ¾è¿™ä¸ªçº¿ç¨‹å»æ‰§è¡Œã€‚å“åº”å®Œåå†åˆ‡æ¢å›æ¥ï¼Œæ¥ç€æ‰§è¡Œæ‰«æç—…æ¯’çº¿ç¨‹ã€‚</p></blockquote><p>æ€»ä¹‹ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„æå‡ºæå¤§çš„æé«˜äº†æ“ä½œç³»ç»Ÿçš„æ€§èƒ½ã€‚<strong>è¿›ç¨‹è®©æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§æˆä¸ºäº†å¯èƒ½ï¼Œè€Œçº¿ç¨‹è®©è¿›ç¨‹çš„å†…éƒ¨å¹¶å‘æˆä¸ºäº†å¯èƒ½ã€‚</strong></p><p><strong>å¤šè¿›ç¨‹çš„æ–¹å¼ä¹Ÿå¯ä»¥å®ç°å¹¶å‘ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</strong></p><p>å¤šè¿›ç¨‹æ–¹å¼ç¡®å®å¯ä»¥å®ç°å¹¶å‘ï¼Œä½†ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li>è¿›ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒå¤æ‚ï¼Œè€Œçº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å…±äº«èµ„æºï¼Œè¿™äº›èµ„æºåœ¨çº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒå®¹æ˜“ã€‚</li><li>è¿›ç¨‹æ˜¯é‡é‡çº§çš„ï¼Œè€Œçº¿ç¨‹æ˜¯è½»é‡çº§çš„ï¼Œæ•…å¤šçº¿ç¨‹æ–¹å¼çš„ç³»ç»Ÿå¼€é”€æ›´å°ã€‚</li></ul><p><strong>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</strong></p><p>è¿›ç¨‹æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œè€Œçº¿ç¨‹æ˜¯åœ¨è¿›ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ä¸ªä»»åŠ¡ã€‚ä»–ä»¬ä¸¤ä¸ªæœ¬è´¨çš„åŒºåˆ«æ˜¯<strong>æ˜¯å¦å•ç‹¬å æœ‰å†…å­˜åœ°å€ç©ºé—´åŠå…¶å®ƒç³»ç»Ÿèµ„æºï¼ˆæ¯”å¦‚I/Oï¼‰</strong>ï¼š</p><ul><li>è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥è¿›ç¨‹é—´å­˜åœ¨å†…å­˜éš”ç¦»ï¼Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œæ•°æ®å…±äº«å¤æ‚ä½†æ˜¯åŒæ­¥ç®€å•ï¼Œå„ä¸ªè¿›ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ï¼›è€Œçº¿ç¨‹å…±äº«æ‰€å±è¿›ç¨‹å æœ‰çš„å†…å­˜åœ°å€ç©ºé—´å’Œèµ„æºï¼Œæ•°æ®å…±äº«ç®€å•ï¼Œä½†æ˜¯åŒæ­¥å¤æ‚ã€‚ </li><li>è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å‡ºç°é—®é¢˜ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼Œä¸å½±å“ä¸»ç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¯é æ€§é«˜ï¼›ä¸€ä¸ªçº¿ç¨‹å´©æºƒå¯èƒ½å½±å“æ•´ä¸ªç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¯é æ€§è¾ƒä½ã€‚ </li><li>è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œè¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ä¸ä»…éœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œè¿˜éœ€è¦èµ„æºçš„åˆ†é…å›æ”¶ä»¥åŠé¡µè°ƒåº¦ï¼Œå¼€é”€è¾ƒå¤§ï¼›çº¿ç¨‹åªéœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œå¼€é”€è¾ƒå°ã€‚</li></ul><p><strong>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ï¼Œå³CPUåˆ†é…æ—¶é—´çš„å•ä½ ã€‚</p><h3 id="lt-ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#lt-ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="< ä¸Šä¸‹æ–‡åˆ‡æ¢"></a><font color="green">&lt; ä¸Šä¸‹æ–‡åˆ‡æ¢</font></h3><p>ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆæœ‰æ—¶ä¹Ÿç§°åšè¿›ç¨‹åˆ‡æ¢æˆ–ä»»åŠ¡åˆ‡æ¢ï¼‰æ˜¯æŒ‡ CPU ä»ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ã€‚ä¸Šä¸‹æ–‡æ˜¯æŒ‡<strong>æŸä¸€æ—¶é—´ç‚¹ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨çš„å†…å®¹ã€‚</strong></p><blockquote><p>å¯„å­˜å™¨æ˜¯cpuå†…éƒ¨çš„å°‘é‡çš„é€Ÿåº¦å¾ˆå¿«çš„é—ªå­˜ï¼Œé€šå¸¸å­˜å‚¨å’Œè®¿é—®è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´å€¼æé«˜è®¡ç®—æœºç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚</p><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€ä¸ªä¸“ç”¨çš„å¯„å­˜å™¨ï¼Œç”¨äºè¡¨æ˜æŒ‡ä»¤åºåˆ—ä¸­ CPU æ­£åœ¨æ‰§è¡Œçš„ä½ç½®ï¼Œå­˜çš„å€¼ä¸ºæ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤çš„ä½ç½®æˆ–è€…ä¸‹ä¸€ä¸ªå°†è¦è¢«æ‰§è¡Œçš„æŒ‡ä»¤çš„ä½ç½®ï¼Œå…·ä½“å®ç°ä¾èµ–äºç‰¹å®šçš„ç³»ç»Ÿã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ çº¿ç¨‹A - B  </p><p>1.å…ˆæŒ‚èµ·çº¿ç¨‹Aï¼Œå°†å…¶åœ¨cpuä¸­çš„çŠ¶æ€ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚  </p><p>2.åœ¨å†…å­˜ä¸­æ£€ç´¢ä¸‹ä¸€ä¸ªçº¿ç¨‹Bçš„ä¸Šä¸‹æ–‡å¹¶å°†å…¶åœ¨ CPU çš„å¯„å­˜å™¨ä¸­æ¢å¤,æ‰§è¡ŒBçº¿ç¨‹ã€‚  </p><p>3.å½“Bæ‰§è¡Œå®Œï¼Œæ ¹æ®ç¨‹åºè®¡æ•°å™¨ä¸­æŒ‡å‘çš„ä½ç½®æ¢å¤çº¿ç¨‹Aã€‚</p></blockquote><p>CPUé€šè¿‡ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…CPUæ—¶é—´ç‰‡æ¥å®ç°å¤šçº¿ç¨‹æœºåˆ¶ã€‚CPUé€šè¿‡æ—¶é—´ç‰‡åˆ†é…ç®—æ³•æ¥å¾ªç¯æ‰§è¡Œä»»åŠ¡ï¼Œå½“å‰ä»»åŠ¡æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨åˆ‡æ¢å‰ä¼šä¿å­˜ä¸Šä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚æ‰€ä»¥ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p>ä¸Šä¸‹æ–‡åˆ‡æ¢é€šå¸¸æ˜¯è®¡ç®—å¯†é›†å‹çš„ï¼Œæ„å‘³ç€æ­¤æ“ä½œä¼š<strong>æ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œæ•…çº¿ç¨‹ä¹Ÿä¸æ˜¯è¶Šå¤šè¶Šå¥½</strong>ã€‚å‡å°‘ç³»ç»Ÿä¸­ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°.</p><h3 id="gt-è¿›ç¨‹åˆ›å»ºçš„å‡ ç§æ–¹å¼"><a href="#gt-è¿›ç¨‹åˆ›å»ºçš„å‡ ç§æ–¹å¼" class="headerlink" title="&nbsp;>è¿›ç¨‹åˆ›å»ºçš„å‡ ç§æ–¹å¼"></a><font color="green">&nbsp;&gt;è¿›ç¨‹åˆ›å»ºçš„å‡ ç§æ–¹å¼</font></h3><ol><li>Thread ç»§æ‰¿Treadï¼Œé‡å†™runæ–¹æ³•ã€‚</li><li>Runnable æ¥å£ é‡å†™runæ–¹æ³•ã€‚</li><li>Callableæ¥å£ï¼Œä½¿ç”¨FutureTaskç±»åˆ›å»ºçº¿ç¨‹ã€‚</li><li>ä½¿ç”¨çº¿ç¨‹æ± ã€‚</li></ol><h3 id="lt-JAVA-çº¿ç¨‹çŠ¶æ€"><a href="#lt-JAVA-çº¿ç¨‹çŠ¶æ€" class="headerlink" title="< JAVA çº¿ç¨‹çŠ¶æ€"></a><font color="green">&lt; JAVA çº¿ç¨‹çŠ¶æ€</font></h3><p>javaçº¿ç¨‹æœ‰6ä¸ªçŠ¶æ€ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">State</span><span class="token punctuation">{</span>    NEW<span class="token punctuation">,</span>    RUNNABLE<span class="token punctuation">,</span>    BLOCKED<span class="token punctuation">,</span>    WAITING<span class="token punctuation">,</span>    TIMED_WAITING<span class="token punctuation">,</span>    TERMINATED<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>NEWçŠ¶æ€</li></ol><p>çº¿ç¨‹æ­¤æ—¶å°šæœªå¯åŠ¨ã€‚ï¼ˆè¿˜æ²¡æœ‰è°ƒç”¨<code>start()</code>æ–¹æ³•ã€‚ï¼‰</p><p>æ³¨æ„ï¼šä¸å¯åå¤è°ƒç”¨<code>start()</code>æ–¹æ³•ï¼Œä¼šæŠ›å‡ºä¸åˆæ³•çº¿ç¨‹å¼‚å¸¸ã€‚</p><p>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ˆTERMINATED)ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸å¯å†è°ƒç”¨startæ–¹æ³•ï¼ˆä»ç„¶ä¼šè¿”å›TERMINATEDçŠ¶æ€ï¼‰ã€‚</p><ol start="2"><li>RUNNABLE</li></ol><p>æ­£åœ¨è™šæ‹Ÿæœºç§è¿è¡Œã€‚</p><ol start="3"><li>BLOCKED</li></ol><p>ç­‰å¾…é”é‡Šæ”¾ã€‚</p><ol start="4"><li>WAITING</li></ol><p>ç­‰å¾…çŠ¶æ€ï¼Œå¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹å˜ä¸ºRUNNABLEçŠ¶æ€éœ€è¦è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>Object.wait()</code>ï¼šä½¿å¾—å½“å‰çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å”¤é†’å®ƒã€‚</li><li><code>Thread.join()</code>ï¼šç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåº•å±‚è°ƒç”¨çš„æ—¶Objectå®ä¾‹çš„waitæ–¹æ³•ã€‚</li><li><code>LockSupport.park()</code>ï¼šé™¤éè·å¾—è°ƒç”¨è®¸å¯ï¼Œå¦åˆ™ç¦ç”¨å½“å‰çº¿ç¨‹è¿›è¡Œè°ƒåº¦ã€‚</li></ul><ol start="5"><li>è¶…æ—¶ç­‰å¾…</li></ol><ul><li><code>Thread.sleep(long millis)</code>ï¼šä½¿å½“å‰çº¿ç¨‹ç¡çœ æŒ‡å®šæ—¶é—´ï¼›</li><li><code>Object.wait(long timeout)</code>ï¼šçº¿ç¨‹ä¼‘çœ æŒ‡å®šæ—¶é—´ï¼Œç­‰å¾…æœŸé—´å¯ä»¥é€šè¿‡notify()/notifyAll()å”¤é†’ï¼›</li><li><code>Thread.join(long millis)</code>ï¼šç­‰å¾…å½“å‰çº¿ç¨‹æœ€å¤šæ‰§è¡Œmillisæ¯«ç§’ï¼Œå¦‚æœmillisä¸º0ï¼Œåˆ™ä¼šä¸€ç›´æ‰§è¡Œï¼›</li><li><code>LockSupport.parkNanos(long nanos)</code>ï¼š é™¤éè·å¾—è°ƒç”¨è®¸å¯ï¼Œå¦åˆ™ç¦ç”¨å½“å‰çº¿ç¨‹è¿›è¡Œçº¿ç¨‹è°ƒåº¦æŒ‡å®šæ—¶é—´ï¼›</li><li><code>LockSupport.parkUntil(long deadline)</code>ï¼šåŒä¸Šï¼Œä¹Ÿæ˜¯ç¦æ­¢çº¿ç¨‹è¿›è¡Œè°ƒåº¦æŒ‡å®šæ—¶é—´ï¼›</li></ul><ol start="6"><li>TERMINATED</li></ol><p>ç»ˆæ­¢çŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚</p><p><img src="/2021/03/15/java/%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E5%88%87%E6%8D%A2.png" alt="å¥æŸ„"></p><h3 id="lt-CAS-ä¸åŸå­æ“ä½œ"><a href="#lt-CAS-ä¸åŸå­æ“ä½œ" class="headerlink" title="< CAS ä¸åŸå­æ“ä½œ"></a><font color="green">&lt; CAS ä¸åŸå­æ“ä½œ</font></h3><p>æ¯”è¾ƒä¸äº¤æ¢ï¼ˆ<strong>Compare And Swap</strong>ï¼‰ã€‚åœ¨CASä¸­ï¼Œæœ‰è¿™æ ·ä¸‰ä¸ªå€¼ï¼š</p><ul><li>Vï¼šè¦æ›´æ–°çš„å˜é‡ï¼ˆvarï¼‰</li><li>Eï¼šé¢„æœŸå€¼ï¼ˆexpectedï¼‰</li><li>Nï¼šæ–°å€¼ï¼ˆnewï¼‰</li></ul><p>è¿‡ç¨‹å¦‚ä¸‹ï¼šåˆ¤æ–­Væ˜¯å¦ç­‰äºEï¼Œå¦‚æœç­‰äºï¼Œåˆ™å°†Vçš„å€¼è®¾ç½®ä¸ºNã€‚å¦‚æœä¸ç­‰ï¼Œåˆ™è¯´æ˜å·²ç»æœ‰å…¶ä»–çº¿ç¨‹æ›´æ–°äº†Vï¼Œåˆ™å½“å‰çº¿ç¨‹æ”¾å¼ƒæ›´æ–°ï¼Œä»€ä¹ˆä¸åšã€‚</p><p><strong>é¢„æœŸå€¼Eçš„æœ¬è´¨å°±æ˜¯æŒ‡ä¸Šä¸€æ¬¡çš„â€œæ—§å€¼â€ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><ol><li>å¦‚æœæœ‰ä¸€ä¸ªå¤šä¸ªçº¿ç¨‹å…±äº«çš„å˜é‡<code>i</code>åŸæœ¬ç­‰äº5ï¼Œæˆ‘ç°åœ¨åœ¨çº¿ç¨‹Aä¸­ï¼Œæƒ³æŠŠå®ƒè®¾ç½®ä¸ºæ–°çš„å€¼6;</li><li>æˆ‘ä»¬ä½¿ç”¨CASæ¥åšè¿™ä¸ªäº‹æƒ…ï¼›</li><li>é¦–å…ˆæˆ‘ä»¬ç”¨iå»ä¸5å¯¹æ¯”ï¼Œå‘ç°å®ƒç­‰äº5ï¼Œè¯´æ˜æ²¡æœ‰è¢«å…¶å®ƒçº¿ç¨‹æ”¹è¿‡ï¼Œé‚£æˆ‘å°±æŠŠå®ƒè®¾ç½®ä¸ºæ–°çš„å€¼6ï¼Œæ­¤æ¬¡CASæˆåŠŸï¼Œ<code>i</code>çš„å€¼è¢«è®¾ç½®æˆäº†6ï¼›</li><li>å¦‚æœä¸ç­‰äº5ï¼Œè¯´æ˜<code>i</code>è¢«å…¶å®ƒçº¿ç¨‹æ”¹è¿‡äº†ï¼ˆæ¯”å¦‚ç°åœ¨<code>i</code>çš„å€¼ä¸º2ï¼‰ï¼Œé‚£ä¹ˆæˆ‘å°±ä»€ä¹ˆä¹Ÿä¸åšï¼Œæ­¤æ¬¡CASå¤±è´¥ï¼Œ<code>i</code>çš„å€¼ä»ç„¶ä¸º2</li></ol><p><code>i</code>å°±æ˜¯Vï¼Œ5å°±æ˜¯Eï¼Œ6å°±æ˜¯Nã€‚</p><p>CASæ˜¯ä¸€ç§åŸå­æ“ä½œï¼Œæ˜¯ä¸€ç§ç³»ç»ŸåŸè¯­ï¼Œæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œä»CPUå±‚é¢ä¿è¯å®ƒçš„åŸå­æ€§ã€‚å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨CASæ“ä½œä¸€ä¸ªå˜é‡ï¼Œåªæœ‰ä¸€ä¸ªä¼šèƒœå‡ºå¹¶æ›´æ–°ï¼Œä½†å¤±è´¥çš„è¿›ç¨‹ä¸ä¼šæŒ‚èµ·ï¼Œä»…è¢«å‘ŠçŸ¥å¤±è´¥ï¼Œå¹¶ä¸”å…è®¸å†æ¬¡å°è¯•ï¼Œå½“ç„¶ä¹Ÿå…è®¸å¤±è´¥çš„çº¿ç¨‹æ”¾å¼ƒæ“ä½œã€‚</p><h4 id="JAVA-å®ç°CASåŸç†"><a href="#JAVA-å®ç°CASåŸç†" class="headerlink" title="JAVA å®ç°CASåŸç†"></a>JAVA å®ç°CASåŸç†</h4><p>ä½¿ç”¨äº†Unsafeç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">boolean</span> <span class="token function">compareAndSwapObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span><span class="token class-name">Object</span> expected<span class="token punctuation">,</span> <span class="token class-name">Object</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">boolean</span> <span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span><span class="token keyword">int</span> expected<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">boolean</span> <span class="token function">compareAndSwapLong</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span><span class="token keyword">long</span> expected<span class="token punctuation">,</span><span class="token keyword">long</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Unsafeä¸­å¯¹CASçš„å®ç°æ˜¯C++å†™çš„ï¼Œå®ƒçš„å…·ä½“å®ç°å’Œæ“ä½œç³»ç»Ÿã€CPUéƒ½æœ‰å…³ç³»ã€‚</p><p>Linuxçš„X86ä¸‹ä¸»è¦æ˜¯é€šè¿‡<code>cmpxchgl</code>è¿™ä¸ªæŒ‡ä»¤åœ¨CPUçº§å®ŒæˆCASæ“ä½œçš„ï¼Œä½†åœ¨å¤šå¤„ç†å™¨æƒ…å†µä¸‹å¿…é¡»ä½¿ç”¨<code>lock</code>æŒ‡ä»¤åŠ é”æ¥å®Œæˆã€‚å½“ç„¶ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œå¤„ç†å™¨çš„å®ç°ä¼šæœ‰æ‰€ä¸åŒï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p><p>å½“ç„¶ï¼ŒUnsafeç±»é‡Œé¢è¿˜æœ‰å…¶å®ƒæ–¹æ³•ç”¨äºä¸åŒçš„ç”¨é€”ã€‚æ¯”å¦‚æ”¯æŒçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤çš„<code>park</code>å’Œ<code>unpark</code>ï¼Œ LockSupportç±»åº•å±‚å°±æ˜¯è°ƒç”¨äº†è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚è¿˜æœ‰æ”¯æŒåå°„æ“ä½œçš„<code>allocateInstance()</code>æ–¹æ³•ã€‚</p><h3 id="java-util-concurrent-atomic-åŸå­æ“ä½œ"><a href="#java-util-concurrent-atomic-åŸå­æ“ä½œ" class="headerlink" title="java.util.concurrent.atomic åŸå­æ“ä½œ"></a>java.util.concurrent.atomic åŸå­æ“ä½œ</h3><p>JDKæä¾›äº†ä¸€äº›ç”¨äºåŸå­æ“ä½œçš„ç±»ï¼Œåœ¨<code>java.util.concurrent.atomic</code>åŒ…ä¸‹é¢ã€‚åœ¨JDK 11ä¸­ï¼Œæœ‰å¦‚ä¸‹17ä¸ªç±»ï¼š</p><p><img src="/2021/03/15/java/%E5%8E%9F%E5%AD%90%E7%B1%BB.jpg" alt="å¥æŸ„"></p><p>ä»åå­—çœ‹å‡ºå¤§æ¦‚ç”¨é€”ï¼š</p><ul><li>åŸå­æ›´æ–°åŸºæœ¬ç±»å‹</li><li>åŸå­æ›´æ–°æ•°ç»„</li><li>åŸå­æ›´æ–°å¼•ç”¨</li><li>åŸå­æ›´æ–°å­—æ®µï¼ˆå±æ€§ï¼‰</li></ul><h3 id="javaçº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ"><a href="#javaçº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ" class="headerlink" title="javaçº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ"></a><font color="green">javaçº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ</font></h3><blockquote><p>Executorsæä¾›äº†å››ç§æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚</p></blockquote><ol><li>newFixedThreadPool() :åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚</li><li>newCachedThreadPool(): åˆ›å»ºæ— é™å¤§å°çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡ä¸å›ºå®šï¼Œå¯æ ¹æ®éœ€æ±‚è‡ªåŠ¨æ›´æ”¹ã€‚</li><li>newSingleThreadPool() : åˆ›å»ºå•ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li>newScheduledThreadPool() åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥å»¶è¿Ÿæˆ–å®šæ—¶çš„æ‰§è¡Œä»»åŠ¡ã€‚</li></ol><h5 id="çº¿ç¨‹æ± ä½œç”¨"><a href="#çº¿ç¨‹æ± ä½œç”¨" class="headerlink" title="çº¿ç¨‹æ± ä½œç”¨"></a>çº¿ç¨‹æ± ä½œç”¨</h5><ol><li>é™åˆ¶çº¿ç¨‹ä¸ªæ•°ï¼Œé¿å…çº¿ç¨‹è¿‡å¤šå¯¼è‡´ç³»ç»Ÿè¿è¡Œç¼“æ…¢æˆ–å´©æºƒã€‚</li><li>ä¸éœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ï¼ŒèŠ‚çº¦èµ„æºã€å“åº”æ›´å¿«ã€‚</li></ol><h3 id="Synchronizedä¸ReetrantLocké”åŒºåˆ«"><a href="#Synchronizedä¸ReetrantLocké”åŒºåˆ«" class="headerlink" title="Synchronizedä¸ReetrantLocké”åŒºåˆ«"></a><font color="green">Synchronizedä¸ReetrantLocké”åŒºåˆ«</font></h3><p>Synchronized å’ŒReetrantLockéƒ½æ˜¯é˜»å¡å¼åŒæ­¥ã€‚</p><p>å…¶ä¸­Synchronizedæ˜¯Javaå…³é”®å­—ï¼Œéœ€è¦jvmå®ç°ã€‚å®ƒè¿›å…¥ç¼–è¯‘ï¼Œä¼šåœ¨åŒæ­¥å—å‰åå½¢æˆ<code>monitorenter</code>å’Œ<code>monitorexit</code>ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ã€‚æ‰§è¡Œ<code>monitorenter</code>æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆè¦å°è¯•è·å–å¯¹è±¡é”ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡é”æ²¡è¢«é”å®šï¼Œæˆ–è€…å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†é‚£ä¸ªå¯¹è±¡é”ï¼ŒæŠŠé”çš„è®¡ç®—å™¨åŠ 1ã€‚ç›¸åº”çš„ï¼Œåœ¨æ‰§è¡ŒmonitorexitæŒ‡ä»¤æ—¶ä¼šå°†é”è®¡ç®—å™¨å‡1ï¼Œå½“è®¡ç®—å™¨ä¸º0æ—¶ï¼Œé”è¢«é‡Šæ”¾ã€‚å¦‚æœå¯¹è±¡æ‰€è·å¾—å¤±è´¥ï¼Œå°±è¦é˜»å¡ã€‚</p><p>ReentrantLock æ˜¯juc(java.util.concurrent)åŒ…ä¸‹æä¾›çš„ä¸€å¥—äº’æ–¥é”ï¼Œå±äºAPIå±‚é¢ã€‚å®ƒæœ‰ä»¥ä¸‹Synchronizedæ²¡æœ‰çš„åŠŸèƒ½ï¼š</p><ol><li>ç­‰å¾…å¯ä¸­æ–­ã€‚æŒæœ‰é”çš„çº¿ç¨‹é•¿æœŸä¸é‡Šæ”¾æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹é€‰æ‹©æ”¾å¼ƒç­‰å¾…ã€‚</li><li>å…¬å¹³é”ã€‚é»˜è®¤æ„é€ å‡½æ•°æ”¹ä¸ºtrueã€‚</li><li>å¯ç»‘å®šå¤šä¸ªå¯¹è±¡ã€‚</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReetrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Condition</span> contidtion <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Synchronizedä¸é”"><a href="#Synchronizedä¸é”" class="headerlink" title="Synchronizedä¸é”"></a><font color="green">Synchronizedä¸é”</font></h3><p>å¯¹å¤–çš„ä¾èµ–å¤šå°‘ã€‚</p><ol><li>æ— é”çŠ¶æ€</li><li>åå‘é”çŠ¶æ€</li><li>è½»é‡çº§é”çŠ¶æ€</li><li>é‡é‡çº§é”çŠ¶æ€</li></ol><p><img src="/2021/03/15/java/%E9%94%81%E5%8D%87%E7%BA%A7.PNG"></p><p>åå‘é”CASæœºåˆ¶while æ”¹æˆifã€‚è½»é‡çº§é”å°±æ˜¯CASï¼ˆC++å†™çš„ï¼‰ï¼Œå¦‚æœç«äº‰æ¿€çƒˆï¼Œå°±è½¬æ¢ä¸ºé‡é‡çº§é”ï¼ˆè°ƒç”¨æ“ä½œç³»ç»Ÿçš„é˜»å¡ï¼‰ã€‚</p><p>æ— é”å°±æ˜¯æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥å°è¯•å»ä¿®æ”¹å®ƒã€‚</p><p>é”çš„å‡çº§å¾ˆå®¹æ˜“å‘ç”Ÿï¼Œä½†æ˜¯é”é™çº§å‘ç”Ÿçš„æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼Œé”é™çº§å‘ç”Ÿåœ¨<code>Stop the world</code>æœŸé—´ï¼Œå½“JVMè¿›å…¥å®‰å…¨ç‚¹çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥æ˜¯å¦æœ‰é—²ç½®é”ï¼Œç„¶åè¿›è¡Œé™çº§ã€‚</p><ul><li>JAVAå¯¹è±¡å¤´</li></ul><p>javaå¯¹è±¡çš„é”éƒ½æ˜¯åŸºäºå¯¹è±¡çš„ã€‚éæ•°ç»„ç±»å‹ï¼Œåˆ™ç”¨2ä¸ªå­—å®½æ¥å­˜å‚¨å¯¹è±¡å¤´ï¼ˆ64ä½æœºå­ï¼Œä¸€ä¸ªå­—å®½64ä½ï¼‰ã€‚æ•°ç»„ç±»å‹ç”¨3ä¸ªå­—å®½æ¥å­˜å‚¨å¯¹è±¡å¤´ã€‚å¯¹è±¡å¤´å†…å®¹å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th align="center">é•¿åº¦</th><th align="center">å†…å®¹</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">32/64bit</td><td align="center">Mark Word</td><td align="center">å­˜å‚¨å¯¹è±¡çš„hashCodeæˆ–é”ä¿¡æ¯ç­‰</td></tr><tr><td align="center">32/64bit</td><td align="center">Class Metadata Address</td><td align="center">å­˜å‚¨åˆ°å¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆ</td></tr><tr><td align="center">32/64bit</td><td align="center">Array length</td><td align="center">æ•°ç»„çš„é•¿åº¦ï¼ˆå¦‚æœæ˜¯æ•°ç»„ï¼‰</td></tr></tbody></table><p>æˆ‘ä»¬ä¸»è¦æ¥çœ‹çœ‹Mark Wordçš„æ ¼å¼ï¼š</p><table><thead><tr><th align="center">é”çŠ¶æ€</th><th align="center">29 bit æˆ– 61 bit</th><th align="center">1 bit æ˜¯å¦æ˜¯åå‘é”ï¼Ÿ</th><th align="center">2 bit é”æ ‡å¿—ä½</th></tr></thead><tbody><tr><td align="center">æ— é”</td><td align="center"></td><td align="center">0</td><td align="center">01</td></tr><tr><td align="center">åå‘é”</td><td align="center">çº¿ç¨‹ID</td><td align="center">1</td><td align="center">01</td></tr><tr><td align="center">è½»é‡çº§é”</td><td align="center">æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ</td><td align="center">æ­¤æ—¶è¿™ä¸€ä½ä¸ç”¨äºæ ‡è¯†åå‘é”</td><td align="center">00</td></tr><tr><td align="center">é‡é‡çº§é”</td><td align="center">æŒ‡å‘äº’æ–¥é‡ï¼ˆé‡é‡çº§é”ï¼‰çš„æŒ‡é’ˆ</td><td align="center">æ­¤æ—¶è¿™ä¸€ä½ä¸ç”¨äºæ ‡è¯†åå‘é”</td><td align="center">10</td></tr><tr><td align="center">GCæ ‡è®°</td><td align="center"></td><td align="center">æ­¤æ—¶è¿™ä¸€ä½ä¸ç”¨äºæ ‡è¯†åå‘é”</td><td align="center">11</td></tr></tbody></table><p>å½“å¯¹è±¡çŠ¶æ€ä¸ºåå‘é”æ—¶ï¼Œ<code>Mark Word</code>å­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹IDï¼›å½“çŠ¶æ€ä¸ºè½»é‡çº§é”æ—¶ï¼Œ<code>Mark Word</code>å­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­<code>Lock Record</code>çš„æŒ‡é’ˆï¼›å½“çŠ¶æ€ä¸ºé‡é‡çº§é”æ—¶ï¼Œ<code>Mark Word</code>ä¸ºæŒ‡å‘å †ä¸­çš„monitorå¯¹è±¡çš„æŒ‡é’ˆã€‚</p><ul><li>åå‘é”</li></ul><p>åå‘é”åå‘äºç¬¬ä¸€ä¸ªè®¿é—®é”çš„çº¿ç¨‹ï¼Œå¦‚æœåœ¨æ¥ä¸‹æ¥çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯¥é”æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œåˆ™æŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦è§¦å‘åŒæ­¥ã€‚ <strong>åå‘é”åœ¨èµ„æºæ— ç«äº‰çš„æƒ…å†µä¸‹æ¶ˆé™¤äº†åŒæ­¥è¯­å¥ï¼Œè¿CASæ“ä½œéƒ½ä¸åšï¼Œæé«˜äº†ç¨‹åºçš„è¿è¡Œæ€§èƒ½ã€‚</strong></p><p><img src="/2021/03/15/java/%E5%81%8F%E5%90%91%E9%94%81%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="å¥æŸ„"></p><p>åå‘é”ä½¿ç”¨ä¸€ç§<strong>ç­‰å¾…ç«äº‰å‡ºç°æ‰é‡Šæ”¾é”çš„æœºåˆ¶</strong>ã€‚</p><p>åå‘é”å‡çº§æˆè½»é‡çº§é”æ—¶ï¼Œä¼šæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œé‡ç½®åå‘é”æ ‡è¯†ï¼Œè¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥å®¹æ˜“ï¼Œå®åˆ™å¼€é”€è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œå¤§æ¦‚çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åœ¨ä¸€ä¸ªå®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰åœæ­¢æ‹¥æœ‰é”çš„çº¿ç¨‹ã€‚</li><li>éå†çº¿ç¨‹æ ˆï¼Œå¦‚æœå­˜åœ¨é”è®°å½•çš„è¯ï¼Œéœ€è¦ä¿®å¤é”è®°å½•å’ŒMark Wordï¼Œä½¿å…¶å˜æˆæ— é”çŠ¶æ€ã€‚</li><li>å”¤é†’è¢«åœæ­¢çš„çº¿ç¨‹ï¼Œå°†å½“å‰é”å‡çº§æˆè½»é‡çº§é”ã€‚</li></ol><p><img src="/2021/03/15/java/%E5%81%8F%E5%90%91%E9%94%81%E7%9A%84%E6%92%A4%E9%94%80.png" alt="å¥æŸ„"></p><ul><li>è½»é‡çº§é”</li></ul><p>å¤šä¸ªçº¿ç¨‹åœ¨ä¸åŒæ—¶æ®µè·å–åŒä¸€æŠŠé”ï¼Œä¸å­˜åœ¨é”ç«äº‰çš„æƒ…å†µï¼Œä½¿ç”¨è½»é‡çº§é”æ¥é¿å…çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’ã€‚</p><p>åŠ é”ï¼šJVMä¸ºæ¯ä¸ªçº¿ç¨‹åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´â€”â€”<code>Displaced Mark Word</code>ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹è·å¾—é”æ—¶å‘ç°æ—¶è½»é‡çº§é”ï¼Œä¼šæŠŠ<code>Mark Word</code>å¤åˆ¶åˆ°è‡ªå·±çš„<code>Displaced Marked Word</code>ä¸­ã€‚</p><p>ç„¶åçº¿ç¨‹å°è¯•ç”¨CASå°†é”çš„<code>Mark Word</code>æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚æˆåŠŸåˆ™è·å¾—é”ï¼Œå¤±è´¥åˆ™<code>Mark World</code>è¢«æ›¿æ¢æˆäº†å…¶ä»–çº¿ç¨‹çš„é”è®°å½•ï¼Œè¯´æ˜ä¸å…¶ä»–çº¿ç¨‹å­˜åœ¨ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹å°±å°è¯•ä½¿ç”¨<code>è‡ªæ—‹</code>æ¥è·å–é”ã€‚</p><p><font color="green">è‡ªæ—‹</font></p><p>è‡ªæ—‹è¦æ¶ˆè€—CPUï¼Œå¦‚æœä¸€ç›´è·ä¸å¾—é”ï¼Œåˆ™ä¸€ç›´å¤„äºè‡ªæ—‹çŠ¶æ€ã€‚JDKä½¿ç”¨<font color="green">è‡ªé€‚åº”è‡ªæ—‹</font>ï¼Œå¦‚æœçº¿ç¨‹è‡ªæ—‹æˆåŠŸï¼Œåˆ™ä¸‹æ¬¡è‡ªæ—‹çš„æ¬¡æ•°ä¼šæ›´å¤šï¼Œå¦‚æœå¤±è´¥äº†ï¼Œåˆ™è‡ªæ—‹çš„æ¬¡æ•°ä¼šå‡å°‘ã€‚</p><p>å¦‚æœä¸€ç›´è‡ªæ—‹å¤±è´¥ï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹é˜»å¡ï¼ŒåŒæ—¶é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p><p><font color="green">è½»é‡çº§é”çš„é‡Šæ”¾ï¼š</font></p><p>é‡Šæ”¾é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä½¿ç”¨CASå°†<code>Dispalced Mark Word</code>çš„å†…å®¹å¤åˆ¶å›é”çš„<code>Mark Word</code>é‡Œé¢ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿç«äº‰ï¼Œåˆ™è¿™ä¸ªå¤åˆ¶æ“ä½œæˆåŠŸã€‚å¦‚æœå› ä¸ºç«äº‰å‡çº§æˆäº†é‡é‡çº§é”ï¼Œé‚£ä¹ˆCASæ“ä½œä¼šæ“ä½œå¤±è´¥ï¼Œæ­¤æ—¶é‡Šæ”¾é”å¹¶å”¤é†’è¢«é˜»å¡çš„çº¿ç¨‹ã€‚</p><p><img src="/2021/03/15/java/%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81.png" alt="å¥æŸ„"></p><ul><li>é‡é‡çº§é”</li></ul><p>é‡é‡çº§é”ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ï¼ˆmutex)å®ç°ï¼Œè€Œæ“ä½œç³»ç»Ÿçº¿ç¨‹é—´çŠ¶æ€çš„è½¬æ¢éœ€è¦æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥é‡é‡çº§é”çš„æ•ˆç‡å¾ˆä½ï¼Œä½†è¢«é˜»å¡çš„çº¿ç¨‹ä¸ä¼šæ¶ˆè€—CPUã€‚</p><p>æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥å½“æˆä¸€ä¸ªé”ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚æŸä¸€ä¸ªå¯¹è±¡é”æ—¶ï¼Œå¯¹è±¡é”è®¾ç½®å‡ ç§çŠ¶æ€ç”¨æ¥åŒºåˆ†è¯·æ±‚çš„çº¿ç¨‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Contention Listï¼šæ‰€æœ‰è¯·æ±‚é”çš„çº¿ç¨‹å°†è¢«é¦–å…ˆæ”¾ç½®åˆ°è¯¥ç«äº‰é˜Ÿåˆ—Entry Listï¼šContention Listä¸­é‚£äº›æœ‰èµ„æ ¼æˆä¸ºå€™é€‰äººçš„çº¿ç¨‹è¢«ç§»åˆ°Entry ListWait Setï¼šé‚£äº›è°ƒç”¨waitæ–¹æ³•è¢«é˜»å¡çš„çº¿ç¨‹è¢«æ”¾ç½®åˆ°Wait SetOnDeckï¼šä»»ä½•æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç«äº‰é”ï¼Œè¯¥çº¿ç¨‹ç§°ä¸ºOnDeckOwnerï¼šè·å¾—é”çš„çº¿ç¨‹ç§°ä¸ºOwner!Ownerï¼šé‡Šæ”¾é”çš„çº¿ç¨‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœçº¿ç¨‹è·å¾—é”åè°ƒç”¨<code>Object.wait</code>æ–¹æ³•ï¼Œåˆ™ä¼šå°†çº¿ç¨‹åŠ å…¥åˆ°WaitSetä¸­ï¼Œå½“è¢«<code>Object.notify</code>å”¤é†’åï¼Œä¼šå°†çº¿ç¨‹ä»WaitSetç§»åŠ¨åˆ°Contention Listæˆ–EntryListä¸­å»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“è°ƒç”¨ä¸€ä¸ªé”å¯¹è±¡çš„<code>wait</code>æˆ–<code>notify</code>æ–¹æ³•æ—¶ï¼Œ<strong>å¦‚å½“å‰é”çš„çŠ¶æ€æ˜¯åå‘é”æˆ–è½»é‡çº§é”åˆ™ä¼šå…ˆè†¨èƒ€æˆé‡é‡çº§é”</strong>ã€‚</p><h3 id="æ€»ç»“é”çš„å‡çº§æµç¨‹"><a href="#æ€»ç»“é”çš„å‡çº§æµç¨‹" class="headerlink" title="æ€»ç»“é”çš„å‡çº§æµç¨‹"></a>æ€»ç»“é”çš„å‡çº§æµç¨‹</h3><p>æ¯ä¸€ä¸ªçº¿ç¨‹åœ¨å‡†å¤‡è·å–å…±äº«èµ„æºæ—¶ï¼š ç¬¬ä¸€æ­¥ï¼Œæ£€æŸ¥MarkWordé‡Œé¢æ˜¯ä¸æ˜¯æ”¾çš„è‡ªå·±çš„ThreadId ,å¦‚æœæ˜¯ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ˜¯å¤„äº â€œåå‘é”â€ ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œå¦‚æœMarkWordä¸æ˜¯è‡ªå·±çš„ThreadIdï¼Œé”å‡çº§ï¼Œè¿™æ—¶å€™ï¼Œç”¨CASæ¥æ‰§è¡Œåˆ‡æ¢ï¼Œæ–°çš„çº¿ç¨‹æ ¹æ®MarkWordé‡Œé¢ç°æœ‰çš„ThreadIdï¼Œé€šçŸ¥ä¹‹å‰çº¿ç¨‹æš‚åœï¼Œä¹‹å‰çº¿ç¨‹å°†Markwordçš„å†…å®¹ç½®ä¸ºç©ºã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½æŠŠé”å¯¹è±¡çš„HashCodeå¤åˆ¶åˆ°è‡ªå·±æ–°å»ºçš„ç”¨äºå­˜å‚¨é”çš„è®°å½•ç©ºé—´ï¼Œæ¥ç€å¼€å§‹é€šè¿‡CASæ“ä½œï¼Œ æŠŠé”å¯¹è±¡çš„MarKwordçš„å†…å®¹ä¿®æ”¹ä¸ºè‡ªå·±æ–°å»ºçš„è®°å½•ç©ºé—´çš„åœ°å€çš„æ–¹å¼ç«äº‰MarkWordã€‚</p><p>ç¬¬å››æ­¥ï¼Œç¬¬ä¸‰æ­¥ä¸­æˆåŠŸæ‰§è¡ŒCASçš„è·å¾—èµ„æºï¼Œå¤±è´¥çš„åˆ™è¿›å…¥è‡ªæ—‹ ã€‚</p><p>ç¬¬äº”æ­¥ï¼Œè‡ªæ—‹çš„çº¿ç¨‹åœ¨è‡ªæ—‹è¿‡ç¨‹ä¸­ï¼ŒæˆåŠŸè·å¾—èµ„æº(å³ä¹‹å‰è·çš„èµ„æºçš„çº¿ç¨‹æ‰§è¡Œå®Œæˆå¹¶é‡Šæ”¾äº†å…±äº«èµ„æº)ï¼Œåˆ™æ•´ä¸ªçŠ¶æ€ä¾ç„¶å¤„äº è½»é‡çº§é”çš„çŠ¶æ€ï¼Œå¦‚æœè‡ªæ—‹å¤±è´¥ ã€‚</p><p>ç¬¬å…­æ­¥ï¼Œè¿›å…¥é‡é‡çº§é”çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè‡ªæ—‹çš„çº¿ç¨‹è¿›è¡Œé˜»å¡ï¼Œç­‰å¾…ä¹‹å‰çº¿ç¨‹æ‰§è¡Œå®Œæˆå¹¶å”¤é†’è‡ªå·±ã€‚</p><table><thead><tr><th>é”</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>åå‘é”</td><td>åŠ é”å’Œè§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—ï¼Œå’Œæ‰§è¡ŒéåŒæ­¥æ–¹æ³•æ¯”ä»…å­˜åœ¨çº³ç§’çº§çš„å·®è·ã€‚</td><td>å¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—ã€‚</td><td>é€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—åœºæ™¯ã€‚</td></tr><tr><td>è½»é‡çº§é”</td><td>ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚</td><td>å¦‚æœå§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹ä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPUã€‚</td><td>è¿½æ±‚å“åº”æ—¶é—´ã€‚åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ã€‚</td></tr><tr><td>é‡é‡çº§é”</td><td>çº¿ç¨‹ç«äº‰ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€—CPUã€‚</td><td>çº¿ç¨‹é˜»å¡ï¼Œå“åº”æ—¶é—´ç¼“æ…¢ã€‚</td><td>è¿½æ±‚ååé‡ã€‚åŒæ­¥å—æ‰§è¡Œæ—¶é—´è¾ƒé•¿ã€‚</td></tr></tbody></table><h3 id="CountDownLatchå’ŒSemaphoreçš„åŒºåˆ«å’Œåº•å±‚åŸç†"><a href="#CountDownLatchå’ŒSemaphoreçš„åŒºåˆ«å’Œåº•å±‚åŸç†" class="headerlink" title="CountDownLatchå’ŒSemaphoreçš„åŒºåˆ«å’Œåº•å±‚åŸç†"></a><font color="green">CountDownLatchå’ŒSemaphoreçš„åŒºåˆ«å’Œåº•å±‚åŸç†</font></h3><p>CountDownLatchæ˜¯è®¡æ•°å™¨ï¼Œç»™å®ƒè®¾ç½®ä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªçº¿ç¨‹è°ƒç”¨CountDownLatchçš„await()å°†ä¼šé˜»å¡ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è°ƒç”¨CountDownLatchçš„countDown()æ–¹æ³•æ¥å¯¹æ•°å­—å‡ä¸€ï¼Œå½“æ•°å­—å‡ä¸º0åï¼Œæ‰€ä»¥å¶awaitçº¿ç¨‹éƒ½å°†ä¼šè¢«å”¤é†’ã€‚</p><p>å¯¹åº”çš„åº•å±‚åŸç†æ˜¯ï¼šè°ƒç”¨awaitï¼ˆï¼‰æ–¹æ³•çš„çº¿ç¨‹ä¼šåˆ©ç”¨AQSæ’é˜Ÿï¼Œä¸€æ—¦æ•°å­—è¢«å‡ä¸º0ï¼Œåˆ™ä¼šè¢«AQSä¸­æ’é˜Ÿçš„çº¿ç¨‹ä¾æ¬¡å”¤é†’ã€‚</p><p>Semophoreè¡¨ç¤ºä¿¡å·é‡ï¼Œå¯ä»¥è®¾ç½®è®¸å¯çš„ä¸ªæ•°ï¼Œè¡¨ç¤ºåŒæ—¶å…è®¸æœ€å¤šå¤šå°‘ä¸ªçº¿ç¨‹ä½¿ç”¨è¯¥ä¿¡å·é‡ï¼Œé€šè¿‡acquire()æ¥è·å–è®¸å¯ï¼Œå¦‚æœæ²¡æœ‰è®¸å¯åˆ™ç”¨çº¿ç¨‹é˜»å¡ï¼Œå¹¶é€šè¿‡AQSæ¥æ’é˜Ÿï¼Œå¯ä»¥é€šè¿‡release()æ–¹æ³•æ¥é‡Šæ”¾è®¸å¯ï¼Œå½“æŸä¸ªçº¿ç¨‹é‡Šæ”¾è®¸å¯åï¼Œä¼šä»AQSä¸­æ­£åœ¨æ’é˜Ÿçš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¾æ¬¡å”¤é†’ï¼Œç›´åˆ°æ²¡æœ‰ç©ºé—²è®¸å¯ã€‚</p><p>æ³›å‹</p><p><strong>æŠŠç±»å‹æ˜ç¡®çš„å·¥ä½œæ¨è¿Ÿåˆ°åˆ›å»ºå¯¹è±¡æˆ–è°ƒç”¨æ–¹æ³•çš„æ—¶å€™</strong></p><h2 id="4-JAVA-8-æ–°ç‰¹æ€§"><a href="#4-JAVA-8-æ–°ç‰¹æ€§" class="headerlink" title="4. JAVA 8 æ–°ç‰¹æ€§"></a>4. JAVA 8 æ–°ç‰¹æ€§</h2><p>æ¥å£ä¸­çš„<code>default</code>æ–°æ–¹æ³•ã€<code>static</code>å¯ä»¥ä¿®é¥°æ–¹æ³•äº†ï¼Œå¹¶ä¸”æä¾›å®ç°ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">interface</span> <span class="token class-name">Formula</span><span class="token punctuation">{</span>    <span class="token keyword">double</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">default</span> <span class="token keyword">double</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> hello<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä½¿ç”¨<code>default</code>æ–¹æ³•å¯ä»¥åœ¨æ¥å£ä¸­å®ç°å…·ä½“æ–¹æ³•ï¼ˆéæŠ½è±¡æ–¹æ³•ï¼‰<font color="red"> <code>default</code>æ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ï¼Œåªèƒ½ç»§æ‰¿</font>ã€‚</p><h4 id="1-Stream"><a href="#1-Stream" class="headerlink" title="1. Stream"></a>1. Stream</h4><p><code>1. ä¸­é—´æ“ä½œ</code>ï¼ˆè¿”å›<code>Stream&lt;T&gt;</code>å’Œ<code>ç»ˆç«¯æ“ä½œ</code>ï¼ˆè¿”å›å®šä¹‰ç±»å‹çš„ç»“æœï¼‰ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> count <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>å¯ä»¥æ›¿ä»£å¾ªç¯çš„<code>anymatch</code></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> string <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//å¯ä»¥æ›¿æ¢ä¸ºå¦‚ä¸‹ï¼š</span><span class="token keyword">boolean</span> isExist <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span>element <span class="token operator">-&gt;</span> element<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>è¿‡æ»¤ï¼Œé€‰å‡ºæƒ³è¦çš„å…ƒç´  <code>Filtering</code></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"One"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"OneAndOnly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Derek"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Change"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"factory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"justBefore"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Italy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Italy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Thursday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>element <span class="token operator">-&gt;</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>é€šè¿‡ä¸€ä¸ªå‡½æ•°è½¬æ¢ä½ æƒ³å¾—åˆ°çš„ç»“æœ <code>Mapping</code></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> uris <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>uris<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"C:\\My.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> uris<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>uri <span class="token operator">-&gt;</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="5"><li><code>Matching</code></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">boolean</span> isValid <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span>element <span class="token operator">-&gt;</span> element<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">boolean</span> isValidOne <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allMatch</span><span class="token punctuation">(</span>element <span class="token operator">-&gt;</span> element<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">boolean</span> isvalidTwo <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noneMatch</span><span class="token punctuation">(</span>element <span class="token operator">-</span> <span class="token operator">&gt;</span> element<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="6"><li><code>Reduction</code> </li></ol><p>Imagine that you have a <em>List<integer></integer></em> and you want to have a sum of all these elements and some initial <em>Integer</em> (in this example 23). So, you can run the following code and result will be 26 (23 + 1 + 1 + 1).</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> integers <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Integer</span> reduced <span class="token operator">=</span> integers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="7"><li><code>Collecting</code></li></ol><p>æŠŠstreamè½¬ä¸ºCollectionæˆ–mapã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>element <span class="token operator">-&gt;</span> element<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿ</title>
      <link href="2021/03/15/operate/"/>
      <url>2021/03/15/operate/</url>
      
        <content type="html"><![CDATA[<h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><h2 id="1-æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µ"><a href="#1-æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µ" class="headerlink" title="1.æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µ"></a>1.æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µ</h2><ol><li>æ“ä½œç³»ç»Ÿç‰¹å¾ï¼š å¹¶å‘ã€ å…±äº« ã€ è™šæ‹Ÿã€ å¼‚æ­¥ã€‚</li></ol><p><img src="/2021/03/15/operate/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-1615794509246.PNG"></p><p>è¡¥å……ï¼šè¿›ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ã€‚æ‰§è¡Œå‰éœ€è¦å°†ç¨‹åºæ”¾å…¥å†…å­˜ï¼Œæ‰èƒ½è¢«CPUå¤„ç†ã€‚</p><p><img src="/2021/03/15/operate/%E7%9F%A5%E8%AF%86%E6%80%BB%E8%A7%88-1615794509247.PNG"></p><h3 id="1-1å¤„ç†å™¨çš„ä¸¤ç§çŠ¶æ€"><a href="#1-1å¤„ç†å™¨çš„ä¸¤ç§çŠ¶æ€" class="headerlink" title="1.1å¤„ç†å™¨çš„ä¸¤ç§çŠ¶æ€"></a>1.1å¤„ç†å™¨çš„ä¸¤ç§çŠ¶æ€</h3><p><img src="/2021/03/15/operate/%E5%A4%84%E7%90%86%E5%99%A8%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%8A%B6%E6%80%81-1615794509247.PNG"></p><p><img src="/2021/03/15/operate/%E4%B8%A4%E7%A7%8D%E7%A8%8B%E5%BA%8F-1615794509247.PNG"></p><h3 id="1-2-å¤§å†…æ ¸å¾®å†…æ ¸"><a href="#1-2-å¤§å†…æ ¸å¾®å†…æ ¸" class="headerlink" title="1.2 å¤§å†…æ ¸å¾®å†…æ ¸"></a>1.2 å¤§å†…æ ¸å¾®å†…æ ¸</h3><p><img src="/2021/03/15/operate/%E5%A4%A7%E5%86%85%E6%A0%B8%E5%BE%AE%E5%86%85%E6%A0%B81-1615794509248.PNG"></p><p>å¾®å†…æ ¸ï¼šåªåŒ…å«ä¸€äº›å¿…ä¸å¯å°‘çš„åŠŸèƒ½ã€‚</p><p>å¤§å†…æ ¸ï¼šé™¤äº†å¾®å†…æ ¸è¿˜æœ‰å…¶ä»–éå¿…è¦åŠŸèƒ½ã€‚</p><p><img src="/2021/03/15/operate/%E5%A4%A7%E5%86%85%E6%A0%B8%E5%BE%AE%E5%86%85%E6%A0%B82-1615794509248.PNG"></p><h3 id="1-3-ä¸­æ–­å’Œå¼‚å¸¸"><a href="#1-3-ä¸­æ–­å’Œå¼‚å¸¸" class="headerlink" title="1.3 ä¸­æ–­å’Œå¼‚å¸¸"></a>1.3 ä¸­æ–­å’Œå¼‚å¸¸</h3><p><img src="/2021/03/15/operate/%E4%B8%AD%E6%96%AD%E6%8E%A7%E5%88%B6%E5%99%A8.PNG"></p><p><img src="/2021/03/15/operate/%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86%E6%98%A0%E5%B0%84%E8%A1%A8.PNG"></p><p>ä¸­æ–­æ˜ å°„è¡¨ï¼Œå­˜å‚¨ä¸­æ–­å¤„ç†ä»£ç å…¥å£ã€‚å¯„å­˜å™¨é‡Œé¢è§£æå‡ºæ¥çš„å‘é‡å€¼ï¼Œç„¶åæŸ¥æ˜ å°„è¡¨ï¼Œå°±çŸ¥é“ä»€ä¹ˆä¸­æ–­ç¨‹åºäº†ã€‚</p><p><img src="/2021/03/15/operate/%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B81-1615794509248.PNG"></p><p><img src="/2021/03/15/operate/%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B82-1615794509248.PNG"></p><p><img src="/2021/03/15/operate/%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B83-1615794509248.PNG"></p><p>è¿™äº›æ“ä½œæ‰§è¡Œå®Œæˆåï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠCPUçš„ä½¿ç”¨æƒäº¤è¿˜ç»™åº”ç”¨è¿›ç¨‹ã€‚</p><p><img src="/2021/03/15/operate/%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B84-1615794509248.PNG"></p><p>è¿›ç¨‹æ— æ³•ç›´æ¥ä¸­æ–­ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼è¯·æ±‚è¾“å‡ºã€‚</p><p>tipsï¼š </p><ul><li>ç”±äºæ“ä½œç³»ç»Ÿçš„ç®¡ç†å·¥ä½œéœ€è¦ä½¿ç”¨ç‰¹æƒæŒ‡ä»¤ï¼Œå› æ­¤CPUè¦ä»ç”¨æˆ·æ€è½¬ä¸ºæ ¸å¿ƒæ€ã€‚ä¸­æ–­å¯ä»¥ä½¿CPUä»ç”¨æˆ·æ€åˆ‡æ¢ä¸ºæ ¸å¿ƒæ€ï¼Œä½¿æ“ä½œç³»ç»Ÿè·å¾—è®¡ç®—æœºçš„æ§åˆ¶æƒã€‚æœ‰äº†ä¸­æ–­ï¼Œæ‰èƒ½å®ç°å¤šé“ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</li><li><font color="red">ç”¨æˆ·æ€â€”&gt;æ ¸å¿ƒæ€æ˜¯é€šè¿‡ä¸­æ–­å®ç°çš„ï¼Œå¹¶ä¸”ä¸­æ–­æ˜¯å”¯ä¸€é€”å¾„ã€‚</font>æ ¸å¿ƒæ€â€”&gt;ç”¨æˆ·æ€çš„åˆ‡æ¢æ˜¯é€šè¿‡æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œå°†ç¨‹åºçŠ¶æ€å­—(PSW)çš„æ ‡å¿—ä½è®¾ç½®ä¸ºâ€ç”¨æˆ·æ€â€ã€‚</li></ul><h4 id="1-3-1ä¸­æ–­çš„åˆ†ç±»"><a href="#1-3-1ä¸­æ–­çš„åˆ†ç±»" class="headerlink" title="1.3.1ä¸­æ–­çš„åˆ†ç±»"></a>1.3.1ä¸­æ–­çš„åˆ†ç±»</h4><p><img src="/2021/03/15/operate/%E4%B8%AD%E6%96%AD%E7%9A%84%E5%88%86%E7%B1%BB-1615794509248.PNG"></p><p><font color="red">çœ‹ä¸­æ–­æ˜¯æ¥è‡ªCPUå†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ã€‚</font></p><p><img src="/2021/03/15/operate/%E4%B8%AD%E6%96%AD%E7%9A%84%E5%88%86%E7%B1%BB1-1615794509248.PNG"></p><h3 id="1-4-ç³»ç»Ÿè°ƒç”¨"><a href="#1-4-ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="1.4 ç³»ç»Ÿè°ƒç”¨"></a>1.4 ç³»ç»Ÿè°ƒç”¨</h3><ul><li>ç³»ç»Ÿè°ƒç”¨æ˜¯æ“ä½œç³»ç»Ÿæä¾›ç»™åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ¥å£ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ç§å¯ä¾›åº”ç”¨ç¨‹åºè°ƒç”¨çš„ç‰¹æ®Šå‡½æ•°ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å‘å‡ºç³»ç»Ÿè°ƒç”¨æ¥è¯·æ±‚æ“ä½œç³»ç»Ÿçš„æœåŠ¡ã€‚</li><li>ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°æœ‰åŒºåˆ«ã€‚</li></ul><h3 id="1-4-1åº“å‡½æ•°å’Œç³»ç»Ÿè°ƒç”¨çš„å…³ç³»"><a href="#1-4-1åº“å‡½æ•°å’Œç³»ç»Ÿè°ƒç”¨çš„å…³ç³»" class="headerlink" title="1.4.1åº“å‡½æ•°å’Œç³»ç»Ÿè°ƒç”¨çš„å…³ç³»"></a>1.4.1åº“å‡½æ•°å’Œç³»ç»Ÿè°ƒç”¨çš„å…³ç³»</h3><p><img src="/2021/03/15/operate/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-1615794509248.PNG"></p><ul><li>ä¼ é€’ç³»ç»Ÿè°ƒç”¨å‚æ•°â€”&gt;æ‰§è¡Œé™·å…¥æŒ‡ä»¤ï¼ˆç”¨æˆ·æ€ï¼‰â€”&gt;æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ç›¸åº”çš„æœåŠ¡ç¨‹åº(æ ¸å¿ƒæ€)â€”&gt;è¿”å›ç”¨æˆ·ç¨‹åº</li><li>é™·å…¥æŒ‡ä»¤æ˜¯åœ¨ç”¨æˆ·æ€æ‰§è¡Œçš„ï¼Œæ‰§è¡Œé™·å…¥æŒ‡ä»¤ä¹‹åç«‹å³å¼•å‘ä¸€ä¸ªå†…ä¸­æ–­ï¼Œä»è€ŒCPUè¿›å…¥æ ¸å¿ƒæ€ã€‚</li><li>å‘å‡ºç³»ç»Ÿè°ƒç”¨è¯·æ±‚æ˜¯åœ¨ç”¨æˆ·æ€ï¼Œè€Œå¯¹ç³»ç»Ÿè°ƒç”¨çš„ç›¸åº”å¤„ç†åœ¨æ ¸å¿ƒæ€è¿›è¡Œã€‚</li><li>é™·å…¥æŒ‡ä»¤æ˜¯å”¯ä¸€ä¸€ä¸ªåªèƒ½åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼Œè€Œä¸å¯åœ¨æ ¸å¿ƒæ€æ‰§è¡Œçš„æŒ‡ä»¤</li><li>å‡¡æ˜¯ä¸èµ„æºæœ‰å…³çš„æ“ä½œã€ä¼šç›´æ¥å½±å“åˆ°å…¶ä»–è¿›ç¨‹çš„æ“ä½œï¼Œä¸€å®šéœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥ï¼Œéœ€è¦ç³»ç»Ÿè°ƒç”¨æ¥å®ç°ã€‚</li></ul><h2 id="2-è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#2-è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="2. è¿›ç¨‹ä¸çº¿ç¨‹"></a>2. è¿›ç¨‹ä¸çº¿ç¨‹</h2><h3 id="2-1-çŠ¶æ€è½¬ç§»"><a href="#2-1-çŠ¶æ€è½¬ç§»" class="headerlink" title="2.1 çŠ¶æ€è½¬ç§»"></a>2.1 çŠ¶æ€è½¬ç§»</h3><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81-1615794509248.PNG"></p><ul><li>ä¸ºäº†æ–¹ä¾¿å¯¹å„ä¸ªè¿›ç¨‹çš„ç®¡ç†ï¼Œæ“ä½œç³»ç»Ÿå°†è¿›è½¦ç»™åˆ’åˆ†ä¸ºå‡ ç§çŠ¶æ€ï¼Œä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼š<ol><li>è¿è¡Œæ€</li><li>å°±ç»ªæ€</li><li>é˜»å¡æ€</li></ol></li></ul><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%811-1615794509248.PNG"></p><h3 id="2-2-è¿›ç¨‹æ§åˆ¶"><a href="#2-2-è¿›ç¨‹æ§åˆ¶" class="headerlink" title="2.2 è¿›ç¨‹æ§åˆ¶"></a>2.2 è¿›ç¨‹æ§åˆ¶</h3><p>å¯¹ç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿›ç¨‹è¿›è¡Œæœ‰æ•ˆç®¡ç†ã€‚</p><ul><li>ä½¿ç”¨åŸè¯­å¯¹è¿›ç¨‹çš„æ§åˆ¶ã€‚</li></ul><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6-1615794509249.PNG"></p><p>è¿›ç¨‹æ§åˆ¶åŸè¯­è¦åšä¸‰ç±»äº‹æƒ…ï¼š</p><ul><li>æ›´æ–°PCBä¸­çš„ä¿¡æ¯ï¼ˆå¦‚ä¿®æ”¹è¿›ç¨‹çŠ¶æ€æ ‡å¿—ã€å°†è¿è¡Œç¯å¢ƒä¿å­˜åˆ°PCBï¼‰<ol><li>æ‰€æœ‰è¿›ç¨‹æ§åˆ¶åŸè¯­ä¸€å®šéƒ½ä¼šä¿®æ”¹è¿›ç¨‹çŠ¶æ€æ ‡å¿—</li><li>å‰¥å¤ºå½“å‰è¿è¡Œè¿›ç¨‹çš„CPUä½¿ç”¨æƒå¿…ç„¶éœ€è¦ä¿å­˜å…¶è¿è¡Œç¯å¢ƒ</li><li>æŸè¿›ç¨‹å¼€å§‹è¿è¡Œå‰å¿…ç„¶è¦å›å¤è¿è¡Œç¯å¢ƒ</li></ol></li><li>å°†PCBæ’å…¥åˆé€‚é˜Ÿåˆ—</li><li>åˆ†é…/å›æ”¶èµ„æº</li></ul><ol><li>è¿›ç¨‹åˆ›å»ºåŸè¯­</li></ol><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B62-1615794509249.PNG"></p><ol start="2"><li>è¿›ç¨‹æ’¤é”€åŸè¯­</li></ol><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E7%BB%88%E6%AD%A2-1615794509249.PNG"></p><ol start="3"><li>è¿›ç¨‹é˜»å¡å’Œå”¤é†’</li></ol><p>é˜»å¡å’Œå”¤é†’æ˜¯æˆå¯¹å‡ºç°çš„ã€‚</p><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B63-1615794509249.PNG"></p><ol start="4"><li>è¿›ç¨‹çš„åˆ‡æ¢åŸè¯­</li></ol><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B64-1615794509249.PNG"></p><h3 id="2-3-è¿›ç¨‹é€šä¿¡"><a href="#2-3-è¿›ç¨‹é€šä¿¡" class="headerlink" title="2.3 è¿›ç¨‹é€šä¿¡"></a>2.3 è¿›ç¨‹é€šä¿¡</h3><ul><li>è¿›ç¨‹ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢å’Œä¼ é€’ã€‚</li><li>æ“ä½œç³»ç»Ÿé€šä¿¡åˆ†ç±»</li></ul><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1-1615794509249.PNG"></p><ol><li>å…±äº«å­˜å‚¨</li></ol><p><img src="/2021/03/15/operate/%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8-1615794509249.PNG"></p><ol start="2"><li>ç®¡é“é€šä¿¡</li></ol><p><img src="/2021/03/15/operate/%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1-1615794509249.PNG"></p><ol start="3"><li>æ¶ˆæ¯ä¼ é€’</li></ol><p><img src="/2021/03/15/operate/%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92-1615794509249.PNG"></p><h3 id="2-4-è¿›ç¨‹è°ƒåº¦"><a href="#2-4-è¿›ç¨‹è°ƒåº¦" class="headerlink" title="2.4 è¿›ç¨‹è°ƒåº¦"></a>2.4 è¿›ç¨‹è°ƒåº¦</h3><p>è°ƒåº¦æœ‰ä¸‰ä¸ªå±‚æ¬¡ï¼š</p><ol><li>é«˜çº§è°ƒåº¦ ï¼ˆè°ƒå…¥å†…å­˜ï¼‰</li></ol><p><img src="/2021/03/15/operate/%E9%AB%98%E7%BA%A7%E8%B0%83%E5%BA%A6-1615794509249.PNG"></p><ol start="2"><li>ä¸­çº§è°ƒåº¦</li></ol><p><img src="/2021/03/15/operate/%E4%B8%AD%E7%BA%A7%E8%B0%83%E5%BA%A6-1615794509249.PNG"></p><ul><li>æŒ‚èµ·çŠ¶æ€çš„ä¸ƒçŠ¶æ€æ¨¡å‹</li></ul><p><img src="/2021/03/15/operate/%E6%8C%82%E8%B5%B77%E7%8A%B6%E6%80%81-1615794509249.PNG"></p><ul><li>ä½çº§è°ƒåº¦ï¼ˆè¿›ç¨‹è°ƒåº¦ï¼‰</li></ul><p><img src="/2021/03/15/operate/%E4%BD%8E%E7%BA%A7%E8%B0%83%E5%BA%A6-1615794509249.PNG"></p><h3 id="2-5-è¿›ç¨‹è°ƒåº¦æ—¶æœºå’Œåˆ‡æ¢è¿‡ç¨‹"><a href="#2-5-è¿›ç¨‹è°ƒåº¦æ—¶æœºå’Œåˆ‡æ¢è¿‡ç¨‹" class="headerlink" title="2.5 è¿›ç¨‹è°ƒåº¦æ—¶æœºå’Œåˆ‡æ¢è¿‡ç¨‹"></a>2.5 è¿›ç¨‹è°ƒåº¦æ—¶æœºå’Œåˆ‡æ¢è¿‡ç¨‹</h3><h4 id="2-5-1-è°ƒåº¦ç®—æ³•"><a href="#2-5-1-è°ƒåº¦ç®—æ³•" class="headerlink" title="2.5.1 è°ƒåº¦ç®—æ³•"></a>2.5.1 è°ƒåº¦ç®—æ³•</h4><ol><li>å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFS)</li></ol><ul><li>ä¸»è¦ä»å…¬å¹³çš„è§’åº¦è€ƒè™‘ã€‚</li><li>ç”¨äºè¿›ç¨‹è°ƒåº¦æ—¶ï¼Œè€ƒè™‘çš„æ˜¯å“ªä¸ªè¿›ç¨‹å…ˆåˆ°è¾¾å°±ç»ªé˜Ÿåˆ—ã€‚</li><li>éæŠ¢å å¼ç®—æ³•ã€‚</li></ul><ol start="2"><li>çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰</li></ol><ul><li>å½“å‰åˆ°è¾¾çš„è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹ã€‚ï¼ˆé»˜è®¤éæŠ¢å å¼ï¼‰</li><li>æŠ¢å å¼çš„çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ã€‚</li></ul><p>æ¯å½“æœ‰è¿›ç¨‹åŠ å…¥å°±ç»ªé˜Ÿåˆ—å°±éœ€è¦é‡æ–°è°ƒåº¦ã€‚å¦‚æœæ–°åˆ°è¾¾çš„è¿›ç¨‹å‰©ä½™æ—¶é—´æ¯”å½“å‰è¿è¡Œçš„è¿›ç¨‹å‰©ä½™æ—¶é—´æ›´çŸ­ï¼Œåˆ™æ–°è¿›ç¨‹æŠ¢å å¤„ç†æœºã€‚</p><ol start="3"><li>é«˜å“åº”ä¼˜å…ˆï¼ˆHRRN)</li></ol><ul><li><p>éæŠ¢å å¼ç®—æ³•</p></li><li><p>æ¯æ¬¡è°ƒåº¦æ—¶å…ˆè®¡ç®—å„ä¸ªè¿›ç¨‹çš„å“åº”æ¯”ï¼Œé€‰æ‹©å“åº”æ¯”æœ€é«˜çš„ä½œä¸š/è¿›ç¨‹ä¸ºå…¶æœåŠ¡ã€‚</p></li><li><p>å“åº”æ¯”= ï¼ˆç­‰å¾…æ—¶é—´+è¦æ±‚æœåŠ¡æ—¶é—´ï¼‰/è¦æ±‚æœåŠ¡æ—¶é—´</p></li></ul><p>tips:è¿™ä¸‰ç§ç®—æ³•ä¸»è¦é€‚ç”¨äºæ—©æœŸçš„æ‰¹å¤„ç†ç³»ç»Ÿã€‚</p><h3 id="2-5-2-æ–°è°ƒåº¦ç®—æ³•"><a href="#2-5-2-æ–°è°ƒåº¦ç®—æ³•" class="headerlink" title="2.5.2 æ–°è°ƒåº¦ç®—æ³•"></a>2.5.2 æ–°è°ƒåº¦ç®—æ³•</h3><ol><li>æ—¶é—´ç‰‡è½®è½¬</li></ol><ul><li><p>æŒ‰ç…§å„ä¸ªè¿›ç¨‹åˆ°è¾¾å°±ç»ªé˜Ÿåˆ—çš„é¡ºåºï¼Œè½®æµè®©å„ä¸ªè¿›ç¨‹æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ã€‚è‹¥è¿›ç¨‹æœªåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…æ‰§è¡Œå®Œï¼Œåˆ™å‰¥å¤ºå¤„ç†æœºï¼Œå°†è¿›ç¨‹é‡æ–°æ”¾åˆ°å°±ç»ªé˜Ÿåˆ—é˜Ÿå°¾é‡æ–°æ’é˜Ÿã€‚</p></li><li><p>åˆ†æ—¶æ“ä½œç³»ç»Ÿ</p></li><li><p>å¦‚æœæ—¶é—´ç‰‡å¤ªå¤§ï¼Œå°±ä¼šé€€åŒ–ä¸ºå…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ã€‚</p></li><li><p>æ—¶é—´ç‰‡å¤ªå°ï¼Œè¿›ç¨‹åˆ‡æ¢å¤ªé¢‘ç¹ã€‚</p></li><li><p>åˆ‡æ¢è¿›ç¨‹çš„å¼€é”€ä¸è¶…è¿‡1%æ‰æ˜¯åˆé€‚çš„æ—¶é—´ç‰‡ã€‚</p></li></ul><ol start="2"><li>ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</li></ol><ul><li><p>ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹è®¾ç½®ä¼˜å…ˆçº§ï¼Œé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„è¿›ç¨‹</p></li><li><p>éæŠ¢å å¼</p></li><li><p>æŠ¢å å¼</p></li></ul><p>å½“å‰å‡ºç°çš„è¿›ç¨‹ä¼˜å…ˆçº§æœ€é«˜ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§é«˜çš„ä¼šæŠ¢å å¤„ç†æœºã€‚</p><ul><li>æ“ä½œç³»ç»Ÿä¼šæ›´åå¥½I/Oå‹è¿›ç¨‹</li></ul><ol start="3"><li>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ï¼ˆæŠ˜ä¸­å¹³è¡¡ï¼‰</li></ol><ul><li>å¯¹å…¶ä»–è°ƒåº¦ç®—æ³•çš„æŠ˜ä¸­æƒè¡¡</li><li>æŠ¢å å¼ç®—æ³•</li></ul><p><img src="/2021/03/15/operate/%E5%A4%9A%E7%BA%A7%E5%8F%8D%E9%A6%88%E9%98%9F%E5%88%97-1615794509250.PNG"></p><ul><li>æ³¨æ„æ–°è¿›ç¨‹å…ˆè¿›å…¥ç¬¬ä¸€çº§é˜Ÿåˆ—ã€‚</li><li>ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—å†…å®¹ä¼šæŠ¢å å¤„ç†æœºã€‚</li></ul><h3 id="2-6-è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥"><a href="#2-6-è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥" class="headerlink" title="2.6 è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥"></a>2.6 è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥</h3><ul><li><p>å¼‚æ­¥æ€§ï¼šå„å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹å„è‡ªç‹¬ç«‹ã€ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦æ¨è¿›ã€‚</p><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E4%BA%92%E6%96%A5-1615794509250.PNG"></p></li><li><p>è¿›ç¨‹äº’æ–¥çš„å››ä¸ªåŸåˆ™</p></li></ul><p><img src="/2021/03/15/operate/%E4%BA%92%E6%96%A5%E7%9A%84%E5%9B%9B%E4%B8%AA%E5%8E%9F%E5%88%99-1615794509250.PNG"></p><ol start="2"><li><p>è½¯ä»¶å®ç°æ–¹æ³•</p></li><li><p>å•æ ‡å¿—æ³•</p></li></ol><p>ä¸¤ä¸ªè¿›ç¨‹åœ¨è®¿é—®å®Œä¸´ç•ŒåŒºåä¼šæŠŠé€‚ç”¨ä¸´ç•ŒåŒºçš„æƒé™è½¬äº¤ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºçš„æƒé™åªèƒ½è¢«å¦ä¸€ä¸ªè¿›ç¨‹èµ‹äºˆã€‚</p><ul><li>è¿èƒŒäº†ç©ºé—²è®©è¿›åŸåˆ™</li></ul><ol start="2"><li>åŒæ ‡å¿—å…ˆæ£€æŸ¥</li></ol><p>è®¾ç½®å¸ƒå°”å‹æ•°ç»„ï¼Œæ•°ç»„ä¸­å„ä¸ªå…ƒç´ æ¥æ ‡è®°å„è¿›ç¨‹æƒ³è¿›å…¥ä¸´ç•ŒåŒºçš„æ„æ„¿ã€‚</p><ul><li>è¿èƒŒå¿™åˆ™ç­‰å¾…åŸåˆ™</li></ul><p><img src="/2021/03/15/operate/%E5%8F%8C%E6%A0%87%E5%BF%97%E6%A3%80%E6%9F%A5%E6%B3%95-1615794509250.PNG"></p><ol start="3"><li>åŒæ ‡å¿—åæ£€æŸ¥</li></ol><p><img src="/2021/03/15/operate/%E5%8F%8C%E6%A0%87%E5%BF%97%E5%90%8E%E6%A3%80%E6%9F%A5-1615794509250.PNG"></p><ul><li>è¿èƒŒäº†â€œç©ºé—²è®©è¿›â€å’Œâ€œæœ‰é™ç­‰å¾…â€</li></ul><ol start="4"><li>Petersonç®—æ³•</li></ol><ul><li>å­”èè®©æ¢¨</li></ul><p><img src="/2021/03/15/operate/peterson%E6%A3%80%E6%9F%A5-1615794509250.PNG"></p><h3 id="2-7-ä¿¡å·é‡æœºåˆ¶"><a href="#2-7-ä¿¡å·é‡æœºåˆ¶" class="headerlink" title="2.7 ä¿¡å·é‡æœºåˆ¶"></a>2.7 ä¿¡å·é‡æœºåˆ¶</h3><ul><li>ä¿¡å·é‡å…¶å®å°±æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥è¡¨ç¤ºç³»ç»Ÿä¸­æŸç§èµ„æºçš„æ•°é‡ã€‚</li></ul><ol><li>æ•´å‹ä¿¡å·é‡</li></ol><ul><li><p>è¡¨ç¤ºç³»ç»Ÿä¸­æŸç§èµ„æºçš„æ•°é‡ã€‚</p></li><li><p>ä¸€ç›´ç­‰å¾…</p></li></ul><ol start="2"><li>è®°å½•å‹ä¿¡å·é‡</li></ol><ul><li>è§£å†³å¿™ç­‰é—®é¢˜</li></ul><ul><li>ä¿¡å·é‡æœºåˆ¶åœ¨â€œå‰æ“ä½œâ€ä¹‹åå¯¹ç›¸åº”çš„åŒæ­¥å˜é‡æ‰§è¡ŒVæ“ä½œã€‚</li><li>åœ¨â€œåæ“ä½œâ€ä¹‹å‰å¯¹ç›¸åº”çš„åŒæ­¥å˜é‡æ‰§è¡ŒPæ“ä½œã€‚</li></ul><h3 id="2-8-ç®¡ç¨‹"><a href="#2-8-ç®¡ç¨‹" class="headerlink" title="2.8 ç®¡ç¨‹"></a>2.8 ç®¡ç¨‹</h3><p>é«˜çº§çš„åŒæ­¥æœºåˆ¶ã€‚å› ä¸ºPVæ“ä½œè¿˜å¾—ç¨‹åºå‘˜è‡ªå·±å†™å¾ˆå¤æ‚ï¼Œæ‰€ä»¥ç®¡ç¨‹ç›¸å½“äºæŠŠè¿™äº›æ“ä½œå°è£…æˆä¸€ä¸ªç±»ã€‚</p><p>ç®¡ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›å®šä¹‰çš„å‡½æ•°ã€‚</p><p>æ¯æ¬¡åªå…è®¸ä¸€ä¸ªè¿›ç¨‹åœ¨ç®¡ç¨‹å†…æ‰§è¡ŒæŸä¸ªå†…éƒ¨è¿‡ç¨‹ã€‚ </p><h3 id="2-9-æ­»é”"><a href="#2-9-æ­»é”" class="headerlink" title="2.9 æ­»é”"></a>2.9 æ­»é”</h3><p>è¿›ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå„ä¸ªè¿›ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹æ‰‹é‡Œçš„èµ„æºï¼Œå¯¼è‡´è¢«é˜»å¡éƒ½æ— æ³•å‘å‰æ¨è¿›ã€‚</p><ul><li>é¥¥é¥¿ã€‚ç”±äºé•¿æœŸå¾—ä¸åˆ°æƒ³è¦çš„èµ„æºï¼ŒæŸè¿›ç¨‹æ— æ³•å‘å‰æ¨è¿›çš„ç°è±¡ã€‚ï¼ˆæ“ä½œç³»ç»Ÿåˆ†é…èµ„æºä¸åˆç†ï¼Œæ¯”å¦‚çŸ­è¿›ç¨‹ä¼˜å…ˆç®—æ³•ï¼‰ã€‚</li><li>æ­»å¾ªç¯ã€‚æŸè¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸€ç›´è·³ä¸å‡ºæ¥çš„ç°è±¡ã€‚</li></ul><ol><li>é¢„é˜²æ­»é”ã€‚</li></ol><p>ç ´åæ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªã€‚</p><ul><li>ç ´åä¸å¯å‰¥å¤ºæ¡ä»¶</li></ul><p>a å½“æŸä¸ªè¿›ç¨‹è¯·æ±‚æ–°çš„èµ„æºå¾—ä¸åˆ°æ»¡è¶³æ—¶ï¼Œå®ƒå¿…é¡»ç«‹å³é‡Šæ”¾æ‰€æœ‰èµ„æºï¼Œå¾…ä»¥åéœ€è¦æ—¶å†é‡æ–°ç”³è¯·ã€‚å³ä½¿æŸäº›èµ„æºå°šæœªä½¿ç”¨å®Œï¼Œä¹Ÿéœ€è¦ä¸»åŠ¨é‡Šæ”¾ï¼Œä»è€Œç ´åäº†ä¸å¯å‰¥å¤ºæ¡ä»¶ã€‚</p><p>å¯èƒ½ä¼šé€ æˆæŸä¸ªè¿›ç¨‹ä¹‹å‰å¾—å·¥ä½œå¤±æ•ˆã€‚</p><ul><li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶</li></ul><p>è§£é‡Šï¼šè¿›ç¨‹å·²ç»ä¿æŒäº†ä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯æå‡ºæ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºåˆè¢«å…¶ä»–è¿›ç¨‹æ‰€å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹è¢«é˜»å¡ï¼Œä½†æ˜¯åˆå¯¹è‡ªå·±æœ‰çš„èµ„æºä¿æŒä¸æ”¾ã€‚</p><p>a å¯ä»¥é‡‡ç”¨é™æ€åˆ†é…æ–¹æ³•ï¼Œå³è¿›ç¨‹åœ¨è¿è¡Œå‰ç”³è¯·å®Œå®ƒæ‰€éœ€è¦çš„å…¨éƒ¨èµ„æºï¼Œåœ¨å®ƒçš„èµ„æºæœªæ»¡è¶³å‰ï¼Œä¸è®©å®ƒæŠ•å…¥è¿è¡Œã€‚</p><ul><li>ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶</li></ul><p>a é‡‡ç”¨é¡ºåºèµ„æºåˆ†é…æ³•ã€‚é¦–å…ˆç»™ç³»ç»Ÿä¸­çš„èµ„æºç¼–å·ï¼Œè§„å®šæ¯ä¸ªè¿›ç¨‹å¿…é¡»æŒ‰ç…§ç¼–å·é€’å¢çš„é¡ºåºè¯·æ±‚èµ„æºã€‚åŒç±»èµ„æºï¼ˆå³ç¼–å·ç›¸åŒçš„èµ„æºï¼‰ä¸€æ¬¡ç”³è¯·å®Œã€‚ï¼ˆä¸€ä¸ªè¿›ç¨‹åªæœ‰å°çš„èµ„æºæ‰èƒ½ç”³è¯·å¤§çš„èµ„æºï¼Œæœ‰å¤§çš„èµ„æºåä¸ä¼šå†ç”³è¯·å°çš„èµ„æºï¼‰ã€‚</p><ol start="2"><li>é¿å…æ­»é”ã€‚</li></ol><p>ç”¨æŸç§æ–¹æ³•é˜²æ­¢ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œä»è€Œé¿å…æ­»é”ï¼ˆé“¶è¡Œå®¶ç®—æ³•ï¼‰ã€‚</p><ul><li>é“¶è¡Œå®¶ç®—æ³•</li></ul><p>å¦‚æœåˆ†é…äº†èµ„æºä¹‹åï¼Œæ‰¾ä¸åˆ°ä»»ä½•ä¸€ç§å®‰å…¨åºåˆ—ï¼Œç³»ç»Ÿè¿›å…¥äº†ä¸å®‰å…¨çŠ¶æ€ã€‚</p><p>a æ£€æŸ¥æ­¤æ¬¡ç”³è¯·æ˜¯å¦è¶…è¿‡äº†ä¹‹å‰å£°æ˜çš„æœ€å¤§éœ€æ±‚æ•°</p><p>b æ£€æŸ¥æ­¤æ—¶ç³»ç»Ÿå‰©ä½™çš„å¯ç”¨èµ„æºæ˜¯å¦è¿˜èƒ½æ»¡è¶³è¿™æ¬¡è¯·æ±‚</p><p>c è¯•æ¢åˆ†é…ï¼Œæ›´æ”¹å„æ•°æ®ç»“æ„</p><p>d ç”¨å®‰å…¨ç®—æ³•æ£€æŸ¥æ­¤æ¬¡åˆ†é…æ˜¯å¦ä¼šå¯¼è‡´ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€</p><ol start="3"><li>æ­»é”çš„æ£€æµ‹å’Œé¿å…ã€‚</li></ol><p>å…è®¸æ­»é”çš„å‘ç”Ÿï¼Œä¸è¿‡æ“ä½œç³»ç»Ÿä¼šè´Ÿè´£æ£€æµ‹å‡ºæ­»é”çš„å‘ç”Ÿï¼Œç„¶åé‡‡å–æŸç§æªæ–½è§£é™¤æ­»é”ã€‚</p><p><font color="red"> æ­»é”å®šç†</font>ï¼šå¦‚æœæŸæ—¶åˆ»ç³»ç»Ÿçš„èµ„æºåˆ†é…å›¾æ˜¯ä¸å¯å®Œå…¨ç®€åŒ–çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶ç³»ç»Ÿæ­»é”ã€‚</p><p>ç”¨æ­»é”æ£€æµ‹ç®—æ³•ç®€åŒ–èµ„æºåˆ†é…å›¾åï¼Œè¿˜è¿è¿™è¾¹çš„é‚£äº›è¿›ç¨‹å°±æ˜¯æ­»é”è¿›ç¨‹ã€‚</p><p>è§£é™¤æ­»é”çš„å‡ ç§æ–¹æ³•ï¼š</p><ul><li>èµ„æºå‰¥å¤ºæ³•ã€‚æŒ‚èµ·æŸäº›æ­»é”è¿›ç¨‹ï¼Œå¹¶æŠ¢å å®ƒçš„èµ„æºï¼Œå°†å®ƒçš„èµ„æºåˆ†é…ç»™å…¶ä»–æ­»é”è¿›ç¨‹ã€‚ä½†æ˜¯åº”è¯¥é˜²æ­¢è¢«æŒ‚èµ·çš„è¿›ç¨‹é•¿æ—¶é—´å¾—ä¸åˆ°èµ„æºè€Œé¥¥é¥¿ã€‚</li><li>æ’¤é”€è¿›ç¨‹æ³•ã€‚å¼ºåˆ¶æ’¤é”€éƒ¨åˆ†ã€ç”šè‡³å…¨éƒ¨æ­»é”è¿›ç¨‹ï¼Œå¹¶å‰¥å¤ºè¿™äº›è¿›ç¨‹çš„èµ„æºã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œä½†æ‰€ä»˜å‡ºçš„ä»£ä»·å¯èƒ½å¾ˆå¤§ã€‚å› ä¸ºæœ‰äº›è¿›ç¨‹è¿è¡Œäº†å¾ˆé•¿æ—¶é—´æ¥è¿‘ç»“æŸã€‚</li><li>è¿›ç¨‹å›é€€æ³•ï¼š è®©ä¸€ä¸ªæˆ–å¤šä¸ªæ­»é”è¿›ç¨‹å›é€€åˆ°è¶³ä»¥é¿å…æ­»é”çš„åœ°æ­¥ã€‚è¿™å°±è¦æ±‚ç³»ç»Ÿè®°å½•è¿›ç¨‹çš„å†å²ä¿¡æ¯ï¼Œè®¾ç½®è¿˜åŸç‚¹ã€‚</li></ul><h3 id="3-å†…å­˜ç®¡ç†"><a href="#3-å†…å­˜ç®¡ç†" class="headerlink" title="3. å†…å­˜ç®¡ç†"></a>3. å†…å­˜ç®¡ç†</h3><h4 id="3-1-åœ°å€è½¬æ¢"><a href="#3-1-åœ°å€è½¬æ¢" class="headerlink" title="3.1 åœ°å€è½¬æ¢"></a>3.1 åœ°å€è½¬æ¢</h4><p>ä¸‰ç§è£…å…¥æ–¹å¼ï¼š</p><p>a ç»å¯¹è£…å…¥ ç¼–è¯‘æ—¶äº§ç”Ÿç»å¯¹åœ°å€ ï¼ˆç¼–è¯‘å™¨è´Ÿè´£ï¼‰</p><p>b å¯é‡å®šä½è£…å…¥ è£…å…¥æ—¶å°†é€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼ˆè£…å…¥å™¨åœ°å€ï¼‰</p><p>c åŠ¨æ€è¿è¡Œæ—¶è£…å…¥ è¿è¡Œæ—¶å°†é€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œéœ€è®¾ç½®é‡å®šä½å¯„å­˜å™¨ ï¼ˆç°ä»£æ“ä½œç³»ç»Ÿï¼‰</p><h4 id="3-2-å†…å­˜ä¿æŠ¤"><a href="#3-2-å†…å­˜ä¿æŠ¤" class="headerlink" title="3.2 å†…å­˜ä¿æŠ¤"></a>3.2 å†…å­˜ä¿æŠ¤</h4><p>ä¸€ä¸ªè¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„å†…å­˜ç©ºé—´ã€‚</p><p>ä¸¤ç§æ–¹å¼ï¼š</p><p>a è®¾ç½®ä¸Šä¸‹é™å¯„å­˜å™¨</p><p>b åˆ©ç”¨é‡å®šä½å¯„å­˜å™¨ã€ç•Œåœ°å€å¯„å­˜å™¨ï¼ˆé™é•¿å¯„å­˜å™¨ï¼‰</p><h4 id="4-3-è¦†ç›–ä¸äº¤æ¢"><a href="#4-3-è¦†ç›–ä¸äº¤æ¢" class="headerlink" title="4.3 è¦†ç›–ä¸äº¤æ¢"></a>4.3 è¦†ç›–ä¸äº¤æ¢</h4><p>è¦†ç›–æŠ€æœ¯ï¼š</p><p><img src="/2021/03/15/operate/%E8%A6%86%E7%9B%96%E6%8A%80%E6%9C%AF-1615794509250.PNG"></p><p>äº¤æ¢æŠ€æœ¯ï¼š</p><p>å†…å­˜ç´§å¼ ï¼Œå†…å­˜ä¸­æŸäº›è¿›ç¨‹æš‚æ—¶æ¢å‡ºå¤–å­˜ã€‚ </p><p>å¯¹æ¢åŒºå’Œæ–‡ä»¶åŒºã€‚</p><h4 id="4-4-è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼"><a href="#4-4-è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼" class="headerlink" title="4.4 è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼"></a>4.4 è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</h4><p>a å›ºå®šåˆ†åŒº</p><p>b å•ä¸€è¿ç»­åˆ†é…æ–¹å¼</p><ul><li>åˆ†åŒºè¯´æ˜è¡¨ </li></ul><p><img src="/2021/03/15/operate/%E5%9B%BA%E5%AE%9A%E5%88%86%E5%8C%BA%E5%88%86%E9%85%8D-1615794509250.PNG"></p><p>åŠ¨æ€åˆ†åŒºåˆ†é…ï¼šä¸ä¼šé¢„å…ˆåˆ’åˆ†å†…å­˜åˆ†åŒºï¼Œè€Œæ˜¯åœ¨è¿›ç¨‹è£…å…¥å†…å­˜æ—¶æ ¹æ®è¿›ç¨‹çš„å¤§å°åŠ¨æ€å»ºç«‹åˆ†åŒºã€‚</p><p>ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼šç©ºé—²åˆ†åŒºè¡¨å’Œç©ºé—²åˆ†åŒºé“¾ã€‚</p><p><font color="red">åŠ¨æ€åˆ†åŒºåˆ†é…ç®—æ³•:</font></p><p>æ¦‚å¿µï¼šåœ¨åŠ¨æ€åˆ†åŒºåˆ†é…æ–¹å¼ä¸­ï¼Œå½“æœ‰å¾ˆå¤šä¸ªç©ºé—²åˆ†åŒºéƒ½èƒ½æ»¡è¶³éœ€æ±‚æ—¶ï¼Œåº”è¯¥é€‰æ‹©å“ªä¸ªåˆ†åŒºè¿›è¡Œåˆ†é…ï¼Ÿ</p><ul><li>é¦–æ¬¡é€‚åº”ç®—æ³•(First Fit)</li></ul><p>æ¯æ¬¡éƒ½ä»æœ€ä½åœ°å€å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³å¤§å°çš„ç©ºé—²åˆ†åŒºã€‚ç©ºé—²åˆ†åŒºä»¥åœ°å€é€’å¢çš„æ¬¡åºæ’åˆ—ã€‚æ¯æ¬¡åˆ†é…å†…å­˜æ—¶é¡ºåºæŸ¥æ‰¾ç©ºé—²åˆ†åŒºé“¾ï¼Œæ‰¾åˆ°å¤§å°èƒ½æ»¡è¶³è¦æ±‚çš„ç¬¬ä¸€ä¸ªç©ºé—²åˆ†åŒºã€‚</p><ul><li>æœ€ä½³é€‚åº”ç®—æ³•(Best Fit)</li></ul><p>ï¼ˆä¸ºåˆ†åŒºå¤§å°æ’äº†åºï¼‰ä¸ºå„ä¸ªè¿›ç¨‹åˆ†é…çš„ç©ºé—´å¿…é¡»æ˜¯è¿ç»­çš„ä¸€æ•´ç‰‡åŒºåŸŸã€‚å› æ­¤ä¸ºäº†ä¿è¯â€œå¤§è¿›ç¨‹â€åˆ°æ¥æ—¶èƒ½æœ‰è¿ç»­çš„å¤§ç‰‡ç©ºé—´ï¼Œå¯ä»¥å°½å¯èƒ½å¤šåœ°ç•™ä¸‹å¤§ç‰‡çš„ç©ºé—²åŒºï¼Œä¼˜å…ˆä½¿ç”¨æ›´å°çš„ç©ºé—²åŒºã€‚</p><ul><li>æœ€åé€‚åº”ç®—æ³•(Worst Fit)</li></ul><p>ä¼˜å…ˆä½¿ç”¨æœ€å¤§çš„è¿ç»­ç©ºé—²åˆ†åŒºã€‚ï¼ˆä¸ºäº†è§£å†³æœ€ä½³é€‚åº”ç®—æ³•ç•™ä¸‹å¤ªå¤šéš¾ä»¥åˆ©ç”¨çš„å°ç¢ç‰‡ï¼‰ã€‚</p><ul><li>é‚»è¿‘é€‚åº”ç®—æ³•(Next Fit)</li></ul><p>è§£å†³é¦–æ¬¡é€‚åº”ç®—æ³•ä¸­çš„é—®é¢˜ã€‚</p><p>åˆ†åŒºä»¥åœ°å€é€’å¢é¡ºåºæ’åˆ—ï¼Œæ¯æ¬¡åˆ†é…å†…å­˜ä»ä¸Šæ¬¡æŸ¥æ‰¾ç»“æŸçš„ä½ç½®å¼€å§‹æŸ¥æ‰¾ç©ºé—²åˆ†åŒºé“¾ã€‚</p><p><img src="/2021/03/15/operate/%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95-1615794509250.PNG"></p><h4 id="4-5éè¿ç»­åˆ†åŒºåˆ†é…"><a href="#4-5éè¿ç»­åˆ†åŒºåˆ†é…" class="headerlink" title="4.5éè¿ç»­åˆ†åŒºåˆ†é…"></a>4.5éè¿ç»­åˆ†åŒºåˆ†é…</h4><p>é¡µé¢å’Œé¡µæ¡†æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚é¡µå·å’Œé¡µå†…åç§»é‡ã€‚</p><p>é¡µå·=é€»è¾‘åœ°å€/é¡µé¢é•¿åº¦(å–é™¤æ³•çš„æ•´æ•°éƒ¨åˆ†)</p><p>é¡µå†…åç§»é‡=é€»è¾‘åœ°å€%é¡µé¢é•¿åº¦ï¼ˆå–é™¤æ³•çš„ä½™æ•°éƒ¨åˆ†ï¼‰</p><p><font color="red">åœ°å€è½¬æ¢ï¼š</font></p><ol><li>ç®—å‡ºé€»è¾‘åœ°å€å¯¹åº”çš„é¡µå·</li><li>è¯¥é¡µå·å¯¹åº”é¡µé¢åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€</li><li>ç®—å‡ºåç§»é‡</li><li>ç‰©ç†åœ°å€=é¡µé¢å§‹å€+é¡µå†…åç§»é‡</li></ol><p>åŸºæœ¬åœ°å€å˜æ¢æœºæ„å¯ä»¥å€ŸåŠ©è¿›ç¨‹çš„é¡µè¡¨å°†é€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ é¡µè¡¨ï¼šé¡µè¡¨å­˜å‚¨äº†å‡ ä¸ªé¡µã€‚æ¯ä¸ªé¡µå«é¡µè¡¨é¡¹ã€‚</p><p>é€šå¸¸ä¼šåœ¨ç³»ç»Ÿä¸­è®¾ç½®ä¸€ä¸ªé¡µè¡¨å¯„å­˜å™¨(PTR)ï¼Œå­˜æ”¾<font color="red">é¡µè¡¨åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€Få’Œé¡µè¡¨é•¿åº¦M</font>ã€‚è¿›ç¨‹æœªæ‰§è¡Œæ—¶ï¼Œé¡µè¡¨çš„å§‹å€å’Œé¡µè¡¨é•¿åº¦æ”¾åœ¨è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ä¸­ï¼Œå½“è¿›ç¨‹è¢«è°ƒåº¦æ—¶ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¼šæŠŠå®ƒä»¬æ”¾åœ¨é¡µè¡¨å¯„å­˜å™¨ä¸­ã€‚</p><p>æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œé¡µè¡¨é¡¹ç”±é¡µå·å’Œå—å·ç»„æˆã€‚</p><p><img src="/2021/03/15/operate/page-1615794509250.PNG"></p><ul><li></li></ul><p><img src="/2021/03/15/operate/%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2-1615794509251.PNG"></p><h3 id="4-6-å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢ç»“æ„"><a href="#4-6-å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢ç»“æ„" class="headerlink" title="4.6 å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢ç»“æ„"></a>4.6 å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢ç»“æ„</h3><ul><li><p>æ—¶é—´å±€éƒ¨æ€§</p><p>ä¸ä¹…ä¹‹åæŸæ¡æŒ‡ä»¤ä¼šå†æ¬¡è¢«æ‰§è¡Œ</p></li><li><p>ç©ºé—´å±€éƒ¨æ€§</p><p>ä¸€æ—¦ç¨‹åºè®¿é—®äº†æŸä¸ªå­˜å‚¨å•å…ƒï¼Œåœ¨ä¸ä¹…ä¹‹åï¼Œå…¶é™„è¿‘çš„å­˜å‚¨å•å…ƒä¹Ÿå¾ˆæœ‰å¯èƒ½ä¼šè¢«è®¿é—®ã€‚ï¼ˆå¾ˆå¤šæ•°æ®åœ¨å†…å­˜ä¸­éƒ½æ˜¯è¿ç»­å­˜æ”¾çš„ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œè¿ç»­å¾ˆå¤šæ¬¡æŸ¥åˆ°çš„æ˜¯åŒä¸€ä¸ªé¡µè¡¨é¡¹ã€‚</p></li></ul><p>æ¦‚å¿µï¼š å¿«è¡¨ï¼Œåˆç§°ä¸ºè”æƒ³å­˜å‚¨å™¨ï¼Œæ˜¯ä¸€ç§è®¿é—®é€Ÿåº¦æ¯”å†…å­˜å¿«å¾ˆå¤šçš„é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ã€‚</p><p><img src="/2021/03/15/operate/%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9D%80%E5%8F%98%E6%8D%A2%E6%9C%BA%E6%9E%84-1615794509250.PNG"></p><h3 id="4-7-ä¸¤çº§é¡µè¡¨"><a href="#4-7-ä¸¤çº§é¡µè¡¨" class="headerlink" title="4.7 ä¸¤çº§é¡µè¡¨"></a>4.7 ä¸¤çº§é¡µè¡¨</h3><ul><li>å•çº§é¡µè¡¨é—®é¢˜</li></ul><p>æŸè®¡ç®—æœºåœ°å€æŒ‰å­—èŠ‚å¯»å€ï¼Œæ”¯æŒ32ä½çš„é€»è¾‘åœ°å€ï¼Œé‡‡ç”¨åˆ†é¡µå­˜å‚¨ç®¡ç†ï¼Œé¡µé¢å¤§å°ä¸º4KBï¼Œé¡µè¡¨é¡¹é•¿åº¦ä¸º4Bã€‚</p><p>4KB=$2^{12}$Bï¼Œå› æ­¤é¡µå†…åœ°å€è¦ç”¨12ä½è¡¨ç¤ºï¼Œå‰©ä½™20ä½è¡¨ç¤ºé¡µå·ã€‚</p><p>å› æ­¤ï¼Œè¯¥ç³»ç»Ÿä¸­ç”¨æˆ·è¿›ç¨‹æœ€å¤šæœ‰$2^{20}$é¡µï¼Œä¸€ä¸ªè¿›ç¨‹çš„é¡µè¡¨ä¸­ï¼Œæœ€å¤šä¼šæœ‰$2^{20}=1M$ä¸ªé¡µè¡¨é¡¹ï¼Œæ‰€ä»¥ä¸€ä¸ªé¡µè¡¨é¡¹æœ€å¤§éœ€è¦$2^{20}*4B=2^{22}B$ï¼Œå…±éœ€è¦$2^{22} / 2^{12} = 2^{10}$ä¸ªé¡µæ¡†å­˜å‚¨è¯¥é¡µè¡¨ã€‚</p><ul><li>é¡µè¡¨è¦è¿ç»­å­˜æ”¾ï¼Œå› æ­¤å½“é¡µè¡¨å¾ˆå¤§ï¼Œéœ€è¦å ç”¨å¾ˆå¤šè¿ç»­é¡µæ¡†</li><li>æ²¡å¿…è¦è®©æ•´ä¸ªé¡µè¡¨å¸¸é©»å†…å­˜ï¼Œå› ä¸ºè¿›ç¨‹åœ¨ä¸€æ®µæ—¶é—´å†…åªéœ€è¦è®¿é—®æŸå‡ ä¸ªç‰¹å®šçš„é¡µé¢ã€‚</li></ul><p>å†åˆ†é…é¡µç›®å½•è¡¨ã€‚</p><ul><li>ä»£ä»·ï¼Œå¢åŠ å†…å­˜è®¿é—®æ¬¡æ•°ã€‚</li></ul><p><img src="/2021/03/15/operate/%E4%B8%A4%E7%BA%A7%E9%A1%B5%E8%A1%A8%E5%8E%9F%E7%90%86-1615794509251.PNG"></p><h4 id="4-8-åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†"><a href="#4-8-åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†" class="headerlink" title="4.8 åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†"></a>4.8 åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç†</h4><p>ä¸â€œåˆ†é¡µâ€æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ç¦»æ•£åˆ†é…æ—¶æ‰€åˆ†é…åœ°å€ç©ºé—´çš„åŸºæœ¬å•ä½ä¸åŒã€‚ æ®µè¡¨å¯„å­˜å™¨ã€‚</p><p>è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼šæŒ‰ç…§ç¨‹åºè‡ªèº«çš„é€»è¾‘å…³ç³»åˆ’åˆ†ä¸ºè‹¥å¹²æ®µï¼Œæ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªæ®µåï¼Œæ¯æ®µä»0å¼€å§‹ç¼–å€ã€‚</p><p>å†…å­˜åˆ†é…è§„åˆ™ï¼šä»¥æ®µä¸ºå•ä½è¿›è¡Œåˆ†é…ï¼Œæ¯ä¸ªæ®µåœ¨å†…å­˜ä¸­å æ®è¿ç»­ç©ºé—´ï¼Œä½†å„æ®µä¹‹é—´å¯ä»¥ä¸ç›¸é‚»ã€‚</p><p>æ¯ä¸ªè¿›ç¨‹å»ºç«‹ä¸€å¼ æ®µæ˜ å°„è¡¨ï¼Œç®€ç§°â€œæ®µè¡¨â€ã€‚</p><p><img src="/2021/03/15/operate/%E5%88%86%E6%AE%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86-1615794509251.PNG"></p><p>å’Œåˆ†é¡µç®¡ç†çš„åŒºåˆ«ï¼š</p><ul><li>åˆ†é¡µæ¯ä¸ªé¡µé¢é•¿åº¦ç›¸åŒã€‚åˆ†æ®µä¸åŒ</li><li>åˆ†é¡µä¸éœ€è¦å¯¹é¡µå†…åç§»é‡è¶Šç•Œæ£€æŸ¥ï¼Œåˆ†æ®µå¿…é¡»è¦ã€‚</li></ul><h3 id="4-9-æ®µé¡µå¼å­˜å‚¨ç®¡ç†"><a href="#4-9-æ®µé¡µå¼å­˜å‚¨ç®¡ç†" class="headerlink" title="4.9 æ®µé¡µå¼å­˜å‚¨ç®¡ç†"></a>4.9 æ®µé¡µå¼å­˜å‚¨ç®¡ç†</h3><p><img src="/2021/03/15/operate/%E6%AE%B5%E9%A1%B5%E5%BC%8F%E5%AD%98%E5%82%A8-1615794509251.PNG"></p><p>ä¸€ä¸ªè¿›ç¨‹å¯¹åº”ä¸€ä¸ªæ®µè¡¨ï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½å¯¹åº”å¤šä¸ªé¡µè¡¨ã€‚</p><p><img src="/2021/03/15/operate/%E6%AE%B5%E9%A1%B5%E5%BC%8F%E5%AD%98%E5%82%A81-1615794509251.PNG"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token class-name">A</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//åˆ†æ®µ 1 </span><span class="token operator">&lt;</span> <span class="token number">10</span> ç»™é¡µå†…åç§»é‡ã€‚ <span class="token class-name">A</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="5-è™šæ‹Ÿå†…å­˜"><a href="#5-è™šæ‹Ÿå†…å­˜" class="headerlink" title="5. è™šæ‹Ÿå†…å­˜"></a>5. è™šæ‹Ÿå†…å­˜</h2><p>è™šæ‹Ÿå†…å­˜çš„æœ€å¤§å®¹é‡ç”±è®¡ç®—æœºçš„åœ°å€ç»“æ„ç¡®å®šçš„</p><p>è™šæ‹Ÿå†…å­˜çš„å®é™…å®¹é‡ = min(å†…å­˜å’Œå¤–å­˜å®¹é‡ä¹‹å’Œï¼ŒCPUå¯»å€èŒƒå›´)</p><p>ç‰¹å¾ï¼š</p><ul><li>å¤šæ¬¡æ€§ï¼šæ— éœ€åœ¨ä½œä¸šè¿è¡Œæ—¶ä¸€æ¬¡æ€§å…¨éƒ¨è£…å…¥å†…å­˜ï¼Œè€Œæ˜¯å…è®¸è¢«åˆ†æˆå¤šæ¬¡è°ƒåº¦å†…å­˜ã€‚</li><li>å¯¹æ¢æ€§ï¼šåœ¨ä½œä¸šè¿è¡Œæ—¶æ— éœ€ä¸€ç›´å¸¸é©»å†…å­˜ï¼Œè€Œæ˜¯å…è®¸åœ¨ä½œä¸šè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†ä½œä¸šæ¢å…¥ã€æ¢å‡ºã€‚</li><li>è™šæ‹Ÿæ€§ï¼šé€»è¾‘ä¸Šæ‰©å……å†…å­˜å®¹é‡ã€‚çœ‹åˆ°çš„å®¹é‡è¿œè¿œå¤§äºå®é™…å®¹é‡ã€‚</li></ul><p>è™šæ‹Ÿå†…å­˜æŠ€æœ¯éœ€è¦å»ºç«‹åœ¨<font color="red">ç¦»æ•£åˆ†é…</font>çš„å†…å­˜ç®¡ç†æ–¹å¼çš„åŸºç¡€ä¸Šã€‚</p><h3 id="5-1-è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼"><a href="#5-1-è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼" class="headerlink" title="5.1 è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼"></a>5.1 è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼</h3><p><img src="/2021/03/15/operate/%E9%A1%B5%E8%A1%A8%E6%9C%BA%E5%88%B6-1615794509251.PNG"></p><p><img src="/2021/03/15/operate/%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD%E6%9C%BA%E6%9E%84-1615794509251.PNG"></p><p><img src="/2021/03/15/operate/%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD-1615794509251.PNG"></p><p>ä¸åŸºæœ¬åˆ†é¡µçš„åŒºåˆ«</p><p><img src="/2021/03/15/operate/%E4%B8%8E%E5%9F%BA%E6%9C%AC%E5%88%86%E9%A1%B5%E5%8C%BA%E5%88%AB-1615794509251.PNG"></p><p><img src="/2021/03/15/operate/%E6%9F%A5%E6%85%A2%E8%A1%A8%E5%92%8C%E5%BF%AB%E8%A1%A8-1615794509251.PNG"></p><h3 id="é¡µé¢ç½®æ¢ç®—æ³•"><a href="#é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="é¡µé¢ç½®æ¢ç®—æ³•"></a>é¡µé¢ç½®æ¢ç®—æ³•</h3><p>é¡µé¢çš„æ¢å…¥æ¢å‡ºéœ€è¦ç£ç›˜IOï¼Œå› æ­¤æ¬¡æ•°è¦å°½å¯èƒ½å°‘ã€‚</p><ol><li>æœ€ä½³ç½®æ¢</li></ol><p>æ¯æ¬¡é€‰æ‹©æ·˜æ±°çš„é¡µé¢å°†æ˜¯ä»¥åæ°¸ä¸ä½¿ç”¨ï¼Œæˆ–è€…åœ¨æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„é¡µé¢ã€‚æ ¹æ®ä»¥åçš„åºåˆ—çš„å‡ºç°æ¬¡åºå®šæ›¿æ¢å“ªä¸ªç®—æ³•ã€‚</p><ol start="2"><li>å…ˆè¿›å…ˆå‡º</li></ol><p>æ¯æ¬¡æ·˜æ±°çš„é¡µé¢æ˜¯æœ€æ—©è¿›å…¥å†…å­˜çš„é¡µé¢ã€‚å½“ä¸ºè¿›ç¨‹åˆ†é…çš„ç‰©ç†å—æ•°å¢å¤§æ—¶ï¼Œç¼ºé¡µæ¬¡æ•°ä¸å‡åå¢ï¼ˆbeladyå¼‚å¸¸ï¼‰ã€‚</p><ol start="3"><li><p>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ LRUç®—æ³• </p></li><li><p>æ—¶é’Ÿç½®æ¢ç®—æ³•</p></li></ol><p><img src="/2021/03/15/operate/%E6%97%B6%E9%92%9F%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95-1615794509251.PNG"></p><ol start="5"><li>æ”¹è¿›å‹çš„æ—¶é’Ÿç½®æ¢ç®—æ³•</li></ol><p><img src="/2021/03/15/operate/%E6%94%B9%E8%BF%9B%E5%9E%8B%E7%AE%97%E6%B3%95-1615794509251.PNG"></p><h3 id="5-3-é¡µé¢åˆ†é…ç­–ç•¥"><a href="#5-3-é¡µé¢åˆ†é…ç­–ç•¥" class="headerlink" title="5.3 é¡µé¢åˆ†é…ç­–ç•¥"></a>5.3 é¡µé¢åˆ†é…ç­–ç•¥</h3><p>é©»ç•™é›†ï¼šæŒ‡è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†ä¸­ç»™è¿›ç¨‹åˆ†é…çš„ç‰©ç†å—çš„é›†åˆã€‚</p><p>é©»ç•™é›†æœ‰å›ºå®šåˆ†é…å’Œå¯å˜åˆ†é…ä¸¤ç§åˆ†é…æ–¹å¼ã€‚åŒºåˆ«åœ¨è¿è¡ŒæœŸé—´å¯ä»¥é€‚å½“å¢åŠ å’Œå‡å°‘ã€‚</p><p>å±€éƒ¨ç½®æ¢ï¼š å‘ç”Ÿç¼ºé¡µæ—¶åªèƒ½é€‰è¿›ç¨‹è‡ªå·±çš„ç‰©ç†å—è¿›è¡Œç½®æ¢ã€‚</p><p>å…¨å±€ç½®æ¢ï¼šå°†ç³»ç»Ÿä¿ç•™çš„ç©ºé—²ç‰©ç†å—åˆ†é…ç»™ç¼ºé¡µè¿›ç¨‹ã€‚</p><p>åˆèµ·æ¥æ€»å…±æœ‰ä¸‰ç§åˆ†é…ç­–ç•¥ï¼š</p><ol><li>å›ºå®šåˆ†é…å±€éƒ¨ç½®æ¢ï¼ˆå›ºå®šåˆ†é…æ²¡æœ‰å…¨å±€ç½®æ¢ï¼‰ã€‚</li><li>å¯å˜åˆ†é…å…¨å±€ç½®æ¢ã€‚ç³»ç»Ÿæœ‰ä¸€ä¸ªç©ºé—²ç‰©ç†å—é˜Ÿåˆ—ã€‚</li><li>å¯å˜åˆ†é…å±€éƒ¨ç½®æ¢ã€‚æ ¹æ®ç¼ºé¡µçš„é¢‘ç‡åŠ¨æ€åœ°å¢åŠ å’Œå‡å°‘è¿›ç¨‹çš„ç‰©ç†å—ã€‚</li></ol><ul><li><p>ä½•æ—¶è°ƒå…¥é¡µé¢</p><ol><li><p>é¢„è°ƒé¡µç­–ç•¥ï¼šæ ¹æ®å±€éƒ¨æ€§åŸç†ï¼Œä¸€æ¬¡è°ƒå…¥è‹¥å¹²ä¸ªç›¸é‚»é¡µé¢å¯èƒ½æ¯”ä¸€æ¬¡è°ƒå…¥ä¸€ä¸ªé¡µé¢æ›´é«˜æ•ˆã€‚<font color="red">ä¸»è¦ç”¨äºè¿›ç¨‹çš„é¦–æ¬¡è¿›å…¥</font></p></li><li><p>è¯·æ±‚è°ƒé¡µç­–ç•¥ï¼šç¨‹åºåœ¨è¿è¡ŒæœŸé—´å‘ç°ç¼ºé¡µæ—¶æ‰å°†æ‰€ç¼ºé¡µé¢è°ƒå…¥å†…å­˜ã€‚</p></li></ol></li><li><p>ä½•å¤„è°ƒå…¥é¡µé¢</p><p>å¤–å­˜ï¼š å¯¹æ¢åŒºå’Œæ–‡ä»¶åŒºã€‚</p></li></ul><h3 id="5-4-æ€»ç»“"><a href="#5-4-æ€»ç»“" class="headerlink" title="5.4 æ€»ç»“"></a>5.4 æ€»ç»“</h3><h4 id="5-4-1-è™šæ‹Ÿåœ°å€ç©ºé—´"><a href="#5-4-1-è™šæ‹Ÿåœ°å€ç©ºé—´" class="headerlink" title="5.4.1 è™šæ‹Ÿåœ°å€ç©ºé—´"></a>5.4.1 è™šæ‹Ÿåœ°å€ç©ºé—´</h4><p>åœ¨æ—©æœŸçš„è®¡ç®—æœºä¸­ï¼Œç¨‹åºæ˜¯ç›´æ¥è¿è¡Œåœ¨ç‰©ç†å†…å­˜ä¸Šçš„ï¼Œé‚£ä¸ªæ—¶å€™çš„è®¡ç®—æœºå’Œç¨‹åºå†…å­˜éƒ½å¾ˆå°ã€‚ç¨‹åºè¿è¡Œæ—¶ä¼šæŠŠå…¶å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œåªè¦ç¨‹åºæ‰€éœ€çš„å†…å­˜ä¸è¶…è¿‡è®¡ç®—æœºå‰©ä½™å†…å­˜å°±ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p><p>ä½†ç”±äºç¨‹åºæ˜¯å¯ä»¥ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜çš„ï¼Œè¿™ä¹Ÿå¸¦æ¥äº†å†…å­˜æ•°æ®çš„ä¸å®‰å…¨æ€§ï¼Œè½»åˆ™ç¨‹åºæŒ‚æ‰ï¼Œé‡åˆ™æ“ä½œç³»ç»Ÿå´©æºƒã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸Œæœ›ç¨‹åºé—´çš„å†…å­˜æ•°æ®æ˜¯å®‰å…¨çš„äº’ä¸å½±å“çš„ã€‚åŒæ—¶è®¡ç®—æœºç¨‹åºç›´æ¥è¿è¡Œåœ¨ç‰©ç†å†…å­˜ä¸Šä¹Ÿå¯¼è‡´äº†å†…å­˜ä½¿ç”¨ç‡è¾ƒä½ï¼Œç¨‹åºè¿è¡Œå†…å­˜åœ°å€ä¸ç¡®å®šï¼Œä¸åŒçš„è¿è¡Œé¡ºåºç”šè‡³ä¼šå‡ºé”™ã€‚æ­¤æ—¶åœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå·²ç»å­˜åœ¨ç€å¤§é‡åœ¨ç‰©ç†å†…å­˜å’Œç¡¬ç›˜ä¹‹é—´çš„æ•°æ®äº¤æ¢è¿‡ç¨‹ã€‚</p><p>åŸºäºä»¥ä¸Šé—®é¢˜ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ˜¯ä¸æ˜¯è€ƒè™‘åœ¨ç‰©ç†å†…å­˜ä¹‹ä¸Šå¢åŠ ä¸€ä¸ªä¸­é—´å±‚ï¼Œè®©ç¨‹åºé€šè¿‡è™šæ‹Ÿåœ°å€å»é—´æ¥çš„è®¿é—®ç‰©ç†å†…å­˜å‘¢ã€‚é€šè¿‡è™šæ‹Ÿå†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹å¥½åƒéƒ½å¯ä»¥ç‹¬å å†…å­˜ä¸€æ ·ï¼Œæ¯ä¸ªè¿›ç¨‹çœ‹åˆ°çš„å†…å­˜éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™ç§°ä¸ºè™šæ‹Ÿåœ°å€ç©ºé—´ã€‚</p><p>ï¼ˆè¿™ç§æ€æƒ³åœ¨ç°åœ¨ä¹Ÿç”¨çš„å¾ˆå¹¿æ³›ï¼Œä¾‹å¦‚å¾ˆå¤šä¼˜ç§€çš„ä¸­é—´å±‚ï¼šNginxã€Redis ç­‰ç­‰ï¼‰</p><p>è¿™æ ·åªè¦ç³»ç»Ÿå¤„ç†å¥½è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»ï¼Œå°±å¯ä»¥ä¿è¯ä¸åŒçš„ç¨‹åºè®¿é—®ä¸åŒçš„å†…å­˜åŒºåŸŸï¼Œå°±å¯ä»¥è¾¾åˆ°ç‰©ç†å†…å­˜åœ°å€éš”ç¦»çš„æ•ˆæœï¼Œè¿›è€Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h4 id="5-4-2-åˆ†æ®µä¸åˆ†é¡µ"><a href="#5-4-2-åˆ†æ®µä¸åˆ†é¡µ" class="headerlink" title="5.4.2 åˆ†æ®µä¸åˆ†é¡µ"></a>5.4.2 åˆ†æ®µä¸åˆ†é¡µ</h4><p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•å…ƒã€‚æ“ä½œç³»ç»Ÿåˆ†é…ç»™è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­åŒ…å«äº”ç§æ®µï¼šæ•°æ®æ®µã€ä»£ç æ®µã€BSSã€å †ã€æ ˆã€‚</p><ul><li>æ•°æ®æ®µï¼šå­˜æ”¾ç¨‹åºä¸­çš„é™æ€å˜é‡å’Œå·²åˆå§‹åŒ–ä¸”ä¸ä¸ºé›¶çš„å…¨å±€å˜é‡ã€‚</li><li>ä»£ç æ®µï¼šå­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶çš„æ“ä½œæŒ‡ä»¤ï¼Œä»£ç æ®µæ˜¯åªè¯»çš„ï¼Œä¸å¯è¿›è¡Œå†™æ“ä½œã€‚è¿™éƒ¨åˆ†çš„åŒºåŸŸåœ¨è¿è¡Œå‰å·²çŸ¥å…¶å¤§å°ã€‚</li><li>BSS æ®µ( Block Started By Symbol)ï¼šå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œåœ¨å˜é‡ä½¿ç”¨å‰ç”±è¿è¡Œæ—¶åˆå§‹åŒ–ä¸ºé›¶ã€‚</li><li>å †ï¼šå­˜æ”¾è¿›ç¨‹è¿è¡Œä¸­è¢«åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œå…¶å¤§å°ä¸å›ºå®šã€‚</li><li>æ ˆï¼šå­˜æ”¾ç¨‹åºä¸­çš„ä¸´æ—¶çš„å±€éƒ¨å˜é‡å’Œå‡½æ•°çš„å‚æ•°å€¼ã€‚</li></ul><p><img src="/2021/03/15/operate/0df091d25f30b7c46fda45d4739ad8b9.png" alt="img"></p><p>é‚£ä¹ˆåˆ†æ®µçš„æŠ€æœ¯å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><blockquote><p>å‡è®¾ç¨‹åº A çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯ 0x00000000<del>0x00000099ï¼Œæ˜ å°„åˆ°çš„ç‰©ç†åœ°å€ç©ºé—´æ˜¯ 0x00000600</del>0x00000699ï¼Œç¨‹åº B çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯ 0x00000100<del>0x00000199ï¼Œæ˜ å°„åˆ°çš„ç‰©ç†åœ°å€ç©ºé—´æ˜¯ 0x00000300</del>0x00000399ã€‚</p><p>å‡è®¾ä½ æ‰‹æ®‹ï¼Œåœ¨ç¨‹åº A ä¸­æ“ä½œäº†åœ°å€ 0x00000150ï¼Œä½†æ˜¯æ­¤æ—¶çš„åœ°å€ 0x00000150 æ˜¯è™šæ‹Ÿçš„ï¼Œè€Œè™šæ‹ŸåŒ–çš„æ“ä½œæ˜¯åœ¨æ“ä½œç³»ç»Ÿçš„æŒæ§ä¸­çš„ï¼Œæ‰€ä»¥ï¼Œæ“ä½œç³»ç»Ÿæœ‰èƒ½åŠ›åˆ¤æ–­ï¼Œè¿™ä¸ªè™šæ‹Ÿåœ°å€ 0x00000150 æ˜¯æœ‰é—®é¢˜çš„ï¼Œç„¶åé˜»æ­¢åç»­çš„æ“ä½œã€‚æ‰€ä»¥ï¼Œè¿™é‡Œä½“ç°å‡ºäº†éš”ç¦»æ€§ã€‚ï¼ˆå¦ä¸€ç§ä½“ç°éš”ç¦»æ€§çš„æ–¹å¼å°±æ˜¯ï¼Œæ“ä½œåŒä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œå®é™…ä¸Šå¯èƒ½æ“ä½œçš„æ˜¯ä¸åŒçš„ç‰©ç†åœ°å€ï¼‰</p></blockquote><p>æ‰€ä»¥é€šè¿‡åˆ†æ®µæœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½çš„æ§åˆ¶ä¸åŒæ®µçš„å±æ€§ï¼Œè¿™æœ‰åˆ©äºå†…å­˜çš„ç»„ç»‡å®‰æ’ï¼Œå¯ä»¥å¯¹ä¸åŒçš„å±æ€§ä»£ç ã€æ•°æ®è¿›è¡Œæ›´æ–¹ä¾¿çš„ç®¡ç†ã€‚å¦‚æœæ˜¯æ‰“ä¹±çš„æ”¾åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆè¯»å†™å±æ€§å°±å¾ˆéš¾æ§åˆ¶ã€‚</p><p>ç¨‹åºè¿è¡Œåœ°å€å’Œç‰©ç†åœ°å€çš„éš”ç¦»ä¿è¯äº†ç¨‹åºå†…å­˜æ•°æ®çš„å®‰å…¨æ€§ï¼Œä¹Ÿè§£å†³äº†åŒä¸€ä¸ªç¨‹åºè¿è¡Œåœ°å€ä¸ç¡®å®šçš„é—®é¢˜ï¼Œä½†æ˜¯ç‰©ç†å†…å­˜ä½¿ç”¨æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ä¾ç„¶æ²¡æœ‰å¾—åˆ°è§£å†³ï¼Œå› ä¸ºåˆ†æ®µæœºåˆ¶æ˜ å°„çš„æ˜¯ä¸€ç‰‡è¿ç»­çš„ç‰©ç†å†…å­˜ã€‚</p><p>äºæ˜¯å¤§ä½¬ä»¬åˆæå‡ºäº†åˆ†é¡µçš„åŠæ³•ã€‚åˆ†é¡µå…¶å®å°±æ˜¯æŠŠæ®µç©ºé—´æ›´ç»†åˆ†äº†ä¸€ä¸‹ï¼Œç²’åº¦æ›´å°ã€‚æ­¤æ—¶ç‰©ç†å†…å­˜è¢«åˆ’åˆ†ä¸ºä¸€å°å—ä¸€å°å—ï¼Œæ¯å—è¢«ç§°ä¸ºå¸§(Frame)ã€‚åˆ†é…å†…å­˜æ—¶ï¼Œå¸§æ˜¯åˆ†é…æ—¶çš„æœ€å°å•ä½ã€‚</p><p>åœ¨åˆ†æ®µæ–¹æ³•ä¸­ï¼Œæ¯æ¬¡ç¨‹åºçš„è¿è¡Œéƒ½ä¼šè¢«å…¨éƒ¨åŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ä¸­ï¼›è€Œåˆ†é¡µæ–¹æ³•åˆ™ä¸åŒï¼Œå•ä½ä¸æ˜¯æ•´ä¸ªç¨‹åºï¼Œè€Œæ˜¯æŸä¸ªâ€œé¡µâ€ï¼Œä¸€æ®µè™šæ‹Ÿåœ°å€ç©ºé—´ç»„æˆçš„æŸä¸€é¡µæ˜ å°„åˆ°ä¸€æ®µç‰©ç†åœ°å€ç©ºé—´ç»„æˆçš„æŸä¸€é¡µã€‚å®ƒå°†å°‘éƒ¨åˆ†è¦è¿è¡Œçš„ä»£ç åŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ä¸­ï¼Œé€šè¿‡æ˜ å°„åœ¨ç‰©ç†å†…å­˜ä¸­è¿è¡Œï¼Œä»è€Œæé«˜äº†ç‰©ç†å†…å­˜çš„ä½¿ç”¨ç‡ã€‚</p><p><img src="/2021/03/15/operate/e542f644edefb86a8014fe7d17690496.jpeg" alt="img"></p><p>ä¸ºäº†æ–¹ä¾¿ CPU é«˜æ•ˆæ‰§è¡Œç®¡ç†ç‰©ç†å†…å­˜ï¼Œæ¯ä¸€æ¬¡éƒ½éœ€è¦ä»è™šæ‹Ÿå†…å­˜ä¸­æ‹¿ä¸€ä¸ªé¡µçš„ä»£ç æ”¾åˆ°ç‰©ç†å†…å­˜ã€‚è™šæ‹Ÿå†…å­˜é¡µæœ‰ä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯æœªåˆ†é…ã€å·²ç¼“å­˜å’Œæœªç¼“å­˜çŠ¶æ€ã€‚</p><p><strong>æœªåˆ†é…ï¼š</strong>æŒ‡çš„æ˜¯æœªè¢«æ“ä½œç³»ç»Ÿåˆ†é…æˆ–è€…åˆ›å»ºçš„ï¼Œæœªåˆ†é…çš„è™šæ‹Ÿé¡µä¸å­˜åœ¨ä»»ä½•æ•°æ®å’Œä»£ç ä¸å®ƒä»¬å…³è”ï¼Œå› æ­¤ä¸å ç”¨ç£ç›˜èµ„æºï¼›</p><p><strong>å·²ç¼“å­˜ï¼š</strong>è¡¨ç¤ºçš„æ˜¯ç‰©ç†å†…å­˜ä¸­å·²ç»ä¸ºè¯¥éƒ¨åˆ†åˆ†é…çš„ï¼Œå­˜åœ¨è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜æ˜ å°„å…³ç³»çš„ï¼›</p><p><strong>æœªç¼“å­˜ï¼š</strong>æŒ‡çš„æ˜¯å·²ç»åŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ä¸­çš„ï¼Œä½†æ˜¯æœªåœ¨ç‰©ç†å†…å­˜ä¸­å»ºç«‹æ˜ å°„å…³ç³»çš„ã€‚</p><h4 id="5-4-3-é¡µè¡¨"><a href="#5-4-3-é¡µè¡¨" class="headerlink" title="5.4.3 é¡µè¡¨"></a>5.4.3 é¡µè¡¨</h4><p>è™šæ‹Ÿå†…å­˜ä¸­çš„ä¸€äº›è™šæ‹Ÿé¡µæ˜¯è¦ç¼“å­˜åœ¨ç‰©ç†å†…å­˜ä¸­æ‰èƒ½è¢«æ‰§è¡Œçš„ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿå­˜åœ¨ä¸€ç§æœºåˆ¶ç”¨æ¥åˆ¤æ–­æŸä¸ªè™šæ‹Ÿé¡µæ˜¯å¦è¢«ç¼“å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè¿˜éœ€è¦çŸ¥é“è¿™ä¸ªè™šæ‹Ÿé¡µå­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„å“ªä¸ªä½ç½®ï¼Œä»è€Œåœ¨ç‰©ç†å†…å­˜ä¸­é€‰æ‹©ç©ºé—²é¡µæˆ–è€…æ›´æ–°ç¼“å­˜é¡µï¼Œå¹¶å°†éœ€è¦çš„è™šæ‹Ÿé¡µä»ç£ç›˜å¤åˆ¶åˆ°ç‰©ç†å†…å­˜ä¸­ã€‚è¿™äº›åŠŸèƒ½æ˜¯ç”±è½¯ç¡¬ä»¶ç»“åˆå®Œæˆçš„ï¼Œå…¶å­˜æ”¾åœ¨ç‰©ç†å†…å­˜ä¸­ä¸€ä¸ªå«é¡µè¡¨çš„æ•°æ®ç»“æ„ä¸­ã€‚</p><p>è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„æ˜ å°„é€šè¿‡é¡µè¡¨(page table)æ¥å®ç°ã€‚æ¯ä¸ªé¡µè¡¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ç§°ä¸ºé¡µè¡¨é¡¹(PTE, page table entry)ï¼Œæ¯ä¸ªé¡µè¡¨é¡¹è´Ÿè´£æŠŠè™šæ‹Ÿé¡µæ˜ å°„åˆ°ç‰©ç†é¡µä¸Šã€‚åœ¨ ç‰©ç†å†…å­˜ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ã€‚</p><p><img src="/2021/03/15/operate/62f59325912379a00cea940552d8ba75.png" alt="img"></p><p>å› ä¸ºæœ‰ä¸€ä¸ªè¡¨å¯ä»¥æŸ¥è¯¢ï¼Œå°±ä¼šé‡åˆ°ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯å‘½ä¸­(Page Hit)ï¼Œå¦ä¸€ç§åˆ™æ˜¯æœªå‘½ä¸­(Page Fault)ã€‚</p><p>å‘½ä¸­çš„æ—¶å€™ï¼Œå³è®¿é—®åˆ°é¡µè¡¨ä¸­è“è‰²æ¡ç›®çš„åœ°å€æ—¶ï¼Œå› ä¸ºåœ¨ DRAM ä¸­æœ‰å¯¹åº”çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ã€‚</p><p>ä¸å‘½ä¸­çš„æ—¶å€™ï¼Œå³è®¿é—®åˆ° page table ä¸­ç°è‰²æ¡ç›®çš„æ—¶å€™ï¼Œå› ä¸ºåœ¨ DRAM ä¸­å¹¶æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡Œç¼ºé¡µç½®æ¢ã€‚</p><p>åœ¨ä¸Šå›¾ä¸­ï¼Œå››ä¸ªè™šæ‹Ÿé¡µ VP1 , VP2, VP4 , VP7 æ˜¯è¢«ç¼“å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚ä¸¤ä¸ªè™šæ‹Ÿé¡µ VP0, VP5 è¿˜æœªè¢«åˆ†é…ã€‚ä½†æ˜¯å‰©ä¸‹çš„è™šæ‹Ÿé¡µ VP3 ,VP6 å·²ç»è¢«åˆ†é…äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç¼“å­˜åˆ°ç‰©ç†å†…å­˜ä¸­å»æ‰§è¡Œã€‚</p><h4 id="5-4-4-æ€»ç»“"><a href="#5-4-4-æ€»ç»“" class="headerlink" title="5.4.4 æ€»ç»“"></a>5.4.4 æ€»ç»“</h4><p>é€šè¿‡è™šæ‹Ÿåœ°å€ç©ºé—´å’Œé¡µè¡¨çš„å›é¡¾ï¼Œç°åœ¨å¤§å®¶åº”è¯¥æ˜ç™½ä¸ºä»€ä¹ˆè¦å¼•å…¥è™šæ‹Ÿå†…å­˜äº†å§ã€‚</p><p>è™šæ‹Ÿå†…å­˜æ˜¯è®¡ç®—æœºç³»ç»Ÿå†…å­˜ç®¡ç†çš„ä¸€ç§æŠ€æœ¯ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´æ„æˆè™šæ‹Ÿå†…å­˜ã€‚å®ƒä½¿å¾—åº”ç”¨ç¨‹åºè®¤ä¸ºå®ƒæ‹¥æœ‰è¿ç»­å¯ç”¨çš„å†…å­˜ï¼ˆä¸€ä¸ªè¿ç»­å®Œæ•´çš„åœ°å€ç©ºé—´ï¼‰ï¼Œè€Œå®é™…ä¸Šï¼Œå®ƒé€šå¸¸æ˜¯è¢«åˆ†éš”æˆå¤šä¸ªç‰©ç†å†…å­˜ç¢ç‰‡ã€‚è¿˜æœ‰éƒ¨åˆ†æš‚æ—¶å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼ˆSwapï¼‰ï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</p><p><strong>è™šæ‹Ÿå†…å­˜ä¸åªæ˜¯ç”¨ç£ç›˜ç©ºé—´æ¥æ‰©å±•ç‰©ç†å†…å­˜</strong> çš„æ„æ€â€”â€”è¿™åªæ˜¯æ‰©å……å†…å­˜çº§åˆ«ä»¥ä½¿å…¶åŒ…å«ç¡¬ç›˜é©±åŠ¨å™¨è€Œå·²ã€‚æŠŠå†…å­˜æ‰©å±•åˆ°ç£ç›˜åªæ˜¯ä½¿ç”¨è™šæ‹Ÿå†…å­˜æŠ€æœ¯çš„ä¸€ä¸ªç»“æœã€‚é™¤äº†æ‰©å±•å†…å­˜ç©ºé—´ï¼Œè™šæ‹Ÿå†…å­˜æŠ€æœ¯è¿˜æœ‰éš”ç¦»è¿è¡Œå†…å­˜å’Œç¡®å®šè¿è¡Œåœ°å€çš„ä½œç”¨ã€‚</p><p>ä½¿ç”¨è™šæ‹Ÿå†…å­˜ä¸»è¦æ˜¯åŸºäºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è€ƒè™‘ï¼Œä¹Ÿå°±æ˜¯è¯´è™šæ‹Ÿå†…å­˜ä¸»è¦æœ‰ä¸‰ä¸ªä½œç”¨ï¼š</p><p>ä½œä¸ºç¼“å­˜å·¥å…·ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ï¼šä½¿ç”¨ DRAM å½“åšéƒ¨åˆ†çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„ç¼“å­˜ï¼ˆè™šæ‹Ÿå†…å­˜å°±æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ N ä¸ªè¿ç»­å­—èŠ‚çš„æ•°ç»„ï¼Œæ•°ç»„çš„éƒ¨åˆ†å†…å®¹ä¼šç¼“å­˜åœ¨ DRAM ä¸­ï¼‰ã€‚æ‰©å¤§äº†å†…å­˜ç©ºé—´ï¼Œå½“å‘ç”Ÿç¼ºé¡µå¼‚å¸¸æ—¶ï¼Œå°†ä¼šæŠŠå†…å­˜å’Œç£ç›˜ä¸­çš„æ•°æ®è¿›è¡Œç½®æ¢ã€‚</p><p>ä½œä¸ºå†…å­˜ç®¡ç†å·¥å…·ï¼Œç®€åŒ–å†…å­˜ç®¡ç†ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç»Ÿä¸€çš„çº¿æ€§åœ°å€ç©ºé—´ï¼ˆä½†å®é™…ä¸Šåœ¨ç‰©ç†å†…å­˜ä¸­å¯èƒ½æ˜¯é—´éš”ã€æ”¯ç¦»ç ´ç¢çš„ï¼‰ï¼Œåœ¨å†…å­˜åˆ†é…ä¸­æ²¡æœ‰å¤ªå¤šé™åˆ¶ï¼Œæ¯ä¸ªè™šæ‹Ÿé¡µéƒ½å¯ä»¥è¢«æ˜ å°„åˆ°ä»»ä½•çš„ç‰©ç†é¡µä¸Šã€‚è¿™æ ·ä¹Ÿå¸¦æ¥ä¸€ä¸ªå¥½å¤„ï¼Œå¦‚æœä¸¤ä¸ªè¿›ç¨‹é—´æœ‰å…±äº«çš„æ•°æ®ï¼Œé‚£ä¹ˆç›´æ¥æŒ‡å‘åŒä¸€ä¸ªç‰©ç†é¡µå³å¯ã€‚</p><p>ä½œä¸ºå†…å­˜ä¿æŠ¤å·¥å…·ï¼Œéš”ç¦»åœ°å€ç©ºé—´ï¼šè¿›ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼›ç”¨æˆ·ç¨‹åºä¸èƒ½è®¿é—®å†…æ ¸ä¿¡æ¯å’Œä»£ç ã€‚é¡µè¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®çš„é«˜ä½éƒ¨åˆ†æ˜¯è¡¨ç¤ºæƒé™çš„ä½ï¼ŒMMU å¯ä»¥é€šè¿‡æ£€æŸ¥è¿™äº›ä½æ¥è¿›è¡Œæƒé™æ§åˆ¶ï¼ˆè¯»ã€å†™ã€æ‰§è¡Œï¼‰ã€‚</p><h2 id="6-æ–‡ä»¶ç®¡ç†"><a href="#6-æ–‡ä»¶ç®¡ç†" class="headerlink" title="6. æ–‡ä»¶ç®¡ç†"></a>6. æ–‡ä»¶ç®¡ç†</h2><ul><li><p>æ–‡ä»¶å¦‚ä½•å­˜å‚¨</p></li><li><p>æ–‡ä»¶å†…éƒ¨åº”è¯¥å¦‚ä½•ç»„ç»‡</p></li><li><p>æ–‡ä»¶ä¹‹é—´åº”è¯¥å¦‚ä½•ç»„ç»‡</p></li></ul><h3 id="6-1-æ–‡ä»¶çš„é€»è¾‘ç»“æ„"><a href="#6-1-æ–‡ä»¶çš„é€»è¾‘ç»“æ„" class="headerlink" title="6.1 æ–‡ä»¶çš„é€»è¾‘ç»“æ„"></a>6.1 æ–‡ä»¶çš„é€»è¾‘ç»“æ„</h3><ul><li><p>æ— ç»“æ„æ–‡ä»¶</p><p>æ–‡ä»¶å†…éƒ¨çš„æ•°æ®æ˜¯ä¸€ç³»åˆ—äºŒè¿›åˆ¶æ–‡ä»¶æµæˆ–å­—ç¬¦æµç»„æˆã€‚åˆç§°ä¸ºâ€æµå¼æ–‡ä»¶â€œã€‚å¦‚windowsæ“ä½œç³»ç»Ÿçš„.txtæ–‡ä»¶ã€‚</p></li><li><p>æœ‰ç»“æ„æ–‡ä»¶</p><ul><li>é¡ºåºæ–‡ä»¶<ul><li>æ–‡ä»¶ä¸­çš„è®°å½•ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°é¡ºåºæ’åˆ—ï¼ˆé€»è¾‘ä¸Šï¼‰ï¼Œè®°å½•å¯ä»¥æ˜¯å®šé•¿çš„æˆ–å¯å˜é•¿çš„ã€‚å„ä¸ªè®°å½•åœ¨ç‰©ç†ä¸Šå¯ä»¥é¡ºåºå­˜å‚¨æˆ–é“¾å®å­˜å‚¨ã€‚</li></ul></li><li>ç´¢å¼•æ–‡ä»¶</li><li>ç´¢å¼•é¡ºåºæ–‡ä»¶</li></ul></li></ul><p>è®°å½•å¼æ–‡ä»¶ï¼Œç”±ä¸€ç»„ç›¸ä¼¼çš„è®°å½•ç»„æˆï¼Œæ¯”å¦‚excelè¡¨ä¸­çš„å­¦ç”Ÿä¿¡æ¯ã€‚</p><h3 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a><font color="blue">å†…å­˜ç®¡ç†</font></h3><p>ç®€è¿°è¿›ç¨‹åˆ‡æ¢çš„æµç¨‹<br>æ¶‰åŠå…¬å¸ï¼šé˜¿é‡Œäº‘å®ä¹ ç”Ÿ</p><p>å¦‚æœæƒ³è¦ä»Aè¿›ç¨‹åˆ‡æ¢åˆ° B è¿›ç¨‹ï¼Œå¿…å®šè¦å…ˆä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå› ä¸ºè¿™ä¸ªåˆ‡æ¢çš„å·¥ä½œä½ ä¸èƒ½è®©ç”¨æˆ·è¿›ç¨‹å»å®ç°ï¼Œä¸ç„¶å½“ CPU åœ¨ç”¨æˆ·è¿›ç¨‹æ‰‹ä¸Šçš„æ—¶å€™ï¼Œä»–å¯ä»¥é€‰æ‹©ä¸€ç›´æ‰§è¡Œï¼Œä¸è®©å‡º CPUï¼Œè¿™è‚¯å®šæ˜¯ä¸å…è®¸çš„ã€‚æ‰€ä»¥æ“ä½œç³»ç»Ÿéœ€è¦å…ˆæŒ‚èµ·æ­£åœ¨å ç”¨ CPU çš„ A è¿›ç¨‹ï¼Œæ‰èƒ½åˆ‡æ¢åˆ° B è¿›ç¨‹ã€‚</p><p>ç”±äºä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„æ—¶å€™ï¼ŒCPU æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹æ‰‹ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªæ˜¯é€šè¿‡ç¡¬ä¸­æ–­æ¥å®ç°çš„ã€‚åœ¨ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ä¹‹å‰éœ€è¦ä¿å­˜ç”¨æˆ·è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶å¯ä»¥ç»§ç»­ä¹‹å‰çš„å·¥ä½œã€‚</p><p>è¿™ä¸ªä¸Šä¸‹æ–‡å°±æ˜¯è¿›ç¨‹æ‰§è¡Œçš„ç¯å¢ƒï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„å¯„å­˜å™¨å˜é‡ï¼Œè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€å†…å­˜ä¿¡æ¯ç­‰ã€‚ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡å¯ä»¥åˆ†ä¸ºç”¨æˆ·çº§ä¸Šä¸‹æ–‡ï¼Œå¯„å­˜å™¨ä¸Šä¸‹æ–‡ï¼Œç³»ç»Ÿçº§ä¸Šä¸‹æ–‡ã€‚ç”¨æˆ·çº§ä¸Šä¸‹æ–‡å­˜å‚¨çš„æ˜¯ç”¨æˆ·è¿›ç¨‹çš„å†…å­˜æ•°æ®ä»¥åŠå †æ ˆæ•°æ®ç­‰ï¼›å¯„å­˜å™¨ä¸Šä¸‹æ–‡æ˜¯ä¸€äº›é€šç”¨å¯„å­˜å™¨ï¼›ç³»ç»Ÿçº§ä¸Šä¸‹æ–‡æ˜¯å†…æ ¸æ ˆã€PCB (è¿›ç¨‹æ§åˆ¶å—)ç­‰ã€‚</p><h3 id="è¿›ç¨‹åœ¨åœ°å€ç©ºé—´ä¸­ä¼šåˆ’åˆ†ä¸ºå“ªäº›åŒºåŸŸ"><a href="#è¿›ç¨‹åœ¨åœ°å€ç©ºé—´ä¸­ä¼šåˆ’åˆ†ä¸ºå“ªäº›åŒºåŸŸ" class="headerlink" title="è¿›ç¨‹åœ¨åœ°å€ç©ºé—´ä¸­ä¼šåˆ’åˆ†ä¸ºå“ªäº›åŒºåŸŸ"></a><font color="blue">è¿›ç¨‹åœ¨åœ°å€ç©ºé—´ä¸­ä¼šåˆ’åˆ†ä¸ºå“ªäº›åŒºåŸŸ</font></h3><p>æ¶‰åŠå…¬å¸ï¼šé˜¿é‡Œäº‘å®ä¹ ç”Ÿ</p><p>è¿™ä¸ªé—®é¢˜åœ¨æˆ‘ä¹‹å‰çš„å·¥ä½œä¸­å…¶å®è¿˜æ˜¯æœ‰æ‰€æ¶‰åŠçš„ï¼Œæˆ‘æ¥ç®€å•è®²ä¸€ä¸‹æŠŠæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œä»¥ Window å¹³å°ä¸ºä¾‹å§ï¼ŒPE æ–‡ä»¶æˆ‘æ¯”è¾ƒç†Ÿï¼Œåœ¨ PE æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªå«èŠ‚çš„æ¦‚å¿µï¼ŒèŠ‚æ˜¯PEæ–‡ä»¶ä¸­å­˜æ”¾ä»£ç å’Œæ•°æ®çš„åŸºæœ¬å•å…ƒï¼Œç”¨ä»¥å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚ data èŠ‚ã€code èŠ‚ç­‰ï¼Œä¸€ä¸ªèŠ‚çš„æ‰€æœ‰åŸå§‹æ•°æ®å¿…é¡»åŠ è½½åˆ°è¿ç»­çš„å†…å­˜ç©ºé—´é‡Œï¼Œè¿™ä¹Ÿå°±é€ æˆäº†åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„åŒºå—åˆ’åˆ†ã€‚</p><p>åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¼šæŒ‰ç…§èŠ‚åˆ’åˆ†ä¸ºä»£ç æ®µã€æ•°æ®æ®µã€æœªåˆå§‹åŒ–çš„æ•°æ®æ®µä»¥åŠå †æ ˆè¿™äº›åŒºå—ã€‚</p><h3 id="æ ˆä¸å †æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#æ ˆä¸å †æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="æ ˆä¸å †æœ‰ä»€ä¹ˆåŒºåˆ«"></a><font color="blue">æ ˆä¸å †æœ‰ä»€ä¹ˆåŒºåˆ«</font></h3><p>æ¶‰åŠå…¬å¸ï¼šé˜¿é‡Œäº‘å®ä¹ ç”Ÿã€æ‹¼å¤šå¤šå®ä¹ ç”Ÿ</p><p>æˆ‘ä»¬å¸¸è¯´å †æ ˆå †æ ˆï¼Œå…¶å®å †æ ˆæ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œæœ€ç›´è§‚çš„ç†è§£ï¼Œå †æ˜¯ç”±ç”¨æˆ·æ¥æ§åˆ¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ malloc è¿™ç§å‘½ä»¤æ¥åœ¨å †ä¸­ç”³è¯·å†…å­˜ï¼Œè€Œæ ˆæ˜¯ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶çš„ï¼Œåœ¨æ ˆä¸­å­˜å‚¨çš„æ˜¯è¿™ä¸ªè¿›ç¨‹çš„å±€éƒ¨å˜é‡ç­‰ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨ malloc æ¥ç”³è¯·ä¸€å—å†…å­˜ï¼Œå†…å­˜æœ¬èº«æ˜¯åœ¨å †ä¸­å¼€è¾Ÿçš„ï¼Œè€ŒæŒ‡å‘è¿™å—å†…å­˜çš„æŒ‡é’ˆå­˜å‚¨åœ¨æ ˆä¸­ã€‚</p><h3 id="æ“ä½œç³»ç»Ÿä¸ºä»€ä¹ˆåˆ†å†…æ ¸æ€å’Œç”¨æˆ·æ€ï¼Œè¿™ä¸¤è€…ä¹‹é—´å¦‚ä½•åˆ‡æ¢"><a href="#æ“ä½œç³»ç»Ÿä¸ºä»€ä¹ˆåˆ†å†…æ ¸æ€å’Œç”¨æˆ·æ€ï¼Œè¿™ä¸¤è€…ä¹‹é—´å¦‚ä½•åˆ‡æ¢" class="headerlink" title="æ“ä½œç³»ç»Ÿä¸ºä»€ä¹ˆåˆ†å†…æ ¸æ€å’Œç”¨æˆ·æ€ï¼Œè¿™ä¸¤è€…ä¹‹é—´å¦‚ä½•åˆ‡æ¢"></a><font color="blue">æ“ä½œç³»ç»Ÿä¸ºä»€ä¹ˆåˆ†å†…æ ¸æ€å’Œç”¨æˆ·æ€ï¼Œè¿™ä¸¤è€…ä¹‹é—´å¦‚ä½•åˆ‡æ¢</font></h3><p>æ¶‰åŠå…¬å¸ï¼šæ‹¼å¤šå¤šå®ä¹ ç”Ÿ</p><p>å› ä¸ºåœ¨CPUçš„æŒ‡ä»¤ä¸­ï¼Œæœ‰ä¸€äº›æ˜¯éå¸¸å±é™©çš„ï¼Œæ¯”å¦‚æ¸…ç†å†…å­˜ã€è®¾ç½®æ—¶é’Ÿç­‰ï¼Œå¦‚æœæ‰€æœ‰çš„ç¨‹åºéƒ½èƒ½ä½¿ç”¨ï¼Œå°±å¯èƒ½é€ æˆç³»ç»Ÿçš„å´©æºƒï¼Œæ‰€ä»¥ï¼ŒCPU å°†æŒ‡ä»¤åˆ†ä¸ºç‰¹æƒæŒ‡ä»¤å’Œéç‰¹æƒæŒ‡ä»¤ï¼Œå¯¹äºé‚£äº›å±é™©çš„æŒ‡ä»¤ï¼Œåªå…è®¸æ“ä½œç³»ç»Ÿä½¿ç”¨ã€‚CPU çš„ç‰¹æƒçº§åˆ«æœ‰å››çº§ï¼Œä» Ring0 åˆ° Ring3ï¼Œæ­£å¸¸ä½¿ç”¨æ—¶ä¸€èˆ¬åªæœ‰ä¸¤çº§ï¼Œå³ç”¨æˆ·æ€çš„ Ring3 å’Œå†…æ ¸æ€çš„ Ring0ã€‚Ring3 çŠ¶æ€ä¸èƒ½è®¿é—® Ring0 çš„åœ°å€ç©ºé—´ï¼ŒåŒ…æ‹¬ä»£ç å’Œæ•°æ®ã€‚</p><h3 id="ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸‰ç§æ–¹å¼"><a href="#ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸‰ç§æ–¹å¼"></a><font color="blue">ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸‰ç§æ–¹å¼</font></h3><p>ç³»ç»Ÿè°ƒç”¨ï¼ˆç³»ç»Ÿè°ƒç”¨æ˜¯é€šè¿‡è½¯ä¸­æ–­å®ç°çš„ï¼‰<br>ä¸­æ–­ï¼ˆç¡¬ï¼‰<br>å¼‚å¸¸</p><h3 id="mallocçš„å®ç°æœºåˆ¶"><a href="#mallocçš„å®ç°æœºåˆ¶" class="headerlink" title="mallocçš„å®ç°æœºåˆ¶"></a><font color="blue">mallocçš„å®ç°æœºåˆ¶</font></h3><p>æ¶‰åŠå…¬å¸ï¼šé˜¿é‡Œäº‘å®ä¹ ç”Ÿ</p><p>malloc æœ¬è´¨ä¸Šæ˜¯ç»´æŠ¤äº†ä¸€ä¸ªå†…å­˜ç©ºé—²é“¾è¡¨ï¼Œæ¯æ¬¡æˆ‘ä»¬è°ƒç”¨ malloc ç”³è¯·ç©ºé—´çš„æ—¶å€™ï¼Œé“¾è¡¨å°±ä¼šä»å¤´å¼€å§‹éå†ï¼Œæ¥å¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„ç©ºé—²å†…å­˜ç©ºé—´ï¼Œç„¶åæŠŠè¿™ä¸ªç©ºé—´ç»™åˆ†å‰²å¼€ï¼Œä¸€æ­¥æ­¥åˆ†é…ç»™ç”¨æˆ·ï¼Œå¦ä¸€éƒ¨åˆ†ç»§ç»­æ ‡æ³¨ä¸ºç©ºé—²ï¼Œè€Œå½“æ²¡æœ‰è¶³å¤Ÿå¤§çš„ç©ºé—²å—æ—¶ï¼Œmalloc å°±ä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥ç”³è¯·æ›´å¤šçš„å†…å­˜å—ã€‚è€Œæˆ‘ä»¬è°ƒç”¨ free æ¥é‡Šæ”¾å†…å­˜å—çš„æ—¶å€™ï¼Œè¯¥å†…å­˜å—å°±ä¼šå›åˆ°é“¾è¡¨ä¸­ï¼Œå¹¶ä¸”ç›¸é‚»çš„å†…å­˜å—ä¼šè¢«åˆå¹¶ã€‚</p><p>æœç´¢ç©ºé—²å—çš„ç®—æ³•ä¸»è¦æœ‰é¦–æ¬¡é€‚é…ã€ä¸‹ä¸€æ¬¡é€‚é…ã€æœ€ä½³é€‚é…ï¼Œé¦–æ¬¡é€‚é…å³ç¬¬ä¸€æ¬¡æ‰¾åˆ°è¶³å¤Ÿå¤§çš„å†…å­˜å—å°±åˆ†é…ï¼Œä½†è¿™æ ·ä¼šäº§ç”Ÿå¾ˆå¤šçš„å†…å­˜ç¢ç‰‡ï¼Œä¹Ÿå› æ­¤ç¬¬äºŒæ¬¡é€‚é…è¢«æå‡ºæ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚å¦ä¸€ä¸ªæç«¯åˆ™æ˜¯æœ€ä½³é€‚é…ï¼Œå³æ‰¾åˆ°ä¸€å—åˆšå¥½å¤§äºæˆ‘ä»¬æ‰€éœ€å†…å­˜å¤§å°çš„å†…å­˜å—ï¼Œè¿™ç§åšæ³•ä¸€æ–¹é¢è€—æ—¶é•¿ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¼šäº§ç”Ÿä¸€äº›æå°çš„å†…å­˜ç¢ç‰‡ã€‚<br>è¿™ä¸¤ç§æ€è·¯å¯ä»¥çœ‹å‡ºæ˜¯åœ¨æ€§èƒ½å’Œç©ºé—´åˆ©ç”¨ç‡ä¸Šå¯»æ‰¾ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œåœ¨å·¥ç¨‹ä¸­å®é™…ä¸Šæœ‰å¾ˆå¤šè¿™ç§æ²¡æœ‰å®Œç¾è§£å†³æ–¹æ¡ˆï¼Œåªèƒ½å¯»æ‰¾å¹³è¡¡çš„é—®é¢˜ã€‚</p><h3 id="è™šæ‹Ÿåœ°å€æ€ä¹ˆæ˜ å°„åˆ°ç‰©ç†åœ°å€"><a href="#è™šæ‹Ÿåœ°å€æ€ä¹ˆæ˜ å°„åˆ°ç‰©ç†åœ°å€" class="headerlink" title="è™šæ‹Ÿåœ°å€æ€ä¹ˆæ˜ å°„åˆ°ç‰©ç†åœ°å€"></a><font color="blue">è™šæ‹Ÿåœ°å€æ€ä¹ˆæ˜ å°„åˆ°ç‰©ç†åœ°å€</font></h3><p>æ¶‰åŠå…¬å¸ï¼šé˜¿é‡Œäº‘å®ä¹ ç”Ÿã€è…¾è®¯å®ä¹ ç”Ÿ</p><p>è™šæ‹Ÿåœ°å€çš„æ„æˆä¸ºé¡µç›®å½•ç´¢å¼• (10ä½) +é¡µè¡¨ç´¢å¼• (10ä½) +è¡¨å†…åç§» (12ä½)</p><p>ä»¥ win32 ç³»ç»Ÿä¸ºä¾‹ï¼Œé¡µç›®å½•å’Œé¡µè¡¨éƒ½ä¸º 1024 ä¸ªï¼Œé¡µå¤§å°ä¸º 4KBï¼Œä¸€å…±æ˜¯ 4G çš„è™šæ‹Ÿå†…å­˜ç©ºé—´</p><p>è€Œä»è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€å®é™…ä¸Šå°±æ˜¯é€šè¿‡é¡µç›®å½•å’Œé¡µè¡¨çš„ç´¢å¼•æ‰¾åˆ°å†…å­˜é¡µã€‚</p><p>åœ¨é¡µè¡¨é¡¹ä¸­æœ‰ä¸€ä½æ ‡å¿—ä½ï¼Œç”¨æ¥æ ‡è¯†åŒ…å«æ­¤æ•°æ®çš„é¡µæ˜¯å¦åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œå¦‚æœåœ¨çš„è¯ï¼Œå°±ç›´æ¥åšåœ°å€æ˜ å°„ï¼Œå¦åˆ™ï¼ŒæŠ›å‡ºç¼ºé¡µä¸­æ–­ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠæ¬¡æ•°æ®é¡µè°ƒå…¥å†…å­˜ã€‚</p><h3 id="socket-ç¼–ç¨‹ä¸­æ€ä¹ˆå¤„ç†å¹¶å‘è¯·æ±‚"><a href="#socket-ç¼–ç¨‹ä¸­æ€ä¹ˆå¤„ç†å¹¶å‘è¯·æ±‚" class="headerlink" title="socket ç¼–ç¨‹ä¸­æ€ä¹ˆå¤„ç†å¹¶å‘è¯·æ±‚"></a><font color="blue">socket ç¼–ç¨‹ä¸­æ€ä¹ˆå¤„ç†å¹¶å‘è¯·æ±‚</font></h3><p>æ¶‰åŠå…¬å¸ï¼šé˜¿é‡Œäº‘å®ä¹ ç”Ÿã€è…¾è®¯å®ä¹ ç”Ÿ</p><p>å¯¹å¤šçº¿ç¨‹çš„å¤„ç†ä¸å•çº¿ç¨‹ä¸åŒçš„ä½ç½®åœ¨äºå„ä¸ªä¸åŒçš„è¿›ç¨‹å¯èƒ½ä¼šè®¿é—®ç›¸åŒçš„èµ„æºï¼Œå¦‚æœæ˜¯å¯¹èµ„æºè¿›è¡Œä¿®æ”¹çš„è¯ï¼Œå°±éœ€è¦ç”¨åˆ°é”</p><h3 id="ç®€è¿°-IO-å¤šè·¯å¤ç”¨"><a href="#ç®€è¿°-IO-å¤šè·¯å¤ç”¨" class="headerlink" title="ç®€è¿° IO å¤šè·¯å¤ç”¨"></a><font color="blue">ç®€è¿° IO å¤šè·¯å¤ç”¨</font></h3><p>æ¶‰åŠå…¬å¸ï¼šé˜¿é‡Œäº‘å®ä¹ ç”Ÿã€è…¾è®¯å®ä¹ ç”Ÿ</p><p>Linuxçš„IOè®¿é—®é€šå¸¸æ˜¯å…ˆå°†æ•°æ®æ‹·è´åˆ°æ“ä½œç³»ç»Ÿçš„å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åå†ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚åœ¨è¿™ä¸¤ä¸ªé˜¶æ®µä¸­ï¼Œæœ‰ä¸åŒçš„ IO æ–¹å¼ï¼Œä¸»è¦åˆ†ä¸ºé˜»å¡ IOã€éé˜»å¡ IOã€å¼‚æ­¥ IO ä»¥åŠ IO å¤šè·¯å¤ç”¨ã€‚</p><p>é˜»å¡ IO å³å½“æ•°æ®è¿˜æœªå‡†å¤‡å¥½ï¼Œä¹Ÿå°±æ˜¯æ•°æ®è¿˜åœ¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸ç¼“å­˜åŒºæ—¶ï¼Œç”¨æˆ·è¿›ç¨‹å°±ä¼šä¸€ç›´é˜»å¡ï¼Œç­‰å¾…æ•°æ®ä»æ“ä½œç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚é˜»å¡IOåœ¨è¿™ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯é˜»å¡çš„ã€‚</p><p>éé˜»å¡ IO åˆ™æ˜¯å¦‚æœæ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ï¼Œæ“ä½œç³»ç»Ÿä¼šç»™åº”ç”¨ç¨‹åºè¿”å›ä¸€ä¸ª errorï¼Œå¹¶ä¸é˜»å¡åº”ç”¨ç¨‹åºï¼Œè€Œä¸€èˆ¬åº”ç”¨ç¨‹åºä¼šæŒç»­è¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œæ‰€ä»¥ä»å¦ä¸€ä¸ªè§’åº¦æ¥è¯´ä¹Ÿæ˜¯é˜»å¡çš„ã€‚</p><p>è€Œå¼‚æ­¥ IO æ‰æ˜¯çœŸæ­£çš„ä¸é˜»å¡ï¼Œå½“ç”¨æˆ·ç¨‹åºå‘èµ·readåï¼Œæ“ä½œç³»ç»Ÿä¼šç«‹å³è¿›è¡Œå›å¤ï¼Œè¿™æ ·ç”¨æˆ·ç¨‹åºå°±å¯ä»¥å»åšå…¶ä»–äº‹æƒ…ï¼Œå½“æ•°æ®è¢«æ‹·è´åˆ°ç”¨æˆ·ç¨‹åºçš„åœ°ä¸­ç©ºé—´åï¼Œæ“ä½œç³»ç»Ÿä¼šç»™ç”¨æˆ·ç¨‹åºå‘ä¸€ä¸ªä¿¡å·ï¼Œè€Œç”¨æˆ·ç¨‹åºå¯ä»¥é‡‡ç”¨å›è°ƒå‡½æ•°çš„æ–¹å¼å¯¹è¿™ä¸ªä¿¡å·è¿›è¡Œå“åº”ã€‚</p><p>IO å¤šè·¯å¤ç”¨åˆ™æ˜¯å…è®¸ä¸€ä¸ªç¨‹åºåŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå½“ä»»æ„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œselect å‡½æ•°å°±ä¼šè¿”å›ï¼Œå½“ç„¶ IO å¤šè·¯å¤ç”¨åœ¨æœ¬è´¨ä¸Šè¿˜æœ¯è¯­é˜»å¡IOï¼Œåªä¸è¿‡å¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ª IO æ“ä½œã€‚</p><p>Linux çš„ IO å¤šè·¯å¤ç”¨æœºåˆ¶ä¸­æœ‰ selectã€pollã€epoll ä¸‰ç§ï¼Œ<br>select å’Œ poll çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n),å› ä¸ºä»–ä»¬éƒ½æ˜¯åœ¨å¯¹IOåˆ—è¡¨è¿›è¡Œè½®è¯¢ï¼Œä¸åŒç‚¹åœ¨äº select èƒ½ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ä¸Šé™ï¼Œä¸€èˆ¬ä¸º 1024ï¼Œå½“ç„¶è¿™ä¸ªæ˜¯åœ¨ Linux å†…æ ¸ä¸­è¿›è¡Œçš„å®å®šä¹‰ï¼Œæ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œè€Œ poll æ˜¯åŸºäºé“¾è¡¨æ¥å­˜å‚¨çš„ï¼Œæ‰€ä»¥æ²¡æœ‰è¿™ä¸ªä¸Šé™ã€‚<br>è€Œ epoll æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦è½®è¯¢ï¼Œepoll ä¼šæŠŠäº‹ä»¶å’Œæ¯ä¸€ä¸ªIOæµå¯¹åº”èµ·æ¥ã€‚å¹¶ä¸” epoll æ˜¯é€šè¿‡ä¸€å—å…±äº«å†…å­˜æ¥å®ç°å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„é€šä¿¡çš„ï¼Œæ¯”èµ· select å’Œ poll çš„å¤§é‡æ•°æ®æ‹·è´æ•ˆç‡æ›´é«˜ã€‚<br>ä¸è¿‡ lect çš„ä¼˜ç‚¹åœ¨äºå…¼å®¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œè€Œ poll å’Œ epoll éƒ½åªèƒ½åœ¨ linux ä¸Šä½¿ç”¨ã€‚</p><p><font color="blue">ç®€è¿°è¿›ç¨‹é€šä¿¡çš„å„ç§æ–¹æ³•</font><br>æ¶‰åŠå…¬å¸ï¼šè…¾è®¯å®ä¹ ç”Ÿ</p><p>è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼é€šå¸¸åˆ†ä¸ºç®¡é“ã€ç³»ç»Ÿ IPCã€å¥—æ¥å­—ä¸‰ç§ï¼Œå…¶ä¸­ç®¡é“æœ‰æ— åç®¡é“ã€å‘½åç®¡é“ï¼Œç³»ç»Ÿ IPC æœ‰æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·ã€å…±äº«å†…å­˜</p><p>æ— åç®¡é“çš„æœ¬è´¨æ˜¯åœ¨å†…æ ¸ç¼“å†²åŒºçš„ç¯å½¢é˜Ÿåˆ—ï¼Œæ¯æ¬¡è¯»å–æ•°æ®åç¼“å†²åŒºéƒ½ä¼šç§»åŠ¨ï¼Œå¹¶ä¸”æ— åç®¡é“åªèƒ½åœ¨æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´ä½¿ç”¨<br>å‘½åç®¡é“åˆ™ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œç”±äºæœ‰ä¸€ä¸ªè·¯å¾„åï¼Œä½¿ç”¨æ²¡æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½åç®¡é“<br>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å­˜æ”¾åœ¨å†…æ ¸ä¸­çš„æ¶ˆæ¯é“¾è¡¨ï¼Œå…·æœ‰ç‰¹å®šçš„æ ¼å¼ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼Œä¸”å…è®¸å¤šä¸ªè¿›ç¨‹è¿›è¡Œè¯»å†™<br>ä¿¡å·æ˜¯è½¯ä»¶å±‚æ¬¡ä¸Šå¯¹ä¸­æ–­æœºåˆ¶çš„ä¸€ç§æ¨¡æ‹Ÿï¼Œæ˜¯ä¸€ç§å¼‚æ­¥é€šä¿¡æ–¹å¼ï¼Œå¹¶ä¸”ä¿¡å·å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´è¿›ç¨‹å’Œå†…æ ¸ä¹‹é—´ç›´æ¥äº¤äº’<br>å…±äº«å†…å­˜é¡¾åæ€ä¹‰å°±æ˜¯ä¸¤ä¸ªè¿›è¡Œå¯¹åŒä¸€å—å†…å­˜è¿›è¡Œè¯»å†™ï¼Œæ˜¯æœ€å¿«çš„ IPC å½¢å¼ï¼Œä½†ä¸é€‚åˆå¤§é‡çš„æ•°æ®ä¼ è¾“<br>Socket æ˜¯å¯¹ TCP/IP åè®®æ—çš„å°è£…ï¼Œä¸ä»…å¯ä»¥ç”¨äºæœ¬æœºä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œæ›´å¤šçš„è¢«ç”¨äºç½‘ç»œé€šä¿¡ä¸­<br>è¿›ç¨‹çº¿ç¨‹ç®¡ç†<br>è¿›ç¨‹çš„äº’æ–¥ä¸åŒæ­¥<br>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ˜¯å æœ‰èµ„æºçš„æœ€å°å•ä½ï¼Œå¯¹äºé‚£ç§åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªè¿›ç¨‹æŒæœ‰çš„èµ„æºæˆ‘ä»¬ç§°ä¸ºä¸´ç•Œèµ„æºï¼Œå¯¹äºä¸´ç•Œèµ„æºçš„è®¿é—®ï¼Œå¿…é¡»æ˜¯äº’æ–¥çš„ã€‚ï¼ˆå¯¹äºï¼›ä¸´ç•Œèµ„æºçš„è®¿é—®è¿‡ç¨‹åˆ†ä¸ºï¼šè¿›å…¥åŒºã€ä¸´ç•ŒåŒºã€é€€å‡ºåŒºã€å‰©ä½™åŒºï¼‰</p><p>è€Œè¿›ç¨‹ä¹‹é—´è®¿é—®ä¸´ç•Œèµ„æºæ—¶å¯ä»¥æ„æˆåŒæ­¥ä¸äº’æ–¥ä¸¤ç§å…³ç³»ï¼ŒåŒæ­¥å³ä¸¤ä¸ªè¿›ç¨‹çš„èµ„æºè®¿é—®å¿…é¡»æ˜¯å…ˆåå…³ç³»ï¼Œæ¯”å¦‚ç»å…¸çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼Œè¯»è€…å†™ç€é—®é¢˜ã€‚è€Œäº’æ–¥åˆ™æ˜¯ä¸¤ç§åœ¨è¿›è¡Œèµ„æºæŠ¢åˆ°ï¼Œæ¯”å¦‚è´­ç¥¨é—®é¢˜ã€‚</p><p>é€šå¸¸åœ¨è½¯ä»¶å±‚é¢å¯ä»¥ä½¿ç”¨æ›¿æ¢ç®—æ³•æ¥å®ç°ï¼Œå³æ¯ä¸ªè¿›ç¨‹æŒæœ‰ä¸€ä¸ªæ ‡å¿—ï¼Œæ¯æ¬¡å½“ä½¿ç”¨èµ„æºæ—¶åˆ™å°†è‡ªå·±çš„æ ‡å¿—ä¸èµ„æºçš„æ ‡å¿—äº’æ¢ï¼Œå¦‚æœåœ¨äº’æ¢çš„è¿‡ç¨‹ä¸­å‘ç°è‡ªå·±è·å¾—çš„æ ‡å¿—æ˜¯æ­£åœ¨ä½¿ç”¨çš„çŠ¶æ€ï¼Œåˆ™åœ¨æ­¤å¾ªç¯ç­‰å¾…ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹åœ¨äºæ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦è¿›è¡Œå¾ªç¯ç­‰å¾…ï¼Œæ¯”è¾ƒä½æ•ˆã€‚æ‰€ä»¥ä¸€èˆ¬æ˜¯é€šè¿‡ç¡¬ä»¶å±‚é¢çš„ä¿¡å·é‡å³PVæ“ä½œæ¥å®ç°è¿›ç¨‹çš„ä¸´ç•Œèµ„æºç®¡ç†ã€‚</p><p>æ­»é”çš„è§£å†³æ–¹æ³•<br>æ¶‰åŠå…¬å¸ï¼šé˜¿é‡Œäº‘å®ä¹ ç”Ÿ</p><p>æ­»é”çš„äº§ç”Ÿæ˜¯åœ¨è¿™æ ·ä¸€ç§ç¯å¢ƒä¸­ï¼šæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¿›ç¨‹ABï¼Œä»–ä»¬éƒ½éœ€è¦èµ„æº1å’Œèµ„æº2ï¼Œå½“è¿›ç¨‹AæŒæœ‰èµ„æº1ï¼Œè¿›çº¿ç¨‹BæŒæœ‰èµ„æº2çš„æ—¶å€™ï¼Œä»–ä»¬éƒ½éœ€è¦å¯¹æ–¹æ‰‹ä¸Šçš„è¿›ç¨‹ï¼Œè€Œä¸€èˆ¬æ“ä½œç³»ç»Ÿåˆä¸å…è®¸æŠ¢å ï¼Œè¿™ä¸ªæ—¶å€™å°±å‘ç”Ÿäº†æ­»é”ã€‚</p><p>ä»è¿™ä¸ªä¾‹å­ä¸­å…¶å®å¯ä»¥æ€»ç»“å‡ºæ­»é”çš„å‡ ä¸ªå¿…è¦æ¡ä»¶ï¼š</p><p>1.ä¸€ä¸ªèµ„æºåªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰ï¼Œä¸èƒ½å…±äº«<br>2.ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚èµ„æºå¤±è´¥æ—¶ï¼Œå®ƒä¼šç­‰å¾…è€Œä¸æ˜¯é‡Šæ”¾<br>3.ä¸€ä¸ªçº¿ç¨‹åœ¨é‡Šæ”¾èµ„æºä¹‹å‰å…¶ä»–è¿›ç¨‹ä¸èƒ½æŠ¢å¤ºèµ„æº<br>4.å¾ªç¯ç­‰å¾…<br>ä»æ­»é”äº§ç”Ÿçš„åŸå› æœªæ˜å¯ä»¥è®¾è®¡ä¸€äº›æ–¹æ³•å»é¿å…æ­»é”çš„å‘ç”Ÿ</p><p>1.é™æ€åˆ†é…èµ„æºï¼Œä¸€å¼€å§‹å°±æŠŠä¸€ä¸ªè¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨èµ„æºéƒ½åˆ†é…ç»™å®ƒï¼Œä½†è¿™æ ·ä¼šé™ä½èµ„æºçš„ä½¿ç”¨æ•ˆç‡<br>2.å…è®¸æŠ¢å ï¼Œéœ€è¦è®¾ç½®è¿›ç¨‹çš„ä¸åŒä¼˜å…ˆçº§ï¼Œé«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹å¯ä»¥æŠ¢å ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹çš„èµ„æº<br>3.æŠŠèµ„æºè¿›è¡Œç¼–å·ï¼Œç”³è¯·èµ„æºå¿…é¡»æŒ‰ç…§èµ„æºçš„ç¼–å·é¡ºåºæ¥ç”³è¯·<br>å¦‚æœæ­»é”å·²ç»å‘ç”Ÿäº†ï¼Œå°±éœ€è¦å»è§£å¼€æ­»é”ï¼Œå…¶æœ¬è´¨æ€æƒ³å°±æ˜¯åˆ†é…èµ„æºæ‰“ç ´å¾ªç¯ç­‰å¾…</p><p>1.å¯ä»¥è¿è¡ŒæŠ¢å ï¼Œä»ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ä¸­æŠ¢å‡ºèµ„æºæ¥ç»™å…¶ä»–è¿›ç¨‹<br>2.ä¹Ÿå¯ä»¥ç»ˆæ­¢ä¸€äº›è¿›ç¨‹ï¼Œæ¥è¾¾åˆ°é‡Šæ”¾èµ„æºçš„ç›®çš„<br>è¿›ç¨‹è°ƒåº¦ç®—æ³•<br>å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•<br>å¯¹é•¿ä½œä¸šæ¯”è¾ƒæœ‰åˆ©ï¼Œä½†å¯¹çŸ­ä½œä¸šä¸åˆ©<br>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦æ³•<br>æ¯ä¸ªè¿›ç¨‹åªèƒ½è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡<br>æ—¶é—´ç‰‡çš„å¤§å°å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“å¾ˆå¤§ï¼Œæ—¶é—´ç‰‡è¿‡å¤§å°±å’Œå…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ä¸€æ ·ï¼Œæ—¶é—´ç‰‡è¿‡å°ä¼šå¯¼è‡´è¿›è¡Œåˆ‡æ¢å¼€é”€å¤§<br>çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•<br>å¯¹é•¿ä½œä¸šä¸åˆ©ï¼Œä¸èƒ½ä¿è¯ç´§è¿«æ€§ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰è¢«åŠæ—¶å¤„ç†<br>æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ<br>å…è®¸æŠ¢å ï¼Œæ€»æ˜¯é€‰æ‹©é¢„æœŸå‰©ä½™æ—¶é—´æœ€çŸ­çš„è¿›ç¨‹<br>é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•<br>R=(w+s)/s ï¼ˆR ä¸ºå“åº”æ¯”ï¼Œw ä¸ºç­‰å¾…å¤„ç†çš„æ—¶é—´ï¼Œs ä¸ºé¢„è®¡çš„æœåŠ¡æ—¶é—´ï¼‰ï¼Œé€‰æ‹© R æœ€å¤§çš„è¿›è¡Œæ‰§è¡Œ<br>ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•<br>è¿›ç¨‹ä¼˜å…ˆçº§å¯ä»¥åˆ†ä¸ºé™æ€ä¼˜å…ˆçº§å’ŒåŠ¨æ€ä¼˜å…ˆçº§<br>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•<br>åˆ†ä¸ºå¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸­æŒ‰æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•æ¥è¿›è¡Œè¿›ç¨‹è°ƒåº¦ï¼Œæ¯ä¸€çº§çš„é˜Ÿåˆ—æ—¶é—´ç‰‡å¤§å°ä¹Ÿä¸ä¸€æ ·ï¼Œå¦‚æœè¿›è¡Œåœ¨ç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„æ—¶é—´ç‰‡å†…æ²¡æœ‰å®Œæˆï¼Œå°±ä¼šè¿›å…¥ç¬¬äºŒä¸ªé˜Ÿåˆ—ï¼Œä»¥æ­¤ç±»æ¨ï¼Œåªæœ‰å½“ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ä¸ºç©ºæ‰æ‰§è¡Œç¬¬äºŒä¸ªé˜Ÿåˆ—çš„è¿›è¡Œ<br>çŸ­ä½œä¸šæœ‰é™ä¸”é•¿ä½œä¸šä¸ä¼šå¤ªé•¿æ—¶é—´ä¸è¢«å¤„ç†<br>ç£ç›˜è°ƒåº¦ç®—æ³•<br>å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ï¼ˆFCFSï¼‰<br>æ ¹æ®è¿›ç¨‹è¯·æ±‚è®¿é—®ç£ç›˜çš„å…ˆåæ¬¡åºè¿›è¡Œè°ƒåº¦<br>ä¼˜ç‚¹æ˜¯å…¬å¹³ã€ç®€å•<br>ç¼ºç‚¹æ˜¯ååé‡ä½ï¼Œå¯»é“æ—¶é—´é•¿<br>æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆç®—æ³•ï¼ˆSSTFï¼‰<br>è®¿é—®ä¸å½“å‰ç£å¤´æ‰€åœ¨çš„ç£é“è·ç¦»æœ€è¿‘çš„ç£é“<br>ä¼˜ç‚¹æ˜¯å¯ä»¥å¾—åˆ°æ¯”è¾ƒå¥½çš„ååé‡<br>ç¼ºç‚¹æ˜¯å¯¹å†…å¤–è¾¹ç¼˜ç£é“çš„è¯·æ±‚å°†ä¼šè¢«æ— é™å»¶è¿Ÿ<br>æ‰«æç®—æ³•ï¼ˆSCANï¼‰ç”µæ¢¯è°ƒåº¦ç®—æ³•<br>ä¼˜å…ˆè€ƒè™‘ç£å¤´å½“å‰çš„ç§»åŠ¨æ–¹å‘ï¼Œå†è€ƒè™‘æ¬²è®¿é—®çš„ç£é“ä¸å½“å‰ç£é“çš„è·ç¦»<br>ä¼˜ç‚¹æ˜¯é¿å…äº†é¥¥é¥¿ç°è±¡çš„å‡ºç°<br>ç¼ºç‚¹æ˜¯ä¸¤ä¾§ç£é“è¢«è®¿é—®çš„é¢‘ç‡ä»ä½äºä¸­é—´ç£é“<br>å¾ªç¯æ‰«æç®—æ³•ï¼ˆCSCANï¼‰<br>åœ¨SCANç®—æ³•çš„åŸºç¡€ä¸Šï¼Œç£å¤´åªå•å‘ç§»åŠ¨ï¼Œå½“ç£å¤´ç§»åˆ°æœ€å¤–çš„è¢«è®¿é—®ç£é“æ—¶ï¼Œç£å¤´ç«‹å³è¿”å›åˆ°æœ€é‡Œçš„æ¬²è®¿ç£é“<br>ä¼˜ç‚¹æ˜¯è®¿é—®è¯·æ±‚å‡åŒ€åˆ†å¸ƒ<br>é¡µé¢è°ƒåº¦ç®—æ³•<br>å…ˆè¿›å…ˆå‡ºè°ƒåº¦ç®—æ³•ï¼ˆFIFOï¼ŒFirst In First Outï¼‰<br>æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•(LFU, Least Frequently Used)<br>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç®—æ³•ï¼ˆLRUï¼ŒLeast Recently Usedï¼‰<br>æ—¶é’Ÿç½®æ¢ç®—æ³•â€”â€”ä¸ºæ¯ä¸€é¡µè®¾ç½®è®¿é—®ä½å’Œä¿®æ”¹ä½ï¼Œå°†å†…å­˜ä¸­æ‰€æœ‰é¡µé¢é€šè¿‡è¿æ¥æŒ‡é’ˆæ¥æˆå¾ªç¯é˜Ÿåˆ—ï¼Œå½“é¡µé¢è¢«è®¿é—®æ—¶è®¿é—®ä½ç½® 1ï¼Œè¢«ä¿®æ”¹åˆ™ä¿®æ”¹ä½ç½® 1ï¼Œæ¯æ¬¡æ·˜æ±°æ—¶ï¼Œä»æŒ‡é’ˆå½“å‰ä½ç½®å¼€å§‹å¾ªç¯éå†ï¼Œç¬¬ä¸€æ¬¡å¯»æ‰¾è®¿é—®ä½å’Œä¿®æ”¹ä½éƒ½ä¸º0çš„é¡µé¢ï¼Œå¦‚æœæ²¡æœ‰åˆ™å°†æ‰«æè¿‡çš„èŠ‚ç‚¹è®¿é—®ä½ä¸º 1 çš„ç½®ä¸º 0ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªè®¿é—®ä½ä¸º 0 çš„å°†å…¶æ·˜æ±°ã€‚è¿™ä¸ªç®—æ³•çš„åŸåˆ™å°±çš„åœ¨LRUçš„åŸºç¡€ä¸Šåå‘äºæ·˜æ±°æœªè¢«ä¿®æ”¹çš„é¡µé¢ã€‚<br>æœ€ä½³ç½®æ¢ç®—æ³•â€”â€”ç†æƒ³ç®—æ³•ï¼Œæ‰¾ä¸€ä¸ªæœªæ¥æœ€é•¿æ—¶é—´æ‰ä¼šè¢«è®¿é—®çš„é¡µé¢è¿›è¡Œæ·˜æ±°ã€‚</p><h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>UNIXä¸­è¿›ç¨‹å°†å†…å­˜åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†:<code>text segment æ–‡æœ¬åŒº</code>ã€<code>data segment æ•°æ®åŒº</code>ã€<code>stack segment æ ˆåŒºåŸŸ</code>ï¼ˆç§æœ‰å˜é‡ï¼‰ã€‚æ•°æ®å‘ä¸Šå¢é•¿ï¼Œå †æ ˆå‘ä¸‹å¢é•¿ã€‚</p><p><img src="/2021/03/15/operate/%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D-1615794509251.PNG"></p><p><strong>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ï¼Œå³CPUåˆ†é…æ—¶é—´çš„å•ä½ ã€‚</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><h1 id="operate2"><a href="#operate2" class="headerlink" title="operate2"></a>operate2</h1><h2 id="æ“ä½œç³»ç»Ÿçš„å››å¤§ç‰¹æ€§"><a href="#æ“ä½œç³»ç»Ÿçš„å››å¤§ç‰¹æ€§" class="headerlink" title="æ“ä½œç³»ç»Ÿçš„å››å¤§ç‰¹æ€§"></a>æ“ä½œç³»ç»Ÿçš„å››å¤§ç‰¹æ€§</h2><ul><li>å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…å¤šä¸ªç¨‹åºæ‰§è¡Œ</li><li>å…±äº«ï¼šç³»ç»Ÿä¸­çš„èµ„æºå¯ä»¥è¢«å†…å­˜ä¸­å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›çº¿ç¨‹å…±åŒä½¿ç”¨</li><li>è™šæ‹Ÿï¼šé€šè¿‡æ—¶åˆ†å¤ç”¨ï¼ˆå¦‚åˆ†æ—¶ç³»ç»Ÿï¼‰ä»¥åŠç©ºåˆ†å¤ç”¨ï¼ˆå¦‚è™šæ‹Ÿå†…å­˜ï¼‰æŠ€æœ¯å®ç°æŠŠä¸€ä¸ªç‰©ç†å®ä½“è™šæ‹Ÿä¸ºå¤šä¸ª</li><li>å¼‚æ­¥ï¼šç³»ç»Ÿä¸­çš„è¿›ç¨‹æ˜¯ä»¥èµ°èµ°åœåœçš„æ–¹å¼æ‰§è¡Œçš„ï¼Œä¸”ä»¥ä¸€ç§ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦æ¨è¿›</li></ul><h2 id="æ“ä½œç³»ç»ŸåŸºæœ¬åŠŸèƒ½"><a href="#æ“ä½œç³»ç»ŸåŸºæœ¬åŠŸèƒ½" class="headerlink" title="æ“ä½œç³»ç»ŸåŸºæœ¬åŠŸèƒ½"></a>æ“ä½œç³»ç»ŸåŸºæœ¬åŠŸèƒ½</h2><ul><li><p>è¿›ç¨‹ç®¡ç†</p><p>ï¼š</p><ul><li>è¿›ç¨‹æ§åˆ¶ã€è¿›ç¨‹åŒæ­¥ã€è¿›ç¨‹é€šä¿¡ã€æ­»é”å¤„ç†ã€å¤„ç†æœºè°ƒåº¦ç­‰</li></ul></li><li><p>å†…å­˜ç®¡ç†</p><p>ï¼š</p><ul><li>å†…å­˜åˆ†é…ã€åœ°å€æ˜ å°„ã€å†…å­˜ä¿æŠ¤ä¸å…±äº«ã€è™šæ‹Ÿå†…å­˜ç­‰</li></ul></li><li><p>æ–‡ä»¶ç®¡ç†</p><p>ï¼š</p><ul><li>æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†ã€ç›®å½•ç®¡ç†ã€æ–‡ä»¶è¯»å†™ç®¡ç†å’Œä¿æŠ¤ç­‰</li></ul></li><li><p>è®¾å¤‡ç®¡ç†</p><p>ï¼š</p><ul><li>å®Œæˆç”¨æˆ·çš„ I/O è¯·æ±‚ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨å„ç§è®¾å¤‡ï¼Œå¹¶æé«˜è®¾å¤‡çš„åˆ©ç”¨ç‡ã€‚ä¸»è¦åŒ…æ‹¬ç¼“å†²ç®¡ç†ã€è®¾å¤‡åˆ†é…ã€è®¾å¤‡å¤„ç†ã€è™›æ‹Ÿè®¾å¤‡ç­‰</li></ul></li></ul><h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><ul><li>CPUï¼ˆä¸­å¤®å¤„ç†å™¨ï¼‰</li><li>è¿›ç¨‹æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€</li><li><strong>èµ„æºåˆ†é…çš„æœ€å°å•ä½æ˜¯è¿›ç¨‹ï¼Œè€ŒCPUè°ƒåº¦çš„æœ€å°å•ä½æ˜¯æ—¶é—´ç‰‡</strong></li><li>ç³»ç»Ÿä¸ºè¿›ç¨‹åˆ†é…èµ„æºï¼Œä¸å¯¹çº¿ç¨‹åˆ†é…èµ„æº</li></ul><h3 id="CPUè°ƒåº¦"><a href="#CPUè°ƒåº¦" class="headerlink" title="CPUè°ƒåº¦"></a>CPUè°ƒåº¦</h3><ul><li>é«˜çº§è°ƒåº¦ï¼ˆä½œä¸šè°ƒåº¦ï¼‰ï¼š<ul><li>å¤šé“æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿä¸­ï¼Œä»è¾“å…¥ç³»ç»Ÿçš„ä¸€æ‰¹ä½œä¸šä¸­æŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥æŒ‘é€‰è‹¥å¹²ä½œä¸šè¿›å…¥å†…å­˜ï¼Œä¸ºå…¶åˆ†é…èµ„æºå¹¶åˆ›å»ºå¯¹åº”çš„ä½œä¸šç”¨æˆ·è¿›ç¨‹</li><li>ä½œä¸šæ˜¯ä»»åŠ¡å®ä½“ï¼Œè¿›ç¨‹æ˜¯å®Œæˆä»»åŠ¡çš„æ‰§è¡Œå®ä½“ã€‚<strong>ä½œä¸šçš„æ¦‚å¿µå¤šç”¨äºæ‰¹å¤„ç†æ“ä½œç³»ç»Ÿï¼Œè€Œè¿›ç¨‹ç”¨äºå„ç§å¤šé“ç¨‹åºè®¾è®¡ç³»ç»Ÿ</strong></li></ul></li><li>ä¸­çº§è°ƒåº¦<ul><li>æ ¹æ®å†…å­˜èµ„æºæƒ…å†µå†³å®šå†…å­˜ä¸­æ‰€èƒ½å®¹çº³çš„è¿›ç¨‹æ•°ç›®ï¼Œå¹¶å®Œæˆå¤–å­˜å’Œå†…å­˜ä¸­çš„è¿›ç¨‹å¯¹æ¢å·¥ä½œï¼ˆæŒ‚èµ·ï¼‰ã€‚èµ·åˆ°çŸ­æœŸå‡è¡¡ç³»ç»Ÿè´Ÿè½½çš„ä½œç”¨</li></ul></li><li>ä½çº§è°ƒåº¦ï¼ˆè¿›ç¨‹è°ƒåº¦/çº¿ç¨‹è°ƒåº¦ï¼‰<ul><li><strong>æ ¹æ®æŸç§åŸåˆ™å†³å®šå°±ç»ªé˜Ÿåˆ—ä¸­å“ªä¸ªè¿›ç¨‹/çº¿ç¨‹è·å¾—å¤„ç†å™¨ï¼Œå¹¶å°†å¤„ç†å™¨å‡ºè®©ç»™å®ƒä½¿ç”¨</strong></li></ul></li></ul><h3 id="Qï¼šæŸä¸€è¿›ç¨‹CPUä½¿ç”¨ç‡-50-æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#Qï¼šæŸä¸€è¿›ç¨‹CPUä½¿ç”¨ç‡-50-æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="Qï¼šæŸä¸€è¿›ç¨‹CPUä½¿ç”¨ç‡ 50% æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>Qï¼šæŸä¸€è¿›ç¨‹CPUä½¿ç”¨ç‡ 50% æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3><ul><li>CPUä½¿ç”¨ç‡æ˜¯æ¥æè¿°CPUçš„ä½¿ç”¨æƒ…å†µçš„ï¼Œè¡¨æ˜äº†ä¸€æ®µæ—¶é—´å†…CPUè¢«å ç”¨çš„æƒ…å†µã€‚ä½¿ç”¨ç‡è¶Šé«˜ï¼Œè¯´æ˜ä½ çš„æœºå™¨åœ¨è¿™ä¸ªæ—¶é—´ä¸Šè¿è¡Œäº†å¾ˆå¤šç¨‹åºï¼Œåä¹‹è¾ƒå°‘ã€‚ä½¿ç”¨ç‡çš„é«˜ä½ä¸ä½ çš„CPUå¼ºå¼±æœ‰ç›´æ¥å…³ç³»ã€‚</li><li>CPUçš„å ç”¨ç‡ï¼Œä¸€èˆ¬æŒ‡çš„å°±æ˜¯å¯¹æ—¶é—´ç‰‡çš„å ç”¨æƒ…å†µï¼ŒCPUï¼š50% è¯´æ˜ CPU æœ‰ä¸€åŠçš„æ—¶é—´åœ¨è¿è¡Œï¼Œä¸€åŠçš„æ—¶é—´åœ¨ä¼‘æ¯ï¼ˆ100MS ä¸­50MSè¢«è¿›ç¨‹å ç”¨ï¼Œ50MSå¤„äºç©ºé—²çŠ¶æ€ï¼‰</li></ul><h3 id="Qï¼šå¦‚ä½•è®©CPUä½¿ç”¨ç‡å›ºå®šåœ¨50-ã€ä»…é™äºå•æ ¸CPUã€‘"><a href="#Qï¼šå¦‚ä½•è®©CPUä½¿ç”¨ç‡å›ºå®šåœ¨50-ã€ä»…é™äºå•æ ¸CPUã€‘" class="headerlink" title="Qï¼šå¦‚ä½•è®©CPUä½¿ç”¨ç‡å›ºå®šåœ¨50%ã€ä»…é™äºå•æ ¸CPUã€‘"></a>Qï¼šå¦‚ä½•è®©CPUä½¿ç”¨ç‡å›ºå®šåœ¨50%ã€ä»…é™äºå•æ ¸CPUã€‘</h3><ul><li><p>CPUçš„å æœ‰ç‡æ˜¯ç”±è¿›ç¨‹çš„å¿™å’Œç©ºé—²æ¥å†³å®šçš„ï¼Œå³ rate=(busy_time)/(busy_time+idle_time);</p></li><li><p>è®©CPUä½¿ç”¨ç‡å›ºå®šåœ¨50%ï¼Œåªè¦è®©è®¡ç®—æœºæœ‰ä¸€åŠçš„æ—¶é—´åœ¨è¿è¡Œï¼Œä¸€åŠçš„æ—¶é—´åœ¨ä¼‘æ¯å°±å¯ä»¥äº†ã€‚</p></li><li><p>busyå¯ä»¥ç”¨å¾ªç¯ï¼ˆè¿™ä¸ªå¾ªç¯ç”¨ç©ºå¾ªç¯ï¼Œä»¥ä¾¿å¥½æ§åˆ¶ï¼‰ï¼Œidleå¯ä»¥ç”¨sleep</p></li><li><p>æ¯”å¦‚å…ˆè®©ä»»åŠ¡ç®¡ç†å™¨çš„cpuä½¿ç”¨ç‡å§‹ç»ˆä¿æŒåœ¨50%å·¦å³ï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªä¸»å¾ªç¯ä¸­ï¼Œè®©ç©ºå¾ªç¯å’Œsleepè¿è¡ŒåŒæ ·çš„ä¸€å°æ®µæ—¶é—´ã€‚sleepçš„æ—¶é—´å¥½æï¼Œç©ºå¾ªç¯çš„æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™è®¾å®šç©ºå¾ªç¯çš„è¿è¡Œæ—¶é—´</p><p><code>public</code> <code>static</code> <code>void</code> <code>main(String args[]) ``throws</code> <code>InterruptedException{``   ``int</code> <code>busyTime = ``10``;``   ``int</code> <code>idleTime = busyTime;``   ``//è®¾å®šç©ºå¾ªç¯çš„è¿è¡Œæ—¶é—´``   ``while``(``true``){``     ``long</code> <code>startTime = System.currentTimeMillis();``     ``//busy loop:``     ``while``((System.currentTimeMillis()-startTime)&lt;=busyTime)``       ``;``     ``Thread.sleep(idleTime);``   ``}`` ``}</code></p></li></ul><h2 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h2><p>å†…å­˜çš„å†…éƒ¨æ˜¯ç”±å„ç§ IC ç”µè·¯ç»„æˆçš„ï¼Œå®ƒçš„ç§ç±»å¾ˆåºå¤§ï¼Œä½†æ˜¯å…¶ä¸»è¦åˆ†ä¸ºä¸‰ç§å­˜å‚¨å™¨ï¼š</p><ul><li>éšæœºå­˜å‚¨å™¨ï¼ˆRAMï¼‰ï¼šå†…å­˜ä¸­æœ€é‡è¦çš„ä¸€ç§ï¼Œè¡¨ç¤ºæ—¢å¯ä»¥ä»ä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™å…¥æ•°æ®ã€‚å½“æœºå™¨å…³é—­æ—¶ï¼Œå†…å­˜ä¸­çš„ä¿¡æ¯ä¼šä¸¢å¤±</li><li>åªè¯»å­˜å‚¨å™¨ï¼ˆROMï¼‰ï¼šROM ä¸€èˆ¬åªèƒ½ç”¨äºæ•°æ®çš„è¯»å–ï¼Œä¸èƒ½å†™å…¥æ•°æ®ï¼Œä½†æ˜¯å½“æœºå™¨åœç”µæ—¶ï¼Œè¿™äº›æ•°æ®ä¸ä¼šä¸¢å¤±</li><li>é«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰ï¼šCache ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸è§åˆ°çš„ï¼Œå®ƒåˆ†ä¸ºä¸€çº§ç¼“å­˜ï¼ˆL1 Cacheï¼‰ã€äºŒçº§ç¼“å­˜ï¼ˆL2 Cacheï¼‰ã€ä¸‰çº§ç¼“å­˜ï¼ˆL3 Cacheï¼‰è¿™äº›æ•°æ®ï¼Œå®ƒä½äºå†…å­˜å’Œ CPU ä¹‹é—´ï¼Œæ˜¯ä¸€ä¸ªè¯»å†™é€Ÿåº¦æ¯”å†…å­˜æ›´å¿«çš„å­˜å‚¨å™¨ã€‚å½“ CPU å‘å†…å­˜å†™å…¥æ•°æ®æ—¶ï¼Œè¿™äº›æ•°æ®ä¹Ÿä¼šè¢«å†™å…¥é«˜é€Ÿç¼“å­˜ä¸­ã€‚å½“ CPU éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œä¼šç›´æ¥ä»é«˜é€Ÿç¼“å­˜ä¸­ç›´æ¥è¯»å–ï¼Œå½“ç„¶ï¼Œå¦‚éœ€è¦çš„æ•°æ®åœ¨Cacheä¸­æ²¡æœ‰ï¼ŒCPUä¼šå†å»è¯»å–å†…å­˜ä¸­çš„æ•°æ®.</li></ul><h3 id="å†…å­˜ç®¡ç†æœºåˆ¶"><a href="#å†…å­˜ç®¡ç†æœºåˆ¶" class="headerlink" title="å†…å­˜ç®¡ç†æœºåˆ¶"></a>å†…å­˜ç®¡ç†æœºåˆ¶</h3><ul><li><p>æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†ä¸»è¦è´Ÿè´£<strong>å†…å­˜çš„åˆ†é…ä¸å›æ”¶</strong>ï¼ˆmalloc å‡½æ•°ï¼šç”³è¯·å†…å­˜ï¼Œfree å‡½æ•°ï¼šé‡Šæ”¾å†…å­˜ï¼‰ï¼Œå¦å¤–åœ°å€è½¬æ¢ä¹Ÿå°±æ˜¯<strong>å°†é€»è¾‘åœ°å€è½¬æ¢æˆç›¸åº”çš„ç‰©ç†åœ°å€</strong>ç­‰åŠŸèƒ½ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åšçš„äº‹æƒ…</p></li><li><p>è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</p><p>ï¼šè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼æ˜¯æŒ‡ä¸ºä¸€ä¸ªç”¨æˆ·ç¨‹åºåˆ†é…ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¸¸è§çš„å¦‚</p><p>å—å¼ç®¡ç†</p><ul><li><strong>å—å¼ç®¡ç†</strong>ï¼šå°†å†…å­˜åˆ†ä¸ºå‡ ä¸ªå›ºå®šå¤§å°çš„å—ï¼Œæ¯ä¸ªå—ä¸­åªåŒ…å«ä¸€ä¸ªè¿›ç¨‹ã€‚å¦‚æœç¨‹åºè¿è¡Œéœ€è¦å†…å­˜çš„è¯ï¼Œæ“ä½œç³»ç»Ÿå°±åˆ†é…ç»™å®ƒä¸€å—ï¼Œå¦‚æœç¨‹åºè¿è¡Œåªéœ€è¦å¾ˆå°çš„ç©ºé—´çš„è¯ï¼Œåˆ†é…çš„è¿™å—å†…å­˜å¾ˆå¤§ä¸€éƒ¨åˆ†å‡ ä¹è¢«æµªè´¹äº†ã€‚è¿™äº›åœ¨æ¯ä¸ªå—ä¸­æœªè¢«åˆ©ç”¨çš„ç©ºé—´ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç¢ç‰‡</li></ul></li><li><p>éè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</p><p>ï¼šéè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼å…è®¸ä¸€ä¸ªç¨‹åºä½¿ç”¨çš„å†…å­˜åˆ†å¸ƒåœ¨ç¦»æ•£æˆ–è€…è¯´ä¸ç›¸é‚»çš„å†…å­˜ä¸­</p><ul><li><strong>é¡µå¼ç®¡ç†</strong> ï¼šæŠŠä¸»å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰ä¸”å›ºå®šçš„ä¸€é¡µä¸€é¡µçš„å½¢å¼ï¼Œé¡µè¾ƒå°ï¼Œç›¸å¯¹ç›¸æ¯”äºå—å¼ç®¡ç†çš„åˆ’åˆ†åŠ›åº¦æ›´å¤§ï¼Œæé«˜äº†å†…å­˜åˆ©ç”¨ç‡ï¼Œå‡å°‘äº†ç¢ç‰‡ã€‚<strong>é¡µå¼ç®¡ç†é€šè¿‡é¡µè¡¨å¯¹åº”é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€</strong></li><li><strong>æ®µå¼ç®¡ç†</strong> ï¼š é¡µå¼ç®¡ç†è™½ç„¶æé«˜äº†å†…å­˜åˆ©ç”¨ç‡ï¼Œä½†æ˜¯é¡µå¼ç®¡ç†å…¶ä¸­çš„é¡µå®é™…å¹¶æ— ä»»ä½•å®é™…æ„ä¹‰ã€‚ æ®µå¼ç®¡ç†æŠŠä¸»å­˜åˆ†ä¸ºä¸€æ®µæ®µçš„ï¼Œæ¯ä¸€æ®µçš„ç©ºé—´åˆè¦æ¯”ä¸€é¡µçš„ç©ºé—´å°å¾ˆå¤š ã€‚ä½†æ˜¯ï¼Œæœ€é‡è¦çš„æ˜¯<strong>æ®µæ˜¯æœ‰å®é™…æ„ä¹‰çš„ï¼Œæ¯ä¸ªæ®µå®šä¹‰äº†ä¸€ç»„é€»è¾‘ä¿¡æ¯</strong>ï¼Œä¾‹å¦‚,æœ‰ä¸»ç¨‹åºæ®µ MAINã€å­ç¨‹åºæ®µ Xã€æ•°æ®æ®µ D åŠæ ˆæ®µ S ç­‰ã€‚ <strong>æ®µå¼ç®¡ç†é€šè¿‡æ®µè¡¨å¯¹åº”é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€</strong></li><li><strong>æ®µé¡µå¼ç®¡ç†æœºåˆ¶</strong> ï¼šæ®µé¡µå¼ç®¡ç†æœºåˆ¶ç»“åˆäº†æ®µå¼ç®¡ç†å’Œé¡µå¼ç®¡ç†çš„ä¼˜ç‚¹ã€‚ç®€å•æ¥è¯´æ®µé¡µå¼ç®¡ç†æœºåˆ¶å°±æ˜¯<strong>æŠŠä¸»å­˜å…ˆåˆ†æˆè‹¥å¹²æ®µï¼Œæ¯ä¸ªæ®µåˆåˆ†æˆè‹¥å¹²é¡µ</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æ®µé¡µå¼ç®¡ç†æœºåˆ¶ä¸­æ®µä¸æ®µä¹‹é—´ä»¥åŠæ®µçš„å†…éƒ¨çš„éƒ½æ˜¯ç¦»æ•£çš„</strong>ã€‚</li></ul></li></ul><h4 id="åˆ†é¡µå’Œåˆ†æ®µå…±åŒç‚¹å’ŒåŒºåˆ«"><a href="#åˆ†é¡µå’Œåˆ†æ®µå…±åŒç‚¹å’ŒåŒºåˆ«" class="headerlink" title="åˆ†é¡µå’Œåˆ†æ®µå…±åŒç‚¹å’ŒåŒºåˆ«"></a>åˆ†é¡µå’Œåˆ†æ®µå…±åŒç‚¹å’ŒåŒºåˆ«</h4><ul><li><p>å…±åŒç‚¹</p><p>ï¼š</p><ol><li>åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶éƒ½æ˜¯ä¸ºäº†æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œè¾ƒå°‘å†…å­˜ç¢ç‰‡</li><li><strong>é¡µå’Œæ®µéƒ½æ˜¯ç¦»æ•£å­˜å‚¨çš„</strong>ï¼Œæ‰€ä»¥ä¸¤è€…éƒ½æ˜¯ç¦»æ•£åˆ†é…å†…å­˜çš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œ<strong>æ¯ä¸ªé¡µå’Œæ®µä¸­çš„å†…å­˜æ˜¯è¿ç»­çš„</strong></li></ol></li><li><p>åˆ†æ®µå’Œåˆ†é¡µçš„ä¸åŒ</p><p>ï¼š</p><ol><li><strong>ç›®çš„ä¸åŒ</strong>ï¼š<strong>åˆ†é¡µæ˜¯ç”±äºç³»ç»Ÿç®¡ç†çš„éœ€è¦</strong>è€Œä¸æ˜¯ç”¨æˆ·çš„éœ€è¦ï¼Œå®ƒæ˜¯ä¿¡æ¯çš„ç‰©ç†å•ä½ï¼›<strong>åˆ†æ®µçš„ç›®çš„æ˜¯ä¸ºäº†èƒ½æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·çš„éœ€è¦</strong>ï¼Œå®ƒæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œå®ƒå«æœ‰ä¸€ç»„å…¶æ„ä¹‰ç›¸å¯¹å®Œæ•´çš„ä¿¡æ¯ï¼›</li><li><strong>å¤§å°</strong>ä¸åŒï¼š<strong>é¡µçš„å¤§å°å›ºå®šä¸”ç”±ç³»ç»Ÿå†³å®š</strong>ï¼›è€Œ<strong>æ®µçš„é•¿åº¦å´ä¸å›ºå®šï¼Œç”±å…¶æ‰€å®Œæˆçš„åŠŸèƒ½å†³å®š</strong>ï¼›</li><li>åœ°å€ç©ºé—´ä¸åŒï¼š æ®µå‘ç”¨æˆ·æä¾›äºŒç»´åœ°å€ç©ºé—´ï¼›é¡µå‘ç”¨æˆ·æä¾›çš„æ˜¯ä¸€ç»´åœ°å€ç©ºé—´ï¼›</li><li>ä¿¡æ¯å…±äº«ï¼šæ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œä¾¿äºå­˜å‚¨ä¿æŠ¤å’Œä¿¡æ¯çš„å…±äº«ï¼Œé¡µçš„ä¿æŠ¤å’Œå…±äº«å—åˆ°é™åˆ¶ï¼›</li><li><strong>å†…å­˜ç¢ç‰‡</strong>ï¼šé¡µå¼å­˜å‚¨ç®¡ç†çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰å¤–ç¢ç‰‡ï¼ˆå› ä¸ºé¡µçš„å¤§å°å›ºå®šï¼‰ï¼Œä½†ä¼šäº§ç”Ÿå†…ç¢ç‰‡ï¼ˆä¸€ä¸ªé¡µå¯èƒ½å¡«å……ä¸æ»¡ï¼‰ï¼›è€Œæ®µå¼ç®¡ç†çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰å†…ç¢ç‰‡ï¼ˆå› ä¸ºæ®µå¤§å°å¯å˜ï¼Œæ”¹å˜æ®µå¤§å°æ¥æ¶ˆé™¤å†…ç¢ç‰‡ï¼‰ã€‚ä½†æ®µæ¢å…¥æ¢å‡ºæ—¶ï¼Œä¼šäº§ç”Ÿå¤–ç¢ç‰‡ï¼ˆæ¯”å¦‚4kçš„æ®µæ¢5kçš„æ®µï¼Œä¼šäº§ç”Ÿ1kçš„å¤–ç¢ç‰‡ï¼‰ã€‚</li></ol></li></ul><h4 id="åŸºæœ¬åˆ†é¡µå‚¨å­˜ç®¡ç†æ–¹å¼"><a href="#åŸºæœ¬åˆ†é¡µå‚¨å­˜ç®¡ç†æ–¹å¼" class="headerlink" title="åŸºæœ¬åˆ†é¡µå‚¨å­˜ç®¡ç†æ–¹å¼"></a>åŸºæœ¬åˆ†é¡µå‚¨å­˜ç®¡ç†æ–¹å¼</h4><ul><li>åœ¨åˆ†é¡µå†…å­˜ç®¡ç†ä¸­ï¼Œå¾ˆé‡è¦çš„ä¸¤ç‚¹æ˜¯ï¼š<strong>1. è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¦å¿«ã€å¿«è¡¨ã€‘ï¼›2. è§£å†³è™šæ‹Ÿåœ°å€ç©ºé—´å¤§ï¼Œé¡µè¡¨ä¹Ÿä¼šå¾ˆå¤§çš„é—®é¢˜ã€å¤šçº§åˆ†é¡µã€‘</strong></li><li>å› ä¸ºç¨‹åºæ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„é¡µé¢ä¸­ï¼Œè€Œé¡µé¢åˆç¦»æ•£çš„åˆ†å¸ƒåœ¨å†…å­˜ä¸­ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ª<strong>é¡µè¡¨æ¥è®°å½•é€»è¾‘åœ°å€å’Œå®é™…å­˜å‚¨åœ°å€ä¹‹é—´çš„æ˜ å°„å…³ç³»</strong>ï¼Œ<strong>ä»¥å®ç°ä»é¡µå·åˆ°ç‰©ç†å—å·çš„æ˜ å°„</strong></li><li>ç”±äºé¡µè¡¨ä¹Ÿæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤è®¿é—®åˆ†é¡µç³»ç»Ÿä¸­å†…å­˜æ•°æ®éœ€è¦ä¸¤æ¬¡çš„å†…å­˜è®¿é—®ã€ä¸€æ¬¡æ˜¯ä»å†…å­˜ä¸­è®¿é—®é¡µè¡¨ï¼Œä»ä¸­æ‰¾åˆ°æŒ‡å®šçš„ç‰©ç†å—å·ï¼ŒåŠ ä¸Šé¡µå†…åç§»å¾—åˆ°å®é™…ç‰©ç†åœ°å€ï¼›ç¬¬äºŒæ¬¡å°±æ˜¯æ ¹æ®ç¬¬ä¸€æ¬¡å¾—åˆ°çš„ç‰©ç†åœ°å€è®¿é—®å†…å­˜å–å‡ºæ•°æ®ã€‘</li><li><strong>ä¸ºäº†å‡å°‘ä¸¤æ¬¡è®¿é—®å†…å­˜å¯¼è‡´çš„æ•ˆç‡å½±å“ï¼Œåˆ†é¡µç®¡ç†ä¸­å¼•å…¥äº†å¿«è¡¨æœºåˆ¶</strong>ï¼Œå½“è¦è®¿é—®å†…å­˜æ•°æ®çš„æ—¶å€™ï¼Œé¦–å…ˆå°†é¡µå·åœ¨å¿«è¡¨ä¸­æŸ¥è¯¢ï¼Œå¦‚æœæŸ¥æ‰¾åˆ°è¯´æ˜è¦è®¿é—®çš„é¡µè¡¨é¡¹åœ¨å¿«è¡¨ä¸­ï¼Œé‚£ä¹ˆç›´æ¥ä»å¿«è¡¨ä¸­è¯»å–ç›¸åº”çš„ç‰©ç†å—å·ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆè®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œä»é¡µè¡¨ä¸­å¾—åˆ°ç‰©ç†åœ°å€ï¼ŒåŒæ—¶å°†é¡µè¡¨ä¸­çš„è¯¥æ˜ å°„è¡¨é¡¹æ·»åŠ åˆ°å¿«è¡¨ä¸­</li><li><strong>åœ¨æŸäº›è®¡ç®—æœºä¸­å¦‚æœå†…å­˜çš„é€»è¾‘åœ°å€å¾ˆå¤§ï¼Œå°†ä¼šå¯¼è‡´ç¨‹åºçš„é¡µè¡¨é¡¹ä¼šå¾ˆå¤šï¼Œè€Œé¡µè¡¨åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜æ”¾çš„ï¼Œæ‰€ä»¥ç›¸åº”çš„å°±éœ€è¦è¾ƒå¤§çš„è¿ç»­å†…å­˜ç©ºé—´</strong>ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨<strong>ä¸¤çº§é¡µè¡¨æˆ–è€…å¤šçº§é¡µè¡¨çš„æ–¹æ³•</strong></li><li>å…¶ä¸­å¤–å±‚é¡µè¡¨ä¸€æ¬¡æ€§è°ƒå…¥å†…å­˜ä¸”è¿ç»­å­˜æ”¾ï¼Œå†…å±‚é¡µè¡¨ç¦»æ•£å­˜æ”¾ã€‚ç›¸åº”çš„è®¿é—®å†…å­˜é¡µè¡¨çš„æ—¶å€™éœ€è¦ä¸€æ¬¡åœ°å€å˜æ¢ï¼Œè®¿é—®é€»è¾‘åœ°å€å¯¹åº”çš„ç‰©ç†åœ°å€çš„æ—¶å€™ä¹Ÿéœ€è¦ä¸€æ¬¡åœ°å€å˜æ¢ï¼Œè€Œä¸”ä¸€å…±éœ€è¦è®¿é—®å†…å­˜3æ¬¡æ‰å¯ä»¥è¯»å–ä¸€æ¬¡æ•°æ®</li></ul><h4 id="åŸºæœ¬åˆ†æ®µå‚¨å­˜ç®¡ç†æ–¹å¼"><a href="#åŸºæœ¬åˆ†æ®µå‚¨å­˜ç®¡ç†æ–¹å¼" class="headerlink" title="åŸºæœ¬åˆ†æ®µå‚¨å­˜ç®¡ç†æ–¹å¼"></a>åŸºæœ¬åˆ†æ®µå‚¨å­˜ç®¡ç†æ–¹å¼</h4><ul><li>åˆ†é¡µæ˜¯ä¸ºäº†æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œè€Œåˆ†æ®µæ˜¯ä¸ºäº†æ»¡è¶³ç¨‹åºå‘˜åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™çš„ä¸€äº›é€»è¾‘éœ€æ±‚ã€æ¯”å¦‚æ•°æ®å…±äº«ï¼Œæ•°æ®ä¿æŠ¤ï¼ŒåŠ¨æ€é“¾æ¥ç­‰ã€‘</li><li><strong>åˆ†æ®µå†…å­˜ç®¡ç†å½“ä¸­ï¼Œåœ°å€æ˜¯äºŒç»´çš„ï¼Œä¸€ç»´æ˜¯æ®µå·ï¼Œä¸€ç»´æ˜¯æ®µå†…åœ°å€</strong>ï¼›å…¶ä¸­æ¯ä¸ªæ®µçš„é•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œä¸”æ¯ä¸ªæ®µå†…éƒ¨éƒ½æ˜¯ä»0å¼€å§‹ç¼–å€çš„</li><li>ç”±äºåˆ†æ®µç®¡ç†ä¸­ï¼Œ<strong>æ¯ä¸ªæ®µå†…éƒ¨æ˜¯è¿ç»­å†…å­˜åˆ†é…ï¼Œä½†æ˜¯æ®µå’Œæ®µä¹‹é—´æ˜¯ç¦»æ•£åˆ†é…çš„</strong>ï¼Œå› æ­¤ä¹Ÿå­˜åœ¨ä¸€ä¸ªé€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»ï¼Œç›¸åº”çš„å°±æ˜¯<strong>æ®µè¡¨æœºåˆ¶</strong>ã€‚æ®µè¡¨ä¸­çš„æ¯ä¸€ä¸ªè¡¨é¡¹è®°å½•äº†è¯¥æ®µåœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€å’Œè¯¥æ®µçš„é•¿åº¦ã€‚æ®µè¡¨å¯ä»¥æ”¾åœ¨å†…å­˜ä¸­ä¹Ÿå¯ä»¥æ”¾åœ¨å¯„å­˜å™¨ä¸­ã€‚</li><li>è®¿é—®å†…å­˜çš„æ—¶å€™æ ¹æ®æ®µå·å’Œæ®µè¡¨é¡¹çš„é•¿åº¦è®¡ç®—å½“å‰è®¿é—®æ®µåœ¨æ®µè¡¨ä¸­çš„ä½ç½®ï¼Œç„¶åè®¿é—®æ®µè¡¨ï¼Œå¾—åˆ°è¯¥æ®µçš„ç‰©ç†åœ°å€ï¼Œæ ¹æ®è¯¥ç‰©ç†åœ°å€ä»¥åŠæ®µå†…åç§»é‡å°±å¯ä»¥å¾—åˆ°éœ€è¦è®¿é—®çš„å†…å­˜ã€‚ç”±äºä¹Ÿæ˜¯ä¸¤æ¬¡å†…å­˜è®¿é—®ï¼Œæ‰€ä»¥åˆ†æ®µç®¡ç†ä¸­åŒæ ·å¼•å…¥äº†<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E8%81%94%E6%83%B3">è”æƒ³</a>å¯„å­˜å™¨ã€‚</li></ul><h4 id="æ®µé¡µå¼å†…å­˜ç®¡ç†"><a href="#æ®µé¡µå¼å†…å­˜ç®¡ç†" class="headerlink" title="æ®µé¡µå¼å†…å­˜ç®¡ç†"></a>æ®µé¡µå¼å†…å­˜ç®¡ç†</h4><ul><li><p><strong>é¡µå¼å­˜å‚¨ç®¡ç†èƒ½æœ‰æ•ˆåœ°æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œè€Œåˆ†æ®µå­˜å‚¨ç®¡ç†èƒ½åæ˜ ç¨‹åºçš„é€»è¾‘ç»“æ„å¹¶æœ‰åˆ©äºæ®µçš„å…±äº«</strong></p></li><li><p>æ®µé¡µå¼ç®¡ç†å°±æ˜¯å°†ç¨‹åºåˆ†ä¸ºå¤šä¸ªé€»è¾‘æ®µï¼Œåœ¨æ¯ä¸ªæ®µé‡Œé¢åˆè¿›è¡Œåˆ†é¡µï¼Œå³å°†åˆ†æ®µå’Œåˆ†é¡µç»„åˆèµ·æ¥ä½¿ç”¨ã€‚</p></li><li><p>ä¸ºäº†å®ç°åœ°å€å˜æ¢ï¼Œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹å»ºç«‹ä¸€å¼ æ®µè¡¨ï¼Œè€Œæ¯ä¸ªåˆ†æ®µæœ‰ä¸€å¼ é¡µè¡¨ï¼ˆåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ®µè¡¨åªæœ‰ä¸€ä¸ªï¼Œè€Œé¡µè¡¨å¯èƒ½æœ‰å¤šä¸ªï¼‰</p></li><li><p>åœ¨è¿›è¡Œåœ°å€å˜æ¢æ—¶ï¼Œ<strong>é¦–å…ˆé€šè¿‡æ®µè¡¨æŸ¥åˆ°é¡µè¡¨èµ·å§‹åœ°å€ï¼Œç„¶åé€šè¿‡é¡µè¡¨æ‰¾åˆ°é¡µå¸§å·ï¼Œæœ€åå½¢æˆç‰©ç†åœ°å€</strong>ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œ<strong>è¿›è¡Œä¸€æ¬¡è®¿é—®å®é™…éœ€è¦è‡³å°‘ä¸‰æ¬¡è®¿é—®ä¸»å­˜</strong>ï¼Œè¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨å¿«è¡¨ä»¥åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦ï¼Œå…¶å…³é”®å­—ç”±æ®µå·ã€é¡µå·ç»„æˆï¼Œå€¼æ˜¯å¯¹åº”çš„é¡µå¸§å·å’Œä¿æŠ¤ç ã€‚</p></li><li><p>ä¸‰æ¬¡å†…å­˜è®¿é—®</p><p>ï¼š</p><ol><li>è®¿é—®å†…å­˜ä¸­çš„æ®µè¡¨æŸ¥åˆ°é¡µè¡¨çš„èµ·å§‹åœ°å€</li><li>è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨æ‰¾åˆ°é¡µå¸§å·ï¼Œå½¢æˆç‰©ç†åœ°å€</li><li>å¾—åˆ°ç‰©ç†åœ°å€åï¼Œå†ä¸€æ¬¡è®¿é—®å†…å­˜ï¼Œå­˜å–æŒ‡ä»¤æˆ–è€…æ•°æ®</li></ol></li></ul><h4 id="Qï¼šé¡µå¼å­˜å‚¨ï¼Œæ®µå¼å­˜å‚¨ï¼Œæ®µé¡µå¼å­˜å‚¨ï¼Œå¼•å…¥å¿«è¡¨ï¼Œè®¿é—®å†…å­˜æ¬¡æ•°"><a href="#Qï¼šé¡µå¼å­˜å‚¨ï¼Œæ®µå¼å­˜å‚¨ï¼Œæ®µé¡µå¼å­˜å‚¨ï¼Œå¼•å…¥å¿«è¡¨ï¼Œè®¿é—®å†…å­˜æ¬¡æ•°" class="headerlink" title="Qï¼šé¡µå¼å­˜å‚¨ï¼Œæ®µå¼å­˜å‚¨ï¼Œæ®µé¡µå¼å­˜å‚¨ï¼Œå¼•å…¥å¿«è¡¨ï¼Œè®¿é—®å†…å­˜æ¬¡æ•°"></a>Qï¼šé¡µå¼å­˜å‚¨ï¼Œæ®µå¼å­˜å‚¨ï¼Œæ®µé¡µå¼å­˜å‚¨ï¼Œå¼•å…¥å¿«è¡¨ï¼Œè®¿é—®å†…å­˜æ¬¡æ•°</h4><ul><li><p>é¡µå¼å­˜å‚¨ï¼ˆ2æ¬¡ï¼‰</p><ol><li>è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œåˆ©ç”¨é€»è¾‘åœ°å€ä¸­çš„é¡µå·æŸ¥æ‰¾åˆ°é¡µå¸§å·ï¼Œä¸é€»è¾‘åœ°å€ä¸­çš„é¡µå†…åç§»æ‹¼æ¥å½¢æˆç‰©ç†åœ°å€ï¼›</li><li>å¾—åˆ°ç‰©ç†åœ°å€åï¼Œå†ä¸€æ¬¡è®¿é—®å†…å­˜ï¼Œå­˜å–æŒ‡ä»¤æˆ–è€…æ•°æ®ã€‚</li></ol></li><li><p><strong>æ®µå¼å­˜å‚¨ï¼ˆ2æ¬¡ï¼‰</strong>ï¼šåŒé¡µå¼å­˜å‚¨</p></li><li><p>æ®µé¡µå¼å­˜å‚¨ï¼ˆ3æ¬¡ï¼‰</p><ol><li>è®¿é—®å†…å­˜ä¸­çš„æ®µè¡¨æŸ¥åˆ°é¡µè¡¨çš„èµ·å§‹åœ°å€</li><li>è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨æ‰¾åˆ°é¡µå¸§å·ï¼Œå½¢æˆç‰©ç†åœ°å€</li><li>å¾—åˆ°ç‰©ç†åœ°å€åï¼Œå†ä¸€æ¬¡è®¿é—®å†…å­˜ï¼Œå­˜å–æŒ‡ä»¤æˆ–è€…æ•°æ®</li></ol></li><li><p><strong>å¤šçº§é¡µè¡¨</strong>ï¼šè‹¥é¡µè¡¨åˆ’åˆ†ä¸ºNçº§ï¼Œåˆ™éœ€è¦è®¿é—®å†…å­˜N+1æ¬¡ã€‚è‹¥ç³»ç»Ÿæœ‰å¿«è¡¨ï¼Œåˆ™åœ¨å¿«è¡¨å‘½ä¸­æ—¶ï¼Œåªéœ€è®¿é—®1æ¬¡å†…å­˜å³å¯</p></li><li><p>å¼•å…¥å¿«è¡¨</p><p>ï¼š</p><ul><li>å› ä¸ºæŠŠé¡µè¡¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œè‡³å°‘éœ€è¦è®¿é—®ä¸¤æ¬¡å†…å­˜æ‰èƒ½å­˜å–ä¸€æ¡æŒ‡ä»¤æˆ–è€…æ•°æ®ï¼ˆä¸€æ¬¡å¾—åˆ°ç‰©ç†åœ°å€åœ°å€ï¼Œä¸€æ¬¡å­˜å–ï¼‰ï¼Œæ¯”è¾ƒæ…¢ï¼›å› æ­¤åœ¨åœ°å€å˜æ¢æœºæ„ä¸­å¢è®¾äº†ä¸€ä¸ªå…·æœ‰å¹¶è¡ŒæŸ¥æ‰¾èƒ½åŠ›çš„é«˜é€Ÿç¼“å†²å¯„å­˜å™¨â€”â€” å¿«è¡¨ï¼ˆå…¨å±€åªæœ‰ä¸€ä¸ªï¼Œä¸åœ¨å†…å­˜ä¸­ï¼ï¼ï¼ï¼‰ï¼Œç”¨æ¥å­˜æ”¾å½“å‰è®¿é—®çš„è‹¥å¹²é¡µè¡¨é¡¹ï¼ˆæ¯”è¾ƒå°ï¼Œåªèƒ½å­˜æ”¾éƒ¨åˆ†é¡µè¡¨é¡¹ï¼‰</li><li><strong>è‹¥å¿«è¡¨å‘½ä¸­</strong>ï¼Œåˆ™å¯ç›´æ¥å¾—åˆ°é¡µå¸§å·ï¼Œä¸é¡µå†…åç§»æ‹¼æ¥æˆç‰©ç†åœ°å€åè®¿é—®å†…å­˜ï¼Œè¿›è¡ŒæŒ‡ä»¤æˆ–è€…æ•°æ®çš„å­˜å–ã€‚ï¼ˆ<strong>åªéœ€è®¿é—®ä¸€æ¬¡å†…å­˜</strong>ï¼‰</li><li><strong>è‹¥å¿«è¡¨ä¸å‘½ä¸­</strong>ï¼Œåˆ™éœ€å»å†…å­˜ä¸­è®¿é—®é¡µè¡¨ï¼Œå½¢æˆç‰©ç†åœ°å€åï¼Œå†ä¸€æ¬¡è®¿é—®å†…å­˜è¿›è¡ŒæŒ‡ä»¤æˆ–è€…æ•°æ®çš„å­˜å–ã€‚ï¼ˆéœ€è¦è®¿é—®ä¸¤æ¬¡å†…å­˜ï¼‰</li></ul></li></ul><h3 id="ç‰©ç†å†…å­˜-amp-è™šæ‹Ÿå†…å­˜"><a href="#ç‰©ç†å†…å­˜-amp-è™šæ‹Ÿå†…å­˜" class="headerlink" title="ç‰©ç†å†…å­˜ &amp; è™šæ‹Ÿå†…å­˜"></a>ç‰©ç†å†…å­˜ &amp; è™šæ‹Ÿå†…å­˜</h3><ul><li><p><strong>æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œä»–æ‰€éœ€çš„å†…å­˜æ˜¯æœ‰å¯èƒ½å¤§äºå†…å­˜æ¡å®¹é‡ä¹‹å’Œ</strong>çš„ï¼Œæ¯”å¦‚ä½ çš„<strong>å†…å­˜æ¡æ˜¯256Mï¼Œä½ çš„ç¨‹åºå´è¦åˆ›å»ºä¸€ä¸ª2Gçš„æ•°æ®åŒº</strong>ï¼Œé‚£ä¹ˆä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½èƒ½ä¸€èµ·åŠ è½½åˆ°å†…å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰ä¸­ï¼ŒåŠ¿å¿…æœ‰ä¸€éƒ¨åˆ†æ•°æ®è¦æ”¾åˆ°å…¶ä»–ä»‹è´¨ä¸­ï¼ˆæ¯”å¦‚ç¡¬ç›˜ï¼‰ï¼Œå¾…è¿›ç¨‹éœ€è¦è®¿é—®é‚£éƒ¨åˆ†æ•°æ®æ—¶ï¼Œåœ¨é€šè¿‡è°ƒåº¦è¿›å…¥ç‰©ç†å†…å­˜ã€‚æ‰€ä»¥ï¼Œè™šæ‹Ÿå†…å­˜æ˜¯è¿›ç¨‹è¿è¡Œæ—¶æ‰€æœ‰å†…å­˜ç©ºé—´çš„æ€»å’Œï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€éƒ¨åˆ†ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè€Œç‰©ç†å†…å­˜å°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ‰€äº†è§£çš„å†…å­˜æ¡ã€‚æœ‰çš„åœ°æ–¹å‘¢ï¼Œä¹Ÿå«è¿™ä¸ªè™šæ‹Ÿå†…å­˜ä¸ºå†…å­˜äº¤æ¢åŒºã€‚</p></li><li><p><strong>è™šæ‹Ÿå†…å­˜çš„ä½œç”¨å°±æ˜¯ï¼Œå°†éœ€è¦å¤§å†…å­˜çš„åˆ†å—ï¼Œä¸€å—ä¸€å—çš„é€’ç»™ç‰©ç†å†…å­˜</strong>ã€‚æ¢è¨€ä¹‹ï¼Œ<strong>è™šæ‹Ÿå†…å­˜æ˜¯é€šè¿‡é¡µé¢è°ƒåº¦å®ç°çš„</strong></p></li><li><p>è™šæ‹Ÿå†…å­˜çš„ç›®çš„æ˜¯ä¸ºäº†</p><p>è®©ç‰©ç†å†…å­˜æ‰©å……æˆæ›´å¤§çš„é€»è¾‘å†…å­˜ï¼Œä»è€Œè®©ç¨‹åºè·å¾—æ›´å¤šçš„å¯ç”¨å†…å­˜</p><p>ã€‚</p><ul><li>ä¸ºäº†æ›´å¥½çš„ç®¡ç†å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿå°†å†…å­˜æŠ½è±¡æˆåœ°å€ç©ºé—´ã€‚æ¯ä¸ªç¨‹åºæ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œè¿™ä¸ªåœ°å€ç©ºé—´è¢«åˆ†å‰²æˆå¤šä¸ªå—ï¼Œæ¯ä¸€å—ç§°ä¸ºä¸€é¡µã€‚</li><li>è¿™äº›é¡µè¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œä½†ä¸éœ€è¦æ˜ å°„åˆ°è¿ç»­çš„ç‰©ç†å†…å­˜ï¼Œä¹Ÿä¸éœ€è¦æ‰€æœ‰é¡µéƒ½å¿…é¡»åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚</li><li>å½“ç¨‹åºå¼•ç”¨åˆ°ä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„é¡µæ—¶ï¼Œç”±ç¡¬ä»¶æ‰§è¡Œå¿…è¦çš„æ˜ å°„ï¼Œå°†ç¼ºå¤±çš„éƒ¨åˆ†è£…å…¥ç‰©ç†å†…å­˜å¹¶é‡æ–°æ‰§è¡Œå¤±è´¥çš„æŒ‡ä»¤ã€‚</li></ul></li></ul><h4 id="è¿›ç¨‹çš„å†…å­˜åˆ†é…-amp-å†…å­˜è®¿é—®"><a href="#è¿›ç¨‹çš„å†…å­˜åˆ†é…-amp-å†…å­˜è®¿é—®" class="headerlink" title="è¿›ç¨‹çš„å†…å­˜åˆ†é… &amp; å†…å­˜è®¿é—®"></a>è¿›ç¨‹çš„å†…å­˜åˆ†é… &amp; å†…å­˜è®¿é—®</h4><ul><li><strong>è¿›ç¨‹æ˜¯åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„</strong>ï¼Œæ¯ä¸ªè¿›ç¨‹è¿è¡Œæ—¶éƒ½ä¼šå¾—åˆ°4Gçš„è™šæ‹Ÿå†…å­˜ï¼Œå¾—åˆ°çš„è¿™4Gè™šæ‹Ÿå†…å­˜æ˜¯ä¸€ä¸ªè¿ç»­çš„åœ°å€ç©ºé—´ï¼ˆè¿™ä¹Ÿåªæ˜¯è¿›ç¨‹è®¤ä¸ºï¼‰ï¼Œè€Œå®é™…ä¸Šï¼Œå®ƒé€šå¸¸æ˜¯è¢«åˆ†éš”æˆå¤šä¸ªç‰©ç†å†…å­˜ç¢ç‰‡ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œæ•°æ®äº¤æ¢</li><li>è¿›ç¨‹å†…å­˜è®¿é—®<ol><li>æ¯æ¬¡è¦è®¿é—®åœ°å€ç©ºé—´ä¸Šçš„æŸä¸€ä¸ªåœ°å€ï¼Œéƒ½éœ€è¦<strong>æŠŠè™šæ‹Ÿåœ°å€ç¿»è¯‘ä¸ºå®é™…ç‰©ç†å†…å­˜åœ°å€</strong></li><li><strong>æ‰€æœ‰è¿›ç¨‹å…±äº«è¿™æ•´ä¸€å—ç‰©ç†å†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹åªæŠŠè‡ªå·±ç›®å‰éœ€è¦çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸Š</strong></li><li>è¿›ç¨‹éœ€è¦çŸ¥é“<strong>å“ªäº›åœ°å€ç©ºé—´ä¸Šçš„æ•°æ®åœ¨ç‰©ç†å†…å­˜ä¸Š</strong>ï¼Œå“ªäº›ä¸åœ¨ï¼ˆå¯èƒ½è¿™éƒ¨åˆ†å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼‰ï¼Œè¿˜æœ‰åœ¨ç‰©ç†å†…å­˜ä¸Šçš„å“ªé‡Œï¼Œè¿™å°±éœ€è¦é€šè¿‡<strong>é¡µè¡¨</strong>æ¥è®°å½•</li><li>é¡µè¡¨çš„æ¯ä¸€ä¸ªè¡¨é¡¹åˆ†ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†è®°å½•æ­¤é¡µæ˜¯å¦åœ¨ç‰©ç†å†…å­˜ä¸Šï¼ˆé¡µé¢å·ï¼‰ï¼Œç¬¬äºŒéƒ¨åˆ†è®°å½•ç‰©ç†å†…å­˜é¡µçš„åœ°å€ï¼ˆåç§»é‡ï¼‰</li><li><strong>å½“è¿›ç¨‹è®¿é—®æŸä¸ªè™šæ‹Ÿåœ°å€çš„æ—¶å€™ï¼Œå°±ä¼šå…ˆå»çœ‹é¡µè¡¨ï¼Œå¦‚æœå‘ç°å¯¹åº”çš„æ•°æ®ä¸åœ¨ç‰©ç†å†…å­˜ä¸Šï¼Œå°±ä¼šå‘ç”Ÿç¼ºé¡µå¼‚å¸¸</strong></li><li><strong>ç¼ºé¡µå¼‚å¸¸</strong>çš„å¤„ç†è¿‡ç¨‹ï¼Œ<strong>æ“ä½œç³»ç»Ÿç«‹å³é˜»å¡è¯¥è¿›ç¨‹ï¼Œå¹¶å°†ç¡¬ç›˜é‡Œå¯¹åº”çš„é¡µæ¢å…¥å†…å­˜</strong>ï¼Œç„¶åä½¿è¯¥è¿›ç¨‹å°±ç»ªï¼Œå¦‚æœå†…å­˜å·²ç»æ»¡äº†ï¼Œæ²¡æœ‰ç©ºåœ°æ–¹äº†ï¼Œé‚£å°±æ‰¾ä¸€ä¸ªé¡µè¦†ç›–ï¼Œè‡³äºå…·ä½“è¦†ç›–çš„å“ªä¸ªé¡µï¼Œå°±éœ€è¦çœ‹æ“ä½œç³»ç»Ÿé€‰æ‹©çš„<strong>é¡µé¢ç½®æ¢<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></strong></li></ol></li></ul><h4 id="è™šæ‹Ÿå†…å­˜ç½®æ¢ç®—æ³•"><a href="#è™šæ‹Ÿå†…å­˜ç½®æ¢ç®—æ³•" class="headerlink" title="è™šæ‹Ÿå†…å­˜ç½®æ¢ç®—æ³•"></a>è™šæ‹Ÿå†…å­˜ç½®æ¢<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></h4><ul><li><p>æœ€ä½³(Optimal)ç½®æ¢<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></p><p>ï¼š</p><ul><li>ä¸€ç§ç†è®º<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>ï¼Œæ— æ³•å®ç°ï¼Œç½®æ¢ç­–ç•¥æ˜¯å°†å½“å‰é¡µé¢ä¸­åœ¨æœªæ¥æœ€é•¿æ—¶é—´å†…ä¸ä¼šè¢«è®¿é—®çš„é¡µç½®æ¢å‡ºå»ã€‚</li></ul></li><li><p>å…ˆè¿›å…ˆå‡º(FIFO)é¡µé¢ç½®æ¢<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></p><p>ï¼š</p><ul><li>æ¯æ¬¡æ·˜æ±°æœ€æ—©è°ƒå…¥çš„é¡µé¢ã€‚</li></ul></li><li><p>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>LRU</p><p>ï¼š</p><ul><li><a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>èµ‹äºˆæ¯ä¸ªé¡µé¢ä¸€ä¸ªè®¿é—®å­—æ®µï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªé¡µé¢è‡ªä¸Šæ¬¡è¢«è®¿é—®ä»¥æ¥æ‰€ç»å†çš„æ—¶é—´tï¼Œå½“é¡»æ·˜æ±°ä¸€ä¸ªé¡µé¢æ—¶ï¼Œé€‰æ‹©ç°æœ‰é¡µé¢ä¸­å…¶tå€¼æœ€å¤§çš„ï¼Œå³æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚</li></ul></li><li><p>æ—¶é’Ÿ<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>clock</p><p>(ä¹Ÿè¢«ç§°ä¸ºæ˜¯</p><p>æœ€è¿‘æœªä½¿ç”¨<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>NRU</p><p>)ï¼š</p><ul><li>é¡µé¢è®¾ç½®ä¸€ä¸ªè®¿é—®ä½ï¼Œå¹¶å°†é¡µé¢é“¾æ¥ä¸ºä¸€ä¸ªç¯å½¢é˜Ÿåˆ—ï¼Œé¡µé¢è¢«è®¿é—®çš„æ—¶å€™è®¿é—®ä½è®¾ç½®ä¸º1ã€‚é¡µé¢ç½®æ¢çš„æ—¶å€™ï¼Œå¦‚æœå½“å‰æŒ‡é’ˆæ‰€æŒ‡é¡µé¢è®¿é—®ä¸ºä¸º0ï¼Œé‚£ä¹ˆç½®æ¢ï¼Œå¦åˆ™å°†å…¶ç½®ä¸º0ï¼Œå¾ªç¯ç›´åˆ°é‡åˆ°ä¸€ä¸ªè®¿é—®ä¸ºä½0çš„é¡µé¢ã€‚</li></ul></li><li><p>æ”¹è¿›å‹Clock<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></p><p>ï¼š</p><ul><li>åœ¨Clock<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªä¿®æ”¹ä½ï¼Œæ›¿æ¢æ—¶æ ¹æ®è®¿é—®ä½å’Œä¿®æ”¹ä½ç»¼åˆåˆ¤æ–­ã€‚ä¼˜å…ˆæ›¿æ¢è®¿é—®ä½å’Œä¿®æ”¹ä½éƒ½æ˜¯0çš„é¡µé¢ï¼Œå…¶æ¬¡æ˜¯è®¿é—®ä½ä¸º0ä¿®æ”¹ä½ä¸º1çš„é¡µé¢ã€‚</li></ul></li><li><p>æœ€å°‘ä½¿ç”¨<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>LFU</p><p>ï¼š</p><ul><li>è®¾ç½®å¯„å­˜å™¨è®°å½•é¡µé¢è¢«è®¿é—®æ¬¡æ•°ï¼Œæ¯æ¬¡ç½®æ¢çš„æ—¶å€™ç½®æ¢å½“å‰è®¿é—®æ¬¡æ•°æœ€å°‘çš„ã€‚</li></ul></li></ul><h3 id="ç”¨æˆ·æ€-amp-å†…æ ¸æ€"><a href="#ç”¨æˆ·æ€-amp-å†…æ ¸æ€" class="headerlink" title="ç”¨æˆ·æ€&amp;å†…æ ¸æ€"></a>ç”¨æˆ·æ€&amp;å†…æ ¸æ€</h3><ul><li><p>ç”¨æˆ·æ€ï¼šç”¨æˆ·æ€è¿è¡Œçš„è¿›ç¨‹å¯ä»¥ç›´æ¥è¯»å–ç”¨æˆ·ç¨‹åºçš„æ•°æ®</p></li><li><p>å†…æ ¸æ€ï¼šå†…æ ¸æ€è¿è¡Œçš„è¿›ç¨‹æˆ–ç¨‹åºå‡ ä¹å¯ä»¥è®¿é—®è®¡ç®—æœºçš„ä»»ä½•èµ„æºï¼Œä¸å—é™åˆ¶</p></li><li><p>ä¸¤è€…æœ€é‡è¦çš„å·®åˆ«å°±åœ¨äº<strong>ç‰¹æƒçº§çš„ä¸åŒ</strong>ï¼Œå³æƒåŠ›çš„ä¸åŒã€‚<strong>è¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºä¸èƒ½ç›´æ¥è®¿é—®æ“ä½œç³»ç»Ÿå†…æ ¸æ•°æ®ç»“æ„å’Œç¨‹åº</strong>ã€‚å½“æˆ‘ä»¬åœ¨ç³»ç»Ÿä¸­æ‰§è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œå¤§éƒ¨åˆ†æ—¶é—´æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ï¼Œåœ¨å…¶éœ€è¦æ“ä½œç³»ç»Ÿå¸®åŠ©å®ŒæˆæŸäº›å®ƒæ²¡æœ‰æƒåŠ›å’Œèƒ½åŠ›å®Œæˆçš„å·¥ä½œæ—¶å°±ä¼šåˆ‡æ¢åˆ°å†…æ ¸æ€</p></li><li><p>ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„3ç§æ–¹å¼</p><p>ï¼š</p><ol><li><strong>ç³»ç»Ÿè°ƒç”¨</strong>ï¼šè¿™æ˜¯ç”¨æˆ·æ€è¿›ç¨‹ä¸»åŠ¨è¦æ±‚åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸€ç§æ–¹å¼ï¼Œç”¨æˆ·æ€è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ç”³è¯·ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ç¨‹åºå®Œæˆå·¥ä½œã€‚è€Œç³»ç»Ÿè°ƒç”¨çš„æœºåˆ¶å…¶æ ¸å¿ƒè¿˜æ˜¯ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·ç‰¹åˆ«å¼€æ”¾çš„ä¸€ä¸ªä¸­æ–­æ¥å®ç°</li><li><strong>å¼‚å¸¸</strong>ï¼šå½“CPUåœ¨æ‰§è¡Œè¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºæ—¶ï¼Œå‘ç”Ÿäº†æŸäº›äº‹å…ˆä¸å¯çŸ¥çš„å¼‚å¸¸ï¼Œè¿™æ—¶ä¼šè§¦å‘ç”±å½“å‰è¿è¡Œè¿›ç¨‹åˆ‡æ¢åˆ°å¤„ç†æ­¤å¼‚å¸¸çš„å†…æ ¸ç›¸å…³ç¨‹åºä¸­ï¼Œä¹Ÿå°±è½¬åˆ°äº†å†…æ ¸æ€ï¼Œæ¯”å¦‚ç¼ºé¡µå¼‚å¸¸</li><li><strong>å¤–å›´è®¾å¤‡çš„ä¸­æ–­</strong>ï¼šå½“å¤–å›´è®¾å¤‡å®Œæˆç”¨æˆ·è¯·æ±‚çš„æ“ä½œåï¼Œä¼šå‘CPUå‘å‡ºç›¸åº”çš„ä¸­æ–­ä¿¡å·ï¼Œè¿™æ—¶CPUä¼šæš‚åœæ‰§è¡Œä¸‹ä¸€æ¡å³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤è½¬è€Œå»æ‰§è¡Œä¸ä¸­æ–­ä¿¡å·å¯¹åº”çš„å¤„ç†ç¨‹åºï¼Œå¦‚æœå…ˆå‰æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹è‡ªç„¶ä¹Ÿå°±å‘ç”Ÿäº†ç”±ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ã€‚ï¼ˆæ¯”å¦‚ç¡¬ç›˜è¯»å†™æ“ä½œå®Œæˆï¼Œç³»ç»Ÿä¼šåˆ‡æ¢åˆ°ç¡¬ç›˜è¯»å†™çš„ä¸­æ–­å¤„ç†ç¨‹åºä¸­æ‰§è¡Œåç»­æ“ä½œç­‰ã€‚ï¼‰</li></ol></li></ul><h3 id="ç³»ç»Ÿè°ƒåº¦"><a href="#ç³»ç»Ÿè°ƒåº¦" class="headerlink" title="ç³»ç»Ÿè°ƒåº¦"></a>ç³»ç»Ÿè°ƒåº¦</h3><ul><li><p>Qï¼šä»€ä¹ˆæ˜¯ç³»ç»Ÿè°ƒç”¨</p><p>ï¼Ÿ</p><ul><li>æˆ‘ä»¬è¿è¡Œçš„ç¨‹åºåŸºæœ¬éƒ½æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œå¦‚æœéœ€è¦è°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿæ€çº§åˆ«çš„å­åŠŸèƒ½ï¼Œå°±éœ€è¦ç³»ç»Ÿè°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æˆ‘ä»¬è¿è¡Œçš„ç”¨æˆ·ç¨‹åºä¸­ï¼Œå‡¡æ˜¯ä¸ç³»ç»Ÿæ€çº§åˆ«çš„èµ„æºæœ‰å…³çš„æ“ä½œï¼ˆå¦‚<strong>æ–‡ä»¶ç®¡ç†ã€è¿›ç¨‹æ§åˆ¶ã€å†…å­˜ç®¡ç†</strong>ç­‰)ï¼Œéƒ½å¿…é¡»<strong>é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ–¹å¼å‘æ“ä½œç³»ç»Ÿæå‡ºæœåŠ¡è¯·æ±‚ï¼Œå¹¶ç”±æ“ä½œç³»ç»Ÿä»£ä¸ºå®Œæˆ</strong></li></ul></li><li><p>å¸¸è§çš„ç³»ç»Ÿè°ƒç”¨ï¼š</p><ul><li>è®¾å¤‡ç®¡ç†ã€‚å®Œæˆè®¾å¤‡çš„è¯·æ±‚æˆ–é‡Šæ”¾ï¼Œä»¥åŠè®¾å¤‡å¯åŠ¨ç­‰åŠŸèƒ½</li><li>æ–‡ä»¶ç®¡ç†ã€‚å®Œæˆæ–‡ä»¶çš„è¯»ã€å†™ã€åˆ›å»ºåŠåˆ é™¤ç­‰åŠŸèƒ½</li><li>è¿›ç¨‹æ§åˆ¶ã€‚å®Œæˆè¿›ç¨‹çš„åˆ›å»ºã€æ’¤é”€ã€é˜»å¡åŠå”¤é†’ç­‰åŠŸèƒ½</li><li>è¿›ç¨‹é€šä¿¡ã€‚å®Œæˆè¿›ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’æˆ–ä¿¡å·ä¼ é€’ç­‰åŠŸèƒ½</li><li>å†…å­˜ç®¡ç†ã€‚å®Œæˆå†…å­˜çš„åˆ†é…ã€å›æ”¶ä»¥åŠè·å–ä½œä¸šå ç”¨å†…å­˜åŒºå¤§å°åŠåœ°å€ç­‰åŠŸèƒ½</li></ul></li></ul><h3 id="Qï¼šDebugæ—¶çœ‹åˆ°çš„æ˜¯ç‰©ç†å†…å­˜è¿˜æ˜¯è™šæ‹Ÿå†…å­˜-ï¼Ÿ"><a href="#Qï¼šDebugæ—¶çœ‹åˆ°çš„æ˜¯ç‰©ç†å†…å­˜è¿˜æ˜¯è™šæ‹Ÿå†…å­˜-ï¼Ÿ" class="headerlink" title="Qï¼šDebugæ—¶çœ‹åˆ°çš„æ˜¯ç‰©ç†å†…å­˜è¿˜æ˜¯è™šæ‹Ÿå†…å­˜ ï¼Ÿ"></a>Qï¼šDebugæ—¶çœ‹åˆ°çš„æ˜¯ç‰©ç†å†…å­˜è¿˜æ˜¯è™šæ‹Ÿå†…å­˜ ï¼Ÿ</h3><ul><li>è™šæ‹Ÿå†…å­˜ï¼Œé€šå¸¸ï¼Œ<strong>åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬ç”¨è°ƒè¯•å™¨çœ‹åˆ°çš„å†…å­˜åœ°å€éƒ½æ˜¯è™šæ‹Ÿå†…å­˜</strong>ã€‚</li></ul><h2 id="æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å®ç°é”çš„ï¼Ÿ"><a href="#æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å®ç°é”çš„ï¼Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å®ç°é”çš„ï¼Ÿ"></a>æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å®ç°é”çš„ï¼Ÿ</h2><ul><li><p>é¦–å…ˆè¦ææ¸…æ¥šä¸€ä¸ªæ¦‚å¿µï¼Œ<strong>åœ¨ç¡¬ä»¶å±‚é¢ï¼ŒCPUæä¾›äº†åŸå­æ“ä½œã€å…³ä¸­æ–­ã€é”å†…å­˜æ€»çº¿çš„æœºåˆ¶</strong>ï¼›<strong>OSåŸºäºè¿™å‡ ä¸ªCPUç¡¬ä»¶æœºåˆ¶ï¼Œå°±èƒ½å¤Ÿå®ç°é”</strong>ï¼›å†<strong>åŸºäºé”ï¼Œå°±èƒ½å¤Ÿå®ç°å„ç§å„æ ·çš„åŒæ­¥æœºåˆ¶</strong>ï¼ˆä¿¡å·é‡ã€æ¶ˆæ¯ã€Barrierç­‰ï¼‰</p></li><li><p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä¸ºäº†ä¿è¯æ•°æ®æ“ä½œçš„ä¸€è‡´æ€§ï¼Œæ“ä½œç³»ç»Ÿå¼•å…¥äº†é”æœºåˆ¶ï¼Œç”¨äºä¿è¯ä¸´ç•ŒåŒºä»£ç çš„å®‰å…¨ã€‚é€šè¿‡é”æœºåˆ¶ï¼Œèƒ½å¤Ÿä¿è¯åœ¨å¤šæ ¸å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œåœ¨æŸä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºä»£ç ï¼Œä»è€Œä¿è¯ä¸´ç•ŒåŒºä¸­æ“ä½œæ•°æ®çš„ä¸€è‡´æ€§ã€‚</p></li><li><p><strong>é”æœºåˆ¶çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯å®ƒçš„åŒæ­¥åŸè¯­éƒ½æ˜¯åŸå­æ“ä½œ</strong></p></li><li><p>é‚£ä¹ˆæ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•ä¿è¯è¿™äº›åŒæ­¥åŸè¯­çš„åŸå­æ€§å‘¢ï¼Ÿ</p><ul><li>æ“ä½œç³»ç»Ÿä¹‹æ‰€ä»¥èƒ½æ„å»ºé”ä¹‹ç±»çš„åŒæ­¥åŸè¯­ï¼Œæ˜¯å› ä¸ºç¡¬ä»¶å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›åŸå­æ“ä½œï¼Œä¾‹å¦‚ï¼š</li></ul><ol><li>ä¸­æ–­ç¦æ­¢å’Œå¯ç”¨ï¼ˆinterrupt enable/disableï¼‰</li><li>å†…å­˜åŠ è½½å’Œå­˜å…¥ï¼ˆload/storeï¼‰æµ‹è¯•ä¸è®¾ç½®ï¼ˆtest and setï¼‰æŒ‡ä»¤</li></ol></li><li><p>ç¦æ­¢ä¸­æ–­è¿™ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªç¡¬ä»¶æ­¥éª¤ï¼Œä¸­é—´æ— æ³•æ’å…¥åˆ«çš„æ“ä½œã€‚åŒæ ·ï¼Œä¸­æ–­å¯ç”¨ï¼Œæµ‹è¯•ä¸è®¾ç½®å‡ä¸ºä¸€ä¸ªç¡¬ä»¶æ­¥éª¤çš„æŒ‡ä»¤ã€‚åœ¨è¿™äº›ç¡¬ä»¶åŸå­æ“ä½œä¹‹ä¸Šï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æ„å»ºè½¯ä»¶åŸå­æ“ä½œï¼šé”ï¼Œç¡è§‰ä¸å«é†’ï¼Œä¿¡å·é‡ç­‰ã€‚</p></li></ul><h3 id="æ“ä½œç³»ç»Ÿä½¿ç”¨é”çš„åŸè¯­æ“ä½œ"><a href="#æ“ä½œç³»ç»Ÿä½¿ç”¨é”çš„åŸè¯­æ“ä½œ" class="headerlink" title="æ“ä½œç³»ç»Ÿä½¿ç”¨é”çš„åŸè¯­æ“ä½œ"></a>æ“ä½œç³»ç»Ÿä½¿ç”¨é”çš„åŸè¯­æ“ä½œ</h3><ul><li><p>å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–­ç¦æ­¢ï¼Œæµ‹è¯•ä¸è®¾ç½®</strong>ä¸¤ç§<strong>ç¡¬ä»¶åŸè¯­æ¥å®ç°è½¯ä»¶çš„é”åŸè¯­</strong>ã€‚è¿™ä¸¤ç§æ–¹å¼æ¯”è¾ƒèµ·æ¥ï¼Œæ˜¾ç„¶<strong>æµ‹è¯•ä¸è®¾ç½®</strong>æ›´åŠ ç®€å•ï¼Œä¹Ÿå› æ­¤ä½¿ç”¨çš„<strong>æ›´ä¸ºæ™®é</strong>ã€‚æ­¤å¤–ï¼Œ<strong>test and setè¿˜æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼Œå°±æ˜¯å¯ä»¥åœ¨å¤šCPUç¯å¢ƒä¸‹å·¥ä½œï¼Œè€Œä¸­æ–­å¯ç”¨å’Œç¦æ­¢åˆ™ä¸èƒ½</strong></p></li><li><p>ä½¿ç”¨ä¸­æ–­å¯ç”¨ä¸ç¦æ­¢æ¥å®ç°é”</p><p>ï¼š</p><ul><li>è¦é˜²æ­¢ä¸€æ®µä»£ç åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«åˆ«çš„è¿›ç¨‹æ’å…¥ï¼Œå°±è¦è€ƒè™‘åœ¨ä¸€ä¸ªå•å¤„ç†å™¨ä¸Šï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œé€”ä¸­è¢«åˆ‡æ¢çš„é€”å¾„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œè¦åˆ‡æ¢è¿›ç¨‹ï¼Œå¿…é¡»è¦å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢åªæœ‰ä¸¤ç§å¯èƒ½ï¼š</li></ul><ol><li><strong>ä¸€ä¸ªçº¿ç¨‹è‡ªæ„¿æ”¾å¼ƒCPUè€Œå°†æ§åˆ¶æƒäº¤ç»™æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨</strong>ï¼ˆ<strong>é€šè¿‡yieldä¹‹ç±»çš„æ“ä½œç³»ç»Ÿè°ƒç”¨æ¥å®ç°</strong>ï¼‰ï¼›</li><li><strong>ä¸€ä¸ªçº¿ç¨‹è¢«å¼ºåˆ¶æ”¾å¼ƒCPUè€Œå¤±å»æ§åˆ¶æƒï¼ˆé€šè¿‡ä¸­æ–­æ¥å®ç°ï¼‰</strong></li></ol><ul><li>åŸè¯­æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šè‡ªåŠ¨æ”¾å¼ƒCPUæ§åˆ¶æƒï¼Œå› æ­¤<strong>è¦é˜²æ­¢è¿›ç¨‹åˆ‡æ¢ï¼Œå°±è¦åœ¨åŸè¯­æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½å‘ç”Ÿä¸­æ–­ã€‚æ‰€ä»¥é‡‡ç”¨ç¦æ­¢ä¸­æ–­</strong>ï¼Œä¸”ä¸è‡ªåŠ¨è°ƒç”¨è®©å‡ºCPUçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå°±å¯ä»¥é˜²æ­¢è¿›ç¨‹åˆ‡æ¢ï¼Œå°†ä¸€ç»„æ“ä½œå˜ä¸ºåŸå­æ“ä½œã€‚</li><li>ä¸­æ–­ç¦æ­¢ï¼šå°±æ˜¯ç¦æ­¢æ‰“æ–­ï¼Œ<strong>ä½¿ç”¨å¯ä»¥å°†ä¸€ç³»åˆ—æ“ä½œå˜ä¸ºåŸå­æ“ä½œ</strong></li><li>ä¸­æ–­å¯ç”¨ï¼šå°±æ˜¯ä»è¿™é‡Œå¼€å§‹ï¼Œå¯ä»¥è¢«æ‰“æ–­ï¼Œå…è®¸æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦</li><li>ç¼ºç‚¹ï¼šä½¿ç”¨ä¸­æ–­å®ç°é”ï¼Œç¹å¿™ç­‰å¾…ï¼Œä¸å¯é‡å…¥</li></ul></li><li><p>ä½¿ç”¨æµ‹è¯•ä¸è®¾ç½®æŒ‡ä»¤æ¥å®ç°é”</p><ul><li>æµ‹è¯•ä¸è®¾ç½®ï¼ˆtest &amp; setï¼‰æŒ‡ä»¤ï¼šä»¥ä¸å¯åˆ†å‰²çš„æ–¹å¼æ‰§è¡Œå¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</li></ul><ol><li>è®¾ç½®æ“ä½œï¼šå°†1å†™å…¥æŒ‡å®šå†…å­˜å•å…ƒï¼›</li><li>è¯»å–æ“ä½œï¼šè¿”å›æŒ‡å®šå†…å­˜å•å…ƒé‡ŒåŸæ¥çš„å€¼ï¼ˆå†™å…¥1ä¹‹å‰çš„å€¼ï¼‰</li></ol><ul><li>ç¼ºç‚¹ï¼šç¹å¿™ç­‰å¾…ï¼Œä¸å¯é‡å…¥</li></ul></li></ul><h3 id="æ“ä½œç³»ç»Ÿä¸­çš„é”æœºåˆ¶"><a href="#æ“ä½œç³»ç»Ÿä¸­çš„é”æœºåˆ¶" class="headerlink" title="æ“ä½œç³»ç»Ÿä¸­çš„é”æœºåˆ¶"></a>æ“ä½œç³»ç»Ÿä¸­çš„é”æœºåˆ¶</h3><ul><li><p><strong>äº’æ–¥é”</strong>ï¼šmutexï¼Œç”¨äºä¿è¯åœ¨ä»»ä½•æ—¶åˆ»ï¼Œéƒ½åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥å¯¹è±¡ã€‚åªæœ‰å–å¾—äº’æ–¥é”çš„è¿›ç¨‹æ‰èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼Œæ— è®ºè¯»å†™ï¼Œå½“è·å–é”æ“ä½œå¤±è´¥æ—¶ï¼Œçº¿ç¨‹ä¼šè¿›å…¥ç¡çœ ï¼Œç­‰å¾…é”é‡Šæ”¾æ—¶è¢«å”¤é†’</p></li><li><p>è¯»å†™é”</p><p>ï¼šrwlockï¼Œåˆ†ä¸ºè¯»é”å’Œå†™é”ã€‚è¯»å†™é”è¦æ ¹æ®è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºçš„å…·ä½“è¡Œä¸ºï¼ˆè¯»ï¼Œå†™ï¼‰æ¥å†³å®šé”çš„å ç”¨æƒ…å†µã€‚è¿™æ ·é”çš„çŠ¶æ€å°±æœ‰ä¸‰ç§äº†ï¼šè¯»åŠ é”ã€å†™åŠ é”ã€æ— é”ã€‚</p><ol><li>æ— é”ã€‚è¯»/å†™è¿›ç¨‹éƒ½å¯ä»¥è¿›å…¥ï¼›</li><li>è¯»é”ã€‚è¯»è¿›ç¨‹å¯ä»¥è¿›å…¥ã€‚å†™è¿›ç¨‹ä¸å¯ä»¥è¿›å…¥ï¼›</li><li>å†™é”ã€‚è¯»/å†™è¿›ç¨‹éƒ½ä¸å¯ä»¥è¿›å…¥</li></ol></li><li><p>è‡ªæ—‹é”</p><p>ï¼šspinlockï¼Œè‡ªæ—‹é”æ˜¯æŒ‡åœ¨è¿›ç¨‹è¯•å›¾å–å¾—é”å¤±è´¥çš„æ—¶å€™é€‰æ‹©å¿™ç­‰å¾…è€Œä¸æ˜¯é˜»å¡è‡ªå·±ã€‚</p><ul><li>é€‰æ‹©å¿™ç­‰å¾…çš„ä¼˜ç‚¹åœ¨äºå¦‚æœè¯¥è¿›ç¨‹åœ¨å…¶è‡ªèº«çš„CPUæ—¶é—´ç‰‡å†…æ‹¿åˆ°é”ï¼ˆè¯´æ˜é”å ç”¨æ—¶é—´éƒ½æ¯”è¾ƒçŸ­ï¼‰ï¼Œåˆ™ç›¸æ¯”é˜»å¡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>æ³¨æ„è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªéšè—æ¡ä»¶ï¼š<strong>å¤šå¤„ç†å™¨</strong>ã€‚å› ä¸ºå•ä¸ªå¤„ç†å™¨çš„æƒ…å†µä¸‹ï¼Œç”±äºå½“å‰è‡ªæ—‹è¿›ç¨‹å ç”¨ç€CPUï¼ŒæŒæœ‰é”çš„è¿›ç¨‹åªæœ‰ç­‰å¾…è‡ªæ—‹è¿›ç¨‹è€—å°½CPUæ—¶é—´æ‰æœ‰æœºä¼šæ‰§è¡Œï¼Œè¿™æ ·CPUå°±ç©ºè½¬äº†</li></ul></li><li><p>RCU</p><p>ï¼šread-copy-updateï¼Œåœ¨ä¿®æ”¹æ•°æ®æ—¶ï¼Œé¦–å…ˆéœ€è¦è¯»å–æ•°æ®ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªå‰¯æœ¬ï¼Œå¯¹å‰¯æœ¬è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å®Œæˆåï¼Œå†å°†è€æ•°æ®updateæˆæ–°çš„æ•°æ®ã€‚ã€æœ‰ç‚¹åƒ copy-on-writeã€‘</p><ul><li>ä½¿ç”¨RCUæ—¶ï¼Œè¯»è€…å‡ ä¹ä¸éœ€è¦åŒæ­¥å¼€é”€ï¼Œæ—¢ä¸éœ€è¦è·å¾—é”ï¼Œä¹Ÿä¸ä½¿ç”¨åŸå­æŒ‡ä»¤ï¼Œä¸ä¼šå¯¼è‡´é”ç«äº‰ï¼Œå› æ­¤å°±<strong>ä¸ç”¨è€ƒè™‘æ­»é”é—®é¢˜</strong>äº†ã€‚</li><li>å¯¹äºå†™è€…çš„åŒæ­¥å¼€é”€è¾ƒå¤§ï¼Œå®ƒéœ€è¦å¤åˆ¶è¢«ä¿®æ”¹çš„æ•°æ®ï¼Œè¿˜å¿…é¡»ä½¿ç”¨é”æœºåˆ¶åŒæ­¥å¹¶è¡Œå…¶å®ƒå†™è€…çš„ä¿®æ”¹æ“ä½œã€‚</li><li>åœ¨æœ‰å¤§é‡è¯»æ“ä½œï¼Œå°‘é‡å†™æ“ä½œçš„æƒ…å†µä¸‹æ•ˆç‡éå¸¸é«˜ã€‚ã€è¯»å¤šå†™å°‘ã€‘</li></ul></li></ul><h2 id="ä¸­æ–­"><a href="#ä¸­æ–­" class="headerlink" title="ä¸­æ–­"></a>ä¸­æ–­</h2><ul><li>æ—©æœŸè®¡ç®—æœºå„ä¸ªç¨‹åºåªèƒ½ä¸²è¡Œæ‰§è¡Œã€ç³»ç»Ÿèµ„æºåˆ©ç”¨ä½ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæ“ä½œç³»ç»Ÿå¼•å…¥äº†ä¸­æ–­æœºåˆ¶ï¼Œå®ç°äº†<strong>å¤šé“ç¨‹åºçš„å¹¶å‘æ‰§è¡Œ</strong>ï¼Œæé«˜äº†ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ã€‚</li><li><strong>ä¸­æ–­æ˜¯å¤šç¨‹åºå¹¶å‘æ‰§è¡Œçš„å‰ææ¡ä»¶</strong></li></ul><ol><li>å½“ä¸€ä¸ªæ—¶é—´ç‰‡è¿è¡Œå®Œåï¼ŒCPUä¼šæ¥æ”¶åˆ°è®¡æ—¶éƒ¨ä»¶ï¼ˆæ“ä½œç³»ç»Ÿå†…æ ¸çš„æ—¶é’Ÿç®¡ç†éƒ¨ä»¶ï¼‰<strong>å‘å‡ºçš„ä¸­æ–­ä¿¡å·ï¼ŒCPUç«‹å³è¿›å…¥æ ¸å¿ƒæ€</strong>ï¼ŒæŠŠCPUçš„ä½¿ç”¨æƒé™äº¤è¿˜ç»™æ“ä½œç³»ç»Ÿ</li><li>å½“ä¸­æ–­å‘ç”Ÿåï¼Œå½“å‰è¿è¡Œçš„è¿›ç¨‹æš‚åœè¿è¡Œï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å¯¹ä¸­æ–­è¿›ç¨‹å¤„ç†ï¼Œåˆ‡æ¢è¿›ç¨‹ï¼ˆæ ¹æ®è¿›ç¨‹è°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>ï¼‰ï¼Œåœ¨å®Œæˆåˆ‡æ¢è¿›ç¨‹çš„ä¸€ç³»åˆ—å·¥ä½œåï¼Œæ“ä½œç³»ç»Ÿåˆä¼šå°†CPUçš„ä½¿ç”¨æƒäº¤è¿˜ç»™ç”¨æˆ·è¿›ç¨‹</li><li>åˆ‡æ¢åˆ°çš„è¿›ç¨‹2æ‹¿åˆ°CPUæ‰§è¡Œæƒå°±ä¼šåœ¨ç”¨æˆ·æ€ä¸‹æ‰§è¡Œ</li></ol><ul><li>ä¸­æ–­çš„<strong>æœ¬è´¨</strong>ï¼š<strong>å‘ç”Ÿä¸­æ–­å°±æ„å‘³ç€éœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥</strong>ï¼Œå¼€å±•ç®¡ç†å·¥ä½œ</li></ul><h3 id="ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹"><a href="#ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹" class="headerlink" title="ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹"></a>ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹</h3><ol><li>æ‰§è¡Œå®Œæ¯ä¸ªæŒ‡ä»¤åï¼ŒCPUéƒ½è¦æ£€æŸ¥å½“å‰æ˜¯å¦æœ‰å¤–éƒ¨ä¸­æ–­ä¿¡å·</li><li><strong>å¦‚æœæ£€æµ‹åˆ°å¤–éƒ¨ä¸­æ–­ä¿¡å·ï¼Œåˆ™éœ€è¦ä¿æŠ¤è¢«ä¸­æ–­è¿›ç¨‹çš„CPUç¯å¢ƒ</strong>ï¼ˆ<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E5%A6%82%E7%A8%8B">å¦‚ç¨‹</a>åºçŠ¶æ€å­—PSWã€<strong>ç¨‹åºè®¡æ•°å™¨ã€å„ç§é€šç”¨å¯„å­˜å™¨</strong>ï¼‰</li><li>æ ¹æ®ä¸­æ–­ä¿¡å·ç±»å‹è½¬å…¥ç›¸åº”çš„ä¸­æ–­å¤„ç†ç¨‹åº</li><li>æ¢å¤è¿›ç¨‹çš„CPUç¯å¢ƒå¹¶é€€å‡ºä¸­æ–­ï¼Œè¿”å›åŸè¿›ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</li></ol><h3 id="ä¸­æ–­çš„åˆ†ç±»"><a href="#ä¸­æ–­çš„åˆ†ç±»" class="headerlink" title="ä¸­æ–­çš„åˆ†ç±»"></a>ä¸­æ–­çš„åˆ†ç±»</h3><ul><li>ä¸­æ–­å¯ä»¥åˆ†ä¸ºï¼šå†…ä¸­æ–­å’Œå¤–ä¸­æ–­</li><li>å†…ä¸­æ–­ï¼šå†…ä¸­æ–­çš„ä¿¡å·æ¥æºäºCPUå†…éƒ¨ã€ä¸å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤æœ‰å…³ã€‚å¦‚æ•´æ•°é™¤0</li><li>å¤–ä¸­æ–­ï¼šå¤–ä¸­æ–­çš„ä¿¡å·æ¥æºäºCPUå¤–éƒ¨ã€ä¸å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤æ— å…³ã€‚å¦‚ç”¨æˆ·å¼ºåˆ¶ç»“æŸä¸€ä¸ªè¿›ç¨‹ã€IOè®¾å¤‡å®Œæˆæ“ä½œå‘ç”Ÿçš„ä¸­æ–­ä¿¡å·</li></ul><h3 id="ç¼ºé¡µä¸­æ–­"><a href="#ç¼ºé¡µä¸­æ–­" class="headerlink" title="ç¼ºé¡µä¸­æ–­"></a>ç¼ºé¡µä¸­æ–­</h3><ul><li>åœ¨è¯·æ±‚åˆ†é¡µç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢é¡µè¡¨ä¸­çš„çŠ¶æ€ä½æ¥ç¡®å®šæ‰€è¦è®¿é—®çš„é¡µé¢æ˜¯å¦å­˜åœ¨äºå†…å­˜ä¸­ã€‚æ¯å½“æ‰€è¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜æ˜¯ï¼Œä¼šäº§ç”Ÿä¸€æ¬¡ç¼ºé¡µä¸­æ–­ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šæ ¹æ®é¡µè¡¨ä¸­çš„å¤–å­˜åœ°å€åœ¨å¤–å­˜ä¸­æ‰¾åˆ°æ‰€ç¼ºçš„ä¸€é¡µï¼Œå°†å…¶è°ƒå…¥å†…å­˜ã€‚</li><li>ç¼ºé¡µæœ¬èº«æ˜¯ä¸€ç§ä¸­æ–­ï¼Œä¸ä¸€èˆ¬çš„ä¸­æ–­ä¸€æ ·ï¼Œéœ€è¦ç»è¿‡4ä¸ªå¤„ç†æ­¥éª¤ï¼š<ol><li>ä¿æŠ¤CPUç°åœº</li><li>åˆ†æä¸­æ–­åŸå› </li><li>è½¬å…¥ç¼ºé¡µä¸­æ–­å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†</li><li>æ¢å¤CPUç°åœºï¼Œç»§ç»­æ‰§è¡Œ</li></ol></li><li>ä½†æ˜¯ç¼ºé¡µä¸­æ–­æ˜¯ç”±äºæ‰€è¦è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨äºå†…å­˜æ—¶ï¼Œç”±ç¡¬ä»¶æ‰€äº§ç”Ÿçš„ä¸€ç§ç‰¹æ®Šçš„ä¸­æ–­ï¼Œå› æ­¤ï¼Œä¸ä¸€èˆ¬çš„ä¸­æ–­å­˜åœ¨åŒºåˆ«ï¼š<ul><li>åœ¨æŒ‡ä»¤æ‰§è¡ŒæœŸé—´äº§ç”Ÿå’Œå¤„ç†ç¼ºé¡µä¸­æ–­ä¿¡å·</li><li>ä¸€æ¡æŒ‡ä»¤åœ¨æ‰§è¡ŒæœŸé—´ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡ç¼ºé¡µä¸­æ–­</li><li>ç¼ºé¡µä¸­æ–­è¿”å›çš„æ˜¯ï¼Œæ‰§è¡Œäº§ç”Ÿä¸­æ–­çš„ä¸€æ¡æŒ‡ä»¤ï¼Œè€Œä¸€èˆ¬çš„ä¸­æ–­è¿”å›çš„æ˜¯ï¼Œæ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤</li></ul></li></ul><h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><h3 id="Qï¼šæ“ä½œç³»ç»Ÿä¸´ç•Œèµ„æºçš„è®¿é—®"><a href="#Qï¼šæ“ä½œç³»ç»Ÿä¸´ç•Œèµ„æºçš„è®¿é—®" class="headerlink" title="Qï¼šæ“ä½œç³»ç»Ÿä¸´ç•Œèµ„æºçš„è®¿é—®"></a>Qï¼šæ“ä½œç³»ç»Ÿä¸´ç•Œèµ„æºçš„è®¿é—®</h3><ul><li><strong>ä¸´ç•Œèµ„æº</strong>ï¼š<strong>ä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®çš„èµ„æºå°±ç§°ä¸ºä¸´ç•Œèµ„æºæˆ–ç‹¬å èµ„æº</strong></li><li><strong>ä¸´ç•ŒåŒº</strong>ï¼šå¯¹ä¸´ç•Œèµ„æºè¿›è¡Œè®¿é—®çš„é‚£æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºï¼Œé€šè¿‡å¯¹å¤šçº¿ç¨‹çš„ä¸²è¡ŒåŒ–æ¥è®¿é—®å…¬å…±èµ„æºæˆ–ä¸€æ®µä»£ç ï¼Œé€Ÿåº¦å¿«ï¼Œé€‚åˆæ§åˆ¶æ•°æ®è®¿é—®</li><li><strong>å¤šçº¿ç¨‹åŒæ­¥äº’æ–¥çš„å¸¸è§æ–¹æ³•</strong>ï¼š</li></ul><ol><li><p>**äº’æ–¥é‡(Mutex)**ï¼šé‡‡ç”¨äº’æ–¥å¯¹è±¡æœºåˆ¶ï¼Œåªæœ‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰æœ‰è®¿é—®å…¬å…±èµ„æºçš„æƒé™ã€‚å› ä¸ºäº’æ–¥å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯å…¬å…±èµ„æºä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚æ¯”å¦‚ <strong>Java ä¸­çš„ synchronized å…³é”®è¯å’Œå„ç§ Lock éƒ½æ˜¯è¿™ç§æœºåˆ¶ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªè®¡æ•°å™¨</strong></p></li><li><p>ä¿¡å·é‡PV(Semphares)</p><p>ï¼šå®ƒ</p><p>å…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹æ¥è®¿é—®åŒä¸€èµ„æº</p><p>ï¼Œä½†æ˜¯éœ€è¦æ§åˆ¶åŒä¸€æ—¶åˆ»è®¿é—®æ­¤èµ„æºçš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€ç”¨æ¥å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€‘</p><ul><li>ä¿¡å·é‡çš„æ•°æ®ç»“æ„ä¸ºä¸€ä¸ªå€¼å’Œä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘ç­‰å¾…è¯¥ä¿¡å·é‡çš„ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œä¿¡å·é‡çš„å€¼ä¸ç›¸åº”èµ„æºçš„ä½¿ç”¨æƒ…å†µæœ‰å…³ã€‚å½“å®ƒçš„å€¼å¤§äº0æ—¶ï¼Œè¡¨ç¤ºå½“å‰å¯ç”¨èµ„æºçš„æ•°é‡ï¼›å½“å®ƒçš„å€¼å°äº0æ—¶ï¼Œå…¶ç»å¯¹å€¼è¡¨ç¤ºç­‰å¾…ä½¿ç”¨è¯¥èµ„æºçš„è¿›ç¨‹ä¸ªæ•°ã€‚</li><li>æ³¨æ„ï¼Œ<strong>ä¿¡å·é‡çš„å€¼ä»…èƒ½ç”±PVæ“ä½œæ¥æ”¹å˜</strong></li><li>pæ“ä½œï¼ˆwaitï¼‰ï¼šç”³è¯·ä¸€ä¸ªå•ä½èµ„æºï¼Œè¿›ç¨‹è¿›å…¥ï¼›væ“ä½œï¼ˆsignalï¼‰ï¼šé‡Šæ”¾ä¸€ä¸ªå•ä½èµ„æºï¼Œè¿›ç¨‹å‡ºæ¥</li><li>PVæ“ä½œçš„å«ä¹‰ï¼š<strong>PVæ“ä½œç”±Pæ“ä½œåŸè¯­å’ŒVæ“ä½œåŸè¯­ç»„æˆï¼ˆåŸè¯­æ˜¯ä¸å¯ä¸­æ–­çš„è¿‡ç¨‹ï¼‰ï¼Œå¯¹ä¿¡å·é‡è¿›è¡Œæ“ä½œ</strong></li></ul></li><li><p><strong>äº‹ä»¶event</strong>ï¼šé€šè¿‡é€šçŸ¥æ“ä½œçš„æ–¹å¼æ¥ä¿æŒå¤šçº¿ç¨‹åŒæ­¥ï¼Œè¿˜å¯ä»¥æ–¹ä¾¿å®ç°å¤šçº¿ç¨‹ä¼˜å…ˆçº§çš„æ¯”è¾ƒæ“ä½œï¼ŒWait/Notify</p></li></ol><h3 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h3><ul><li><p><strong>synchronizedåŒæ­¥</strong>ï¼šæœ¬è´¨ä¸Šå°±æ˜¯ â€œå…±äº«å†…å­˜â€ å¼çš„é€šä¿¡ã€‚å¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ï¼Œè°æ‹¿åˆ°äº†é”ï¼ˆè·å¾—äº†è®¿é—®æƒé™ï¼‰ï¼Œè°å°±å¯ä»¥æ‰§è¡Œã€‚</p></li><li><p>whileè½®è¯¢çš„æ–¹å¼</p><p>ï¼š</p><ul><li>åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼ŒThreadA ä¸æ–­åœ°æ”¹å˜æ¡ä»¶ï¼ŒThreadB ä¸åœåœ°é€šè¿‡ while è¯­å¥æ£€æµ‹è¿™ä¸ªæ¡ä»¶æ¯”å¦‚è¯´äº’æ–¥é‡ä¸º0 æ˜¯å¦æˆç«‹ ï¼Œä»è€Œå®ç°äº†çº¿ç¨‹é—´çš„é€šä¿¡ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šæµªè´¹ CPU èµ„æºã€‚</li></ul></li><li><p>wait/notifyæœºåˆ¶</p><p>ï¼š</p><ul><li>å½“æ¡ä»¶æœªæ»¡è¶³æ—¶ï¼ŒThreadA è°ƒç”¨ wait() æ”¾å¼ƒ CPUï¼Œå¹¶è¿›å…¥é˜»å¡çŠ¶æ€ã€‚ï¼ˆä¸åƒ while è½®è¯¢é‚£æ ·å ç”¨ CPUï¼‰</li><li>å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼ŒThreadB è°ƒç”¨ notify() é€šçŸ¥çº¿ç¨‹ Aï¼Œæ‰€è°“é€šçŸ¥çº¿ç¨‹ Aï¼Œå°±æ˜¯å”¤é†’çº¿ç¨‹ Aï¼Œå¹¶è®©å®ƒè¿›å…¥å¯è¿è¡ŒçŠ¶æ€</li></ul></li><li><p><strong>ç®¡é“é€šä¿¡</strong>ï¼šjava.io.PipedInputStream å’Œ java.io.PipedOutputStreamè¿›è¡Œé€šä¿¡</p></li></ul><h2 id="è¿›ç¨‹-1"><a href="#è¿›ç¨‹-1" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><ul><li>è¿›ç¨‹æ§åˆ¶å— (Process Control Blockï¼ŒPCB) æè¿°è¿›ç¨‹çš„åŸºæœ¬ä¿¡æ¯å’Œè¿è¡ŒçŠ¶æ€ï¼Œæ‰€è°“çš„åˆ›å»ºè¿›ç¨‹å’Œæ’¤é”€è¿›ç¨‹ï¼Œéƒ½æ˜¯æŒ‡å¯¹ PCB çš„æ“ä½œã€‚</li></ul><h3 id="è¿›ç¨‹çŠ¶æ€"><a href="#è¿›ç¨‹çŠ¶æ€" class="headerlink" title="è¿›ç¨‹çŠ¶æ€"></a>è¿›ç¨‹çŠ¶æ€</h3><ul><li><p><strong>åˆ›å»ºçŠ¶æ€(new)</strong> ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºï¼Œå°šæœªåˆ°å°±ç»ªçŠ¶æ€</p></li><li><p>**å°±ç»ªçŠ¶æ€(ready)**ï¼šè¿›ç¨‹å·²å¤„äºå‡†å¤‡è¿è¡ŒçŠ¶æ€ï¼Œå³è¿›ç¨‹è·å¾—äº†é™¤äº†å¤„ç†å™¨ä¹‹å¤–çš„ä¸€åˆ‡æ‰€éœ€èµ„æºï¼Œä¸€æ—¦å¾—åˆ°å¤„ç†å™¨èµ„æº(å¤„ç†å™¨åˆ†é…çš„æ—¶é—´ç‰‡)å³å¯è¿è¡Œ</p></li><li><p><strong>è¿è¡ŒçŠ¶æ€(running)</strong> ï¼šè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šä¸Šè¿è¡Œï¼ˆå•æ ¸ CPU ä¸‹ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼‰</p></li><li><p><strong>é˜»å¡çŠ¶æ€(waiting)</strong> ï¼šåˆç§°ä¸ºç­‰å¾…çŠ¶æ€ï¼Œè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶è€Œæš‚åœè¿è¡Œå¦‚ç­‰å¾…æŸèµ„æºä¸ºå¯ç”¨æˆ–ç­‰å¾… IO æ“ä½œå®Œæˆã€‚å³ä½¿å¤„ç†å™¨ç©ºé—²ï¼Œè¯¥è¿›ç¨‹ä¹Ÿä¸èƒ½è¿è¡Œ</p></li><li><p><strong>ç»“æŸçŠ¶æ€(terminated)</strong> ï¼šè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±ã€‚å¯èƒ½æ˜¯è¿›ç¨‹æ­£å¸¸ç»“æŸæˆ–å…¶ä»–åŸå› ä¸­æ–­é€€å‡ºè¿è¡Œ</p></li><li><p><strong>åªæœ‰å°±ç»ªæ€å’Œè¿è¡Œæ€å¯ä»¥ç›¸äº’è½¬æ¢ï¼Œå…¶å®ƒçš„éƒ½æ˜¯å•å‘è½¬æ¢</strong>ã€‚<strong>å°±ç»ªçŠ¶æ€</strong>çš„è¿›ç¨‹é€šè¿‡<strong>è°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a><strong>ä»è€Œ</strong>è·å¾— CPU æ—¶é—´ï¼Œè½¬ä¸ºè¿è¡ŒçŠ¶æ€</strong>ï¼›è€Œ<strong>è¿è¡ŒçŠ¶æ€</strong>çš„è¿›ç¨‹ï¼Œ<strong>åœ¨åˆ†é…ç»™å®ƒçš„ CPU æ—¶é—´ç‰‡ç”¨å®Œä¹‹åå°±ä¼šè½¬ä¸ºå°±ç»ªçŠ¶æ€</strong>ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒåº¦ã€‚</p></li><li><p><strong>é˜»å¡çŠ¶æ€æ˜¯ç¼ºå°‘éœ€è¦çš„èµ„æºä»è€Œç”±è¿è¡ŒçŠ¶æ€è½¬æ¢è€Œæ¥</strong>ï¼Œ<strong>ä½†æ˜¯è¯¥èµ„æºä¸åŒ…æ‹¬ CPU æ—¶é—´ï¼Œç¼ºå°‘ CPU æ—¶é—´ä¼šä»è¿è¡Œæ€è½¬æ¢ä¸ºå°±ç»ªæ€</strong></p></li><li><p>æŒ‚èµ·</p><p>ï¼ˆæ¢åˆ°å¤–å­˜ï¼‰:</p><ul><li>æŒ‚èµ·å°±ç»ªï¼šæ˜¯æŒ‡è¿›ç¨‹è¢«å¯¹æ¢åˆ°è¾…å­˜æ—¶çš„å°±ç»ªçŠ¶æ€ï¼Œæ˜¯ä¸èƒ½è¢«ç›´æ¥è°ƒåº¦çš„çŠ¶æ€ï¼Œåªæœ‰å½“ä¸»å­˜ä¸­æ²¡æœ‰æ´»è·ƒå°±ç»ªæ€è¿›ç¨‹ï¼Œæˆ–è€…æ˜¯æŒ‚èµ·å°±ç»ªæ€è¿›ç¨‹å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œç³»ç»Ÿå°†æŠŠæŒ‚èµ·å°±ç»ªæ€è¿›ç¨‹è°ƒå›ä¸»å­˜å¹¶è½¬æ¢ä¸ºæ´»è·ƒå°±ç»ªã€‚</li></ul></li></ul><h3 id="è¿›ç¨‹åŒæ­¥"><a href="#è¿›ç¨‹åŒæ­¥" class="headerlink" title="è¿›ç¨‹åŒæ­¥"></a>è¿›ç¨‹åŒæ­¥</h3><ol><li><p>ä¸´ç•ŒåŒºï¼šå¯¹ä¸´ç•Œèµ„æºè¿›è¡Œè®¿é—®çš„é‚£æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºã€‚</p></li><li><p>åŒæ­¥ä¸äº’æ–¥ï¼š</p><ul><li>åŒæ­¥ï¼šå¤šä¸ªè¿›ç¨‹å› ä¸ºåˆä½œäº§ç”Ÿçš„ç›´æ¥åˆ¶çº¦å…³ç³»ï¼Œä½¿å¾—è¿›ç¨‹æœ‰ä¸€å®šçš„å…ˆåæ‰§è¡Œå…³ç³»ã€‚</li><li>äº’æ–¥ï¼šå¤šä¸ªè¿›ç¨‹åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½è¿›å…¥ä¸´ç•ŒåŒºã€‚</li></ul></li><li><p>ä¿¡å·é‡</p><p>ï¼šä¿¡å·é‡ï¼ˆSemaphoreï¼‰æ˜¯ä¸€ä¸ªæ•´å‹å˜é‡ï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œ down å’Œ up æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¸¸è§çš„ P å’Œ V æ“ä½œã€‚</p><ul><li>down : å¦‚æœä¿¡å·é‡å¤§äº 0 ï¼Œæ‰§è¡Œ -1 æ“ä½œï¼›å¦‚æœä¿¡å·é‡ç­‰äº 0ï¼Œè¿›ç¨‹ç¡çœ ï¼Œç­‰å¾…ä¿¡å·é‡å¤§äº 0ï¼›</li><li>up ï¼šå¯¹ä¿¡å·é‡æ‰§è¡Œ +1 æ“ä½œï¼Œå”¤é†’ç¡çœ çš„è¿›ç¨‹è®©å…¶å®Œæˆ down æ“ä½œ</li><li>down å’Œ up æ“ä½œéœ€è¦è¢«è®¾è®¡æˆåŸè¯­ï¼Œä¸å¯åˆ†å‰²ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™<strong>å±è”½ä¸­æ–­</strong></li><li>å¦‚æœä¿¡å·é‡çš„å–å€¼åªèƒ½ä¸º 0 æˆ–è€… 1ï¼Œé‚£ä¹ˆå°±æˆä¸ºäº† <strong>äº’æ–¥é‡</strong>ï¼ˆMutexï¼‰ ï¼Œ0 è¡¨ç¤ºä¸´ç•ŒåŒºå·²ç»åŠ é”ï¼Œ1 è¡¨ç¤ºä¸´ç•ŒåŒºè§£é”ã€‚</li></ul></li><li><p>ç®¡ç¨‹</p><p>ï¼šç®¡ç¨‹åœ¨åŠŸèƒ½ä¸Šå’Œä¿¡å·é‡åŠPVæ“ä½œç±»ä¼¼ï¼Œå±äºä¸€ç§è¿›ç¨‹åŒæ­¥äº’æ–¥å·¥å…·ï¼Œä½†æ˜¯å…·æœ‰ä¸ä¿¡å·é‡åŠPVæ“ä½œä¸åŒçš„å±æ€§ã€‚</p><p>ç®¡ç¨‹æŠŠæ§åˆ¶çš„ä»£ç ç‹¬ç«‹å‡ºæ¥ï¼Œå°è£…äº†åŒæ­¥æ“ä½œï¼Œå¯¹è¿›ç¨‹éšè”½äº†åŒæ­¥ç»†èŠ‚</p><p>ï¼Œç®€åŒ–äº†åŒæ­¥åŠŸèƒ½çš„è°ƒç”¨ç•Œé¢ã€‚ç”¨æˆ·ç¼–å†™å¹¶å‘ç¨‹åºå¦‚åŒç¼–å†™é¡ºåº(ä¸²è¡Œ)ç¨‹åºã€‚</p><ul><li>ç®¡ç¨‹æœ‰ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼šåœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ç®¡ç¨‹ã€‚è¿›ç¨‹åœ¨æ— æ³•ç»§ç»­æ‰§è¡Œçš„æ—¶å€™ä¸èƒ½ä¸€ç›´å ç”¨ç®¡ç¨‹ï¼Œå¦åˆ™å…¶å®ƒè¿›ç¨‹æ°¸è¿œä¸èƒ½ä½¿ç”¨ç®¡ç¨‹ã€‚</li><li>ç®¡ç¨‹å¼•å…¥äº†<strong>æ¡ä»¶å˜é‡</strong>ä»¥åŠç›¸å…³çš„æ“ä½œï¼š<strong>wait() å’Œ signal() æ¥å®ç°åŒæ­¥æ“ä½œ</strong>ã€‚å¯¹æ¡ä»¶å˜é‡æ‰§è¡Œ wait() æ“ä½œä¼šå¯¼è‡´è°ƒç”¨è¿›ç¨‹é˜»å¡ï¼ŒæŠŠç®¡ç¨‹è®©å‡ºæ¥ç»™å¦ä¸€ä¸ªè¿›ç¨‹æŒæœ‰ã€‚signal() æ“ä½œç”¨äºå”¤é†’è¢«é˜»å¡çš„è¿›ç¨‹ã€‚</li></ul></li></ol><h4 id="è¿›ç¨‹åŒæ­¥å’Œè¿›ç¨‹é€šä¿¡çš„åŒºåˆ«"><a href="#è¿›ç¨‹åŒæ­¥å’Œè¿›ç¨‹é€šä¿¡çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹åŒæ­¥å’Œè¿›ç¨‹é€šä¿¡çš„åŒºåˆ«"></a>è¿›ç¨‹åŒæ­¥å’Œè¿›ç¨‹é€šä¿¡çš„åŒºåˆ«</h4><ul><li>è¿›ç¨‹åŒæ­¥ï¼šæ§åˆ¶å¤šä¸ªè¿›ç¨‹æŒ‰ä¸€å®šé¡ºåºæ‰§è¡Œ</li><li>è¿›ç¨‹é€šä¿¡ï¼šè¿›ç¨‹é—´ä¼ è¾“ä¿¡æ¯</li><li>è¿›ç¨‹é€šä¿¡æ˜¯ä¸€ç§æ‰‹æ®µï¼Œè€Œè¿›ç¨‹åŒæ­¥æ˜¯ä¸€ç§ç›®çš„ã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œä¸ºäº†èƒ½å¤Ÿè¾¾åˆ°è¿›ç¨‹åŒæ­¥çš„ç›®çš„ï¼Œéœ€è¦è®©è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œä¼ è¾“ä¸€äº›è¿›ç¨‹åŒæ­¥æ‰€éœ€è¦çš„ä¿¡æ¯</li></ul><h3 id="Qï¼šå¸¸è§çš„è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼ï¼ˆIPCï¼ŒInter-Process-Communicationï¼‰ï¼Ÿ"><a href="#Qï¼šå¸¸è§çš„è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼ï¼ˆIPCï¼ŒInter-Process-Communicationï¼‰ï¼Ÿ" class="headerlink" title="Qï¼šå¸¸è§çš„è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼ï¼ˆIPCï¼ŒInter-Process Communicationï¼‰ï¼Ÿ"></a>Qï¼šå¸¸è§çš„è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼ï¼ˆIPCï¼ŒInter-Process Communicationï¼‰ï¼Ÿ</h3><ul><li><p>ç®¡é“</p><p>ï¼š</p><p>ç®¡é“å¯ç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„çˆ¶å­è¿›ç¨‹é—´çš„é€šä¿¡</p><p>ã€‚linux ç³»ç»Ÿæ“ä½œæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå°†ä¸€ä¸ªç¨‹åºçš„è¾“å‡ºäº¤ç»™å¦ä¸€ä¸ªç¨‹åºè¿›è¡Œå¤„ç†ã€‚ä¸€ä¸ªè¿›ç¨‹å¾€ç®¡é“è¾“å…¥æ•°æ®ï¼Œåˆ™ä¼šé˜»å¡ç­‰å¾…åˆ«çš„è¿›ç¨‹ä»ç®¡é“è¯»å–æ•°æ®ã€‚ç®¡é“æ˜¯é€šè¿‡è°ƒç”¨ pipe å‡½æ•°åˆ›å»ºçš„ï¼Œfd[0] ç”¨äºè¯»ï¼Œfd[1] ç”¨äºå†™ã€‚</p><ul><li>å®ƒå…·æœ‰ä»¥ä¸‹é™åˆ¶ï¼š1. <strong>åªæ”¯æŒåŠåŒå·¥é€šä¿¡ï¼ˆå•å‘äº¤æ›¿ä¼ è¾“ï¼‰</strong>ï¼›2. <strong>åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹æˆ–è€…å…„å¼Ÿè¿›ç¨‹ä¸­ä½¿ç”¨</strong></li></ul></li><li><p><strong>å‘½åç®¡é“ï¼ˆFIFOï¼‰</strong>ï¼šå…‹æœäº†ç®¡é“æ²¡æœ‰åå­—çš„é™åˆ¶ï¼Œ<strong>å…·æœ‰ç®¡é“æ‰€å…·æœ‰çš„åŠŸèƒ½å¤–ï¼Œè¿˜å…è®¸æ— äº²ç¼˜å…³ç³»è¿›ç¨‹é—´çš„é€šä¿¡</strong>ï¼Œå»é™¤äº†ç®¡é“åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä½¿ç”¨çš„é™åˆ¶</p></li><li><p><strong>ä¿¡å·ï¼ˆsingalï¼‰</strong>ï¼š<strong>ä¿¡å·æ˜¯åœ¨è½¯ä»¶å±‚æ¬¡ä¸Šå¯¹ä¸­æ–­æœºåˆ¶çš„ä¸€ç§æ¨¡æ‹Ÿ</strong>ï¼Œä¸€ç§æ¯”è¾ƒå¤æ‚çš„é€šä¿¡æ–¹å¼ï¼Œç”¨äºé€šçŸ¥æ¥æ”¶è¿›ç¨‹æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿã€‚ä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°ä¸€ä¸ªä¿¡å·ä¸å¤„ç†å™¨æ”¶åˆ°ä¸€ä¸ªä¸­æ–­è¯·æ±‚æ•ˆæœä¸Šå¯ä»¥è¯´æ˜¯ä¸€è‡´çš„ã€‚</p></li><li><p>æ¶ˆæ¯é˜Ÿåˆ—</p><p>ï¼šæ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†ä»ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªæ•°æ®å—çš„æ–¹æ³•ã€‚</p><ul><li><strong>ç›¸æ¯”äºå‘½åç®¡é“çš„ä¼˜ç‚¹</strong>ï¼š<strong>æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ç‹¬ç«‹äºè¯»å†™è¿›ç¨‹å­˜åœ¨</strong>ï¼Œä»è€Œé¿å…äº† FIFO ä¸­åŒæ­¥ç®¡é“çš„æ‰“å¼€å’Œå…³é—­æ—¶å¯èƒ½äº§ç”Ÿçš„å›°éš¾ï¼›<strong>é¿å…äº† FIFO çš„åŒæ­¥é˜»å¡é—®é¢˜</strong>ï¼Œä¸éœ€è¦è¿›ç¨‹è‡ªå·±æä¾›åŒæ­¥æ–¹æ³•ï¼›è¯»è¿›ç¨‹å¯ä»¥<strong>æ ¹æ®æ¶ˆæ¯ç±»å‹æœ‰é€‰æ‹©åœ°æ¥æ”¶æ¶ˆæ¯</strong>ï¼Œè€Œä¸åƒ FIFO é‚£æ ·åªèƒ½é»˜è®¤åœ°æ¥æ”¶ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œå¯èƒ½ä¼šæ”¶åˆ°æ•°æ®å—æœ€å¤§é•¿åº¦çš„é™åˆ¶çº¦æŸç­‰ã€‚å¦‚æœé¢‘ç¹çš„å‘ç”Ÿè¿›ç¨‹é—´çš„é€šä¿¡è¡Œä¸ºï¼Œé‚£ä¹ˆè¿›ç¨‹éœ€è¦é¢‘ç¹åœ°è¯»å–é˜Ÿåˆ—ä¸­çš„æ•°æ®åˆ°å†…å­˜ï¼Œç›¸å½“äºé—´æ¥åœ°ä»ä¸€ä¸ªè¿›ç¨‹æ‹·è´åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™éœ€è¦èŠ±è´¹æ—¶é—´</li></ul></li><li><p>å…±äº«å†…å­˜</p><p>ï¼šå…±äº«å†…å­˜å¯ä»¥å¾ˆå¥½è§£å†³æ‹·è´æ¶ˆè€—çš„æ—¶é—´ã€‚</p><ul><li><strong>å…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªç»™å®šçš„å­˜å‚¨åŒºï¼Œä¸åŒè¿›ç¨‹å¯ä»¥åŠæ—¶çœ‹åˆ°å¯¹æ–¹è¿›ç¨‹ä¸­å¯¹å…±äº«å†…å­˜ä¸­æ•°æ®å˜æ›´</strong>ã€‚å› ä¸ºæ•°æ®ä¸éœ€è¦åœ¨è¿›ç¨‹ä¹‹é—´å¤åˆ¶ï¼Œæ‰€ä»¥è¿™æ˜¯<strong>æœ€å¿«çš„ä¸€ç§ IPC</strong></li><li>å…±äº«å†…å­˜éœ€è¦ä¾é æŸç§åŒæ­¥æ“ä½œï¼Œå¦‚äº’æ–¥é”å’Œä¿¡å·é‡ç­‰ï¼Œ<strong>éœ€è¦ä½¿ç”¨ä¿¡å·é‡ç”¨æ¥åŒæ­¥å¯¹å…±äº«å­˜å‚¨çš„è®¿é—®</strong>ã€‚</li><li>ç³»ç»ŸåŠ è½½ä¸€ä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œåˆ†é…ç»™è¿›ç¨‹çš„å†…å­˜å¹¶ä¸æ˜¯å®é™…ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯è™šæ‹Ÿå†…å­˜ç©ºé—´ã€‚å¯ä»¥è®©<strong>ä¸¤ä¸ªè¿›ç¨‹å„è‡ªæ‹¿å‡ºä¸€å—è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç„¶åæ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†å†…å­˜ä¸­</strong>ï¼Œè¿™æ ·ï¼Œä¸¤ä¸ªè¿›ç¨‹è™½ç„¶æœ‰ç€ç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œä½†æœ‰ä¸€éƒ¨åˆ†å´æ˜¯æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†å†…å­˜ï¼Œè¿™å°±å®Œæˆäº†å†…å­˜å…±äº«æœºåˆ¶äº†</li></ul></li><li><p>ä¿¡å·é‡ï¼ˆmutexï¼‰</p><p>ï¼šä¸ºäº†é¿å…å…±äº«å†…å­˜å¤šè¿›ç¨‹ç«äº‰å†…å­˜çš„é—®é¢˜ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ï¼Œä½¿ç”¨ä¿¡å·é‡ã€‚</p><ul><li>ä¿¡å·é‡çš„<strong>æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè®¡æ•°å™¨</strong>ï¼Œç”¨æ¥<strong>å®ç°è¿›ç¨‹ä¹‹é—´çš„äº’æ–¥ä¸åŒæ­¥</strong>ï¼Œ<strong>ç”¨äºä¸ºå¤šä¸ªè¿›ç¨‹æä¾›å¯¹å…±äº«æ•°æ®å¯¹è±¡çš„è®¿é—®</strong>ï¼Œä¿¡å·é‡ä¹Ÿæ˜¯è¿›ç¨‹ä¹‹é—´çš„ä¸€ç§é€šä¿¡æ–¹å¼ã€‚</li></ul></li><li><p><strong>Socket</strong>ï¼šSocketå¥—æ¥å­—è¿›è¡Œé€šä¿¡ï¼Œä¸å…¶ä»–æœºåˆ¶ä¸åŒçš„æ˜¯ï¼Œå®ƒ<strong>å¯ç”¨äºä¸åŒæœºå™¨ä¹‹é—´çš„è¿›ç¨‹é—´é€šä¿¡</strong>ï¼Œåº”ç”¨éå¸¸å¹¿æ³›ã€‚</p></li></ul><h3 id="è¿›ç¨‹çš„è°ƒåº¦"><a href="#è¿›ç¨‹çš„è°ƒåº¦" class="headerlink" title="è¿›ç¨‹çš„è°ƒåº¦"></a>è¿›ç¨‹çš„è°ƒåº¦</h3><p>ä¸€. <strong>æ‰¹å¤„ç†ç³»ç»Ÿ</strong></p><ul><li><p>æ‰¹å¤„ç†ç³»ç»Ÿæ²¡æœ‰å¤ªå¤šçš„ç”¨æˆ·æ“ä½œï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œ<strong>è°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>ç›®æ ‡æ˜¯ä¿è¯ååé‡å’Œå‘¨è½¬æ—¶é—´</strong>ï¼ˆä»æäº¤åˆ°ç»ˆæ­¢çš„æ—¶é—´ï¼‰</p></li><li><p>å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></p><p>ï¼ˆFCFSï¼‰ï¼š</p><ul><li>æ¯æ¬¡è°ƒåº¦æ˜¯<strong>ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„è¿›ç¨‹</strong>ï¼Œä¸ºä¹‹åˆ†é…å¤„ç†æœºï¼Œä½¿ä¹‹æŠ•å…¥è¿è¡Œã€‚è¯¥è¿›ç¨‹ä¸€ç›´è¿è¡Œåˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œé˜»å¡åæ‰æ”¾å¼ƒå¤„ç†æœºã€‚</li><li>æ¯”è¾ƒæœ‰åˆ©äºé•¿ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰ï¼Œè€Œä¸åˆ©äºçŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰</li><li><strong>æœ‰åˆ©äºCPUç¹å¿™å‹ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰ ï¼Œè€Œä¸åˆ©äºI/Oç¹å¿™å‹ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰</strong></li><li>ç”¨äºæ‰¹å¤„ç†ç³»ç»Ÿï¼Œä¸é€‚äºåˆ†æ—¶ç³»ç»Ÿ</li></ul></li><li><p>çŸ­è¿›ç¨‹ä¼˜å…ˆè°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></p><p>ï¼š</p><ul><li><strong>ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹</strong>ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™å®ƒï¼Œä½¿å®ƒç«‹å³æ‰§è¡Œå¹¶ä¸€ç›´æ‰§è¡Œåˆ°å®Œæˆï¼Œæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œè¢«é˜»å¡æ”¾å¼ƒå¤„ç†æœºæ—¶å†é‡æ–°è°ƒåº¦ã€‚</li><li>å¯¹é•¿ä½œä¸šä¸åˆ©ï¼Œæœªè€ƒè™‘ä½œä¸š(è¿›ç¨‹)çš„ç´§è¿«ç¨‹åº¦ï¼Œå› è€Œä¸èƒ½ä¿è¯ç´§è¿«æ€§ä½œä¸š(è¿›ç¨‹)ä¼šè¢«åŠæ—¶å¤„ç†</li></ul></li><li><p>æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ</p><p>shortest remaining time nextï¼ˆSRTNï¼‰</p><ul><li>æœ€çŸ­ä½œä¸šä¼˜å…ˆçš„æŠ¢å å¼ç‰ˆæœ¬ï¼ŒæŒ‰å‰©ä½™è¿è¡Œæ—¶é—´çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚ å½“ä¸€ä¸ªæ–°çš„ä½œä¸šåˆ°è¾¾æ—¶ï¼Œå…¶æ•´ä¸ªè¿è¡Œæ—¶é—´ä¸å½“å‰è¿›ç¨‹çš„å‰©ä½™æ—¶é—´ä½œæ¯”è¾ƒã€‚å¦‚æœæ–°çš„è¿›ç¨‹éœ€è¦çš„æ—¶é—´æ›´å°‘ï¼Œåˆ™æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œè¿è¡Œæ–°çš„è¿›ç¨‹ã€‚å¦åˆ™æ–°çš„è¿›ç¨‹ç­‰å¾…ã€‚</li></ul></li></ul><p>äºŒ. <strong>äº¤äº’å¼ç³»ç»Ÿ</strong></p><ul><li><p>äº¤äº’å¼ç³»ç»Ÿæœ‰å¤§é‡çš„ç”¨æˆ·äº¤äº’æ“ä½œï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­è°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>çš„ç›®æ ‡æ˜¯å¿«é€Ÿåœ°è¿›è¡Œå“åº”</p></li><li><p>æ—¶é—´ç‰‡è½®è½¬æ³•</p><p>ï¼š</p><ul><li>ç³»ç»Ÿå°†æ‰€æœ‰çš„å°±ç»ªè¿›ç¨‹æŒ‰å…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯æ¬¡è°ƒåº¦æ—¶ï¼Œ<strong>æŠŠCPUåˆ†é…ç»™é˜Ÿé¦–è¿›ç¨‹ï¼Œå¹¶ä»¤å…¶æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡</strong>ã€‚å½“æ‰§è¡Œçš„æ—¶é—´ç‰‡ç”¨å®Œæ—¶ï¼Œç”±ä¸€ä¸ªè®¡æ—¶å™¨å‘å‡ºæ—¶é’Ÿä¸­æ–­è¯·æ±‚ï¼Œè°ƒåº¦ç¨‹åºä¾¿æ®æ­¤ä¿¡å·æ¥åœæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œå¹¶å°†å®ƒ<strong>é€å¾€å°±ç»ªé˜Ÿåˆ—çš„æœ«å°¾</strong>ï¼›ç„¶åï¼Œå†æŠŠå¤„ç†æœºåˆ†é…ç»™<strong>å°±ç»ªé˜Ÿåˆ—ä¸­æ–°çš„é˜Ÿé¦–è¿›ç¨‹ï¼ŒåŒæ—¶ä¹Ÿè®©å®ƒæ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡</strong>ã€‚</li><li>ç´§è¿«ä»»åŠ¡å“åº”æ…¢ã€‚</li></ul></li><li><p>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></p><p>ï¼š</p><ol><li><strong>è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—</strong>ï¼Œå¹¶ä¸ºå„ä¸ªé˜Ÿåˆ—èµ‹äºˆä¸åŒçš„<strong>ä¼˜å…ˆçº§</strong>ï¼›è¯¥<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>èµ‹äºˆ<strong>å„ä¸ªé˜Ÿåˆ—ä¸­è¿›ç¨‹æ‰§è¡Œæ—¶é—´ç‰‡</strong>çš„å¤§å°ä¹Ÿå„ä¸ç›¸åŒï¼Œåœ¨<strong>ä¼˜å…ˆæƒæ„ˆé«˜</strong>çš„é˜Ÿåˆ—ä¸­ï¼Œä¸º<strong>æ¯ä¸ªè¿›ç¨‹æ‰€è§„å®šçš„æ‰§è¡Œæ—¶é—´ç‰‡å°±æ„ˆå°</strong>ã€‚</li><li>å½“ä¸€ä¸ªæ–°è¿›ç¨‹è¿›å…¥å†…å­˜åï¼Œé¦–å…ˆå°†å®ƒæ”¾å…¥<strong>ç¬¬ä¸€é˜Ÿåˆ—çš„æœ«å°¾</strong>ï¼Œ<strong>æŒ‰FCFSåŸåˆ™æ’é˜Ÿç­‰å¾…è°ƒåº¦</strong>ï¼›å½“è½®åˆ°è¯¥è¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦‚å®ƒèƒ½åœ¨è¯¥æ—¶é—´ç‰‡å†…å®Œæˆï¼Œä¾¿å¯å‡†å¤‡æ’¤ç¦»ç³»ç»Ÿï¼›<strong>å¦‚æœå®ƒåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ç»“æŸæ—¶å°šæœªå®Œæˆï¼Œè°ƒåº¦ç¨‹åºä¾¿å°†è¯¥è¿›ç¨‹è½¬å…¥ç¬¬äºŒé˜Ÿåˆ—çš„æœ«å°¾</strong>ï¼Œ<strong>å†åŒæ ·åœ°æŒ‰FCFSåŸåˆ™ç­‰å¾…è°ƒåº¦æ‰§è¡Œ</strong>ï¼›</li><li><strong>ä»…å½“ç¬¬ä¸€é˜Ÿåˆ—ç©ºé—²æ—¶ï¼Œè°ƒåº¦ç¨‹åºæ‰è°ƒåº¦ç¬¬äºŒé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œ</strong></li></ol></li><li><p>ä¼˜å…ˆæƒè°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a></p><p>ï¼š</p><p>æŠŠå¤„ç†æœºåˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—ä¸­ä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹</p><ul><li>**éæŠ¢å å¼ä¼˜å…ˆæƒ<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>**ï¼šç³»ç»Ÿä¸€æ—¦æŠŠå¤„ç†æœºåˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—ä¸­ä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹åï¼Œè¯¥è¿›ç¨‹ä¾¿ä¸€ç›´æ‰§è¡Œä¸‹å»ï¼Œç›´è‡³å®Œæˆï¼›</li><li><strong>æŠ¢å å¼ä¼˜å…ˆæƒè°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a><strong>ï¼šç³»ç»ŸæŠŠå¤„ç†æœºåˆ†é…ç»™ä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹ï¼Œä½¿ä¹‹æ‰§è¡Œã€‚ä½†</strong>åœ¨å…¶æ‰§è¡ŒæœŸé—´</strong>ï¼Œ<strong>åªè¦å‡ºç°äº†å¦ä¸€ä¸ªå…¶ä¼˜å…ˆæƒæ›´é«˜çš„è¿›ç¨‹</strong>ï¼Œ<strong>è¿›ç¨‹è°ƒåº¦ç¨‹åºå°±ç«‹å³åœæ­¢å½“å‰è¿›ç¨‹</strong>(åŸä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹)çš„æ‰§è¡Œï¼Œ<strong>é‡æ–°å°†å¤„ç†æœºåˆ†é…ç»™æ–°åˆ°çš„ä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹</strong>ã€‚</li><li>è¿™ç§æŠ¢å å¼çš„ä¼˜å…ˆæƒè°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>èƒ½æ›´å¥½åœ°æ»¡è¶³ç´§è¿«ä½œä¸šçš„è¦æ±‚ï¼Œæ•…è€Œå¸¸ç”¨äºè¦æ±‚æ¯”è¾ƒä¸¥æ ¼çš„å®æ—¶ç³»ç»Ÿä¸­ï¼Œä»¥åŠå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„æ‰¹å¤„ç†å’Œåˆ†æ—¶ç³»ç»Ÿä¸­</li></ul></li></ul><p>ä¸‰. <strong>å®æ—¶ç³»ç»Ÿ</strong></p><ul><li>å®æ—¶ç³»ç»Ÿè¦æ±‚ä¸€ä¸ªè¯·æ±‚åœ¨ä¸€ä¸ªç¡®å®šæ—¶é—´å†…å¾—åˆ°å“åº”ã€‚åˆ†ä¸ºç¡¬å®æ—¶å’Œè½¯å®æ—¶ï¼Œå‰è€…å¿…é¡»æ»¡è¶³ç»å¯¹çš„æˆªæ­¢æ—¶é—´ï¼Œåè€…å¯ä»¥å®¹å¿ä¸€å®šçš„è¶…æ—¶ã€‚</li></ul><h4 id="Qï¼šæœ‰5ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡æƒé‡15524ï¼Œæ‰§è¡Œæ—¶é—´15534ï¼Œå¦‚ä½•ç”¨æœ€çŸ­çš„æ—¶é—´æ‰§è¡Œå®Œï¼Ÿ"><a href="#Qï¼šæœ‰5ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡æƒé‡15524ï¼Œæ‰§è¡Œæ—¶é—´15534ï¼Œå¦‚ä½•ç”¨æœ€çŸ­çš„æ—¶é—´æ‰§è¡Œå®Œï¼Ÿ" class="headerlink" title="Qï¼šæœ‰5ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡æƒé‡15524ï¼Œæ‰§è¡Œæ—¶é—´15534ï¼Œå¦‚ä½•ç”¨æœ€çŸ­çš„æ—¶é—´æ‰§è¡Œå®Œï¼Ÿ"></a>Qï¼šæœ‰5ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡æƒé‡15524ï¼Œæ‰§è¡Œæ—¶é—´15534ï¼Œå¦‚ä½•ç”¨æœ€çŸ­çš„æ—¶é—´æ‰§è¡Œå®Œï¼Ÿ</h4><ul><li><strong>WARNINGï¼šè¿™æ˜¯æˆ‘é¢è¯•ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œä»¥ä¸‹ä¸ºæˆ‘ä¸ªäººæ€è€ƒçš„ç­”æ¡ˆï¼Œä»…ä¾›å‚è€ƒ</strong></li><li>å¯ä»¥é‡‡ç”¨**å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>**ï¼Œå¯ä»¥çœ‹æˆæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦å’Œä¼˜å…ˆçº§è°ƒåº¦çš„ç»“åˆ</li><li>æœ€ä¸Šé¢çš„é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼Œé¦–å…ˆè°ƒåº¦ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ã€‚è‹¥é«˜ä¼˜å…ˆçº§ä¸­é˜Ÿåˆ—ä¸­å·²æ²¡æœ‰è°ƒåº¦çš„è¿›ç¨‹ï¼Œåˆ™è°ƒåº¦æ¬¡ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹</li><li><strong>å¦‚æœå®ƒåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ç»“æŸæ—¶å°šæœªå®Œæˆï¼Œè°ƒåº¦ç¨‹åºä¾¿å°†è¯¥è¿›ç¨‹è½¬å…¥ç¬¬äºŒé˜Ÿåˆ—çš„æœ«å°¾</strong>ï¼Œè‹¥ç¬¬äºŒé˜Ÿåˆ—çš„æ—¶é—´ç‰‡ç”¨å®Œåä½œä¸šè¿˜ä¸èƒ½å®Œæˆï¼Œä¸€ç›´è¿›å…¥ä¸‹ä¸€çº§é˜Ÿåˆ—ï¼Œç›´è‡³å®Œæˆ</li><li>åœ¨ä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œåˆæœ‰æ–°åˆ°è¾¾çš„ä½œä¸šï¼Œé‚£ä¹ˆåœ¨è¿è¡Œå®Œè¿™ä¸ªæ—¶é—´ç‰‡åï¼ŒCPUé©¬ä¸Šåˆ†é…ç»™æ–°åˆ°è¾¾çš„ä½œä¸šå³æŠ¢å å¼è°ƒåº¦CPU</li></ul><h2 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h2><ul><li>æ‹¥æœ‰èµ„æºï¼šè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œä½†æ˜¯çº¿ç¨‹ä¸æ‹¥æœ‰èµ„æºï¼Œçº¿ç¨‹å¯ä»¥è®¿é—®éš¶å±è¿›ç¨‹çš„èµ„æº</li><li>è°ƒåº¦ï¼šçº¿ç¨‹æ˜¯ç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œåœ¨åŒä¸€è¿›ç¨‹ä¸­ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ï¼Œä»ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ—¶ï¼Œä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ã€ä¸€ä¸ªè¿›ç¨‹æœ‰å¤šä¸ªçº¿ç¨‹ã€‘</li><li>ç³»ç»Ÿå¼€é”€ï¼šç”±äºåˆ›å»ºæˆ–æ’¤é”€è¿›ç¨‹æ—¶ï¼Œç³»ç»Ÿéƒ½è¦ä¸ºä¹‹åˆ†é…æˆ–å›æ”¶èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ï¼ŒI/O è®¾å¤‡ç­‰ï¼Œæ‰€ä»˜å‡ºçš„å¼€é”€è¿œå¤§äºåˆ›å»ºæˆ–æ’¤é”€çº¿ç¨‹æ—¶çš„å¼€é”€ï¼›ç±»ä¼¼åœ°ï¼Œåœ¨è¿›è¡Œè¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ¶‰åŠå½“å‰æ‰§è¡Œè¿›ç¨‹ CPU ç¯å¢ƒçš„ä¿å­˜åŠæ–°è°ƒåº¦è¿›ç¨‹ CPU ç¯å¢ƒçš„è®¾ç½®ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢æ—¶åªéœ€ä¿å­˜å’Œè®¾ç½®å°‘é‡å¯„å­˜å™¨å†…å®¹ï¼Œå¼€é”€å¾ˆå°ã€‚</li><li>é€šä¿¡ï¼šçº¿ç¨‹é—´å¯ä»¥é€šè¿‡ç›´æ¥è¯»å†™åŒä¸€è¿›ç¨‹ä¸­çš„æ•°æ®è¿›è¡Œé€šä¿¡ã€çº¿ç¨‹å…±äº«è¿›ç¨‹å†…å­˜ç©ºé—´ã€‘ï¼Œä½†æ˜¯è¿›ç¨‹é€šä¿¡éœ€è¦å€ŸåŠ© IPC</li></ul><h2 id="å¤šè¿›ç¨‹-amp-å¤šçº¿ç¨‹"><a href="#å¤šè¿›ç¨‹-amp-å¤šçº¿ç¨‹" class="headerlink" title="å¤šè¿›ç¨‹ &amp; å¤šçº¿ç¨‹"></a>å¤šè¿›ç¨‹ &amp; å¤šçº¿ç¨‹</h2><ul><li><p>è¿›ç¨‹</p><p>ï¼š</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š1. é¡ºåºç¨‹åºçš„ç‰¹ç‚¹ï¼šå…·æœ‰å°é—­æ€§å’Œå¯å†ç°æ€§ï¼›2.<strong>ç¨‹åºçš„å¹¶å‘æ‰§è¡Œå’Œèµ„æºå…±äº«</strong>ã€‚å¤šé“ç¨‹åºè®¾è®¡å‡ºç°åï¼Œå®ç°äº†ç¨‹åºçš„å¹¶å‘æ‰§è¡Œå’Œèµ„æºå…±äº«ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡å’Œç³»ç»Ÿçš„èµ„æºåˆ©ç”¨ç‡ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š1. <strong>æ“ä½œç³»ç»Ÿè°ƒåº¦åˆ‡æ¢å¤šä¸ªçº¿ç¨‹è¦æ¯”åˆ‡æ¢è°ƒåº¦è¿›ç¨‹åœ¨é€Ÿåº¦ä¸Šå¿«çš„å¤š</strong>ã€‚è€Œä¸”<strong>è¿›ç¨‹é—´å†…å­˜æ— æ³•å…±äº«</strong>ï¼Œé€šè®¯ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼›2. çº¿ç¨‹ä¹‹é—´ç”±äºå…±äº«è¿›ç¨‹å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥äº¤æ¢æ•°æ®éå¸¸æ–¹ä¾¿ï¼›åœ¨åˆ›å»ºæˆ–æ’¤æ¶ˆè¿›ç¨‹æ—¶ï¼Œç”±äºç³»ç»Ÿéƒ½è¦ä¸ºä¹‹åˆ†é…å’Œå›æ”¶èµ„æºï¼Œå¯¼è‡´ç³»ç»Ÿçš„å¼€é”€æ˜æ˜¾å¤§äºåˆ›å»ºæˆ–æ’¤æ¶ˆçº¿ç¨‹æ—¶çš„å¼€é”€ã€‚</li></ul></li><li><p>çº¿ç¨‹</p><p>ï¼š</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š</li></ul><ol><li>å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ‰€èŠ±è´¹çš„ç©ºé—´è¿œè¿œå°äºå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ‰€èŠ±è´¹çš„ç©ºé—´ï¼Œè€Œä¸”ï¼Œçº¿ç¨‹é—´å½¼æ­¤åˆ‡æ¢æ‰€éœ€çš„æ—¶é—´ä¹Ÿè¿œè¿œå°äºè¿›ç¨‹é—´åˆ‡æ¢æ‰€éœ€è¦çš„æ—¶é—´ï¼ˆå› ä¸ºåœ¨Linuxç³»ç»Ÿä¸‹ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹å¿…é¡»åˆ†é…ç»™å®ƒç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå»ºç«‹ä¼—å¤šçš„æ•°æ®è¡¨æ¥ç»´æŠ¤å®ƒçš„ä»£ç æ®µã€å †æ ˆæ®µå’Œæ•°æ®æ®µã€‚<strong>çº¿ç¨‹ä¹‹é—´å´å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åœ°å€ç©ºé—´ï¼Œå…±äº«å¤§éƒ¨åˆ†æ•°æ®</strong>ï¼‰ï¼›</li><li><strong>çº¿ç¨‹é—´æ–¹ä¾¿çš„é€šä¿¡æœºåˆ¶</strong>ï¼Œç”±äºåŒä¸€è¿›ç¨‹ä¸‹çš„çº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®ç©ºé—´ï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®å¯ä»¥ç›´æ¥ä¸ºå…¶å®ƒçº¿ç¨‹æ‰€ç”¨ï¼Œè¿™ä¸ä»…å¿«æ·ï¼Œè€Œä¸”æ–¹ä¾¿ï¼›</li><li>ä½¿å¤šCPUç³»ç»Ÿæ›´åŠ æœ‰æ•ˆã€‚æ“ä½œç³»ç»Ÿä¼šä¿è¯å½“çº¿ç¨‹æ•°ä¸å¤§äºCPUæ•°ç›®æ—¶ï¼Œä¸åŒçš„çº¿ç¨‹è¿è¡Œäºä¸åŒçš„CPUä¸Šï¼›</li></ol><ul><li><strong>ç¼ºç‚¹</strong>ï¼š<strong>è°ƒåº¦æ—¶, è¦ä¿å­˜çº¿ç¨‹çŠ¶æ€</strong>ï¼Œé¢‘ç¹è°ƒåº¦, éœ€è¦å ç”¨å¤§é‡çš„æœºæ—¶ï¼›ç¨‹åºè®¾è®¡ä¸Šå®¹æ˜“å‡ºé”™ï¼ˆ<strong>çº¿ç¨‹åŒæ­¥é—®é¢˜</strong>ï¼‰</li></ul></li><li><p>å¤šè¿›ç¨‹</p><ul><li><strong>å¤šè¿›ç¨‹ä¼˜ç‚¹</strong>ï¼š1. <strong>æ¯ä¸ªè¿›ç¨‹äº’ç›¸ç‹¬ç«‹ï¼Œä¸å½±å“ä¸»ç¨‹åºçš„ç¨³å®šæ€§ï¼Œå­è¿›ç¨‹å´©æºƒæ²¡å…³ç³»</strong>ï¼›2. é€šè¿‡å¢åŠ CPUï¼Œå°±å¯ä»¥å®¹æ˜“æ‰©å……æ€§èƒ½ï¼›3. å¯ä»¥<strong>å°½é‡å‡å°‘çº¿ç¨‹åŠ é”/è§£é”çš„å½±å“ï¼Œæå¤§æé«˜æ€§èƒ½</strong>ï¼Œå°±ç®—æ˜¯çº¿ç¨‹è¿è¡Œçš„æ¨¡å—<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>æ•ˆç‡ä½ä¹Ÿæ²¡å…³ç³»ï¼›4. æ¯ä¸ªå­è¿›ç¨‹éƒ½æœ‰2GBåœ°å€ç©ºé—´å’Œç›¸å…³èµ„æºï¼Œæ€»ä½“èƒ½å¤Ÿè¾¾åˆ°çš„æ€§èƒ½ä¸Šé™éå¸¸å¤§ã€‚</li><li><strong>å¤šè¿›ç¨‹ç¼ºç‚¹</strong>ï¼š1. é€»è¾‘æ§åˆ¶å¤æ‚ï¼Œéœ€è¦å’Œä¸»ç¨‹åºäº¤äº’ï¼›2. éœ€è¦è·¨è¿›ç¨‹è¾¹ç•Œï¼Œå¦‚æœæœ‰å¤§æ•°æ®é‡ä¼ é€ï¼Œå°±ä¸å¤ªå¥½ï¼Œé€‚åˆå°æ•°æ®é‡ä¼ é€ã€å¯†é›†è¿ç®—ï¼›3. å¤šè¿›ç¨‹è°ƒåº¦å¼€é”€æ¯”è¾ƒå¤§ã€‚</li></ul></li><li><p>å¤šçº¿ç¨‹</p><p>ï¼š</p><ul><li><strong>å¤šçº¿ç¨‹çš„ä¼˜ç‚¹</strong>ï¼š1. æ— éœ€è·¨è¿›ç¨‹è¾¹ç•Œï¼›2. ç¨‹åºé€»è¾‘å’Œæ§åˆ¶æ–¹å¼ç®€å•ï¼›3. æ‰€æœ‰çº¿ç¨‹å¯ä»¥ç›´æ¥å…±äº«å†…å­˜å’Œå˜é‡ç­‰ï¼›4. çº¿ç¨‹æ–¹å¼æ¶ˆè€—çš„æ€»èµ„æºæ¯”è¿›ç¨‹æ–¹å¼å¥½ï¼›</li><li><strong>å¤šçº¿ç¨‹ç¼ºç‚¹</strong>ï¼š</li></ul><ol><li>æ¯ä¸ªçº¿ç¨‹ä¸ä¸»ç¨‹åºå…±ç”¨åœ°å€ç©ºé—´ï¼Œå—é™äº2GBåœ°å€ç©ºé—´ï¼›</li><li><strong>çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥å’ŒåŠ é”æ§åˆ¶æ¯”è¾ƒéº»çƒ¦</strong>ï¼›</li><li>ä¸€ä¸ªçº¿ç¨‹çš„å´©æºƒå¯èƒ½å½±å“åˆ°æ•´ä¸ªç¨‹åºçš„ç¨³å®šæ€§ï¼›</li><li>åˆ°è¾¾ä¸€å®šçš„çº¿ç¨‹æ•°ç¨‹åº¦åï¼Œå³ä½¿å†å¢åŠ CPUä¹Ÿæ— æ³•æé«˜æ€§èƒ½ï¼Œä¾‹å¦‚Windows Server 2003ï¼Œå¤§çº¦æ˜¯1500ä¸ªå·¦å³çš„çº¿ç¨‹æ•°å°±å¿«åˆ°æé™äº†ï¼ˆçº¿ç¨‹å †æ ˆè®¾å®šä¸º1Mï¼‰ï¼Œå¦‚æœè®¾å®šçº¿ç¨‹å †æ ˆä¸º2Mï¼Œè¿˜è¾¾ä¸åˆ°1500ä¸ªçº¿ç¨‹æ€»æ•°ï¼›</li><li><strong>çº¿ç¨‹èƒ½å¤Ÿæé«˜çš„æ€»æ€§èƒ½æœ‰é™</strong>ï¼Œè€Œä¸”çº¿ç¨‹å¤šäº†ä¹‹åï¼Œçº¿ç¨‹æœ¬èº«çš„è°ƒåº¦ä¹Ÿæ˜¯ä¸€ä¸ªéº»çƒ¦äº‹å„¿ï¼Œéœ€è¦æ¶ˆè€—è¾ƒå¤šçš„CPU</li></ol></li></ul><h2 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h2><ul><li><p>è¿›ç¨‹/çº¿ç¨‹/åç¨‹åŒºåˆ«</p><ul><li><strong>è¿›ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å †å’Œæ ˆ</strong>ï¼Œ<strong>æ—¢ä¸å…±äº«å †ï¼Œäº¦ä¸å…±äº«æ ˆ</strong>ï¼Œè¿›ç¨‹<strong>ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦</strong></li><li><strong>çº¿ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆ</strong>å’Œ<strong>å…±äº«çš„å †</strong>ï¼Œå…±äº«å †ï¼Œä¸å…±äº«æ ˆï¼Œ<strong>çº¿ç¨‹äº¦ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦</strong></li><li><strong>åç¨‹</strong>å’Œçº¿ç¨‹ä¸€æ ·<strong>å…±äº«å †ï¼Œä¸å…±äº«æ ˆ</strong>ï¼Œå<strong>ç¨‹ç”±ç¨‹åºå‘˜åœ¨åç¨‹çš„ä»£ç é‡Œæ˜¾ç¤ºè°ƒåº¦</strong></li></ul></li><li><p>åç¨‹ä¸çº¿ç¨‹åŒºåˆ«</p><p>ï¼š</p><ul><li>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šä¸ªåç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¹Ÿå¯ä»¥å•ç‹¬æ‹¥æœ‰å¤šä¸ªåç¨‹ï¼Œè¿™æ ·pythonä¸­åˆ™èƒ½ä½¿ç”¨å¤šæ ¸CPU</li><li><strong>çº¿ç¨‹è¿›ç¨‹éƒ½æ˜¯åŒæ­¥æœºåˆ¶ï¼Œè€Œåç¨‹åˆ™æ˜¯å¼‚æ­¥</strong></li><li>åç¨‹èƒ½ä¿ç•™ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„çŠ¶æ€ï¼Œæ¯æ¬¡è¿‡ç¨‹é‡å…¥æ—¶ï¼Œå°±ç›¸å½“äºè¿›å…¥ä¸Šä¸€æ¬¡è°ƒç”¨çš„çŠ¶æ€</li><li><strong>åç¨‹é¿å…äº†æ— æ„ä¹‰çš„è°ƒåº¦</strong>ï¼Œç”±æ­¤å¯ä»¥æé«˜æ€§èƒ½ï¼Œä½†ä¹Ÿå› æ­¤ï¼Œ<strong>ç¨‹åºå‘˜å¿…é¡»è‡ªå·±æ‰¿æ‹…è°ƒåº¦çš„è´£ä»»</strong>ï¼ŒåŒæ—¶ï¼Œ<strong>åç¨‹ä¹Ÿå¤±å»äº†æ ‡å‡†çº¿ç¨‹ä½¿ç”¨å¤šCPUçš„èƒ½åŠ›</strong></li></ul></li></ul><h3 id="Qï¼šåç¨‹æ˜¯å¦‚ä½•æ›´å°‘å ç”¨èµ„æºçš„"><a href="#Qï¼šåç¨‹æ˜¯å¦‚ä½•æ›´å°‘å ç”¨èµ„æºçš„" class="headerlink" title="Qï¼šåç¨‹æ˜¯å¦‚ä½•æ›´å°‘å ç”¨èµ„æºçš„"></a>Qï¼šåç¨‹æ˜¯å¦‚ä½•æ›´å°‘å ç”¨èµ„æºçš„</h3><ul><li>åç¨‹åˆ‡æ¢å®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œï¼Œçº¿ç¨‹åˆ‡æ¢æ¶‰åŠç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢ï¼Œéœ€è¦åœ¨å†…æ ¸ç©ºé—´å®Œæˆ<ul><li>åç¨‹ä¸ä¾èµ–æ“ä½œç³»ç»Ÿå’Œå…¶æä¾›çš„çº¿ç¨‹</li><li><strong>åç¨‹ä¹‹é—´çš„åˆ‡æ¢å®Œå…¨åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼Œåœ¨ç”¨æˆ·æ€æ²¡æœ‰æ—¶é’Ÿä¸­æ–­ï¼Œç³»ç»Ÿè°ƒç”¨ç­‰æœºåˆ¶ï¼Œå› æ­¤æ•ˆç‡é«˜</strong>ã€‚<strong>åç¨‹åˆ‡æ¢åªæ¶‰åŠåŸºæœ¬çš„CPUä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼ˆå¯„å­˜å™¨ä¿å­˜ CPUè¿è¡Œä»»åŠ¡æ‰€éœ€è¦çš„ä¿¡æ¯ï¼‰ï¼Œåç¨‹åˆ‡æ¢éå¸¸ç®€å•ï¼Œå°±æ˜¯æŠŠå½“å‰åç¨‹çš„ CPU å¯„å­˜å™¨çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œç„¶åå°†éœ€è¦åˆ‡æ¢è¿›æ¥çš„åç¨‹çš„ CPU å¯„å­˜å™¨çŠ¶æ€åŠ è½½çš„ CPU å¯„å­˜å™¨ä¸Šã€‚</li><li>ç³»ç»Ÿå†…æ ¸è°ƒåº¦çš„å¯¹è±¡æ˜¯çº¿ç¨‹ï¼Œ<strong>çº¿ç¨‹çš„è°ƒåº¦åªæœ‰æ‹¥æœ‰æœ€é«˜æƒé™çš„å†…æ ¸ç©ºé—´æ‰å¯ä»¥å®Œæˆï¼Œæ‰€ä»¥çº¿ç¨‹çš„åˆ‡æ¢æ¶‰åŠåˆ°ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„åˆ‡æ¢</strong>ï¼Œç°ä»£æ“ä½œç³»ç»Ÿä¸€èˆ¬éƒ½é‡‡ç”¨æŠ¢å å¼è°ƒåº¦ï¼Œ<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸€èˆ¬å‘ç”Ÿåœ¨æ—¶é’Ÿä¸­æ–­å’Œç³»ç»Ÿè°ƒç”¨è¿”å›å‰</strong>ï¼Œè°ƒåº¦å™¨è®¡ç®—å½“å‰çº¿ç¨‹çš„æ—¶é—´ç‰‡ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢å°±ä»è¿è¡Œé˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªç›®æ ‡çº¿ç¨‹ï¼Œä¿å­˜å½“å‰çº¿ç¨‹çš„ç¯å¢ƒï¼Œå¹¶ä¸”æ¢å¤ç›®æ ‡çº¿ç¨‹çš„è¿è¡Œç¯å¢ƒã€‚</li></ul></li><li>åç¨‹å ç”¨å†…å­˜å°‘<ul><li>çº¿ç¨‹é™¤äº†å’Œåç¨‹ç›¸åŒåŸºæœ¬çš„ CPU ä¸Šä¸‹æ–‡ï¼Œè¿˜æœ‰çº¿ç¨‹ç§æœ‰çš„æ ˆå’Œå¯„å­˜å™¨ç­‰ï¼Œä¸Šä¸‹æ–‡æ¯”åç¨‹å¤šä¸€äº›</li></ul></li></ul><h2 id="å­¤å„¿è¿›ç¨‹-amp-åƒµå°¸è¿›ç¨‹ã€æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿæœ‰ä»€ä¹ˆå±å®³ï¼Ÿæ€ä¹ˆå»é¢„é˜²ï¼Ÿã€‘"><a href="#å­¤å„¿è¿›ç¨‹-amp-åƒµå°¸è¿›ç¨‹ã€æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿæœ‰ä»€ä¹ˆå±å®³ï¼Ÿæ€ä¹ˆå»é¢„é˜²ï¼Ÿã€‘" class="headerlink" title="å­¤å„¿è¿›ç¨‹ &amp; åƒµå°¸è¿›ç¨‹ã€æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿæœ‰ä»€ä¹ˆå±å®³ï¼Ÿæ€ä¹ˆå»é¢„é˜²ï¼Ÿã€‘"></a>å­¤å„¿è¿›ç¨‹ &amp; åƒµå°¸è¿›ç¨‹ã€æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿæœ‰ä»€ä¹ˆå±å®³ï¼Ÿæ€ä¹ˆå»é¢„é˜²ï¼Ÿã€‘</h2><ul><li><p>ä¸€èˆ¬è¿›ç¨‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼šå­è¿›ç¨‹ç”±çˆ¶è¿›ç¨‹åˆ›å»ºï¼Œå­è¿›ç¨‹å†åˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚çˆ¶å­è¿›ç¨‹æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œçˆ¶è¿›ç¨‹æ°¸è¿œæ— æ³•é¢„æµ‹å­è¿›ç¨‹çš„ç»“æŸï¼Œæ‰€ä»¥ï¼Œå½“å­è¿›ç¨‹ç»“æŸåï¼Œå®ƒçš„çˆ¶è¿›ç¨‹ä¼šè°ƒç”¨wait()æˆ–waitpid()å–å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Œå›æ”¶æ‰å­è¿›ç¨‹çš„èµ„æºã€‚</p></li><li><p><strong>å­¤å„¿è¿›ç¨‹</strong>ï¼š<strong>çˆ¶è¿›ç¨‹ç»“æŸäº†ï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œ</strong>ï¼Œé‚£ä¹ˆè¿™äº›å­è¿›ç¨‹å°±æˆä¸ºå­¤å„¿è¿›ç¨‹(father died)ã€‚å­è¿›ç¨‹çš„èµ„æºç”±initè¿›ç¨‹å›æ”¶</p></li><li><p><strong>åƒµå°¸è¿›ç¨‹</strong>ï¼š<strong>å­è¿›ç¨‹é€€å‡ºäº†ï¼Œä½†æ˜¯çˆ¶è¿›ç¨‹æ²¡æœ‰ç”¨waitæˆ–waitpidå»è·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­</strong></p></li><li><p>å±å®³</p><p>ï¼š</p><ul><li>å¦‚æœçˆ¶è¿›ç¨‹ä¸è°ƒç”¨waitæˆ–waitpidçš„è¯ï¼Œé‚£ä¹ˆä¿ç•™çš„ä¿¡æ¯å°±ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå…¶è¿›ç¨‹å·å°±ä¼šè¢«ä¸€ç›´å ç”¨ï¼Œä½†æ˜¯ç³»ç»Ÿæ‰€èƒ½ä½¿ç”¨çš„è¿›ç¨‹å·æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå¤§é‡äº§ç”Ÿåƒµæ­»è¿›ç¨‹ï¼Œ<strong>å°†å› æ²¡æœ‰å¯ç”¨çš„è¿›ç¨‹å·è€Œå¯¼è‡´ç³»ç»Ÿæ— æ³•äº§ç”Ÿæ–°çš„è¿›ç¨‹</strong>ï¼Œè¿™å°±æ˜¯åƒµå°¸è¿›ç¨‹çš„å±å®³</li><li>å­¤å„¿è¿›ç¨‹æ˜¯æ²¡æœ‰çˆ¶è¿›ç¨‹çš„è¿›ç¨‹ï¼Œå®ƒç”±initè¿›ç¨‹å¾ªç¯çš„wait()å›æ”¶èµ„æºï¼Œinitè¿›ç¨‹å……å½“çˆ¶è¿›ç¨‹ã€‚å› æ­¤å­¤å„¿è¿›ç¨‹å¹¶æ²¡æœ‰ä»€ä¹ˆå±å®³</li></ul></li><li><p>é¢„é˜²/è§£å†³æ–¹æ³•</p><p>ï¼š</p><ul><li>fork()ä¸¤æ¬¡ï¼Œå°†å­è¿›ç¨‹å˜æˆå­¤å„¿è¿›ç¨‹ï¼Œä»è€Œå…¶çˆ¶è¿›ç¨‹å˜æˆinitè¿›ç¨‹ï¼Œé€šè¿‡initè¿›ç¨‹å¤„ç†åƒµå°¸è¿›ç¨‹ã€forkå‡½æ•°çš„ä½œç”¨æ˜¯ä»å·²ç»å­˜åœ¨çš„è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè€ŒåŸè¿›ç¨‹ç§°ä¸ºçˆ¶è¿›ç¨‹ã€‘</li><li>é€šè¿‡ä¿¡å·æœºåˆ¶ï¼Œåœ¨å¤„ç†å‡½æ•°ä¸­è°ƒç”¨waitï¼Œå›æ”¶èµ„æº</li></ul></li></ul><h3 id="åŒæ­¥-amp-å¼‚æ­¥"><a href="#åŒæ­¥-amp-å¼‚æ­¥" class="headerlink" title="åŒæ­¥ &amp; å¼‚æ­¥"></a>åŒæ­¥ &amp; å¼‚æ­¥</h3><ul><li><p>åŒæ­¥éœ€è¦ç­‰å¾…ï¼ˆé˜»å¡ï¼‰ï¼Œå¼‚æ­¥æ— éœ€ç­‰å¾…ï¼ˆä¸é˜»å¡ï¼‰</p></li><li><p>åŒæ­¥</p><p>ï¼šå¯ä»¥ç†è§£ä¸ºåœ¨æ‰§è¡Œå®Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ä¹‹åï¼Œä¸€ç›´ç­‰å¾…ç³»ç»Ÿè¿”å›å€¼æˆ–æ¶ˆæ¯ï¼Œè¿™æ—¶ç¨‹åºæ˜¯å‡ºäºé˜»å¡çš„ï¼Œåªæœ‰æ¥æ”¶åˆ°è¿”å›çš„å€¼æˆ–æ¶ˆæ¯åæ‰å¾€ä¸‹æ‰§è¡Œå…¶ä»–çš„å‘½ä»¤</p><ul><li>åŒæ­¥å°±æ˜¯æ•´ä¸ªå¤„ç†è¿‡ç¨‹<strong>é¡ºåºæ‰§è¡Œ</strong>ï¼Œå½“å„ä¸ªè¿‡ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶è¿”å›ç»“æœã€‚æ˜¯ä¸€ç§<strong>çº¿æ€§æ‰§è¡Œçš„æ–¹å¼</strong>ï¼Œ<strong>æ‰§è¡Œçš„æµç¨‹ä¸èƒ½è·¨è¶Š</strong>ã€‚ä¸€èˆ¬ç”¨äºæµç¨‹æ€§æ¯”è¾ƒå¼ºçš„ç¨‹åºï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•ï¼Œéœ€è¦å¯¹ç”¨æˆ·éªŒè¯å®Œæˆåæ‰èƒ½ç™»å½•ç³»ç»Ÿã€‚</li></ul></li><li><p>å¼‚æ­¥</p><p>ï¼šæ‰§è¡Œå®Œå‡½æ•°æˆ–æ–¹æ³•åï¼Œä¸å¿…é˜»å¡æ€§åœ°ç­‰å¾…è¿”å›å€¼æˆ–æ¶ˆæ¯ï¼Œåªéœ€è¦å‘ç³»ç»Ÿå§”æ‰˜ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œé‚£ä¹ˆå½“ç³»ç»Ÿæ¥æ”¶åˆ°è¿”å›å€¼æˆ–æ¶ˆæ¯æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§¦å‘å§”æ‰˜çš„å¼‚æ­¥è¿‡ç¨‹ï¼Œä»è€Œå®Œæˆä¸€ä¸ªå®Œæ•´çš„æµç¨‹</p><ul><li><strong>å¼‚æ­¥</strong>åˆ™æ˜¯åªæ˜¯å‘é€äº†è°ƒç”¨çš„æŒ‡ä»¤ï¼Œè°ƒç”¨è€…æ— éœ€ç­‰å¾…è¢«è°ƒç”¨çš„æ–¹æ³•å®Œå…¨æ‰§è¡Œå®Œæ¯•ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æµç¨‹ã€‚<strong>æ˜¯ä¸€ç§å¹¶è¡Œå¤„ç†çš„æ–¹å¼</strong>ï¼Œä¸å¿…ç­‰å¾…ä¸€ä¸ªç¨‹åºæ‰§è¡Œå®Œï¼Œå¯ä»¥æ‰§è¡Œå…¶å®ƒçš„ä»»åŠ¡ï¼Œæ¯”å¦‚é¡µé¢æ•°æ®åŠ è½½è¿‡ç¨‹ï¼Œä¸éœ€è¦ç­‰æ‰€æœ‰æ•°æ®è·å–åå†æ˜¾ç¤ºé¡µ</li></ul></li></ul><h2 id="æ“ä½œç³»ç»Ÿä¸­çš„å †æ ˆ"><a href="#æ“ä½œç³»ç»Ÿä¸­çš„å †æ ˆ" class="headerlink" title="æ“ä½œç³»ç»Ÿä¸­çš„å †æ ˆ"></a>æ“ä½œç³»ç»Ÿä¸­çš„å †æ ˆ</h2><ul><li><p><strong>æ“ä½œç³»ç»Ÿçš„å †å’Œæ ˆæ˜¯æŒ‡å¯¹å†…å­˜è¿›è¡Œæ“ä½œå’Œç®¡ç†çš„ä¸€äº›æ–¹å¼</strong>è¿™å’Œæ•°æ®ç»“æ„ä¸­çš„å †å’Œæ ˆæ˜¯æœ‰åŒºåˆ«çš„</p></li><li><p>æ ˆ</p><p>ï¼š</p><ul><li>æ ˆä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºæ ˆå†…å­˜æ˜¯ä¸€ä¸ªå…·æœ‰åŠ¨æ€å†…å­˜åŒºåŸŸï¼Œå­˜å‚¨å‡½æ•°å†…éƒ¨ï¼ˆåŒ…æ‹¬mainå‡½æ•°ï¼‰çš„å±€éƒ¨å˜é‡ï¼Œæ–¹æ³•è°ƒç”¨åŠå‡½æ•°å‚æ•°å€¼</li><li><strong>ç”±ç¼–è¯‘å™¨/ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾</strong>ã€‚ä¾‹å¦‚ï¼Œå£°æ˜åœ¨å‡½æ•°ä¸­ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå³int bï¼Œç³»ç»Ÿè‡ªåŠ¨åœ¨æ ˆä¸­ä¸ºå˜é‡bå¼€è¾Ÿç©ºé—´</li><li>æ ˆå­˜æ”¾<strong>å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼</strong>ç­‰ã€‚å…¶æ“ä½œæ–¹å¼ç±»ä¼¼äºæ•°æ®ç»“æ„ä¸­çš„æ ˆï¼Œæ»¡è¶³ï¼šâ€œå…ˆè¿›åå‡ºâ€çš„åŸåˆ™å­˜å–ï¼Œä¹Ÿå°±æ˜¯ä½äºæ ˆå†…çš„å…ƒç´ ï¼Œå¿…é¡»ç­‰åˆ°å…¶ä¸Šé¢ï¼ˆå¯¹åº”çš„åœ°å€ä¸ºè¾ƒä½çš„åœ°å€ï¼‰çš„æ•°æ®æˆ–å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œå¼¹å‡ºåæ‰å¯ä»¥è¿›è¡Œä¸‹é¢çš„å…ƒç´ çš„æ“ä½œ</li><li>æ ˆæ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„ï¼Œä¸€èˆ¬é€Ÿåº¦è¾ƒå¿«ï¼ˆ<strong>æ ˆçš„é€Ÿåº¦é«˜äºå †çš„é€Ÿåº¦</strong>ï¼‰</li><li>ç”³è¯·å¤§å°çš„é™åˆ¶ï¼šæ ˆæ˜¯å‘ä½åœ°å€æ‰©å±•çš„ï¼Œæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜çš„åŒºåŸŸã€‚æ ˆé¡¶çš„åœ°å€å’Œæ ˆçš„æœ€å¤§å®¹é‡<strong>æ˜¯ç³»ç»Ÿé¢„å…ˆè§„å®šå¥½çš„</strong>ï¼Œæ ˆçš„å¤§å°æ˜¯2Mï¼ˆä¹Ÿæœ‰çš„è¯´æ˜¯1Mï¼Œæ€»ä¹‹æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å°±ç¡®å®šçš„å¸¸æ•° ) ï¼Œ<strong>å¦‚æœç”³è¯·çš„ç©ºé—´è¶…è¿‡æ ˆçš„å‰©ä½™ç©ºé—´æ—¶ï¼Œå°†æç¤ºoverflow</strong>ã€‚å› æ­¤ï¼Œ<strong>èƒ½ä»æ ˆè·å¾—çš„ç©ºé—´è¾ƒå°</strong>ã€‚</li></ul></li><li><p>å †</p><p>ï¼š</p><ul><li>ä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œå¹¶æŒ‡æ˜å¤§å°ï¼Œå †è¢«ç¨‹åºç”³è¯·ä½¿ç”¨çš„å†…å­˜åœ¨è¢«ä¸»åŠ¨é‡Šæ”¾å‰ä¸€ç›´æœ‰æ•ˆã€‚å †éœ€è¦ç”±ç”±ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾ï¼Œ<strong>ä¸åŠæ—¶å›æ”¶å®¹æ˜“äº§ç”Ÿå†…å­˜æ³„éœ²</strong>ã€‚ ç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±æ“ä½œç³»ç»Ÿå›æ”¶ã€‚</li><li>æ ˆæ˜¯å­˜æ”¾åœ¨ä¸€çº§ç¼“å­˜ä¸­çš„ï¼Œè€Œå †åˆ™æ˜¯å­˜æ”¾åœ¨äºŒçº§ç¼“å­˜ä¸­çš„ï¼Œ<strong>å †çš„ç”Ÿå‘½å‘¨æœŸç”±è™šæ‹Ÿæœºçš„åƒåœ¾å›æ”¶<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>æ¥å†³å®š</strong>ï¼ˆå¹¶ä¸æ˜¯ä¸€æ—¦æˆä¸ºå­¤å„¿å¯¹è±¡å°±èƒ½è¢«å›æ”¶ï¼‰ï¼Œæ‰€ä»¥è°ƒç”¨è¿™äº›å¯¹è±¡çš„é€Ÿåº¦è¦ç›¸å¯¹æ¥å¾—ä½ä¸€äº›ï¼Œæ•…å †çš„é€Ÿåº¦æ…¢äºæ ˆçš„é€Ÿåº¦</li><li>ä¸æ•°æ®ç»“æ„ä¸­çš„å †æ˜¯ä¸åŒçš„ï¼Œåˆ†é…æ–¹å¼ç±»ä¼¼äº<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E9%93%BE%E8%A1%A8">é“¾è¡¨</a>ï¼ˆç©ºé—²<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E9%93%BE%E8%A1%A8">é“¾è¡¨</a>æ³•ï¼‰ï¼Œ<strong>å †æ˜¯å‘é«˜åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸ</strong>ï¼Œè¿™æ˜¯ç”±äºç³»ç»Ÿæ˜¯ç”¨<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E9%93%BE%E8%A1%A8">é“¾è¡¨</a>æ¥å­˜å‚¨ç©ºé—²å†…å­˜åœ°å€çš„ï¼Œè‡ªç„¶æ˜¯ä¸è¿ç»­çš„ï¼Œè€Œ<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E9%93%BE%E8%A1%A8">é“¾è¡¨</a>çš„éå†æ–¹å‘æ˜¯ç”±ä½åœ°å€å‘é«˜åœ°å€ã€‚<strong>å †çš„å¤§å°å—é™äºè®¡ç®—æœºç³»ç»Ÿä¸­æœ‰æ•ˆçš„è™šæ‹Ÿå†…å­˜</strong>ã€‚ç”±æ­¤å¯è§ï¼Œå †è·å¾—çš„ç©ºé—´æ¯”è¾ƒçµæ´»ï¼Œä¹Ÿæ¯”è¾ƒå¤§ã€‚</li></ul></li><li><p>åŒºåˆ«</p><p>ï¼š</p><ul><li>ç©ºé—´åˆ†é…ï¼šæ ˆç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨åˆ†é…é‡Šæ”¾ï¼›å †ä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾</li><li>ç”³è¯·æ•ˆç‡å¯¹æ¯”ï¼šæ ˆä½¿ç”¨ä¸€çº§ç¼“å­˜ï¼Œè¢«è°ƒç”¨æ—¶é€šå¸¸å¤„äºå­˜å‚¨ç©ºé—´ä¸­ï¼Œè°ƒç”¨åè¢«ç«‹å³é‡Šæ”¾ï¼›.å †ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œç”Ÿå‘½å‘¨æœŸä¸è™šæ‹Ÿæœºçš„GC<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>æœ‰å…³ï¼Œè°ƒç”¨é€Ÿåº¦ç›¸å¯¹è¾ƒä½ã€‚</li><li>ç”³è¯·å¤§å°çš„é™åˆ¶ï¼šæ ˆæ˜¯å‘ä½åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜çš„åŒºåŸŸï¼›å †æ˜¯å‘é«˜åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸ</li></ul></li></ul><h2 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h2><p><a href="https://juejin.im/post/5c37577e6fb9a049fd100da8#heading-0">å‚è€ƒæ–‡ç« </a></p><ul><li>æ­»é”æ˜¯æŒ‡<strong>å¤šä¸ªè¿›ç¨‹</strong>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å› <strong>äº‰å¤ºèµ„æº</strong>è€Œé€ æˆçš„ä¸€ç§åƒµå±€ï¼Œå½“è¿›ç¨‹å¤„äºè¿™ç§åƒµæŒçŠ¶æ€æ—¶ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•å†å‘å‰æ¨è¿›</li></ul><h3 id="äº§ç”Ÿæ­»é”çš„åŸå› "><a href="#äº§ç”Ÿæ­»é”çš„åŸå› " class="headerlink" title="äº§ç”Ÿæ­»é”çš„åŸå› "></a>äº§ç”Ÿæ­»é”çš„åŸå› </h3><ul><li><strong>å¤šä¸ªè¿›ç¨‹ç«äº‰èµ„æº</strong></li><li><strong>è¿›ç¨‹é—´æ¨è¿›é¡ºåºä¸å½“</strong></li></ul><h3 id="äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"><a href="#äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶" class="headerlink" title="äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"></a>äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶</h3><ul><li><strong>äº’æ–¥</strong>æ¡ä»¶ï¼Œåœ¨ä»»ä½•æ—¶åˆ»ä¸€ä¸ªèµ„æºåªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨</li><li><strong>æ‹¥æœ‰å’Œè¯·æ±‚</strong>ï¼ˆè¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼‰ï¼Œå·²ç»å¾—åˆ°æŸä¸ªèµ„æºçš„è¿›ç¨‹å¯ä»¥å†è¯·æ±‚æ–°çš„èµ„æº</li><li><strong>ä¸å¯æŠ¢å </strong>ï¼ˆä¸å‰¥å¤ºæ¡ä»¶ï¼‰ï¼Œå·²ç»åˆ†é…ç»™è¿›ç¨‹çš„èµ„æºä¸èƒ½è¢«æŠ¢å ï¼Œè€Œåªèƒ½è¢«æ˜¾å¼é‡Šæ”¾</li><li><strong>å¾ªç¯ç­‰å¾…</strong>ï¼ˆç¯è·¯ç­‰å¾…æ¡ä»¶ï¼‰ï¼Œç³»ç»Ÿä¸­æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªçš„è¿›ç¨‹ç»„æˆä¸€æ¡å¾ªç¯ï¼Œè¯¥å¾ªç¯ä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½ç­‰å¾…ç€å¦ä¸€ä¸ªè¿›ç¨‹å æœ‰çš„èµ„æº</li></ul><h3 id="å¤„ç†ç­–ç•¥"><a href="#å¤„ç†ç­–ç•¥" class="headerlink" title="å¤„ç†ç­–ç•¥"></a>å¤„ç†ç­–ç•¥</h3><ol><li><p>è§£å†³æ­»é”ï¼šã€<strong>æ’¤é”€è¿›ç¨‹æ³•</strong>ã€‘</p></li><li><p>æ­»é”é¢„é˜²</p><p>ï¼šç ´åæ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œä»¥é¿å…å‘ç”Ÿæ­»é”ã€‚ã€</p><p>èµ„æºæœ‰åºåˆ†é…æ³•</p><p>ã€‘</p><ul><li>ç ´åäº’æ–¥ï¼šä¸è®©èµ„æºè¢«ä¸€ä¸ªè¿›ç¨‹ç‹¬å ï¼Œå¯é€šè¿‡å‡è„±æœºæŠ€æœ¯å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®èµ„æºï¼›</li><li>ç ´åæ‹¥æœ‰å’Œè¯·æ±‚ï¼š1. å·²æ‹¥æœ‰èµ„æºçš„è¿›ç¨‹ä¸èƒ½å†å»è¯·æ±‚å…¶ä»–èµ„æºï¼Œè¦æ±‚è¿›ç¨‹åœ¨å¼€å§‹æ‰§è¡Œå‰è¯·æ±‚éœ€è¦çš„æ‰€æœ‰èµ„æºï¼›2. è¦æ±‚è¿›ç¨‹è¯·æ±‚èµ„æºæ—¶ï¼Œå…ˆæš‚æ—¶é‡Šæ”¾å…¶å½“å‰æ‹¥æœ‰çš„æ‰€æœ‰èµ„æºï¼Œå†å°è¯•ä¸€æ¬¡è·å–æ‰€éœ€çš„å…¨éƒ¨èµ„æº</li><li>ç ´åä¸å¯æŠ¢å ï¼šæœ‰äº›èµ„æºå¯ä»¥é€šè¿‡è™šæ‹ŸåŒ–æ–¹å¼å®ç°å¯æŠ¢å </li><li>ç ´åå¾ªç¯ç­‰å¾…ï¼š1. ä¿è¯æ¯ä¸ªè¿›ç¨‹åœ¨ä»»ä½•æ—¶åˆ»åªèƒ½å ç”¨ä¸€ä¸ªèµ„æºï¼Œå¦‚æœè¦è¯·æ±‚å¦ä¸€ä¸ªèµ„æºï¼Œå¿…é¡»å…ˆé‡Šæ”¾ç¬¬ä¸€ä¸ªèµ„æºï¼›æ˜¯å°†æ‰€æœ‰èµ„æºè¿›è¡Œç»Ÿä¸€ç¼–å·ï¼Œè¿›ç¨‹å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»è¯·æ±‚èµ„æºï¼Œä½†è¦æ±‚è¿›ç¨‹å¿…é¡»æŒ‰ç…§é¡ºåºè¯·æ±‚èµ„æº</li></ul></li><li><p><strong>é¿å…æ­»é”</strong>ï¼šåˆ¤æ–­æ˜¯å¦ä¼šå‡ºç°æ­»é”å°±æ˜¯çœ‹æ˜¯å¦èƒ½æ‰¾åˆ°ä¸€ä¸ªå®‰å…¨åºåˆ—ï¼Œä½¿å¾—è¿›ç¨‹æŒ‰æ¨è¿›é¡ºåºä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…å…¶æ‰€éœ€èµ„æºï¼Œä½¿æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½é¡ºåºæ‰§è¡Œã€‚ä¾‹å¦‚ï¼šã€**é“¶è¡Œå®¶<a href="https://www.nowcoder.com/jump/super-jump/word?word=%E7%AE%97%E6%B3%95">ç®—æ³•</a>**ã€‘</p></li><li><p><strong>æ£€æµ‹æ­»é”å¹¶æ¢å¤</strong>ï¼šèµ„æºåˆ†é…å›¾ï¼›ä»ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ä¸­æŠ¢å èµ„æºåˆ†é…ç»™æ­»é”è¿›ç¨‹ï¼›ç»ˆæ­¢æ‰€æœ‰çš„æ­»é”è¿›ç¨‹ã€‚ã€<strong>èµ„æºåˆ†é…å›¾åŒ–ç®€æ³•</strong>ã€‘</p></li></ol><h3 id="å¦‚ä½•å‘ç°æ­»é”ï¼Ÿ"><a href="#å¦‚ä½•å‘ç°æ­»é”ï¼Ÿ" class="headerlink" title="å¦‚ä½•å‘ç°æ­»é”ï¼Ÿ"></a>å¦‚ä½•å‘ç°æ­»é”ï¼Ÿ</h3><ul><li>é€šè¿‡æ­»é”æ£€æµ‹å·¥å…·ï¼Œä¾‹å¦‚é€šè¿‡jdkå·¥å…·jpsã€jstackæ’æŸ¥æ­»é”é—®é¢˜</li></ul><ol><li><strong>ä½¿ç”¨jspæŸ¥æ‰¾ç¨‹åºè¿›è¡Œ</strong>ï¼šjpsæ˜¯jdkæä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°æ­£åœ¨è¿è¡Œçš„javaè¿›ç¨‹</li><li><strong>ä½¿ç”¨jstackæŸ¥çœ‹çº¿ç¨‹å †æ ˆä¿¡æ¯</strong>ï¼šjstackï¼šjdkæä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥æŸ¥çœ‹javaè¿›ç¨‹ä¸­çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œåé¢å¯ä»¥æŸ¥çœ‹åˆ°å…·ä½“åœ¨ä»£ç å“ªä¸€è¡Œã€‚</li><li>ä¹Ÿé€šè¿‡jdkæä¾›çš„å·¥å…·<strong>jconsoleæ’æŸ¥æ­»é”é—®é¢˜</strong>ï¼šjconsoleæ˜¯<strong>jdkæä¾›çš„ä¸€ä¸ªå¯è§†åŒ–çš„å·¥å…·</strong>ï¼Œæ–¹ä¾¿æ’æŸ¥ç¨‹åºçš„ä¸€äº›é—®é¢˜ï¼Œå¦‚ï¼šç¨‹åºå†…å­˜æº¢å‡ºã€æ­»é”é—®é¢˜ç­‰ç­‰ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> operate </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œ</title>
      <link href="2021/03/15/network/"/>
      <url>2021/03/15/network/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¡ç®—æœºç½‘ç»œ"><a href="#è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºç½‘ç»œ"></a>è®¡ç®—æœºç½‘ç»œ</h1><h3 id="ä¼ è¾“æ—¶å»¶"><a href="#ä¼ è¾“æ—¶å»¶" class="headerlink" title="ä¼ è¾“æ—¶å»¶"></a>ä¼ è¾“æ—¶å»¶</h3><p><font color="green">æ—¶å»¶æŒ‡æ•°æ®ï¼ˆä¸€ä¸ªæŠ¥æ–‡æˆ–åˆ†ç»„ï¼Œç”šè‡³æ¯”ç‰¹ï¼‰ä»ç½‘ç»œçš„ä¸€æ®µä¼ é€åˆ°å¦ä¸€ç«¯æ‰€éœ€çš„æ—¶é—´ã€‚</font></p><ul><li>$æ€»æ—¶å»¶=å‘é€æ—¶å»¶+ä¼ æ’­æ—¶å»¶+å¤„ç†æ—¶å»¶+æ’é˜Ÿæ—¶å»¶$</li></ul><ol><li>å‘é€æ—¶å»¶</li></ol><p>ä¸»æœºæˆ–è·¯ç”±å™¨å‘é€æ•°æ®å¸§æ‰€éœ€è¦çš„æ—¶é—´ã€‚(ä»å‘é€æ•°æ®å¸§çš„ç¬¬ä¸€ä¸ªæ¯”ç‰¹ç®—èµ·ï¼Œåˆ°è¯¥å¸§çš„æœ€åä¸€ä¸ªæ¯”ç‰¹å‘é€å®Œæ¯•æ‰€éœ€è¦çš„æ—¶é—´)ã€‚</p><p>$ sendTime=length of data(bit) / velocity(bit/s)$</p><ol start="2"><li>ä¼ æ’­æ—¶å»¶</li></ol><p>ä¿¡é“ä¸­ä¼ è¾“æ—¶é—´ã€‚</p><p>$propagate=length of channel(m) / electromagnetic wave velocity (m/s) $</p><ol start="3"><li>å¤„ç†æ—¶å»¶</li></ol><p>ä¸»æœºæˆ–è·¯ç”±å™¨æ”¶åˆ°åˆ†ç»„ï¼Œåˆ†æåˆ†ç»„çš„é¦–éƒ¨ã€ä»åˆ†ç»„ä¸­æå–æ•°æ®éƒ¨åˆ†ã€è¿›è¡Œå·®é”™æ£€éªŒã€å¯»æ‰¾ä¸‹ä¸€ä¸ªè·¯ç”±å™¨åœ°å€ç­‰ã€‚</p><ol start="4"><li>æ’é˜Ÿæ—¶å»¶</li></ol><p>åˆ†ç»„è¿›å…¥è·¯ç”±å™¨åœ¨è¾“å…¥é˜Ÿåˆ—æ’é˜Ÿï¼Œåœ¨å‘é€åè¾“å‡ºé˜Ÿåˆ—æ’é˜Ÿå‘é€ã€‚</p><p><img src="/2021/03/15/network/OSI%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B.PNG"></p><h3 id="ç½‘ç»œæ€§èƒ½æŒ‡æ ‡"><a href="#ç½‘ç»œæ€§èƒ½æŒ‡æ ‡" class="headerlink" title="ç½‘ç»œæ€§èƒ½æŒ‡æ ‡"></a>ç½‘ç»œæ€§èƒ½æŒ‡æ ‡</h3><ul><li><p>é€Ÿç‡(bit/s)</p><p>1K=$10^3$ M G T P E Z Y</p><p><font color="red">ç”µè„‘ä¸Šæ˜¾ç¤ºçš„MæŒ‡çš„æ˜¯ æŒ‰ç…§å­˜å‚¨æ ¼å¼è®²çš„ï¼Œå­˜å‚¨è®¡ç®—æœº1024bit $k=2^{10}$  K M G T P E Z Y</font></p></li><li><p>å¸¦å®½</p></li></ul><p>é€šä¿¡ä¸Šè®²çš„å¸¦å®½ï¼Œ3.0Ghz ~3.4 Ghz  0.4  æŒ‰ç…§é¢‘ç‡èŒƒå›´ä¸Šè®²çš„ã€‚</p><p>è®¡ç®—æœºç½‘ç»œä¸­ï¼Œå¸¦å®½æŒ‡çš„æ˜¯ä¿¡é“ä¼ è¾“çš„æœ€å¤§é€Ÿç‡ã€‚</p><h3 id="ADSL-Asymmetric-Digital-Subscriber-Line"><a href="#ADSL-Asymmetric-Digital-Subscriber-Line" class="headerlink" title="ADSL (Asymmetric Digital Subscriber Line)"></a>ADSL (Asymmetric Digital Subscriber Line)</h3><p><img src="/2021/03/15/network/adsl.PNG" alt="adsl"></p><h3 id="HFC-Hybrid-Fiber-Coax-å…‰çº¤åŒè½´æ··åˆç½‘"><a href="#HFC-Hybrid-Fiber-Coax-å…‰çº¤åŒè½´æ··åˆç½‘" class="headerlink" title="HFC(Hybrid Fiber Coax)å…‰çº¤åŒè½´æ··åˆç½‘"></a>HFC(Hybrid Fiber Coax)å…‰çº¤åŒè½´æ··åˆç½‘</h3><p><img src="/2021/03/15/network/%E8%B0%83%E5%88%B6%E8%A7%A3%E8%B0%83%E5%99%A8.PNG" alt="è°ƒåˆ¶è§£è°ƒå™¨"></p><h4 id="FTTxæŠ€æœ¯"><a href="#FTTxæŠ€æœ¯" class="headerlink" title="FTTxæŠ€æœ¯"></a>FTTxæŠ€æœ¯</h4><p>å…‰çº¤åˆ°æˆ·(FTTH)</p><h2 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h2><h3 id="1-ç‚¹å¯¹ç‚¹ä¿¡é“"><a href="#1-ç‚¹å¯¹ç‚¹ä¿¡é“" class="headerlink" title="1. ç‚¹å¯¹ç‚¹ä¿¡é“"></a>1. ç‚¹å¯¹ç‚¹ä¿¡é“</h3><p>é“¾è·¯ï¼šä¸€ä¸ªç‚¹åˆ°é‚»è¿‘ç»“ç‚¹çš„ä¸€æ¡ç‰©ç†çº¿è·¯ã€‚æ•°æ®é“¾è·¯æ˜¯é™¤äº†é“¾è·¯ï¼Œè¿˜è¦æœ‰å¿…è¦çš„é€šä¿¡åè®®è¿›è¡Œä¼ è¾“ï¼ŒæŠŠæ‰€æœ‰è¿™äº›åè®®çš„ç¡¬ä»¶å’Œè½¯ä»¶åŠ åˆ°é“¾è·¯ï¼Œå«åšæ•°æ®é“¾è·¯ã€‚</p><ol><li><p>ç»“ç‚¹AæŠŠç½‘ç»œå±‚IPæ•°æ®æŠ¥æ·»åŠ é¦–éƒ¨å’Œå°¾éƒ¨ã€‚</p></li><li><p>ç»“ç‚¹AæŠŠå°è£…å¥½çš„æ•°æ®å‘é€ç»™Bçš„æ•°æ®é“¾è·¯å±‚ã€‚</p></li><li><p>Bå…ˆè¿›è¡Œå·®é”™æ£€éªŒï¼Œæ— é”™æå–IPæ•°æ®æŠ¥ï¼Œå¦åˆ™ä¸¢å¼ƒã€‚</p></li></ol><p>a) <font color="green">å°è£…æˆå¸§</font></p><p>æ·»åŠ é¦–å°¾éƒ¨ã€‚æœ€å¤§ä¼ è¾“æ•°æ®å•å…ƒ(Maximum Transfer Unit,MTU)ï¼Œæ•°æ®éƒ¨åˆ†çš„æœ€å¤§é•¿åº¦ä¸Šé™ã€‚å¸§å®šç•Œç¬¦ å¼€å§‹ SOH (00000001)  ç»“æŸEOT(00000100)ã€‚</p><p>b) <font color="green">é€æ˜ä¼ è¾“</font></p><p>æ•°æ®éƒ¨åˆ†æ˜¯æ–‡æœ¬æ–‡ä»¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œä¸å¯èƒ½å’Œæ§åˆ¶å­—ç¬¦ç›¸åŒï¼Œä»»ä½•å†…å®¹éƒ½å¯ä»¥é€šè¿‡å¸§ä¼ è¿‡å»ï¼Œæ‰€ä»¥æ˜¯é€æ˜ä¼ è¾“ã€‚</p><p>å½“ä¿¡æ¯æ˜¯å›¾ç‰‡æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°æ§åˆ¶ç¬¦ä¸€æ ·çš„äºŒè¿›åˆ¶ä½ã€‚</p><p><img src="/2021/03/15/network/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E9%80%8F%E6%98%8E%E4%BC%A0%E8%BE%93.png"></p><p>è§£å†³åŠæ³•ï¼Œæ’å…¥è½¬ä¹‰å­—ç¬¦ESC(00011011),æ¥æ”¶ç«¯å°†æ•°æ®å‘å¾€ç½‘ç»œå±‚è¦åˆ é™¤æ‰€æœ‰çš„ESCã€‚</p><p><img src="/2021/03/15/network/ESC%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6.png"></p><p>c) <font color="green">å·®é”™æ£€éªŒ</font></p><p>å¾ªç¯å†—ä½™æ£€æµ‹(Cyclic Redundancy Checkï¼ŒCRC)ã€‚å¢åŠ nä½å†—ä½™ç ï¼ˆé™¤ä»¥n+1ä½é™¤æ•°ï¼‰ã€‚</p><p>FCS(Frame Check Sequence)ã€‚</p><p>æ¥æ”¶ç«¯ï¼Œå¦‚æœRï¼ˆä½™æ•°ï¼‰ç®—å‡ºæ¥æ˜¯0ï¼Œåˆ™acceptã€‚å¦åˆ™ï¼Œä¸¢å¼ƒã€‚</p><p>å¢åŠ äº†å¸§ç¼–å·ã€ç¡®è®¤ã€é‡ä¼ æœºåˆ¶ã€‚</p><h3 id="PPP-Point-to-Point-Protocal"><a href="#PPP-Point-to-Point-Protocal" class="headerlink" title="PPP(Point-to-Point Protocal)"></a>PPP(Point-to-Point Protocal)</h3><ol><li><font color="green">åè®®çš„ç»„æˆ</font></li></ol><p>a) å°è£…åˆ°é“¾è·¯çš„æ–¹æ³•ã€‚</p><p>b) <strong>LCPé“¾è·¯æ§åˆ¶åè®®</strong>ï¼Œå»ºç«‹é…ç½®å’Œæµ‹è¯•é“¾è·¯è¿æ¥ã€‚RFC1661å®šä¹‰äº†11ç§ç±»å‹çš„LCPåˆ†ç»„ã€‚</p><p>c) <strong>ç½‘ç»œæ§åˆ¶åè®®NCP</strong>ã€‚å…¶ä¸­çš„æ¯ä¸€ä¸ªåè®®æ”¯æŒä¸åŒçš„ç½‘ç»œå±‚åè®®ï¼Œå¦‚IPã€OSIçš„ç½‘ç»œå±‚ã€‚</p><ol start="2"><li><font color="green">åè®®å¸§çš„æ ¼å¼</font></li></ol><p><img src="/2021/03/15/network/PPP%E5%8D%8F%E8%AE%AE%E5%B8%A7%E7%9A%84%E6%A0%BC%E5%BC%8F.png"></p><p>é¦–éƒ¨4ä¸ªå­—æ®µï¼š7E PPPçš„å®šç•Œç¬¦ã€‚FF 03 è‡³ä»Šæ²¡ç»™å‡ºå®šä¹‰ã€‚åè®® æ˜¯2å­—èŠ‚åè®®å­—æ®µï¼Œ 0x0021æ—¶ï¼ŒPPPçš„ä¿¡æ¯æ˜¯IPæ•°æ®æŠ¥ï¼Œ0xC021ï¼Œæ˜¯PPPåè®®çš„æ§åˆ¶åè®®LCPçš„æ•°æ®ã€‚</p><p>ä¿¡æ¯éƒ¨åˆ†å¯å˜åŒ–ï¼Œæœ€é•¿1500å­—èŠ‚ã€‚</p><p>FCSå†—ä½™ç ã€‚</p><ol start="3"><li><font color="green">é›¶æ¯”ç‰¹å¡«å……</font>ï¼ˆåŒæ­¥ä¼ è¾“ï¼‰</li></ol><p>5ä¸ªè¿ç»­1åé¢æ’å…¥0ã€‚ä»¥æ­¤æ¥ä¿è¯é€æ˜ä¼ è¾“ã€‚</p><p><img src="/2021/03/15/network/%E9%9B%B6%E6%AF%94%E7%89%B9%E5%A1%AB%E5%85%85.png"></p><ol start="4"><li><font color="green">åè®®çš„å·¥ä½œçŠ¶æ€</font></li></ol><p><img src="/2021/03/15/network/PPP%E5%8D%8F%E8%AE%AE%E7%8A%B6%E6%80%81%E5%9B%BE.png"></p><p>PPPåè®®èµ·å§‹å’Œç»ˆæ­¢éƒ½å¤„äºâ€œé“¾è·¯é™æ­¢â€çŠ¶æ€ã€‚ä¹‹åç”¨æˆ·å‘ISPæ‹¨å·ï¼Œä¸ISPå»ºç«‹ç‰©ç†é“¾è·¯ï¼Œç„¶åLCPé“¾è·¯å¼€å§‹è¿›è¡Œåè®®åå•†ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™å¼€å§‹è¿›è¡Œç½‘ç»œå±‚åè®®ï¼ˆNCPï¼‰åå•†ï¼Œå¦‚æœæ˜¯IPåè®®åˆ™æ˜¯IPCPï¼ˆIPæ§åˆ¶åè®®ï¼‰ï¼Œå°†IPCPå°è£…æˆå¸§ã€‚ç½‘ç»œå±‚é…ç½®ç»“æŸï¼Œæ•°æ®é“¾è·¯å¼€å§‹å·¥ä½œï¼ˆé“¾è·¯æ‰“å¼€ï¼‰ã€‚</p><p>å›¾ä¸­å¯ä»¥çœ‹å‡ºPPPåè®®ä¸æ˜¯å•çº¯çš„æ•°æ®é“¾è·¯å±‚åè®®ï¼Œè¿˜åŒ…æ‹¬ç‰©ç†å±‚å†…å®¹å’Œç½‘ç»œå±‚å†…å®¹ã€‚</p><h3 id="2-ä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚ï¼ˆCSMA-CD"><a href="#2-ä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚ï¼ˆCSMA-CD" class="headerlink" title="2.ä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚ï¼ˆCSMA/CD)"></a>2.ä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚ï¼ˆCSMA/CD)</h3><p><img src="/2021/03/15/network/%E5%B1%80%E5%9F%9F%E7%BD%91%E6%8B%93%E6%89%91.png"></p><p><font color="green">1. å…±äº«ä¿¡é“çš„ä¸¤ç§åˆ’åˆ†æ–¹æ³•</font></p><p>a) é™æ€åˆ’åˆ†ä¿¡é“</p><p>é¢‘åˆ†å¤ç”¨ã€æ—¶åˆ†å¤ç”¨ã€ç åˆ†å¤ç”¨å’Œæ³¢åˆ†å¤ç”¨ç­‰ã€‚å¼€é”€è¾ƒå¤§ã€‚</p><p>b) åŠ¨æ€åª’ä½“æ¥å…¥æ§åˆ¶</p><ul><li>éšæœºæ¥å…¥</li></ul><p>ç”¨æˆ·æ ¹æ®è‡ªå·±çš„æƒ…å†µéšæœºå‘é€ä¿¡æ¯ï¼Œå¯èƒ½äº§ç”Ÿç¢°æ’ï¼Œéœ€è¦ç¢°æ’åè®®ã€‚</p><ul><li>å—æ§æ¥å…¥</li></ul><p>ä¸èƒ½éšæœºå‘é€ï¼Œæ¯”å¦‚ä»¤ç‰Œç¯å±€åŸŸç½‘å’ŒåŠé›†ä¸­æ§åˆ¶çš„è½®è¯¢å’Œå¤šç‚¹çº¿è·¯æ¢è¯¢ã€‚</p><p><font color="green">2. ä»¥å¤ªç½‘çš„ä¸¤ä¸ªæ ‡å‡†</font></p><p>IEEE 802å§”å‘˜ä¼šæå‡ºå°†æ•°æ®é“¾è·¯å±‚åˆ’åˆ†ä¸º <strong>é€»è¾‘é“¾è·¯æ§åˆ¶LLC</strong>ï¼ˆLogic Link Control) å’Œ <strong>åª’ä½“æ¥å…¥æ§åˆ¶å±‚MAC</strong>(Media Access Control)ã€‚</p><p><img src="/2021/03/15/network/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E5%88%92%E5%88%86.png"></p><p>LLCä¸ä¼ è¾“åª’ä½“æ— å…³ï¼ŒMACå¤„ç†ä¼ è¾“åª’ä½“æœ‰å…³çš„å†…å®¹ã€‚</p><p>ä¹‹åå› ä¸ºä»¥å¤ªç½‘çš„å‘å±•ï¼Œå±€åŸŸç½‘æŠ€æœ¯æ²¡è½ï¼Œç›®å‰å¤§éƒ¨åˆ†å‚å•†åªMACåè®®ï¼ŒLLCä½œç”¨å·²ç»æ¶ˆå¤±ã€‚</p><p><font color="green">3. é€‚é…å™¨çš„ä½œç”¨</font></p><p>è®¡ç®—æœºå’Œå¤–ç•Œå±€åŸŸç½‘è¿æ¥éœ€è¦<strong>é€‚é…å™¨</strong>ã€‚é€‚é…å™¨å’Œè®¡ç®—æœºä¹‹é—´é€šè¿‡IOæ€»çº¿ä¼ è¾“ä¿¡æ¯ï¼Œé€‚é…å™¨å’Œå±€åŸŸç½‘é€šè¿‡åŒç»çº¿å’Œç”µç¼†ä¼ è¾“ä¿¡æ¯ã€‚</p><p>é€‚é…å™¨åŠŸèƒ½ä¸å±€é™äºæ•°æ®é“¾è·¯å±‚ï¼Œé€‚é…å™¨åœ¨æ¥å‘å„ç§å¸§æ—¶ä¸ä½¿ç”¨CPUï¼Œå½“å¸§åˆ¤æ–­å¯ç”¨æ—¶ï¼Œæ‰ä¼šå‘å‡ºä¸­æ–­ä¿¡æ¯é€šçŸ¥è®¡ç®—æœºï¼Œå¹¶äº¤ä»˜åè®®æ ˆä¸­çš„ç½‘ç»œå±‚ã€‚</p><p><font color="green">4.CSMA/CDåè®®</font>(Carrier Sense Multiple Access with Collision Detection)<strong>è½½æ³¢ç›‘å¬å¤šç‚¹æ¥å…¥/ç¢°æ’</strong></p><p>ä»¥å¤ªç½‘å‘é€æ•°æ®éƒ½æ˜¯ç”¨ <strong>æ›¼å½»æ–¯ç‰¹ç¼–ç </strong>ã€‚å˜åŒ–é¢‘ç‡å˜åŒ–äº†ä¸€å€ï¼Œæ‰€ä»¥é¢‘ç‡å¼€é”€å¢å¤§ã€‚</p><p><img src="/2021/03/15/network/%E6%9B%BC%E5%BD%BB%E6%96%AF%E7%89%B9%E7%BC%96%E7%A0%81.png"></p><ul><li>å¤šç‚¹æ¥å…¥ï¼šå¤šä¸ªè®¡ç®—æœºåŒæ—¶è¿æ¥åœ¨ä¸€æ ¹æ€»çº¿ä¸Šã€‚</li><li>è½½æ³¢ç›‘å¬ï¼šä½¿ç”¨ç”µå­æŠ€æœ¯æ£€æµ‹æ€»çº¿ä¸Šæœ‰æ²¡æœ‰å…¶ä»–è®¡ç®—æœºåœ¨å‘é€æ•°æ®ã€‚è½½æ³¢åªæ˜¯åè¯ï¼Œå°±æ˜¯æ£€æµ‹ä¿¡é“ï¼Œæ£€æµ‹å…¶ä»–è®¡ç®—æœºå‘æ²¡å‘ä¿¡æ¯ã€‚</li><li>ç¢°æ’æ£€æµ‹ï¼ˆå†²çªæ£€æµ‹ï¼‰ï¼šè¾¹å‘é€è¾¹ç›‘å¬ï¼Œé€‚é…å™¨è¾¹å‘é€è¾¹æ£€æµ‹ä¿¡é“ä¸Šçš„ä¿¡å·ç”µå‹ä¿¡å·ï¼Œä»¥ä¾¿äºå‘é€æ•°æ®æ—¶ç›‘å¬å…¶ä»–è®¡ç®—æœºå‘æ²¡å‘æ•°æ®ã€‚å½“ä¸¤ä¸ªè®¡ç®—æœºåŒæ—¶å‘é€æ•°æ®ï¼Œåˆ™ç¢°æ’ï¼Œéšæœºç­‰å¾…ä¸€æ®µæ—¶é—´å†å‘é€ã€‚</li><li><strong>ç”µç£æ³¢åœ¨1kmçš„ç”µç¼†ä¼ æ’­æ—¶å»¶æ˜¯5usã€‚</strong></li><li>å‘é€æ•°æ®æ€»æœ‰ä¼ æ’­æ—¶å»¶ï¼Œå½“ä¼ æ’­æ—¶å»¶å†…å¦ä¸€ä¸ªè®¡ç®—æœºå‘äº†æ•°æ®ï¼Œåˆ™ç¢°æ’ã€‚æ‰€ä»¥ä¸€ä¸ªè®¡ç®—æœºæœ€å¤šæ¶ˆè€—**ä¸¤å€$2\tau$**çš„æ€»çº¿åˆ°ç«¯çš„ä¼ æ’­æ—¶å»¶ã€‚</li></ul><p><img src="/2021/03/15/network/%E4%BC%A0%E6%92%AD%E6%97%B6%E5%BB%B6%E5%AF%B9%E8%BD%BD%E6%B3%A2%E7%9B%91%E5%90%AC%E7%9A%84%E5%BD%B1%E5%93%8D.png"></p><p>å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªè®¡ç®—æœºåªèƒ½åŠåŒå·¥é€šä¿¡ï¼Œå›¾ä¸­çœ‹å‡ºæ¯æ¬¡è®¡ç®—æœºå‘é€ä¿¡å·éƒ½ä¸ç¡®å®šæ˜¯å¦ä¼šç¢°æ’ï¼Œ$2\tau$æ—¶å»¶å°±æ˜¯<strong>ç¢°æ’çª—å£</strong>ï¼ˆäº‰ç”¨æœŸï¼‰ã€‚</p><ul><li><strong>æˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿</strong>(truncated binary exponential backoff)</li></ul><ol><li>$2\tau$åè®®è§„å®šä¸º51.2usã€‚å¯¹äº10Mbit/sä»¥å¤ªç½‘ï¼Œå‘é€512bitã€‚æ‰€ä»¥ç¢°æ’çª—å£æœŸæ˜¯å‘é€512bitæ—¶é—´ã€‚</li><li>$k=min[é‡ä¼ æ¬¡æ•°â€¦10]$ ä»ç¦»æ•£æ•´æ•°é›†åˆ$[0,1,â€¦,(2^k-1)]$ é€‰å–æ•´æ•°å³ä¸ºé‡ä¼ æ¬¡æ•°ï¼Œå¿…é¡»å°äº10ã€‚</li><li>é‡ä¼ å¤§äº16æ¬¡ï¼Œä¸¢å¼ƒå¸§ï¼Œå‘é«˜å±‚æŠ¥å‘Šã€‚</li></ol><ul><li>å¼ºåŒ–ç¢°æ’</li></ul><p>å½“å‘é€æ•°æ®åï¼Œè¿˜è¦ç»§ç»­å‘é€32æˆ–48bitäººä¸ºå¹²æ‰°ä¿¡å·ï¼Œè®©æ‰€æœ‰ç”¨æˆ·éƒ½çŸ¥é“å·²ç»å‘ç”Ÿäº†ç¢°æ’ã€‚</p><p><img src="/2021/03/15/network/%E4%BA%BA%E4%B8%BA%E5%B9%B2%E6%89%B0%E4%BF%A1%E5%8F%B7.png"></p><ul><li>è®¾å®šå¸§é—´æœ€å°é—´éš”9.6us.ç»™æ¥æ”¶æ–¹96bitæ—¶é—´åšå‡†å¤‡å¤„ç†ä¸‹ä¸€æ¬¡æ•°æ®ã€‚</li></ul><p><img src="/2021/03/15/network/CSMA%E5%8D%8F%E8%AE%AE%E8%A6%81%E7%82%B9.png"></p><ul><li>é›†çº¿å™¨ å±€åŸŸç½‘æ˜Ÿå‹æ‹“æ‰‘ï¼Œå¯é æ€§å¾ˆå¥½ï¼Œä½¿ç”¨åŒç»çº¿è¿æ¥ï¼Œå‡ºç°802.3i 10BASE-Tæ ‡å‡†ã€‚10ä»£è¡¨10Mbit/sæ•°æ®ã€‚</li></ul><p>å®é™…ä¸Šè¿˜æ˜¯æŠ½è±¡æˆæ€»çº¿å½¢å¼ï¼Œæ‰€ä»¥æ¯ä¸ªæ—¶é—´åªå…è®¸ä¸€ä¸ªç«™å‘é€æ•°æ®ã€‚</p><p><strong>é›†çº¿å™¨å·¥ä½œåœ¨ç‰©ç†å±‚</strong>ï¼Œæ¯ä¸ªç«¯å£ä»…ä»…è½¬å‘ä¿¡å·ã€‚</p><h3 id="3-ä¿¡é“åˆ©ç”¨ç‡"><a href="#3-ä¿¡é“åˆ©ç”¨ç‡" class="headerlink" title="3. ä¿¡é“åˆ©ç”¨ç‡"></a>3. ä¿¡é“åˆ©ç”¨ç‡</h3><h3 id="4-mac-åœ°å€"><a href="#4-mac-åœ°å€" class="headerlink" title="4.mac åœ°å€"></a>4.mac åœ°å€</h3><p>æ¯ä¸€ä¸ªé€‚é…å™¨éƒ½æœ‰ä¸€ä¸ªMACåœ°å€ã€‚å›ºåŒ–åœ¨é€‚é…å™¨ROMä¸­çš„åœ°å€ã€‚</p><p>MACçš„æ ¼å¼ï¼š</p><p><img src="/2021/03/15/network/MAC%E5%9C%B0%E5%9D%80.png"></p><p>å‰ä¸¤ä¸ªå­—æ®µæ˜¯ç›®çš„åœ°å€å’Œæºåœ°å€ï¼Œåˆ†åˆ«å 6ä¸ªå­—èŠ‚ã€‚ç¬¬ä¸‰ä¸ªå­—æ®µæ˜¯ç±»å‹ï¼Œè¡¨æ˜æ•°æ®éƒ¨åˆ†ä½¿ç”¨çš„åè®®æ˜¯ä»€ä¹ˆã€‚æœ€åæ˜¯å†—ä½™ç (fcs crc)ã€‚</p><p>æ•°æ®éƒ¨åˆ†æœ€å°é•¿åº¦46ï¼Œä¸æ»¡46å°±å¡«å……å¤Ÿ46ã€‚</p><p>MACå¸§å‰è¿˜æœ‰8ä¸ªå­—èŠ‚ï¼Œå‰7å­—èŠ‚æ˜¯ä¸ºäº†åŒæ­¥æ—¶é’Ÿé¢‘ç‡ï¼Œæœ€åä¸€ä¸ªå¸§å¼€å§‹ç•Œå®šç¬¦ã€‚</p><h3 id="5-æ‰©å±•ä»¥å¤ªç½‘"><a href="#5-æ‰©å±•ä»¥å¤ªç½‘" class="headerlink" title="5. æ‰©å±•ä»¥å¤ªç½‘"></a>5. æ‰©å±•ä»¥å¤ªç½‘</h3><ol><li>ç‰©ç†å±‚æ‰©å±•</li></ol><p>å¢åŠ è§£è°ƒå™¨æ‰©å¤§ç‰©ç†é“¾è·¯äº¤æµåŒºåŸŸã€‚</p><p><img src="/2021/03/15/network/%E6%89%A9%E5%B1%95%E4%BB%A5%E5%A4%AA%E7%BD%91%E7%89%A9%E7%90%86%E5%B1%82.png"></p><ol start="2"><li>æ•°æ®é“¾è·¯å±‚æ‰©å±•</li></ol><p>äº¤æ¢å¼é›†çº¿å™¨ç§°ä¸ºä»¥å¤ªç½‘äº¤æ¢æœºæˆ–è€…ç¬¬äºŒå±‚äº¤æ¢æœºã€‚å®è´¨ä¸Šæ˜¯å¤šæ¥å£çš„ç½‘æ¡¥ã€‚å…¶å†…éƒ¨é€šè¿‡è‡ªå­¦ä¹ ç®—æ³•å­˜å‚¨å¸§äº¤æ¢è¡¨ã€‚</p><p>ç‹¬å ä¼ è¾“åª’ä½“ï¼Œæ— ç¢°æ’åœ°ä¼ è¾“æ•°æ®ã€‚</p><p>ç”Ÿæˆæ ‘åè®®STPï¼Œä¸æ”¹å˜ç½‘ç»œæ‹“æ‰‘ï¼Œé€»è¾‘ä¸Šæ²¡æœ‰é—­ç¯ï¼Œé˜²æ­¢å…œåœˆå­é—®é¢˜ã€‚</p><ol start="3"><li>è™šæ‹Ÿå±€åŸŸç½‘VLAN</li></ol><p><img src="/2021/03/15/network/%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91VLAN.png"></p><p>å¯ä»¥é˜²æ­¢å¹¿æ’­é£æš´ï¼ŒA1å‘é€ä¿¡æ¯åªæœ‰Aç»„èƒ½å¤Ÿçœ‹åˆ°ã€‚</p><p>å¸§æ ¼å¼ï¼š</p><p><img src="/2021/03/15/network/VLAN%E5%B8%A7%E6%A0%BC%E5%BC%8F.png"></p><p>åœ¨MACå¸§ä¸­æ’å…¥4å­—èŠ‚VLANæ ‡è®°ï¼Œæºåœ°å€åä¸¤ä½å¦‚æœæ˜¯0x8100æ—¶ï¼Œè¡¨æ˜åé¢åŠ äº†VLANã€‚æºåœ°å€çš„æœ€åä¸¤ä¸ªå­—èŠ‚ä¸­ï¼Œå‰3ä½æ˜¯ç”¨æˆ·ä¼˜å…ˆçº§å­—æ®µï¼Œæ¥ç€ä¸€ä½æ˜¯è§„èŒƒæ ¼å¼ç¬¦CFIï¼Œæœ€å12ä½æ˜¯è™šæ‹Ÿå±€åŸŸç½‘VLANæ ‡è¯†ç¬¦VIDï¼Œå®ƒæ ‡è®°äº†è¿™ä¸ªä»¥å¤ªç½‘å¸§å±äºå“ªä¸ªè™šæ‹Ÿå±€åŸŸç½‘ã€‚</p><h2 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h2><p>ç½‘ç»œå±‚åªæä¾›å°½æœ€å¤§åŠªåŠ›äº¤ä»˜æœåŠ¡ï¼Œå¯ä»¥å‡å°‘è·¯ç”±å™¨ä»·æ ¼æˆæœ¬ç­‰ï¼Œå› ä¸ºè®¡ç®—æœºæœ¬èº«å…·æœ‰å¾ˆå¼ºçš„è®¡ç®—èƒ½åŠ›ï¼Œå·®é”™æ£€éªŒèƒ½åŠ›å¾ˆå¼ºã€‚</p><h4 id="1-ç½‘ç»œåè®®IP"><a href="#1-ç½‘ç»œåè®®IP" class="headerlink" title="1.ç½‘ç»œåè®®IP"></a>1.ç½‘ç»œåè®®IP</h4><p>ä¸€èˆ¬æŒ‡çš„æ˜¯ç¬¬å››ä¸ªç‰ˆæœ¬IPv4ã€‚ä¸€èˆ¬å’Œ<strong>åœ°å€è§£æåè®®</strong>(Address Resolution Protocol,ARP)ã€<strong>ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP</strong>(Internet Control Message Protocol)ã€<strong>ç½‘é™…ç»„ç®¡ç†åè®®IGMP</strong>ï¼ˆInternet Group Management Protocolï¼‰ã€‚</p><p><img src="/2021/03/15/network/IP%E5%8F%8A%E5%85%B6%E9%85%8D%E5%A5%97%E5%8D%8F%E8%AE%AE.png"></p><p>2.ç½‘ç»œäº’è¿çš„ä¸­é—´è®¾å¤‡</p><ol><li><p>ç‰©ç†å±‚ä½¿ç”¨çš„ä¸­é—´è®¾å¤‡æ˜¯<strong>è½¬å‘å™¨</strong>ã€‚</p></li><li><p>æ•°æ®é“¾è·¯å±‚ä½¿ç”¨çš„ä¸­é—´è®¾å¤‡æ˜¯<strong>ç½‘æ¡¥æˆ–æ¡¥æ¥å™¨</strong>ã€‚</p></li><li><p>ç½‘ç»œå±‚ä½¿ç”¨çš„ä¸­é—´è®¾å¤‡æ˜¯<strong>è·¯ç”±å™¨</strong>ã€‚</p></li><li><p>ç½‘ç»œå±‚ä»¥ä¸Šä½¿ç”¨çš„ä¸­é—´è®¾å¤‡å«<strong>ç½‘å…³</strong>ã€‚ç½‘å…³è¿æ¥ä¸¤ä¸ªä¸å…¼å®¹çš„ç³»ç»Ÿéœ€è¦åœ¨é«˜å±‚è¿›è¡Œåè®®è½¬æ¢.</p><p>3.è™šæ‹Ÿäº’è”ç½‘ç»œ</p></li></ol><p>ç”±äºä¸åŒçš„è®¡ç®—æœºç½‘ç»œä½¿ç”¨ç›¸åŒçš„IPåè®®ã€‚å› æ­¤å¯ä»¥çœ‹åšè™šæ‹Ÿäº’è¿ç½‘ç»œ</p><p><strong>ç›´æ¥äº¤ä»˜</strong>ç›®çš„ä¸»æœºåœ¨æœ¬ç½‘ç»œä¸­ä¸éœ€è¦å…¶ä»–è·¯ç”±å™¨è½¬å‘ã€‚</p><p><strong>é—´æ¥äº¤ä»˜</strong>ç›®çš„ä¸»æœºä¸åœ¨æœ¬ç½‘ç»œã€‚</p><h4 id="2-åˆ†ç±»çš„IPåœ°å€"><a href="#2-åˆ†ç±»çš„IPåœ°å€" class="headerlink" title="2.åˆ†ç±»çš„IPåœ°å€"></a>2.åˆ†ç±»çš„IPåœ°å€</h4><p>IPåœ°å€å°±æ˜¯äº’è”ç½‘ä¸Šæ¯ä¸€å°ä¸»æœºçš„æ¯ä¸€ä¸ªæ¥å£åˆ†é…ä¸€ä¸ªåœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…å”¯ä¸€çš„32ä½æ ‡è¯†ç¬¦ã€‚IPåœ°å€ç°åœ¨ç”±<strong>äº’è”ç½‘åå­—å’Œæ•°å­—åˆ†é…æœºæ„ICANN</strong>ï¼ˆInternet Corporation for Assigned Names and Numbers)è¿›è¡Œåˆ†é…ã€‚</p><p>IPåœ°å€çš„<strong>ç¬¬ä¸€ä¸ªå­—æ®µ</strong>æ˜¯ç½‘ç»œå·ï¼Œæ ‡å¿—ä¸»æœºæ‰€è¿æ¥åˆ°çš„ç½‘ç»œã€‚ä¸€ä¸ªç½‘ç»œå·åœ¨æ•´ä¸ªäº’è”ç½‘èŒƒå›´å†…æ˜¯å”¯ä¸€çš„ã€‚<strong>ç¬¬äºŒä¸ªå­—æ®µ</strong>æ˜¯ä¸»æœºå·ï¼Œå®ƒæ ‡å¿—è¯¥ä¸»æœº</p><p><img src="/2021/03/15/network/IP%E7%BD%91%E7%BB%9C%E5%8F%B7%E5%AD%97%E6%AE%B5.png"></p><p>$ IPåœ°å€ :: = {&lt;ç½‘ç»œå·&gt;,&lt;ä¸»æœºå·&gt;}$</p><ul><li>Aç±»ã€Bç±»å’ŒCç±»ç½‘ç»œå·å­—æ®µæ•°åˆ†åˆ«æ˜¯1ã€2å’Œ3.ç½‘ç»œå·å­—æ®µçš„æœ€å‰é¢æœ‰1-3ä½æ˜¯ç±»åˆ«ä½ï¼Œæ•°å€¼åˆ†åˆ«æ˜¯0,10ï¼Œ110ã€‚</li><li>Aç±»ã€Bç±»å’ŒCç±»åœ°å€çš„ä¸»æœºå·åˆ†åˆ«ä¸º3ã€2å’Œ1ã€‚</li><li>Dç±»åœ°å€ç”¨äºå¤šæ’­ã€‚</li><li>Eç±»åœ°å€ä¿ç•™ä¸ºä»¥åä½¿ç”¨ã€‚</li></ul><h4 id="3-å¸¸ç”¨çš„3ç±»åœ°å€"><a href="#3-å¸¸ç”¨çš„3ç±»åœ°å€" class="headerlink" title="3.å¸¸ç”¨çš„3ç±»åœ°å€"></a>3.å¸¸ç”¨çš„3ç±»åœ°å€</h4><ul><li>Aç±» ä¸»æœºå·å 3ä¸ªå­—èŠ‚ï¼Œå› æ­¤æ¯ä¸ªAç±»ç½‘ç»œæœ€å¤§ä¸»æœºæ•°æ˜¯$2^{24}-2$ã€‚å…¨0ä¸»æœºå·å­—æ®µè¡¨ç¤ºâ€œè¿™ä¸ªâ€ï¼Œä¿ç•™åœ°å€æ„æ€æ˜¯â€œæœ¬ç½‘ç»œâ€ï¼Œä¾‹å¦‚æŸä¸»æœºIP5.6.7.8é‚£ä¹ˆå…¶æœ¬åœ°ç½‘ç»œå°±æ˜¯5.0.0.0ã€‚å…¨1è¡¨ç¤ºç½‘ç»œä¸Šæ‰€æœ‰çš„ä¸»æœºã€‚Aç±»å…±æœ‰$2^{31}$ä¸ªåœ°å€ã€‚</li><li>Bç±» ä¸¤ä¸ªå­—èŠ‚ï¼Œå‰é¢ä¸¤ä½å›ºå®šï¼Œå‰©ä¸‹14ä½åˆ†é…ç½‘ç»œå·ã€‚14ä½ä¸å¯èƒ½å…¨0å’Œå…¨1ã€‚<strong>æ‰€ä»¥ä¸éœ€è¦å‡2</strong>ã€‚ä½†æ˜¯<strong>128.0.0.0</strong>æ˜¯ä¸æŒ‡æ´¾çš„ï¼ŒBç±»æœ€å°ç½‘è·¯åœ°å€æ˜¯<strong>128.1.0.0</strong>ã€‚æ‰€ä»¥ç½‘ç»œæ•°æ˜¯$2^{14}-1$ã€‚Bç±»å…±$2^{30}$åœ°å€ã€‚</li><li>Cç±» ä¸‰ä¸ªå­—èŠ‚ç½‘ç»œå·ï¼Œ110ã€‚ç½‘ç»œå·è¿˜æœ‰21ä½å¯ä»¥åˆ†é…ã€‚<strong>192.0.0.0</strong>ä¸æŒ‡æ´¾ï¼ŒCç±»<strong>192.0.0.0</strong>ä¸æŒ‡æ´¾ï¼Œå¯ä»¥ä½¿ç”¨çš„æœ€å°ç½‘ç»œåœ°å€æ˜¯<strong>192.0.1.0</strong>ã€‚è¿™æ ·Cç±»åœ°å€å¯ä»¥æŒ‡æ´¾çš„ç½‘ç»œæ€»æ•°æ˜¯$2^{21}-1$ã€‚å…±$2^{29}$åœ°å€ã€‚</li></ul><p><img src="/2021/03/15/network/IP%E5%88%86%E9%85%8D%E8%8C%83%E5%9B%B4.png"></p><h4 id="4-IPåœ°å€å’Œç¡¬ä»¶åœ°å€"><a href="#4-IPåœ°å€å’Œç¡¬ä»¶åœ°å€" class="headerlink" title="4.IPåœ°å€å’Œç¡¬ä»¶åœ°å€"></a>4.IPåœ°å€å’Œç¡¬ä»¶åœ°å€</h4><p><img src="/2021/03/15/network/ip%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%A1%AC%E4%BB%B6%E5%9C%B0%E5%9D%80.png"></p><p>æ•°æ®ä»é«˜å±‚å‘åº•å±‚ä¼ è¾“ã€‚ç½‘ç»œå±‚å’Œç½‘ç»œå±‚ä»¥ä¸Šä½¿ç”¨IPåœ°å€ï¼Œæ•°æ®é“¾è·¯å±‚åŠå…¶ä»¥ä¸‹çš„ä½¿ç”¨ç¡¬ä»¶åœ°å€ã€‚</p><p><img src="/2021/03/15/network/%E4%B8%8D%E5%90%8C%E5%B1%82%E6%AC%A1%E7%9A%84%E5%9C%B0%E5%9D%801.png"></p><p><img src="/2021/03/15/network/%E4%B8%8D%E5%90%8C%E5%B1%82%E6%AC%A1%E7%9A%84%E5%9C%B0%E5%9D%80.png"></p><ol><li>è·¯ç”±å™¨åªæ ¹æ®ç›®çš„ç«™çš„IPåœ°å€çš„ç½‘ç»œå·è¿›è¡Œé€‰æ‹©ã€‚</li><li>å±€åŸŸç½‘é“¾è·¯å±‚åªçœ‹åˆ°MACå¸§ã€‚IPæ•°æ®æŠ¥è¢«å°è£…åœ¨MACå¸§ä¸­ï¼ŒMACå¸§åœ¨ä¸åŒç½‘ç»œä¸Šä¼ é€æ—¶ï¼Œå…¶MACå¸§é¦–éƒ¨ä¸­çš„æºåœ°å€å’Œç›®çš„åœ°å€å‘ç”Ÿå˜åŒ–ã€‚å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒMACä»H1åˆ°R1ä¼ é€ï¼Œæºåœ°å€å’Œç›®çš„åœ°å€æ˜¯HA1å’ŒHA3ï¼ŒR1æ”¶åˆ°å¸§åï¼Œé‡æ–°æ·»åŠ æºåœ°å€å’Œç›®çš„åœ°å€HA4å’ŒHA4ã€‚</li></ol><h4 id="5-åœ°å€è§£æåè®®ARP"><a href="#5-åœ°å€è§£æåè®®ARP" class="headerlink" title="5.åœ°å€è§£æåè®®ARP"></a>5.åœ°å€è§£æåè®®ARP</h4><p><strong>çŸ¥é“äº†IPåœ°å€ï¼Œå¦‚ä½•æ‰¾åˆ°å…¶å¯¹åº”çš„MACåœ°å€å‘¢ï¼Ÿ</strong></p><p><img src="/2021/03/15/network/ARP%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%BD%9C%E7%94%A8.png"></p><p>è¿˜æœ‰ä¸€ä¸ªRARPé€†åœ°å€è§£æåè®®ï¼Œç°åœ¨çš„DHCPåè®®åŒ…å«äº†RARPï¼Œä¸éœ€è¦å†è®²ã€‚</p><ul><li><strong>ARPè§£å†³</strong>è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯åœ¨ä¸»æœºARPé«˜é€Ÿç¼“å­˜ä¸­å­˜æ”¾ä¸€ä¸ªä»<strong>IPåœ°å€åˆ°ç¡¬ä»¶åœ°å€çš„æ˜ å°„è¡¨</strong>ï¼Œå¹¶ä¸”è¿™ä¸ªæ˜ å°„è¡¨è¿˜ç»å¸¸åŠ¨æ€æ›´æ–°ï¼ˆæ–°å¢æˆ–è¶…æ—¶åˆ é™¤ï¼‰ã€‚</li></ul><p>Aå‘Bå‘æ•°æ®æŠ¥ï¼Œå…ˆåœ¨ARPé«˜é€Ÿç¼“å­˜ä¸­æŸ¥çœ‹Bçš„IPåœ°å€ï¼Œå¦‚æœæœ‰å†æ‰¾ARPæ˜ å°„è¡¨ï¼Œæ‰¾åˆ°ç¡¬ä»¶åœ°å€å°±æ”¾åˆ°MACå¸§ä¸­ã€‚å¦‚æœBåˆšåˆšåŠ å…¥ç½‘ç»œï¼Œæ‰¾ä¸åˆ°Bç¡¬ä»¶åœ°å€ï¼Œåˆ™ï¼š</p><p><img src="/2021/03/15/network/ARP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png"></p><ul><li>ARPæ‰¾ç¡¬ä»¶åœ°å€æ­¥éª¤ï¼š</li></ul><ol><li>Aå‘é€ARPè¯·æ±‚å¹¿æ’­ã€‚</li><li>ç½‘ç»œä¸Šæ‰€æœ‰ä¸»æœºæ”¶åˆ°å¹¿æ’­ä¿¡æ¯ã€‚</li><li>Bæ”¶åˆ°è¯·æ±‚ï¼Œå‘Aå‘é€è‡ªå·±åœ°å€ã€‚ï¼ˆBå¯ä»¥æ”¶åˆ°Açš„æ‰€æœ‰ARPç¼“å­˜ä¿¡æ¯ï¼Œæ–¹ä¾¿ä»¥åå’Œæœ¬ç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰ä¸­æ‰€æœ‰ä¸»æœºé€šä¿¡ï¼‰ã€‚</li><li>Aæ”¶åˆ°Båœ°å€æ›´æ–°ARPé«˜é€Ÿç¼“å­˜ã€‚</li></ol><ul><li><strong>ç”Ÿå­˜æ—¶é—´</strong>ï¼š10~20minã€‚è¶…æ—¶å°±å‰”é™¤é‚£ä¸ªç¡¬ä»¶åœ°å€ã€‚ï¼ˆé˜²æ­¢æŸä¸ªæ—¶åˆ»Bçš„ç¡¬ä»¶æ›´æ¢å¯¼è‡´ç¡¬ä»¶åœ°å€å˜åŒ–ï¼‰ã€‚</li><li><strong>å®é™…æ˜¯æŒ‰ç…§ç¡¬ä»¶åœ°å€é€šä¿¡çš„</strong>ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦æœ‰IPå‘¢ï¼Ÿ</li></ul><p>å…¨ä¸–ç•Œä¸åŒç½‘ç»œä½¿ç”¨ä¸åŒçš„ç¡¬ä»¶åœ°å€ï¼Œè¿™äº›ç½‘ç»œäº’ç›¸é€šä¿¡å°±å¿…é¡»åšç¡¬ä»¶åœ°å€è½¬æ¢å·¥ä½œï¼Œä¼šä½¿ç½‘ç»œååˆ†å¤æ‚ã€‚IPå°±å±è”½äº†è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="6-IPæ•°æ®æŠ¥æ ¼å¼"><a href="#6-IPæ•°æ®æŠ¥æ ¼å¼" class="headerlink" title="6.IPæ•°æ®æŠ¥æ ¼å¼"></a>6.IPæ•°æ®æŠ¥æ ¼å¼</h4><p>TCP/IPä¸­å„ç§æ•°æ®æ ¼å¼å¸¸å¸¸ä»¥32ä½ï¼ˆ4å­—èŠ‚ï¼‰æè¿°ã€‚</p><p><img src="/2021/03/15/network/IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.png"></p><ol><li>é¦–éƒ¨ã€‚</li></ol><p>5ä¸ª4å­—èŠ‚æè¿°ï¼ˆå…±20å­—èŠ‚ï¼Œæ¯ä¸ª4*8=32ä½ï¼‰ã€‚</p><ul><li><strong>ç‰ˆæœ¬</strong> 4ä½ï¼ŒIPåè®®çš„ç‰ˆæœ¬ï¼ŒåŒæ–¹é€šä¿¡çš„IPç‰ˆæœ¬å¿…é¡»ä¸€è‡´ã€‚</li><li><strong>é¦–éƒ¨é•¿åº¦</strong> 4ä½ï¼Œå¯è¡¨ç¤ºæœ€å¤§åè¿›åˆ¶æ•°æ˜¯15ã€‚ä¸€èˆ¬æ˜¯0101ï¼ˆ5,5*4=20ï¼‰ï¼Œå½“é¦–éƒ¨é•¿åº¦ä¸ºæœ€å¤§å€¼1111ï¼Œåˆ™60å­—èŠ‚ï¼ˆ15*4ï¼‰ã€‚</li><li><strong>åŒºåˆ†æœåŠ¡</strong> å 8ä½ï¼Œç”¨æ¥è·å¾—æ›´å¥½çš„æœåŠ¡ã€‚è¿™ä¸ªå­—æ®µåœ¨æ—§çš„æ ‡å‡†å«åšæœåŠ¡ç±»å‹ã€‚å®é™…ä¸€ç›´æ²¡ç”¨è¿‡ã€‚</li><li><strong>æ€»é•¿åº¦</strong> æ€»é•¿åº¦æŒ‡é¦–éƒ¨å’Œæ•°æ®ä¹‹å’Œçš„é•¿åº¦ï¼Œå•ä½ä¸ºå­—èŠ‚ã€‚æ€»é•¿åº¦ä¸º16ä½ï¼Œæ•°æ®æŠ¥æœ€å¤§é•¿åº¦ä¸º$2^{16}-1$å­—èŠ‚ã€‚<strong>MTU</strong>(Maximum Transfer Unit)ã€‚å½“ä¸€ä¸ªIPæ•°æ®æŠ¥å°è£…æˆé“¾è·¯å±‚çš„å¸§æ—¶ï¼Œæ­¤æ•°æ®æŠ¥çš„æ€»é•¿åº¦ä¸€å®šä¸èƒ½è¶…è¿‡ä¸‹é¢æ•°æ®é“¾è·¯å±‚è§„å®šçš„MTUå€¼ã€‚å½“è¶…è¿‡å°±è¦åˆ†ç‰‡ã€‚</li><li><strong>æ ‡è¯†</strong> å 16ä½ï¼ŒIPè½¯ä»¶æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œäº§ç”Ÿä¸€ä¸ªæ•°æ®æŠ¥è®¡æ•°å™¨åŠ 1ï¼Œèµ‹ç»™æ ‡è¯†å­—æ®µï¼Œè§£å†³IPæ•°æ®æŠ¥ä¸æ˜¯æŒ‰åºæ¥æ”¶çš„é—®é¢˜ã€‚</li><li><strong>æ ‡å¿—</strong> å 3ä½ï¼Œç›®å‰åªæœ‰ä¸¤ä½æœ‰æ„ä¹‰ã€‚æœ€ä½ä½MF=1ï¼Œè¡¨ç¤ºåé¢è¿˜æœ‰åˆ†ç‰‡ï¼ŒMF=0è¡¨ç¤ºæœ€åæ•°æ®åˆ†ç‰‡ä¸­æœ€åä¸€ä¸ªã€‚ä¸­é—´ä¸€ä½DF=1è¡¨ç¤ºä¸èƒ½åˆ†ç‰‡ï¼ŒDF=0å…è®¸åˆ†ç‰‡ã€‚</li><li><strong>ç‰‡åç§»</strong> å 13ä½ã€‚è¾ƒé•¿çš„åˆ†ç»„åœ¨åˆ†ç‰‡åï¼ŒæŸç‰‡åœ¨åŸåˆ†ç»„ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œç›¸å¯¹ç”¨æˆ·æ•°æ®å­—æ®µçš„èµ·ç‚¹ã€‚ç‰‡åç§»ä»¥8ä¸ªå­—èŠ‚ä¸ºåç§»å•ä½ï¼Œæ¯ä¸ªåˆ†ç‰‡é•¿åº¦ä¸€å®šæ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚</li><li><strong>ç”Ÿå­˜æ—¶é—´</strong> 8ä½ï¼ŒTTL(Time To Live)ï¼Œè¡¨æ˜è¿™æ˜¯æ•°æ®æŠ¥åœ¨ç½‘ç»œä¸­çš„å¯¿å‘½ã€‚å‘å‡ºæ•°æ®æŠ¥çš„æºç‚¹è®¾ç½®è¿™ä¸ªå­—æ®µã€‚å…¶ç›®çš„æ˜¯é˜²æ­¢æ— æ³•äº¤ä»˜çš„æ•°æ®æŠ¥æ— é™åˆ¶åœ°åœ¨äº’è”ç½‘å…œåœˆå­ã€‚ç°åœ¨TTLæŒ‡ä¼ å‡ è·³è·¯ç”±å™¨ï¼Œç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨å°±å‡ä¸€ã€‚åˆå§‹TTL=1åªèƒ½åœ¨æœ¬åœ°å±€åŸŸç½‘ç»œä¼ é€ã€‚</li><li><strong>åè®®</strong> å 8ä½ï¼Œåè®®å­—æ®µæŒ‡å‡ºæ•°æ®æŠ¥æºå¸¦çš„æ•°æ®æ˜¯ä½¿ç”¨ä½•ç§åè®®ï¼Œä»¥ä¾¿ä½¿ç›®çš„ä¸»æœºçš„IPå±‚çŸ¥é“åº”å°†æ•°æ®éƒ¨åˆ†äº¤ç»™ä¸Šå±‚å“ªä¸ªåè®®å¤„ç†ã€‚</li><li><strong>é¦–éƒ¨æ£€éªŒå’Œ</strong> 16ä½ï¼Œåªæ£€éªŒæ•°æ®æŠ¥çš„é¦–éƒ¨ï¼Œä¸æ£€éªŒæ•°æ®éƒ¨åˆ†å¯ä»¥å‡å°‘å·¥ä½œé‡ã€‚æ£€éªŒæ–¹æ³•å¦‚å›¾ï¼š</li></ul><p><img src="/2021/03/15/network/ip%E6%A3%80%E9%AA%8C%E9%A6%96%E9%83%A8%E5%92%8C.png"></p><p><strong>å‘é€æ–¹</strong>å°†æ‰€æœ‰é¦–éƒ¨åˆ’åˆ†ä¸º16ä½åºåˆ—ï¼Œæ‰€æœ‰16ä½ç›¸åŠ è®¡ç®—åç å†™å…¥æ£€éªŒå’Œå­—æ®µã€‚</p><p><strong>æ¥æ”¶æ–¹</strong>æ”¶åˆ°æ•°æ®æŠ¥åå°†é¦–éƒ¨çš„æ‰€æœ‰16ä½å†ä½¿ç”¨åç ç®—æ•°ç›¸åŠ ï¼Œå¾—åˆ°çš„å’Œè®¡ç®—åç å’Œæ•°æ®æŠ¥ä¸­çš„æ£€éªŒå’Œå­—æ®µç›¸åŠ ï¼Œç»“æœå¿…ä¸º0ï¼Œå¦åˆ™å‡ºé”™ã€‚</p><ul><li><p><strong>æºåœ°å€</strong> 32ä½ã€‚</p></li><li><p><strong>ç›®çš„åœ°å€</strong> 32ä½ã€‚</p></li><li><p><strong>å¯å˜éƒ¨åˆ†</strong> å¯å˜ä»1-40å­—èŠ‚ä¸ç­‰ã€‚ç”¨æ¥æ”¯æŒæ’é”™ã€æµ‹é‡ä»¥åŠå®‰å…¨ç­‰æªæ–½ã€‚å®é™…ä¸Šå¾ˆå°‘ä½¿ç”¨ï¼ˆå¢åŠ è®¡ç®—å¼€é”€ï¼‰ã€‚</p></li><li><p>è·¯ç”±è¡¨ä¸­ä¸»è¦ä¿¡æ¯ï¼š</p></li></ul><p>$(ç›®çš„ç½‘ç»œåœ°å€ï¼Œä¸‹ä¸€è·³åœ°å€)$</p><p><img src="/2021/03/15/network/ip%E8%B7%AF%E7%94%B1%E8%A1%A8%E4%BF%A1%E6%81%AF.png"></p><ol start="2"><li>é»˜è®¤è·¯ç”±</li></ol><p><img src="/2021/03/15/network/%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1.png"></p><p>ä¸»æœºå‘é€IPæ•°æ®æŠ¥æ—¶è¦æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œå¦‚æœä¸€å°ä¸»æœºè¿æ¥åœ¨ä¸€ä¸ªå°ç½‘ç»œä¸Šï¼Œè¿™ä¸ªç½‘ç»œåªç”¨ä¸€å°è·¯ç”±å™¨è¿æ¥ï¼Œé‚£ä¹ˆä½¿ç”¨é»˜è®¤è·¯ç”±ã€‚</p><ol start="3"><li>åˆ†ç»„è½¬å‘</li></ol><p>è·¯ç”±å™¨æ”¶åˆ°æ•°æ®æŠ¥ï¼Œä»è·¯ç”±è¡¨çŸ¥é“ä¸‹ä¸€è·³IPåœ°å€åï¼Œåˆ©ç”¨ARPå°†IPåœ°å€è½¬æ¢ä¸ºç¡¬ä»¶åœ°å€æ”¾å…¥MACå¸§é¦–éƒ¨ï¼Œä»è€Œé€ç»™ä¸‹ä¸€è·³è·¯ç”±å™¨æˆ–ä¸»æœºã€‚</p><h4 id="7-åˆ’åˆ†å­ç½‘"><a href="#7-åˆ’åˆ†å­ç½‘" class="headerlink" title="7.åˆ’åˆ†å­ç½‘"></a>7.åˆ’åˆ†å­ç½‘</h4><ol><li>ä»ä¸¤çº§IPåœ°å€åˆ°ä¸‰çº§IPåœ°å€</li></ol><p>ä¸¤çº§IPåœ°å€ï¼ˆç½‘ç»œå·+ä¸»æœºå·ï¼‰é—®é¢˜ï¼š</p><ul><li><p>æµªè´¹ã€‚Aç±»ä¸»æœºæ•°è¶…è¿‡1000ä¸‡ï¼ŒBç±»è¶…è¿‡6ä¸‡ã€‚å¾ˆå¤šå…¬å¸å®æ„¿ç”³è¯·Aå’ŒBç±»ä¹Ÿä¸æƒ³è¦Cã€‚é€ æˆIPèµ„æºæµªè´¹ã€‚</p></li><li><p>æ¯ä¸€ä¸ªç‰©ç†ç½‘ç»œåˆ†é…ç½‘ç»œå·ä½¿å¾—è·¯ç”±è¡¨å¤ªå¤§ï¼Œç½‘ç»œæ€§èƒ½å˜å·®ã€‚</p></li></ul><p><strong>ä¸‰çº§IP</strong>å¢åŠ å­ç½‘å·å­—æ®µï¼š<strong>åˆ’åˆ†å­ç½‘</strong>ã€‚</p><p>$ IPåœ°å€ ::={&lt;ç½‘ç»œå·&gt;ï¼Œ&lt;å­ç½‘å·&gt;ï¼Œ&lt;ä¸»æœºå·&gt;}$</p><ul><li>å…¶ä»–ç½‘ç»œå‘ç»™æœ¬å•ä½çš„IPæ•°æ®æŠ¥ï¼Œæ ¹æ®ç½‘ç»œå·æ‰¾åˆ°æœ¬å•ä½ç½‘ç»œï¼Œæœ¬ç½‘ç»œæ”¶åˆ°åï¼ŒæŒ‰ç…§å­ç½‘å·æ‰¾åˆ°ç›®çš„å­ç½‘ã€‚</li></ul><p><img src="/2021/03/15/network/%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91.png"></p><p><img src="/2021/03/15/network/%E5%88%92%E5%88%86%E5%AD%90%E7%BD%911.png"></p><ol start="2"><li>å­ç½‘æ©ç </li></ol><p>ä½¿ç”¨å­ç½‘æ©ç æ‰¾åˆ°å­ç½‘ä¸­çš„ç›®çš„ä¸»æœºã€‚</p><p><img src="/2021/03/15/network/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81.png"></p><p>ä¸ç®¡ç½‘ç»œæœ‰æ²¡æœ‰åˆ’åˆ†å­ç½‘ï¼Œåªè¦æŠŠå­ç½‘æ©ç å’ŒIPåœ°å€è¿›è¡ŒæŒ‰ä½ä¸ï¼Œå°±èƒ½å¾—åˆ°ç½‘ç»œåœ°å€ã€‚</p><p>å¦‚æœç½‘ç»œæ²¡æœ‰åˆ’åˆ†å­ç½‘ï¼Œè·¯ç”±å™¨å°±é»˜è®¤ä½¿ç”¨<strong>é»˜è®¤å­ç½‘æ©ç </strong>ã€‚</p><p><img src="/2021/03/15/network/%E9%BB%98%E8%AE%A4%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81.png"></p><p>è·¯ç”±å™¨ç°åœ¨äº¤æ¢ä¿¡æ¯ï¼Œå¿…é¡»æŠŠè‡ªå·±çš„å­ç½‘æ©ç å‘Šè¯‰ç›¸é‚»è·¯ç”±å™¨ï¼Œè¿™æ ·è·¯ç”±è¡¨è¿˜ç»™å‡ºäº†æ¯ä¸ªç½‘ç»œçš„å­ç½‘æ©ç ã€‚</p><ul><li>å‡å°‘äº†å¯ç”¨ä¸»æœºæ•°ã€‚</li><li><strong>åˆ’åˆ†å­ç½‘çš„åˆ†ç»„è½¬å‘</strong>ï¼š</li></ul><p>$(ç›®çš„ç½‘ç»œåœ°å€ï¼Œä¸‹ä¸€è·³åœ°å€ï¼Œå­ç½‘æ©ç )$</p><ol><li>æ”¶åˆ°çš„æ•°æ®æŠ¥æå–IPåœ°å€Dã€‚</li><li>åˆ¤æ–­ç›´æ¥äº¤ä»˜ã€‚å­ç½‘æ©ç ä¸DæŒ‰ä½ä¸ï¼Œå¾—åˆ°ç½‘ç»œå·å’Œ<strong>æœ¬ç½‘ç»œ</strong>ä¸åŒ¹é…é—´æ¥äº¤ä»˜æ‰§è¡Œ3ï¼ŒåŒ¹é…ç›´æ¥äº¤ä»˜ã€‚</li><li>è·¯ç”±è¡¨æœ‰Dç‰¹å®šä¸»æœºè·¯ç”±ï¼Œåˆ™æ ¹æ®è·¯ç”±è¡¨IPå‘é€ä¸‹ä¸€è·³ï¼Œå¦åˆ™4ã€‚</li><li>å¯¹è·¯ç”±è¡¨æ¯ä¸€è¡ŒæŒ‰ä½ä¸å¾—åˆ°ç»“æœNã€‚è‹¥Nä¸æŸè¡Œç½‘ç»œåœ°å€åŒ¹é…ï¼Œåˆ™å‘ç»™ä¸‹ä¸€è·³ï¼Œå¦åˆ™5ã€‚</li><li>å‘é€é»˜è®¤è·¯ç”±ï¼Œå¦åˆ™6ã€‚</li><li>åˆ†ç»„å‡ºé”™ã€‚</li></ol><p><img src="/2021/03/15/network/%E5%AD%90%E7%BD%91%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91.png"></p><p><img src="/2021/03/15/network/%E5%AD%90%E7%BD%91%E4%BA%A4%E4%BB%98%E8%BF%87%E7%A8%8B.png"></p><h4 id="8-æ„é€ è¶…ç½‘-ï¼ˆCIDR"><a href="#8-æ„é€ è¶…ç½‘-ï¼ˆCIDR" class="headerlink" title="8.æ„é€ è¶…ç½‘ ï¼ˆCIDR)"></a>8.æ„é€ è¶…ç½‘ ï¼ˆCIDR)</h4><p><strong>æ— åˆ†ç±»åŸŸé—´è·¯ç”±é€‰æ‹©CIDR</strong>(Class Inter-Domain Routing)ã€‚</p><p>1ï¼‰æ¶ˆé™¤äº†ä¼ ç»Ÿçš„Aç±»ã€Bç±»å’ŒCç±»åœ°å€ä»¥åŠåˆ’åˆ†å­ç½‘æ¦‚å¿µã€‚æŠŠ32ä½åœ°å€åˆ’åˆ†å‰åä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰é¢çš„éƒ¨åˆ†æ˜¯<strong>ç½‘ç»œå‰ç¼€</strong>ï¼Œåé¢çš„éƒ¨åˆ†æŒ‡æ˜ä¸»æœºã€‚</p><p>$IPåœ°å€ ::={&lt;ç½‘ç»œå‰ç¼€&gt;ï¼Œ&lt;ä¸»æœºå·&gt;}$</p><p>åœ¨IPåœ°å€åé¢åŠ ä¸Šæ–œçº¿â€œ/â€å†™ä¸Šç½‘ç»œå‰ç¼€æ‰€å çš„ä½æ•°ã€‚ä¾‹å¦‚ï¼š206.0.64.0/18</p><p>2ï¼‰ç½‘ç»œå‰ç¼€éƒ½ç›¸åŒçš„è¿ç»­IPç»„æˆä¸€ä¸ªâ€œCIDRåœ°å€å—â€ã€‚åªè¦çŸ¥é“CIDRåœ°å€å—ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ°å€ï¼Œå°±å¯ä»¥çŸ¥é“åœ°å€å—çš„èµ·å§‹åœ°å€ï¼ˆæœ€å°åœ°å€ï¼‰å’Œæœ€å¤§åœ°å€ã€‚ä½¿ç”¨<strong>32ä½åœ°å€æ©ç </strong>ã€‚</p><p>3ï¼‰æœ€é•¿å‰ç¼€åŒ¹é…ã€‚è¶…ç½‘è·¯ç”±ï¼Œç½‘ç»œå‰ç¼€å’Œä¸‹ä¸€è·³åœ°å€ç»„æˆã€‚æ¯æ¬¡åŒ¹é…å¯èƒ½ä¼šæœ‰å¤šæ¡åŒ¹é…ç»“æœï¼Œé€‰å–åŒ¹é…å‰ç¼€æœ€é•¿çš„ã€‚</p><p>4ï¼‰ä½¿ç”¨<strong>äºŒå‰çº¿ç´¢</strong>æŸ¥æ‰¾è·¯ç”±è¡¨ã€‚</p><p><img src="/2021/03/15/network/%E4%BA%8C%E5%8F%89%E7%BA%BF%E7%B4%A2%E6%90%9C%E7%B4%A2%E6%A0%91.png"></p><h4 id="9-ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP"><a href="#9-ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP" class="headerlink" title="9.ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP"></a>9.ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP</h4><p><img src="/2021/03/15/network/ICMP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.png"></p><ul><li>æœ‰<strong>ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡</strong>å’Œ<strong>ICMPè¯¢é—®æŠ¥æ–‡</strong> ä¸¤ç±»ã€‚</li></ul><p><img src="/2021/03/15/network/ICMP%E6%8A%A5%E6%96%87%E6%95%B0%E6%8D%AE.png"></p><p>1ï¼‰ç»ˆç‚¹ä¸å¯è¾¾ã€‚ å½“è·¯ç”±å™¨æˆ–ä¸»æœºä¸èƒ½äº¤ä»˜æ•°æ®æŠ¥æ—¶å°±å‘æºç‚¹å‘é€ç»ˆç‚¹ä¸å¯è¾¾æŠ¥æ–‡ã€‚</p><p>2ï¼‰æ—¶é—´è¶…è¿‡ å½“æ•°æ®æŠ¥çš„ç”Ÿå­˜æ—¶é—´ä¸º0ï¼Œä¸¢å¼ƒè¯¥æ•°æ®åŒ…ï¼Œè¿˜è¦å‘æºç‚¹å‘é€æ—¶é—´è¶…è¿‡æŠ¥æ–‡ã€‚<strong>æˆ–</strong>ç»ˆç‚¹åœ¨é¢„å®šæ—¶é—´å†…ä¸èƒ½æ”¶åˆ°æ•°æ®æŠ¥çš„å…¨éƒ¨æ•°æ®ç‰‡ï¼Œå°±å°†æ•°æ®æŠ¥ç‰‡ä¸¢å¼ƒï¼Œå¹¶å‘æºç‚¹å‘é€æ—¶é—´è¶…è¿‡æŠ¥æ–‡ã€‚</p><p>3ï¼‰å‚æ•°é—®é¢˜ æ•°æ®æŠ¥é¦–éƒ¨ä¸­æœ‰å­—æ®µçš„å€¼ä¸æ­£ç¡®æ—¶ï¼Œä¸¢å¼ƒè¯¥æ•°æ®æŠ¥ï¼Œå¹¶å‘IPå‘é€å‚æ•°é—®é¢˜æŠ¥æ–‡ã€‚</p><p>4ï¼‰æ”¹å˜è·¯ç”±ï¼ˆé‡å®šå‘ï¼‰ è·¯ç”±å™¨æŠŠæ”¹å˜æŠ¥æ–‡å‘é€ç»™ä¸»æœºï¼Œè®©ä¸»æœºçŸ¥é“ä¸‹æ¬¡åº”è¯¥å‘ç»™å¦å¤–çš„è·¯ç”±å™¨ã€‚</p><p>5ï¼‰å›é€è¯·æ±‚å’Œå›ç­” ç”±ä¸»æœºæˆ–è·¯ç”±å‘ç‰¹å®šç›®çš„ä¸»æœºå‘å‡ºè¯¢é—®ã€‚æ”¶åˆ°æ­¤æŠ¥æ–‡çš„ä¸»æœºå‘æºä¸»æœºæˆ–è·¯ç”±å™¨å‘é€ICMPå›é€å›ç­”æŠ¥æ–‡ã€‚ä¸»è¦æ¥æµ‹è¯•ç›®çš„ç«™æ˜¯å¦å¯è¾¾ä»¥åŠäº†è§£ç›¸å…³çŠ¶æ€ã€‚</p><p>6ï¼‰æ—¶é—´æˆ³è¯·æ±‚å’Œå›ç­”ã€‚ Iè¯·æ±‚æŸå°ä¸»æœºå›ç­”å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚å¯ç”¨äºæ—¶é’ŸåŒæ­¥å’Œæ—¶é—´æµ‹é‡ã€‚</p><ul><li><p>åº”ç”¨</p><p><strong>PING</strong>æµ‹è¯•ä¸¤ä¸»æœºè¿é€šæ€§ã€‚</p><p><strong>tracerouteï¼ˆunixï¼Œwindows æ˜¯tracertï¼‰</strong> è·Ÿè¸ªä»æºç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ã€‚</p></li></ul><h3 id="10-è·¯ç”±é€‰æ‹©åè®®"><a href="#10-è·¯ç”±é€‰æ‹©åè®®" class="headerlink" title="10. è·¯ç”±é€‰æ‹©åè®®"></a>10. è·¯ç”±é€‰æ‹©åè®®</h3><ol><li>åˆ†å±‚æ¬¡çš„è·¯ç”±é€‰æ‹©åè®®ã€‚</li></ol><p>1ï¼‰äº’è”ç½‘çš„è§„æ¨¡éå¸¸å¤§ã€‚è·¯ç”±å™¨å¦‚æœè¦çŸ¥æ‰€æœ‰ç½‘ç»œè·¯å¾„ï¼Œè·¯ç”±è¡¨éå¸¸å¤§å¤„ç†è´¹æ—¶ã€‚</p><p>2ï¼‰è®¸å¤šå•ä½ä¸æ„¿æ„å¤–ç•Œäº†è§£è‡ªå·±çš„å¸ƒå±€ç»†èŠ‚ä½†æ˜¯è¿˜æƒ³è¿æ¥åˆ°äº’è”ç½‘ä¸Šã€‚</p><p>æ‰€ä»¥ï¼Œåˆ†æˆå¾ˆå¤šè‡ªæ²»ç³»ç»Ÿï¼ˆAutonomous System ,ASï¼‰ï¼Œä¸€ä¸ªASå¯¹å…¶ä»–ASè¡¨ç°å‡ºçš„æ˜¯ä¸€ä¸ªå•ä¸€çš„å’Œä¸€è‡´çš„è·¯ç”±é€‰æ‹©ç­–ç•¥ã€‚</p><p>é€‰æ‹©åè®®åˆ†ä¸ºä¸¤ç±»ï¼š<strong>å†…éƒ¨ç½‘å…³åè®®IGPï¼ˆInterior Gateway Protocolï¼‰</strong>å’Œ<strong>å¤–éƒ¨ç½‘å…³åè®®EGPï¼ˆExternal Gateway Protocolï¼‰</strong>ã€‚</p><p>IGPï¼šè‡ªæ²»ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„è·¯ç”±é€‰æ‹©åè®®ï¼Œä¸å…¶ä»–è‡ªæ²»ç³»ç»Ÿé€‰æ‹©ä»€ä¹ˆè·¯ç”±åè®®æ— å…³ã€‚å¦‚RIPå’ŒOSPFã€‚<strong>åŸŸå†…è·¯ç”±é€‰æ‹©</strong>ã€‚</p><p>EGPï¼šä¸åŒçš„è‡ªæ²»ç³»ç»Ÿé—´çš„åè®®ã€‚ä¾‹å¦‚BGPç‰ˆæœ¬4ï¼ˆBGP-4ï¼‰ã€‚<strong>åŸŸé—´è·¯ç”±é€‰æ‹©</strong>ã€‚</p><ol start="2"><li><strong>RIP</strong>ï¼ˆRouting Information Protocolï¼‰</li></ol><p>åŸºäºè·ç¦»å‘é‡çš„è·¯ç”±é€‰æ‹©åè®®ã€‚è·ç¦»å®šä¹‰ï¼šæ¯ç»è¿‡ä¸€è·³è·¯ç”±å™¨å°±+1ã€‚ä¾‹å¦‚ç›´è¿è·¯ç”±æ˜¯1ã€‚æ‰€ä»¥RIPé€‚ç”¨äºï¼ˆå°å‹ç½‘ç»œï¼‰ã€‚</p><ul><li>RIPä¸èƒ½åœ¨ä¸¤ä¸ªä¸»æœºé—´åŒæ—¶ä½¿ç”¨å¤šä¸ªè·¯ç”±ï¼ŒRIPé€‰æ‹©ä¸€æ¡æœ€å°‘è·¯ç”±å™¨çš„è·¯ç”±ï¼Œå“ªæ€•è¿˜å­˜åœ¨å¦ä¸€æ¡é«˜é€Ÿä½†è·¯ç”±å™¨è¾ƒå¤šçš„è·¯ç”±ã€‚</li><li>ä»…å’Œç›¸é‚»è·¯ç”±äº¤æ¢ä¿¡æ¯ã€‚</li><li><strong>è·ç¦»é€‰æ‹©ç®—æ³•</strong></li></ul><p>1ï¼‰å¯¹åœ°å€ä¸ºXçš„ç›¸é‚»è·¯ç”±å‘æ¥çš„RIPæŠ¥æ–‡ï¼ŒæŠŠâ€œä¸‹ä¸€è·³â€å­—æ®µä¸­çš„åœ°å€æ”¹ä¸ºXï¼Œå¹¶æŠŠæ‰€æœ‰â€œè·ç¦»â€åŠ 1ã€‚æ¯ä¸€ä¸ªé¡¹ç›®éƒ½æœ‰ä¸‰ä¸ªå…³é”®æ•°æ®ï¼šç›®çš„ç½‘ç»œNï¼Œè·ç¦»dï¼Œä¸‹ä¸€è·³è·¯ç”±å™¨Xã€‚</p><p>2ï¼‰å¯¹ä¿®æ”¹åçš„RIPæŠ¥æ–‡æ¯ä¸€ä¸ªé¡¹ç›®ï¼š</p><p>è‹¥åŸæ¥è·¯ç”±è¡¨<strong>æ²¡æœ‰</strong>ç›®çš„ç½‘ç»œNï¼Œåˆ™æŠŠè¯¥é¡¹ç›®æ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­ã€‚</p><p>å¦åˆ™ï¼ˆæœ‰Nï¼‰ï¼š</p><p>è‹¥ä¸‹ä¸€è·³è·¯ç”±å™¨æ˜¯Xï¼Œåˆ™æŠŠæ”¶åˆ°çš„é¡¹ç›®æ›¿æ¢ä¸ºåŸæ¥çš„è·¯ç”±è¡¨ä¸­çš„é¡¹ç›®ã€‚</p><p>å¦åˆ™ï¼ˆåˆ°ç›®çš„ç½‘ç»œNçš„ä¸‹ä¸€è·³ä¸æ˜¯Xï¼‰ï¼š</p><p>æ”¶åˆ°çš„é¡¹ç›®ä¸­çš„è·ç¦»då°äºè·¯ç”±è¡¨ä¸­çš„è·ç¦»ï¼Œåˆ™è¿›è¡Œæ›´æ–°ã€‚å¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšã€‚</p><p>3ï¼‰3åˆ†é’Ÿè¿˜æ²¡æœ‰æ”¶åˆ°ç›¸é‚»è·¯ç”±å™¨çš„æ›´æ–°è·¯ç”±è¡¨ï¼Œåˆ™æŠŠç›¸é‚»è·¯ç”±å™¨è®°ä¸ºä¸å¯è¾¾çš„è·¯ç”±å™¨ï¼Œå³è·ç¦»è®¾ç½®ä¸º<strong>16</strong>ã€‚</p><p>4ï¼‰è¿”å›ã€‚</p><p>è¿™ä¸ªç®—æ³•åŸºç¡€æ˜¯<strong>Bellman-Fordç®—æ³•</strong>ã€‚ï¼ˆæ±‚Aåˆ°Bæœ€çŸ­è·¯å¾„ï¼‰</p><p>ä¾‹é¢˜<strong>ç›´æ¥çœ‹ä¹¦P155é¡µ ä¾‹é¢˜</strong>ï¼Œçœ‹ä¸€çœ¼å¦‚ä½•æ›´æ–°è¡¨å°±æ‡‚äº†ã€‚</p><ul><li>RIPåè®®çš„æŠ¥æ–‡æ ¼å¼</li></ul><p><img src="/2021/03/15/network/Rip%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F.png"></p><p>ä¸€ä¸ªRIPæŠ¥æ–‡æœ€å¤šæºå¸¦25ä¸ªè·¯ç”±ï¼Œæ‰€ä»¥æœ€å¤§é•¿åº¦4+20*25=504å­—èŠ‚ã€‚<strong>ä½¿ç”¨UDPä¼ é€</strong>ã€‚</p><p>RIPçš„é¦–éƒ¨å 4ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­å‘½ä»¤å­—æ®µæŒ‡å‡ºæŠ¥æ–‡çš„æ„ä¹‰ã€‚ä¾‹å¦‚1è¡¨ç¤ºè¯·æ±‚è·¯ç”±ä¿¡æ¯ï¼Œ2è¡¨ç¤ºè¯·æ±‚è·¯ç”±ä¿¡æ¯çš„å“åº”æˆ–æœªè¢«è¯·æ±‚è€Œå‘å‡ºçš„è·¯ç”±æ›´æ–°æŠ¥æ–‡ã€‚é¦–éƒ¨åé¢çš„å¿…ä¸º0ä¸ºäº†4å­—èŠ‚å¯¹é½ã€‚</p><ul><li>RIPåè®®å­˜åœ¨çš„é—®é¢˜</li></ul><p>å½“ç½‘ç»œå‡ºç°æ•…éšœæ—¶ï¼Œè¦ç»è¿‡è¾ƒé•¿æ—¶é—´æ‰èƒ½å°†æ­¤ä¿¡æ¯ä¼ é€åˆ°æ‰€æœ‰è·¯ç”±å™¨ã€‚<strong>å¥½æ¶ˆæ¯ä¼ å¾—å¿«ï¼Œåæ¶ˆæ¯ä¼ çš„æ…¢</strong>ã€‚ä¾‹å­ï¼š</p><p><img src="/2021/03/15/network/Rip%E5%8D%8F%E8%AE%AE%E7%9A%84%E9%99%90%E5%88%B6.png"></p><p>å›¾ä¸­â€œ1,1ï¼Œç›´æ¥â€œæŒ‡åˆ°ç½‘ç»œ1,1è·³ï¼Œç›´æ¥äº¤ä»˜ã€‚ ç½‘ç»œ1å‡ºç°äº†æ•…éšœï¼ŒR1æ— æ³•åˆ°è¾¾ç½‘1ã€‚äºæ˜¯è·¯ç”±å™¨R1æŠŠåˆ°ç½‘1çš„è·ç¦»æ”¹ä¸º16ã€‚ä½†æ˜¯ï¼Œå¾ˆå¯èƒ½ç»è¿‡30ç§’é’ŸåR1æ‰æŠŠæ›´æ–°ä¿¡æ¯å‘é€ç»™R2ã€‚R2å¯èƒ½å·²ç»å…ˆæŠŠè‡ªå·±çš„è·¯ç”±è¡¨å‘ç»™R1ï¼Œå…¶ä¸­æœ‰â€1,2ï¼ŒR1â€œè¿™ä¸€é¡¹ã€‚</p><p>R1æ”¶åˆ°R2çš„æ›´æ–°æŠ¥æ–‡åï¼ŒæŠŠ1,2ï¼ŒR1æ›´æ–°ä¸º1,3ï¼ŒR2ã€‚ä¹‹åä¼šå†æŠŠæ›´æ–°åçš„ä¿¡æ¯å‘ç»™R2ã€‚R2åˆæ›´æ–°è‡ªå·±çš„è·¯ç”±è¡¨ä¸º1ï¼Œ4ï¼ŒR1ã€‚å¦‚æ­¤å¾€å¤ç›´åˆ°åŠ åˆ°16ã€‚</p><ol start="3"><li><strong>OSPF</strong> å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆ(Open Shortest Path First)</li></ol><p>å®ƒæ˜¯ä¸ºå…‹æœRIPçš„ç¼ºç‚¹åœ¨1989å¹´å¼€å‘å‡ºæ¥çš„ã€‚</p><p>ä½¿ç”¨äº†Dijkstraæå‡ºçš„<strong>æœ€çŸ­è·¯å¾„ç®—æ³•SPF</strong>ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><p>1ï¼‰å‘æœ¬è‡ªæ²»ç³»ç»Ÿä¸­æ‰€æœ‰è·¯ç”±å™¨å‘é€ä¿¡æ¯ã€‚ä½¿ç”¨<strong>æ´ªæ³›æ³•</strong>ã€‚è·¯ç”±å™¨é€šè¿‡æ‰€æœ‰è¾“å‡ºç«¯å£å‘æ‰€æœ‰ç›¸é‚»è·¯ç”±å™¨å‘é€ä¿¡æ¯ã€‚è€Œæ¯ä¸€ä¸ªç›¸é‚»è·¯ç”±å™¨åˆå†å°†æ­¤ä¿¡æ¯å‘å¾€æ‰€æœ‰ç›¸é‚»è·¯ç”±å™¨ã€‚</p><p>2ï¼‰å‘é€çš„ä¿¡æ¯å°±æ˜¯<strong>æœ¬è·¯ç”±å™¨ç›¸é‚»çš„æ‰€æœ‰è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€</strong>ã€‚<strong>åº¦é‡</strong>è¡¨ç¤ºè´¹ç”¨ã€è·ç¦»ã€æ—¶å»¶ã€å¸¦å®½ç­‰ç­‰ï¼Œè¿™äº›éƒ½æ˜¯ç½‘ç»œç®¡ç†äººå‘˜å†³å®šçš„ï¼Œè¾ƒä¸ºçµæ´»ã€‚</p><p>3ï¼‰åªæœ‰é“¾è·¯å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šå‘æ‰€æœ‰è·¯ç”±å™¨ç”¨æ´ªæ³›æ³•å‘é€æ­¤ä¿¡æ¯ã€‚</p><p>OSPFå°†ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿå†åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ›´å°çš„èŒƒå›´ï¼Œå«åšåŒºåŸŸã€‚å›¾4-34å°±è¡¨ç¤ºä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿåˆ’åˆ†ä¸º4ä¸ªåŒºåŸŸã€‚</p><p><img src="/2021/03/15/network/OSPF%E5%8C%BA%E5%9F%9F.png"></p><p>è¿™æ ·æ´ªæ³›æ³•å°±ä½œç”¨äºæ¯ä¸ªåŒºåŸŸå†…ã€‚ä¸Šå±‚å«<strong>ä¸»å¹²åŒºåŸŸ</strong>ï¼ŒR3ã€R4å’ŒR7æ˜¯<strong>åŒºåŸŸè¾¹ç•Œè·¯ç”±å™¨</strong>ã€‚R6æ˜¯<strong>è‡ªæ²»ç³»ç»Ÿè¾¹ç•Œè·¯ç”±å™¨</strong>ã€‚ï¼ˆå’Œå…¶ä»–è‡ªæ²»ç³»ç»Ÿè¿æ¥ï¼‰</p><p><img src="/2021/03/15/network/OSPF%E6%A0%BC%E5%BC%8F.png"></p><p>ä½¿ç”¨24å­—èŠ‚çš„é¦–éƒ¨é•¿åº¦ï¼š</p><p>1ï¼‰ç‰ˆæœ¬ã€‚å½“å‰ç‰ˆæœ¬ä¸º2ã€‚</p><p>2ï¼‰ç±»å‹ã€‚5ç§ç±»å‹ä¸­çš„ä¸€ç§ã€‚</p><p>3ï¼‰åˆ†ç»„é•¿åº¦ã€‚åŒ…æ‹¬OSPFé¦–éƒ¨åœ¨å†…çš„åˆ†ç»„é•¿åº¦ã€‚</p><p>4ï¼‰è·¯ç”±å™¨æ ‡è¯†ç¬¦ã€‚å‘é€æ”¹åˆ†ç»„çš„è·¯ç”±å™¨æ¥å£çš„IPåœ°å€ã€‚</p><p>5ï¼‰åŒºåŸŸæ ‡è¯†ç¬¦ã€‚åˆ†ç»„å±äºåŒºåŸŸçš„æ ‡è¯†ç¬¦ã€‚</p><p>6ï¼‰æ£€éªŒå’Œã€‚ç”¨æ¥æ£€éªŒåˆ†ç»„ä¸­çš„å·®é”™ã€‚</p><p>7ï¼‰é‰´åˆ«ç±»å‹ã€‚0ï¼ˆä¸ç”¨ï¼‰1ï¼ˆå£ä»¤ï¼‰ã€‚</p><p>8ï¼‰é‰´åˆ«ã€‚ é‰´åˆ«ç±»å‹ä¸º0å¡«0ã€‚é‰´åˆ«ç±»å‹1å¡«8ä¸ªå­—ç¬¦çš„å£ä»¤ã€‚</p><h3 id="11-å¤–éƒ¨ç½‘å…³åè®®BGP"><a href="#11-å¤–éƒ¨ç½‘å…³åè®®BGP" class="headerlink" title="11.å¤–éƒ¨ç½‘å…³åè®®BGP"></a>11.å¤–éƒ¨ç½‘å…³åè®®BGP</h3><p>è¾¹ç•Œç½‘å…³åè®®ï¼ˆBGPï¼‰</p><p>ä¸åŒè‡ªæ²»åŒºåŸŸä½¿ç”¨BGPçš„åŸå› æœ‰ï¼š</p><ol><li><p>äº’è”ç½‘è§„æ¨¡å¤ªå¤§ã€‚è·¯ç”±è¡¨ç»´æŒå¼€é”€å¤ªå¤§ã€‚</p></li><li><p>ä¸åŒè‡ªæ²»åŒºåŸŸç”¨çš„åè®®å¯èƒ½ä¸åŒã€‚è€Œä¸”æœ‰çš„è‡ªæ²»åŒºåŸŸä¸å–œæ¬¢è®©åˆ«çš„è‡ªæ²»åŒºåŸŸæµé‡é€šè¿‡æœ¬åŒºåŸŸã€‚</p></li></ol><p>BGPé‡‡ç”¨<strong>è·¯å¾„å‘é‡è·¯ç”±é€‰æ‹©åè®®</strong>ï¼Œæ»¡è¶³ç®¡ç†å‘˜çš„æ¡ä»¶ä¸‹ï¼Œé€‰æ‹©æ¯”è¾ƒå¥½çš„è·¯å¾„ï¼Œå¹¶éæ‰¾ä¸€æ¡æœ€ä½³è·¯å¾„ã€‚</p><p>ä¸€ä¸ªBGPå‘è¨€äººä¸å…¶ä»–ASçš„BGPå‘è¨€äººè¦äº¤æ¢ä¿¡æ¯ï¼Œé¦–å…ˆå»ºç«‹TCPè¿æ¥ï¼Œç«¯å£å·179ï¼Œç„¶ååœ¨æ­¤è¿æ¥ä¸Šäº¤æ¢BGPæŠ¥æ–‡ä»¥å»ºç«‹BGPä¼šè¯ã€‚</p><p><img src="/2021/03/15/network/BGP%E5%92%8CAS%E7%9A%84%E5%85%B3%E7%B3%BB.png"></p><p>æœ‰äº†BGPä¼šä½¿å¾—è·¯ç”±è¡¨ç®€åŒ–å¾ˆå¤šï¼ŒBGPåè®®äº¤æ¢è·¯ç”±ä¿¡æ¯çš„ç»“ç‚¹æ•°é‡çº§æ˜¯è‡ªæ²»ç³»ç»Ÿä¸ªæ•°çš„é‡çº§ï¼Œè¿™è¦æ¯”ç½‘ç»œæ•°å°å¾ˆå¤šï¼Œåªè¦æ‰¾å¯¹æ­£ç¡®çš„BGPå‘è¨€äººï¼Œå°±å¯ä»¥å‘é€æ•°æ®æŠ¥ï¼Œç®€åŒ–è·¯ç”±è¡¨ä¿¡æ¯ã€‚</p><ul><li>BGP-4çš„4ç§æŠ¥æ–‡</li></ul><p>1ï¼‰OPENï¼ˆæ‰“å¼€ï¼‰æŠ¥æ–‡ï¼Œç”¨æ¥å’Œç›¸é‚»çš„å¦ä¸€ä¸ªBGPå‘è¨€äººå»ºç«‹å…³ç³»ï¼Œä½¿é€šä¿¡åˆå§‹åŒ–ã€‚</p><p>2ï¼‰UPDATEï¼ˆæ›´æ–°ï¼‰æŠ¥æ–‡ï¼Œç”¨æ¥é€šå‘ŠæŸä¸€è·¯ç”±ä¿¡æ¯ï¼Œä»¥åŠåˆ—å‡ºè¦æ’¤é”€çš„å¤šæ¡è·¯ç”±ã€‚</p><p>3ï¼‰KEEPALIVEï¼ˆä¿æ´»ï¼‰ï¼Œç”¨æ¥å‘¨æœŸæ€§åœ°è¯å®é‚»ç«™çš„è¿é€šæ€§ã€‚</p><p>4ï¼‰NOTIFICATIONï¼ˆé€šçŸ¥ï¼‰æŠ¥æ–‡ï¼Œç”¨æ¥å‘é€æ£€æµ‹åˆ°çš„å·®é”™ã€‚</p><ul><li>BGPè·¯ç”±è¡¨åŒ…æ‹¬ç›®çš„ç½‘ç»œå‰ç¼€ï¼Œä¸‹ä¸€è·³è·¯ç”±ä»¥åŠåˆ°è¾¾è¯¥ç½‘ç»œç»è¿‡çš„è‡ªæ²»ç³»ç»Ÿåºåˆ—ã€‚ï¼ˆå¦‚æœä¸€ä¸ªBGPæ”¶åˆ°äº†å…¶ä»–BGPçš„è·¯å¾„é€šçŸ¥ï¼Œæ£€æŸ¥æœ¬è‡ªæ²»ç³»ç»Ÿæ˜¯å¦åœ¨è·¯å¾„åºåˆ—ä¸­ï¼Œé˜²æ­¢å…œåœˆå­ï¼‰ã€‚</li></ul><p><img src="/2021/03/15/network/BGP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.png"></p><ul><li><p>æ ‡è®°ç”¨æ¥é‰´åˆ«BGPæŠ¥æ–‡ï¼Œä¸ä½¿ç”¨é‰´åˆ«ï¼Œæ ‡è®°å…¨éƒ¨ç½®1ã€‚é•¿åº¦å­—æ®µæŒ‡å‡ºåŒ…æ‹¬é€šç”¨é¦–éƒ¨åœ¨å†…çš„æ•´ä¸ªBGPæŠ¥æ–‡é•¿åº¦ï¼Œæœ€å°19ï¼Œæœ€å¤§4096ã€‚ç±»å‹1-4ï¼Œä¸Šè¿°BGPæŠ¥æ–‡ä¸­çš„ä¸€ç§ã€‚</p></li><li><p>OPENæŠ¥æ–‡å…±æœ‰6ä¸ªå­—æ®µï¼Œå³ç‰ˆæœ¬</p></li></ul><h3 id="12-IPV6"><a href="#12-IPV6" class="headerlink" title="12.IPV6"></a>12.IPV6</h3><p>IPV6å°†åœ°å€ç©ºé—´å¢å¤§åˆ°128ä½ï¼Œç›¸å½“äºIPV4çš„$2^{96}$å€ã€‚</p><p><img src="/2021/03/15/network/IPV6%E6%A0%BC%E5%BC%8F.png"></p><ul><li>é¦–éƒ¨å›ºå®š40å­—èŠ‚ã€‚</li><li><strong>ç‰ˆæœ¬</strong> å 4ä½ã€‚åè®®çš„ç‰ˆæœ¬ï¼ŒIPV6æ˜¯6.</li><li><strong>é€šä¿¡é‡ç±»</strong> å 8ä½ï¼Œä¸ºäº†åŒºåˆ†ä¸åŒçš„IPV6æ•°æ®ç±»å‹å’Œä¼˜å…ˆçº§ã€‚</li><li><strong>æµæ ‡å·</strong> å 20ä½ã€‚<strong>æµ</strong>æŒ‡çš„æ˜¯ä»ç‰¹å®šæºç‚¹åˆ°ç‰¹å®šç»ˆç‚¹çš„ä¸€ç³»åˆ—æ•°æ®æŠ¥ï¼Œæµæ‰€ç»è¿‡çš„è·¯å¾„ä¸Šè·¯ç”±å™¨éƒ½ä¿è¯æŒ‡æ˜çš„æœåŠ¡è´¨é‡ã€‚å±äºåŒä¸€ä¸ªæµçš„æ•°æ®æŠ¥éƒ½æœ‰ä¸€æ ·çš„æµæ ‡å·ã€‚</li><li><strong>æœ‰æ•ˆè½½è·é•¿åº¦</strong> å 16ä½ã€‚IPV6æ•°æ®æŠ¥é™¤åŸºæœ¬é¦–éƒ¨ä»¥å¤–çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªå­—æ®µçš„æœ€å¤§å€¼æ˜¯64KBã€‚</li><li><strong>ä¸‹ä¸€ä¸ªé¦–éƒ¨</strong> å 8ä½ã€‚</li></ul><p>1ï¼‰IPv6æ²¡æœ‰æ‰©å±•é¦–éƒ¨æ—¶ï¼ŒæŒ‡æ˜åé¢çš„æ•°æ®åº”è¯¥äº¤ä»˜IPå±‚å“ªä¸€ä¸ªåè®®ã€‚</p><p>2ï¼‰å‡ºç°æ‰©å±•é¦–éƒ¨æ—¶ï¼Œä¸‹ä¸€ä¸ªå­—æ®µçš„å€¼æ ‡è¯†ç¬¬ä¸€ä¸ªæ‰©å±•é¦–éƒ¨çš„ç±»å‹ã€‚</p><ul><li><strong>è·³æ•°é™åˆ¶</strong> å 8ä½ã€‚é˜²æ­¢æ•°æ®æŠ¥åœ¨ç½‘ç»œä¸­æ— é™æœŸå­˜åœ¨ã€‚æœ€å¤§255è·³ã€‚</li><li><strong>æºåœ°å€</strong> 128ä½ã€‚å‘é€æ•°æ®æŠ¥çš„IPåœ°å€ã€‚</li><li><strong>ç›®çš„åœ°å€</strong> 128ä½ã€‚æ¥æ”¶æ•°æ®æŠ¥çš„IPåœ°å€ã€‚</li></ul><ol><li><strong>IPV6åœ°å€</strong></li></ol><p>1ï¼‰<strong>å•æ’­</strong> ä¼ ç»Ÿçš„ç‚¹å¯¹ç‚¹é€šä¿¡ã€‚</p><p>2ï¼‰<strong>å¤šæ’­</strong> ä¸€ç‚¹å¯¹å¤šç‚¹é€šä¿¡ã€‚</p><p>3ï¼‰<strong>ä»»æ’­</strong> ç»ˆç‚¹æ˜¯ä¸€ç»„è®¡ç®—æœºï¼Œæ•°æ®æŠ¥åªäº¤ä»˜å…¶ä¸­ä¸€ä¸ªï¼Œé€šå¸¸æ˜¯è·ç¦»è¾ƒè¿‘çš„é‚£ä¸ªã€‚</p><p>2.<strong>å†’å·åå…­è¿›åˆ¶æ³•</strong></p><p><img src="/2021/03/15/network/%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E5%86%92%E5%8F%B7%E6%B3%95.png"></p><p><img src="/2021/03/15/network/v6%E5%8E%8B%E7%BC%A9.png"></p><p>CIDRæ— åˆ†ç±»ç½‘ç»œåœ°å€åŒæ ·å¯ä»¥é€‚ç”¨ã€‚ç›´æ¥åœ¨åé¢åŠ ä¸Š/ã€‚</p><p><img src="/2021/03/15/network/IPV6%E6%97%A0%E5%88%86%E7%B1%BB.png"></p><ul><li>åœ°å€åˆ†ç±»</li></ul><p><img src="/2021/03/15/network/IPV6%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.png"></p><p>1ï¼‰ æœªæŒ‡æ˜åœ°å€ã€‚16å­—èŠ‚å…¨0åœ°å€ã€‚åªèƒ½ä¸ºæŸä¸ªä¸»æœºå½“æºåœ°å€é€‚ç”¨ï¼Œä½¿ç”¨æ¡ä»¶æ˜¯è¿™ä¸ªä¸»æœºè¿˜æœªåˆ†é…IPåœ°å€ã€‚ä»…æ­¤ä¸€ä¸ªã€‚</p><p>2ï¼‰ç¯å›åœ°å€ã€‚åŠŸèƒ½å’ŒV4ä¸€æ ·ã€‚ä»…æ­¤ä¸€ä¸ªã€‚</p><p>3ï¼‰å¤šæ’­åœ°å€ã€‚åŠŸèƒ½å’ŒV4ä¸€æ ·ã€‚1/256ä¸ªã€‚</p><p>4ï¼‰æœ¬åœ°é“¾è·¯å¤šæ’­åœ°å€ã€‚æœ‰äº›ä¸»æœºæ²¡æœ‰è¿æ¥åˆ°äº’è”ç½‘ä¸Šï¼Œå 1/1024ã€‚</p><p>5ï¼‰å…¨çƒå•æ’­åœ°å€ã€‚ å¦‚å›¾ã€‚</p><ol start="3"><li><strong>ä»IPV4å‘IPV6è¿‡æ¸¡</strong></li></ol><p>1ï¼‰<strong>åŒåè®®æ ˆ</strong></p><p>ä¸€éƒ¨åˆ†ä¸»æœºè£…æœ‰IPV4å’ŒIPV6ä¸¤ä¸ªåè®®æ ˆã€‚è¿™æ ·è¿™ä¸ªä¸»æœºå¯ä»¥ä¸¤ç§ç±»å‹çš„ç½‘ç»œæ•°æ®é€šä¿¡ã€‚ä½¿ç”¨<strong>DNS</strong>æŸ¥è¯¢ç›®çš„ä¸»æœºä½¿ç”¨çš„æ˜¯é‚£ç§åè®®ã€‚</p><p><img src="/2021/03/15/network/%E5%8F%8C%E5%8D%8F%E8%AE%AE%E6%A0%88.png"></p><p>2ï¼‰<strong>éš§é“æŠ€æœ¯</strong></p><p>IPv6æ•°æ®æŠ¥è¿›å…¥IPv4ç½‘ç»œæ—¶ï¼Œä½¿ç”¨IPv4æ•°æ®æŠ¥å°è£…IPv6ã€‚è¿™æ ·å°±å¯ä»¥åœ¨IPv4ç½‘ç»œä¸­ä¼ æ’­ã€‚åœ¨ç¦»å¼€v4ç½‘ç»œæ—¶ï¼Œåªäº¤ä»˜æ•°æ®éƒ¨åˆ†ï¼ˆå³v6ï¼‰ã€‚åŒåè®®æ ˆçš„ä¸»æœºæƒ³çŸ¥é“å°è£…çš„æ˜¯ä¸€ä¸ªv6æ•°æ®æŠ¥ï¼Œv4é¦–éƒ¨åè®®å­—æ®µç½®ä¸º41ã€‚</p><ol start="4"><li><strong>ICMPv6</strong></li></ol><p>ä¹Ÿéœ€è¦ä½¿ç”¨ç±»ä¼¼ICMPåé¦ˆå·®é”™ä¿¡æ¯ã€‚</p><p><img src="/2021/03/15/network/ICMPv6%E5%88%86%E7%B1%BB.png"></p><h3 id="13-IPå¤šæ’­"><a href="#13-IPå¤šæ’­" class="headerlink" title="13.IPå¤šæ’­"></a>13.IPå¤šæ’­</h3><ul><li>ä¸€å¯¹å¤šé€šä¿¡ã€‚ä¸€ä¸ªæºç‚¹å‘é€ç»™å¾ˆå¤šç»ˆç‚¹ã€‚</li></ul><p><img src="/2021/03/15/network/%E5%8D%95%E6%92%AD%E4%B8%8E%E5%A4%9A%E6%92%AD%E6%AF%94%E8%BE%83.png"></p><ul><li>å¤šæ’­å®é™…ä¸Šæ˜¯IPåœ°å€ä¸­Dç±»åœ°å€ã€‚åªèƒ½ç”¨äºç›®çš„åœ°å€ï¼Œä¸èƒ½ç”¨äºæºåœ°å€ã€‚æ²¡æœ‰ICMPå·®é”™æŠ¥æ–‡ã€‚</li><li>åè®®ã€‚IGMPç½‘é™…ç»„ç®¡ç†åè®®ã€‚</li></ul><p><img src="/2021/03/15/network/IGMP.png"></p><p>IGMPè®©è¿æ¥åœ¨æœ¬åœ°å±€åŸŸç½‘ä¸Šçš„å¤šæ’­è·¯ç”±å™¨çŸ¥é“æœ¬å±€åŸŸç½‘ä¸Šæ˜¯å¦æœ‰ä¸»æœºå‚ä¸æˆ–é€€å‡ºäº†æŸä¸ªå¤šæ’­ç»„ã€‚</p><p>é…åˆ<strong>å¤šæ’­è·¯ç”±é€‰æ‹©åè®®</strong>ä¸€èµ·å·¥ä½œï¼Œ</p><p><img src="/2021/03/15/network/%E5%A4%9A%E6%92%AD%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE.png"></p><ul><li>IGMPä¸¤ä¸ªå·¥ä½œé˜¶æ®µ</li></ul><p>1ï¼‰åŠ å…¥ã€‚æŸå°ä¸»æœºåŠ å…¥å¤šæ’­ç»„æ—¶ï¼Œè¯¥ä¸»æœºåº”å‘å¤šæ’­ç»„çš„å¤šæ’­åœ°å€å‘é€ä¸€ä¸ªIGMPæŠ¥æ–‡ï¼Œå£°æ˜è‡ªå·±è¦æˆä¸ºè¯¥ç»„çš„æˆå‘˜ã€‚æœ¬åœ°å¤šæ’­è·¯ç”±å™¨æ”¶åˆ°IGMPæŠ¥æ–‡åï¼Œè¿˜è¦åˆ©ç”¨å¤šæ’­è·¯ç”±é€‰æ‹©åè®®æŠŠè¿™ç§ç»„æˆå‘˜å…³ç³»å‘ç»™å…¶ä»–å¤šæ’­è·¯ç”±å™¨ã€‚</p><p>2ï¼‰åˆ é™¤ã€‚æœ¬åœ°å¤šæ’­è·¯ç”±å™¨å‘¨æœŸæ€§æ¢è¯¢ä¸»æœºï¼ŒæŸ¥è¯¢è¿™äº›ä¸»æœºæ˜¯å¦è¿˜æ˜¯ç»„çš„æˆå‘˜ã€‚åªè¦æœ‰ä¸€å°ä¸»æœºå¯¹æŸä¸ªç»„å“åº”ï¼Œé‚£ä¹ˆå¤šæ’­è·¯ç”±å™¨å°±è®¤ä¸ºè¿™ä¸ªç»„æ˜¯æ´»è·ƒçš„ã€‚åªè¦å‡ æ¬¡æ¢è¯¢åæ²¡æœ‰ä¸€ä¸ªä¸»æœºå“åº”ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå†æŠŠè¿™ä¸ªç»„çš„æˆå‘˜å…³ç³»è½¬å‘ç»™å…¶ä»–è½¬æ’­è·¯ç”±å™¨ã€‚</p><ul><li>å¤šæ’­è·¯ç”±é€‰åˆ™åè®®</li></ul><p>å¤šæ’­è·¯ç”±é€‰æ‹©åè®®å°šæœªæ ‡å‡†åŒ–ã€‚ï¼ˆæ­¤éƒ¨åˆ†å­¦ä¹ äº†è§£ä¸€ä¸‹å³å¯ï¼‰</p><p>å¤šæ’­è·¯ç”±é€‰æ‹©å®é™…ä¸Šè¦æ‰¾å‡ºä»¥æºä¸»æœºä¸ºæ ¹èŠ‚ç‚¹çš„å¤šæ’­è½¬å‘æ ‘ã€‚è½¬å‘æ•°æ®æŠ¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><p>1ï¼‰<strong>æ´ªæ³›ä¸å‰ªé™¤</strong></p><p>è¿™ç§æ–¹æ³•é€‚ç”¨äºè¾ƒå°çš„å¤šæ’­ç»„ï¼Œæ‰€æœ‰ç»„æˆå‘˜æ¥å…¥çš„å±€åŸŸç½‘ä¹Ÿéƒ½æ˜¯ç›¸é‚»æ¥çš„ã€‚ä½¿ç”¨çš„æ˜¯<strong>åå‘è·¯å¾„å¹¿æ’­</strong>ï¼ˆRPBï¼‰ã€‚</p><p>æ´ªæ³›å°±æ˜¯å¹¿æ’­ï¼Œå‰ªé™¤å°±æ˜¯ã€‚</p><p>æ´ªæ³›ä¸å‰ªé™¤ç¤ºä¾‹ï¼š</p><p><img src="/2021/03/15/network/%E6%B4%AA%E6%B3%9B%E4%B8%8E%E5%89%AA%E9%99%A4.png"></p><p>å¦‚æœå¤šæ’­è½¬å‘æ ‘ä¸Šçš„æŸä¸ªè·¯ç”±å™¨å‘ç°å®ƒçš„ä¸‹æ¸¸æ ‘ææ²¡æœ‰å¤šæ’­ç»„æˆå‘˜ï¼Œåˆ™ä¸‹æ¸¸æ ‘æä¸€èµ·<strong>å‰ªé™¤</strong>ã€‚å›¾ä¸­è™šçº¿æ¤­åœ†å°±æ˜¯å‰ªé™¤ã€‚å½“æœ‰æ–°æˆå‘˜å¢åŠ ï¼Œå†åŠ å›å¤šæ’­è½¬å‘æ ‘ã€‚</p><p>2ï¼‰<strong>éš§é“æŠ€æœ¯</strong></p><p>é€‚ç”¨äºå¤šæ’­ç»„ä½ç½®åœ¨åœ°ç†ä¸Šåˆ†å¸ƒå¾ˆåˆ†æ•£ã€‚</p><p>è·¯ç”±å™¨R1å’ŒR2ä¸æ”¯æŒå¤šæ’­ï¼Œé‚£ä¹ˆR1å’ŒR2éœ€è¦å¯¹å¤šæ’­æ•°æ®æŠ¥å°è£…ï¼Œå†åŠ ä¸Šæ™®é€šæ•°æ®æŠ¥é¦–éƒ¨ï¼Œä½¿ä¹‹æˆä¸ºå‘å•ä¸€ç›®çš„ç«™å‘é€çš„å•æ’­æ•°æ®æŠ¥ï¼Œç„¶åâ€œéš§é“â€ä¸€æ ·ä»R1å‘åˆ°R2ã€‚</p><p><img src="/2021/03/15/network/IP%E5%A4%9A%E6%92%AD%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF.png"></p><p>3ï¼‰<strong>åŸºäºæ ¸å¿ƒçš„å‘ç°æŠ€æœ¯</strong></p><p>å¯¹æ¯ä¸€ä¸ªå¤šæ’­ç»„GæŒ‡å®šä¸€ä¸ªæ ¸å¿ƒè·¯ç”±å™¨ï¼Œç»™å‡ºå®ƒçš„IPå•æ’­åœ°å€ã€‚æ ¸å¿ƒè·¯ç”±å™¨æŒ‰ç…§å‰é¢çš„æ–¹æ³•åˆ›å»ºå‡ºå¤šæ’­ç»„Gçš„è½¬å‘æ ‘ã€‚å¦‚æœæœ‰ä¸€ä¸ªè·¯ç”±å™¨R1å‘æ ¸å¿ƒè·¯ç”±å™¨å‘é€æ•°æ®æŠ¥ï¼Œé‚£ä¹ˆå®ƒé€”ä¸­ç»è¿‡çš„æ¯ä¸€ä¸ªè·¯ç”±å™¨éƒ½è¦æ£€æŸ¥å…¶å†…å®¹ã€‚</p><p>ä¹¦ä¸Šæ²¡è®²æ˜ç™½ï¼ˆP184ï¼‰ã€‚äº†è§£ä¸€ä¸‹ç®—äº†ã€‚</p><h3 id="14-è™šæ‹Ÿä¸“ç”¨ç½‘å’Œç½‘ç»œåœ°å€è½¬æ¢NAT"><a href="#14-è™šæ‹Ÿä¸“ç”¨ç½‘å’Œç½‘ç»œåœ°å€è½¬æ¢NAT" class="headerlink" title="14 è™šæ‹Ÿä¸“ç”¨ç½‘å’Œç½‘ç»œåœ°å€è½¬æ¢NAT"></a>14 è™šæ‹Ÿä¸“ç”¨ç½‘å’Œç½‘ç»œåœ°å€è½¬æ¢NAT</h3><ol><li><strong>è™šæ‹Ÿä¸“ç”¨ç½‘</strong></li></ol><p>IPv4ä¸­æœ‰å†…éƒ¨ç½‘ç»œä¸“ç”¨åœ°å€ï¼ˆä¸ºäº†é˜²æ­¢å’Œå…¬ç½‘åœ°å€é‡å ï¼Œäº§ç”ŸäºŒä¹‰æ€§é—®é¢˜ï¼‰ï¼š</p><p>1ï¼‰<code>10.0.0.0</code> åˆ° <code>10.255.255.255</code>(10.0.0.0/8ï¼Œ24ä½å—)å¯¹åº”Aç±»åœ°å€</p><p>2ï¼‰<code>172.16.0.0</code>åˆ°<code>172.31.255.255</code>(172.16.0.0/12å®ƒåˆç§°ä¸º20ä½å—) å¯¹åº”Bç±»</p><p>3ï¼‰<code>192.168.0.0</code>åˆ°<code>196.168.255.255</code>ï¼ˆ192.168.0.0/16ï¼Œ16ä½å—ï¼‰å¯¹åº”Cç±»</p><p>è¿™æ ·çš„IPåœ°å€å«<strong>ä¸“ç”¨äº’è”ç½‘</strong>æˆ–<strong>æœ¬åœ°äº’è”ç½‘</strong>ã€‚</p><ul><li>åˆ©ç”¨å…¬ç”¨çš„ä½œä¸ºæœ¬æœºæ„ä¸“ç”¨ç½‘ä¹‹é—´çš„é€šä¿¡è½½ä½“ï¼Œè¿™ç§ä¸“ç”¨ç½‘å«<strong>è™šæ‹Ÿä¸“ç”¨ç½‘VPN(Virtual Private Network)<strong>ï¼Œç”¨äºæœºæ„çš„å†…éƒ¨é€šä¿¡ã€‚æ‰€æœ‰ç»è¿‡äº’è”ç½‘ä¼ è¾“çš„</strong>æ•°æ®è¦åŠ å¯†</strong>ã€‚</li><li>IPéš§é“æŠ€æœ¯</li></ul><p>éš§é“æŠ€æœ¯å°±æ˜¯å°è£…ï¼ˆæŠŠåŸæ¥æ•°æ®æ”¾åˆ°æ–°çš„æ•°æ®æŠ¥ï¼Œä»¥æ–¹ä¾¿é€šä¿¡ï¼‰ã€‚</p><p><img src="/2021/03/15/network/%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91%E7%A4%BA%E4%BE%8B.png"></p><p>ä»Xåˆ°Yï¼Œæºåœ°å€Xã€ç›®çš„åœ°å€Y+çœŸå®æ•°æ®æŠ¥ã€‚Aå‘åˆ°äº†R1ï¼ŒR1ä¼šå¯¹æ‰€æœ‰æ•°æ®åŠ å¯†å°è£…ï¼Œå‘ç»™R2.R2åœ¨è§£å¯†ï¼Œå°±çŸ¥é“å‘ç»™Yã€‚</p><p>é€»è¾‘ä¸Šçœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªä»R1åˆ°R2çš„ç›´æ¥è·¯å¾„ï¼ˆå®é™…ä¸Šç»è¿‡äº†å¾ˆå¤šè·¯ç”±å™¨ä¼ è¾“ï¼‰ï¼Œæ‰€ä»¥å«éš§é“ã€‚</p><ol start="2"><li><strong>ç½‘ç»œåœ°å€è½¬æ¢NAT</strong></li></ol><p>åˆ†åˆ°äº†æœ¬åœ°ä¸“ç”¨åœ°å€ï¼ˆå†…éƒ¨ç½‘ç»œä¸“ç”¨åœ°å€ï¼‰ï¼Œä½†æ˜¯éœ€è¦å’Œå¤–ç½‘é€šä¿¡å’‹åŠï¼Ÿ<strong>å…¬ç½‘IPv4åœ°å€å¤ªå°‘å•¦ã€‚</strong></p><p>NATå°±å‡ºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªNATè½¯ä»¶è‡³å°‘æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å…¬ç½‘IPåœ°å€ï¼Œä½¿ç”¨NATåœ°å€è½¬æ¢è¡¨æ¥å¯¹åº”å…¬ç½‘IPåœ°å€ã€‚</p><p><img src="/2021/03/15/network/NAT%E8%B7%AF%E7%94%B1%E8%A1%A8.png"></p><p><img src="/2021/03/15/network/NAT%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png"></p><p>æ¯”å¦‚ä¸»æœºAå‘ä¸»æœºBå‘é€ä¿¡æ¯ï¼ŒNATè·¯ç”±å™¨ä¼šå°†å…¶åœ°å€<code>192.168.0.3</code>æ˜ å°„æˆ<code>172.38.1.5</code>ã€‚Bçœ‹åˆ°çš„Açš„åœ°å€å®é™…ä¸Šå°±æ˜¯NATçš„è¿™ä¸ªåœ°å€ã€‚Bä¸çŸ¥é“Açš„å®é™…åœ°å€æ˜¯ä»€ä¹ˆã€‚Bå‘ç»™Aä¿¡æ¯ç›®çš„åœ°å€å°±å†™NATçš„IPå°±è¡Œã€‚æ”¶åˆ°Bçš„ä¿¡æ¯ï¼ŒNATè·¯ç”±å™¨æ ¹æ®NATè½¬æ¢è¡¨è½¬æˆAçš„<code>192.168.0.3</code>ã€‚</p><p>æœ‰ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å®¶åº­çš„è·¯ç”±å™¨ï¼Œå®é™…å°±ä¸€ä¸ªIPåœ°å€ï¼Œä¸ºä»€ä¹ˆé‚£ä¹ˆå¤šè®¾å¤‡éƒ½èƒ½è®¿é—®å¤–ç½‘ï¼Ÿ</p><p>è™½ç„¶åªæœ‰ä¸€ä¸ªå…¬ç½‘IPåœ°å€ï¼Œä½†æ˜¯å‘æ˜äº†<strong>ç«¯å£å·</strong>ï¼ˆè¿è¾“å±‚ï¼‰å•Šï¼ï¼ï¼</p><p><img src="/2021/03/15/network/NAT%E7%AB%AF%E5%8F%A3%E5%8F%B7.png"></p><p>è¿™ä¸ªæ–°çš„è¡¨å«<strong>ç½‘ç»œåœ°å€ä¸ç«¯å£å·è½¬æ¢NAPT</strong>ã€‚å®é™…ä¸Šç°åœ¨å¾ˆå¤šäººè¿˜æ˜¯å«NATè½¬æ¢è¡¨ã€‚</p><h3 id="15-å¤šåè®®æ ‡è®°äº¤æ¢-MPLS-MultiProtocol-Label-Switching"><a href="#15-å¤šåè®®æ ‡è®°äº¤æ¢-MPLS-MultiProtocol-Label-Switching" class="headerlink" title="15. å¤šåè®®æ ‡è®°äº¤æ¢ MPLS(MultiProtocol Label Switching)"></a>15. å¤šåè®®æ ‡è®°äº¤æ¢ MPLS(MultiProtocol Label Switching)</h3><p>å¢å¼ºIPåŠŸèƒ½çš„åè®®ã€‚é‡‡ç”¨é¢å‘è¿æ¥çš„æŠ€æœ¯ï¼Œæ¯ä¸ªåˆ†ç»„æºå¸¦ä¸€ä¸ªå«åšæ ‡è®°çš„å°æ•´æ•°ã€‚å½“åˆ†ç»„åˆ°è¾¾äº¤æ¢æœºæ—¶ï¼Œäº¤æ¢æœºè¯»å–åˆ†ç»„çš„æ ‡è®°ï¼Œå¹¶é‡‡ç”¨æ ‡è®°å€¼æ¥æ£€ç´¢åˆ†ç»„æ ‡è®°ï¼Œ</p><ul><li>åŸºæœ¬å·¥ä½œè¿‡ç¨‹</li></ul><p>åœ¨ä¼ ç»Ÿçš„IPè·¯ç”±å™¨æŸ¥æ‰¾è·¯ç”±è¡¨æ—¶ï¼Œéœ€è¦æ‰¾æœ€é•¿åŒ¹é…çš„å‰ç¼€ï¼Œè€—æ—¶å¾ˆå¤§ã€‚MPLSå¯¹è¿™ä¸ªè¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><p>åœ¨MPLSå…¥å£å¤„ï¼Œç»™æ¯ä¸€ä¸ªIPæ•°æ®æŠ¥æ‰“ä¸Šå›ºå®šé•¿åº¦çš„æ ‡è®°ï¼Œç„¶åå¯¹æ‰“ä¸Šæ ‡è®°çš„IPæ•°æ®æŠ¥ç”¨ç¡¬ä»¶è½¬å‘ï¼Œé€Ÿåº¦å¤§å¤§åŠ å¿«ã€‚</p><p>ä½¿ç”¨ç¡¬ä»¶æŠ€æœ¯å¯¹æ‰“ä¸Šæ ‡è®°çš„IPæ•°æ®æŠ¥è¿›è¡Œè½¬å‘æˆä¸ºæ ‡è®°äº¤æ¢ï¼Œæ ¹æ®æ ‡è®°åœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆç¡¬ä»¶ï¼‰ä¸Šç›´æ¥è½¬å‘ã€‚</p><p><img src="/2021/03/15/network/MPLS%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png"></p><p>MPLSçš„åŸºæœ¬å·¥ä½œæµç¨‹ä¹¦ä¸­æ²¡ç»†è®²ï¼Œä¸»è¦æœ‰ï¼šï¼ˆäº†è§£ä¸€ä¸‹ï¼‰</p><p>1ï¼‰MPLSåŸŸæŒ‡å„LSRï¼ˆæ ‡è®°äº¤æ¢è·¯ç”±å™¨ï¼‰ä½¿ç”¨ä¸“é—¨çš„<strong>æ ‡è®°åˆ†é…åè®®LDP</strong>äº¤æ¢æŠ¥æ–‡ï¼Œå¹¶æ‰¾å‡ºç‰¹å®šæ ‡è®°ç›¸å¯¹åº”çš„è·¯å¾„ï¼Œå³<strong>æ ‡è®°äº¤æ¢è·¯å¾„LSP</strong>ï¼Œå¦‚å›¾ä¸­çš„ABCDã€‚å„LSRæ ¹æ®è·¯å¾„æ„é€ <strong>è½¬å‘è¡¨</strong>ã€‚</p><p>2ï¼‰IPæ•°æ®æŠ¥è¿›å…¥MPLSå°±ç»™å®ƒæ‰“æ ‡è®°ï¼ŒæŒ‰ç…§è½¬å‘è¡¨å‘ç»™ä¸‹ä¸€ä¸ªLSRã€‚</p><p><img src="/2021/03/15/network/LDP%E5%8D%8F%E8%AE%AE.png"></p><p>3ï¼‰ä¸€ä¸ªæ ‡è®°ä»…ä»…åœ¨ä¸¤ä¸ªæ ‡è®°äº¤æ¢è·¯ç”±å™¨LSRä¹‹é—´æ‰æœ‰æ„ä¹‰ã€‚æ¯ç»è¿‡ä¸€ä¸ªLSRï¼ŒLSRå°±è¦æ›´æ¢æ–°çš„æ ‡è®°å¹¶è½¬å‘ï¼Œå³æŠŠå…¥æ ‡è®°æ¢ä½å‡ºæ ‡è®°ï¼Œè¿™å«æ ‡è®°äº¤æ¢ã€‚</p><p>å¦‚å›¾ä¸­Bä»å…¥å£0æ”¶åˆ°æ ‡è®°ä¸º3çš„åˆ†ç»„ï¼Œè¦å°†å‡ºæ¥å£æ¢ä¸º1å¹¶ä¸”æ ‡è®°é‡æ–°æ‰“1ã€‚</p><p>4ï¼‰æ•°æ®ç¦»å¼€MPLSæ—¶ï¼ŒMPLSçš„å‡ºå£ç»“ç‚¹å°±æŠŠMPLSæ ‡è®°åˆ é™¤ï¼Œäº¤ä»˜éMPLSè·¯ç”±å™¨ï¼ŒæŒ‰ç…§æ™®é€šçš„è½¬å‘è§„åˆ™ç»§ç»­ä¼ é€’ã€‚</p><ul><li>MPLSä¸­çš„é‡è¦æ¦‚å¿µ <strong>FECè½¬å‘ç­‰ä»·ç±»</strong></li></ul><p>è½¬å‘ç­‰ä»·ç±»å°±æ˜¯è·¯ç”±å™¨æŒ‰ç…§åŒæ ·æ–¹å¼å¯¹å¾…çš„IPæ•°æ®æŠ¥çš„é›†åˆï¼Œå³åŒæ ·çš„æ¥å£è½¬å‘åˆ°åŒæ ·çš„ä¸‹ä¸€è·³åœ°å€ï¼Œå…·æœ‰åŒæ ·çš„æœåŠ¡ç±»åˆ«å’ŒåŒæ ·çš„ä¸¢å¼ƒä¼˜å…ˆçº§ç­‰ã€‚</p><p><img src="/2021/03/15/network/FEC%E7%9A%84%E4%BE%8B%E5%AD%90.png"></p><p>åˆ’åˆ†FECçš„æ–¹æ³•ä¸å—é™åˆ¶ï¼Œåªæ¥å—ç®¡ç†å‘˜æ§åˆ¶ã€‚å›¾ä¸­æ˜¯FECç”¨äºè´Ÿè½½å¹³è¡¡çš„ä¾‹å­ã€‚ä¼ ç»Ÿçš„è·¯ç”±é€‰æ‹©H1å’ŒH2åˆ†åˆ«å‘H3å’ŒH4å‘é€ä¿¡æ¯ï¼Œéƒ½åªèƒ½é€‰æ‹©æœ€çŸ­è·¯å¾„ABCï¼Œå¯¼è‡´è¿‡è½½ã€‚FECå¯ä»¥æŒ‡å®šH2é€‰æ‹©ADECã€‚</p><ul><li>MPLSçš„é¦–éƒ¨ä½ç½®å’Œåè®®æ ¼å¼</li></ul><p><img src="/2021/03/15/network/MPLS%E9%A6%96%E9%83%A8%E4%BD%8D%E7%BD%AE.png"></p><p>IPæ•°æ®æŠ¥é¦–éƒ¨ä¹‹é—´æ’å…¥4å­—èŠ‚çš„MPLSé¦–éƒ¨ã€‚æŠŠåŠ ä¸ŠMPLSçš„IPæ•°æ®æŠ¥å°è£…æˆå¸§æ—¶ï¼Œä»¥å¤ªç½‘å­—æ®µå•æ’­æ—¶ä¸º$8847_{16}$å’Œ$8848_{16}$è¿™æ ·æ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨MPLSã€‚</p><p><img src="/2021/03/15/network/MPLS%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F.png"></p><p>1ï¼‰æ ‡è®°å€¼ã€‚ æœ€å¤§$2^{20}$ã€‚åœ¨è®¾ç½®MPLSæ ‡è®°æ—¶å¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„20ä½ã€‚</p><p>2ï¼‰è¯•éªŒã€‚ 3ä½ï¼Œç›®å‰ä¿ç•™ç”¨äºè¯•éªŒã€‚</p><p>3ï¼‰æ ˆS ã€‚1ä½ï¼Œâ€œæ ‡è®°æ ˆâ€æ—¶ä½¿ç”¨ã€‚</p><p>4ï¼‰ç”Ÿå­˜æ—¶é—´TTLã€‚ 8ä½ï¼Œé˜²æ­¢MPLSåœ¨MPLSå…œåœˆå­ã€‚</p><h2 id="è¿è¾“å±‚"><a href="#è¿è¾“å±‚" class="headerlink" title="è¿è¾“å±‚"></a>è¿è¾“å±‚</h2><h3 id="1-è¿è¾“å±‚åè®®æ¦‚è¿°"><a href="#1-è¿è¾“å±‚åè®®æ¦‚è¿°" class="headerlink" title="1. è¿è¾“å±‚åè®®æ¦‚è¿°"></a>1. è¿è¾“å±‚åè®®æ¦‚è¿°</h3><p>ç«¯åˆ°ç«¯çš„é€šä¿¡å®é™…ä¸Šæ˜¯ä¸¤ä¸ªä¸»æœºä¸­çš„åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>è¿è¾“å±‚â€œå¤ç”¨â€å’Œâ€œåˆ†ç”¨â€ã€‚å¤ç”¨æŒ‡çš„æ˜¯å‘é€æ–¹ä¸åŒçš„åº”ç”¨è¿›ç¨‹éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿è¾“å±‚åè®®ä¼ é€æ•°æ®ï¼Œè€Œâ€œåˆ†ç”¨â€æ˜¯æŒ‡æ¥æ”¶æ–¹çš„è¿è¾“å±‚åœ¨å‰¥å»æŠ¥æ–‡çš„é¦–éƒ¨åèƒ½å¤ŸæŠŠè¿™äº›æ•°æ®æ­£ç¡®äº¤ä»˜ç›®çš„åº”ç”¨è¿›ç¨‹ã€‚</p><p><img src="/2021/03/15/network/%E8%BF%90%E8%BE%93%E5%B1%82.png"></p><p>è¿è¾“å±‚çš„ä¸¤ä¸ªä¸»è¦åè®®ï¼šUDP(User Datagram Protocol)å’ŒTCP(Transmission Control Protocol)ã€‚</p><p><img src="/2021/03/15/network/%E8%BF%90%E8%BE%93%E5%B1%82%E4%B8%A4%E4%B8%AA%E5%8D%8F%E8%AE%AE.png"></p><p>æŒ‰ç…§OSIçš„æœ¯è¯­ï¼Œä¸¤ä¸ªå¯¹ç­‰è¿è¾“å®ä½“åœ¨é€šä¿¡æ—¶ä¼ é€çš„æ•°æ®å•ä½å«<strong>è¿è¾“åè®®æ•°æ®å•å…ƒ</strong>ã€‚</p><p><img src="/2021/03/15/network/%E4%BD%BF%E7%94%A8UDP%E5%92%8CTCP%E7%9A%84%E4%B8%8D%E5%90%8C%E5%8D%8F%E8%AE%AE.png"></p><p><strong>åè®®ç«¯å£å·</strong>é€šå¸¸åˆç§°ä¸º<strong>ç«¯å£</strong>ï¼Œè™½ç„¶é€šä¿¡çš„ç»ˆç‚¹æ˜¯åº”ç”¨è¿›ç¨‹ï¼Œä½†åªè¦æŠŠæ‰€ä¼ é€çš„æŠ¥æ–‡äº¤åˆ°ç›®çš„ä¸»æœºçš„æŸä¸ªåˆé€‚çš„ç›®çš„ç«¯å£ï¼Œå‰©ä¸‹çš„å·¥ä½œäº¤ç”±TCPæˆ–UDPæ¥å®Œæˆã€‚ï¼ˆè¿™é‡Œçš„ç«¯å£ä¸»ä¹‰å’Œäº¤æ¢æœºæˆ–è·¯ç”±å™¨ä¸Šçš„ç«¯å£åŒºåˆ†ï¼Œé‚£ä¸ªæ˜¯ç¡¬ä»¶ç«¯å£ï¼Œè¿™ä¸ªæ˜¯è½¯ä»¶ç«¯å£ï¼‰ã€‚</p><p>TCP/IPè¿è¾“å±‚ç”¨ä¸€ä¸ª16ä½ï¼ˆ<strong>å…±65535ä¸ª</strong>ï¼‰çš„ç«¯å£å·æ¥æ ‡å¿—ä¸€ä¸ªç«¯å£ã€‚ç«¯å£å·åªå…·æœ‰æœ¬åœ°æ„ä¹‰ï¼Œå®ƒåªæ˜¯æ ‡è®°æœ¬è®¡ç®—æœºåº”ç”¨å±‚ä¸­çš„å„ä¸ªè¿›ç¨‹åœ¨è¿è¾“å±‚äº¤äº’æ—¶çš„å±‚é—´æ¥å£ã€‚</p><p>é€šä¿¡æ—¶ï¼Œ<strong>ä¸ä»…è¦çŸ¥é“å¯¹æ–¹çš„IPåœ°å€ï¼Œè¿˜è¦çŸ¥é“å¯¹æ–¹çš„ç«¯å£å·</strong>ã€‚</p><ul><li><strong>æœåŠ¡ç«¯</strong>ä½¿ç”¨çš„ç«¯å£å·ã€‚</li></ul><p>1ï¼‰ç†ŸçŸ¥ç«¯å£å·æˆ–ç³»ç»Ÿç«¯å£å·</p><p>æ•°å€¼ 0~1023ã€‚</p><p><img src="/2021/03/15/network/%E7%86%9F%E7%9F%A5%E7%AB%AF%E5%8F%A3%E5%8F%B7.png"></p><p>2ï¼‰ç™»è®°ç«¯å£å·ã€‚æ•°å€¼ 1024~49151ã€‚è¿™ç±»ç«¯å£å·ä¸ºäº†æ²¡æœ‰ç†ŸçŸ¥ç«¯å£å·çš„åº”ç”¨ç¨‹åºä½¿ç”¨çš„ã€‚</p><ul><li><strong>å®¢æˆ·ç«¯</strong>ä½¿ç”¨çš„ç«¯å£å·</li></ul><p>æ•°å€¼ä¸º49152~65535ã€‚è¿™ç±»ç«¯å£å·ä»…åœ¨å®¢æˆ·è¿›ç¨‹è¿è¡Œæ—¶æ‰åŠ¨æ€é€‰æ‹©ï¼Œå› æ­¤åˆå«<strong>çŸ­æš‚ç«¯å£å·</strong>ã€‚</p><h3 id="2-UDP-ç”¨æˆ·æ•°æ®æŠ¥åè®®"><a href="#2-UDP-ç”¨æˆ·æ•°æ®æŠ¥åè®®" class="headerlink" title="2. UDP ç”¨æˆ·æ•°æ®æŠ¥åè®®"></a>2. UDP ç”¨æˆ·æ•°æ®æŠ¥åè®®</h3><p>UDP(User Datagram Protocol)åªåœ¨IPçš„æ•°æ®æŠ¥æœåŠ¡ä¸Šå¢åŠ äº†å¾ˆå°‘çš„ä¸€ç‚¹åŠŸèƒ½ã€‚</p><p>1ï¼‰æ— è¿æ¥çš„ã€‚å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå‡å°‘å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚</p><p>2ï¼‰å°½æœ€å¤§åŠªåŠ› äº¤ä»˜ã€‚ä¸éœ€è¦ç»´æŠ¤å¤æ‚çš„è¿æ¥çŠ¶å†µã€‚</p><p>3ï¼‰é¢å‘æŠ¥æ–‡çš„ã€‚å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åäº¤ä»˜IPå±‚ã€‚<strong>UDPä¸€æ¬¡äº¤ä»˜ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡</strong>ã€‚å¦‚æœæŠ¥æ–‡å¤ªé•¿ï¼ŒIPä¼šå¯¹å…¶è¿›è¡Œåˆ†ç‰‡ï¼Œé™ä½IPå±‚çš„æ•ˆç‡ã€‚</p><p><img src="/2021/03/15/network/UDP%E9%9D%A2%E5%90%91%E6%8A%A5%E6%96%87.png"></p><p>4ï¼‰æ²¡æœ‰æ‹¥å¡æ§åˆ¶ã€‚ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºå‘é€é€Ÿç‡é™ä½ã€‚è¿™å¯¹å®æ—¶åº”ç”¨å¾ˆé‡è¦ã€‚</p><p>5ï¼‰UDPæ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€ï¼Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚</p><p>6ï¼‰UDPçš„é¦–éƒ¨å¼€é”€å°‘ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ¯”TCPçš„20å­—èŠ‚è¦çŸ­ã€‚</p><h3 id="3-UDPçš„é¦–éƒ¨æ ¼å¼"><a href="#3-UDPçš„é¦–éƒ¨æ ¼å¼" class="headerlink" title="3.UDPçš„é¦–éƒ¨æ ¼å¼"></a>3.UDPçš„é¦–éƒ¨æ ¼å¼</h3><p><img src="/2021/03/15/network/UDP%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F.png"></p><p>æ•°æ®å­—æ®µå’Œé¦–éƒ¨å­—æ®µã€‚é¦–éƒ¨å­—æ®µä¸­åˆ’åˆ†çš„æ¯ä¸ªå­—æ®µ<strong>éƒ½æ˜¯ä¸¤ä¸ªå­—èŠ‚</strong>ã€‚</p><p>1ï¼‰æºç«¯å£ æºç«¯å£å·ã€‚åœ¨éœ€è¦å¯¹æ–¹å›ä¿¡æ—¶é€‰ç”¨ï¼Œä¸éœ€è¦æ—¶å…¨ç”¨0ã€‚</p><p>2ï¼‰ç›®çš„ç«¯å£ ç›®çš„ç«¯å£å·ã€‚ç»ˆç‚¹äº¤ä»˜æ—¶å¿…é¡»ä½¿ç”¨ã€‚</p><p>3ï¼‰é•¿åº¦ UDPç”¨æˆ·æ•°æ®æŠ¥çš„é•¿åº¦ï¼Œæœ€å°å€¼8ï¼ˆä»…æœ‰é¦–éƒ¨ï¼‰ã€‚</p><p>4ï¼‰ æ£€éªŒå’Œ æ£€æµ‹UDPç”¨æˆ·æ•°æ®æŠ¥åœ¨ä¼ è¾“æ—¶æ˜¯å¦æœ‰é”™ã€‚æœ‰é”™å°±ä¸¢å¼ƒã€‚</p><p>UDPåŸºäºç«¯å£çš„å¤ç”¨ï¼š</p><p><img src="/2021/03/15/network/UDP%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%A4%8D%E7%94%A8.png"></p><p>æ¯”å¦‚UDPå‘ç°ç«¯å£å·ä¸æ­£ç¡®ï¼Œä¸¢å¼ƒè¯¥æŠ¥æ–‡ï¼Œç”±ICMPå‘é€ç«¯å£ä¸å¯è¾¾å·®é”™æŠ¥æ–‡ç»™å‘é€æ–¹ã€‚</p><p>UDPè®¡ç®—æ£€éªŒå’Œï¼ŒUDPè¦åœ¨ç”¨æˆ·æ•°æ®æŠ¥ä¹‹å‰åŠ ä¸Š<strong>12ä¸ªå­—èŠ‚çš„ä¼ªé¦–éƒ¨</strong>ã€‚è®¡ç®—æ£€éªŒå’Œæ—¶<strong>ä¸´æ—¶</strong>åŠ åœ¨æ•°æ®æŠ¥å‰ï¼Œå¾—åˆ°ä¸´æ—¶çš„UDPæ•°æ®æŠ¥ã€‚æ£€éªŒå’Œå°±æ˜¯æŒ‰ç…§è¿™ä¸ªä¸´æ—¶çš„UDPç”¨æˆ·æ•°æ®åŒ…æ¥è¿›è¡Œè®¡ç®—ã€‚<strong>ä¼ªé¦–éƒ¨ä¸å‘ä¸Šä¼ é€’ä¹Ÿä¸æƒ³ä¸‹ä¼ é€’</strong>ï¼Œåªæ˜¯ä¸ºäº†è®¡ç®—æ£€éªŒå’Œã€‚</p><p>UDPçš„æ£€éªŒå’Œæ˜¯æŠŠé¦–éƒ¨å’Œæ•°æ®éƒ¨åˆ†ä¸€èµ·æ£€éªŒï¼ˆå’ŒIPåªæ£€éªŒé¦–éƒ¨ä¸åŒï¼‰ã€‚</p><p><img src="/2021/03/15/network/%E8%AE%A1%E7%AE%97UDP%E6%A3%80%E9%AA%8C%E5%92%8C.png"></p><p>å‘é€æ–¹æŠŠæ£€éªŒå’Œå­—æ®µè®°ä¸º0ã€‚ä¼ªé¦–éƒ¨ä»¥åŠUDPæ•°æ®æŠ¥çœ‹æˆè®¸å¤š16ä½å­ä¸²ã€‚è‹¥UDPæ•°æ®éƒ¨åˆ†ä¸æ˜¯å¶æ•°å­—èŠ‚ï¼Œéœ€è¦å¡«å…¥ä¸€ä¸ªå…¨é›¶å­—èŠ‚ï¼ŒæŒ‰ç…§<strong>äºŒè¿›åˆ¶åç </strong>è®¡ç®—å‡º16ä½å­—çš„å’Œã€‚å°†æ­¤äºŒè¿›åˆ¶åç å†™å…¥æ£€éªŒå’Œå­—æ®µï¼Œå‘é€ç»™ç›®çš„ä¸»æœºã€‚</p><p>æ¥æ”¶æ–¹æ”¶åˆ°UDPï¼ŒæŒ‰äºŒè¿›åˆ¶åç æ±‚16ä½å­—çš„å’Œï¼Œæ— å·®é”™å…¶ç»“æœåº”å…¨ä¸º1ã€‚å¦åˆ™å°±è¡¨æ˜å·®é”™å‡ºç°ã€‚</p><p>å·®é”™æ£€éªŒèƒ½åŠ›å¹¶ä¸å¼ºï¼Œä½†ç®€å•å¿«é€Ÿã€‚</p><h3 id="4-ä¼ è¾“æ§åˆ¶åè®®TCP"><a href="#4-ä¼ è¾“æ§åˆ¶åè®®TCP" class="headerlink" title="4.ä¼ è¾“æ§åˆ¶åè®®TCP"></a>4.ä¼ è¾“æ§åˆ¶åè®®TCP</h3><p>1ï¼‰ é¢å‘è¿æ¥ã€‚æ‰“ç”µè¯ä¸€æ ·ï¼Œé€šä¿¡ä¹‹å‰éœ€è¦æ‹¨å·å»ºç«‹è¿æ¥ï¼Œç»“æŸæ—¶éœ€è¦æŒ‚æ–­ç»“æŸè¿æ¥ã€‚</p><p>2ï¼‰TCPåªèƒ½<strong>ç‚¹å¯¹ç‚¹</strong>ã€‚ ç«¯ç‚¹å¯¹ç«¯ç‚¹ã€‚</p><p>3ï¼‰TCPæä¾›<strong>å¯é äº¤ä»˜</strong>çš„æœåŠ¡ã€‚ å¯ä»¥æ£€æŸ¥ä¼ é€çš„æ•°æ®æ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤å¹¶ä¸”æŒ‰åºåˆ°è¾¾ã€‚</p><p>4ï¼‰å…¨åŒå·¥é€šä¿¡ã€‚é€šä¿¡åŒæ–¹çš„åº”ç”¨è¿›ç¨‹åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘é€æ•°æ®ã€‚</p><p>5ï¼‰é¢å‘å­—èŠ‚æµã€‚ æµ æŒ‡çš„æ˜¯æµå…¥è¿›ç¨‹æˆ–è€…ä»è¿›ç¨‹æµå‡ºçš„å­—èŠ‚åºåˆ—ã€‚è™½ç„¶åº”ç”¨è¿›ç¨‹å’ŒTCPçš„äº¤äº’æ˜¯ä¸€æ¬¡ä¸€ä¸ªæ•°æ®å—ï¼Œä½†æ˜¯TCPæŠŠè¿™äº›æ•°æ®çœ‹æˆæ˜¯ä¸€è¿ä¸²çš„æ— ç»“æ„çš„å­—èŠ‚æµã€‚TCPå¹¶ä¸çŸ¥é“æ‰€ä¼ é€çš„å­—èŠ‚æµçš„å«ä¹‰ã€‚TCPåªä¿è¯æ”¶åˆ°çš„å­—èŠ‚æµå’Œå‘é€çš„å­—èŠ‚æµä¸€æ ·ã€‚</p><p><img src="/2021/03/15/network/TCP%E5%AD%97%E8%8A%82%E6%B5%81.png"></p><ul><li>TCPçš„è¿æ¥</li></ul><p>$å¥—æ¥å­— socket=(IPåœ°å€ : ç«¯å£å·)$ </p><p>TCPè¿æ¥ : :=${socket_1,socket_2}={(IP_1 : port_1),(IP_2,port_2)} $</p><ul><li>å¯é ä¼ è¾“åŸç†</li></ul><p>1ï¼‰ åœæ­¢ç­‰å¾…åè®®</p><p><img src="/2021/03/15/network/%E5%81%9C%E6%AD%A2%E7%AD%89%E5%BE%85%E5%8D%8F%E8%AE%AE.png"></p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼ŒAå‘é€M1ï¼ŒBæ”¶åˆ°å‘é€ç¡®è®¤M1ï¼ŒAæ”¶åˆ°ç¡®è®¤ç»§ç»­å‘é€ã€‚</p><p>è¶…æ—¶æƒ…å†µä¸‹ï¼ŒAå‘é€çš„M1å¯èƒ½ä¸¢å¤±æˆ–è€…é”™è¯¯ï¼ŒBæ²¡æ”¶åˆ°æˆ–è€…æ”¶åˆ°é”™è¯¯çš„ä¼šæ²¡æœ‰ä»»ä½•å“åº”ã€‚Aä¸€æ®µæ—¶é—´æ²¡æ”¶åˆ°ç¡®è®¤éœ€è¦é‡å‘ã€‚</p><p>æ‰€ä»¥ï¼Œéœ€è¦æ³¨æ„çš„è¦ç‚¹æ˜¯ï¼š</p><p>1ï¼‰Aå‘é€åå¿…é¡»ä¿ç•™å‘é€æ•°æ®çš„å‰¯æœ¬ï¼Œä»¥å¤‡é‡ä¼ ã€‚</p><p>2ï¼‰åˆ†ç»„å’Œç¡®è®¤åˆ†ç»„éƒ½éœ€è¦ç¼–å·ï¼Œç¡®è®¤å“ªä¸ªæ²¡æ”¶åˆ°å“ªä¸ªæ”¶åˆ°ã€‚</p><p>3ï¼‰åˆç†çš„è¶…æ—¶é‡ä¼ æ—¶é—´ååˆ†é‡è¦ã€‚</p><ul><li>ç¡®è®¤ä¸¢å¤±å’Œç¡®è®¤è¿Ÿåˆ°</li></ul><p><img src="/2021/03/15/network/%E7%A1%AE%E8%AE%A4%E4%B8%A2%E5%A4%B1%E5%92%8C%E8%BF%9F%E5%88%B0.png"></p><p>å›¾ä¸­açš„æƒ…å†µï¼š</p><p>1ï¼‰Bçš„ç¡®è®¤ä¸¢å¤±ï¼ŒAé‡å‘ï¼ŒBåˆæ”¶åˆ°M1ï¼Œéœ€è¦å°†M1æ‰”æ‰ã€‚</p><p>2ï¼‰Béœ€è¦é‡å‘M1ç¡®è®¤æŠ¥æ–‡ï¼ŒAå‘äº†ä¸¤æ¬¡M1è¯´æ˜æ²¡æ”¶åˆ°ç¡®è®¤ã€‚</p><p>å›¾ä¸­bçš„æƒ…å†µï¼š</p><p>Bçš„ç¡®è®¤æŠ¥æ–‡å› ä¸ºç¬¬ä¸€æ¬¡çš„æŠ¥æ–‡è¿Ÿåˆ°äº†ï¼Œæ‰€ä»¥Aè¦ä¸¢å¼ƒä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ã€‚</p><p><img src="/2021/03/15/network/TCP%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%871.png"></p><p><img src="/2021/03/15/network/TCP%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%87.png"></p><p>Uè¡¨ç¤ºä¿¡é“åˆ©ç”¨ç‡ã€‚Aå‘é€åˆ†ç»„æ—¶é—´æ˜¯$T_D$ï¼Œæ”¶åˆ°ç¡®è®¤æ—¶é—´æ˜¯$T_A$ã€‚å¯ä»¥å‘ç°è¿™æ ·ä¿¡é“åˆ©ç”¨ç‡æ¯”è¾ƒä½ï¼Œå¾ˆé•¿æ—¶é—´æ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªæ•°æ®ï¼Œå‘æ˜äº†æµæ°´çº¿å‘é€ï¼šï¼ˆARQåè®®æˆ–æ»‘åŠ¨çª—å£åè®®ï¼‰</p><p><img src="/2021/03/15/network/TCP%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%8F%91%E9%80%81.png"></p><ul><li>è¿ç»­ARQåè®®ã€‚</li></ul><p><img src="/2021/03/15/network/%E8%BF%9E%E7%BB%ADARQ%E5%8D%8F%E8%AE%AE.png"></p><p>å‘é€çª—å£ï¼Œä¸€ä¸‹å­å‘é€5ä¸ªåˆ†ç»„ã€‚æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œçª—å£å°±å‘å‰æ»‘åŠ¨ä¸€ä¸ªã€‚</p><p><strong>ç´¯ç§¯ç¡®è®¤æ–¹å¼ï¼ŒæŒ‰åºåˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„ç¡®è®¤</strong>ã€‚ä¾‹å¦‚ï¼Œ12345ä¸­çš„3ä¸¢äº†ï¼Œä¼šæ”¶åˆ°2çš„ç¡®è®¤æŠ¥æ–‡ï¼Œå› ä¸ºåªæœ‰12æ˜¯æœ‰åºçš„ï¼Œè¿™é‡Œå°±è¦é‡æ–°å‘345ã€‚</p><ul><li><strong>é¦–éƒ¨æŠ¥æ–‡æ ¼å¼</strong></li></ul><p><img src="/2021/03/15/network/TCP%E7%9A%84%E9%A6%96%E9%83%A8%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.png"></p><p>é¦–éƒ¨å›ºå®š20å­—èŠ‚ï¼Œå¯é€‰40å­—èŠ‚ï¼Œé¦–éƒ¨æœ€é•¿60å­—èŠ‚ã€‚</p><ul><li><p>æºç«¯å£ ç›®çš„ç«¯å£ ã€‚å¦‚å­—é¢æ„æ€ã€‚</p></li><li><p>åºå·ã€‚ 4å­—èŠ‚ï¼Œ$[0,2^{32}-1]$ï¼Œåºå·å¢åŠ åˆ°$2^{32}-1$åé‡æ–°ä»0å¼€å§‹å‘ã€‚æ¯ä¸€ä¸ªå­—èŠ‚éƒ½æŒ‰é¡ºåºç¼–å·ï¼Œå½“å‰å‘äº†301-400å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæŠ¥æ–‡çš„åºå·æ˜¯401ã€‚</p></li><li><p>ç¡®è®¤ã€‚ <strong>æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºå·</strong>ã€‚æ¯”å¦‚Bæ”¶åˆ°äº†Aå‘é€è¿‡æ¥çš„501-600çš„æ•°æ®ã€‚åˆ™å‘é€601ç¡®è®¤ã€‚è‹¥ç¡®è®¤å·ç­‰äºNï¼Œåˆ™N-1ä¸ªå­—èŠ‚éƒ½æ”¶åˆ°äº†ã€‚</p></li><li><p>æ•°æ®åç§»ã€‚ å 4ä½ã€‚è®°å½•æ•°æ®çš„èµ·å§‹å­—æ®µè·ç¦»TCPæŠ¥æ–‡èµ·å§‹è·ç¦»å¤šè¿œã€‚æ•°æ®åç§»çš„å•ä½æ˜¯32ä½å­—ï¼ˆä»¥4å­—èŠ‚ä½œä¸ºåŸºæœ¬å•ä½ï¼‰ï¼Œæ‰€ä»¥æœ€å¤§è¿™ä¸ªå­—æ®µå 4ä½æœ€å¤§15ï¼Œ15*4=60å­—èŠ‚ã€‚æ‰€ä»¥TCPçš„é¦–éƒ¨é•¿åº¦æœ€å¤§60å­—èŠ‚ã€‚</p></li><li><p>ä¿ç•™ã€‚ å 6ä½ï¼Œä¿ç•™ä»Šåä½¿ç”¨ã€‚</p></li><li><p>ç´§æ€¥URGã€‚ URG=1æ—¶ï¼Œç´§æ€¥æ•°æ®åº”è¯¥ä¸èƒ½æ’é˜Ÿç›´æ¥ä¼˜å…ˆå‘é€åˆ†ç»„ã€‚</p></li><li><p>ç¡®è®¤ACKã€‚ è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½ä¸º1ã€‚</p></li><li><p>æ¨é€PSHã€‚ æ¥æ”¶æ–¹æ”¶åˆ°PSH=1æ—¶ï¼Œä¸èƒ½ç­‰ç¼“å†²åŒºæ»¡æ‰äº¤ä»˜ä¸Šå±‚ï¼Œè¦ç›´æ¥äº¤ä»˜ï¼Œäº‹æƒ…ç´§æ€¥ã€‚</p></li><li><p>å¤ä½RSTã€‚ RST=1è¡¨ç¤ºTCPå‘ç”Ÿä¸¥é‡é”™è¯¯ï¼Œè¦é‡Šæ”¾è¿æ¥ã€‚RST=1è¿˜å¯æ‹’ç»ä¸€ä¸ªéæ³•æŠ¥æ–‡æ®µã€‚</p></li><li><p>åŒæ­¥SYNã€‚ åœ¨å»ºç«‹è¿æ¥æ—¶æ¥åŒæ­¥åºå·ã€‚å½“SYN=1è€ŒACK=0æ—¶ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™åº”åœ¨å“åº”çš„æŠ¥æ–‡æ®µä¸­ä½¿SYN=1å’ŒACK=1ã€‚å› æ­¤SYNç½®1å°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æˆ–è¿æ¥æ¥å—æŠ¥æ–‡ã€‚</p></li><li><p>ç»“æŸFINã€‚ ç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ã€‚å½“FIN=1æ—¶ï¼Œè¡¨æ˜æŠ¥æ–‡æ®µå‘é€æ–¹çš„æ•°æ®å·²å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿è¾“è¿æ¥ã€‚</p></li><li><p>çª—å£ã€‚ 2å­—èŠ‚ã€‚çª—å£å€¼æ˜¯[0,$2^{16}-1$]ä¹‹é—´çš„æ•´æ•°ã€‚çª—å£æŒ‡çš„æ˜¯å‘é€æŠ¥æ–‡æ®µçš„ä¸€æ–¹çš„æ¥æ”¶çª—å£ã€‚çª—å£å€¼å‘Šè¯‰å¯¹æ–¹ï¼Œä»æœ¬æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­çš„ç¡®è®¤å·ç®—èµ·ï¼Œæ¥æ”¶æ–¹ç›®å‰å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼Œè¿™æ˜¯å› ä¸ºæ¥æ”¶æ–¹çš„æ•°æ®ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ã€‚çª—å£å€¼ä½œä¸ºæ¥æ”¶æ–¹è®©å‘é€æ–¹è®¾ç½®å…¶å‘é€çª—å£çš„ä¾æ®ã€‚</p></li><li><p>æ£€éªŒå’Œã€‚ å 2å­—èŠ‚ã€‚æ£€éªŒå’Œå­—æ®µæ£€éªŒçš„èŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ã€‚</p></li><li><p>ç´§æ€¥æŒ‡é’ˆã€‚ å 2å­—èŠ‚ã€‚ä»…åœ¨URG=1æ—¶æœ‰æ„ä¹‰ã€‚æŒ‡å‡ºæœ¬æŠ¥æ–‡æ®µä¸­ç´§æ€¥æ•°æ®çš„å­—èŠ‚æ•°ã€‚ç´§æ€¥æŒ‡é’ˆæŒ‡å‡ºäº†ç´§æ€¥æ•°æ®çš„æœ«å°¾åœ¨æŠ¥æ–‡æ®µä¸­çš„ä½ç½®</p></li><li><p>é€‰é¡¹ã€‚æœ€é•¿å¯è¾¾40å­—èŠ‚ã€‚å½“æ²¡æœ‰é€‰é¡¹æ—¶ï¼ŒTCPçš„é¦–éƒ¨æ˜¯20å­—èŠ‚ã€‚</p></li></ul><h3 id="5-TCPå¯é ä¼ è¾“çš„å®ç°"><a href="#5-TCPå¯é ä¼ è¾“çš„å®ç°" class="headerlink" title="5. TCPå¯é ä¼ è¾“çš„å®ç°"></a>5. TCPå¯é ä¼ è¾“çš„å®ç°</h3><ol><li>ä»¥å­—èŠ‚ä¸ºå•ä½çš„æ»‘åŠ¨çª—å£</li></ol><p><img src="/2021/03/15/network/%E6%9E%84%E9%80%A0%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3.png"></p><p>å‘é€æ–¹Açš„å‘é€çª—å£ï¼Œå‘é€çª—å£è¡¨ç¤ºåœ¨æ²¡æœ‰æ”¶åˆ°Bç¡®è®¤çš„æƒ…å†µä¸‹ï¼ŒAå¯ä»¥è¿ç»­æŠŠçª—å£å†…çš„æ•°æ®éƒ½å‘å‡ºå»ã€‚å‡¡æ˜¯å‘è¿‡çš„æ•°æ®éƒ½è¦æš‚æ—¶å¤‡ä»½ï¼Œä»¥ä¾¿è¶…æ—¶é‡ä¼ ã€‚</p><p>TCPæ ‡å‡†ä¸åŒæ„çª—å£å‰æ²¿å‘åæ”¶ç¼©ï¼Œå› ä¸ºæœ‰å¯èƒ½å·²ç»å‘é€è¿‡ï¼Œæ”¶ç¼©åè¡¨ç¤ºæ²¡æ³•é€è¿™äº›æ•°æ®ï¼Œä¼šäº§ç”Ÿé”™è¯¯ã€‚</p><p><img src="/2021/03/15/network/%E5%8F%91%E9%80%81%E7%AA%97%E5%8F%A3.png"></p><p>p3-p1 å‘é€çª—å£</p><p>P2-P1 å·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤ã€‚</p><p>P3-P2 å…è®¸å‘é€ä½†æœªå‘é€ï¼ˆå¯ç”¨çª—å£æˆ–æœ‰æ•ˆçª—å£ï¼‰</p><p>è¯¦ç»†çš„çª—å£æ»‘åŠ¨è·ç¦»å¯ä»¥å‚è€ƒä¹¦ P 222ã€‚åªè¦æ˜ç™½ç¡®è®¤å·æ˜¯æœ‰åºåºåˆ—çš„ä¸‹ä¸€ä¸ªï¼Œéƒ½èƒ½è¯´å¯¹ã€‚</p><p><img src="/2021/03/15/network/TCP%E7%BC%93%E5%AD%98%E5%92%8C%E7%AA%97%E5%8F%A3%E7%9A%84%E5%85%B3%E7%B3%BB.png"></p><p>å‘é€æ–¹ï¼š</p><p>å‘é€çª—å£åªæ˜¯å‘é€ç¼“å­˜çš„ä¸€éƒ¨åˆ†ã€‚å·²ç¡®è®¤çš„æ•°æ®åº”è¯¥ä»ç¼“å­˜åˆ é™¤ï¼Œå› æ­¤å‘é€çª—å£å’Œç¼“å­˜çš„åæ²¿æ˜¯é‡åˆçš„ã€‚</p><p>æ¥æ”¶æ–¹ï¼š</p><p>ç¼“å­˜å­˜æ”¾æŒ‰åºåˆ°è¾¾ã€ä½†å°šæœªè¢«åº”ç”¨ç¨‹åºè¯»å–çš„æ•°æ®ã€‚æœªæŒ‰åºåˆ°è¾¾çš„æ•°æ®ã€‚</p><p>è¦ç‚¹ï¼š</p><p>1ï¼‰Açš„å‘é€çª—å£æ˜¯æ ¹æ®Bçš„æ¥æ”¶çª—å£è®¾ç½®çš„ï¼Œä½†åŒä¸€æ—¶åˆ»Açš„å‘é€çª—å£å¹¶ä¸å’ŒBçš„æ¥æ”¶çª—å£ä¸€æ ·å¤§ï¼ˆç½‘ç»œä¼ é€çª—å£å€¼éœ€è¦ç»å†ä¸€å®šçš„æ—¶é—´æ»åï¼‰ã€‚Aå¯èƒ½è¿˜è¦æ ¹æ®ç½‘ç»œæ‹¥å¡æƒ…å†µæ§åˆ¶å‘é€çª—å£çš„æ•°å€¼ã€‚</p><p>2ï¼‰æ¥æ”¶æ–¹éƒ½æ˜¯ç´¯ç§¯ç¡®è®¤ã€‚ä½†æ˜¯ä¸åº”è¯¥è¿‡åˆ†æ¨è¿Ÿå‘é€ç¡®è®¤ï¼Œå¦åˆ™ä¼šå¯¼è‡´å‘é€æ–¹ä¸å¿…è¦çš„é‡ä¼ ã€‚</p><ol start="2"><li>è¶…æ—¶é‡ä¼ æ—¶é—´é€‰æ‹©</li></ol><p>ä½¿ç”¨<strong>è‡ªé€‚åº”ç®—æ³•</strong>è®¾ç½®é‡ä¼ æ—¶é—´ã€‚</p><p>è®°å½•æŠ¥æ–‡å‘å‡ºçš„æ—¶é—´ï¼Œä»¥åŠæ”¶åˆ°ç›¸åº”çš„ç¡®è®¤æ—¶é—´ï¼Œæ—¶é—´å·®å°±æ˜¯<strong>æŠ¥æ–‡æ®µçš„å¾€è¿”æ—¶é—´RTT</strong>ã€‚TCPä¿ç•™RTTçš„åŠ æƒå¹³å‡å¾€è¿”æ—¶é—´ã€‚</p><p><img src="/2021/03/15/network/TCP%E5%BE%80%E8%BF%94%E6%97%B6%E9%97%B4.png"></p><p>å»ºè®®$\alpha$=1/8ã€‚ç¡®è®¤é‡ä¼ æ—¶é—´RTOï¼š</p><p><img src="/2021/03/15/network/TCP%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%97%B6%E9%97%B4.png"></p><p>$æ–°çš„RTT_{D}=ï¼ˆ1-\beta)\times(æ—§çš„RTT_{D})+\beta \times |RTT_{s}-æ–°çš„RTTæ ·æœ¬|$</p><p>$\beta=0.25$</p><p><img src="/2021/03/15/network/TCP%E9%87%8D%E4%BC%A0%E6%97%B6%E9%97%B4%E7%A4%BA%E4%BE%8B.png"></p><p>æ­£å¸¸çš„RTOæŒ‰ç…§ä¸Šé¢å…¬å¼è®¡ç®—å³å¯ã€‚å¯¹äºéœ€è¦é‡ä¼ çš„æ•°æ®ï¼Œæ¯æ¬¡é‡ä¼ ä¸€æ¬¡ï¼Œå°±ç›´æ¥æŠŠRTO=2*RTOã€‚ä¸¤å€çš„åŸæ¥çš„RTOå°±è¡Œã€‚</p><ol start="3"><li>é€‰æ‹©ç¡®è®¤SACK</li></ol><p><img src="/2021/03/15/network/SACK%E5%AD%97%E8%8A%82%E6%B5%81%E4%B8%8D%E8%BF%9E%E7%BB%AD.png"></p><p><strong>ä¸ºäº†å‡å°‘ä¸å¿…è¦çš„é‡ä¼ </strong>ã€‚æ¯ä¸€ä¸ªå­—èŠ‚å—éƒ½æœ‰ä¸¤ä¸ªè¾¹ç•Œï¼Œä¾‹å¦‚å›¾ä¸­çš„L1å’ŒR1æ¥æ ‡è®°æ¥æ”¶æ–¹æ”¶åˆ°çš„å­—èŠ‚ã€‚é¦–éƒ¨å¯å˜é€‰é¡¹é•¿åº¦æœ€å¤§40å­—èŠ‚ï¼Œé€‰é¡¹ä¸­å…ˆåŠ ä¸Šâ€œå…è®¸SACKâ€ã€‚ä¸€ä¸ªè¾¹ç•Œä½¿ç”¨32ä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥ä¸€ä¸ªæ ‡è®°éœ€è¦8å­—èŠ‚ï¼ˆLå’ŒRï¼‰ï¼Œè¿˜éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæŒ‡æ˜ä½¿ç”¨SACKï¼Œä¸€ä¸ªæŒ‡æ˜è¿™ä¸ªé€‰é¡¹å ç”¨å¤šå°‘å­—èŠ‚ã€‚ï¼ˆä¹¦ä¸Šä¹Ÿæ²¡è®²æ¸…æ¥šï¼Œçœ‹çœ‹å¾—äº†ï¼‰</p><h3 id="6-TCPæµé‡æ§åˆ¶"><a href="#6-TCPæµé‡æ§åˆ¶" class="headerlink" title="6.TCPæµé‡æ§åˆ¶"></a>6.TCPæµé‡æ§åˆ¶</h3><p>æµé‡æ§åˆ¶æŒ‡çš„æ˜¯<strong>å‘é€æ–¹å‘é€æ•°æ®ä¸è¦å¤ªå¿«ï¼Œæ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶</strong>ã€‚</p><p><img src="/2021/03/15/network/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%BA%E5%88%B6%E8%BF%9B%E8%A1%8C%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6.png"></p><p>æ¥æ”¶æ–¹Bè¿›è¡Œäº†æµé‡æ§åˆ¶ï¼Œå‘Šè¯‰Aåº”è¯¥å‘å¤šå°‘ã€‚å½“rwnd=0 Aåªèƒ½ç­‰å¾…ä¸èƒ½å‘é€ã€‚ç›´åˆ°Bå‘å›æ–°çš„ACKã€‚</p><p>æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœæœ€årwnd=0åï¼ŒBæœ‰äº†æ–°çš„ç¼“å­˜ç©ºé—´ï¼Œç»™Aå‘äº†æ–°çš„ç¡®è®¤å’Œçª—å£ï¼Œä½†æ˜¯è¿™ä¸ªæ¶ˆæ¯ä¸¢äº†ï¼Œä¼šå¯¼è‡´Aå’ŒBäº’ç›¸ç­‰å¾…æ­»é”ã€‚ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œè®¾ç½®æŒç»­è®¡æ—¶å™¨ï¼ŒæŒç»­è®¡æ—¶å™¨åˆ°æ—¶ï¼ŒAå°±å‘é€<strong>é›¶çª—å£æ¢æµ‹æŠ¥æ–‡æ®µ</strong>ï¼Œå¯¹æ–¹å°±åœ¨è¿™ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µç»™å‡ºæ–°çš„çª—å£å€¼ã€‚</p><ol><li>TCPçš„ä¼ è¾“æ•ˆç‡</li></ol><p>ç¼“å­˜åªç®¡æŠŠå½“å‰çª—å£å†…çš„æ•°æ®äº¤ä»˜TCPï¼Œå‘é€çš„æ•°æ®ç›´æ¥ç”±TCPå»å¤„ç†ã€‚</p><p><strong>ä¾‹å­1</strong>ï¼šTCPä½•æ—¶å‘é€æ•°æ®å…³ä¹ç½‘ç»œåˆ©ç”¨ç‡ã€‚å¦‚æœç”¨æˆ·æ¯æ¬¡åªå‘1ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆåŠ ä¸Šå¤´éƒ¨40ä¸ªå­—èŠ‚ï¼ˆiP20+TCP20)å…±41å­—èŠ‚ã€‚æ¥æ”¶æ–¹å‘é€ç¡®è®¤ä¿¡æ¯40å­—èŠ‚ã€‚è¿™ä¹ˆä¸€ä¸ªå­—èŠ‚å°±ä¼ é€81ä¸ªå­—èŠ‚ï¼Œåˆ©ç”¨ç‡å¾ˆä½ã€‚</p><p>ä¹¦ä¸­æåˆ°ä¸¤ä¸ªæ–¹æ³•ï¼š</p><p>1ï¼‰Nagleæ–¹æ³•ï¼šåº”ç”¨ç¨‹åºæŠŠè¦å‘é€çš„æ•°æ®ç¼“å­˜åˆ°å‘é€ç¼“å­˜ï¼ŒTCPå…ˆå‘é€ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚ï¼Œç¼“å­˜åé¢åˆ°è¾¾çš„æ•°æ®ï¼Œæ”¶åˆ°ç¡®è®¤åï¼ŒæŠŠç¼“å­˜åŒºæ‰€æœ‰æ•°æ®è£…æˆä¸€ä¸ªTCPæŠ¥æ–‡ä¸€èµ·å‘é€ï¼ŒåŒæ—¶å¯¹åç»­çš„æ•°æ®ç»§ç»­ç¼“å­˜ï¼Œæ”¶åˆ°å‰ä¸€ä¸ªç¡®è®¤å†ç»§ç»­å‘é€ã€‚Nagleè§„å®šï¼Œæ•°æ®è¾¾åˆ°å‘é€çª—å£ä¸€åŠæˆ–æŠ¥æ–‡æ®µçš„æœ€å¤§é•¿åº¦ï¼ˆMSS)å°±ç«‹å³å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µã€‚<strong>å·®ä¸å¤šæ˜¯æ§åˆ¶å‘é€æ–¹æ¥æ”¶çª—å£å¤§å°</strong>ã€‚</p><p>2ï¼‰ç³Šæ¶‚çª—å£ï¼šç³Šæ¶‚çª—å£å°±æ˜¯æŒ‡ä¾‹å­1çš„æƒ…å†µï¼Œä¸æ–­åœ°å‘é€1ä¸ªå­—èŠ‚ï¼Œç½‘ç»œåˆ©ç”¨ç‡å¾ˆä½ã€‚ä¸ºäº†è§£å†³é—®é¢˜ï¼Œè§„å®šè®©æ¥æ”¶æ–¹ç­‰ä¸€æ®µæ—¶é—´ï¼Œæ¥æ”¶ç¼“å­˜æœ‰è¶³å¤Ÿç©ºé—´æˆ–æ¥æ”¶ç¼“å­˜æœ‰äº†ä¸€åŠç©ºé—´ã€‚è¿™ä¸¤ç§æƒ…å†µä¸‹æ‰è®©å‘é€æ–¹å‘é€ä¸€ä¸ªé•¿TCPã€‚<strong>å·®ä¸å¤šæ˜¯æ§åˆ¶æ¥æ”¶æ–¹çª—å£å¤§å°ï¼Œä¸è¦æœ‰ä¸€ç‚¹ç©ºé—´å°±ç€æ€¥å‘Šè¯‰å‘é€æ–¹</strong></p><p>è¿™ä¸¤ç§æ–¹æ³•å¯é…åˆä½¿ç”¨ï¼Œè¾¾åˆ°æ•ˆæœã€‚</p><h3 id="7-TCPçš„æ‹¥å¡æ§åˆ¶"><a href="#7-TCPçš„æ‹¥å¡æ§åˆ¶" class="headerlink" title="7.TCPçš„æ‹¥å¡æ§åˆ¶"></a>7.TCPçš„æ‹¥å¡æ§åˆ¶</h3><p>æ‹¥å¡æ§åˆ¶å°±æ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥ç½‘ç»œï¼Œè¿™æ ·å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡³äºè¿‡è½½ã€‚ç½‘ç»œèƒ½å¤Ÿæ‰¿å—ç°æœ‰çš„ç½‘ç»œè´Ÿè·ã€‚æ‹¥å¡æ§åˆ¶æ˜¯ä¸€ä¸ªå…¨å±€çš„è¿‡ç¨‹ï¼Œæ¶‰åŠæ‰€æœ‰çš„ä¸»æœºå’Œè·¯ç”±å™¨ã€‚</p><p>ç®€å•åœ°å°†å¤„ç†æœºé€Ÿç‡æé«˜ï¼Œå¯èƒ½ä¼šæŠŠç“¶é¢ˆç§»åˆ°å…¶ä»–åœ°æ–¹ã€‚æ¯”å¦‚æŸä¸ªç»“ç‚¹ç¼“å­˜å¤ªå°ï¼Œæˆ‘å°±ç»™å®ƒå¼„æˆæ— é™ç¼“å­˜ï¼Œç»“æœç¼“å­˜æ’é˜Ÿçš„æ•°æ®å¤ªå¤šäº†ï¼Œå¾ˆå¤šä¿¡æ¯åˆå…¨éƒ¨é‡ä¼ ï¼Œæˆ‘è¿™è¿˜æ²¡å‘å‡ºå»ä½ å°±åˆæ¥ä¸€è½®ï¼Œè¶Šæ¥è¶Šæ…¢ã€‚<strong>æ‹¥å¡æ§åˆ¶æ˜¯ä¸ªå…¨å±€çš„æ§åˆ¶ï¼Œæ‰€ä»¥è¯´æ‹¥å¡ä¸èƒ½åªçœ‹æŸä¸€ä¸ªåœ°æ–¹ï¼Œéœ€è¦å…¨å±€æŠŠæ§</strong>ã€‚</p><p>æµé‡æ§åˆ¶æ˜¯ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æ§åˆ¶ã€‚</p><p><img src="/2021/03/15/network/%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E6%89%80%E8%B5%B7%E7%9A%84%E4%BD%9C%E7%94%A8.png"></p><p>ä»æ§åˆ¶ç†è®ºçš„è§’åº¦çœ‹æ‹¥å¡æ§åˆ¶ï¼Œåˆ†ä¸º<strong>å¼€ç¯æ§åˆ¶</strong>å’Œ<strong>é—­ç¯æ§åˆ¶</strong>ä¸¤ç§æ–¹æ³•ã€‚</p><p>å¼€ç¯æ§åˆ¶å°±æ˜¯è®¾è®¡ç½‘ç»œæ—¶äº‹å…ˆå°†æœ‰å…³å‘ç”Ÿçš„æ‹¥å¡å› ç´ è€ƒè™‘å‘¨åˆ°ï¼ŒåŠ›æ±‚ç½‘ç»œåœ¨å·¥ä½œæ—¶ä¸äº§ç”Ÿæ‹¥å¡ã€‚ä½†ä¸€æ—¦æ•´ä¸ªç³»ç»Ÿè¿è¡Œèµ·æ¥ï¼Œå°±ä¸å†ä¸­é€”è¿›è¡Œæ”¹æ­£äº†ã€‚</p><p>é—­ç¯æ§åˆ¶åŸºäºåé¦ˆç¯è·¯çš„æ¦‚å¿µï¼Œä¸»è¦æœ‰ï¼š</p><p>1ï¼‰æ£€æµ‹ç½‘ç»œç³»ç»Ÿä»¥ä¾¿æ£€æµ‹åˆ°æ‹¥å¡åœ¨ä½•æ—¶å‘ç”Ÿã€ä½•å¤„å‘ç”Ÿã€‚</p><p>2ï¼‰æŠŠæ‹¥å¡å‘ç”Ÿçš„ä¿¡æ¯ä¼ é€åˆ°å¯é‡‡å–è¡ŒåŠ¨çš„åœ°æ–¹ã€‚</p><p>3ï¼‰è°ƒæ•´ç½‘ç»œç³»ç»Ÿçš„è¿è¡Œä»¥è§£å†³å‡ºç°çš„é—®é¢˜ã€‚</p><ul><li>TCPçš„æ‹¥å¡æ§åˆ¶</li></ul><p>1ï¼‰æ…¢å¼€å§‹å’Œæ‹¥å¡é¿å…</p><p>åŸºäºçª—å£çš„æ‹¥å¡æ§åˆ¶ã€‚å‘é€æ–¹ç»´æŒä¸€ä¸ªå«åšæ‹¥å¡çª—å£cwndçš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€åœ°å˜åŒ–ã€‚<strong>å‘é€æ–¹è®©è‡ªå·±çš„å‘é€çª—å£ç­‰äºæ‹¥å¡çª—å£ã€‚</strong></p><p>åŸåˆ™ï¼šåªè¦ç½‘ç»œæ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å¯ä»¥å†å¢å¤§ä¸€äº›ï¼Œä»¥ä¾¿å‘é€æ›´å¤šåˆ†ç»„ï¼Œæé«˜ç½‘è·¯åˆ©ç”¨ç‡ã€‚ä½†åªè¦å‡ºç°æ‹¥å¡ï¼Œå°±æŠŠæ‹¥å¡çª—å£å‡å°ã€‚</p><p>åªè¦å‘é€çš„æŠ¥æ–‡å‡ºç°äº†ä¸¢å¤±ï¼ˆéœ€è¦é‡ä¼ ï¼‰å°±åˆ¤æ–­ä¸ºæ‹¥å¡ã€‚</p><p><strong>æ…¢å¼€å§‹</strong>ç®—æ³•ï¼šå½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œç”±äºå¹¶ä¸æ¸…æ¥šç½‘ç»œçŠ¶å†µï¼Œç”±å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚</p><p>åˆšå¼€å§‹cwndè®¾ç½®ä¸ºä¸è¶…è¿‡2è‡³4ä¸ªSMSSï¼ˆSender Maximum Segment Sizeï¼‰æœ€å¤§æŠ¥æ–‡æ®µçš„æ•°å€¼ã€‚</p><p>è‹¥SMSS&gt;2190å­—èŠ‚ï¼Œåˆ™è®¾ç½®åˆå§‹æ‹¥å¡çª—å£cwnd=2*SMSSã€‚ä¸”ä¸è¶…è¿‡2ä¸ªæŠ¥æ–‡æ®µã€‚</p><p>è‹¥SMSS&gt;1095å­—èŠ‚ä¸”SMSS&lt;2190å­—èŠ‚ï¼Œåˆ™è®¾ç½®åˆå§‹æ‹¥å¡çª—å£cwnd=3*SMSSå­—èŠ‚ï¼Œä¸”ä¸è¶…è¿‡3ä¸ªæŠ¥æ–‡æ®µã€‚</p><p>è‹¥SMSS&lt;=1095å­—èŠ‚ï¼Œåˆ™cwnd=4*SMSSå­—èŠ‚ï¼Œä¸è¶…è¿‡4ä¸ªæŠ¥æ–‡æ®µã€‚</p><p>ä»¥æ­¤é™åˆ¶åˆå§‹çª—å£çš„æ‹¥å¡å­—èŠ‚æ•°ã€‚æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°çš„æŠ¥æ–‡æ®µç¡®è®¤åï¼Œæ‹¥å¡çª—å£å¢åŠ æœ€å¤šä¸€ä¸ªSMSSæ•°å€¼ã€‚</p><p>$æ‹¥å¡çª—å£cwndæ¯æ¬¡çš„å¢åŠ é‡=min(N,SMSS)$</p><p>Næ˜¯åŸå…ˆæœªè¢«ç¡®è®¤çš„ï¼Œç°åœ¨åˆšæ”¶åˆ°çš„ç¡®è®¤æŠ¥æ–‡æ®µæ‰€ç¡®è®¤çš„å­—èŠ‚æ•°ã€‚</p><p>ä¸éš¾çœ‹å‡ºï¼Œå½“N&lt;SMSSæ—¶ï¼Œæ‹¥å¡çª—å£æ¯æ¬¡çš„å¢åŠ é‡è¦å°äºSMSSã€‚</p><p><img src="/2021/03/15/network/%E5%8F%91%E9%80%81%E6%96%B9wend%E7%9A%84%E6%83%85%E5%86%B5.png"></p><p>ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼Œæ”¶åˆ°ç¡®è®¤å·å°±æ ¹æ®ç¡®è®¤å·æ‰©å¤§çª—å£ï¼Œå¯ä»¥çœ‹åˆ°çª—å£æ˜¯æˆå€å¢åŠ çš„ã€‚ä¾‹å¦‚ï¼šç¬¬ä¸€æ¬¡å‘é€çš„æ”¶åˆ°äº†ï¼ˆçª—å£å†…æ˜¯1ï¼‰2ã€‚é‚£ä¹ˆçª—å£å°±æ˜¯ï¼ˆ2,3ï¼‰æœŸæœ›æ”¶åˆ°4ï¼Œå˜ä¸º4ï¼Œä¸‹æ¬¡ï¼ˆ4,5,6,7ï¼‰ï¼ŒæœŸæœ›æ”¶åˆ°8ï¼Œå˜ä¸º8ã€‚</p><p><strong>æ‹¥å¡é¿å…</strong>ç®—æ³•ä¸åƒæ…¢å¼€å§‹ç®—æ³•æˆå€ï¼Œå®ƒåªåŠ 1ï¼ˆ1æŒ‡çš„æ˜¯ä¸€ä¸ªMSSæœ€å¤§æ•°æ®æŠ¥æ–‡æ®µï¼‰ï¼Œ<strong>æ›´åŠ ç¼“æ…¢åœ°å¢å¤§</strong>ã€‚</p><p>ä¸ºäº†é˜²æ­¢æ‹¥å¡cwndå¢é•¿è¿‡å¤§ï¼Œè®¾ç½®æ…¢å¼€å§‹é—¨é™ã€‚æ…¢å¼€å§‹é—¨é™ssthreshï¼š</p><p>å½“cwnd&lt;ssthreshæ—¶ï¼Œä½¿ç”¨ä¸Šè¿°æ…¢å¼€å§‹ç®—æ³•ã€‚</p><p>å½“cwnd&gt;sshthreshæ—¶ï¼Œåœæ­¢ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•è€Œæ”¹ç”¨æ‹¥å¡é¿å…ç®—æ³•ã€‚</p><p>å½“=æ—¶ï¼Œå³å¯ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼Œä¹Ÿå¯ä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•ã€‚</p><p><img src="/2021/03/15/network/TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E5%8F%98%E5%8C%96%E6%83%85%E5%86%B5.png"></p><p>è¿™å¹…å›¾ä¸­è®²äº†æ‹¥å¡æ§åˆ¶çš„ä¾‹å­ï¼Œå…·ä½“çœ‹ä¹¦ä¸­P234ã€‚</p><p><img src="/2021/03/15/network/%E5%BF%AB%E9%87%8D%E4%BC%A0.png"></p><p><strong>å¿«é€Ÿé‡ä¼ ç®—æ³•</strong>å¯ä»¥è®©å‘é€æ–¹<strong>å°½å¿«çŸ¥é“æŠ¥æ–‡å‘ç”Ÿäº†ä¸¢å¤±</strong>ã€‚å›¾ä¸­M3ä¸¢äº†è¦ä¸åœåœ°å‘ç¡®è®¤M2ï¼Œåªè¦<strong>ä¸€è¿æ”¶åˆ°3ä¸ªé‡å¤ç¡®è®¤</strong>ï¼Œå‘é€æ–¹å°±çŸ¥é“åº”ç«‹å³é‡ä¼ ã€‚</p><p>å›¾ä¸­å‘ç°äº†ä¸¢å¤±ä¸ªåˆ«æŠ¥æ–‡æ®µï¼Œäºæ˜¯é‡‡ç”¨<strong>å¿«æ¢å¤ç®—æ³•</strong>ï¼Œè°ƒæ•´é—¨é™å€¼<code>cwnd=ssthresh=cwnd/2</code>ï¼Œå¹¶å¼€å§‹æ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ã€‚</p><p>åœ¨æ‹¥å¡é¿å…é˜¶æ®µï¼Œæ‹¥å¡çª—å£æ˜¯<strong>çº¿æ€§å¢å¤§</strong>ï¼Œç§°ä¸º**åŠ æ³•å¢å¤§AI(Additive Increase)<strong>ã€‚è€Œä¸€æ—¦å‡ºç°è¶…æ—¶æˆ–3ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œå°±è¦æŠŠé—¨é™å€¼è®¾ä¸ºå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠï¼Œå¹¶ä¸”å¤§å¤§å‡å°‘æ‹¥å¡çª—å£çš„æ•°å€¼ï¼Œç§°ä¸º</strong>â€œä¹˜æ³•å‡å°â€MDï¼ˆMultiplicative Decrease)**ã€‚äºŒè€…åˆå¹¶ä¸€èµ·å°±æ˜¯AIMDç®—æ³•</p><p>å¯å½’çº³ä¸ºå¦‚ä¸‹æµç¨‹å›¾ï¼š</p><p><img src="/2021/03/15/network/%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B%E5%9B%BE.png"></p><p>ä»¥ä¸Šè®¨è®ºå…¨æ˜¯å‡è®¾æ¥æ”¶æ–¹çª—å£æ— é™å¤§ã€‚æ¥æ”¶æ–¹çª—å£ç§°ä¸ºé€šçŸ¥çª—å£ï¼Œå®é™…è¿è¡Œä¸­å‘é€æ–¹çš„çª—å£ä¸€å®šä¸èƒ½è¶…è¿‡å¯¹æ–¹ç»™å‡ºçš„æ¥æ”¶æ–¹çª—å£å€¼rwndã€‚</p><p>æ‰€ä»¥$å‘é€æ–¹çª—å£çš„ä¸Šé™å€¼=Min[rwnd,cwnd]$</p><ul><li>ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç†ï¼ˆAQM,Active Queue Managementï¼‰</li></ul><p>è·¯ç”±å™¨ç¼“å­˜éƒ½æœ‰é™åˆ¶ï¼Œå¦‚æœæ•°æ®æŠ¥æ–‡å¤ªå¤šï¼Œè·¯ç”±å™¨é˜Ÿåˆ—ç¼“å­˜å°¾éƒ¨ä¼šä¸¢å¼ƒæŠ¥æ–‡ï¼Œå¯¼è‡´ä¸€è¿ä¸²çš„æŠ¥æ–‡ä¸¢å¤±ï¼Œé‡ä¼ å¯¼è‡´åˆ¤å®šç½‘ç»œæ‹¥å¡ã€‚å¾ˆå¤šTCPä¼šåŒæ—¶è¿›å…¥æ…¢å¼€å§‹çŠ¶æ€ï¼Œä½¿å¾—å…¨ç½‘çš„é€šä¿¡é‡çªç„¶ä¸‹é™ï¼Œç½‘ç»œæ¢å¤æ­£å¸¸åï¼Œè¿™äº›TCPåˆåŒæ—¶ä¿¡æ¯é‡å¢å¤§ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§å…¨å±€åŒæ­¥ç°è±¡ï¼Œæå‡ºäº†ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç†(AQM)ï¼Œä¸è¦ç­‰åˆ°è·¯ç”±å™¨é˜Ÿåˆ—é•¿åº¦æœ€å¤§å€¼äº†æ‰ä¸¢å¼ƒåˆ†ç»„ï¼Œè€Œæ˜¯å½“é•¿åº¦è¾¾åˆ°æŸä¸ªå€¼æ—¶ä¸»åŠ¨ä¸¢å¼ƒåˆ†ç»„ï¼Œæé†’å‘é€æ–¹æ”¾æ…¢å‘é€é€Ÿç‡ã€‚</p><h3 id="8-TCPçš„è¿è¾“è¿æ¥ç®¡ç†"><a href="#8-TCPçš„è¿è¾“è¿æ¥ç®¡ç†" class="headerlink" title="8.TCPçš„è¿è¾“è¿æ¥ç®¡ç†"></a>8.TCPçš„è¿è¾“è¿æ¥ç®¡ç†</h3><ul><li><strong>ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼š</li></ul><p><img src="/2021/03/15/network/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png"></p><p>æœ€åˆä¸¤å°ä¸»æœºéƒ½å¤„äºå…³é—­çŠ¶æ€ï¼ŒAè¦ä¸»åŠ¨è¿æ¥ï¼Œå«ä¸»åŠ¨æ‰“å¼€ï¼ŒBæ˜¯è¢«åŠ¨æ‰“å¼€è¿æ¥ã€‚Aå’ŒBéƒ½æœ‰ä¼ è¾“æ§åˆ¶æ¨¡å—TCBï¼Œè¿™ä¸ªæ¨¡å—ç”¨æ¥å‘èµ·è¯·æ±‚ã€‚</p><p>Aæ‰“ç®—å»ºç«‹TCPè¿æ¥æ—¶ï¼Œå‘Bå‘å‡ºè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œè¿™æ—¶é¦–éƒ¨ä¸­çš„åŒæ­¥ä½SYN=1ï¼ŒåŒæ—¶é€‰æ‹©åˆå§‹åºå·seq=xã€‚SYNæŠ¥æ–‡æ®µä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚è¿™æ—¶Aä¸»æœºè¿›å…¥SYN-SENTï¼ˆåŒæ­¥å·²å‘é€ï¼‰çŠ¶æ€ã€‚</p><p>Bæ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå¦‚åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘Aå‘é€ç¡®è®¤ã€‚æŠŠSYNå’ŒACKéƒ½ç½®ä¸º1ï¼Œ<code>ack = x+1</code>ã€‚é€‰æ‹©ä¸€ä¸ªåˆå§‹åºå·<code>seq = y</code>ï¼Œå¹¶æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚æœåŠ¡å™¨Bè¿›å…¥SYN-RCVDï¼ˆåŒæ­¥æ”¶åˆ°ï¼‰çŠ¶æ€ã€‚</p><p>TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°Bçš„ç¡®è®¤åï¼Œå‘Bå‘é€ç¡®è®¤ã€‚ç¡®è®¤æŠ¥æ–‡æ®µçš„ACKç½®1ï¼Œç¡®è®¤å·<code>ack=y+1</code>ï¼Œè€Œè‡ªå·±çš„åºå·<code>seq=x+1</code>ã€‚ACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†å¦‚æœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ï¼Œä¸‹ä¸€ä¸ªæ•°æ®æŠ¥æ–‡æ®µçš„åºå·ä»æ˜¯seq=x+1ã€‚è¿™æ—¶å»ºç«‹äº†è¿æ¥Aè¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿æ¥ï¼‰çŠ¶æ€ã€‚</p><p><strong>é—®é¢˜ï¼šä¸ºä»€ä¹ˆAè¿˜è¦æœ€åå‘ä¸€æ¬¡ç¡®è®¤å‘¢ï¼Ÿ</strong></p><p>ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ åˆ°äº†Bã€‚æœ¬æ¥æ˜¯ä¸€ä¸ªå¤±æ•ˆçš„æŠ¥æ–‡æ®µï¼Œå¦‚æœæ²¡æœ‰ç¡®è®¤ï¼ŒBä¼šç«‹é©¬åŒæ„è¿æ¥ï¼Œè¿™æƒ…å†µå¦‚æœå¤šäº†ï¼ŒBä¸»æœºå²‚ä¸æ˜¯å¡æ­»ã€‚</p><ul><li>TCPè¿æ¥é‡Šæ”¾</li></ul><p>æ•°æ®ä¼ è¾“å®Œæ¯•åï¼Œé€šä¿¡åŒæ–¹è¦é‡Šæ”¾è¿æ¥ã€‚Aå’ŒBå¤„äºESTABLISHEDçŠ¶æ€æ—¶ï¼ŒAçš„åº”ç”¨å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼Œåœæ­¢å‘é€æ•°æ®ï¼Œå…³é—­TCPè¿æ¥ã€‚</p><p>AæŠŠæ§åˆ¶ä½FINç½®ä¸º1ï¼Œå…¶åºå·<code>seq = u</code>ï¼Œç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚åŠ 1ã€‚Aè¿›å…¥FIN-WAIT-1(ç»ˆæ­¢ç­‰å¾…1)çŠ¶æ€ï¼Œç­‰å¾…Bçš„ç¡®è®¤ã€‚æ³¨æ„FINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</p><p><img src="/2021/03/15/network/TCP%E8%BF%9E%E6%8E%A5%E9%87%8A%E6%94%BE%E8%BF%87%E7%A8%8B.png"></p><p>Bæ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·æ˜¯<code>ack = u+1</code>ï¼Œè€Œè¿™ä¸ªæŠ¥æ–‡æ®µè‡ªå·±çš„åºå·æ˜¯vï¼Œç­‰äºBå‰é¢å·²ç»å‘é€çš„æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚åŠ 1ã€‚Bè¿›å…¥CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPå¤„äº<strong>åŠå…³é—­</strong>çŠ¶æ€ã€‚</p><p>Aæ”¶åˆ°Bçš„ç¡®è®¤åï¼Œè¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…Bå‘å‡ºçš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µã€‚</p><p>Bå¦‚æœæ²¡æœ‰å‘Aå‘é€çš„æ•°æ®ï¼Œå‘é€FIN=1ï¼Œå‡å®šBç°åœ¨çš„åºå·æ˜¯wï¼ˆå¯èƒ½Bå‘Aå‘äº†ä¸€äº›æ•°æ®ï¼Œå¦‚æœæ²¡å‘ï¼Œé‚£åºå·æ˜¯u+1ï¼‰ï¼Œä½†Bè¿˜æ˜¯ç»§ç»­é‡å¤ä¸Šæ¬¡å‘è¿‡çš„ç¡®è®¤å·åˆ™<code>ACK = u+1</code>ã€‚Bè¿›å…¥LAST-ACKï¼ˆæœ€åç¡®è®¤çŠ¶æ€ï¼‰ï¼Œç­‰å¾…Açš„ç¡®è®¤ã€‚</p><p>Aåœ¨æ”¶åˆ°å¯¹æ­¤å‘å‡ºç¡®è®¤ã€‚ACKç½®ä¸º1ï¼Œ<code>ack =</code>W+1`ï¼Œè€Œè‡ªå·±çš„åºå·æ˜¯ seq = u+1ã€‚è¿›å…¥TIME-WAIT(æ—¶é—´ç­‰å¾…)çŠ¶æ€ã€‚ç»è¿‡**æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨ï¼ˆMaximum Segment Lifetime)**è®¾ç½®çš„2MSLåï¼ŒAè¿›å…¥CLOSEDçŠ¶æ€ã€‚</p><p><strong>ä¸ºä»€ä¹ˆAéœ€è¦ç­‰å¾…2MSLæ—¶é—´ï¼Ÿ</strong></p><p>1ï¼‰ä¸ºäº†ä¿è¯Aå‘é€çš„æœ€åACKæŠ¥æ–‡æ®µåˆ°è¾¾Bã€‚è¿™ä¸ªACKæŠ¥æ–‡æ®µå¯èƒ½ä¸¢å¤±ï¼ŒBæ”¶ä¸åˆ°å¯¹é‡ä¼ FIN+ACKæŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼ŒBä¼šåœ¨ä¸€å®šæ—¶é—´å†…é‡ä¼ ï¼ŒAå°±èƒ½å¤Ÿ2MSLæ—¶é—´å†…ç­‰åˆ°Bçš„ä¿¡æ¯ã€‚Aé‡ä¼ ï¼Œå¹¶ä¸”é‡æ–°å¯åŠ¨2MSLè®¡æ—¶å™¨ã€‚ç›´åˆ°Aå’ŒBéƒ½è¿›å…¥CLOSEDçŠ¶æ€ã€‚</p><p>2ï¼‰é˜²æ­¢â€œå·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€å‡ºç°åœ¨æœ¬è¿æ¥ä¸­ã€‚Aå‘é€å®Œæœ€åACKåï¼Œå†ç»è¿‡2MSLï¼Œå¯ä½¿æœ¬è¿æ¥æŒç»­çš„æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µä»ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸ä¼šå‡ºç°æ—§çš„æŠ¥æ–‡è¯·æ±‚æ–‡æ®µã€‚</p><p>æ³¨æ„ï¼Œä»¥ä¸º2MSLçš„å­˜åœ¨ï¼ŒBç»“æŸTCPçš„æ—¶é—´æ¯”Aæ—©ä¸€äº›ã€‚</p><p>TCPè¿˜æœ‰<strong>ä¿æ´»è®¡æ—¶å™¨ï¼ˆkeepalive timeerï¼‰</strong>å¦‚æœæŸä¸ªclientå’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥ä½†çªç„¶æ•…éšœï¼ŒæœåŠ¡å™¨ä¸€ç›´ç­‰å¾…ï¼Œä¸èƒ½æ€»æ˜¯ç­‰å•Šã€‚è‹¥æœåŠ¡å™¨ä¸¤ä¸ªå°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·æ•°æ®ï¼ŒæœåŠ¡å™¨å°±å¼€å§‹å‘é€æ¢æµ‹æŠ¥æ–‡æ®µï¼Œå¹¶ä¸”æ¯éš”75ç§’å‘é€ä¸€æ¬¡ï¼Œè‹¥è¿ç»­å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µclientæ— å“åº”ï¼ŒæœåŠ¡å™¨è®¤ä¸ºclientæ•…éšœï¼Œå…³é—­è¿æ¥ã€‚</p><ul><li>TCPçš„æœ‰é™çŠ¶æ€æœºï¼ˆç›¸å½“äºæ€»ä½“æµç¨‹å›¾ï¼‰</li></ul><p><img src="/2021/03/15/network/TCP%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA.png"></p><h2 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h2><h3 id="1-åŸŸåç³»ç»ŸDNS"><a href="#1-åŸŸåç³»ç»ŸDNS" class="headerlink" title="1. åŸŸåç³»ç»ŸDNS"></a>1. åŸŸåç³»ç»ŸDNS</h3><p>DNS(Domain Name System)æ˜¯ç”¨æ¥å°†æœºå™¨åå­—è½¬æ¢ä¸ºIPåœ°å€ã€‚äº’è”ç½‘çš„å‘½åç³»ç»Ÿä¸­ä½¿ç”¨äº†å¾ˆå¤šçš„â€œåŸŸâ€ï¼ŒåŸŸæ˜¯åå­—ç©ºé—´ä¸­ä¸€ä¸ªå¯è¢«ç®¡ç†çš„åˆ’åˆ†ï¼Œè¿˜å¯è¢«åˆ’åˆ†å­åŸŸï¼Œå‡ºç°äº†é¡¶çº§åŸŸã€äºŒçº§åŸŸã€ä¸‰çº§åŸŸç­‰ç­‰ï¼Œå› æ­¤å°±å‡ºç°äº†â€œåŸŸåâ€è¿™ä¸ªåè¯ã€‚</p><p>DNSç°åœ¨è®¾è®¡æˆäº†åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¤§éƒ¨åˆ†è§£æåœ¨æœ¬åœ°è¿›è¡Œï¼Œå°‘é‡è§£æåœ¨äº’è”ç½‘ä¸Šé€šä¿¡ï¼ŒDNSæ•ˆç‡å¾ˆé«˜ã€‚</p><p>åŸŸååˆ°IPåœ°å€çš„è§£ææ˜¯ç”±è®¸å¤š<strong>åŸŸåæœåŠ¡å™¨ç¨‹åº</strong>å…±åŒå®Œæˆï¼Œè¿è¡ŒåŸŸåæœåŠ¡å™¨ç¨‹åºçš„æœºå™¨å«<strong>åŸŸåæœåŠ¡å™¨</strong>ã€‚</p><p>è§£æè¦ç‚¹ï¼šå½“æŸä¸€ä¸ªåº”ç”¨è¿›ç¨‹æŠŠä¸»æœºåè§£ææˆIPåœ°å€æ—¶ï¼Œè¯¥åº”ç”¨è¿›ç¨‹å°±è¦è°ƒç”¨è§£æç¨‹åºï¼Œå¹¶æˆä¸ºDNSçš„ä¸€ä¸ªå®¢æˆ·ï¼ŒæŠŠå¾…è§£æçš„åŸŸåæ”¾åœ¨DNSè¯·æ±‚æŠ¥æ–‡ä¸­ï¼Œä»¥<strong>UDP</strong>çš„å½¢å¼å‘é€æœ¬åœ°åŸŸåæœåŠ¡å™¨ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨æŸ¥æ‰¾åï¼ŒæŠŠå¯¹åº”çš„IPåœ°å€æ”¾åœ¨å›ç­”æŠ¥æ–‡ä¸­è¿”å›ã€‚è‹¥æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸èƒ½æ‰¾åˆ°åœ°å€ï¼Œåˆ™æ­¤åŸŸåæœåŠ¡å™¨æš‚æ—¶æˆä¸ºDNSä¸­çš„å¦ä¸€ä¸ªå®¢æˆ·ï¼Œå¹¶å‘å…¶ä»–åº”æœåŠ¡å™¨è¯·æ±‚ï¼Œç›´åˆ°æ‰¾åˆ°å›ç­”ã€‚</p><p><img src="/2021/03/15/network/%E5%9F%9F%E5%90%8D.png"></p><p>åŸŸåæ ‡å·ç”±è‹±æ–‡å­—æ¯å’Œæ•°å­—ç»„æˆï¼Œ<strong>æ¯ä¸€ä¸ªæ ‡å·ä¸è¶…è¿‡63ä¸ªå­—ç¬¦</strong>ï¼Œä¹Ÿ<strong>ä¸åŒºåˆ†å¤§å°å†™å­—æ¯</strong>ï¼Œæ ‡å·ä¸­é™¤äº†è¿å­—ç¬¦-å¤–ä¸èƒ½ä½¿ç”¨å…¶ä»–æ ‡ç‚¹ç¬¦å·ã€‚çº§åˆ«æœ€ä½çš„åŸŸåå†™åœ¨å·¦è¾¹ï¼Œçº§åˆ«é«˜çš„å†™åœ¨å³è¾¹ã€‚<strong>ç”±å¤šä¸ªæ ‡å·ç»„æˆçš„å®Œæ•´åŸŸåä¸å¯è¶…è¿‡255ä¸ªå­—ç¬¦</strong>ã€‚</p><p>æœ€é«˜çš„é¡¶çº§åŸŸåç”±ICANNç®¡ç†ï¼ŒåŸŸåå¯ä½¿æ¯ä¸€ä¸ªåŸŸååœ¨å…¨äº’è”ç½‘å†…éƒ½æ˜¯å”¯ä¸€çš„ã€‚</p><p>2012å¹´é¡¶çº§åŸŸåå…±åˆ†ä¸º3å¤§ç±»ï¼š</p><p>1ï¼‰å›½å®¶é¡¶çº§åŸŸånTLDã€‚cnè¡¨ç¤ºä¸­å›½ï¼Œusè¡¨ç¤ºç¾å›½ï¼Œukè¡¨ç¤ºè‹±å›½ç­‰ã€‚å›½å®¶é¡¶çº§åŸŸåè¾¾åˆ°296ä¸ªã€‚</p><p>2ï¼‰é€šç”¨é¡¶çº§åŸŸågTLDã€‚comï¼ˆå…¬å¸ä¼ä¸šï¼‰aeroï¼ˆèˆªç©ºè¿è¾“ä¸šï¼‰asiaï¼ˆäºšå¤ªåœ°åŒºï¼‰ã€‚ã€‚ã€‚ç­‰ã€‚</p><p>3ï¼‰åŸºç¡€ç»“æ„åŸŸåã€‚åªæœ‰ä¸€ä¸ªarpaï¼Œç”¨äºåå‘åŸŸåè§£æï¼Œä¹Ÿå«<strong>åå‘åŸŸå</strong>ã€‚</p><p><img src="/2021/03/15/network/%E5%9F%9F%E5%90%8D%E5%B1%82%E6%AC%A1.png"></p><p>æˆ‘å›½æŠŠäºŒçº§åŸŸååˆ’åˆ†ä¸ºâ€œ<strong>ç±»åˆ«åŸŸå</strong>å’Œ<strong>è¡Œæ”¿åŒºåŸŸå</strong>ä¸¤å¤§ç±»ï¼š</p><p>â€œç±»åˆ«åŸŸåâ€å…±7ä¸ªï¼Œåˆ†åˆ«ä¸ºï¼šacï¼ˆç§‘ç ”æœºæ„ï¼‰ï¼Œcomï¼ˆå·¥ã€å•†ã€é‡‘èç­‰ä¼ä¸šï¼‰ï¼Œeduï¼ˆä¸­å›½çš„æ•™è‚²æœºæ„ï¼‰ï¼Œgovï¼ˆä¸­å›½çš„æ”¿åºœæœºæ„ï¼‰ï¼Œmilï¼ˆä¸­å›½çš„å›½é˜²æœºæ„ï¼‰ï¼Œnetï¼ˆæä¾›äº’è”ç½‘ç½‘ç»œæœåŠ¡æœºæ„ï¼‰ï¼Œorgï¼ˆéè¥åˆ©æ€§ç»„ç»‡ï¼‰ã€‚</p><p>è¡Œæ”¿åŸŸåå…±34ä¸ªï¼Œé€‚ç”¨äºæˆ‘å›½çš„å„çœã€è‡ªæ²»åŒºã€ç›´è¾–å¸‚ä¾‹å¦‚ï¼šbjï¼ˆåŒ—äº¬ï¼‰ï¼Œjsï¼ˆæ±Ÿè‹ï¼‰</p><ul><li>åŸŸåæœåŠ¡å™¨</li></ul><p><img src="/2021/03/15/network/DNS%E5%88%92%E5%88%86%E5%8C%BA.png"></p><p>ä¸€ä¸ªæœåŠ¡å™¨æ‰€ç®¡è¾–çš„èŒƒå›´å«åŒºï¼Œæ¯ä¸€ä¸ªåŒºæœ‰æƒé™åŸŸåæœåŠ¡å™¨ã€‚åŒºå°äºç­‰äºåŸŸï¼Œä½†ä¸èƒ½å¤§äºåŸŸã€‚</p><p><img src="/2021/03/15/network/%E5%9F%9F%E5%90%8D%E5%8C%BA%E8%A7%A3%E9%87%8A.png"></p><p>1ï¼‰æ ¹åŸŸåæœåŠ¡å™¨ï¼šçŸ¥é“æ‰€æœ‰é¡¶çº§åŸŸåæœåŠ¡å™¨åŸŸåå’ŒIPåœ°å€ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨åªè¦æ— æ³•è§£ææŸä¸ªåŸŸåï¼Œå°±è¦è¯·æ±‚æ ¹åŸŸåæœåŠ¡å™¨ã€‚æŸä¸ªå®¢æˆ·è¯·æ±‚æ ¹åŸŸåæœåŠ¡ï¼Œå°±æ‰¾æœ€è¿‘çš„æ ¹åŸŸåæœåŠ¡å™¨åœ°å€å‘æŸ¥è¯¢ã€‚æ ¹åŸŸåæœåŠ¡å™¨ä¼šå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸‹ä¸€æ­¥æ‰¾å“ªä¸ªé¡¶çº§åŸŸåæœåŠ¡å™¨ã€‚</p><p>2ï¼‰é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼šè´Ÿè´£ç®¡ç†åœ¨è¯¥é¡¶çº§åŸŸåæœåŠ¡å™¨æ³¨å†Œçš„æ‰€æœ‰äºŒçº§åŸŸåã€‚</p><p>3ï¼‰æƒé™åŸŸåæœåŠ¡å™¨ï¼šè´Ÿè´£ä¸€ä¸ªåŒºçš„åŸŸåæœåŠ¡å™¨ï¼Œå½“æƒé™æœåŠ¡å™¨ä¸èƒ½ç»™å‡ºæœ€åçš„æŸ¥è¯¢å›ç­”æ—¶ï¼Œå°±ä¼šå‘Šè¯‰DNSå®¢æˆ·ä¸‹ä¸€æ­¥æ‰¾å“ªä¸ªæƒé™åŸŸåæœåŠ¡å™¨ã€‚</p><p>4ï¼‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼šæœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸å±äºå›¾6-3ä¸­çš„å±‚æ¬¡ç»“æ„ã€‚æ¯ä¸€ä¸ªäº’è”ç½‘æœåŠ¡æä¾›è€…ISPï¼Œæˆ–è€…ä¸€ä¸ªå¤§å­¦éƒ½å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¹Ÿå«é»˜è®¤åŸŸåæœåŠ¡å™¨ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨ç¦»å®¢æˆ·å¾ˆè¿‘ã€‚</p><p>ä¸»æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢éƒ½æ˜¯<strong>é€’å½’æŸ¥è¯¢</strong>ã€‚å¦‚æœæœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸çŸ¥é“IPåœ°å€ï¼Œå°±ä»¥DNSå®¢æˆ·èº«ä»½å‘å…¶ä»–æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œé€’å½’æŸ¥è¯¢ç»“æœã€‚</p><p>æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæŸ¥è¯¢æ˜¯<strong>è¿­ä»£æŸ¥è¯¢</strong>ã€‚å½“æ ¹åŸŸåæœåŠ¡å™¨æ”¶åˆ°æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘å‡ºçš„è¿­ä»£æŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡æ—¶ï¼Œè¦ä¹ˆç»™å‡ºIPåœ°å€ï¼Œè¦ä¹ˆå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨â€œä¸‹ä¸€æ­¥åº”è¯¥å‘å“ªä¸ªåŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼ˆæŠŠè‡ªå·±çŸ¥é“çš„é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ï¼‰â€ï¼Œç„¶åæœ¬åœ°åŸŸåæœåŠ¡å™¨æŸ¥è¯¢é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ŒæŸ¥åˆ°å°±ç»“æŸï¼Œæ²¡æŸ¥åˆ°é¡¶çº§åŸŸåæœåŠ¡å™¨å‘Šè¯‰å®ƒæŸ¥è¯¢å“ªä¸ªæƒé™åŸŸåæœåŠ¡å™¨å€¼ï¼Œç›´åˆ°æŸ¥åˆ°ã€‚</p><p><img src="/2021/03/15/network/DNS%E6%9F%A5%E8%AF%A2%E4%B8%BE%E4%BE%8B.png"></p><p> æ¯ä¸ªæœåŠ¡å™¨ï¼ˆæœ¬åœ°ã€æ ¹ã€é¡¶çº§ç­‰ï¼‰éƒ½æœ‰é«˜é€Ÿç¼“å­˜ï¼Œä¿å­˜æœ€è¿‘æŸ¥è¯¢è¿‡çš„åŸŸååœ°å€ï¼Œå‡å°‘ç½‘ç»œé€šä¿¡é‡ã€‚</p><h3 id="2-FTPæ–‡ä»¶ä¼ é€åè®®"><a href="#2-FTPæ–‡ä»¶ä¼ é€åè®®" class="headerlink" title="2.FTPæ–‡ä»¶ä¼ é€åè®®"></a>2.FTPæ–‡ä»¶ä¼ é€åè®®</h3><p>FTPä½¿ç”¨TCPå¯é ä¼ è¾“æœåŠ¡ã€‚</p><p>FTPç”±ä¸¤å¤§éƒ¨åˆ†ç»„æˆï¼š<strong>ä¸»è¿›ç¨‹</strong>ï¼Œè´Ÿè´£æ¥å—æ–°çš„è¯·æ±‚ã€‚<strong>ä»å±è¿›ç¨‹</strong>ï¼Œè´Ÿè´£å¤„ç†å•ä¸ªè¯·æ±‚ã€‚</p><p>ä¸»è¿›ç¨‹å·¥ä½œæ­¥éª¤ï¼š</p><p>1ï¼‰æ‰“å¼€ç†ŸçŸ¥ç«¯å£ï¼ˆç«¯å£å·21ï¼‰ï¼Œä½¿å®¢æˆ·è¿›ç¨‹èƒ½å¤Ÿè¿æ¥ä¸Šã€‚</p><p>2ï¼‰ç­‰å¾…å®¢æˆ·è¿›ç¨‹å‘å‡ºè¿æ¥è¯·æ±‚ã€‚</p><p>3ï¼‰å¯åŠ¨ä»å±è¿›ç¨‹å¤„ç†å®¢æˆ·è¿›ç¨‹å‘æ¥çš„è¯·æ±‚ã€‚ä»å±è¿›ç¨‹å¯¹å®¢æˆ·è¿›ç¨‹çš„è¯·æ±‚å¤„ç†å®Œæ¯•åç»ˆæ­¢ï¼Œä½†ä»å±è¿›ç¨‹å¯èƒ½åœ¨è¿è¡ŒæœŸé—´æ ¹æ®éœ€è¦åˆ›å»ºä¸€äº›å…¶ä»–å­è¿›ç¨‹ã€‚</p><p>4ï¼‰å›åˆ°ç­‰å¾…çŠ¶æ€ï¼Œç»§ç»­æ¥å—å…¶ä»–å®¢æˆ·è¿›ç¨‹å‘æ¥çš„è¯·æ±‚ã€‚ä¸»è¿›ç¨‹å’Œä»å±è¿›ç¨‹çš„å¤„ç†æ˜¯å¹¶è¡Œè¿›è¡Œçš„ã€‚</p><p><img src="/2021/03/15/network/FTP%E8%BF%9E%E6%8E%A5.png"></p><p>è¿›è¡Œæ–‡ä»¶ä¼ è¾“æ—¶ï¼ŒFTPå®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´è¦å»ºç«‹ä¸¤ä¸ªå¹¶è¡Œçš„TCPè¿æ¥ï¼šâ€œæ§åˆ¶è¿æ¥â€å’Œâ€æ•°æ®è¿æ¥â€œã€‚æ§åˆ¶è¿æ¥åœ¨æ•´ä¸ªä¼šè¯æœŸé—´ä¸€ç›´ä¿æŒæ‰“å¼€ï¼ŒFTPå®¢æˆ·å‘å‡ºä¼ é€è¯·æ±‚ï¼Œé€šè¿‡æ§åˆ¶è¿æ¥å‘é€ç»™æœåŠ¡ç«¯çš„æ§åˆ¶è¿›ç¨‹ã€‚å®é™…ä¼ è¾“æ–‡ä»¶çš„æ˜¯æ•°æ®è¿æ¥ï¼ŒæœåŠ¡ç«¯æ§åˆ¶è¿›ç¨‹æ”¶åˆ°FTPå®¢æˆ·æ–‡ä»¶ä¼ è¾“è¯·æ±‚åå°±åˆ›å»ºæ•°æ®ä¼ é€è¿›ç¨‹å’Œæ•°æ®è¿æ¥ã€‚</p><p>ç½‘ç»œæ–‡ä»¶ç³»ç»ŸNFSå’ŒFTPä¸åŒï¼ŒNFSå…è®¸åº”ç”¨è¿›ç¨‹è¿œç¨‹æ‰“å¼€ä¸€ä¸ªè¿œåœ°æ–‡ä»¶ï¼Œå¹¶ä¸”èƒ½åœ¨è¯¥æ–‡ä»¶çš„æŸä¸€ä¸ªç‰¹å®šçš„ä½ç½®ä¸Šå¼€å§‹è¯»å†™æ•°æ®ã€‚</p><ul><li>ç®€å•æ–‡ä»¶ä¼ é€åè®®TFTP</li></ul><p>TCP/IPåè®®æ—ä¸­è¿˜æœ‰ä¸€ä¸ªç®€å•æ–‡ä»¶ä¼ é€åè®®TFTPï¼Œ<strong>ä½¿ç”¨UDPæ•°æ®æŠ¥</strong>ï¼Œå› æ­¤TFTPéœ€è¦æœ‰è‡ªå·±çš„å·®é”™æ”¹æ­£æªæ–½ã€‚TFTPåªæ”¯æŒæ–‡ä»¶ä¼ è¾“è€Œä¸æ”¯æŒäº¤äº’ã€‚</p><p>TFTPå¯ç”¨äºUDPç¯å¢ƒã€‚TFTPä»£ç æ‰€å å†…å­˜å°ã€‚</p><p>1ï¼‰å®ƒæ¯æ¬¡ä¼ é€512å­—èŠ‚æ•°æ®ï¼Œä½†æœ€åä¸€æ¬¡ä¸è¶³512ã€‚</p><p>2ï¼‰æ•°æ®æŠ¥æ–‡æŒ‰åºç¼–å·ï¼Œä»1å¼€å§‹ã€‚</p><p>3ï¼‰æ”¯æŒASCIIç æˆ–äºŒè¿›åˆ¶ä¼ é€ã€‚</p><p>4ï¼‰å¯å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚</p><p>5ï¼‰ä½¿ç”¨å¾ˆç®€å•çš„é¦–éƒ¨ã€‚</p><h3 id="3-WWWä¸‡ç»´ç½‘"><a href="#3-WWWä¸‡ç»´ç½‘" class="headerlink" title="3. WWWä¸‡ç»´ç½‘"></a>3. WWWä¸‡ç»´ç½‘</h3><ul><li>URLç»Ÿä¸€èµ„æºå®šä½ç¬¦</li></ul><p>ç”¨æ¥è¡¨ç¤ºä»äº’è”ç½‘ä¸Šå¾—åˆ°çš„èµ„æºä½ç½®å’Œè®¿é—®è¿™äº›èµ„æºçš„æ–¹æ³•ã€‚URLç»™å‡ºèµ„æºçš„ä½ç½®æä¾›ä¸€ç§æŠ½è±¡çš„è¯†åˆ«æ–¹æ³•ï¼Œå¹¶ç”¨è¿™ç§æ–¹æ³•ç»™èµ„æºå®šä½ã€‚</p><p><img src="/2021/03/15/network/URL%E5%BD%A2%E5%BC%8F.png"></p><p>URLå·¦è¾¹ç¬¬ä¸€éƒ¨åˆ†æ˜¯åè®®ï¼Œè¿™é‡Œçš„åè®®æ˜¯æŒ‡ä»€ä¹ˆåè®®è·å–è¯¥ä¸‡ç»´ç½‘æ–‡æ¡£ã€‚æœ€å¸¸ç”¨çš„æ˜¯httpï¼Œå…¶æ¬¡æ˜¯ftpã€‚</p><p>åè®®åé¢åŠ â€ ://â€œæ˜¯è§„å®šçš„æ ¼å¼ã€‚å³è¾¹æ˜¯ç¬¬äºŒéƒ¨åˆ†ä¸»æœºï¼ŒæŒ‡å‡ºè¿™ä¸ªä¸‡ç»´ç½‘æ–‡æ¡£åœ¨å“ªä¸€å°ä¸»æœºä¸Šã€‚ä¸»æœºæŒ‡çš„æ˜¯è¯¥ä¸»æœºåœ¨äº’è”ç½‘ä¸Šçš„åŸŸåã€‚å†åé¢æ˜¯ç«¯å£å’Œè·¯å¾„ï¼Œæœ‰æ—¶å¯ä»¥çœç•¥ã€‚</p><p>ç°åœ¨çš„æµè§ˆå™¨ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼Œå¯ä»¥æŠŠå‰é¢çš„http://ç”šè‡³wwwçœç•¥ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¡«å……ã€‚</p><ul><li>ä½¿ç”¨HTTPçš„URL</li></ul><p><img src="/2021/03/15/network/HTTP%E7%9A%84URL.png"></p><p>HTTPé»˜è®¤ç«¯å£å·æ˜¯80ã€‚</p><ul><li>è¶…æ–‡æœ¬ä¼ è¾“åè®®HTTP ï¼ˆ<strong>hyper transport text protocol</strong>ï¼‰</li></ul><p>HTTPå®šä¹‰äº†æµè§ˆå™¨æ€æ ·å‘ä¸‡ç»´ç½‘æœåŠ¡å™¨è¯·æ±‚ä¸‡ç»´ç½‘æ–‡æ¡£ï¼Œä»¥åŠæœåŠ¡å™¨æ€æ ·æŠŠæ–‡æ¡£ä¼ é€ç»™æµè§ˆå™¨ã€‚ä»å±‚æ¬¡çš„è§’åº¦çœ‹ï¼ŒHTTPæ˜¯é¢å‘äº‹åŠ¡çš„åº”ç”¨å±‚åè®®ï¼Œå®ƒæ˜¯ä¸‡ç»´ç½‘ä¸Šèƒ½å¤Ÿå¯é åœ°äº¤æ¢æ–‡ä»¶çš„é‡è¦åŸºç¡€ã€‚</p><p><img src="/2021/03/15/network/%E4%B8%87%E7%BB%B4%E7%BD%91%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.png"></p><p>æœåŠ¡å™¨è¿›ç¨‹ç›‘å¬TCPçš„ç«¯å£80ï¼Œå‘ç°è¯·æ±‚å³å»ºç«‹è¯·æ±‚ï¼Œä¸€æ—¦ç›‘å¬è¿æ¥å»ºç«‹ï¼Œæµè§ˆå™¨å°±å‘ä¸‡ç»´ç½‘æœåŠ¡å™¨å‘å‡ºæµè§ˆæŸä¸ªé¡µé¢çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥ç€å°±è¿”å›æ‰€è¯·æ±‚é¡µé¢ä½œä¸ºå“åº”ã€‚æœ€åTCPè¿æ¥é‡Šæ”¾ã€‚</p><p>HTTPè§„å®šHTTPå®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ¯æ¬¡äº¤äº’ï¼Œéƒ½ç”±ä¸€ä¸ªASCIIç ä¸²æ„æˆçš„è¯·æ±‚å’Œä¸€ä¸ªç±»ä¼¼çš„é€šç”¨äº’è”ç½‘æ‰©å……ï¼Œå³â€œMIME(MIME-like)â€çš„å“åº”ç»„æˆã€‚HTTPæŠ¥æ–‡éƒ½æ˜¯ç”¨TCPè¿æ¥ä¼ é€ã€‚</p><p><img src="/2021/03/15/network/HTTP%E8%AF%B7%E6%B1%82%E6%97%B6%E9%97%B4.png"></p><p>HTTP1.0ç‰ˆæœ¬æ˜¯<strong>éæŒç»­è¿æ¥</strong>ã€‚æ¯æ¬¡åŒä¸€ä¸ªå®¢æˆ·çš„æ–°è¯·æ±‚éƒ½å»ºç«‹æ–°çš„TCPè¿æ¥ã€‚ä¸ä»…è€—æ—¶è€Œä¸”å¯¼è‡´æœåŠ¡å™¨è´Ÿæ‹…è¿‡é‡ã€‚</p><p>HTTP1.1åè®®è¾ƒå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒä½¿ç”¨<strong>æŒç»­è¿æ¥</strong>ï¼Œä¸‡ç»´ç½‘æœåŠ¡å™¨åœ¨å‘é€å“åº”ä¹‹åä»ç„¶åœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒè¿™æ¡è¿æ¥ï¼Œä½¿åŒä¸€ä¸ªå®¢æˆ·å’Œè¯¥æœåŠ¡å™¨å¯ä»¥ç»§ç»­åœ¨è¿™æ¡è¿æ¥ä¸Šä¼ é€åç»­çš„HTTPè¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ã€‚</p><p>1.1åè®®æŒç»­è¿æ¥æœ‰ä¸¤ç§æ–¹å¼ï¼š<strong>éæµæ°´çº¿æ–¹å¼</strong>å’Œ<strong>æµæ°´çº¿æ–¹å¼</strong>ã€‚</p><p>éæµæ°´çº¿ï¼šå®¢æˆ·æ”¶åˆ°å‰ä¸€ä¸ªå“åº”åæ‰èƒ½å‘å‡ºä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚å› æ­¤å®¢æˆ·æ²¡è®¿é—®ä»¥æ­¤å¯¹è±¡éƒ½è¦ç”¨å»ä¸€ä¸ªRTTå¾€è¿”æ—¶é—´ã€‚</p><p>æµæ°´çº¿æ–¹å¼ï¼šå®¢æˆ·æ”¶åˆ°HTTPçš„å“åº”æŠ¥æ–‡ä¹‹å‰å°±èƒ½å¤Ÿæ¥ç€å‘é€æ–°çš„è¯·æ±‚æŠ¥æ–‡ã€‚äºæ˜¯ä¸€ä¸ªä¸ªè¯·æ±‚æŠ¥æ–‡åˆ°è¾¾æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨å°±å¯è¿ç»­å‘å›å“åº”æŠ¥æ–‡ã€‚ä½¿ç”¨æµæ°´çº¿æ–¹å¼ï¼Œå®¢æˆ·è®¿é—®<strong>æ‰€æœ‰å¯¹è±¡</strong>åªéœ€èŠ±è´¹ä¸€ä¸ªRTTæ—¶é—´ã€‚ä½¿å¾—TCPè¿æ¥ä¸­çš„ç©ºé—²æ—¶é—´å‡å°‘ï¼Œæé«˜äº†ä¸‹è½½æ–‡æ¡£æ•ˆç‡ã€‚</p><ul><li>HTTPçš„æŠ¥æ–‡ç»“æ„</li></ul><p>HTTPæœ‰ä¸¤ç±»æŠ¥æ–‡ï¼š</p><p>1ï¼‰è¯·æ±‚æŠ¥æ–‡â€”â€”ä»å®¢æˆ·å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æŠ¥æ–‡ã€‚</p><p>2ï¼‰å“åº”æŠ¥æ–‡â€”â€”ä»æœåŠ¡å™¨åˆ°å®¢æˆ·çš„å›ç­”ã€‚</p><p><img src="/2021/03/15/network/HTTP%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84.png"></p><p>1ï¼‰å¼€å§‹è¡Œï¼Œç”¨äºåŒºåˆ†æ˜¯è¯·æ±‚æŠ¥æ–‡è¿˜æ˜¯å“åº”æŠ¥æ–‡ã€‚åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­çš„å¼€å§‹è¡Œå«åšè¯·æ±‚è¡Œï¼Œè€Œåœ¨å“åº”æŠ¥æ–‡ä¸­çš„å¼€å§‹è¡Œå«åšçŠ¶æ€è¡Œã€‚å¼€å§‹è¡Œçš„ä¸‰ä¸ªå­—æ®µä¹‹é—´éƒ½ä»¥ç©ºæ ¼åˆ†éš”å¼€ï¼Œæœ€åçš„â€œCRâ€å’Œâ€œLFâ€åˆ†åˆ«ä»£è¡¨å›è½¦å’Œæ¢è¡Œã€‚</p><p>2ï¼‰é¦–éƒ¨è¡Œã€‚è¯´æ˜æµè§ˆå™¨ã€æœåŠ¡å™¨æˆ–æŠ¥æ–‡ä¸»ä½“çš„ä¸€äº›ä¿¡æ¯ã€‚é¦–éƒ¨å¯ä»¥æœ‰å¥½å‡ è¡Œï¼Œä½†å¯ä»¥ä¸ä½¿ç”¨ã€‚æ¯ä¸€è¡Œä¸­éƒ½æœ‰é¦–éƒ¨å­—æ®µåå’Œå®ƒçš„å€¼ï¼Œæ¯ä¸€è¡Œåœ¨ç»“æŸçš„åœ°æ–¹éƒ½è¦æœ‰å›è½¦å’Œæ¢è¡Œã€‚æ•´ä¸ªé¦–éƒ¨è¡Œç»“æŸæ—¶ï¼Œè¿˜æœ‰ä¸€ç©ºè¡Œå°†é¦–éƒ¨å’Œåé¢çš„å®ä½“ä¸»ä½“åˆ†å¼€ã€‚</p><p>3ï¼‰å®ä½“ä¸»ä½“ï¼Œåœ¨è¯·æ±‚æŠ¥æ–‡ä¸­ä¸€èˆ¬éƒ½ä¸ç”¨è¿™ä¸ªå­—æ®µï¼Œè€Œåœ¨å“åº”æŠ¥æ–‡ä¸­ä¹Ÿå¯èƒ½æ²¡æœ‰è¿™ä¸ªå­—æ®µã€‚</p><p><img src="/2021/03/15/network/HTTP%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95.PNG"></p><p><img src="/2021/03/15/network/HTTP%E6%96%B9%E6%B3%95.png"></p><p><img src="/2021/03/15/network/HTTP%E6%8A%A5%E6%96%87%E8%AF%B7%E6%B1%82%E4%BE%8B%E5%AD%90.png"></p><p>ç›¸åº”æŠ¥æ–‡ç»å¸¸è§åˆ°çš„çŠ¶æ€è¡Œï¼š</p><p>HTTP/1.1 202 Accepted {æ¥å—}</p><p>HTTP/1.1 400 Bad Request {é”™è¯¯çš„è¯·æ±‚}</p><p>HTTP/1.1 404 Not Found {æ‰¾ä¸åˆ°}</p><ul><li>æœåŠ¡å™¨ä¸Šå­˜æ”¾ç”¨æˆ·ä¿¡æ¯</li></ul><p>ä¸‡ç»´ç½‘ç½‘ç«™ç‚¹å¯ä»¥ä½¿ç”¨Cookieæ¥è·Ÿè¸ªç”¨æˆ·ã€‚å½“ç”¨æˆ·Aæµè§ˆæŸä¸ªCookieç½‘ç«™æ—¶ï¼Œè¯¥ç½‘ç«™çš„æœåŠ¡å™¨å°±ä¸ºAäº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„è¯†åˆ«ç ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºç´¢å¼•åœ¨æœåŠ¡å™¨çš„åç«¯æ•°æ®åº“ä¸­äº§ç”Ÿä¸€ä¸ªé¡¹ç›®ã€‚æ¥ç€ç»™Açš„HTTPå“åº”æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ªå«åšSet-cookieçš„é¦–éƒ¨è¡Œã€‚è¿™é‡Œçš„é¦–éƒ¨å­—æ®µåå°±æ˜¯Set-cookieï¼Œè€Œåé¢çš„â€œå€¼â€å°±æ˜¯èµ‹äºˆè¯¥ç”¨æˆ·çš„â€œè¯†åˆ«ç â€ã€‚</p><p>å½“Aæ”¶åˆ°è¿™ä¸ªå“åº”æ—¶ï¼Œå…¶æµè§ˆå™¨å°±åœ¨å®ƒç®¡ç†çš„ç‰¹å®šCookieæ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼Œå…¶ä¸­åŒ…æ‹¬è¿™ä¸ªæœåŠ¡å™¨çš„ä¸»æœºåå’ŒSet-cookieåé¢ç»™å‡ºçš„è¯†åˆ«ç ã€‚</p><ul><li>è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€HTML</li></ul><p>å¯¹HTMLå­¦ä¹ è¿‡ï¼Œè¿™é‡Œå¯ä»¥ä¸ç”¨çœ‹ã€‚</p><ul><li>åŠ¨æ€æ–‡æ¡£</li></ul><p>åŠ¨æ€æ–‡æ¡£æ˜¯æŒ‡æ–‡æ¡£çš„å†…å®¹åœ¨æµè§ˆå™¨è®¿é—®ä¸‡ç»´ç½‘æœåŠ¡å™¨æ—¶æ‰ç”±åº”ç”¨ç¨‹åºåŠ¨æ€åˆ›å»ºã€‚å½“æµè§ˆå™¨è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œä¸‡ç»´ç½‘æœåŠ¡å™¨è¦è¿è¡Œå¦ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶æŠŠæ§åˆ¶è½¬ç§»åˆ°æ­¤åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºå¯¹HTTPæŠ¥æ–‡å¤„ç†è¾“å‡ºHTTPæ ¼å¼çš„æ–‡æ¡£ï¼Œä¸‡ç»´ç½‘æœåŠ¡å™¨æŠŠåº”ç”¨ç¨‹åºçš„è¾“å‡ºä½œä¸ºå¯¹æµè§ˆå™¨çš„å“åº”ã€‚</p><ul><li>æ´»åŠ¨ä¸‡ç»´ç½‘æ–‡æ¡£</li></ul><p>åŠ¨æ€æ–‡æ¡£ä¸€æ—¦å»ºç«‹ï¼Œå†…å®¹å°±å›ºå®šä¸‹æ¥æ— æ³•åˆ·æ–°ã€‚æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®¾è®¡äº†æ´»åŠ¨ä¸‡ç»´ç½‘æ–‡æ¡£ã€‚</p><p>ä¸¤ç§æŠ€æœ¯å¯ç”¨äºæµè§ˆå™¨å±å¹•æ˜¾ç¤ºçš„è¿ç»­æ›´æ–°ã€‚<strong>æœåŠ¡å™¨æ¨é€</strong>ï¼Œè¿™ç§æŠ€æœ¯æ˜¯å°†æ‰€æœ‰å·¥ä½œéƒ½äº¤ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨ä¸æ–­åœ°è¿è¡Œä¸åŠ¨æ€æ–‡æ¡£ç›¸å…³è”çš„åº”ç”¨ç¨‹åºï¼Œå®šæœŸæ›´æ–°ä¿¡æ¯ï¼Œå¹¶å‘é€æ›´æ–°è¿‡çš„æ–‡æ¡£ã€‚</p><p><strong>æ´»åŠ¨æ–‡æ¡£</strong>ï¼Œè¿™ç§æŠ€æœ¯æŠŠæ‰€æœ‰å·¥ä½œäº¤ç»™æµè§ˆå™¨ï¼Œæ¯å½“è¯·æ±‚ä¸€ä¸ªæ´»åŠ¨æ–‡æ¡£ï¼ŒæœåŠ¡å™¨å°±è¿”å›ä¸€æ®µæ´»åŠ¨æ–‡æ¡£çš„å‰¯æœ¬ï¼Œä½¿è¯¥ç¨‹åºå‰¯æœ¬åœ¨æµè§ˆå™¨ç«¯è¿è¡Œã€‚è¿™æ—¶æ´»åŠ¨æ–‡æ¡£å¯ä¸ç”¨æˆ·ç›´æ¥äº¤äº’ã€‚</p><ul><li>ä¸‡ç»´ç½‘çš„ä¿¡æ¯æ£€ç´¢ç³»ç»Ÿ</li></ul><p>æœç´¢å¼•æ“åˆ†ä¸ºä¸¤ç±»ï¼š<strong>å…¨æ–‡æ£€ç´¢æœç´¢å¼•æ“</strong>å’Œ<strong>åˆ†ç±»ç›®å½•æœç´¢å¼•æ“</strong>ã€‚</p><p>å…¨æ–‡æœç´¢å¼•æ“æ˜¯ä¸€ç§çº¯æŠ€æœ¯å‹çš„æ£€ç´¢å·¥å…·ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æœç´¢è½¯ä»¶ï¼ˆçˆ¬è™«ï¼‰åˆ°äº’è”ç½‘ä¸Šçš„å„ç½‘ç«™æ”¶é›†ä¿¡æ¯ï¼Œæ‰¾åˆ°ä¸€ä¸ªç½‘ç«™åå¯ä»¥ä»è¿™ä¸ªç½‘ç«™å†é“¾æ¥åˆ°å¦ä¸€ä¸ªç½‘ç«™ï¼ŒæŒ‰ç…§ä¸€å®šè§„åˆ™å»ºç«‹ä¸€ä¸ªå¾ˆå¤§çš„åœ¨çº¿ç´¢å¼•æ•°æ®åº“ä¾›ç”¨æˆ·æŸ¥è¯¢ã€‚ç”¨æˆ·è¾“å…¥å…³é”®å­—ä»å·²ç»å»ºç«‹çš„ç´¢å¼•æ•°æ®åº“é‡Œè¿›è¡ŒæŸ¥è¯¢ã€‚ï¼ˆgoogleï¼‰</p><p>åˆ†ç±»ç›®å½•æœç´¢åˆ©ç”¨å„ç½‘ç«™å‘æœç´¢å¼•æ“æäº¤ç½‘ç«™ä¿¡æ¯æ—¶å¡«å†™çš„å…³é”®è¯å’Œç½‘ç«™æè¿°ç­‰ä¿¡æ¯ï¼Œç»è¿‡äººå·¥å®¡æ ¸åï¼Œè¾“å…¥åˆ†ç±»ç›®å½•æ•°æ®åº“ä¸­ï¼Œä¾›ç½‘ä¸Šç”¨æˆ·æŸ¥è¯¢ã€‚å› æ­¤åˆ†ç±»ç›®å½•æœç´¢å«åˆ†ç±»ç½‘ç«™æœç´¢ã€‚</p><p><img src="/2021/03/15/network/%E4%B8%A4%E7%A7%8D%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E7%9A%84%E5%8C%BA%E5%88%AB.png"></p><h3 id="4-ç”µå­é‚®ä»¶"><a href="#4-ç”µå­é‚®ä»¶" class="headerlink" title="4.ç”µå­é‚®ä»¶"></a>4.ç”µå­é‚®ä»¶</h3><p>ç®€å•é‚®ä»¶ä¼ é€åè®®SMTP(Simple Mail Transfer Protocol)å’Œäº’è”ç½‘æ–‡æœ¬æŠ¥æ–‡æ ¼å¼ã€‚</p><p>é‚®ä»¶ç³»ç»Ÿæ„ä»¶ï¼šç”¨æˆ·ä»£ç†ã€é‚®ä»¶æœåŠ¡å™¨ä»¥åŠé‚®ä»¶å‘é€åè®®(SMTP)å’Œé‚®ä»¶è¯»å–åè®®ï¼ˆPOP3)</p><p><img src="/2021/03/15/network/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%9A%84%E4%B8%BB%E8%A6%81%E6%9E%84%E4%BB%B6.png"></p><p>POP3æ˜¯é‚®å±€åè®®ï¼ˆç‰ˆæœ¬3ï¼‰ã€‚</p><p>SMTPå’ŒPOP3éƒ½æ˜¯ä½¿ç”¨TCPæ¥ä½œä¸ºä¼ è¾“åè®®çš„ã€‚</p><h4 id="SMTPåè®®"><a href="#SMTPåè®®" class="headerlink" title="SMTPåè®®"></a>SMTPåè®®</h4><p>è§„å®šäº†ä¸¤ä¸ªç›¸äº’é€šä¿¡çš„SMTPè¿›ç¨‹ä¹‹é—´å¦‚ä½•äº¤æ¢ä¿¡æ¯ã€‚é‚®ä»¶å†…éƒ¨æ ¼å¼ï¼Œé‚®ä»¶å¦‚ä½•å­˜å‚¨ï¼Œä»¥åŠé‚®ä»¶ç³»ç»Ÿåº”ä»¥å¤šå¿«çš„é€Ÿåº¦æ¥å‘é€é‚®ä»¶ï¼ŒSMTPä¹Ÿéƒ½<strong>æœª</strong>åšå‡ºè§„å®šã€‚</p><p>SMTPè§„å®šäº†14æ¡å‘½ä»¤å’Œ21ç§åº”ç­”ä¿¡æ¯ã€‚æ¯æ¡å‘½ä»¤ç”¨å‡ ä¸ªå­—æ¯ç»„æˆï¼Œè€Œæ¯ä¸€ç§åº”ç­”ä¿¡æ¯ä¸€èˆ¬éƒ½åªæœ‰ä¸€è¡Œä¿¡æ¯ï¼Œç”±ä¸€ä¸ª3ä½æ•°å­—çš„ä»£ç å¼€å§‹ï¼Œåé¢é™„ä¸Šï¼ˆä¹Ÿå¯ä»¥ä¸é™„ä¸Šï¼‰å¾ˆç®€å•çš„æ–‡å­—è¯´æ˜ã€‚</p><p>1ï¼‰è¿æ¥å»ºç«‹ã€‚</p><p>å‘ä»¶äººçš„é‚®ä»¶å‘é€åˆ°å‘é€æ–¹çš„é‚®ä»¶æœåŠ¡å™¨é‚®ä»¶ç¼“å­˜åï¼ŒSMTPå®¢æˆ·æ¯éš”ä¸€æ®µæ—¶é—´å¯¹é‚®ä»¶ç¼“å­˜æ‰«æä¸€æ¬¡ã€‚å¦‚å‘ç°æœ‰é‚®ä»¶ï¼Œä½¿ç”¨SMTPç†ŸçŸ¥ç«¯å£25ä¸æ¥æ”¶æ–¹é‚®ä»¶æœåŠ¡å™¨çš„SMTPæœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ã€‚å»ºç«‹è¿æ¥åï¼Œæ¥æ”¶æ–¹SMTPæœåŠ¡å™¨å‘å‡ºâ€œ220 Service readyâ€ï¼ˆæœåŠ¡å°±ç»ªï¼‰åº”ç­”ã€‚ç„¶åå®¢æˆ·å‘SMTPæœåŠ¡å™¨å‘é€HELOå‘½ä»¤ï¼Œé™„ä¸Šå‘é€æ–¹çš„ä¸»æœºåã€‚SMTPæœåŠ¡å™¨è‹¥æœ‰èƒ½åŠ›æ¥æ”¶é‚®ä»¶ï¼Œåˆ™å›ç­”ï¼šâ€œ250 OKâ€ï¼Œè¡¨ç¤ºå·²å‡†å¤‡å¥½æ¥æ”¶ã€‚è‹¥SMTPæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å›ç­”â€œ421 Service not availableâ€ï¼ˆæœåŠ¡ä¸å¯ç”¨ï¼‰ã€‚</p><p>è‹¥ä¸€å®šæ—¶é—´å†…ï¼ˆæ¯”å¦‚ä¸‰å¤©ï¼‰å‘é€ä¸äº†é‚®ä»¶ï¼Œé‚®ä»¶æœåŠ¡å™¨å°±ä¼šæŠŠæƒ…å†µé€šçŸ¥å‘ä»¶äººã€‚</p><p>SMTPä¸ä½¿ç”¨ä¸­é—´çš„é‚®ä»¶æœåŠ¡å™¨ï¼ŒTCPè¿æ¥æ€»æ˜¯ç‚¹å¯¹ç‚¹ã€‚</p><p>2ï¼‰é‚®ä»¶å‘é€</p><p><code>MAIN</code>å‘½ä»¤å¼€å§‹ï¼Œå¦‚ï¼šâ€œ<code>MAIL FROM</code>ï¼š<a href="mailto:xiexiren@tsinghua.org.cn">xiexiren@tsinghua.org.cn</a>â€ã€‚è‹¥SMTPæœåŠ¡å™¨å·²å‡†å¤‡å¥½æ¥æ”¶é‚®ä»¶ï¼Œåˆ™å›ç­”â€œ250 OKâ€ã€‚å¦åˆ™è¿”å›ä»£ç æŒ‡å‡ºåŸå› ï¼š</p><p><img src="/2021/03/15/network/SMTP%E8%BF%94%E5%9B%9E%E4%BB%A3%E7%A0%81.png"></p><p>åé¢è·Ÿç€ä¸€ä¸ªæˆ–å¤šä¸ªRCPTå‘½ä»¤ï¼ˆå‘é€ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªæ”¶ä»¶äººï¼‰ï¼ŒRCPTæ ¼å¼ï¼š<code>RCPT TO:&lt;æ”¶ä»¶äººåœ°å€&gt;</code>ã€‚RCPTæ˜¯recipientï¼ˆæ”¶ä»¶äººï¼‰çš„ç¼©å†™ã€‚æ¯å‘é€ä¸€ä¸ªRCPTå‘½ä»¤ï¼Œéƒ½åº”å½“æœ‰ç›¸åº”çš„ä¿¡æ¯ä»SMTPæœåŠ¡å™¨è¿”å›ï¼Œå¦‚ï¼šâ€œ250 OKâ€ï¼Œè¡¨æ˜æŒ‡æ˜çš„é‚®ç®±åœ¨æ¥æ”¶æ–¹çš„ç³»ç»Ÿä¸­ï¼Œæˆ–â€œ550 No such user hereâ€,å³ä¸å­˜åœ¨æ­¤é‚®ç®±ã€‚</p><p>RCPTå‘½ä»¤çš„ä½œç”¨å°±æ˜¯ï¼šå…ˆå¼„æ¸…æ¥šæ¥æ”¶æ–¹ç³»ç»Ÿæ˜¯å¦å·²åšå¥½æ¥æ”¶é‚®ä»¶çš„å‡†å¤‡ï¼Œç„¶åæ‰å‘é€é‚®ä»¶ã€‚</p><p>3ï¼‰è¿æ¥é‡Šæ”¾</p><p>é‚®ä»¶å‘é€å®Œæ¯•åï¼ŒSMTPå®¢æˆ·åº”å‘é€QUITå‘½ä»¤ã€‚SMTPæœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯æ˜¯â€œ221ï¼ˆæœåŠ¡å…³é—­ï¼‰â€ï¼Œè¡¨ç¤ºSMTPåŒæ„é‡Šæ”¾TCPè¿æ¥ã€‚é‚®ä»¶ä¼ é€çš„å…¨éƒ¨è¿‡ç¨‹ç»“æŸã€‚</p><h4 id="ç”µå­é‚®ä»¶çš„ä¿¡æ¯æ ¼å¼"><a href="#ç”µå­é‚®ä»¶çš„ä¿¡æ¯æ ¼å¼" class="headerlink" title="ç”µå­é‚®ä»¶çš„ä¿¡æ¯æ ¼å¼"></a>ç”µå­é‚®ä»¶çš„ä¿¡æ¯æ ¼å¼</h4><p>ä¸€å°ç”µå­é‚®ä»¶åˆ†ä¸º<strong>ä¿¡å°</strong>å’Œ<strong>å†…å®¹</strong>ä¸¤å¤§éƒ¨åˆ†ã€‚</p><p><code>To</code>ï¼šåé¢å¡«å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ”¶ä»¶äººçš„ç”µå­é‚®ä»¶åœ°å€ã€‚åœ¨ç”µå­é‚®ä»¶è½¯ä»¶ä¸­ï¼Œç”¨æˆ·æŠŠç»å¸¸é€šä¿¡çš„å¯¹è±¡å§“åå’Œç”µå­é‚®ä»¶åœ°å€å†™åˆ°<strong>åœ°å€ç°¿</strong>ã€‚</p><p><code>Subject</code>ï¼šæ˜¯é‚®ä»¶çš„<strong>ä¸»é¢˜</strong>ã€‚</p><h4 id="é‚®ä»¶è¯»å–åè®®POP3å’ŒIMAP"><a href="#é‚®ä»¶è¯»å–åè®®POP3å’ŒIMAP" class="headerlink" title="é‚®ä»¶è¯»å–åè®®POP3å’ŒIMAP"></a>é‚®ä»¶è¯»å–åè®®POP3å’ŒIMAP</h4><p>é‚®å±€åè®®POP3å’ŒIMAPç½‘é™…æŠ¥æ–‡å­˜å–åè®®(Internet Message Access Protocol)ã€‚</p><p>POP3åè®®çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯åªè¦ç”¨æˆ·ä»POP3æœåŠ¡å™¨è¯»å–äº†é‚®ä»¶ï¼ŒPOP3æœåŠ¡å™¨å°±è¯¥æŠŠé‚®ä»¶åˆ é™¤ã€‚</p><p>IMAPæ¯”POP3å¤æ‚å¾ˆå¤šï¼ŒIMAPå’ŒPOPéƒ½æŒ‰ç…§å®¢æˆ·æœåŠ¡å™¨æ–¹å¼å·¥ä½œï¼Œä½†å®ƒä»¬æœ‰å¾ˆå¤§åŒºåˆ«ã€‚ç”¨æˆ·å¯ä»¥åœ¨ä¸åŒçš„åœ°æ–¹ä½¿ç”¨ä¸åŒçš„è®¡ç®—æœºï¼Œéšæ—¶å¤„ç†è‡ªå·±çš„é‚®ä»¶æœåŠ¡ã€‚ä½¿ç”¨IMAPæ—¶ï¼Œåœ¨ç”¨æˆ·çš„è®¡ç®—æœºä¸Šè¿è¡ŒIMAPå®¢æˆ·ç¨‹åºï¼Œç„¶åä¸æ¥æ”¶æ–¹çš„é‚®ä»¶æœåŠ¡å™¨ä¸Šçš„IMAPå»ºç«‹TCPè¿æ¥ã€‚ç”¨æˆ·åœ¨è‡ªå·±çš„è®¡ç®—æœºä¸Šå°±å¯ä»¥æ“çºµé‚®ä»¶æœåŠ¡å™¨çš„é‚®ç®±ï¼Œå°±åƒæœ¬åœ°æ“çºµä¸€æ ·ï¼ŒIMAPæ˜¯ä¸€ä¸ªè”æœºåè®®ã€‚</p><p><img src="/2021/03/15/network/IMAP%E5%92%8CPOP3.png"></p><ul><li>é€šç”¨äº’è”ç½‘é‚®ä»¶æ‰©å……MIME</li></ul><p><img src="/2021/03/15/network/MIME%E5%92%8CSMTP%E7%9A%84%E5%85%B3%E7%B3%BB.png"></p><p>MIMEä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰éƒ¨åˆ†ï¼š</p><p>1ï¼‰5ä¸ªæ–°çš„é‚®ä»¶é¦–éƒ¨å­—æ®µï¼Œå®ƒä»¬å¯ä»¥åŒ…å«åœ¨åŸæ¥çš„é‚®ä»¶é¦–éƒ¨ä¸­ã€‚è¿™äº›å­—æ®µæä¾›äº†æœ‰å…³é‚®ä»¶ä¸»ä½“çš„ä¿¡æ¯ã€‚</p><p>2ï¼‰å®šä¹‰äº†è®¸å¤šé‚®ä»¶å†…å®¹çš„æ ¼å¼ï¼Œå¯¹å¤šåª’ä½“ç”µå­é‚®ä»¶çš„è¡¨ç¤ºæ–¹æ³•è¿›è¡Œäº†æ ‡å‡†åŒ–ã€‚</p><p>3ï¼‰å®šä¹‰äº†ä¼ é€ç¼–ç ï¼Œå¯å¯¹ä»»ä½•å†…å®¹æ ¼å¼è¿›è¡Œè½¬æ¢ï¼Œè€Œä¸ä¼šè¢«é‚®ä»¶ç³»ç»Ÿæ”¹å˜ã€‚</p><p><img src="/2021/03/15/network/MIME%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F.png"></p><p>å…¶ä¸­ï¼Œ4ï¼‰å†…å®¹ä¼ é€ç¼–ç ã€‚MEMEå¯¹ACSIIç æ„æˆçš„é‚®ä»¶ä¸è¿›è¡Œä»»ä½•è½¬æ¢ã€‚å¦ä¸€ç§ç¼–ç æ–¹å¼æ˜¯quoted-printableï¼Œè¿™ç§ç¼–ç æ–¹å¼ç­‰å·â€œ=â€å’Œä¸å¯æ‰“å°çš„ACSIIç ï¼Œé™¤ç‰¹æ®Šå­—ç¬¦ç­‰å·â€œ=â€å¤–ï¼Œéƒ½ä¸å¯æ”¹å˜ã€‚ï¼ˆ<font color="red">è¿™ä¸ªåœ°æ–¹åœ¨ä»‹ç»å…¶ä»–ç¼–ç æ–¹å¼ï¼Œå¯ä»¥ä¸ç”¨çœ‹</font>ï¼‰</p><p>5)å†…å®¹ç±»å‹</p><p>å†…å®¹ç±»å‹å¿…é¡»æœ‰ä¸¤ä¸ªæ ‡è¯†ç¬¦ï¼Œå³â€œå†…å®¹ç±»å‹â€å’Œâ€œå­ç±»å‹â€ï¼Œä¸­é—´ç”¨â€œ/â€œåˆ†å¼€ã€‚</p><p><img src="/2021/03/15/network/MIME%E5%86%85%E5%AE%B9%E7%B1%BB%E5%9E%8B.png"></p><p><img src="/2021/03/15/network/MIME%E5%86%85%E5%AE%B9%E7%B1%BB%E5%9E%8B1.png"></p><h3 id="5-åŠ¨æ€ä¸»æœºæ§åˆ¶åè®®DHCP"><a href="#5-åŠ¨æ€ä¸»æœºæ§åˆ¶åè®®DHCP" class="headerlink" title="5.åŠ¨æ€ä¸»æœºæ§åˆ¶åè®®DHCP"></a>5.åŠ¨æ€ä¸»æœºæ§åˆ¶åè®®DHCP</h3><p>åè®®è½¯ä»¶å‚æ•°åŒ–ï¼Œè®©å¾ˆå¤šä¸åŒçš„è®¡ç®—æœºæœ‰å¯èƒ½ä½¿ç”¨åŒä¸€ä¸ªç»è¿‡ç¼–è¯‘åçš„äºŒè¿›åˆ¶ä»£ç ã€‚ä¸€å°è®¡ç®—æœºéœ€æ±‚ä¸åŒï¼Œå¯ä»¥é€šè¿‡å‚æ•°å¯¹ä»£ç è¡Œä¸ºè¿›è¡Œæ§åˆ¶ã€‚</p><p>åè®®è½¯ä»¶ä¸­ç»™è¿™äº›å‚æ•°èµ‹å€¼çš„åŠ¨ä½œå«åš<strong>åè®®é…ç½®</strong>ã€‚ä¸€ä¸ªåè®®è½¯ä»¶åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»æ˜¯æ­£ç¡®é…ç½®çš„ã€‚åè®®è½¯ä»¶é…ç½®çš„é¡¹ç›®å¦‚ä¸‹ï¼š</p><ul><li>IPåœ°å€</li><li>å­ç½‘æ©ç </li><li>é»˜è®¤è·¯ç”±å™¨çš„IPåœ°å€</li><li>åŸŸåæœåŠ¡å™¨çš„IPåœ°å€</li></ul><p>å› ä¸ºIPåœ°å€ä¸­è¿˜åŒ…æ‹¬ç½‘ç»œå·ï¼Œå¦‚æœä¸€ä¸ªä¸»æœºç”Ÿäº§å‡ºæ¥åå°±å›ºå®šä¸€ä¸ªIPæ˜¯ä¸è¡Œçš„ã€‚</p><p>ç°åœ¨å¹¿æ³›ä½¿ç”¨çš„æ˜¯**åŠ¨æ€ä¸»æœºé…ç½®åè®®DHCP(Dynamic Host Configuration Protocol)**ï¼Œå®ƒæä¾›äº†å³æ’å³ç”¨è”ç½‘æœºåˆ¶ã€‚</p><p>DHCPä½¿ç”¨å®¢æˆ·æœåŠ¡å™¨æ–¹å¼ã€‚éœ€è¦IPåœ°å€çš„ä¸»æœºåœ¨å¯åŠ¨æ—¶å°±å‘DHCPæœåŠ¡å™¨å¹¿æ’­å‘é€<strong>å‘ç°æŠ¥æ–‡</strong>(å°†ç›®çš„IPåœ°å€ç½®ä¸ºå…¨1ï¼Œå³255.255.255.255)ï¼Œï¼Œæœ¬æœºåœ°å€è®¾ç½®ä¸º0.0.0.0ï¼ˆæœ¬æœºè¿˜ä¸çŸ¥é“ï¼Œåªèƒ½è¿™ä¹ˆè®¾ç½®ï¼‰ã€‚è¿™ä¸ªæŠ¥æ–‡åªæœ‰DHCPæœåŠ¡å™¨èƒ½å¤Ÿè¿›è¡Œå›ç­”ã€‚DHCPæœåŠ¡å™¨ç°åœ¨å…¶æ•°æ®åº“ä¸­æŸ¥æ‰¾è¯¥è®¡ç®—æœºçš„é…ç½®ä¿¡æ¯ï¼Œè‹¥æ‰¾åˆ°ï¼Œåˆ™è¿”å›ä¿¡æ¯ã€‚è‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™ä»æœåŠ¡å™¨çš„IPåœ°å€æ± ä¸­å–ä¸€ä¸ªåœ°å€åˆ†é…ç»™è¯¥è®¡ç®—æœºã€‚DHCPæœåŠ¡å™¨å›ç­”æŠ¥æ–‡å«<strong>æä¾›æŠ¥æ–‡</strong>ï¼Œè¡¨ç¤ºâ€œæä¾›â€äº†IPåœ°å€ç­‰é…ç½®ä¿¡æ¯ã€‚</p><p>ä¸ºäº†é˜²æ­¢DHCPæœåŠ¡å™¨å¤ªå¤šï¼Œæ¯ä¸ªç½‘ç»œè‡³å°‘æœ‰ä¸€ä¸ªDHCPä¸­ç»§ä»£ç†ï¼Œé€šå¸¸æ˜¯ä¸€å°è·¯ç”±å™¨ï¼Œå®ƒé…ç½®äº†DHCPæœåŠ¡å™¨çš„IPåœ°å€ä¿¡æ¯ã€‚å½“DHCPä¸­ç»§ä»£ç†æ”¶åˆ°ä¸»æœºAä»¥å¹¿æ’­å½¢å¼å‘é€çš„æŠ¥æ–‡åï¼Œå°±ä»¥å•æ’­çš„å½¢å¼å‘DHCPæœåŠ¡å™¨å‘é€æ­¤æŠ¥æ–‡ï¼Œç­‰å¾…å›ç­”ã€‚</p><p><img src="/2021/03/15/network/DHCP%E4%B8%AD%E7%BA%A7%E4%BB%A3%E7%90%86.png"></p><p>DHCPæœåŠ¡å™¨åˆ†é…ç»™DHCPå®¢æˆ·çš„IPçš„åœ°å€æ˜¯ä¸´æ—¶çš„ï¼Œå› æ­¤DHCPå®¢æˆ·åªèƒ½åœ¨ä¸€æ®µæœ‰é™æ—¶é—´å†…ä½¿ç”¨è¿™ä¸ªIPåœ°å€ï¼Œè¿™ä¸ªæ—¶é—´å«<strong>ç§Ÿç”¨æœŸ</strong>ã€‚DHCPåè®®è§„å®šç§Ÿç”¨æœŸç”¨4å­—èŠ‚è¡¨ç¤ºï¼Œå•ä½æ˜¯ç§’ã€‚å› æ­¤ç§Ÿç”¨æœŸèŒƒå›´æ˜¯1ç§’åˆ°136å¹´ã€‚DHCPå®¢æˆ·ä¹Ÿå¯åœ¨è‡ªå·±å‘é€çš„æŠ¥æ–‡ä¸­æå‡ºå¯¹ç§Ÿç”¨æœŸçš„è¦æ±‚ã€‚</p><p>DHCPå®¢æˆ·ä½¿ç”¨<strong>UDP</strong>ç«¯å£68ï¼ŒæœåŠ¡å™¨ä½¿ç”¨67ã€‚</p><p><img src="/2021/03/15/network/DHCP%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.png"></p><p>å·¥ä½œåè®®çš„è§£é‡Šè¯¦æƒ…çœ‹P297ã€‚</p><h3 id="6-ç®€å•ç½‘ç»œç®¡ç†åè®®SNMP"><a href="#6-ç®€å•ç½‘ç»œç®¡ç†åè®®SNMP" class="headerlink" title="6. ç®€å•ç½‘ç»œç®¡ç†åè®®SNMP"></a>6. ç®€å•ç½‘ç»œç®¡ç†åè®®SNMP</h3><p>ç®¡ç†ç«™åˆç§°ä¸ºç®¡ç†å™¨ï¼Œæ˜¯æ•´ä¸ªç½‘ç»œç³»ç»Ÿçš„æ ¸å¿ƒã€‚å®ƒé€šå¸¸æ˜¯ä¸ªæœ‰è‰¯å¥½å›¾å½¢ç•Œé¢çš„é«˜æ€§èƒ½å·¥ä½œç«™ï¼Œå¹¶ç”±ç½‘ç»œç®¡ç†å‘˜ç›´æ¥æ“ä½œå’Œæ§åˆ¶ã€‚</p><p>SNMPä¸­çš„ç®¡ç†ç¨‹åºå’Œä»£ç†ç¨‹åºæŒ‰å®¢æˆ·æœåŠ¡å™¨æ–¹å¼å·¥ä½œã€‚åœ¨è¢«ç®¡ç†å¯¹è±¡ä¸Šè¿è¡Œçš„SNMPæœåŠ¡å™¨ç¨‹åºä¸åœåœ°ç›‘å¬æ¥è‡ªå®¢æˆ·ç¨‹åºçš„è¯·æ±‚ï¼Œä¸€æ—¦å‘ç°å°±è¿”å›æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œæˆ–è€…æ‰§è¡ŒæŸä¸ªåŠ¨ä½œã€‚</p><p>ç½‘ç»œç®¡ç†æœ‰ä¸€ä¸ªåŸºæœ¬<strong>åŸç†</strong>ï¼šè‹¥è¦ç®¡ç†æŸä¸ªå¯¹è±¡ï¼Œå°±å¿…ç„¶ä¼šç»™è¯¥å¯¹è±¡æ·»åŠ ä¸€äº›è½¯ä»¶æˆ–ç¡¬ä»¶ï¼Œä½†è¿™ç§â€œæ·»åŠ â€å¯¹åŸæœ‰å¯¹è±¡çš„å½±å“å¿…é¡»å°½é‡å°äº›ã€‚</p><p>SNMPç½‘ç»œç®¡ç†ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå³SNMPæœ¬èº«ã€ç®¡ç†ä¿¡æ¯ç»“æ„SMIå’Œç®¡ç†ä¿¡æ¯åº“MIBã€‚</p><ul><li>ç®¡ç†ä¿¡æ¯ç»“æ„SMI</li></ul><p>SMIæ˜¯SNMPçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚SMIçš„åŠŸèƒ½æœ‰ï¼š</p><p>1ï¼‰è¢«ç®¡å¯¹è±¡å¦‚ä½•å‘½åã€‚</p><p>2ï¼‰ç”¨æ¥å­˜å‚¨è¢«ç®¡å¯¹è±¡çš„æ•°æ®ç±»å‹æœ‰å“ªäº›ã€‚</p><p>3ï¼‰åœ¨ç½‘ç»œä¸Šä¼ é€çš„ç®¡ç†æ•°æ®åº”å¦‚ä½•ç¼–ç ã€‚</p><ol><li>è¢«ç®¡å¯¹è±¡çš„å‘½åã€‚</li></ol><p>SMIè§„å®šï¼Œæ‰€æœ‰çš„è¢«ç®¡å¯¹è±¡éƒ½å¿…é¡»å¤„åœ¨å¯¹è±¡å‘½åæ ‘ä¸Šã€‚</p><p><img src="/2021/03/15/network/SMI%E5%AF%B9%E8%B1%A1%E5%91%BD%E5%90%8D%E6%A0%91.png"></p><p>å¯¹è±¡å‘½åæ ‘çš„æ ¹æ²¡æœ‰åå­—ï¼Œå®ƒä¸‹é¢æœ‰ä¸‰ä¸ªé¡¶çº§å¯¹è±¡ï¼Œéƒ½æ˜¯ä¸–ç•Œä¸Šè‘—åçš„æ ‡å‡†æŒ‡å®šå•ä½ï¼Œå³ITU-Tï¼ŒISOä»¥åŠè¿™ä¸¤ä¸ªç»„ç»‡çš„è”åˆä½“ã€‚internetèŠ‚ç‚¹ä¸‹é¢çš„æ ‡å·ä¸º2çš„èŠ‚ç‚¹æ˜¯mgmtï¼ˆç®¡ç†ï¼‰ã€‚å†ä¸‹é¢æ˜¯mib-2ï¼ŒåŒ…å«äº†æ‰€æœ‰è¢«SNMPç®¡ç†çš„å¯¹è±¡ã€‚</p><ol start="2"><li>è¢«ç®¡å¯¹è±¡çš„æ•°æ®ç±»å‹</li></ol><p>SMIä½¿ç”¨åŸºæœ¬çš„æŠ½è±¡è¯­æ³•è®°æ³•1ï¼ˆå³ISOåˆ¶å®šçš„ASN.1)æ¥å®šä¹‰æ•°æ®ç±»å‹ã€‚è¿™é‡Œçš„ISO ASN.1ä¸ç”¨ç®¡ï¼Œå®ƒåªæ˜¯æè¿°æ•°æ®çš„ç»“æ„å½¢å¼ã€‚</p><p>SMIæŠŠæ•°æ®ç±»å‹åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>ç®€å•ç±»å‹</strong>å’Œ<strong>ç»“æ„åŒ–ç±»å‹</strong>ã€‚ç®€å•ç±»å‹æ˜¯æœ€åŸºæœ¬çš„ã€ç›´æ¥ä½¿ç”¨ASN.1å®šä¹‰çš„ç±»å‹ã€‚</p><p><img src="/2021/03/15/network/SMI%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png"></p><ol start="3"><li>ç¼–ç æ–¹æ³•</li></ol><p>ä½¿ç”¨**åŸºæœ¬ç¼–ç è§„åˆ™BER(Basic Encoding Rule)**è¿›è¡Œæ•°æ®çš„ç¼–ç ã€‚BERæŒ‡æ˜äº†æ¯ç§æ•°æ®çš„ç±»å‹å’Œå€¼ã€‚ASN.1æŠŠæ‰€æœ‰æ•°æ®å…ƒç´ éƒ½è¡¨ç¤ºä¸ºT-L-Vä¸‰ä¸ªå­—æ®µç»„æˆçš„åºåˆ—ã€‚Tå­—æ®µå®šä¹‰æ•°æ®çš„ç±»å‹ï¼ŒLå­—æ®µå®šä¹‰Vå­—æ®µçš„é•¿åº¦ï¼Œè€ŒVå­—æ®µå®šä¹‰æ•°æ®çš„å€¼ã€‚</p><p><img src="/2021/03/15/network/TLV%E6%96%B9%E6%B3%95.png"></p><p>Tå­—æ®µå«åš<strong>æ ‡è®°å­—æ®µ</strong>ã€‚å 1å­—èŠ‚ã€‚Tå­—æ®µæ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºä»–è¦å®šä¹‰æ•°æ®ç±»å‹è¾ƒå¤šã€‚Tå­—æ®µåˆåˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªå­å­—æ®µï¼š</p><p>1ï¼‰ç±»åˆ«ï¼ˆ2ä½ï¼‰å…±å››ç§ï¼šé€šç”¨ç±»ï¼ˆ00ï¼‰ï¼Œå³ASN.1å®šä¹‰çš„ç±»å‹ã€‚åº”ç”¨ç±»ï¼ˆ01ï¼‰å³SMIå®šä¹‰çš„ç±»å‹ã€‚ä¸Šä¸‹æ–‡ç±»ï¼ˆ10ï¼‰ï¼Œå³ä¸Šä¸‹æ–‡æ‰€å®šä¹‰çš„ç±»å‹ï¼›ä¸“ç”¨ç±»ï¼ˆ11ï¼‰ï¼Œä¿ç•™ä¸ºç‰¹å®šå‚å•†å®šä¹‰çš„ç±»å‹ã€‚</p><p>2ï¼‰æ ¼å¼ï¼ˆ1ä½ï¼‰å…±ä¸¤ç§ï¼ŒæŒ‡å‡ºæ•°æ®ç±»å‹çš„ç§ç±»ï¼šç®€å•æ•°æ®ç±»å‹ï¼ˆ0ï¼‰ã€ç»“æ„åŒ–æ•°æ®ç±»å‹ï¼ˆ1ï¼‰ã€‚</p><p>3ï¼‰ç¼–å·ï¼ˆ5ä½ï¼‰ï¼Œå…±ä¸¤ç§ï¼Œæ ‡å¿—ä¸åŒçš„æ•°æ®ç±»å‹ã€‚ç¼–å·çš„èŒƒå›´æ˜¯0-30ã€‚å½“ç¼–å·å¤§äº30æ—¶ï¼ŒTå­—æ®µå°±è¦æ‰©å±•å¤šä¸ªå­—èŠ‚ã€‚</p><p>Lå­—æ®µåˆå«åšé•¿åº¦å­—æ®µã€‚Lå­—æ®µä¸ºå•å­—èŠ‚æ—¶ï¼Œå…¶æœ€é«˜ä½ä¸º0ï¼Œåé¢çš„7ä½å®šä¹‰Vå­—æ®µçš„é•¿åº¦ã€‚å½“Lå­—æ®µä¸ºå¤šä¸ªå­—èŠ‚æ—¶ï¼Œå…¶æœ€é«˜ä½ä¸º1ï¼Œè€Œåé¢çš„7ä½å®šä¹‰åç»­å­—èŠ‚çš„å­—èŠ‚æ•°ã€‚</p><p><img src="/2021/03/15/network/L%E5%AD%97%E6%AE%B5%E7%9A%84%E6%A0%BC%E5%BC%8F.png"></p><p>Vå­—æ®µåˆå«å€¼å­—æ®µï¼Œç”¨äºå®šä¹‰æ•°æ®å…ƒç´ çš„å€¼ã€‚</p><ul><li>ç®¡ç†ä¿¡æ¯åº“MIB</li></ul><p>ç®¡ç†ä¿¡æ¯æŒ‡äº’è”ç½‘çš„ç½‘ç®¡æ¡†æ¶ä¸­è¢«ç®¡å¯¹è±¡çš„é›†åˆã€‚è¢«ç®¡å¯¹è±¡æ„æˆäº†ä¸€ä¸ªè™šæ‹Ÿçš„ä¿¡æ¯å­˜å‚¨å™¨ï¼Œæ‰€ä»¥æ‰ç§°ä¸ºç®¡ç†ä¿¡æ¯åº“MIBã€‚ç®¡ç†ç¨‹åºå°±ä½¿ç”¨MIBä¸­çš„è¿™äº›ä¿¡æ¯å¯¹ç½‘ç»œè¿›è¡Œç®¡ç†ã€‚åªæœ‰åœ¨MIBä¸­çš„å¯¹è±¡æ‰æ˜¯SNMPæ‰€èƒ½å¤Ÿç®¡ç†çš„ã€‚</p><p>MIBçš„æ„ä¹‰ï¼šèŠ‚ç‚¹<code>ip</code>ä¸‹é¢æœ‰ä¸ªåä¸º<code>ipInReceives</code>çš„MIBå˜é‡ï¼Œè¡¨ç¤ºæ”¶åˆ°çš„IPæ•°æ®æŠ¥æ•°é‡ã€‚åœ¨å›¾6-22ä¸­ï¼Œè¿™ä¸ªå˜é‡çš„æ ‡å·æ˜¯3ï¼Œå˜é‡çš„åå­—æ˜¯:<code>iso.org.dod.internet.mgmt.mib.ip.ipInReceives</code>ï¼Œè€Œç›¸åº”çš„æ•°å€¼è¡¨ç¤ºæ˜¯1.3.6.1.2.1.4.3ã€‚</p><ul><li>SNMPçš„åè®®æ•°æ®å•å…ƒå’ŒæŠ¥æ–‡</li></ul><p>1ï¼‰<strong>â€œè¯»â€</strong>æ“ä½œï¼Œç”¨GetæŠ¥æ–‡æ¥æ£€æµ‹å„è¢«ç®¡å¯¹è±¡çš„çŠ¶å†µã€‚</p><p>2ï¼‰<strong>â€å†™â€œ</strong>æ“ä½œï¼Œç”¨SetæŠ¥æ–‡æ¥æ”¹å˜å„è¢«ç®¡å¯¹è±¡çš„çŠ¶å†µã€‚</p><p>SNMPçš„è¿™äº›åŠŸèƒ½é€šè¿‡æ¢è¯¢æ“ä½œæ¥å®ç°ï¼Œå³SNMPç®¡ç†è¿›ç¨‹å®šæ—¶å‘è¢«ç®¡ç†è®¾å¤‡å‘¨æœŸæ€§åœ°å‘é€æ¢è¯¢ä¿¡æ¯ã€‚ä¸Šè¿°æ—¶é—´é—´éš”å¯é€šè¿‡SNMPçš„ç®¡ç†ä¿¡æ¯åº“MIBæ¥å»ºç«‹ã€‚æ¢è¯¢çš„å¥½å¤„æ˜¯ï¼šç¬¬ä¸€ï¼Œå¯ä½¿ç³»ç»Ÿç›¸å¯¹ç®€å•ã€‚ç¬¬äºŒï¼Œèƒ½é™åˆ¶é€šè¿‡ç½‘ç»œæ‰€äº§ç”Ÿçš„ç®¡ç†ä¿¡æ¯çš„é€šä¿¡é‡ã€‚</p><p>SNMPåŒæ—¶ä¸æ˜¯å®Œå…¨çš„æ¢å¯»åè®®ï¼Œå®ƒä¸å…è®¸ä¸ç»è¿‡è¯¢é—®å°±èƒ½å‘é€æŸäº›ä¿¡æ¯ã€‚è¿™ç§ä¿¡æ¯ç§°ä¸ºé™·é˜±ï¼Œè¡¨ç¤ºå®ƒèƒ½å¤Ÿæ•æ‰â€œäº‹ä»¶â€ã€‚ä½†è¿™ç§é™·é˜±ä¿¡æ¯çš„å‚æ•°æ˜¯å—é™åˆ¶çš„ã€‚</p><p><strong>ä½¿ç”¨æ— è¿æ¥çš„UDP</strong>ã€‚æœåŠ¡å™¨ç«¯ä½¿ç”¨161æ¥æ¥æ”¶Getæˆ–SetæŠ¥æ–‡å’Œå‘é€å“åº”æŠ¥æ–‡ï¼Œä½†è¿è¡Œç®¡ç†ç¨‹åºçš„å®¢æˆ·ç«¯åˆ™ä½¿ç”¨ç†ŸçŸ¥ç«¯å£162æ¥æ¥æ”¶æ¥è‡ªå„ä»£ç†çš„trapæŠ¥æ–‡ã€‚</p><p><img src="/2021/03/15/network/SNMP%E7%9A%84%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.png"></p><p>SNMPæŠ¥æ–‡æ²¡æœ‰å›ºå®šçš„å­—æ®µï¼Œå…±åˆ†ä¸ºä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š</p><p>1ï¼‰ç‰ˆæœ¬</p><p>2ï¼‰é¦–éƒ¨</p><p>3ï¼‰å®‰å…¨å‚æ•°</p><p>4ï¼‰æ•°æ®éƒ¨åˆ†</p><h3 id="7-åº”ç”¨è¿›ç¨‹è·¨è¶Šç½‘ç»œçš„é€šä¿¡"><a href="#7-åº”ç”¨è¿›ç¨‹è·¨è¶Šç½‘ç»œçš„é€šä¿¡" class="headerlink" title="7. åº”ç”¨è¿›ç¨‹è·¨è¶Šç½‘ç»œçš„é€šä¿¡"></a>7. åº”ç”¨è¿›ç¨‹è·¨è¶Šç½‘ç»œçš„é€šä¿¡</h3><p>å®é™…ä¸Šåº”ç”¨ç¨‹åºè°ƒç”¨ç³»ç»Ÿæ¥å£ã€‚æ­¤æ¥å£æŠŠæ§åˆ¶æƒäº¤ç»™æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿæ‰§è¡Œå®Œæˆåï¼Œåœ¨è¿”å›ç»™åº”ç”¨è¿›ç¨‹ã€‚ç³»ç»Ÿè°ƒç”¨æ¥å£å®é™…ä¸Šå°±æ˜¯åº”ç”¨è¿›ç¨‹çš„æ§åˆ¶æƒå’Œæ“ä½œç³»ç»Ÿçš„æ§åˆ¶æƒè¿›è¡Œè½¬æ¢çš„ä¸€ä¸ªæ¥å£ã€‚</p><p>ä¹¦ä¸­åé¢åœ¨è®²å¼€å‘çš„Socketå¥—æ¥å­—æ¥å£ä¾‹å­(å¥—æ¥å­—ç°åœ¨å·²ç»æˆä¸ºæ“ä½œç³»ç»Ÿå†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œç†Ÿæ‚‰ç¼–ç¨‹äº†è¿™ä¸œè¥¿æ¯”ä¹¦ä¸Šæ‡‚å¾—å¤šå¤šäº†ã€‚</p><p><img src="/2021/03/15/network/%E5%A5%97%E6%8E%A5%E5%AD%97.png"></p><p>å¸¸ç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆTCPæœåŠ¡ï¼‰</p><p>1ï¼‰ è¿æ¥å»ºç«‹é˜¶æ®µã€‚</p><p>å¥—æ¥å­—åˆ›å»ºåï¼Œå®ƒçš„ç«¯å£å·å’ŒIPåœ°å€éƒ½æ˜¯ç©ºçš„ï¼Œå› æ­¤åº”ç”¨è¿›ç¨‹è¦è°ƒç”¨bindï¼ˆç»‘å®šï¼‰æ¥æŒ‡æ˜å¥—æ¥å­—çš„æœ¬åœ°åœ°å€ï¼ˆæœ¬åœ°ç«¯å£å·å’Œæœ¬åœ°IPåœ°å€ï¼‰ã€‚</p><p>æœåŠ¡å™¨è°ƒç”¨bindåï¼Œè¿˜å¿…é¡»è°ƒç”¨listenï¼ˆç›‘å¬ï¼‰æŠŠå¥—æ¥å­—è®¾ç½®ä¸ºè¢«åŠ¨æ–¹å¼ï¼Œä»¥ä¾¿éšæ—¶æ¥å—å®¢æˆ·çš„æœåŠ¡è¯·æ±‚ã€‚UDPæœåŠ¡å™¨ç”±äºåªæ˜¯æä¾›æ— è¿æ¥æœåŠ¡ï¼Œä¸ä½¿ç”¨listenç³»ç»Ÿè°ƒç”¨ã€‚</p><p>ç„¶åè°ƒç”¨acceptï¼ˆæ¥å—ï¼‰ï¼Œèƒ½å¤Ÿå¤„ç†å¤šä¸ªè¿æ¥ï¼ˆå¹¶å‘ï¼‰ã€‚</p><p>å®¢æˆ·è¯·æ±‚è¿æ¥åï¼ŒæœåŠ¡å™¨æŠŠå¥—æ¥å­—çš„æ ‡è¯†ç¬¦è¿”å›ç»™å‘èµ·è¿æ¥çš„å®¢æˆ·æ–¹ã€‚</p><p>2ï¼‰æ•°æ®ä¼ é€é˜¶æ®µ</p><p>sendç³»ç»Ÿè°ƒç”¨ä¼ é€æ•°æ®ï¼Œä½¿ç”¨recvç³»ç»Ÿè°ƒç”¨æ¥æ”¶æ•°æ®ã€‚</p><p>é€šå¸¸sendè°ƒç”¨æŠŠæ•°æ®å¤åˆ¶åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å­˜ç§ï¼Œè‹¥ç³»ç»Ÿçš„ç¼“å­˜å·²ç»æ»¡äº†ï¼Œsendå°±æš‚æ—¶é˜»å¡ï¼Œç›´åˆ°ç¼“å­˜æœ‰ç©ºé—´å­˜æ”¾æ–°çš„æ•°æ®ã€‚</p><p>3ï¼‰è¿æ¥é‡Šæ”¾</p><p>closeè°ƒç”¨é‡Šæ”¾è¿æ¥å’Œæ’¤é”€å¥—æ¥å­—ã€‚</p><p><img src="/2021/03/15/network/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E4%BD%BF%E7%94%A8%E9%A1%BA%E5%BA%8F.png"></p>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
